# RF-028: Gestão de SLA - Operações

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC008-SD-Service-Desk
**Fase**: Fase 5 - Service Desk

**RFs Relacionados**: RF072 (Escalação Automática), RF077 (Ordens de Serviço)

---

## 1. OBJETIVO DO REQUISITO

Especificar o módulo de Gestão de SLA para Operações do sistema IControlIT, responsável por definir, monitorar e garantir o cumprimento de Service Level Agreements (SLAs) para operações de ativos. O módulo gerencia metas de tempo (resposta, resolução, atendimento) para operações como instalação, movimentação, configuração, desinstalação e manutenção de ativos.

O sistema calcula automaticamente o tempo de SLA consumido, gera alertas em cascata (50%, 75%, 90%, 100%) e escala automaticamente quando o SLA está prestes a vencer, suportando múltiplos calendários de atendimento (24x7, horário comercial, dias úteis) com integração de feriados nacionais e versionamento completo para auditoria.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] CRUD completo de SLAs para operações
- [x] Definição de metas por prioridade (P1, P2, P3, P4)
- [x] Priorização por tipo de ativo (crítico, alto, médio, baixo)
- [x] Calendário de atendimento flexível (24x7, comercial, dias úteis)
- [x] Pausa automática fora do horário de atendimento
- [x] Cálculo automático de SLA consumido vs disponível
- [x] Alertas em cascata (50%, 75%, 90%, 100%)
- [x] Escalação automática por nível (L1 → L2 → L3 → Manager)
- [x] Dashboard de SLA em tempo real (SignalR)
- [x] Relatórios de compliance
- [x] Integração com Ordens de Serviço (RF077)
- [x] Multi-tenancy por ClienteId
- [x] Auditoria completa de SLA
- [x] Versionamento de SLA
- [x] Exportação de métricas

### 2.2 Fora do escopo

- Interface visual específica (responsabilidade do frontend)
- Tecnologia, framework ou linguagem de implementação
- Layout, UX ou identidade visual
- Estratégia de deploy ou infraestrutura
- Integração com sistemas externos de gestão de SLA

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| **Service Level Agreement (SLA)** | Contrato formal que define metas de tempo para responder, resolver e entregar uma operação. Inclui tempo de resposta, resolução e atendimento. |
| **Prioridade** | Classificação de urgência baseada no tipo de ativo (crítico, alto, médio, baixo). P1 (Crítico), P2 (Alto), P3 (Médio), P4 (Baixo). |
| **Calendário de Atendimento** | Define em que dias/horários o SLA corre. Tipos: 24x7 (24h por dia), Horário Comercial (08:00-18:00), Dias Úteis (segunda a sexta, 08:00-18:00). |
| **Pausa de SLA** | Suspensão do contador de SLA quando: fora do horário de atendimento, aguardando ação do cliente ou aguardando terceiro. |
| **Escalação Automática** | Transferência de responsabilidade quando SLA está em risco: Level 1 (50%), Level 2 (75%), Level 3 (90%), Manager (100%). |
| **Versionamento de SLA** | Histórico de alterações de configuração com data de vigência, alterações realizadas, usuário e motivo. |
| **Multi-tenancy** | Cada SLA é isolado por ClienteId (cliente/empresa). Nenhum dado de clientes diferentes pode ser visível. |
| **Soft Delete** | SLAs nunca são deletados fisicamente do banco. Ao excluir, IsDeleted é marcado como true. |

---

## 4. FUNCIONALIDADES COBERTAS

1. **Criação de SLA** - Criar novo SLA com validações completas
2. **Atualização de SLA** - Editar SLA existente (metas, calendário, prioridades)
3. **Consulta de SLA** - Obter SLA por ID
4. **Listagem de SLAs** - Listar SLAs com filtros dinâmicos e paginação
5. **Exclusão Lógica** - Soft delete com auditoria completa
6. **Definição de Metas por Prioridade** - Configurar tempo resposta/resolução/atendimento para P1-P4
7. **Cálculo de SLA Consumido** - Algoritmo que exclui pausas, feriados e fins de semana
8. **Pausa Automática** - Suspender contador SLA fora do horário
9. **Retomada Automática** - Retomar contador SLA ao voltar ao horário
10. **Alertas em Cascata** - Notificações progressivas quando SLA está em risco
11. **Escalação Automática** - Transfer responsabilidade automaticamente quando alertas disparam
12. **Dashboard em Tempo Real** - Visualização live de status de operações com SignalR
13. **Relatórios de Compliance** - Percentual de atendimento, tempo médio, violações
14. **Integração com Feriados** - BrasilAPI para obter feriados nacionais
15. **Versionamento** - Histórico de alterações com vigência

---

## 5. REGRAS DE NEGÓCIO

### RN-SLA-028-01 — Validação de Hierarquia de Tempos SLA

**Descrição**: Tempo de resposta deve ser sempre menor que tempo de resolução, que deve ser menor que tempo de atendimento. Valida a coerência da meta de SLA.

**Justificativa**: Evita configurações ilógicas que causariam SLA impossível de atingir. Exemplo inválido: resposta=8h, resolução=4h (impossível responder em 8h e resolver em 4h).

**Critério de Aceite**:
- Tempo resposta >= tempo resolução → Rejeição HTTP 400
- Tempo resolução >= tempo atendimento → Rejeição HTTP 400
- Mensagem de erro clara indicando violação
- Validação executada antes de persistência

**Exemplos**:
- ✅ Válido: resposta=2h, resolução=4h, atendimento=8h (P1)
- ❌ Inválido: resposta=4h, resolução=4h, atendimento=8h (resposta=resolução viola)

---

### RN-SLA-028-02 — Cálculo de SLA Exclui Pausas e Feriados

**Descrição**: O contador de SLA não inclui períodos de pausa (fora horário, aguardando cliente) e feriados nacionais. Apenas tempo produtivo conta.

**Justificativa**: Garante fairness - não penaliza operação por limite de horário ou comportamento do cliente. Aumenta aceitação do SLA pelo cliente.

**Critério de Aceite**:
- Cálculo deduz duração total de todas as pausas ativas
- Feriados nacionais não contam no tempo produtivo
- Fins de semana são excluídos se calendário não for 24x7
- Algoritmo de cálculo retorna percentual consumido preciso

**Exemplos**:
- OS aberta segunda 08h, resolvida terça 10h: SLA consumido = 26h (exclui segunda 18-08=10h)
- Pausa de 2h aguardando cliente: contador pausado, não conta na SLA

---

### RN-SLA-028-03 — Pausa Automática Fora de Horário de Atendimento

**Descrição**: Quando a operação passa para fora do horário de atendimento, o contador de SLA é automaticamente pausado. Quando volta ao horário, retoma automaticamente.

**Justificativa**: Evita penalizar por período fora de expediente. Se SLA é "dias úteis 8-18h", não faz sentido contar à noite.

**Critério de Aceite**:
- Job background verifica horário a cada 15 minutos
- Saída de horário → cria PausaSLA com TipoPausa=ForaHorario
- Entrada de horário → fecha PausaSLA com DataFim
- Auditoria registra SLA_PAUSADO_AUTOMATICO e SLA_RETOMADO_AUTOMATICO
- Notificação opcional ao responsável

**Exemplos**:
- OS em andamento às 17:45 (ainda em horário). Às 18:05 SLA pausa automaticamente.
- Pausa retoma na terça às 08:00 quando expediente reabre.

---

### RN-SLA-028-04 — Alertas em Cascata (50%, 75%, 90%, 100%)

**Descrição**: Sistema calcula percentual de SLA consumido e gera alertas em milestones (50%, 75%, 90%, 100%). Cada alerta pode disparar notificação e escalação.

**Justificativa**: Alerta progressiva permite ação preventiva. Alert 50% é informativo, 75% requer atenção, 90% é crítico, 100% é violação.

**Critério de Aceite**:
- Alertas gerados apenas uma vez por threshold (verificação de duplicatas)
- Severidade: 50% = Informativo, 75% = Aviso, 90% = Crítico, 100% = Violação
- Notificação por e-mail + SignalR em tempo real
- Auditoria registra cada alerta gerado
- Escalação automática disparada em 75%+

**Exemplos**:
- SLA P1 = 2h resposta. Após 1h → alerta 50% (informativo).
- Após 1h30min → alerta 75% (aviso, pode escalar).
- Após 1h48min → alerta 90% (crítico, escalação obrigatória).
- Após 2h → alerta 100% (violação, manager notificado).

---

### RN-SLA-028-05 — Escalação Automática Quando SLA Estoura

**Descrição**: Quando SLA atinge 90% (crítico), sistema automaticamente transfere operação para Level 2. Quando atinge 100%, transfere para Level 3, depois para Manager.

**Justificativa**: Garante que operações críticas recebem atenção de pessoas mais experientes/sênior automaticamente, sem esperar por ação manual.

**Critério de Aceite**:
- Escalação só ocorre se nível atual < nível requerido
- Busca técnico disponível no nível alvo
- Se nenhum técnico disponível, escala para gerente
- Notifica novo responsável por e-mail + SMS
- Registra Escalacao com motivo, nível, usuário origem/destino
- Auditoria com código SLA_ESCALADO

**Exemplos**:
- Level 1 técnico recebe OS (P1, SLA = 2h resposta).
- Após 1h30min (75% SLA) → escalado para Level 2 (especialista).
- Após 1h48min (90% SLA) → escalado para Level 3 (gerente técnico).
- Após 2h (100% SLA) → escalado para Manager (operações).

---

### RN-SLA-028-06 — Metas de SLA para Prioridade P1 (Crítico)

**Descrição**: Prioridade P1 define metas: 2 horas resposta, 4 horas resolução, 8 horas atendimento. Aplicável a ativos críticos (servidores, switches principais, links críticos).

**Justificativa**: Ativos P1 impactam operação, requerem resposta rápida e resolução completa no mesmo dia.

**Critério de Aceite**:
- Meta resposta P1 ≤ 2 horas
- Meta resolução P1 ≤ 4 horas
- Meta atendimento P1 ≤ 8 horas
- Validação garante hierarquia resposta < resolução < atendimento

**Exemplos**:
- P1: Servidor de produção down → 2h resposta, 4h resolução.
- P1: Switch core offline → 2h resposta, 4h resolução.

---

### RN-SLA-028-07 — Metas de SLA para Prioridade P2 (Alto)

**Descrição**: Prioridade P2 define metas: 4 horas resposta, 8 horas resolução, 24 horas atendimento. Aplicável a ativos importantes (estações críticas, impressoras em áreas críticas).

**Justificativa**: Ativos P2 impactam áreas importantes mas não críticas. Permitem resolução em turno subsequente.

**Critério de Aceite**:
- Meta resposta P2 ≤ 4 horas
- Meta resolução P2 ≤ 8 horas
- Meta atendimento P2 ≤ 24 horas
- Validação garante hierarquia resposta < resolução < atendimento

**Exemplos**:
- P2: Estação de trabalho de gerente → 4h resposta, 8h resolução.
- P2: Impressora em área crítica → 4h resposta, 8h resolução.

---

### RN-SLA-028-08 — Metas de SLA para Prioridade P3 (Médio)

**Descrição**: Prioridade P3 define metas: 8 horas resposta, 24 horas resolução, 48 horas atendimento. Aplicável a ativos padrão (computadores pessoais, monitores).

**Justificativa**: Ativos P3 são genéricos. Permitem resposta no turno seguinte e resolução em até 2 dias.

**Critério de Aceite**:
- Meta resposta P3 ≤ 8 horas
- Meta resolução P3 ≤ 24 horas
- Meta atendimento P3 ≤ 48 horas
- Validação garante hierarquia resposta < resolução < atendimento

**Exemplos**:
- P3: Computador pessoal → 8h resposta, 24h resolução.
- P3: Monitor → 8h resposta, 24h resolução.

---

### RN-SLA-028-09 — Metas de SLA para Prioridade P4 (Baixo)

**Descrição**: Prioridade P4 define metas: 24 horas resposta, 72 horas resolução, 5 dias atendimento. Aplicável a ativos não essenciais (periféricos, cabos).

**Justificativa**: Ativos P4 não impactam operação. Permitem resolução em conveniência dentro de 5 dias úteis.

**Critério de Aceite**:
- Meta resposta P4 ≤ 24 horas
- Meta resolução P4 ≤ 72 horas
- Meta atendimento P4 ≤ 5 dias
- Validação garante hierarquia resposta < resolução < atendimento

**Exemplos**:
- P4: Cabo de rede → 24h resposta, 72h resolução.
- P4: Periférico → 24h resposta, 72h resolução.

---

### RN-SLA-028-10 — Multi-tenancy por ClienteId Obrigatório

**Descrição**: Toda operação de SLA deve incluir ClienteId obrigatoriamente. Dados de um cliente nunca são visíveis para outro cliente. Isolamento em nível de banco.

**Justificativa**: Atende LGPD, ISO 27001. Garante que dados de cliente A não vazam para cliente B mesmo em caso de bug.

**Critério de Aceite**:
- Todas as queries incluem WHERE ClienteId = [ClienteId do usuário autenticado]
- Tentativa de acesso cruzado → HTTP 403 Forbidden
- Middleware valida ClienteId em todas as requisições
- Repository layer força filtro automático por ClienteId

**Exemplos**:
- ClienteId = A tenta acessar SLA de ClienteId = B → acesso negado.
- Filtro automático em todas as queries.

---

### RN-SLA-028-11 — Soft Delete com IsDeleted Flag

**Descrição**: Exclusão lógica via flag IsDeleted = true. Nunca deleta permanentemente da base. Permite auditoria futura e recovery.

**Justificativa**: LGPD, auditoria regulatória, compliance. Histórico de SLAs deletados deve ser rastreável.

**Critério de Aceite**:
- DELETE marca IsDeleted = true, DataDelecao, UsuarioDeletouId
- Queries padrão filtram WHERE IsDeleted = false
- Método específico para consultar SLAs deletados (admin)
- Possibilidade de restauração (reversão de soft delete)
- Auditoria registra snapshot completo antes da exclusão

**Exemplos**:
- DELETE /api/sla-operacoes/5 marca IsDeleted = true.
- GET /api/sla-operacoes não retorna SLAs deletados.
- SELECT * WHERE IsDeleted = true retorna auditoria.

---

### RN-SLA-028-12 — Integração com BrasilAPI para Feriados Nacionais

**Descrição**: Sistema consulta BrasilAPI para obter feriados nacionais e estaduais. Feriados são automaticamente excluídos do cálculo de SLA.

**Justificativa**: Evita contar tempo em feriados (de lei) como tempo de SLA. Garante justiça ao cliente.

**Critério de Aceite**:
- Consulta BrasilAPI anualmente e cacheia resultados
- Fallback usa cache em caso de falha da API
- Feriados nacionais e estaduais (por UF) excluídos do cálculo
- Log de erro se API indisponível, alerta admin
- Cache de feriados renovado automaticamente a cada ano

**Exemplos**:
- 25/12 (Natal) não conta em SLA de nenhuma empresa.
- 20/11 (Consciência Negra) em alguns estados não conta.
- BrasilAPI consultada anualmente e cacheada.

---

## 6. ESTADOS DA ENTIDADE

| Estado | Descrição | Transições Permitidas |
|--------|-----------|----------------------|
| **Ativo** | SLA em uso para operações | → Inativo (Desativar) |
| **Inativo** | SLA desativado, não aplicável a novas operações | → Ativo (Reativar) |
| **Deletado** | Soft delete (IsDeleted = true) | N/A (estado final, recuperável) |

---

## 7. PERMISSÕES RBAC

| Permissão | Descrição | Perfis Autorizados |
|-----------|-----------|-------------------|
| `sla:operacoes:create` | Criar novo SLA | Gerente Técnico, Admin Tenant |
| `sla:operacoes:read` | Visualizar SLAs | Todos |
| `sla:operacoes:update` | Editar SLA existente | Gerente Técnico, Admin Tenant |
| `sla:operacoes:delete` | Deletar SLA (soft delete) | Gerente Técnico, Admin Tenant |
| `sla:operacoes:export` | Exportar dados de SLA | Gerente Técnico, Admin Tenant, Manager |
| `sla:operacoes:metrics` | Acessar relatórios e métricas | Manager, Gerente Técnico, Admin Tenant |
| `sla:operacoes:pause` | Pausar SLA manualmente | Gerente Técnico, Level 2, Level 3 |
| `sla:operacoes:resume` | Retomar SLA pausado | Gerente Técnico, Level 2, Level 3 |
| `sla:operacoes:escalate` | Escalar SLA manualmente | Gerente Técnico, Level 3, Manager |

---

## 8. API ENDPOINTS

### 8.1 CRUD Principal

| Método | Endpoint | Descrição | Permissão | Status HTTP |
|--------|----------|-----------|-----------|-------------|
| GET | `/api/sla-operacoes` | Listar SLAs da empresa | `sla:operacoes:read` | 200, 403 |
| GET | `/api/sla-operacoes/{id}` | Obter SLA por ID | `sla:operacoes:read` | 200, 403, 404 |
| POST | `/api/sla-operacoes` | Criar novo SLA | `sla:operacoes:create` | 201, 400, 403 |
| PUT | `/api/sla-operacoes/{id}` | Atualizar SLA | `sla:operacoes:update` | 200, 400, 403, 404 |
| DELETE | `/api/sla-operacoes/{id}` | Deletar SLA (soft delete) | `sla:operacoes:delete` | 204, 403, 404 |
| GET | `/api/sla-operacoes/buscar` | Busca avançada com paginação | `sla:operacoes:read` | 200, 400 |

### 8.2 Operações Especiais

| Método | Endpoint | Descrição | Permissão | Status HTTP |
|--------|----------|-----------|-----------|-------------|
| GET | `/api/sla-operacoes/{id}/calcular` | Calcular SLA de uma OS | `sla:operacoes:read` | 200, 400, 403, 404 |
| POST | `/api/sla-operacoes/{id}/pausar` | Pausar SLA manualmente | `sla:operacoes:pause` | 200, 400, 403, 404 |
| POST | `/api/sla-operacoes/{id}/retomar` | Retomar SLA pausado | `sla:operacoes:resume` | 200, 400, 403, 404 |
| POST | `/api/sla-operacoes/{id}/escalar` | Escalar SLA manualmente | `sla:operacoes:escalate` | 200, 400, 403, 404 |
| GET | `/api/sla-operacoes/dashboard/compliance` | Dashboard compliance SLA | `sla:operacoes:metrics` | 200, 403 |
| GET | `/api/sla-operacoes/dashboard/violacoes` | SLAs estourados | `sla:operacoes:metrics` | 200, 403 |
| GET | `/api/sla-operacoes/dashboard/em-risco` | SLAs em risco (75%+) | `sla:operacoes:metrics` | 200, 403 |
| POST | `/api/sla-operacoes/{id}/versionar` | Criar nova versão de SLA | `sla:operacoes:update` | 201, 400, 403, 404 |
| GET | `/api/sla-operacoes/{id}/versoes` | Listar versões históricas | `sla:operacoes:read` | 200, 403, 404 |
| GET | `/api/sla-operacoes/export/excel` | Exportar SLAs em Excel | `sla:operacoes:export` | 200, 403 |
| GET | `/api/sla-operacoes/export/pdf` | Exportar relatório em PDF | `sla:operacoes:export` | 200, 403 |
| GET | `/api/sla-operacoes/metricas` | Métricas gerenciais (KPIs) | `sla:operacoes:metrics` | 200, 403 |
| GET | `/api/sla-operacoes/alertas` | Listar alertas ativos | `sla:operacoes:read` | 200, 403 |

---

## 9. INTEGRAÇÕES OBRIGATÓRIAS

### 9.1 Central de Funcionalidades (Feature Flags)

**FeatureKeys**:
- `SLA_OPERACOES_GESTAO`: CRUD e operações básicas de SLAs
- `SLA_OPERACOES_ALERTAS`: Alertas automáticos em 50%, 75%, 90%, 100%
- `SLA_OPERACOES_ESCALACAO`: Escalação automática quando SLA em risco (75%+)
- `SLA_OPERACOES_DASHBOARD`: Dashboard em tempo real com SignalR
- `SLA_OPERACOES_FERIADOS`: Integração com BrasilAPI para feriados

Todas as features devem estar habilitadas por padrão em HOM e PRD.

---

### 9.2 Internacionalização (i18n)

**Chaves de Tradução** (pt-BR, en-US, es-ES):

```json
{
    "sla": {
        "operacoes": {
            "title": "Gestão de SLA - Operações",
            "description": "Configure metas de SLA para operações de ativos",
            "form": {
                "nome": "Nome do SLA",
                "descricao": "Descrição",
                "calendario": "Calendário de Atendimento",
                "metaRespostaP1": "Meta Resposta P1 (horas)",
                "metaResolucaoP1": "Meta Resolução P1 (horas)",
                "metaAtendimentoP1": "Meta Atendimento P1 (horas)"
            },
            "messages": {
                "success": "SLA salvo com sucesso",
                "error": "Erro ao salvar SLA"
            },
            "validation": {
                "required": "Campo obrigatório",
                "invalidHierarchy": "Tempo resposta < resolução < atendimento"
            },
            "alerts": {
                "50percent": "SLA atingiu 50% (informativo)",
                "75percent": "SLA atingiu 75% (aviso)",
                "90percent": "SLA atingiu 90% (crítico)",
                "100percent": "SLA violado (100%)"
            }
        }
    }
}
```

---

### 9.3 Auditoria

**Operações Auditadas**:

| Operação | Código | Dados Registrados |
|----------|--------|-------------------|
| Criar SLA | `SLA_OP_CREATE` | Nome, metas (P1-P4), calendário, responsável |
| Atualizar SLA | `SLA_OP_UPDATE` | Campos alterados (before/after), motivo |
| Deletar SLA | `SLA_OP_DELETE` | ID deletado, motivo, data, usuário |
| Calcular SLA | `SLA_OP_CALC` | OS ID, percentual consumido, tempo produtivo |
| Pausar SLA | `SLA_OP_PAUSE` | OS ID, tipo pausa, motivo, duração |
| Retomar SLA | `SLA_OP_RESUME` | OS ID, duração pausa anterior |
| Escalar SLA | `SLA_OP_ESCALATE` | OS ID, nível anterior/novo, motivo |
| Alerta de SLA | `SLA_OP_ALERT` | OS ID, percentual alerta, severidade |
| Versionar SLA | `SLA_OP_VERSION` | ID novo SLA, campos alterados, data vigência |

**Retenção**: 10 anos (conforme Lei de Proteção de Dados + ISO 27001 e SOC 2).

---

## 10. SEGURANÇA

### 10.1 Proteções Implementadas

| Proteção | Descrição |
|----------|-----------|
| **RBAC (Role-Based Access Control)** | Permissões granulares (sla:operacoes:*) verificadas em todos os endpoints |
| **Multi-tenancy (ClienteId)** | Isolamento de dados por cliente via filter automático em todas as queries |
| **Soft Delete** | Exclusão lógica com IsDeleted flag, auditoria completa |
| **Auditoria Completa** | Todos os eventos (CREATE, UPDATE, DELETE, CALC, PAUSE, ESCALATE) registrados |
| **SQL Injection Protection** | Entity Framework com parameterized queries, sem SQL dinâmico |
| **XSS Protection** | Angular sanitize + Content Security Policy headers |
| **CSRF Protection** | Anti-forgery tokens em POST/PUT/DELETE |
| **Data Encryption** | Dados sensíveis criptografados em repouso (AES-256) |
| **Rate Limiting** | Limite de 100 requisições por minuto por IP |
| **Input Validation** | Validação em cliente (Angular) + servidor (C#) com dados tipados |

### 10.2 Testes de Segurança Obrigatórios

- [ ] SQL Injection em campos Nome, Descrição de SLA
- [ ] XSS em campos Nome, Descrição, Motivo pausa
- [ ] CSRF Protection em POST /api/sla-operacoes
- [ ] Validação de permissões (usuário sem sla:operacoes:read não vê dados)
- [ ] Multi-tenancy (ClienteId=A não vê dados de ClienteId=B)
- [ ] Soft delete (SLA deletado não aparece em listagem padrão)
- [ ] Rate limiting (> 100 req/min retorna 429)
- [ ] Validação de campos obrigatórios
- [ ] Validação de hierarquia de tempos (resposta < resolução < atendimento)
- [ ] Auditoria registra todas as operações

---

## 11. MÉTRICAS E INDICADORES

### 11.1 KPIs

| KPI | Meta | Medição |
|-----|------|---------|
| **Taxa de Compliance SLA** | >= 95% | (Operações no prazo / Total operações) * 100 |
| **Tempo Médio de Resposta** | <= Meta SLA | Média (DataResposta - DataAbertura) excluindo pausas |
| **Tempo Médio de Resolução** | <= Meta SLA | Média (DataResolução - DataAbertura) excluindo pausas |
| **% Violações SLA** | <= 5% | (Operações atrasadas / Total operações) * 100 |
| **Tempo de Escalação** | <= 30 min | Média (DataEscalacao - DataAlerta) |
| **Taxa de Reescalação** | <= 10% | (Operações escaladas 2+ vezes / Total escaladas) * 100 |
| **Disponibilidade da API** | >= 99.9% | Uptime / tempo total |
| **Performance de Cálculo SLA** | <= 100ms | P95 latency (GET /api/sla-operacoes/{id}/calcular) |

### 11.2 Alertas

| Alerta | Condição | Ação |
|--------|----------|------|
| **SLA Crítico (90%)** | Operação atinge 90% SLA | Escalar para Level 3, notificar por email + SMS |
| **SLA Violado (100%)** | Operação ultrapassa meta | Escalar para Manager, abrir ticket compensação |
| **Múltiplas Escalações** | OS escalada 3+ vezes | Notificar Diretor de Operações, análise root cause |
| **Taxa Compliance Baixa** | Taxa mensal < 90% | Gerar relatório para direção, planejar melhoria |
| **Feriado não Registrado** | Consulta BrasilAPI falha | Usar cache, notificar admin para sincronizar |
| **Pausa Longa** | Pausa > 24h | Notificar responsável, investigar motivo |

---

## PRÓXIMOS PASSOS

1. **Modelo de Dados**: Criar MD-RF028.md com DDL completo
2. **Casos de Uso**: Criar UC-RF028.md com 5 cenários
3. **Workflow UI**: Criar WF-RF028.md com telas Angular
4. **User Stories**: Criar user-stories.yaml com mínimo 3 stories
5. **Implementação Backend**: Commands/Queries/Handlers
6. **Implementação Frontend**: Angular components, services, rotas
7. **Testes Automatizados**: Tester-Backend validará contrato, Playwright E2E
8. **Documentação de Testes**: TC-RF028-BACKEND.md, TC-RF028-FRONTEND.md

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 1.0 | 2025-12-28 | Versão inicial com 12 regras de negócio, 13 endpoints | Claude Code |
| 2.0 | 2025-12-30 | Migração v1.0 → v2.0 (separação RF/RL completa, sem código C# ou referências ao legado) | Claude Code |

---

**Última Atualização**: 2025-12-30
**Autor**: Claude Code - Agência ALC
**Revisão**: Pendente
