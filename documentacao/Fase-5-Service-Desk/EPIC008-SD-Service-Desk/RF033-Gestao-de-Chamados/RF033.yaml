# =============================================
# RF033 - Gestão de Chamados (Service Desk)
# Versão: 2.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br
# =============================================

rf:
  id: "RF033"
  nome: "Gestão de Chamados (Service Desk)"
  versao: "2.0"
  data: "2025-12-30"
  fase: "Fase 5 - Service Desk"
  epic: "EPIC008-SD-Service-Desk"
  status: "em_desenvolvimento" # draft | aprovado | em_desenvolvimento | concluido

descricao:
  objetivo: "Implementar sistema completo de Service Desk para gerenciamento de chamados de suporte técnico, solicitações de serviços e incidentes, com controle de SLA, distribuição por filas, avaliação de satisfação e métricas em tempo real."
  problema_resolvido: "Falta de controle adequado de SLA, ausência de rastreabilidade de atendimentos, dificuldade na distribuição de chamados e inexistência de métricas de qualidade do suporte."
  publico_afetado: "Usuários finais solicitantes, equipes de suporte (Nível 1, Nível 2), supervisores de fila, gestores de TI."

escopo:
  incluso:
    - "CRUD completo de chamados"
    - "Cálculo automático de SLA com dias úteis"
    - "Distribuição automática e manual para filas"
    - "Registro de interações públicas e privadas"
    - "Sistema de avaliação de satisfação (NPS)"
    - "Alertas de vencimento de SLA"
    - "Dashboard de métricas em tempo real"
    - "Workflow configurável por tipo"
    - "Vinculação a ativos, consumidores e contratos"
    - "Base de conhecimento de soluções"
    - "Auditoria completa (7 anos LGPD)"
    - "RBAC granular"
    - "Multi-tenancy por Fornecedor"
    - "Internacionalização (pt-BR, en-US, es-ES)"
  fora:
    - "Base de conhecimento completa (RF futuro)"
    - "Chatbot de atendimento automático"
    - "Integração com telefonia (CTI)"
    - "Gestão de problemas e mudanças (ITIL)"

entidades:
  - nome: "Chamado"
    descricao: "Solicitação de serviço, suporte técnico ou registro de incidente"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "ChamadoItem"
    descricao: "Interação registrada no chamado (pública ou privada)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "ChamadoAnexo"
    descricao: "Arquivo anexado ao chamado ou interação"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "ChamadoAvaliacao"
    descricao: "Avaliação de satisfação do atendimento"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "FilaAtendimento"
    descricao: "Grupo especializado de atendimento"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "TipoSolicitacao"
    descricao: "Tipo de chamado (incidente, requisição, etc)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "SolicitacaoSLA"
    descricao: "Definição de prazo por tipo de solicitação"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "SolicitacaoSolucao"
    descricao: "Solução aplicada ao chamado"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "DataParada"
    descricao: "Feriados e datas que pausam SLA"
    multi_tenant: true
    soft_delete: true
    auditoria: true

regras_negocio:
  - id: "RN-RF033-01"
    descricao: "Campos obrigatórios na abertura: título, data solicitação, usuário solicitante, tipo solicitação, tipo ativo"
    tipo: "validacao"
    campos_afetados: ["Titulo", "DataSolicitacao", "UsuarioSolicitanteId", "TipoSolicitacaoId", "TipoAtivoId"]
    obrigatorio: true

  - id: "RN-RF033-02"
    descricao: "Cálculo automático de SLA considerando apenas dias úteis e excluindo datas de parada"
    tipo: "regra_negocio"
    campos_afetados: ["DataVencimento", "TipoSolicitacaoId"]
    obrigatorio: true

  - id: "RN-RF033-03"
    descricao: "Validação de transições de status conforme workflow"
    tipo: "validacao"
    campos_afetados: ["Status"]
    obrigatorio: true

  - id: "RN-RF033-04"
    descricao: "Solução obrigatória ao encerrar chamado"
    tipo: "validacao"
    campos_afetados: ["SolucaoId", "Status"]
    obrigatorio: true

  - id: "RN-RF033-05"
    descricao: "Alertas visuais e notificações quando SLA atingir 80% ou 100%"
    tipo: "regra_negocio"
    campos_afetados: ["DataVencimento", "DataSolicitacao"]
    obrigatorio: true

  - id: "RN-RF033-06"
    descricao: "Avaliação de satisfação opcional, mas se informada deve ter nota 1-5"
    tipo: "validacao"
    campos_afetados: ["Avaliacao"]
    obrigatorio: false

  - id: "RN-RF033-07"
    descricao: "Interações podem ser públicas (visíveis ao solicitante) ou privadas (apenas equipe)"
    tipo: "regra_negocio"
    campos_afetados: ["FlPublico"]
    obrigatorio: true

  - id: "RN-RF033-08"
    descricao: "Atribuição a fila de atendimento obrigatória"
    tipo: "validacao"
    campos_afetados: ["FilaAtendimentoId"]
    obrigatorio: true

  - id: "RN-RF033-09"
    descricao: "Vinculação a ativo ou consumidor opcional"
    tipo: "validacao"
    campos_afetados: ["AtivoId", "ConsumidorUnidadeId"]
    obrigatorio: false

  - id: "RN-RF033-10"
    descricao: "Notificações automáticas em eventos-chave (abertura, atribuição, status, SLA, encerramento, avaliação)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF033-11"
    descricao: "Reabertura permitida até 7 dias após encerramento"
    tipo: "validacao"
    campos_afetados: ["Status", "DataEncerramento"]
    obrigatorio: true

  - id: "RN-RF033-12"
    descricao: "Prazo SLA pausado em status 'Aguardando Usuário' ou 'Aguardando Fornecedor'"
    tipo: "regra_negocio"
    campos_afetados: ["Status", "DataInicioAguardando", "TotalHorasAguardando"]
    obrigatorio: true

  - id: "RN-RF033-13"
    descricao: "Anexos: limite 10 MB por arquivo, 50 MB total por chamado"
    tipo: "validacao"
    campos_afetados: ["TamanhoBytes"]
    obrigatorio: true

  - id: "RN-RF033-14"
    descricao: "Escalação automática para supervisor quando SLA vencido"
    tipo: "regra_negocio"
    campos_afetados: ["FlEscalado", "DataEscalacao"]
    obrigatorio: true

  - id: "RN-RF033-15"
    descricao: "Soluções podem ser marcadas como base de conhecimento para reutilização"
    tipo: "regra_negocio"
    campos_afetados: ["FlBaseConhecimento"]
    obrigatorio: true

  - id: "RN-RF033-16"
    descricao: "Isolamento multi-tenant: usuário acessa apenas chamados do seu Fornecedor"
    tipo: "seguranca"
    campos_afetados: ["FornecedorId"]
    obrigatorio: true

  - id: "RN-RF033-17"
    descricao: "Unicidade de avaliação: apenas 1 avaliação por chamado"
    tipo: "unicidade"
    campos_afetados: ["ChamadoId"]
    obrigatorio: true

estados:
  - id: "Aberto"
    descricao: "Chamado criado, aguardando atendimento"
  - id: "EmAtendimento"
    descricao: "Em atendimento pela equipe de suporte"
  - id: "AguardandoUsuario"
    descricao: "Aguardando resposta do solicitante"
  - id: "AguardandoFornecedor"
    descricao: "Aguardando resposta de fornecedor externo"
  - id: "Resolvido"
    descricao: "Solução aplicada, aguardando confirmação"
  - id: "Encerrado"
    descricao: "Chamado finalizado"
  - id: "Cancelado"
    descricao: "Chamado cancelado sem resolução"

transicoes:
  permitidas:
    - de: "Aberto"
      para: "EmAtendimento"
    - de: "Aberto"
      para: "Cancelado"
    - de: "EmAtendimento"
      para: "AguardandoUsuario"
    - de: "EmAtendimento"
      para: "AguardandoFornecedor"
    - de: "EmAtendimento"
      para: "Resolvido"
    - de: "AguardandoUsuario"
      para: "EmAtendimento"
    - de: "AguardandoUsuario"
      para: "Resolvido"
    - de: "AguardandoFornecedor"
      para: "EmAtendimento"
    - de: "AguardandoFornecedor"
      para: "Resolvido"
    - de: "Resolvido"
      para: "Encerrado"
    - de: "Resolvido"
      para: "EmAtendimento" # reabertura
    - de: "Encerrado"
      para: "EmAtendimento" # reabertura até 7 dias
  proibidas:
    - de: "Cancelado"
      para: "*" # sem transições

eventos_dominio:
  - nome: "ChamadoCriado"
    quando: "Após criação do chamado"
  - nome: "ChamadoAtribuido"
    quando: "Após atribuição a técnico/fila"
  - nome: "ChamadoStatusAlterado"
    quando: "Após mudança de status"
  - nome: "ChamadoVencendoSLA"
    quando: "Quando 80% do prazo decorrido"
  - nome: "ChamadoVencido"
    quando: "Quando 100% do prazo decorrido"
  - nome: "ChamadoEncerrado"
    quando: "Após encerramento"
  - nome: "ChamadoAvaliado"
    quando: "Após avaliação de satisfação"
  - nome: "ChamadoReaberto"
    quando: "Após reabertura"
  - nome: "ChamadoEscalado"
    quando: "Após escalação automática"

permissoes:
  - codigo: "GES.CHAMADOS.VIEW"
    descricao: "Visualizar chamados próprios"
  - codigo: "GES.CHAMADOS.VIEW_ALL"
    descricao: "Visualizar todos os chamados"
  - codigo: "GES.CHAMADOS.CREATE"
    descricao: "Criar chamados"
  - codigo: "GES.CHAMADOS.UPDATE"
    descricao: "Atualizar chamados"
  - codigo: "GES.CHAMADOS.CLOSE"
    descricao: "Encerrar chamados"
  - codigo: "GES.CHAMADOS.EVALUATE"
    descricao: "Avaliar chamados"
  - codigo: "GES.CHAMADOS.ASSIGN"
    descricao: "Atribuir chamados"
  - codigo: "GES.CHAMADOS.REOPEN"
    descricao: "Reabrir chamados"
  - codigo: "GES.CHAMADOS.EXPORT"
    descricao: "Exportar relatórios"

integracoes:
  internas:
    - "Autenticacao (JWT)"
    - "Multi-Tenancy (FornecedorId)"
    - "Auditoria (7 anos LGPD)"
    - "Central de Funcionalidades"
    - "Internacionalização (i18n)"
    - "RBAC (Controle de Acesso)"
    - "Notificações Multi-Canal"
    - "SignalR (Dashboard Tempo Real)"
  externas:
    - sistema: "Ativos"
      tipo: "API Interna"
      obrigatoria: false
      descricao: "Vinculação de chamado a ativo específico"
    - sistema: "Consumidores"
      tipo: "API Interna"
      obrigatoria: false
      descricao: "Vinculação de chamado a unidade de consumidor"
    - sistema: "Contratos"
      tipo: "API Interna"
      obrigatoria: false
      descricao: "Contextualização de chamado com contrato"

seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: true
  validacao_entrada: true
  protecao_injecao: true
  rbac: true
  retencao_dados: "7 anos (LGPD)"

rastreabilidade:
  ucs_esperados:
    - "UC00" # Listar Chamados
    - "UC01" # Criar Chamado
    - "UC02" # Visualizar Chamado
    - "UC03" # Editar/Atribuir Chamado
    - "UC04" # Encerrar/Avaliar Chamado

catalog:
  crud:
    - id: "RF033-CRUD-01"
      title: "Criar chamado"
      required: true
    - id: "RF033-CRUD-02"
      title: "Listar chamados"
      required: true
    - id: "RF033-CRUD-03"
      title: "Visualizar chamado"
      required: true
    - id: "RF033-CRUD-04"
      title: "Atualizar chamado"
      required: true
    - id: "RF033-CRUD-05"
      title: "Atribuir chamado"
      required: true
    - id: "RF033-CRUD-06"
      title: "Adicionar interação"
      required: true
    - id: "RF033-CRUD-07"
      title: "Upload de anexo"
      required: true
    - id: "RF033-CRUD-08"
      title: "Alterar status"
      required: true
    - id: "RF033-CRUD-09"
      title: "Encerrar chamado"
      required: true
    - id: "RF033-CRUD-10"
      title: "Avaliar chamado"
      required: true
    - id: "RF033-CRUD-11"
      title: "Reabrir chamado"
      required: true

  validacoes:
    - id: "RF033-VAL-01"
      title: "Validar campos obrigatórios"
      required: true
    - id: "RF033-VAL-02"
      title: "Validar transições de status"
      required: true
    - id: "RF033-VAL-03"
      title: "Validar solução obrigatória no encerramento"
      required: true
    - id: "RF033-VAL-04"
      title: "Validar nota avaliação (1-5)"
      required: true
    - id: "RF033-VAL-05"
      title: "Validar limite anexos (10 MB/arquivo, 50 MB/chamado)"
      required: true
    - id: "RF033-VAL-06"
      title: "Validar reabertura (até 7 dias)"
      required: true
    - id: "RF033-VAL-07"
      title: "Validar unicidade de avaliação"
      required: true

  seguranca:
    - id: "RF033-SEC-01"
      title: "Isolamento multi-tenant"
      required: true
    - id: "RF033-SEC-02"
      title: "Permissões RBAC"
      required: true
    - id: "RF033-SEC-03"
      title: "Auditoria completa (7 anos)"
      required: true
    - id: "RF033-SEC-04"
      title: "Soft delete"
      required: true
    - id: "RF033-SEC-05"
      title: "Validação de entrada"
      required: true

  funcionalidades_especificas:
    - id: "RF033-FUNC-01"
      title: "Cálculo automático de SLA (dias úteis + datas parada)"
      required: true
    - id: "RF033-FUNC-02"
      title: "Alertas SLA (80% e 100%)"
      required: true
    - id: "RF033-FUNC-03"
      title: "Escalação automática (SLA vencido)"
      required: true
    - id: "RF033-FUNC-04"
      title: "Pausa SLA em status 'Aguardando'"
      required: true
    - id: "RF033-FUNC-05"
      title: "Notificações automáticas (eventos de domínio)"
      required: true
    - id: "RF033-FUNC-06"
      title: "Dashboard em tempo real (SignalR)"
      required: true
    - id: "RF033-FUNC-07"
      title: "Base de conhecimento (sugestão soluções)"
      required: true
    - id: "RF033-FUNC-08"
      title: "Interações públicas e privadas"
      required: true

exclusions:
  documentacao_items: []

historico:
  - versao: "2.0"
    data: "2025-12-30"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração v1.0 → v2.0: Separação RF/RL completa. Removidas todas as referências ao legado. 17 regras de negócio estruturadas. Sincronização 100% com RF033.md."

  - versao: "1.0"
    data: "2025-01-14"
    autor: "Architect Agent"
    descricao: "Versão inicial com documentação misturada (legado + moderno). 15 regras de negócio."
