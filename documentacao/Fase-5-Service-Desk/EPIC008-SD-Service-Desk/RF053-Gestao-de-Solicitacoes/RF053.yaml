# =============================================
# RF053 - Gestão de Solicitações
# Versão: 2.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br
# =============================================

rf:
  id: "RF053"
  nome: "Gestão de Solicitações"
  versao: "2.0"
  data: "2025-12-30"
  fase: "Fase 5 - Service Desk"
  epic: "EPIC008-SD-Service-Desk"
  status: "em_desenvolvimento" # backend DONE, frontend NOT_STARTED

descricao:
  objetivo: "Prover sistema completo de gestão de solicitações internas (service desk) com workflow configurável, SLA automático e aprovação mobile."
  problema_resolvido: "Centralizar solicitações de TI/mobile/telecom com rastreabilidade, aprovação controlada e métricas de qualidade."
  publico_afetado: "Todos os colaboradores (solicitantes), gestores (aprovadores), equipe de TI (atendentes), supervisores."

escopo:
  incluso:
    - "Criação de solicitações com formulário dinâmico por tipo"
    - "Workflow de aprovação multi-nível configurável"
    - "Controle automático de SLA com pausas e alertas"
    - "Atribuição e roteamento de solicitações"
    - "Aprovação mobile com notificação push"
    - "Chat interno por solicitação"
    - "Anexos múltiplos com validação"
    - "Pesquisa de satisfação automática (NPS)"
    - "Dashboard em tempo real (SignalR)"
    - "Delegação temporária de aprovadores"
    - "Escalonamento automático por atraso"
    - "Reabertura de solicitações (7 dias)"
    - "Integração com gestão de ativos"
    - "Exportação de relatórios (Excel/PDF)"
    - "Auditoria completa de operações"
  fora:
    - "Gestão de conhecimento (KB/FAQ)"
    - "Atendimento a clientes externos"
    - "SLA por cliente externo"
    - "Integração com ferramentas de monitoramento"
    - "Chatbot / IA conversacional"

entidades:
  - nome: "Solicitacao"
    descricao: "Entidade principal representando uma solicitação de serviço/ativo"
    multi_tenant: true
    soft_delete: true
    auditoria: true
    campos_principais:
      - "Id (Guid)"
      - "Numero (string) - AUTO: SOL-YYYY-NNNNN"
      - "SolicitanteId (Guid)"
      - "TipoId (Guid)"
      - "Status (enum)"
      - "Prioridade (enum)"
      - "Titulo (string)"
      - "Descricao (string)"
      - "CamposDinamicos (JSON)"
      - "DataAbertura (DateTime)"
      - "DataLimiteSLA (DateTime?)"
      - "DataFechamento (DateTime?)"
      - "TempoPausadoSLA (TimeSpan?)"
      - "AtendenteId (Guid?)"
      - "EmAprovacao (bool)"
      - "NivelAprovacaoAtual (int)"
      - "Solucao (string)"
      - "JustificativaCancelamento (string)"
      - "EmpresaId (Guid)"

  - nome: "SolicitacaoTipo"
    descricao: "Tipos configuráveis de solicitação (novo ativo, reparo, etc)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "SolicitacaoAnexo"
    descricao: "Anexos de solicitação (fotos, documentos, evidências)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "SolicitacaoAprovacao"
    descricao: "Aprovações/rejeições em workflow multi-nível"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "SolicitacaoHistorico"
    descricao: "Histórico de mudanças de status e ações"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "MensagemSolicitacao"
    descricao: "Chat interno da solicitação (público e interno)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "DelegacaoAprovador"
    descricao: "Delegação temporária de aprovadores (férias, ausências)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "PesquisaSatisfacao"
    descricao: "Pesquisa NPS enviada automaticamente ao fechar solicitação"
    multi_tenant: true
    soft_delete: false
    auditoria: true

regras_negocio:
  - id: "RN-RF053-01"
    descricao: "Tipos de solicitação configuráveis com campos dinâmicos (JSON schema)"
    tipo: "regra_negocio"
    campos_afetados: ["TipoId", "CamposDinamicos"]
    obrigatorio: true

  - id: "RN-RF053-02"
    descricao: "Prioridade calculada automaticamente (cargo + tipo + impacto)"
    tipo: "regra_negocio"
    campos_afetados: ["Prioridade"]
    obrigatorio: true

  - id: "RN-RF053-03"
    descricao: "Workflow de aprovação multi-nível configurável por tipo/valor"
    tipo: "regra_negocio"
    campos_afetados: ["EmAprovacao", "NivelAprovacaoAtual"]
    obrigatorio: true

  - id: "RN-RF053-04"
    descricao: "SLA automático com pausas (dias úteis, pendências externas)"
    tipo: "regra_negocio"
    campos_afetados: ["DataLimiteSLA", "TempoPausadoSLA"]
    obrigatorio: true

  - id: "RN-RF053-05"
    descricao: "Aprovação mobile com notificação push e token temporário (15 min)"
    tipo: "seguranca"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-06"
    descricao: "Delegação de aprovadores (máximo 90 dias, sem sobreposição)"
    tipo: "validacao"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-07"
    descricao: "Anexos obrigatórios por tipo (fotos, orçamentos, autorizações)"
    tipo: "validacao"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-08"
    descricao: "Escalonamento automático (100% SLA → supervisor, 150% → gerente, 200% → diretor)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-09"
    descricao: "Chat interno com mensagens públicas (solicitante) e internas (atendentes)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-10"
    descricao: "Integração com gestão de ativos (criação automática no inventário)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-11"
    descricao: "Reabertura permitida dentro de 7 dias (somente solicitante original)"
    tipo: "validacao"
    campos_afetados: ["Status", "DataFechamento"]
    obrigatorio: true

  - id: "RN-RF053-12"
    descricao: "Pesquisa de satisfação automática (NPS) ao fechar solicitação"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-13"
    descricao: "Cancelamento com justificativa obrigatória (mínimo 20 caracteres)"
    tipo: "validacao"
    campos_afetados: ["Status", "JustificativaCancelamento"]
    obrigatorio: true

  - id: "RN-RF053-14"
    descricao: "Dashboard em tempo real via SignalR (latência < 500ms)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

  - id: "RN-RF053-15"
    descricao: "Exportação de relatórios (Excel/PDF) com filtros configuráveis"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: true

estados:
  - id: "ABERTA"
    descricao: "Criada, aguardando aprovação ou atendimento"
  - id: "EM_APROVACAO"
    descricao: "Aguardando aprovação de um ou mais níveis"
  - id: "APROVADA"
    descricao: "Aprovada, aguardando atribuição a atendente"
  - id: "REJEITADA"
    descricao: "Rejeitada em workflow de aprovação"
  - id: "EM_ATENDIMENTO"
    descricao: "Atribuída a atendente, em andamento"
  - id: "AGUARDANDO_SOLICITANTE"
    descricao: "Pausada aguardando resposta do solicitante"
  - id: "FECHADA"
    descricao: "Finalizada com solução registrada"
  - id: "CANCELADA"
    descricao: "Cancelada por supervisor com justificativa"

transicoes:
  permitidas:
    - de: "ABERTA"
      para: "EM_APROVACAO"
      condicao: "Se workflow configurado para o tipo"
    - de: "ABERTA"
      para: "EM_ATENDIMENTO"
      condicao: "Se não requer aprovação"
    - de: "EM_APROVACAO"
      para: "APROVADA"
      condicao: "Aprovação concluída em todos os níveis"
    - de: "EM_APROVACAO"
      para: "REJEITADA"
      condicao: "Rejeição em qualquer nível"
    - de: "APROVADA"
      para: "EM_ATENDIMENTO"
      condicao: "Atribuída a atendente"
    - de: "EM_ATENDIMENTO"
      para: "AGUARDANDO_SOLICITANTE"
      condicao: "Pendência externa (resposta solicitante)"
    - de: "AGUARDANDO_SOLICITANTE"
      para: "EM_ATENDIMENTO"
      condicao: "Retorno solicitante"
    - de: "EM_ATENDIMENTO"
      para: "FECHADA"
      condicao: "Solução registrada"
    - de: "FECHADA"
      para: "EM_ATENDIMENTO"
      condicao: "Reabertura dentro de 7 dias"
  proibidas:
    - de: "REJEITADA"
      para: "APROVADA"
      motivo: "Solicitação rejeitada não pode ser aprovada sem nova submissão"
    - de: "CANCELADA"
      para: "*"
      motivo: "Solicitação cancelada não pode mudar de status"

eventos_dominio:
  - evento: "SolicitacaoCriada"
    quando: "Após criação bem-sucedida"
  - evento: "SolicitacaoEnviadaParaAprovacao"
    quando: "Ao iniciar workflow de aprovação"
  - evento: "SolicitacaoAprovada"
    quando: "Após aprovação de nível"
  - evento: "SolicitacaoRejeitada"
    quando: "Após rejeição"
  - evento: "SolicitacaoAtribuida"
    quando: "Ao atribuir a atendente"
  - evento: "SolicitacaoFechada"
    quando: "Ao fechar com solução"
  - evento: "SolicitacaoCancelada"
    quando: "Ao cancelar"
  - evento: "SolicitacaoReaberta"
    quando: "Ao reabrir dentro de 7 dias"
  - evento: "SLAVencendo"
    quando: "Ao atingir 80% do SLA"
  - evento: "SLAVencido"
    quando: "Ao atingir 100% do SLA"
  - evento: "EscalonamentoAutomatico"
    quando: "Ao escalonar por atraso (100%/150%/200%)"
  - evento: "MensagemAdicionada"
    quando: "Nova mensagem no chat interno"
  - evento: "AnexoAdicionado"
    quando: "Novo anexo anexado"

permissoes:
  - codigo: "GES.SOLICITACOES.CREATE"
    descricao: "Criar solicitação"
    roles_padrao: ["Funcionario", "Gestor", "Atendente TI", "Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.VIEW_OWN"
    descricao: "Ver próprias solicitações"
    roles_padrao: ["Funcionario", "Gestor", "Atendente TI", "Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.VIEW_ALL"
    descricao: "Ver todas solicitações"
    roles_padrao: ["Gestor", "Atendente TI", "Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.APPROVE"
    descricao: "Aprovar/rejeitar solicitação"
    roles_padrao: ["Gestor", "Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.ASSIGN"
    descricao: "Atribuir solicitação a atendente"
    roles_padrao: ["Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.CLOSE"
    descricao: "Fechar solicitação"
    roles_padrao: ["Atendente TI", "Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.CANCEL"
    descricao: "Cancelar solicitação"
    roles_padrao: ["Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.REOPEN"
    descricao: "Reabrir solicitação (dentro de 7 dias)"
    roles_padrao: ["Funcionario", "Gestor", "Atendente TI", "Supervisor TI", "Administrador"]
  - codigo: "GES.SOLICITACOES.EXPORT"
    descricao: "Exportar relatórios"
    roles_padrao: ["Supervisor TI", "Administrador"]

integracoes:
  internas:
    - "Autenticacao (JWT Bearer Token)"
    - "Multi-Tenancy (EmpresaId)"
    - "Auditoria (7 anos - LGPD)"
    - "RBAC (Permissões por operação)"
    - "Central de Funcionalidades (GES.SOLICITACOES)"
    - "i18n (pt-BR, en-US, es-ES)"
  externas:
    - sistema: "Gestão de Ativos"
      tipo: "API interna"
      obrigatoria: true
      descricao: "Criação automática de ativo no inventário ao aprovar solicitação"
    - sistema: "SignalR"
      tipo: "WebSocket"
      obrigatoria: true
      descricao: "Notificações em tempo real e dashboard"
    - sistema: "Serviço de E-mail/SMS"
      tipo: "API"
      obrigatoria: true
      descricao: "Notificações de aprovação, SLA, pesquisa de satisfação"

seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: true
  rbac: true
  validacoes:
    - "Anexos validados (tipo, tamanho, antivírus)"
    - "Tokens de aprovação mobile temporários (15 min)"
    - "Proteção SQL Injection, XSS, CSRF"
    - "Histórico de ações auditado (IP, user-agent, timestamp)"

performance:
  - "Listagem de solicitações: < 1s para 10.000 registros"
  - "Criação de solicitação: < 2s"
  - "Dashboard em tempo real: latência < 500ms"
  - "Upload de anexos: suporte a múltiplos arquivos simultâneos"
  - "Notificações push: latência < 1s"

usabilidade:
  - "Interface intuitiva para usuários não técnicos"
  - "Formulários com autocompletar e sugestões"
  - "Mobile-first para aprovações"
  - "Notificações não invasivas"
  - "Feedback visual claro de status"
  - "Acessibilidade WCAG 2.1 AA"

rastreabilidade:
  ucs_esperados:
    - "UC00 - Listar Solicitações"
    - "UC01 - Criar Solicitação"
    - "UC02 - Visualizar Solicitação"
    - "UC03 - Aprovar/Rejeitar Solicitação"
    - "UC04 - Atribuir Solicitação"
    - "UC05 - Fechar Solicitação"
    - "UC06 - Cancelar Solicitação"
    - "UC07 - Reabrir Solicitação"
    - "UC08 - Delegar Aprovação"
    - "UC09 - Pausar/Retomar SLA"
    - "UC10 - Enviar Mensagem (Chat)"
    - "UC11 - Adicionar Anexo"
    - "UC12 - Responder Pesquisa de Satisfação"
    - "UC13 - Exportar Relatórios"
    - "UC14 - Dashboard em Tempo Real"

catalog:
  crud:
    - id: "RF-CRUD-01"
      title: "Criar solicitação"
      required: true
    - id: "RF-CRUD-02"
      title: "Listar solicitações"
      required: true
    - id: "RF-CRUD-03"
      title: "Visualizar solicitação"
      required: true
    - id: "RF-CRUD-04"
      title: "Atualizar solicitação (comentários, anexos)"
      required: true
    - id: "RF-CRUD-05"
      title: "Fechar solicitação"
      required: true

  validacoes:
    - id: "RF-VAL-01"
      title: "Validar campos obrigatórios"
      required: true
    - id: "RF-VAL-02"
      title: "Validar anexos (tipo, tamanho, vírus)"
      required: true
    - id: "RF-VAL-03"
      title: "Validar SLA e pausas"
      required: true
    - id: "RF-VAL-04"
      title: "Validar delegação de aprovadores"
      required: true
    - id: "RF-VAL-05"
      title: "Validar reabertura (7 dias)"
      required: true

  seguranca:
    - id: "RF-SEC-01"
      title: "Isolamento de tenant"
      required: true
    - id: "RF-SEC-02"
      title: "Permissões RBAC"
      required: true
    - id: "RF-SEC-03"
      title: "Auditoria completa (7 anos)"
      required: true
    - id: "RF-SEC-04"
      title: "Tokens mobile temporários"
      required: true

  integracao:
    - id: "RF-INT-01"
      title: "Central de Funcionalidades"
      required: true
    - id: "RF-INT-02"
      title: "Internacionalização (i18n)"
      required: true
    - id: "RF-INT-03"
      title: "SignalR (tempo real)"
      required: true
    - id: "RF-INT-04"
      title: "Gestão de Ativos"
      required: true

exclusions:
  documentacao_items:
    - id: "EXC-01"
      title: "Gestão de conhecimento (KB/FAQ)"
      motivo: "Fora do escopo do RF053"
    - id: "EXC-02"
      title: "Atendimento a clientes externos"
      motivo: "RF053 é apenas para solicitações internas"
    - id: "EXC-03"
      title: "Chatbot / IA conversacional"
      motivo: "Funcionalidade futura, não prevista para MVP"

historico:
  - versao: "2.0"
    data: "2025-12-30"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração v1.0 → v2.0 - Separação RF/RL, contrato funcional moderno"
  - versao: "1.0"
    data: "2025-01-14"
    autor: "Equipe IControlIT"
    descricao: "Versão inicial do requisito"
