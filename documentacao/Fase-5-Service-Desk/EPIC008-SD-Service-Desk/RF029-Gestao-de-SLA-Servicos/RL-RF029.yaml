# =============================================
# RL-RF029 - Referência ao Legado
# Gestão de SLA - Serviços
# Versão: 2.0 (Governança v2.0 - Rastreabilidade Completa)
# Data: 2025-12-30
# =============================================

rf_id: RF029
titulo: "Gestão de SLA - Serviços"

legado:
  sistema: "ASP.NET Web Forms + VB.NET + SQL Server"
  versao: "IControlIT 1.0 (Web Forms)"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server (multi-database por cliente)"
  multi_tenant: false
  auditoria: "partial"  # Apenas UPDATE via trigger, sem INSERT/DELETE

# ==============================================================================
# REFERÊNCIAS AO LEGADO COM DESTINO OBRIGATÓRIO
# ==============================================================================

referencias:
  # TELAS ASPX
  - id: "LEG-RF029-001"
    tipo: "tela"
    nome: "Contrato_SLA_Servico.aspx"
    caminho: "ic1_legado/IControlIT/Contrato/Contrato_SLA_Servico.aspx"
    descricao: |
      Tela de CRUD de SLA de serviços contratuais.
      Permitia criar, editar, visualizar e excluir SLAs vinculados a contratos.
      Campos: Id_Contrato, Descricao, Tipo_Servico, Vr_SLA_Servico, Fl_Desativado, Id_Operadora, Id_Contrato_Indice.
      Validação de campos obrigatórios apenas no frontend (JavaScript), backend NÃO validava.
      Soft delete via Fl_Desativado = 2 (tri-state: 0=Ativo, 1=Inativo, 2=Excluído).
    destino: "substituido"
    justificativa: |
      Tela ASPX com postback substituída por componente Angular standalone com validação no backend.
      Tabela legado redesenhada com multi-tenancy (ClienteId), auditoria completa, campos de tempo resposta/resolução.
    documentacao_item_relacionado: "RN-RF029-013"
    uc_relacionado: "UC01-criar-sla, UC03-editar-sla"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF029-002"
    tipo: "tela"
    nome: "Solicitacao_SLA.aspx"
    caminho: "ic1_legado/IControlIT/Solicitacao/Solicitacao_SLA.aspx"
    descricao: |
      Tela de gestão de tipos de SLA para solicitações/chamados.
      Campos: Nm_Solicitacao_SLA, Horas (resolução), Email_2_Nivel, Fl_Desativado.
      Campo "Horas" era APENAS tempo de resolução, NÃO havia tempo de resposta separado.
      Email de escalação hardcoded por tipo, não dinâmico.
    destino: "substituido"
    justificativa: |
      Lógica de tipos de SLA migrada para enum Priority (P1/P2/P3/P4) no sistema moderno.
      Tempo de resposta e resolução agora separados em campos distintos.
      Escalação dinâmica por nível técnico, não mais email hardcoded.
    documentacao_item_relacionado: "RN-RF029-002, RN-RF029-003, RN-RF029-004, RN-RF029-005"
    uc_relacionado: "UC01-criar-sla"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  # TABELAS LEGADAS
  - id: "LEG-RF029-003"
    tipo: "tabela"
    nome: "Contrato_SLA_Servico"
    caminho: "ic1_legado/Database/Tables/[dbo].[Contrato_SLA_Servico]"
    schema_legado: "[dbo].[Contrato_SLA_Servico]"
    descricao: |
      Tabela principal de SLA de serviços contratuais no sistema legado.
      Armazenava definição de SLA vinculado a contratos, com campos de descrição, tipo de serviço, valor monetário (penalidade), status (Fl_Desativado tri-state).
      Não tinha campos de tempo resposta/resolução, prioridade, horário de atendimento ou multi-tenancy.
    problemas_identificados:
      - "Falta FK explícita para Id_Contrato"
      - "Sem campos de auditoria (Created, CreatedBy, Modified, ModifiedBy)"
      - "Sem multi-tenancy (ClienteId)"
      - "Soft delete tri-state (Fl_Desativado: 0/1/2)"
      - "Descricao VARCHAR(8000) sem MAX"
      - "Tipo_Servico sem enum (texto livre)"
      - "Sem tempo de resposta/resolução"
      - "Sem horário de atendimento (comercial/24x7/plantão)"
      - "Sem prioridade (P1/P2/P3/P4)"
    destino: "substituido"
    justificativa: |
      Tabela redesenhada como SlaServico com:
      - Multi-tenancy (ClienteId obrigatório)
      - Auditoria completa (EF Core AuditInterceptor)
      - Soft delete boolean (IsDeleted)
      - Campos TempoResposta (minutos) e TempoResolucao (horas) separados
      - Enum HorarioAtendimento (Comercial/24x7/Plantao)
      - Enum Priority (P1/P2/P3/P4)
      - FK enforçadas pelo EF Core
    documentacao_item_relacionado: "RF-029 Seção 10 (Artefatos Derivados → MD-RF029)"
    migracao_moderna:
      tabela_moderna: "SlaServico"
      migration_ef_core: "20251230_CreateSlaServicoTable.cs"
    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF029-004"
    tipo: "tabela"
    nome: "Solicitacao_SLA"
    caminho: "ic1_legado/Database/Tables/[dbo].[Solicitacao_SLA]"
    schema_legado: "[dbo].[Solicitacao_SLA]"
    descricao: |
      Tabela de tipos de SLA para solicitações/chamados no sistema legado.
      Armazenava nome do tipo (Crítico, Alto, Médio, Baixo), horas de resolução (INT), email de escalação (2º nível hardcoded) e status (Fl_Desativado).
      Não tinha tempo de resposta separado, não tinha matriz de priorização automática.
    problemas_identificados:
      - "Horas em INT (precisão baixa, apenas horas inteiras)"
      - "Sem tempo de resposta separado"
      - "Email hardcoded (um por tipo)"
      - "Sem campos de auditoria"
      - "Sem multi-tenancy"
    destino: "descartado"
    justificativa: |
      Tabela descartada. Lógica migrada para:
      - Enum Priority (P1/P2/P3/P4) no código
      - Campos TempoResposta e TempoResolucao na tabela SlaServico
      - Escalação dinâmica por nível técnico (não mais email hardcoded)
    documentacao_item_relacionado: "RN-RF029-002, RN-RF029-003, RN-RF029-004, RN-RF029-005"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF029-005"
    tipo: "tabela"
    nome: "Log_Alteracao_Contrato_SLA_Servico"
    caminho: "ic1_legado/Database/Tables/[dbo].[Log_Alteracao_Contrato_SLA_Servico]"
    schema_legado: "[dbo].[Log_Alteracao_Contrato_SLA_Servico]"
    descricao: |
      Tabela de auditoria parcial de alterações em Contrato_SLA_Servico no sistema legado.
      Populada via trigger SQL que rodava apenas em UPDATE (não em INSERT/DELETE).
      Armazenava snapshot do registro alterado mas não registrava usuário, IP ou diff (valores antes vs depois).
    problemas_identificados:
      - "Sem PK (tabela de log sem chave primária)"
      - "Sem usuário (não registrava quem alterou)"
      - "Sem IP (não registrava de onde veio a alteração)"
      - "Snapshot apenas (salvava estado novo, mas não diff com estado anterior)"
      - "Apenas UPDATE (trigger rodava só em UPDATE, não em INSERT/DELETE)"
    destino: "substituido"
    justificativa: |
      Auditoria legada incompleta substituída por sistema de auditoria EF Core com tabela AuditLog completa:
      - Registra INSERT, UPDATE, DELETE, ACCESS
      - Registra usuário (UserId), IP, timestamp
      - Registra diff (valores anteriores e novos lado a lado)
      - PK auto-increment
      - Retenção de 7 anos (LGPD)
    documentacao_item_relacionado: "RN-RF029-010, RF-029 Seção 9 (Segurança)"
    migracao_moderna:
      tabela_moderna: "AuditLog"
      handler: "AuditInterceptor (EF Core)"
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 1

  # STORED PROCEDURES
  - id: "LEG-RF029-006"
    tipo: "stored_procedure"
    nome: "pa_CalcularSLA (inexistente, cálculo manual)"
    caminho: "N/A"
    descricao: |
      Stored procedure NÃO existia no legado. Cálculo de SLA era manual, feito no code-behind da tela Solicitacao.aspx.vb.
      Lógica presumida:
      - Obter data de abertura do chamado
      - Calcular horas decorridas (DateDiff em horas)
      - Comparar com campo "Horas" da tabela Solicitacao_SLA
      - Exibir label "SLA OK" ou "SLA VIOLADO"
      Problemas:
      - Cálculo síncrono durante carregamento da página (lento)
      - NÃO excluía pausas, finais de semana ou feriados
      - Apenas horas (impreciso para P1 que tem 15min de resposta)
      - NÃO havia job assíncrono recalculando continuamente
    destino: "substituido"
    justificativa: |
      Lógica de cálculo manual substituída por:
      - Quartz Job assíncrono SlaCalculationJob executando a cada 1 minuto
      - Cálculo preciso em minutos (não apenas horas)
      - Exclui pausas automáticas (fora de horário), pausas manuais e feriados nacionais (BrasilAPI)
      - Atualização em tempo real via SignalR
    documentacao_item_relacionado: "RN-RF029-006, RN-RF029-009"
    migracao_moderna:
      handler: "SlaCalculationJob (Quartz)"
      linha_codigo: "Application/Jobs/SlaCalculationJob.cs"
    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF029-007"
    tipo: "stored_procedure"
    nome: "sp_AtualizarLogSLA (trigger automático)"
    caminho: "ic1_legado/Database/Triggers/tr_Contrato_SLA_Servico_Audit.sql (presumido)"
    descricao: |
      Trigger SQL no UPDATE de Contrato_SLA_Servico que inseria em Log_Alteracao_Contrato_SLA_Servico.
      Auditava apenas UPDATE, não INSERT nem DELETE.
      Não registrava usuário, IP ou diff (valores anteriores vs novos).
    destino: "substituido"
    justificativa: |
      Trigger SQL substituído por AuditInterceptor do EF Core que audita ALL operations (INSERT, UPDATE, DELETE, ACCESS) com:
      - UserId (quem fez)
      - IP de origem
      - Timestamp
      - Diff completo (antes vs depois)
      - Retenção de 7 anos
    documentacao_item_relacionado: "RN-RF029-010, RF-029 Seção 9 (Segurança)"
    migracao_moderna:
      handler: "AuditInterceptor (EF Core)"
      linha_codigo: "Infrastructure/Persistence/Interceptors/AuditInterceptor.cs"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  # REGRAS IMPLÍCITAS
  - id: "LEG-RF029-008"
    tipo: "regra_negocio"
    nome: "Cálculo de SLA em horas corridas (24x7)"
    caminho: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx.vb"
    localizacao_codigo: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx.vb - Linha 450-470 (aprox)"
    descricao: |
      Sistema legado calculava SLA em horas corridas (24x7), incluindo finais de semana, feriados e horário não comercial.
      Não havia pausa automática.
      Chamados abertos na sexta 18h tinham SLA correndo durante todo final de semana, tornando metas impossíveis de atingir para P1/P2.
    destino: "substituido"
    justificativa: |
      Regra de cálculo 24x7 substituída por pausa automática fora de horário de atendimento (RN-RF029-006).
      Sistema moderno respeita horário configurado (Comercial 08:00-17:00, 24x7, Plantão 18:00-08:00) e exclui feriados nacionais (BrasilAPI).
    documentacao_item_relacionado: "RN-RF029-006"
    uc_relacionado: "UC05-calcular-consumo-sla"
    migracao_moderna:
      handler: "SlaCalculationService.CalculateEffectiveSlaTime()"
      linha_codigo: "Application/Services/SlaCalculationService.cs"
    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF029-009"
    tipo: "regra_negocio"
    nome: "Priorização manual por técnico"
    caminho: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx"
    localizacao_codigo: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx - Dropdown 'Tipo de SLA'"
    descricao: |
      Técnico escolhia manualmente o tipo de SLA (Crítico, Alto, Médio, Baixo) ao criar o chamado.
      Não havia matriz de priorização automática por Impacto × Urgência.
      Priorização inconsistente, sujeita a erro humano e favoritismo.
    destino: "substituido"
    justificativa: |
      Priorização manual substituída por matriz automática Impacto × Urgência (RN-RF029-001).
      Técnico NÃO pode mais escolher prioridade manualmente, sistema calcula automaticamente com base em Impacto (Alto/Médio/Baixo) e Urgência (Alta/Média/Baixa).
    documentacao_item_relacionado: "RN-RF029-001"
    uc_relacionado: "UC01-criar-sla"
    migracao_moderna:
      handler: "PriorityMatrixService.CalculatePriority()"
      linha_codigo: "Application/Services/PriorityMatrixService.cs"
    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF029-010"
    tipo: "regra_negocio"
    nome: "Alertas apenas por email pontual"
    caminho: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx.vb"
    localizacao_codigo: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx.vb - Método EnviarEmailSLA() (manual)"
    descricao: |
      Quando técnico percebia que SLA estava próximo de violar, enviava email manual para supervisor.
      Não havia alertas automáticos em cascata (50%, 75%, 90%, 100%).
      Supervisor só era notificado quando técnico lembrava, muitas violações passavam despercebidas.
    destino: "substituido"
    justificativa: |
      Alertas manuais substituídos por alertas automáticos em cascata (RN-RF029-007):
      - 50% consumido → SignalR (informativo)
      - 75% consumido → SignalR + Email (atenção)
      - 90% consumido → SignalR + Email + SMS (urgente)
      - 100% consumido → SignalR + Email + SMS + Escalação automática (crítico)
    documentacao_item_relacionado: "RN-RF029-007"
    uc_relacionado: "UC06-dashboard-compliance"
    migracao_moderna:
      handler: "SlaAlertService.CheckAndDispatchAlerts()"
      linha_codigo: "Application/Services/SlaAlertService.cs"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF029-011"
    tipo: "regra_negocio"
    nome: "Escalação manual por supervisor"
    caminho: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx"
    localizacao_codigo: "ic1_legado/IControlIT/Solicitacao/Solicitacao.aspx - Botão 'Escalar para N2'"
    descricao: |
      Escalação era manual, supervisor precisava abrir o chamado e clicar em "Escalar para N2".
      Não havia escalação automática quando SLA violava.
      Violações de SLA não garantiam atenção de nível superior, dependia de ação manual do supervisor.
    destino: "substituido"
    justificativa: |
      Escalação manual substituída por escalação automática (RN-RF029-008).
      Quando SLA atinge 100% de consumo, sistema automaticamente escala chamado para nível técnico superior (N1 → N2 → N3 → Especialista).
    documentacao_item_relacionado: "RN-RF029-008"
    uc_relacionado: "UC06-escalar"
    migracao_moderna:
      handler: "SlaEscalationService.EscalateOnViolation()"
      linha_codigo: "Application/Services/SlaEscalationService.cs"
    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF029-012"
    tipo: "regra_negocio"
    nome: "Feriados hardcoded em tabela manual"
    caminho: "ic1_legado/Database/Tables/[dbo].[Feriados]"
    localizacao_codigo: "Tabela Feriados (presumida, não documentada)"
    descricao: |
      Feriados eram inseridos manualmente por administrador no início do ano.
      Não havia integração com BrasilAPI.
      Feriados esquecidos não eram excluídos do cálculo de SLA, causando violações injustas.
    destino: "substituido"
    justificativa: |
      Feriados hardcoded substituídos por integração com BrasilAPI (RN-RF029-012).
      Sistema consulta API pública uma vez por ano e cacheia feriados nacionais/estaduais/municipais.
      Cache com TTL de 365 dias, fallback para cache de ano anterior em caso de falha da API.
    documentacao_item_relacionado: "RN-RF029-012"
    migracao_moderna:
      handler: "BrasilApiHolidayService.IsHoliday()"
      linha_codigo: "Infrastructure/Services/BrasilApiHolidayService.cs"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF029-013"
    tipo: "regra_negocio"
    nome: "Valor monetário de SLA (penalidade) não calculado"
    caminho: "ic1_legado/Database/Tables/[dbo].[Contrato_SLA_Servico]"
    localizacao_codigo: "Tabela Contrato_SLA_Servico, campo Vr_SLA_Servico"
    descricao: |
      Campo Vr_SLA_Servico (numeric) armazenava valor monetário de penalidade por violação, mas sistema legado NUNCA calculava ou aplicava automaticamente.
      Campo era preenchido mas nunca usado, apenas para referência manual em relatórios.
    destino: "descartado"
    justificativa: |
      Sistema moderno NÃO calcula penalidades monetárias automaticamente.
      Campo descartado. Violações são apenas registradas para relatórios gerenciais e auditoria.
      Se cliente precisar calcular penalidades, deverá ser feito manualmente via relatório exportado.
    documentacao_item_relacionado: null
    uc_relacionado: null
    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 5

# ==============================================================================
# GAP ANALYSIS (LEGADO × MODERNO)
# ==============================================================================

gap_analysis:
  - item: "CRUD de SLA"
    existe_legado: true
    existe_moderno: true
    notas: "Tela ASPX substituída por componente Angular standalone"

  - item: "Campos de tempo resposta/resolução separados"
    existe_legado: false
    existe_moderno: true
    notas: "Legado tinha apenas 'Horas' (resolução), moderno separa resposta e resolução"

  - item: "Horário de atendimento (comercial/24x7/plantão)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado sempre 24x7, moderno permite configurar horário"

  - item: "Prioridade automática (P1/P2/P3/P4)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado escolha manual, moderno matriz Impacto × Urgência"

  - item: "Cálculo automático de SLA"
    existe_legado: false
    existe_moderno: true
    notas: "Legado cálculo manual ao abrir tela, moderno job a cada 1 minuto"

  - item: "Pausa automática fora de horário"
    existe_legado: false
    existe_moderno: true
    notas: "Legado SLA corria 24x7, moderno pausa fora de expediente"

  - item: "Alertas em cascata (50/75/90/100%)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado email pontual manual, moderno alertas automáticos em cascata"

  - item: "Escalação automática"
    existe_legado: false
    existe_moderno: true
    notas: "Legado escalação manual, moderno automática quando SLA viola"

  - item: "Dashboard em tempo real (SignalR)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado atualização manual (F5), moderno WebSocket em tempo real"

  - item: "Integração BrasilAPI para feriados"
    existe_legado: false
    existe_moderno: true
    notas: "Legado feriados hardcoded, moderno API pública"

  - item: "Multi-tenancy (ClienteId)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado banco por cliente, moderno ClienteId em tabela única"

  - item: "Auditoria completa (Created/Modified)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado apenas UPDATE via trigger, moderno auditoria EF Core"

  - item: "Soft delete consistente"
    existe_legado: true
    existe_moderno: true
    notas: "Legado tri-state (0/1/2), moderno boolean limpo"

  - item: "Penalidade monetária automática"
    existe_legado: false
    existe_moderno: false
    notas: "Legado tinha campo mas não calculava, moderno também não calcula"

  - item: "Validação de unicidade (Serviço+Prioridade)"
    existe_legado: false
    existe_moderno: true
    notas: "Legado permitia SLAs duplicados, moderno valida unicidade"

# ==============================================================================
# DECISÕES DE MODERNIZAÇÃO
# ==============================================================================

decisoes_modernizacao:
  - decisao: "Consolidar multi-database em single-database com ClienteId"
    motivo: |
      Sistema legado tinha um banco SQL Server por cliente, dificultando manutenção, backups e escalabilidade.
      Sistema moderno consolida todos clientes em único banco com isolamento via ClienteId (multi-tenancy lógico).
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Migrar de Fl_Desativado tri-state para IsDeleted boolean"
    motivo: |
      Sistema legado usava Fl_Desativado com 3 valores (0=Ativo, 1=Inativo, 2=Excluído), causando confusão.
      Sistema moderno usa IsActive boolean + IsDeleted boolean separados.
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Separar tempo de resposta e tempo de resolução"
    motivo: |
      Sistema legado tinha apenas campo "Horas" (resolução total), sem meta separada para primeira resposta.
      Sistema moderno separa TempoResposta e TempoResolucao conforme ITIL v4.
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Implementar matriz de priorização automática"
    motivo: |
      Sistema legado dependia de escolha manual de prioridade por técnico, causando inconsistência.
      Sistema moderno calcula prioridade automaticamente com base em matriz Impacto × Urgência pré-definida.
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Implementar cálculo assíncrono de SLA com Quartz Job"
    motivo: |
      Sistema legado calculava SLA de forma síncrona ao abrir tela (lento, impreciso).
      Sistema moderno usa job assíncrono a cada 1 minuto para recalcular todos chamados ativos.
    impacto: "alto"
    data: "2025-12-30"

# ==============================================================================
# RISCOS DE MIGRAÇÃO
# ==============================================================================

riscos_migracao:
  - risco: "Perda de dados históricos durante consolidação de bancos"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      ETL completo com validação linha a linha, backup de todos bancos legados por 2 anos.

  - risco: "Metas antigas incompatíveis com novo modelo (horas → minutos)"
    impacto: "medio"
    probabilidade: "alta"
    mitigacao: |
      Converter metas antigas multiplicando por 60 para minutos, manter campo MigradoDeLegado para auditoria.

  - risco: "Técnicos resistentes a matriz automática de priorização"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Treinamento obrigatório, período de transição com override manual por supervisor.

  - risco: "Job assíncrono causando carga no banco"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Limitar job a 1000 chamados por lote, índices otimizados em IsDeleted, ClienteId, Status.

  - risco: "BrasilAPI indisponível causando falha no cálculo"
    impacto: "baixo"
    probabilidade: "baixa"
    mitigacao: |
      Cache de feriados com TTL 365 dias, fallback para cache de ano anterior, log warning se API falhar.

  - risco: "Falta de pausa automática causando violações injustas"
    impacto: "alto"
    probabilidade: "baixa"
    mitigacao: |
      Configurar horário de atendimento ANTES de ativar SLA, validação obrigatória no formulário.

  - risco: "Alertas em excesso (spam de notificações)"
    impacto: "baixo"
    probabilidade: "media"
    mitigacao: |
      Throttle de alertas (máximo 1 notificação por threshold por chamado), desabilitar alertas por perfil.

  - risco: "Escalação automática sobrecarregando N3"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Limite de escalações (máx 5% dos chamados/mês), supervisor pode reverter escalação.

# ==============================================================================
# RASTREABILIDADE (LEGADO → MODERNO)
# ==============================================================================

rastreabilidade:
  - elemento_legado: "Tela Contrato_SLA_Servico.aspx"
    referencia_rf: "RF-029 Seção 4 (Funcionalidades)"
    referencia_uc: "UC01-criar-sla, UC03-editar-sla"
    status: "migrado"

  - elemento_legado: "Tela Solicitacao_SLA.aspx"
    referencia_rf: "RN-RF029-002 a 005"
    referencia_uc: "UC01-criar-sla"
    status: "migrado"

  - elemento_legado: "Tabela Contrato_SLA_Servico"
    referencia_rf: "RF-029 Seção 10 (Artefatos Derivados → MD-RF029)"
    referencia_uc: null
    status: "migrado"

  - elemento_legado: "Tabela Solicitacao_SLA"
    referencia_rf: "RN-RF029-002 a 005"
    referencia_uc: null
    status: "descartado"

  - elemento_legado: "Campo Horas"
    referencia_rf: "RN-RF029-002 a 005"
    referencia_uc: "UC01-criar-sla"
    status: "migrado"

  - elemento_legado: "Campo Email_2_Nivel"
    referencia_rf: "RN-RF029-008"
    referencia_uc: "UC06-escalar"
    status: "descartado"

  - elemento_legado: "Campo Vr_SLA_Servico"
    referencia_rf: null
    referencia_uc: null
    status: "descartado"

  - elemento_legado: "Trigger auditoria"
    referencia_rf: "RF-029 Seção 9 (Segurança)"
    referencia_uc: null
    status: "migrado"

  - elemento_legado: "Cálculo manual de SLA"
    referencia_rf: "RN-RF029-006, RN-RF029-009"
    referencia_uc: "UC05-calcular-consumo-sla"
    status: "migrado"

  - elemento_legado: "Priorização manual"
    referencia_rf: "RN-RF029-001"
    referencia_uc: "UC01-criar-sla"
    status: "migrado"

  - elemento_legado: "Alertas manuais"
    referencia_rf: "RN-RF029-007"
    referencia_uc: "UC06-dashboard-compliance"
    status: "migrado"

  - elemento_legado: "Escalação manual"
    referencia_rf: "RN-RF029-008"
    referencia_uc: "UC06-escalar"
    status: "migrado"

  - elemento_legado: "Feriados hardcoded"
    referencia_rf: "RN-RF029-012"
    referencia_uc: null
    status: "migrado"

# ==============================================================================
# METADADOS DE RASTREABILIDADE
# ==============================================================================

metadados:
  total_itens_legado: 13
  itens_assumidos: 0
  itens_substituidos: 10
  itens_descartados: 3
  itens_a_revisar: 0
  cobertura_destinos: "100%"  # Todos itens têm campo destino preenchido

# ==============================================================================
# CHANGELOG
# ==============================================================================

changelog:
  - versao: "1.0"
    data: "2025-12-30"
    descricao: "Versão inicial - Referência completa ao legado de SLA Serviços com 100% destinos preenchidos"
    autor: "Agência ALC - alc.dev.br"
