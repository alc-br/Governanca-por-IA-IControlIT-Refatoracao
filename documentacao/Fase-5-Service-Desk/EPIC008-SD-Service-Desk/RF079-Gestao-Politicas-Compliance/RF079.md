# RF-079: Gestão de Políticas e Compliance

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC008-SD-Service-Desk
**Fase**: Fase 5 - Service Desk (Operações, Governance e Conformidade)

---

## 1. OBJETIVO DO REQUISITO

Descrever de forma clara, objetiva e verificável o comportamento esperado do **Módulo de Gestão de Políticas e Compliance**, servindo como **contrato oficial** entre negócio, desenvolvimento, testes e agentes de IA.

Este módulo centraliza, versioniza e rastreia o cumprimento de políticas corporativas em toda a organização, garantindo conformidade com regulamentações (LGPD, SOX, ISO 27001, ISO 20000, ITIL v4).

Este documento **não define implementação**, apenas **o que o sistema deve fazer**, sob quais condições e quais garantias devem ser preservadas.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] Criação e manutenção de políticas corporativas
- [x] Versionamento automático de políticas
- [x] Workflow de aprovação multi-nível (Elaboração → Revisão → Aprovada → Publicada)
- [x] Aceite obrigatório de políticas por usuários
- [x] Verificação automática de conformidade
- [x] Dashboard de compliance em tempo real
- [x] Gestão de exceções de conformidade
- [x] Matriz de compliance (políticas × regulamentações)
- [x] Notificações automáticas (email, in-app, SignalR)
- [x] Busca full-text em políticas
- [x] Categorização de políticas (Segurança, Financeiro, Operacional, Legal)
- [x] Controle de acesso baseado em permissões (RBAC)
- [x] Auditoria completa de todas as operações
- [x] Relatórios de auditoria de compliance
- [x] Multi-idioma (pt-BR, en-US, es-ES)

### 2.2 Fora do escopo (não objetivos)

- Interface visual específica
- Tecnologia, framework ou linguagem
- Layout, UX ou identidade visual
- Estratégia de deploy ou infraestrutura
- Integração com sistemas externos de compliance terceiros

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| **Política Corporativa** | Documento normalizado que define regras obrigatórias para a organização |
| **Conformidade** | Estado de cumprimento de uma política por usuário, departamento ou empresa |
| **Aceitação (Aceite)** | Ato de um usuário reconhecer e concordar explicitamente com uma política |
| **Matriz de Compliance** | Mapeamento entre políticas corporativas e regulamentações externas |
| **Exceção de Conformidade** | Aprovação temporária de violação de política com prazo de expiração |
| **Verificação Automática** | Regras configuráveis que detectam violação sem necessidade de aceite manual |
| **Versionamento** | Sistema sequencial de controle de mudanças em políticas (v1.0, v1.1, v2.0) |
| **Tenant** | Unidade lógica de isolamento de dados (multi-tenancy) |
| **Workflow de Aprovação** | Sequência obrigatória de estados para publicação de políticas |
| **Regulamentação** | Norma externa que a organização deve cumprir (LGPD, SOX, ISO 27001, etc.) |

---

## 4. FUNCIONALIDADES COBERTAS

1. Criar política corporativa
2. Atualizar política existente com versionamento automático
3. Consultar política por ID
4. Listar políticas com filtros e paginação
5. Excluir política (soft delete)
6. Transicionar política entre estados do workflow
7. Publicar política aprovada
8. Registrar aceite de política por usuário
9. Verificar conformidade automática por regras configuráveis
10. Criar exceção de conformidade temporária
11. Listar violações e exceções
12. Obter dashboard de compliance
13. Obter matriz de compliance
14. Buscar políticas por palavra-chave (full-text)
15. Exportar relatórios de compliance

---

## 5. REGRAS DE NEGÓCIO

### RN-RF079-01 — Versionamento Automático de Políticas

**Descrição**: Cada alteração em uma política em estado Elaboração ou Revisão incrementa automaticamente o número de versão e cria registro histórico imutável.

**Justificativa**: LGPD, SOX e ISO 27001 exigem rastreabilidade completa de políticas. Sem versionamento, é impossível provar qual versão um usuário aceitou.

**Critério de Aceite**:
- Alteração de título ou descrição → versão incrementada automaticamente
- Histórico completo registrado com dados antes/depois
- Versão congelada ao transicionar para estado Aprovada
- Usuário não pode editar histórico de versões

---

### RN-RF079-02 — Aceite Obrigatório de Políticas Publicadas

**Descrição**: Todo usuário deve aceitar explicitamente política publicada antes de poder continuar usando certas funcionalidades. Aceite é registrado com timestamp, IP e User-Agent.

**Justificativa**: LGPD, ISO 27001 e SOX exigem comprovação documentada de que usuário foi notificado e concordou com políticas.

**Critério de Aceite**:
- Usuário bloqueado em funcionalidade até aceitar política
- Aceite registrado com data, hora, IP, User-Agent
- Evento de auditoria gerado automaticamente
- Usuário não pode revogar aceite após registrado

---

### RN-RF079-03 — Workflow de Aprovação Multi-Nível

**Descrição**: Política segue estados obrigatórios (Elaboração → Revisão → Aprovada → Publicada). Cada transição de estado exige aprovador com perfil específico.

**Justificativa**: ISO 27001 e ITIL v4 exigem que políticas de segurança e operacionais sejam revisadas por especialista antes de publicação.

**Critério de Aceite**:
- Transições de estado validadas conforme workflow configurado
- Apenas usuário com permissão específica pode aprovar
- Histórico de aprovações registrado (quem, quando, comentário)
- Política não pode pular estados sem aprovação

---

### RN-RF079-04 — Matriz de Compliance (Políticas × Regulamentações)

**Descrição**: Cada política publicada deve estar mapeada a uma ou mais regulamentações (LGPD, SOX, ISO 27001, ISO 20000, ITIL v4). Este mapeamento permite demonstrar ao auditor externo que cada requisito regulatório está coberto.

**Justificativa**: Auditorias de compliance exigem rastreabilidade: "Qual política controla este requisito?"

**Critério de Aceite**:
- Matriz exibe políticas × regulamentações em formato tabular
- Cada mapeamento indica código do requisito (ex: LGPD-5.1, SOX-404)
- Status de conformidade visível (Em Conformidade, Não-conformista, Exceção)
- Matriz acessível para auditores externos via relatório

---

### RN-RF079-05 — Detecção Automática de Não-Conformidade

**Descrição**: Sistema periodicamente verifica conformidade com base em regras configuráveis. Se usuário/departamento não está em conformidade, gera alerta e registra em auditoria.

**Justificativa**: Conformidade manual é impossível com centenas de usuários e políticas. Verificação automática permite identificar violações rapidamente.

**Critério de Aceite**:
- Job executado diariamente verifica aceites e regras configuradas
- Violações detectadas geram alerta automático
- Notificação enviada ao usuário e gestor
- Registro de conformidade atualizado em tempo real

---

### RN-RF079-06 — Gestão de Exceções de Conformidade

**Descrição**: Permite aprovador autorizado conceder exceção temporária para usuário/departamento violar política por período definido.

**Justificativa**: Negócio precisa flexibilidade para exceções temporárias (ex: equipamento em reparo), mas com controle (aprovação, prazo, auditoria).

**Critério de Aceite**:
- Exceção criada apenas por aprovador autorizado
- Exceção tem data de expiração obrigatória
- Notificação automática enviada antes de expiração (7 dias)
- Após expiração, usuário volta ao status de não-conformidade

---

### RN-RF079-07 — Dashboard de Compliance em Tempo Real

**Descrição**: Painel visual mostrando taxa de conformidade geral (%), conformidade por política, por departamento, por usuário. Cores: verde (>90%), amarelo (70-90%), vermelho (<70%).

**Justificativa**: Gestores precisam visibilidade rápida para tomar decisões. Sem dashboard, compliance fica invisível até auditoria.

**Critério de Aceite**:
- Taxa de conformidade geral visível em destaque
- Filtros por política, departamento, usuário
- Violações recentes listadas (últimos 7 dias)
- Exceções próximas de expirar destacadas

---

### RN-RF079-08 — Notificações de Atualização e Violação

**Descrição**: Quando política é publicada ou violação detectada, sistema envia notificação (email, in-app, SMS opcional). Usuário recebe notificação com link para aceitar/remediar.

**Justificativa**: Usuário não lembra de políticas se não for lembrado. Email + in-app aumenta taxa de aceite e conformidade.

**Critério de Aceite**:
- Notificação enviada ao publicar política (todos os usuários)
- Notificação enviada ao detectar violação (usuário + gestor)
- Notificação enviada ao aproximar expiração de exceção (usuário)
- Link direto para ação (aceitar, remediar)

---

### RN-RF079-09 — Busca Full-Text em Políticas

**Descrição**: Usuários podem buscar políticas por palavra-chave usando sistema de busca otimizado. Busca é rápida, relevante, com facets por categoria.

**Justificativa**: Com centenas de políticas, busca convencional é lenta. Busca full-text permite encontrar políticas em menos de 200ms.

**Critério de Aceite**:
- Busca por palavra-chave retorna resultados ordenados por relevância
- Filtros por categoria (facets) disponíveis
- Performance < 200ms P95
- Tolerância a erros de digitação (fuzzy matching)

---

### RN-RF079-10 — Integração com Auditoria

**Descrição**: Todos os eventos de políticas e conformidade são registrados em tabela Auditoria com código de operação padronizado, usuário, timestamp, IP, dados antes/depois.

**Justificativa**: LGPD, SOX, ISO 27001 exigem que mudanças em políticas sejam auditáveis.

**Critério de Aceite**:
- Operações auditadas: POL_CRIAR, POL_ATUALIZAR, POL_PUBLICAR, POL_ACEITE, POL_VIOLACAO, POL_EXCECAO
- Registro inclui usuário, IP, timestamp, dados antes/depois
- Auditoria retida por 7 anos (conforme LGPD)
- Registros de auditoria são imutáveis (append-only)

---

### RN-RF079-11 — Isolamento Multi-Tenant

**Descrição**: Um usuário só pode acessar políticas e dados de conformidade do seu próprio tenant (ClienteId).

**Critério de Aceite**:
- Tentativa de acesso cruzado entre tenants → não permitido
- Query Filter automático aplicado em todas as operações
- Validação de tenant em todos os endpoints

---

### RN-RF079-12 — Permissões RBAC

**Descrição**: Cada operação exige permissão explícita baseada em roles.

| Operação | Permissão |
|----------|-----------|
| Criar política | compliance:politica:create |
| Visualizar políticas | compliance:politica:read |
| Editar política | compliance:politica:update |
| Excluir política | compliance:politica:delete |
| Publicar política | compliance:politica:publicar |
| Aceitar política | (todos os usuários autenticados) |
| Ver dashboard | compliance:dashboard:view |
| Criar exceção | compliance:excepcao:criar |
| Ver auditoria | compliance:auditoria:view |

---

## 6. ESTADOS DA ENTIDADE

### Estados de Política

| Estado | Descrição |
|--------|-----------|
| **Elaboração** | Criador edita livremente, versão pode ser incrementada |
| **Revisão** | Revisor(es) analisam, edição bloqueada para criador |
| **Aprovada** | Aprovador(es) validaram, versão congelada |
| **Publicada** | Usuários devem aceitar, não editável |
| **Obsoleta** | Política desativada, não exigível |

### Transições Permitidas

| De | Para | Requer Aprovação |
|----|------|------------------|
| Elaboração | Revisão | Não (autor pode enviar) |
| Revisão | Aprovada | Sim (revisor específico) |
| Aprovada | Publicada | Sim (aprovador específico) |
| Publicada | Obsoleta | Sim (compliance officer) |
| Revisão | Elaboração | Sim (rejeição pelo revisor) |

### Transições Proibidas

| De | Para | Motivo |
|----|------|--------|
| Elaboração | Publicada | Pula revisão e aprovação |
| Obsoleta | Publicada | Política obsoleta não pode voltar |
| Publicada | Elaboração | Políticas aceitas não podem ser editadas |

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre | Ações automáticas |
|--------|---------------|-------------------|
| `PoliticaCriada` | Após criação bem-sucedida | Registrar auditoria |
| `PoliticaAtualizada` | Após atualização com versionamento | Criar histórico de versão |
| `PoliticaPublicada` | Transição para status Publicada | Notificar todos os usuários, indexar para busca |
| `PoliticaAceita` | Usuário aceita política | Registrar auditoria, atualizar dashboard |
| `ViolacaoDetectada` | Verificação automática encontra não-conformidade | Notificar usuário e gestor, registrar auditoria |
| `ExcecaoAprovada` | Exceção de conformidade criada | Notificar usuário, registrar auditoria |
| `ExcecaoExpirada` | Data de expiração da exceção atingida | Notificar usuário, atualizar status de conformidade |

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- Nenhuma operação pode violar isolamento de tenant
- Nenhuma regra de negócio pode ser ignorada
- Erros devem ser previsíveis e rastreáveis
- Auditoria deve registrar quem, quando e o que mudou
- Performance de busca < 200ms P95
- Taxa de aceite de políticas > 95% em 30 dias
- Taxa de conformidade geral > 90%
- Dashboard atualizado em tempo real (< 5 segundos)
- Notificações enviadas em até 1 minuto após evento
- Histórico de versões completo e imutável

---

## 9. SEGURANÇA

- Validação de entrada obrigatória em todos os Commands
- Proteção contra SQL Injection (EF Core parametrizado)
- Proteção contra XSS (Angular sanitização automática)
- Controle de permissões RBAC em todos os endpoints
- Isolamento multi-tenant com Row-Level Security
- JWT Bearer Token obrigatório
- Soft delete (FlExcluido) para todas as exclusões
- Auditoria completa e imutável (append-only)
- HTTPS TLS 1.3 obrigatório
- Rate limiting (100 requests/min por usuário)
- Hash de versão para detectar alteração não autorizada

---

## 10. ARTEFATOS DERIVADOS

Este RF é base para:

- UC-RF079.md (Casos de Uso)
- MD-RF079.md (Modelo de Dados)
- WF-RF079.md (Workflows e Wireframes)
- TC-RF079.yaml (Casos de Teste)
- MT-RF079.yaml (Massas de Teste)

---

## 11. RASTREABILIDADE

| Artefato | Status | Gerado |
|----------|--------|--------|
| RF079.md | ✅ | Sim |
| RF079.yaml | ⏳ | Pendente |
| UC-RF079.md | ⏳ | Pendente |
| MD-RF079.md | ⏳ | Pendente |
| WF-RF079.md | ⏳ | Pendente |
| TC-RF079.yaml | ⏳ | Pendente |
| MT-RF079.yaml | ⏳ | Pendente |

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 2.0 | 2025-12-30 | Migração v1.0 → v2.0 (separação RF/RL completa, remoção de código e legado) | Agência ALC - alc.dev.br |
| 1.0 | 2025-12-28 | Versão inicial com 10 regras de negócio, 15 endpoints, fluxos e segurança | Claude Code |

---

**Última Atualização**: 2025-12-30
**Versão de Governança**: 2.0
**Autor**: Agência ALC - alc.dev.br
