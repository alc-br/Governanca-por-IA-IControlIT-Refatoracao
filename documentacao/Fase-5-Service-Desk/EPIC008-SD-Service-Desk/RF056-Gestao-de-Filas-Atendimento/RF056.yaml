# =============================================
# RF056 - Gestão de Filas de Atendimento
# Versão: 2.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br
# =============================================

rf:
  id: "RF056"
  nome: "Gestão de Filas de Atendimento"
  versao: "2.0"
  data: "2025-12-30"
  fase: "Fase-5-Service-Desk"
  epic: "EPIC008-SD-Service-Desk"
  status: "concluido"

descricao:
  objetivo: "Implementar sistema de gestão de filas inteligentes para distribuição automática de solicitações de Service Desk entre atendentes."
  problema_resolvido: "Distribuição manual de solicitações causava sobrecarga de atendentes, falta de balanceamento e SLAs não cumpridos."
  publico_afetado: "Atendentes de Service Desk, Supervisores, Gestores de TI, Solicitantes."

escopo:
  incluso:
    - "Criação e gestão de múltiplas filas por categoria de serviço"
    - "Distribuição automática de solicitações para atendentes qualificados"
    - "Priorização inteligente baseada em SLA, prioridade e tempo de espera"
    - "Balanceamento de carga entre atendentes"
    - "Gestão de disponibilidade de atendentes (status)"
    - "Escalação automática de solicitações não atendidas"
    - "Transferência manual entre atendentes"
    - "Métricas e KPIs em tempo real"
    - "Controle de acesso e isolamento por tenant"
    - "Auditoria completa de operações"
  fora:
    - "Interface visual específica (layout/UX)"
    - "Tecnologia, framework ou linguagem de implementação"
    - "Estratégia de deploy ou infraestrutura"
    - "Integração com telefonia ou chat"
    - "Pesquisa de satisfação do atendimento"

entidades:
  - nome: "Fila"
    descricao: "Conjunto ordenado de solicitações aguardando atendimento"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "Atendente"
    descricao: "Usuário responsável por resolver solicitações"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "Skill"
    descricao: "Competência técnica do atendente (categoria de atendimento)"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "Solicitacao"
    descricao: "Item de trabalho na fila de atendimento"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "TransferenciaSolicitacao"
    descricao: "Histórico de transferências entre atendentes"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "AtendenteHistoricoStatus"
    descricao: "Histórico de mudanças de status do atendente"
    multi_tenant: true
    soft_delete: false
    auditoria: true

regras_negocio:
  - id: "RN-RF056-001"
    titulo: "Priorização na Fila"
    descricao: "Solicitações na fila devem ser ordenadas por: (1) Prioridade, (2) % SLA consumido, (3) Tempo de espera"
    tipo: "regra_negocio"
    criticidade: "CRÍTICA"
    campos_afetados: ["Prioridade", "PercentualSLA", "DataAbertura"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: false
    obrigatorio: true

  - id: "RN-RF056-002"
    titulo: "Routing por Skills"
    descricao: "Solicitações só podem ser atribuídas a atendentes com skill adequada"
    tipo: "validacao"
    criticidade: "CRÍTICA"
    campos_afetados: ["AtendenteId", "Categoria"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "regra_negocio"
      mensagem_erro: "Atendente não possui skill necessária para esta categoria"
      http_code: 400
    obrigatorio: true

  - id: "RN-RF056-003"
    titulo: "Balanceamento de Carga"
    descricao: "Priorizar atendentes disponíveis com menor carga de trabalho"
    tipo: "regra_negocio"
    criticidade: "ALTA"
    campos_afetados: ["CargaAtual", "Status"]
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
    obrigatorio: true

  - id: "RN-RF056-004"
    titulo: "Escalação Automática"
    descricao: "Solicitações >30 min na fila devem ser escaladas automaticamente"
    tipo: "regra_negocio"
    criticidade: "ALTA"
    campos_afetados: ["DataAbertura", "Status"]
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
    obrigatorio: true

  - id: "RN-RF056-005"
    titulo: "Limite de Solicitações Simultâneas"
    descricao: "Cada atendente pode ter no máximo 5 solicitações abertas"
    tipo: "validacao"
    criticidade: "ALTA"
    campos_afetados: ["CargaAtual"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "range"
      mensagem_erro: "Atendente atingiu limite de 5 solicitações simultâneas"
      http_code: 400
    obrigatorio: true

  - id: "RN-RF056-006"
    titulo: "Status de Disponibilidade"
    descricao: "Atendentes podem alterar status entre DISPONÍVEL, PAUSA, AUSENTE"
    tipo: "regra_negocio"
    criticidade: "MÉDIA"
    campos_afetados: ["Status"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    obrigatorio: true

  - id: "RN-RF056-007"
    titulo: "Pausas Automáticas"
    descricao: "Marcar automaticamente atendentes como PAUSA em horários configurados"
    tipo: "regra_negocio"
    criticidade: "MÉDIA"
    campos_afetados: ["Status"]
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
    obrigatorio: false

  - id: "RN-RF056-008"
    titulo: "Redistribuição em Ausência"
    descricao: "Redistribuir solicitações quando atendente fica AUSENTE"
    tipo: "regra_negocio"
    criticidade: "ALTA"
    campos_afetados: ["Status", "AtendenteId"]
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
    obrigatorio: true

  - id: "RN-RF056-009"
    titulo: "Filas por Categoria"
    descricao: "Manter filas separadas por categoria de serviço"
    tipo: "regra_negocio"
    criticidade: "ALTA"
    campos_afetados: ["Categoria"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    obrigatorio: true

  - id: "RN-RF056-010"
    titulo: "Priorização de VIPs"
    descricao: "Solicitações de CEO/Diretores recebem prioridade CRÍTICA automaticamente"
    tipo: "regra_negocio"
    criticidade: "ALTA"
    campos_afetados: ["Prioridade", "VIP"]
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
    obrigatorio: true

  - id: "RN-RF056-011"
    titulo: "Transferência entre Atendentes"
    descricao: "Permitir transferência manual com validação de skill"
    tipo: "validacao"
    criticidade: "MÉDIA"
    campos_afetados: ["AtendenteId"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "regra_negocio"
      mensagem_erro: "Atendente destino não possui skill necessária"
      http_code: 400
    obrigatorio: true

  - id: "RN-RF056-012"
    titulo: "Métricas em Tempo Real"
    descricao: "Dashboard atualizado a cada 30s via SignalR"
    tipo: "regra_negocio"
    criticidade: "MÉDIA"
    campos_afetados: []
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: false
    obrigatorio: true

  - id: "RN-RF056-013"
    titulo: "Fila de Retorno (Follow-up)"
    descricao: "Solicitações reabertas retornam para atendente original se disponível"
    tipo: "regra_negocio"
    criticidade: "MÉDIA"
    campos_afetados: ["AtendenteId", "Status"]
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
    obrigatorio: false

  - id: "RN-RF056-014"
    titulo: "SLA Pausado em Pendência Externa"
    descricao: "Status AGUARDANDO_CLIENTE pausa contagem de SLA"
    tipo: "regra_negocio"
    criticidade: "ALTA"
    campos_afetados: ["Status", "SLA"]
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    obrigatorio: true

  - id: "RN-RF056-015"
    titulo: "Relatório de Produtividade"
    descricao: "Gerar relatório mensal consolidado por atendente"
    tipo: "regra_negocio"
    criticidade: "BAIXA"
    campos_afetados: []
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    obrigatorio: false

estados:
  solicitacao:
    - id: "AGUARDANDO_ATENDIMENTO"
      descricao: "Na fila, sem atendente atribuído"
    - id: "EM_ATENDIMENTO"
      descricao: "Atribuída a atendente, em resolução"
    - id: "AGUARDANDO_CLIENTE"
      descricao: "Pausada aguardando retorno do cliente"
    - id: "RESOLVIDA"
      descricao: "Solução aplicada, aguardando confirmação"
    - id: "FECHADA"
      descricao: "Confirmada pelo cliente, finalizada"
    - id: "CANCELADA"
      descricao: "Cancelada antes da resolução"

  atendente:
    - id: "DISPONIVEL"
      descricao: "Pode receber novas solicitações"
    - id: "OCUPADO"
      descricao: "Atingiu limite de carga (automático)"
    - id: "PAUSA"
      descricao: "Em pausa (manual ou automática)"
    - id: "AUSENTE"
      descricao: "Indisponível, solicitações redistribuídas"

transicoes:
  permitidas:
    solicitacao:
      - de: "AGUARDANDO_ATENDIMENTO"
        para: "EM_ATENDIMENTO"
      - de: "EM_ATENDIMENTO"
        para: "AGUARDANDO_CLIENTE"
      - de: "EM_ATENDIMENTO"
        para: "RESOLVIDA"
      - de: "AGUARDANDO_CLIENTE"
        para: "EM_ATENDIMENTO"
      - de: "RESOLVIDA"
        para: "FECHADA"
      - de: "RESOLVIDA"
        para: "EM_ATENDIMENTO"

    atendente:
      - de: "DISPONIVEL"
        para: "OCUPADO"
      - de: "DISPONIVEL"
        para: "PAUSA"
      - de: "DISPONIVEL"
        para: "AUSENTE"
      - de: "OCUPADO"
        para: "DISPONIVEL"
      - de: "PAUSA"
        para: "DISPONIVEL"
      - de: "AUSENTE"
        para: "DISPONIVEL"

  proibidas:
    solicitacao:
      - de: "FECHADA"
        para: "AGUARDANDO_ATENDIMENTO"
      - de: "CANCELADA"
        para: "EM_ATENDIMENTO"

permissoes:
  - codigo: "SD.FILAS.VIEW_ANY"
    descricao: "Visualizar todas as filas"
  - codigo: "SD.FILAS.VIEW"
    descricao: "Visualizar fila específica"
  - codigo: "SD.FILAS.MANAGE"
    descricao: "Gerenciar configuração de filas"
  - codigo: "SD.FILAS.TRANSFER"
    descricao: "Transferir solicitações entre atendentes"
  - codigo: "SD.FILAS.ESCALATE"
    descricao: "Escalar solicitações manualmente"
  - codigo: "SD.FILAS.METRICS"
    descricao: "Visualizar métricas e relatórios"
  - codigo: "SD.ATENDENTE.STATUS"
    descricao: "Alterar próprio status de disponibilidade"
  - codigo: "SD.ATENDENTE.MANAGE_STATUS"
    descricao: "Gerenciar status de outros atendentes (supervisor)"

integracoes:
  internas:
    - "Autenticacao (JWT)"
    - "Multi-Tenancy (EmpresaId)"
    - "Auditoria (AuditInterceptor)"
    - "RBAC (Permissões)"
    - "SignalR (Métricas em tempo real)"
    - "Hangfire (Jobs de escalação e pausas)"
  externas:
    - sistema: "Módulo de Solicitações (RF055)"
      tipo: "Domain Event"
      obrigatoria: true
    - sistema: "Módulo de Usuários (RF003)"
      tipo: "Query"
      obrigatoria: true

seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: true

rastreabilidade:
  ucs_esperados:
    - "UC00-Listar-Filas"
    - "UC01-Distribuir-Solicitacao"
    - "UC02-Alterar-Status-Atendente"
    - "UC03-Transferir-Solicitacao"
    - "UC04-Visualizar-Metricas"

catalog:
  crud:
    - id: "RF056-CRUD-01"
      title: "Visualizar filas de atendimento"
      required: true
    - id: "RF056-CRUD-02"
      title: "Atribuir solicitação automaticamente"
      required: true
    - id: "RF056-CRUD-03"
      title: "Alterar status de atendente"
      required: true
    - id: "RF056-CRUD-04"
      title: "Transferir solicitação entre atendentes"
      required: true
    - id: "RF056-CRUD-05"
      title: "Visualizar métricas em tempo real"
      required: true

  validacoes:
    - id: "RF056-VAL-01"
      title: "Validar skill do atendente para categoria"
      required: true
    - id: "RF056-VAL-02"
      title: "Validar limite de solicitações simultâneas"
      required: true
    - id: "RF056-VAL-03"
      title: "Validar transições de estado"
      required: true

  seguranca:
    - id: "RF056-SEC-01"
      title: "Isolamento de tenant"
      required: true
    - id: "RF056-SEC-02"
      title: "Permissões RBAC"
      required: true
    - id: "RF056-SEC-03"
      title: "Auditoria de operações críticas"
      required: true

exclusions:
  documentacao_items: []

historico:
  - versao: "2.0"
    data: "2025-12-30"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração v1.0 → v2.0 - Separação RF/RL completa"
  - versao: "1.0"
    data: "2025-01-14"
    autor: "Equipe IControlIT"
    descricao: "Versão inicial com 15 regras de negócio"
