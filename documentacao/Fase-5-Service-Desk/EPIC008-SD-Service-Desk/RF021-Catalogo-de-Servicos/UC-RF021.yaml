# =============================================
# UC-RF021 - Casos de Uso (Contrato Comportamental)
# Versão: 2.0
# Autor padrão: Agência ALC - alc.dev.br
# =============================================

uc:
  documentacao: "RF021"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Serviços do Catálogo"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RF021-CRUD-02"
        - "RF021-SEC-01"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade Catálogo de Serviços"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão SERVICO.CATALOGO.VIEW"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega serviços ativos do tenant"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação padrão (20 registros)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe lista com cards (nome, ícone, categoria, SLA, preço, avaliação, botão)"
          required: true
        - id: "FA-UC00-001"
          title: "Buscar serviço por nome (busca full-text)"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por categoria"
          required: false
        - id: "FA-UC00-003"
          title: "Ordenar por nome/SLA/preço/avaliação"
          required: false
        - id: "FA-UC00-004"
          title: "Visualizar como grid ou lista"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403 Acesso negado"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum serviço disponível → estado vazio"
          required: true
        - id: "FE-UC00-003"
          title: "Erro de conexão → mensagem de erro"
          required: true

    precondicoes:
      - permissao: "SERVICO.CATALOGO.VIEW"

    gatilho: "Usuario acessa Catálogo de Serviços pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu_catalogo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_servicos_ativos_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_lista_cards"

    fluxos_alternativos:
      - id: "FA-UC00-001"
        condicao: "usuario_busca_servico"
        resultado: "lista_filtrada_busca"
      - id: "FA-UC00-002"
        condicao: "usuario_filtra_categoria"
        resultado: "lista_filtrada_categoria"
      - id: "FA-UC00-003"
        condicao: "usuario_ordena_lista"
        resultado: "lista_ordenada"

    fluxos_excecao:
      - id: "FE-UC00-001"
        condicao: "sem_permissao"
        resultado: "acesso_negado_403"
      - id: "FE-UC00-002"
        condicao: "lista_vazia"
        resultado: "estado_vazio_exibido"

    regras_aplicadas:
      - "RN-RF021-SEC-01"

    resultado_final:
      estado: "lista_servicos_exibida"

  - id: "UC01"
    nome: "Criar Serviço no Catálogo"
    ator_principal: "administrador"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-01"
        - "RF021-VAL-01"
        - "RF021-SEC-02"
        - "RF021-SEC-03"
      uc_items:
        - id: "FP-UC01-001"
          title: "Administrador clica em Novo Serviço"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão SERVICO.CATALOGO.MANAGE"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário de criação"
          required: true
        - id: "FP-UC01-004"
          title: "Administrador preenche campos obrigatórios"
          required: true
        - id: "FP-UC01-005"
          title: "Administrador define flags (Requer Aprovação, Verifica Estoque, etc)"
          required: true
        - id: "FP-UC01-006"
          title: "Administrador define formulário dinâmico (JSON Schema) - opcional"
          required: false
        - id: "FP-UC01-007"
          title: "Administrador define workflow de aprovação (níveis 1-4) - opcional"
          required: false
        - id: "FP-UC01-008"
          title: "Sistema valida dados (campos obrigatórios, JSON Schema válido)"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema cria registro com tenant_id automático"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema registra auditoria (created_by, created_at)"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar como rascunho (Ativo = 0)"
          required: false
        - id: "FA-UC01-002"
          title: "Copiar de template existente"
          required: false
        - id: "FA-UC01-003"
          title: "Upload de ícone customizado"
          required: false
        - id: "FE-UC01-001"
          title: "Nome duplicado → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "JSON Schema inválido → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "SLA < 1 hora → HTTP 400"
          required: true
        - id: "FE-UC01-004"
          title: "Categoria inexistente → HTTP 400"
          required: true

    precondicoes:
      - permissao: "SERVICO.CATALOGO.MANAGE"

    gatilho: "Administrador clica em Novo Serviço"

    fluxo_principal:
      - passo: 1
        ator: "administrador"
        acao: "clicar_novo_servico"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "administrador"
        acao: "preencher_campos"
      - passo: 5
        ator: "sistema"
        acao: "validar_dados"
      - passo: 6
        ator: "sistema"
        acao: "criar_registro"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_excecao:
      - id: "FE-UC01-001"
        condicao: "nome_duplicado"
        resultado: "http_400_nome_duplicado"
      - id: "FE-UC01-002"
        condicao: "json_schema_invalido"
        resultado: "http_400_formulario_invalido"

    regras_aplicadas:
      - "RN-RF021-VAL-01"
      - "RN-RF021-SEC-02"
      - "RN-RF021-SEC-03"

    resultado_final:
      estado: "servico_criado"

  - id: "UC02"
    nome: "Visualizar Detalhes do Serviço"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RF021-CRUD-03"
        - "RF021-SEC-01"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário clica em um serviço no catálogo"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão SERVICO.CATALOGO.VIEW"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida que serviço pertence ao tenant do usuário"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema exibe detalhes completos (nome, descrição, categoria, SLA, preço, formulário, avaliações)"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe botão Adicionar ao Carrinho"
          required: true
        - id: "FA-UC02-001"
          title: "Ver avaliações de outros usuários (top 10)"
          required: false
        - id: "FA-UC02-002"
          title: "Ver minhas solicitações anteriores deste serviço"
          required: false
        - id: "FA-UC02-003"
          title: "Adicionar aos favoritos"
          required: false
        - id: "FE-UC02-001"
          title: "Serviço não existe → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Serviço inativo → HTTP 404"
          required: true
        - id: "FE-UC02-003"
          title: "Serviço de outro tenant → HTTP 404"
          required: true

    precondicoes:
      - permissao: "SERVICO.CATALOGO.VIEW"

    gatilho: "Usuario clica em servico no catalogo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_servico"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "exibir_detalhes"

    fluxos_excecao:
      - id: "FE-UC02-001"
        condicao: "servico_nao_existe"
        resultado: "http_404"
      - id: "FE-UC02-002"
        condicao: "servico_inativo"
        resultado: "http_404"
      - id: "FE-UC02-003"
        condicao: "servico_outro_tenant"
        resultado: "http_404"

    regras_aplicadas:
      - "RN-RF021-SEC-01"

    resultado_final:
      estado: "detalhes_exibidos"

  - id: "UC03"
    nome: "Editar Serviço no Catálogo"
    ator_principal: "administrador"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-04"
        - "RF021-SEC-02"
        - "RF021-SEC-03"
      uc_items:
        - id: "FP-UC03-001"
          title: "Administrador clica em Editar no serviço"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão SERVICO.CATALOGO.MANAGE"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema carrega dados atuais do serviço"
          required: true
        - id: "FP-UC03-004"
          title: "Administrador altera dados"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema persiste alterações"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema registra auditoria (updated_by, updated_at)"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema notifica usuários com solicitações pendentes (se aplicável)"
          required: false
        - id: "FA-UC03-001"
          title: "Editar apenas metadados (nome, descrição)"
          required: false
        - id: "FA-UC03-002"
          title: "Alterar formulário customizado (JSON Schema)"
          required: false
        - id: "FA-UC03-003"
          title: "Alterar workflow de aprovação"
          required: false
        - id: "FE-UC03-001"
          title: "Nome duplicado → HTTP 400"
          required: true
        - id: "FE-UC03-002"
          title: "JSON Schema inválido → HTTP 400"
          required: true
        - id: "FE-UC03-003"
          title: "SLA < 1 hora → HTTP 400"
          required: true
        - id: "FE-UC03-004"
          title: "Serviço tem solicitações em atendimento → warning"
          required: false

    precondicoes:
      - permissao: "SERVICO.CATALOGO.MANAGE"

    gatilho: "Administrador clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "administrador"
        acao: "clicar_editar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 4
        ator: "administrador"
        acao: "alterar_campos"
      - passo: 5
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 6
        ator: "sistema"
        acao: "persistir"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_excecao:
      - id: "FE-UC03-001"
        condicao: "nome_duplicado"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF021-SEC-02"
      - "RN-RF021-SEC-03"

    resultado_final:
      estado: "servico_atualizado"

  - id: "UC04"
    nome: "Inativar Serviço no Catálogo"
    ator_principal: "administrador"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-05"
        - "RF021-SEC-02"
        - "RF021-SEC-03"
      uc_items:
        - id: "FP-UC04-001"
          title: "Administrador clica em Inativar no serviço"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema exibe modal de confirmação"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida permissão SERVICO.CATALOGO.MANAGE"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema verifica se existem solicitações pendentes"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema marca Ativo = 0"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC04-001"
          title: "Reativar serviço inativo"
          required: false
        - id: "FA-UC04-002"
          title: "Agendar inativação futura"
          required: false
        - id: "FE-UC04-001"
          title: "Solicitações pendentes/em atendimento existem → HTTP 400"
          required: true
        - id: "FE-UC04-002"
          title: "Serviço já inativo → HTTP 400"
          required: true
        - id: "FE-UC04-003"
          title: "Serviço de outro tenant → HTTP 404"
          required: true

    precondicoes:
      - permissao: "SERVICO.CATALOGO.MANAGE"

    gatilho: "Administrador clica em Inativar"

    fluxo_principal:
      - passo: 1
        ator: "administrador"
        acao: "clicar_inativar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_confirmacao"
      - passo: 3
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 4
        ator: "sistema"
        acao: "verificar_solicitacoes_pendentes"
      - passo: 5
        ator: "sistema"
        acao: "marcar_inativo"
      - passo: 6
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_excecao:
      - id: "FE-UC04-001"
        condicao: "solicitacoes_ativas"
        resultado: "http_400_bloqueio"

    regras_aplicadas:
      - "RN-RF021-SEC-02"
      - "RN-RF021-SEC-03"

    resultado_final:
      estado: "servico_inativo"

  - id: "UC05"
    nome: "Adicionar Serviço ao Carrinho"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-06"
      uc_items:
        - id: "FP-UC05-001"
          title: "Usuário clica em Adicionar ao Carrinho"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema valida permissão SERVICO.SOLICITAR"
          required: true
        - id: "FP-UC05-003"
          title: "Sistema valida que serviço está ativo"
          required: true
        - id: "FP-UC05-004"
          title: "Sistema verifica limite de 10 serviços por carrinho"
          required: true
        - id: "FP-UC05-005"
          title: "Sistema adiciona item à tabela Servico_Carrinho"
          required: true
        - id: "FP-UC05-006"
          title: "Sistema confirma adição com badge no ícone do carrinho"
          required: true
        - id: "FA-UC05-001"
          title: "Remover item do carrinho"
          required: false
        - id: "FA-UC05-002"
          title: "Limpar carrinho inteiro"
          required: false
        - id: "FA-UC05-003"
          title: "Visualizar carrinho sem finalizar"
          required: false
        - id: "FE-UC05-001"
          title: "Limite de 10 serviços atingido → HTTP 400"
          required: true
        - id: "FE-UC05-002"
          title: "Serviço inativo → HTTP 400"
          required: true
        - id: "FE-UC05-003"
          title: "Serviço já está no carrinho → mensagem informativa"
          required: false

    precondicoes:
      - permissao: "SERVICO.SOLICITAR"

    gatilho: "Usuario clica em Adicionar ao Carrinho"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_adicionar_carrinho"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_servico_ativo"
      - passo: 4
        ator: "sistema"
        acao: "verificar_limite_carrinho"
      - passo: 5
        ator: "sistema"
        acao: "adicionar_item_carrinho"
      - passo: 6
        ator: "sistema"
        acao: "atualizar_badge"

    fluxos_excecao:
      - id: "FE-UC05-001"
        condicao: "carrinho_cheio"
        resultado: "http_400_limite_atingido"
      - id: "FE-UC05-002"
        condicao: "servico_inativo"
        resultado: "http_400_indisponivel"

    regras_aplicadas:
      - "RN-RF021-003"

    resultado_final:
      estado: "item_adicionado_carrinho"

  - id: "UC06"
    nome: "Finalizar Solicitação (Converter Carrinho)"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-07"
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário clica em Finalizar Solicitação"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC06-003"
          title: "Sistema valida limite de solicitações simultâneas (5 para usuário, 20 para gestor)"
          required: true
        - id: "FP-UC06-004"
          title: "Sistema exibe formulário de finalização"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema gera número único SRV-YYYY-NNNNN"
          required: true
        - id: "FP-UC06-006"
          title: "Sistema cria registro em Servico_Solicitacao com status Pendente"
          required: true
        - id: "FP-UC06-007"
          title: "Sistema limpa carrinho"
          required: true
        - id: "FP-UC06-008"
          title: "Sistema inicia workflow de aprovação (se Fl_Requer_Aprovacao = 1)"
          required: false
        - id: "FP-UC06-009"
          title: "Sistema envia notificação para solicitante e aprovador nível 1"
          required: true
        - id: "FP-UC06-010"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC06-011"
          title: "Sistema confirma sucesso e exibe número da solicitação"
          required: true
        - id: "FA-UC06-001"
          title: "Solicitação para outro usuário (beneficiário diferente)"
          required: false
        - id: "FA-UC06-002"
          title: "Auto-aprovação por regras (colaborador veterano, valor baixo, serviço não-crítico)"
          required: false
        - id: "FE-UC06-001"
          title: "Carrinho vazio → HTTP 400"
          required: true
        - id: "FE-UC06-002"
          title: "Limite de solicitações simultâneas atingido → HTTP 400"
          required: true
        - id: "FE-UC06-003"
          title: "Justificativa obrigatória não fornecida → HTTP 400"
          required: true
        - id: "FE-UC06-004"
          title: "Beneficiário inválido → HTTP 400"
          required: true

    precondicoes:
      - permissao: "SERVICO.SOLICITAR"

    gatilho: "Usuario clica em Finalizar Solicitacao"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_finalizar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_limite_simultaneas"
      - passo: 4
        ator: "sistema"
        acao: "exibir_formulario_finalizacao"
      - passo: 5
        ator: "usuario"
        acao: "preencher_formulario"
      - passo: 6
        ator: "sistema"
        acao: "gerar_numero_solicitacao"
      - passo: 7
        ator: "sistema"
        acao: "criar_solicitacao"
      - passo: 8
        ator: "sistema"
        acao: "limpar_carrinho"
      - passo: 9
        ator: "sistema"
        acao: "iniciar_workflow"
      - passo: 10
        ator: "sistema"
        acao: "enviar_notificacoes"

    fluxos_excecao:
      - id: "FE-UC06-001"
        condicao: "carrinho_vazio"
        resultado: "http_400"
      - id: "FE-UC06-002"
        condicao: "limite_atingido"
        resultado: "http_400_limite"

    regras_aplicadas:
      - "RN-RF021-002"
      - "RN-RF021-008"
      - "RN-RF021-010"
      - "RN-RF021-012"
      - "RN-RF021-013"

    resultado_final:
      estado: "solicitacao_criada"

  - id: "UC07"
    nome: "Aprovar Solicitação (Workflow)"
    ator_principal: "aprovador"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-08"
      uc_items:
        - id: "FP-UC07-001"
          title: "Aprovador acessa Minhas Aprovações Pendentes"
          required: true
        - id: "FP-UC07-002"
          title: "Sistema lista solicitações onde aprovador é responsável pelo nível atual"
          required: true
        - id: "FP-UC07-003"
          title: "Aprovador clica em uma solicitação"
          required: true
        - id: "FP-UC07-004"
          title: "Sistema exibe detalhes (serviço, solicitante, beneficiário, justificativa, níveis anteriores)"
          required: true
        - id: "FP-UC07-005"
          title: "Aprovador clica em Aprovar ou Rejeitar"
          required: true
        - id: "FP-UC07-006"
          title: "Se rejeitar, sistema solicita motivo obrigatório (mínimo 20 caracteres)"
          required: true
        - id: "FP-UC07-007"
          title: "Sistema registra aprovação/rejeição em Servico_Aprovacao"
          required: true
        - id: "FP-UC07-008"
          title: "Se aprovado: avança para próximo nível ou marca como Aprovada"
          required: true
        - id: "FP-UC07-009"
          title: "Se rejeitado: marca solicitação como Rejeitada e notifica solicitante"
          required: true
        - id: "FP-UC07-010"
          title: "Sistema envia notificações"
          required: true
        - id: "FP-UC07-011"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC07-001"
          title: "Auto-aprovação por regras (sistema aprova automaticamente)"
          required: false
        - id: "FA-UC07-002"
          title: "Verificação de estoque antes de aprovar (Fl_Verifica_Estoque = 1)"
          required: false
        - id: "FE-UC07-001"
          title: "Solicitação já aprovada/rejeitada → HTTP 400"
          required: true
        - id: "FE-UC07-002"
          title: "Usuário não é aprovador deste nível → HTTP 403"
          required: true
        - id: "FE-UC07-003"
          title: "Motivo de rejeição < 20 caracteres → HTTP 400"
          required: true
        - id: "FE-UC07-004"
          title: "Estoque indisponível → warning"
          required: false

    precondicoes:
      - permissao: "SERVICO.APROVAR"

    gatilho: "Aprovador acessa aprovacoes pendentes"

    fluxo_principal:
      - passo: 1
        ator: "aprovador"
        acao: "acessar_minhas_aprovacoes"
      - passo: 2
        ator: "sistema"
        acao: "listar_solicitacoes_nivel_atual"
      - passo: 3
        ator: "aprovador"
        acao: "clicar_solicitacao"
      - passo: 4
        ator: "sistema"
        acao: "exibir_detalhes"
      - passo: 5
        ator: "aprovador"
        acao: "aprovar_ou_rejeitar"
      - passo: 6
        ator: "sistema"
        acao: "registrar_decisao"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_status"
      - passo: 8
        ator: "sistema"
        acao: "enviar_notificacoes"

    fluxos_excecao:
      - id: "FE-UC07-001"
        condicao: "solicitacao_ja_processada"
        resultado: "http_400"
      - id: "FE-UC07-002"
        condicao: "nao_e_aprovador_nivel"
        resultado: "http_403"

    regras_aplicadas:
      - "RN-RF021-001"
      - "RN-RF021-004"
      - "RN-RF021-008"

    resultado_final:
      estado: "aprovacao_registrada"

  - id: "UC08"
    nome: "Atender Solicitação (Provisionamento)"
    ator_principal: "atendente"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-09"
      uc_items:
        - id: "FP-UC08-001"
          title: "Atendente acessa Fila de Atendimento"
          required: true
        - id: "FP-UC08-002"
          title: "Sistema lista solicitações com status Aprovada"
          required: true
        - id: "FP-UC08-003"
          title: "Atendente atribui solicitação a si e atualiza status para Em_Atendimento"
          required: true
        - id: "FP-UC08-004"
          title: "Sistema registra Dt_Inicio_Atendimento"
          required: true
        - id: "FP-UC08-005"
          title: "Atendente executa provisionamento (manual ou automático via API)"
          required: true
        - id: "FP-UC08-006"
          title: "Se Fl_Provisiona_Automatico = 1, sistema chama API do fornecedor"
          required: false
        - id: "FP-UC08-007"
          title: "Atendente registra evidências (fotos, logs)"
          required: true
        - id: "FP-UC08-008"
          title: "Atendente marca como Concluida"
          required: true
        - id: "FP-UC08-009"
          title: "Sistema registra Dt_Conclusao"
          required: true
        - id: "FP-UC08-010"
          title: "Sistema finaliza SLA"
          required: true
        - id: "FP-UC08-011"
          title: "Sistema envia notificação para solicitante solicitando avaliação"
          required: true
        - id: "FP-UC08-012"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC08-001"
          title: "Provisionamento automático via API (Vivo, Claro, TIM, Dell, HP, AWS, Azure)"
          required: false
        - id: "FA-UC08-002"
          title: "Solicitação aguarda estoque (status Aguardando_Estoque)"
          required: false
        - id: "FA-UC08-003"
          title: "Solicitação aguarda ação do usuário (status Aguardando_Usuario)"
          required: false
        - id: "FA-UC08-004"
          title: "Provisionamento parcial (múltiplas etapas)"
          required: false
        - id: "FE-UC08-001"
          title: "Erro de provisionamento → status Erro_Provisionamento"
          required: true
        - id: "FE-UC08-002"
          title: "Timeout da API do fornecedor → HTTP 500"
          required: true
        - id: "FE-UC08-003"
          title: "Estoque indisponível → status Aguardando_Estoque (máximo 15 dias)"
          required: true
        - id: "FE-UC08-004"
          title: "SLA vencido → alerta para atendente e gestor"
          required: true

    precondicoes:
      - permissao: "SERVICO.ATENDER"

    gatilho: "Atendente acessa fila de atendimento"

    fluxo_principal:
      - passo: 1
        ator: "atendente"
        acao: "acessar_fila"
      - passo: 2
        ator: "sistema"
        acao: "listar_solicitacoes_aprovadas"
      - passo: 3
        ator: "atendente"
        acao: "atribuir_a_si"
      - passo: 4
        ator: "sistema"
        acao: "atualizar_status_em_atendimento"
      - passo: 5
        ator: "atendente"
        acao: "executar_provisionamento"
      - passo: 6
        ator: "atendente"
        acao: "registrar_evidencias"
      - passo: 7
        ator: "atendente"
        acao: "marcar_concluida"
      - passo: 8
        ator: "sistema"
        acao: "finalizar_sla"
      - passo: 9
        ator: "sistema"
        acao: "notificar_solicitante"

    fluxos_excecao:
      - id: "FE-UC08-001"
        condicao: "erro_provisionamento"
        resultado: "status_erro_provisionamento"
      - id: "FE-UC08-003"
        condicao: "estoque_indisponivel"
        resultado: "status_aguardando_estoque"
      - id: "FE-UC08-004"
        condicao: "sla_vencido"
        resultado: "alerta_enviado"

    regras_aplicadas:
      - "RN-RF021-004"
      - "RN-RF021-005"
      - "RN-RF021-007"
      - "RN-RF021-014"

    resultado_final:
      estado: "solicitacao_concluida"

  - id: "UC09"
    nome: "Cancelar Solicitação"
    ator_principal: "usuario_ou_aprovador"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-10"
      uc_items:
        - id: "FP-UC09-001"
          title: "Usuário/Aprovador clica em Cancelar Solicitação"
          required: true
        - id: "FP-UC09-002"
          title: "Sistema exibe modal solicitando justificativa obrigatória (mínimo 20 caracteres)"
          required: true
        - id: "FP-UC09-003"
          title: "Sistema valida permissão e restrições de cancelamento"
          required: true
        - id: "FP-UC09-004"
          title: "Sistema atualiza Status = Cancelada"
          required: true
        - id: "FP-UC09-005"
          title: "Sistema registra Dt_Cancelamento, Id_Usuario_Cancelamento, Motivo_Cancelamento"
          required: true
        - id: "FP-UC09-006"
          title: "Sistema libera reserva de estoque (se Fl_Verifica_Estoque = 1)"
          required: false
        - id: "FP-UC09-007"
          title: "Sistema envia notificação para todos os envolvidos"
          required: true
        - id: "FP-UC09-008"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC09-001"
          title: "Cancelamento em lote (múltiplas solicitações)"
          required: false
        - id: "FA-UC09-002"
          title: "Cancelamento automático por timeout (15 dias aguardando estoque)"
          required: false
        - id: "FE-UC09-001"
          title: "Solicitação já Em_Atendimento e usuário não é aprovador → HTTP 403"
          required: true
        - id: "FE-UC09-002"
          title: "Solicitação já concluída/cancelada/rejeitada → HTTP 400"
          required: true
        - id: "FE-UC09-003"
          title: "Justificativa < 20 caracteres → HTTP 400"
          required: true
        - id: "FE-UC09-004"
          title: "Usuário tentando cancelar solicitação de outro → HTTP 403"
          required: true

    precondicoes:
      - permissao: "SERVICO.SOLICITAR ou SERVICO.CANCELAR_FORCADO"

    gatilho: "Usuario ou aprovador clica em Cancelar"

    fluxo_principal:
      - passo: 1
        ator: "usuario_ou_aprovador"
        acao: "clicar_cancelar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_modal_justificativa"
      - passo: 3
        ator: "usuario_ou_aprovador"
        acao: "informar_justificativa"
      - passo: 4
        ator: "sistema"
        acao: "validar_permissoes"
      - passo: 5
        ator: "sistema"
        acao: "atualizar_status_cancelada"
      - passo: 6
        ator: "sistema"
        acao: "liberar_estoque"
      - passo: 7
        ator: "sistema"
        acao: "notificar_envolvidos"

    fluxos_excecao:
      - id: "FE-UC09-001"
        condicao: "em_atendimento_sem_permissao"
        resultado: "http_403"
      - id: "FE-UC09-002"
        condicao: "solicitacao_finalizada"
        resultado: "http_400"
      - id: "FE-UC09-003"
        condicao: "justificativa_curta"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF021-004"
      - "RN-RF021-011"
      - "RN-RF021-014"

    resultado_final:
      estado: "solicitacao_cancelada"

  - id: "UC10"
    nome: "Avaliar Serviço"
    ator_principal: "solicitante"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF021-CRUD-11"
      uc_items:
        - id: "FP-UC10-001"
          title: "Solicitação concluída → sistema envia push notification Avalie o serviço"
          required: true
        - id: "FP-UC10-002"
          title: "Usuário clica e sistema exibe modal de avaliação"
          required: true
        - id: "FP-UC10-003"
          title: "Usuário seleciona estrelas (1-5) e adiciona comentário opcional (0-500 caracteres)"
          required: true
        - id: "FP-UC10-004"
          title: "Sistema valida avaliação"
          required: true
        - id: "FP-UC10-005"
          title: "Sistema registra avaliação em Servico_Avaliacao"
          required: true
        - id: "FP-UC10-006"
          title: "Sistema recalcula Avaliacao_Media do serviço"
          required: true
        - id: "FP-UC10-007"
          title: "Sistema notifica atendente e gestor do catálogo"
          required: true
        - id: "FP-UC10-008"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC10-009"
          title: "Se avaliação < 3.0, sistema gera ticket de melhoria automático"
          required: false
        - id: "FA-UC10-001"
          title: "Avaliar depois - sistema envia lembrete após 3 dias"
          required: false
        - id: "FA-UC10-002"
          title: "Editar avaliação (permitido uma única vez)"
          required: false
        - id: "FA-UC10-003"
          title: "Atendente responde avaliação"
          required: false
        - id: "FE-UC10-001"
          title: "Usuário não é o solicitante → HTTP 403"
          required: true
        - id: "FE-UC10-002"
          title: "Solicitação não concluída → HTTP 400"
          required: true
        - id: "FE-UC10-003"
          title: "Comentário > 500 caracteres → HTTP 400"
          required: true

    precondicoes:
      - permissao: "autenticado"

    gatilho: "Solicitacao concluida"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "enviar_push_notification"
      - passo: 2
        ator: "usuario"
        acao: "clicar_avaliar"
      - passo: 3
        ator: "sistema"
        acao: "exibir_modal_avaliacao"
      - passo: 4
        ator: "usuario"
        acao: "selecionar_estrelas_comentario"
      - passo: 5
        ator: "sistema"
        acao: "validar_avaliacao"
      - passo: 6
        ator: "sistema"
        acao: "registrar_avaliacao"
      - passo: 7
        ator: "sistema"
        acao: "recalcular_media"
      - passo: 8
        ator: "sistema"
        acao: "notificar_atendente_gestor"

    fluxos_excecao:
      - id: "FE-UC10-001"
        condicao: "nao_e_solicitante"
        resultado: "http_403"
      - id: "FE-UC10-002"
        condicao: "solicitacao_nao_concluida"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF021-009"

    resultado_final:
      estado: "avaliacao_registrada"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica orientada a contrato - 11 UCs cobrindo 100% do RF021"
  - versao: "1.0"
    data: "2025-12-17"
    autor: "Sistema"
    descricao: "Consolidação inicial de 8 casos de uso (incompleto)"
