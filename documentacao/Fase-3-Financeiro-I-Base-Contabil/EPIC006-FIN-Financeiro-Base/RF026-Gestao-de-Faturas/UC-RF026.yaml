# =============================================
# UC-RF026 - Casos de Uso: Gestão Completa de Faturas de Telecom e TI
# Versão: 1.0
# Data: 2025-12-31
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  documentacao: "RF026"
  versao: "1.0"
  data: "2025-12-31"

observacao_sistema: |
  RF-026 é um sistema complexo de gestão de faturas com workflow multi-etapa:
  - Importação multi-layout (CSV, XLS, XLSX, TXT, PDF com OCR)
  - Conciliação automática com algoritmo fuzzy matching
  - Auditoria pré-pagamento com 25+ regras configuráveis
  - Workflow de contestação formal (7 etapas)
  - Rateio multi-dimensional (5 dimensões, 5 tipos)
  - Aprovação multi-nível com assinatura digital DocuSign
  - Dashboard executivo com 10+ KPIs em tempo real
  - Alertas preditivos ML (Random Forest) de estouro de budget
  - Integração com APIs operadoras (Vivo, Claro, TIM)
  - App mobile MAUI com biometria e offline mode

  Estados possíveis:
  - rascunho, aguardando_conciliacao, aguardando_auditoria,
    aguardando_aprovacao, aprovada, paga, contestada, cancelada

casos_de_uso:

  - id: "UC00"
    nome: "Listar Faturas"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RN-RF026-011"  # Multi-tenancy obrigatório
        - "RN-RF026-012"  # Soft delete
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa funcionalidade"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão faturas.view_any"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega faturas do tenant com paginação cursor-based"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema exibe lista com status coloridos"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por período (data emissão)"
          required: true
        - id: "FA-UC00-002"
          title: "Filtrar por operadora (Vivo, Claro, TIM)"
          required: true
        - id: "FA-UC00-003"
          title: "Filtrar por status"
          required: true
        - id: "FA-UC00-004"
          title: "Buscar por número fatura ou CNPJ"
          required: true
        - id: "FA-UC00-005"
          title: "Ordenar por coluna (data, valor, status)"
          required: false
        - id: "FA-UC00-006"
          title: "Exportar lista para Excel"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhuma fatura encontrada → estado vazio"
          required: true

    precondicoes:
      - permissao: "faturas.view_any"
      - usuario_autenticado: true

    gatilho: "Usuário acessa 'Faturas' pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu_faturas"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.view_any"
      - passo: 3
        ator: "sistema"
        acao: "listar_faturas_tenant"
        filtro: "ClienteId = current_user.ClienteId AND FlExcluido = 0"
      - passo: 4
        ator: "sistema"
        acao: "exibir_lista_paginada"
        campos: ["Numero", "Operadora", "DataEmissao", "Vencimento", "ValorTotal", "Status", "Acoes"]

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_filtra_por_periodo"
        passos:
          - "Usuário seleciona período (data início/fim)"
          - "Sistema filtra WHERE DataEmissao BETWEEN @inicio AND @fim"
          - "Sistema exibe lista filtrada"
        resultado: "lista_filtrada_periodo"

      - id: "FA-UC00-02"
        condicao: "usuario_filtra_por_operadora"
        passos:
          - "Usuário seleciona operadora(s) (multiselect)"
          - "Sistema filtra WHERE Operadora IN (...)"
          - "Sistema exibe lista filtrada"
        resultado: "lista_filtrada_operadora"

      - id: "FA-UC00-03"
        condicao: "usuario_filtra_por_status"
        passos:
          - "Usuário seleciona status (rascunho, aprovada, paga, etc.)"
          - "Sistema filtra WHERE Status = @status"
          - "Sistema exibe lista filtrada"
        resultado: "lista_filtrada_status"

      - id: "FA-UC00-04"
        condicao: "usuario_busca_por_numero_cnpj"
        passos:
          - "Usuário digita termo no campo de busca"
          - "Sistema filtra WHERE Numero LIKE '%termo%' OR CNPJ LIKE '%termo%'"
          - "Sistema exibe resultados em tempo real (debounce 300ms)"
        resultado: "busca_textual"

      - id: "FA-UC00-05"
        condicao: "usuario_ordena_coluna"
        passos:
          - "Usuário clica em cabeçalho de coluna"
          - "Sistema reordena ASC/DESC"
          - "Sistema exibe lista ordenada"
        resultado: "lista_ordenada"

      - id: "FA-UC00-06"
        condicao: "usuario_exporta_lista"
        passos:
          - "Usuário clica em 'Exportar para Excel'"
          - "Sistema gera arquivo .xlsx com filtros aplicados"
          - "Sistema inicia download"
        resultado: "lista_exportada"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        passos:
          - "Sistema verifica que usuário não possui faturas.view_any"
          - "Sistema retorna HTTP 403 Forbidden"
          - "Sistema exibe mensagem 'Acesso negado.'"
        resultado: "acesso_negado"

      - id: "FE-UC00-02"
        condicao: "nenhuma_fatura_encontrada"
        passos:
          - "Sistema busca faturas com filtros aplicados"
          - "Sistema não encontra registros"
          - "Sistema exibe mensagem 'Nenhuma fatura encontrada para os filtros aplicados.'"
          - "Sistema sugere 'Importar nova fatura'"
        resultado: "lista_vazia"

    regras_aplicadas:
      - "RN-RF026-011"
      - "RN-RF026-012"

    resultado_final:
      estado: "lista_faturas_exibida"


  - id: "UC01"
    nome: "Importar Fatura"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RN-RF026-001"  # Importação multi-layout
        - "RN-RF026-002"  # OCR de PDF
        - "RN-RF026-011"  # Multi-tenancy
        - "RN-RF026-012"  # Soft delete
        - "RN-RF026-015"  # Validação condicional por status
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário solicita importação"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão faturas.create"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário upload + seleção template"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário seleciona arquivo + template layout"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema processa arquivo (CSV/XLS/XLSX/TXT → parser, PDF → OCR)"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema exibe preview dados extraídos"
          required: true
        - id: "FP-UC01-007"
          title: "Usuário confirma ou corrige dados"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema cria fatura em status Rascunho"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema armazena PDF original em Azure Blob"
          required: true
        - id: "FA-UC01-001"
          title: "OCR de PDF com confidence score ≥ 85%"
          required: true
        - id: "FA-UC01-002"
          title: "OCR de PDF com confidence score < 85% → revisão manual"
          required: true
        - id: "FA-UC01-003"
          title: "Builder visual drag-and-drop para template customizado"
          required: false
        - id: "FE-UC01-001"
          title: "Template não encontrado → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "Arquivo corrompido → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "OCR falhou completamente → fallback entrada manual"
          required: true

    precondicoes:
      - permissao: "faturas.create"
      - usuario_autenticado: true

    gatilho: "Usuário clica em 'Importar Fatura'"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "exibir_formulario_upload"
        campos: ["Arquivo", "Template_Layout_Id"]
      - passo: 2
        ator: "usuario"
        acao: "selecionar_arquivo"
        formatos: ["CSV", "XLS", "XLSX", "TXT", "PDF"]
      - passo: 3
        ator: "usuario"
        acao: "selecionar_template_layout"
        opcoes: ["Vivo Mobile", "Claro Fixo", "TIM Dados", "Custom..."]
      - passo: 4
        ator: "usuario"
        acao: "clicar_upload"
      - passo: 5
        ator: "sistema"
        acao: "processar_arquivo"
        regras: ["RN-RF026-001", "RN-RF026-002"]
      - passo: 6
        ator: "sistema"
        acao: "exibir_preview_dados_extraidos"
        campos: ["Numero", "Operadora", "DataEmissao", "Vencimento", "ValorTotal", "Linhas"]
      - passo: 7
        ator: "usuario"
        acao: "confirmar_ou_corrigir"
      - passo: 8
        ator: "sistema"
        acao: "criar_fatura_rascunho"
        regras: ["RN-RF026-011", "RN-RF026-015"]
      - passo: 9
        ator: "sistema"
        acao: "armazenar_pdf_azure_blob"
      - passo: 10
        ator: "sistema"
        acao: "exibir_mensagem"
        mensagem: "Fatura importada com sucesso (status Rascunho). Confirme para iniciar conciliação."

    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "pdf_ocr_confidence_alto"
        passos:
          - "Sistema executa OCR via Azure Form Recognizer"
          - "Confidence score ≥ 85%"
          - "Sistema extrai campos automaticamente"
          - "Sistema exibe preview para confirmação (quick review)"
        resultado: "ocr_sucesso_automatico"
        regras: ["RN-RF026-002"]

      - id: "FA-UC01-02"
        condicao: "pdf_ocr_confidence_baixo"
        passos:
          - "Sistema executa OCR via Azure Form Recognizer"
          - "Confidence score < 85%"
          - "Sistema marca campos com baixa confiança em vermelho"
          - "Sistema exibe PDF original lado a lado com campos extraídos"
          - "Usuário corrige manualmente campos marcados"
        resultado: "ocr_revisao_manual"
        regras: ["RN-RF026-002"]

      - id: "FA-UC01-03"
        condicao: "criar_template_customizado"
        passos:
          - "Usuário clica em 'Criar Template Customizado'"
          - "Sistema exibe builder visual drag-and-drop"
          - "Usuário mapeia colunas do arquivo → campos da fatura"
          - "Usuário define delimitadores, encoding, regras de validação"
          - "Sistema salva template para reutilização futura"
        resultado: "template_criado"
        regras: ["RN-RF026-001"]

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "template_nao_encontrado"
        passos:
          - "Sistema busca template pelo ID"
          - "Template não encontrado"
          - "Sistema retorna HTTP 400 Bad Request"
          - "Sistema sugere template mais próximo (fuzzy match)"
        resultado: "validacao_falhou"
        regras: ["RN-RF026-001"]

      - id: "FE-UC01-02"
        condicao: "arquivo_corrompido"
        passos:
          - "Sistema tenta processar arquivo"
          - "Erro de parsing (arquivo corrompido ou formato inválido)"
          - "Sistema retorna HTTP 400 Bad Request"
          - "Sistema exibe mensagem 'Arquivo inválido. Formato esperado: [lista formatos aceitos]'"
        resultado: "erro_processamento"

      - id: "FE-UC01-03"
        condicao: "ocr_falhou_completamente"
        passos:
          - "Sistema executa OCR via Azure Form Recognizer"
          - "OCR retorna erro (PDF ilegível, criptografado, imagem de baixa qualidade)"
          - "Sistema exibe mensagem 'OCR falhou. Deseja inserir dados manualmente?'"
          - "Usuário clica 'Sim' → sistema exibe formulário entrada manual completo"
        resultado: "fallback_entrada_manual"
        regras: ["RN-RF026-002"]

    regras_aplicadas:
      - "RN-RF026-001"
      - "RN-RF026-002"
      - "RN-RF026-011"
      - "RN-RF026-012"
      - "RN-RF026-015"

    resultado_final:
      estado: "fatura_importada_rascunho"


  - id: "UC02"
    nome: "Visualizar Fatura"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RN-RF026-011"  # Multi-tenancy
        - "RN-RF026-012"  # Soft delete
        - "RN-RF026-013"  # Versionamento
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário solicita visualização"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão faturas.view"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema carrega fatura completa com detalhes"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema exibe cabeçalho + linhas + histórico + anexos"
          required: true
        - id: "FA-UC02-001"
          title: "Visualizar histórico de versões"
          required: true
        - id: "FA-UC02-002"
          title: "Comparar versões lado a lado (diff)"
          required: true
        - id: "FA-UC02-003"
          title: "Download PDF original"
          required: true
        - id: "FA-UC02-004"
          title: "Visualizar resultado de conciliação"
          required: false
        - id: "FA-UC02-005"
          title: "Visualizar resultado de auditoria"
          required: false
        - id: "FE-UC02-001"
          title: "Fatura não encontrada → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Fatura de outro tenant → HTTP 404"
          required: true

    precondicoes:
      - permissao: "faturas.view"
      - usuario_autenticado: true

    gatilho: "Usuário clica em uma fatura na lista (UC00)"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clica_em_fatura"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.view"
      - passo: 3
        ator: "sistema"
        acao: "validar_multi_tenancy"
        regras: ["RN-RF026-011"]
      - passo: 4
        ator: "sistema"
        acao: "carregar_fatura_completa"
        includes: ["Detalhes", "Linhas", "Versoes", "Conciliacao", "Auditoria", "Anexos"]
      - passo: 5
        ator: "sistema"
        acao: "exibir_detalhes_completos"
        secoes: ["Cabeçalho", "Linhas/Ativos", "Histórico Versões", "Conciliação", "Auditoria", "Anexos"]

    fluxos_alternativos:
      - id: "FA-UC02-01"
        condicao: "visualizar_historico_versoes"
        passos:
          - "Usuário clica em 'Histórico de Versões'"
          - "Sistema exibe lista de versões (v1, v2, v3...) com data, usuário, motivo"
          - "Sistema permite selecionar versão para visualizar"
        resultado: "historico_versoes_exibido"
        regras: ["RN-RF026-013"]

      - id: "FA-UC02-02"
        condicao: "comparar_versoes"
        passos:
          - "Usuário seleciona 2 versões para comparar"
          - "Sistema exibe diff lado a lado (highlight verde/vermelho)"
          - "Sistema destaca alterações: valores, linhas adicionadas/removidas, campos modificados"
        resultado: "diff_versoes_exibido"
        regras: ["RN-RF026-013"]

      - id: "FA-UC02-03"
        condicao: "download_pdf_original"
        passos:
          - "Usuário clica em 'Download PDF Original'"
          - "Sistema gera SAS token temporário (válido 5 minutos)"
          - "Sistema inicia download do PDF do Azure Blob Storage"
        resultado: "pdf_baixado"

      - id: "FA-UC02-04"
        condicao: "visualizar_conciliacao"
        passos:
          - "Usuário clica em aba 'Conciliação'"
          - "Sistema exibe resultado: % conciliado, itens conciliados (verde), itens não conciliados (vermelho)"
          - "Sistema exibe sugestões de match fuzzy para itens não conciliados"
        resultado: "conciliacao_exibida"

      - id: "FA-UC02-05"
        condicao: "visualizar_auditoria"
        passos:
          - "Usuário clica em aba 'Auditoria'"
          - "Sistema exibe regras executadas: aprovadas (verde), reprovadas (vermelho)"
          - "Sistema destaca valor total suspeito + bloqueios"
        resultado: "auditoria_exibida"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "fatura_nao_encontrada"
        passos:
          - "Sistema busca fatura pelo ID"
          - "Fatura não encontrada (ID inválido ou FlExcluido = 1)"
          - "Sistema retorna HTTP 404 Not Found"
        resultado: "fatura_nao_encontrada"

      - id: "FE-UC02-02"
        condicao: "fatura_outro_tenant"
        passos:
          - "Sistema busca fatura pelo ID"
          - "Sistema verifica ClienteId da fatura ≠ ClienteId do current_user"
          - "Sistema retorna HTTP 404 Not Found (não 403 para não vazar informação)"
        resultado: "acesso_negado_multi_tenancy"
        regras: ["RN-RF026-011"]

    regras_aplicadas:
      - "RN-RF026-011"
      - "RN-RF026-012"
      - "RN-RF026-013"

    resultado_final:
      estado: "detalhes_fatura_exibidos"


  - id: "UC03"
    nome: "Conciliar Fatura"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RN-RF026-003"  # Conciliação automática fuzzy matching
        - "RN-RF026-011"  # Multi-tenancy
        - "RN-RF026-015"  # Validação condicional
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário solicita conciliação"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão faturas.conciliar"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida status = Aguardando Conciliação"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema executa algoritmo conciliação (exato → fuzzy 90%)"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema exibe resultado: conciliado/revisar/não conciliado"
          required: true
        - id: "FA-UC03-001"
          title: "Conciliação manual de item não conciliado"
          required: true
        - id: "FA-UC03-002"
          title: "Revisar sugestões fuzzy match ≥90%"
          required: true
        - id: "FE-UC03-001"
          title: "Status inválido → HTTP 400"
          required: true
        - id: "FE-UC03-002"
          title: "Nenhum contrato ativo encontrado → alerta"
          required: true

    precondicoes:
      - permissao: "faturas.conciliar"
      - usuario_autenticado: true
      - status_fatura: "aguardando_conciliacao"

    gatilho: "Usuário clica em 'Executar Conciliação' ou sistema executa automaticamente após importação"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clica_executar_conciliacao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.conciliar"
      - passo: 3
        ator: "sistema"
        acao: "validar_status_fatura"
        status_esperado: "aguardando_conciliacao"
      - passo: 4
        ator: "sistema"
        acao: "executar_algoritmo_conciliacao"
        passos_algoritmo:
          - "1. Match exato: Numero_Linha == Ativo.Numero"
          - "2. Match fuzzy (Levenshtein ≥ 90%): Descricao_Linha ~ Ativo.Descricao"
          - "3. Não conciliado: < 90%"
        regras: ["RN-RF026-003"]
      - passo: 5
        ator: "sistema"
        acao: "exibir_resultado_conciliacao"
        metricas: ["% conciliado", "Itens conciliados (verde)", "Itens revisar (amarelo)", "Itens não conciliados (vermelho)"]
      - passo: 6
        ator: "sistema"
        acao: "atualizar_status_fatura"
        novo_status: "aguardando_auditoria"

    fluxos_alternativos:
      - id: "FA-UC03-01"
        condicao: "conciliacao_manual_item"
        passos:
          - "Usuário clica em item não conciliado"
          - "Sistema exibe modal com campo de busca de ativos"
          - "Usuário busca e seleciona ativo correto"
          - "Sistema vincula linha → ativo manualmente"
          - "Sistema recalcula % conciliação"
        resultado: "item_conciliado_manualmente"
        regras: ["RN-RF026-003"]

      - id: "FA-UC03-02"
        condicao: "revisar_sugestoes_fuzzy"
        passos:
          - "Usuário clica em item com status 'Revisar'"
          - "Sistema exibe top 3 sugestões de ativos (match score 90%, 88%, 85%)"
          - "Usuário seleciona sugestão correta ou clica 'Nenhuma' para buscar manualmente"
          - "Sistema vincula linha → ativo"
        resultado: "sugestao_aceita"
        regras: ["RN-RF026-003"]

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "status_invalido"
        passos:
          - "Sistema valida status da fatura"
          - "Status != aguardando_conciliacao"
          - "Sistema retorna HTTP 400 Bad Request"
          - "Sistema exibe mensagem 'Conciliação só pode ser executada em faturas com status Aguardando Conciliação.'"
        resultado: "validacao_falhou"
        regras: ["RN-RF026-015"]

      - id: "FE-UC03-02"
        condicao: "nenhum_contrato_ativo"
        passos:
          - "Sistema busca contratos ativos do tenant"
          - "Nenhum contrato encontrado"
          - "Sistema exibe alerta 'Atenção: Nenhum contrato ativo encontrado. Conciliação automática não será possível.'"
          - "Sistema permite conciliação manual de todos os itens"
        resultado: "alerta_sem_contratos"

    regras_aplicadas:
      - "RN-RF026-003"
      - "RN-RF026-011"
      - "RN-RF026-015"

    resultado_final:
      estado: "fatura_conciliada"


  - id: "UC04"
    nome: "Auditar Fatura"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RN-RF026-004"  # Auditoria pré-pagamento com regras configuráveis
        - "RN-RF026-011"  # Multi-tenancy
        - "RN-RF026-015"  # Validação condicional
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário/Sistema solicita auditoria"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão faturas.auditar"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida status = Aguardando Auditoria"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema executa 25+ regras de auditoria"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema classifica falhas (Alta, Média, Baixa)"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema exibe resultado + bloqueio/alerta"
          required: true
        - id: "FA-UC04-001"
          title: "Justificar falha severidade Média para aprovar"
          required: true
        - id: "FA-UC04-002"
          title: "Criar regra customizada de auditoria"
          required: false
        - id: "FE-UC04-001"
          title: "Severidade Alta → bloqueia aprovação"
          required: true
        - id: "FE-UC04-002"
          title: "Status inválido → HTTP 400"
          required: true

    precondicoes:
      - permissao: "faturas.auditar"
      - usuario_autenticado: true
      - status_fatura: "aguardando_auditoria"

    gatilho: "Usuário clica em 'Executar Auditoria' ou sistema executa automaticamente após conciliação"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clica_executar_auditoria"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.auditar"
      - passo: 3
        ator: "sistema"
        acao: "validar_status_fatura"
        status_esperado: "aguardando_auditoria"
      - passo: 4
        ator: "sistema"
        acao: "executar_regras_auditoria"
        regras_exemplo:
          - "Valor total diverge contrato (Alta)"
          - "Linha sem ativo vinculado (Alta)"
          - "Ativo faturado mas não ativo no sistema (Alta)"
          - "Consumo excede franquia contratada (Média)"
          - "Data vencimento < data emissão (Alta)"
          - "ICMS/PIS/COFINS fora do padrão (Baixa)"
        regras: ["RN-RF026-004"]
      - passo: 5
        ator: "sistema"
        acao: "classificar_severidade"
        severidades: ["Alta (bloqueia)", "Média (justificativa)", "Baixa (alerta)"]
      - passo: 6
        ator: "sistema"
        acao: "exibir_resultado_auditoria"
        metricas: ["Regras executadas", "Aprovadas", "Reprovadas", "Valor total suspeito", "Bloqueio aprovação"]

    fluxos_alternativos:
      - id: "FA-UC04-01"
        condicao: "justificar_falha_media"
        passos:
          - "Sistema detectou falha severidade Média"
          - "Sistema permite transição para Aguardando Aprovação mas exige justificativa"
          - "Usuário clica em regra reprovada"
          - "Usuário digita justificativa (≥20 caracteres)"
          - "Sistema registra justificativa + user + timestamp"
          - "Sistema permite avançar para aprovação"
        resultado: "falha_media_justificada"
        regras: ["RN-RF026-004"]

      - id: "FA-UC04-02"
        condicao: "criar_regra_customizada"
        passos:
          - "Admin clica em 'Criar Regra Customizada'"
          - "Sistema exibe editor visual de regras (if-then-else)"
          - "Admin define: condição, severidade, mensagem"
          - "Admin salva regra"
          - "Sistema executa regra customizada em próximas auditorias"
        resultado: "regra_custom_criada"
        regras: ["RN-RF026-004"]

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "severidade_alta_bloqueia"
        passos:
          - "Sistema executou auditoria"
          - "Pelo menos 1 regra severidade Alta falhou"
          - "Sistema marca fatura com flag Bloqueio_Aprovacao = TRUE"
          - "Sistema exibe mensagem 'Auditoria bloqueou aprovação. Regras com falhas críticas devem ser corrigidas.'"
          - "Sistema NÃO permite transição para Aguardando Aprovação"
        resultado: "aprovacao_bloqueada"
        regras: ["RN-RF026-004"]

      - id: "FE-UC04-02"
        condicao: "status_invalido"
        passos:
          - "Sistema valida status da fatura"
          - "Status != aguardando_auditoria"
          - "Sistema retorna HTTP 400 Bad Request"
        resultado: "validacao_falhou"
        regras: ["RN-RF026-015"]

    regras_aplicadas:
      - "RN-RF026-004"
      - "RN-RF026-011"
      - "RN-RF026-015"

    resultado_final:
      estado: "fatura_auditada"


  - id: "UC05"
    nome: "Contestar Fatura"
    ator_principal: "usuario_autenticado"
    tipo: "workflow"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RN-RF026-005"  # Workflow de contestação formal (7 etapas)
        - "RN-RF026-011"  # Multi-tenancy
      uc_items:
        - id: "FP-UC05-001"
          title: "Usuário cria contestação"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema valida permissão faturas.contest"
          required: true
        - id: "FP-UC05-003"
          title: "Sistema exibe formulário seleção itens + evidências"
          required: true
        - id: "FP-UC05-004"
          title: "Usuário preenche motivo + anexa evidências"
          required: true
        - id: "FP-UC05-005"
          title: "Sistema cria contestação status Rascunho"
          required: true
        - id: "FP-UC05-006"
          title: "Workflow 7 etapas: Criação → Aprovação → Envio → Acompanhamento → Resposta → Validação → Fechamento"
          required: true
        - id: "FA-UC05-001"
          title: "Aprovação interna contestação"
          required: true
        - id: "FA-UC05-002"
          title: "Envio para operadora (API ou email)"
          required: true
        - id: "FA-UC05-003"
          title: "Acompanhamento SLA (alerta 80%)"
          required: true
        - id: "FA-UC05-004"
          title: "Registro resposta operadora"
          required: true
        - id: "FA-UC05-005"
          title: "Validação crédito na próxima fatura"
          required: true
        - id: "FE-UC05-001"
          title: "Nenhum item selecionado → HTTP 400"
          required: true
        - id: "FE-UC05-002"
          title: "Aprovação negada → volta para Rascunho"
          required: true

    precondicoes:
      - permissao: "faturas.contest"
      - usuario_autenticado: true

    gatilho: "Usuário clica em 'Contestar' em fatura após auditoria"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clica_contestar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.contest"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario_contestacao"
        campos: ["Itens selecionados", "Motivo", "Evidências (anexos)"]
      - passo: 4
        ator: "usuario"
        acao: "selecionar_itens_contestar"
      - passo: 5
        ator: "usuario"
        acao: "preencher_motivo"
        min_length: 20
      - passo: 6
        ator: "usuario"
        acao: "anexar_evidencias"
        formatos: ["PDF", "JPG", "PNG", "XLSX"]
      - passo: 7
        ator: "sistema"
        acao: "criar_contestacao_rascunho"
        regras: ["RN-RF026-005"]
      - passo: 8
        ator: "sistema"
        acao: "iniciar_workflow_contestacao"
        etapas:
          - "1. Criação"
          - "2. Aprovação Interna"
          - "3. Envio Operadora"
          - "4. Acompanhamento SLA"
          - "5. Resposta"
          - "6. Validação Crédito"
          - "7. Fechamento"

    fluxos_alternativos:
      - id: "FA-UC05-01"
        condicao: "aprovacao_interna"
        passos:
          - "Sistema notifica aprovador interno (gestor designado)"
          - "Aprovador acessa contestação"
          - "Aprovador analisa motivo + evidências"
          - "Aprovador aprova ou rejeita"
          - "Se aprovado: transição para Envio Operadora"
          - "Se rejeitado: transição para Rascunho com comentário"
        resultado: "contestacao_aprovada_internamente"
        regras: ["RN-RF026-005"]

      - id: "FA-UC05-02"
        condicao: "envio_operadora"
        passos:
          - "Sistema verifica se operadora tem API integrada (Vivo, Claro, TIM)"
          - "Se API: envio automático via REST endpoint"
          - "Se não: geração de email padrão + PDF contestação"
          - "Sistema registra data envio + canal utilizado"
          - "Sistema inicia contagem SLA (prazo padrão: 30 dias)"
        resultado: "contestacao_enviada"
        regras: ["RN-RF026-005"]

      - id: "FA-UC05-03"
        condicao: "acompanhamento_sla"
        passos:
          - "Sistema monitora prazo SLA (30 dias)"
          - "Se exceder 80% do prazo (24 dias) sem resposta:"
          - "  - Alerta automático para gestor"
          - "  - Escala para supervisor"
          - "Se exceder 100% do prazo:"
          - "  - Notificação crítica"
          - "  - Sugestão de contato telefônico direto"
        resultado: "sla_monitorado"
        regras: ["RN-RF026-005"]

      - id: "FA-UC05-04"
        condicao: "registro_resposta"
        passos:
          - "Operadora responde (API callback webhook ou email manual)"
          - "Sistema registra resposta + data + decisão (aceita/negada)"
          - "Se aceita: transição para Validação Crédito"
          - "Se negada: transição para Fechamento com justificativa operadora"
        resultado: "resposta_registrada"
        regras: ["RN-RF026-005"]

      - id: "FA-UC05-05"
        condicao: "validacao_credito"
        passos:
          - "Sistema monitora próxima(s) fatura(s)"
          - "Sistema busca crédito/desconto referente à contestação"
          - "Se crédito encontrado: transição para Fechamento (resolvida)"
          - "Se crédito não aparecer após 2 faturas: alerta para reabrir contestação"
        resultado: "credito_validado"
        regras: ["RN-RF026-005"]

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "nenhum_item_selecionado"
        passos:
          - "Sistema valida itens selecionados"
          - "Nenhum item selecionado"
          - "Sistema retorna HTTP 400 Bad Request"
          - "Sistema exibe mensagem 'Selecione pelo menos 1 item para contestar.'"
        resultado: "validacao_falhou"

      - id: "FE-UC05-02"
        condicao: "aprovacao_negada"
        passos:
          - "Aprovador interno rejeitou contestação"
          - "Sistema registra comentário do aprovador"
          - "Sistema atualiza status contestação: Rascunho"
          - "Sistema notifica criador da contestação com motivo da rejeição"
        resultado: "contestacao_rejeitada"
        regras: ["RN-RF026-005"]

    regras_aplicadas:
      - "RN-RF026-005"
      - "RN-RF026-011"

    resultado_final:
      estado: "contestacao_em_workflow"


  - id: "UC06"
    nome: "Ratear Fatura"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RN-RF026-006"  # Rateio multi-dimensional automático
        - "RN-RF026-011"  # Multi-tenancy
        - "RN-RF026-014"  # Integração ERP
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário solicita rateio"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema valida permissão faturas.rateio"
          required: true
        - id: "FP-UC06-003"
          title: "Sistema exibe formulário configuração rateio"
          required: true
        - id: "FP-UC06-004"
          title: "Usuário seleciona dimensões + tipo rateio"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema valida soma percentuais = 100%"
          required: true
        - id: "FP-UC06-006"
          title: "Sistema calcula rateio em <2s"
          required: true
        - id: "FP-UC06-007"
          title: "Sistema gera arquivo exportação ERP (CSV/TXT)"
          required: true
        - id: "FA-UC06-001"
          title: "Tipo Percentual Fixo (ex: 60% CC1, 40% CC2)"
          required: true
        - id: "FA-UC06-002"
          title: "Tipo Proporcional Consumo (baseado em linhas/ativos)"
          required: true
        - id: "FA-UC06-003"
          title: "Tipo Misto (combina fixo + proporcional)"
          required: false
        - id: "FE-UC06-001"
          title: "Soma percentuais ≠ 100% → HTTP 400"
          required: true
        - id: "FE-UC06-002"
          title: "Regra sem dimensão → HTTP 400"
          required: true

    precondicoes:
      - permissao: "faturas.rateio"
      - usuario_autenticado: true

    gatilho: "Usuário clica em 'Ratear Fatura' após aprovação"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clica_ratear_fatura"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.rateio"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario_rateio"
        campos: ["Dimensões", "Tipo Rateio", "Percentuais/Critérios"]
      - passo: 4
        ator: "usuario"
        acao: "selecionar_dimensoes"
        opcoes: ["Centro Custo", "Projeto", "Departamento", "Geolocalização", "Tipo Serviço"]
      - passo: 5
        ator: "usuario"
        acao: "selecionar_tipo_rateio"
        opcoes: ["Percentual Fixo", "Proporcional Consumo", "Misto", "Por Ativo", "Hierárquico"]
      - passo: 6
        ator: "usuario"
        acao: "definir_percentuais_criterios"
      - passo: 7
        ator: "sistema"
        acao: "validar_soma_percentuais"
        validacao: "sum(percentuais) == 100%"
        regras: ["RN-RF026-006"]
      - passo: 8
        ator: "sistema"
        acao: "calcular_rateio"
        tempo_maximo: "2s"
        regras: ["RN-RF026-006"]
      - passo: 9
        ator: "sistema"
        acao: "exibir_preview_rateio"
        colunas: ["Dimensão", "Valor Alocado", "Percentual"]
      - passo: 10
        ator: "usuario"
        acao: "confirmar_rateio"
      - passo: 11
        ator: "sistema"
        acao: "gerar_arquivo_exportacao_erp"
        formatos: ["CSV", "TXT", "JSON"]
        regras: ["RN-RF026-014"]

    fluxos_alternativos:
      - id: "FA-UC06-01"
        condicao: "percentual_fixo"
        passos:
          - "Usuário seleciona 'Percentual Fixo'"
          - "Usuário define: CC1 = 60%, CC2 = 40%"
          - "Sistema valida soma = 100%"
          - "Sistema aloca valores proporcionalmente"
        resultado: "rateio_percentual_fixo"
        regras: ["RN-RF026-006"]

      - id: "FA-UC06-02"
        condicao: "proporcional_consumo"
        passos:
          - "Usuário seleciona 'Proporcional Consumo'"
          - "Sistema calcula consumo de cada CC (baseado em linhas/ativos)"
          - "Sistema aloca proporcionalmente: CC1 consumiu 70% → recebe 70% do valor"
        resultado: "rateio_proporcional"
        regras: ["RN-RF026-006"]

      - id: "FA-UC06-03"
        condicao: "misto"
        passos:
          - "Usuário seleciona 'Misto'"
          - "Usuário define: 50% fixo + 50% proporcional consumo"
          - "Sistema calcula rateio combinado"
        resultado: "rateio_misto"
        regras: ["RN-RF026-006"]

    fluxos_excecao:
      - id: "FE-UC06-01"
        condicao: "soma_percentuais_diferente_100"
        passos:
          - "Sistema valida soma dos percentuais"
          - "Soma ≠ 100% (ex: 60% + 30% = 90%)"
          - "Sistema retorna HTTP 400 Bad Request"
          - "Sistema exibe mensagem 'Soma dos percentuais deve ser exatamente 100%. Atual: 90%'"
        resultado: "validacao_falhou"
        regras: ["RN-RF026-006"]

      - id: "FE-UC06-02"
        condicao: "regra_sem_dimensao"
        passos:
          - "Sistema valida se pelo menos 1 dimensão foi selecionada"
          - "Nenhuma dimensão selecionada"
          - "Sistema retorna HTTP 400 Bad Request"
          - "Sistema exibe mensagem 'Selecione pelo menos 1 dimensão para rateio.'"
        resultado: "validacao_falhou"
        regras: ["RN-RF026-006"]

    regras_aplicadas:
      - "RN-RF026-006"
      - "RN-RF026-011"
      - "RN-RF026-014"

    resultado_final:
      estado: "fatura_rateada"


  - id: "UC07"
    nome: "Aprovar Fatura"
    ator_principal: "gestor_autenticado"
    tipo: "workflow"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RN-RF026-010"  # Aprovação mobile com assinatura digital
        - "RN-RF026-011"  # Multi-tenancy
        - "RN-RF026-015"  # Validação condicional
      uc_items:
        - id: "FP-UC07-001"
          title: "Gestor solicita aprovação"
          required: true
        - id: "FP-UC07-002"
          title: "Sistema valida permissão faturas.approve"
          required: true
        - id: "FP-UC07-003"
          title: "Sistema valida status = Aguardando Aprovação"
          required: true
        - id: "FP-UC07-004"
          title: "Sistema exibe resumo + drill-down"
          required: true
        - id: "FP-UC07-005"
          title: "Gestor revisa e decide: aprovar ou rejeitar"
          required: true
        - id: "FP-UC07-006"
          title: "Sistema solicita assinatura digital DocuSign"
          required: true
        - id: "FP-UC07-007"
          title: "Sistema atualiza status para Aprovada"
          required: true
        - id: "FA-UC07-001"
          title: "Aprovação via app mobile MAUI"
          required: true
        - id: "FA-UC07-002"
          title: "Aprovação multi-nível (hierárquica)"
          required: false
        - id: "FE-UC07-001"
          title: "Rejeição com justificativa → volta para status anterior"
          required: true
        - id: "FE-UC07-002"
          title: "Bloqueio auditoria → impede aprovação"
          required: true

    precondicoes:
      - permissao: "faturas.approve"
      - usuario_autenticado: true
      - perfil: ["Gestor TI", "Diretor", "CFO"]
      - status_fatura: "aguardando_aprovacao"

    gatilho: "Gestor recebe notificação (push, email, in-app) de fatura aguardando aprovação"

    fluxo_principal:
      - passo: 1
        ator: "gestor"
        acao: "acessa_fatura_aguardando_aprovacao"
        canais: ["Web", "App Mobile"]
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.approve"
      - passo: 3
        ator: "sistema"
        acao: "validar_status_fatura"
        status_esperado: "aguardando_aprovacao"
      - passo: 4
        ator: "sistema"
        acao: "verificar_bloqueios_auditoria"
        regras: ["RN-RF026-004"]
      - passo: 5
        ator: "sistema"
        acao: "exibir_resumo_fatura"
        dados: ["Operadora", "Período", "Valor Total", "Resultado Conciliação", "Resultado Auditoria", "Rateio"]
      - passo: 6
        ator: "gestor"
        acao: "revisar_detalhes"
        acoes: ["Drill-down linhas", "Visualizar evidências auditoria", "Verificar rateio"]
      - passo: 7
        ator: "gestor"
        acao: "decidir_aprovar_ou_rejeitar"
      - passo: 8
        ator: "sistema"
        acao: "solicitar_assinatura_digital_docusign"
        regras: ["RN-RF026-010"]
      - passo: 9
        ator: "gestor"
        acao: "assinar_documento"
        metodos: ["DocuSign web", "DocuSign mobile"]
      - passo: 10
        ator: "sistema"
        acao: "atualizar_status_fatura"
        novo_status: "aprovada"
      - passo: 11
        ator: "sistema"
        acao: "disparar_evento_integracao_erp"
        regras: ["RN-RF026-014"]

    fluxos_alternativos:
      - id: "FA-UC07-01"
        condicao: "aprovacao_via_mobile"
        passos:
          - "Gestor recebe push notification no app MAUI"
          - "Gestor abre app com login biométrico (FaceID, TouchID)"
          - "App exibe resumo da fatura (mesmo layout web)"
          - "Gestor pode fazer drill-down nos itens (offline mode se já baixados)"
          - "Gestor clica 'Aprovar'"
          - "App solicita assinatura digital DocuSign"
          - "Gestor assina com biometria"
          - "App registra auditoria completa: GPS, device ID, IP, timestamp"
          - "App sincroniza aprovação com backend (ou enfileira se offline)"
        resultado: "aprovacao_mobile_sucesso"
        regras: ["RN-RF026-010"]

      - id: "FA-UC07-02"
        condicao: "aprovacao_multinivel"
        passos:
          - "Sistema verifica se fatura exige aprovação hierárquica (valor > threshold)"
          - "Nível 1: Gestor TI aprova"
          - "Status intermediário: Aguardando Aprovação Nível 2"
          - "Nível 2: Diretor aprova"
          - "Sistema só transiciona para Aprovada após todos os níveis aprovarem"
        resultado: "aprovacao_multinivel_sucesso"

    fluxos_excecao:
      - id: "FE-UC07-01"
        condicao: "rejeicao_com_justificativa"
        passos:
          - "Gestor clica em 'Rejeitar'"
          - "Sistema exibe campo texto obrigatório (≥20 caracteres)"
          - "Gestor digita justificativa da rejeição"
          - "Sistema atualiza status fatura: volta para status anterior (ex: aguardando_auditoria)"
          - "Sistema notifica responsável com justificativa da rejeição"
        resultado: "fatura_rejeitada"

      - id: "FE-UC07-02"
        condicao: "bloqueio_auditoria_impede_aprovacao"
        passos:
          - "Sistema verifica flag Bloqueio_Aprovacao"
          - "Flag = TRUE (auditoria detectou falhas severidade Alta)"
          - "Sistema exibe mensagem 'Aprovação bloqueada. Resolva as falhas críticas de auditoria antes de aprovar.'"
          - "Sistema NÃO permite aprovar (botão desabilitado)"
        resultado: "aprovacao_bloqueada"
        regras: ["RN-RF026-004"]

    regras_aplicadas:
      - "RN-RF026-004"
      - "RN-RF026-010"
      - "RN-RF026-011"
      - "RN-RF026-014"
      - "RN-RF026-015"

    resultado_final:
      estado: "fatura_aprovada"


  - id: "UC08"
    nome: "Dashboard Faturas"
    ator_principal: "usuario_autenticado"
    tipo: "visualizacao"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RN-RF026-007"  # Dashboard executivo com KPIs críticos
        - "RN-RF026-008"  # Alertas preditivos de estouro de budget
        - "RN-RF026-011"  # Multi-tenancy
      uc_items:
        - id: "FP-UC08-001"
          title: "Usuário acessa dashboard"
          required: true
        - id: "FP-UC08-002"
          title: "Sistema carrega 10+ KPIs em <3s"
          required: true
        - id: "FP-UC08-003"
          title: "Sistema exibe gráficos Chart.js em tempo real (SignalR)"
          required: true
        - id: "FP-UC08-004"
          title: "Sistema exibe alertas preditivos ML ativos"
          required: true
        - id: "FA-UC08-001"
          title: "Drill-down em gráfico"
          required: true
        - id: "FA-UC08-002"
          title: "Exportar dashboard PDF snapshot"
          required: true
        - id: "FA-UC08-003"
          title: "Exportar dados Excel (dados brutos)"
          required: true
        - id: "FA-UC08-004"
          title: "Configurar período de análise (mês, trimestre, ano)"
          required: false
        - id: "FE-UC08-001"
          title: "Dashboard timeout >3s → mensagem otimização"
          required: true

    precondicoes:
      - permissao: "faturas.view_any"
      - usuario_autenticado: true

    gatilho: "Usuário acessa 'Dashboard Faturas' pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_dashboard"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
        permissao: "faturas.view_any"
      - passo: 3
        ator: "sistema"
        acao: "carregar_kpis_tempo_real"
        kpis:
          - "Gasto Total Mês"
          - "Variação MoM / YoY"
          - "Top 10 Maiores Contas"
          - "Distribuição por Tipo Serviço"
          - "Curva 12 Meses"
          - "Forecast 3 Meses (ML)"
          - "Taxa Economia Auditoria"
          - "Taxa Conciliação Automática"
          - "Alertas Ativos"
          - "Status Workflow (faturas por status)"
        regras: ["RN-RF026-007"]
        tempo_maximo: "3s"
      - passo: 4
        ator: "sistema"
        acao: "exibir_graficos_interativos"
        biblioteca: "Chart.js"
      - passo: 5
        ator: "sistema"
        acao: "conectar_signalr_updates_tempo_real"
        regras: ["RN-RF026-007"]
      - passo: 6
        ator: "sistema"
        acao: "exibir_alertas_preditivos_ml"
        tipos: ["Estouro budget 7 dias", "Estouro budget 15 dias", "Estouro budget 30 dias"]
        regras: ["RN-RF026-008"]

    fluxos_alternativos:
      - id: "FA-UC08-01"
        condicao: "drill_down_grafico"
        passos:
          - "Usuário clica em barra/fatia de gráfico"
          - "Sistema exibe detalhes daquela dimensão (ex: clicar em 'Vivo' → lista faturas Vivo)"
          - "Sistema permite drill-down em múltiplos níveis"
        resultado: "drill_down_executado"
        regras: ["RN-RF026-007"]

      - id: "FA-UC08-02"
        condicao: "exportar_pdf_snapshot"
        passos:
          - "Usuário clica em 'Exportar Dashboard PDF'"
          - "Sistema captura screenshot completo do dashboard"
          - "Sistema gera PDF com timestamp + filtros aplicados"
          - "Sistema inicia download"
        resultado: "pdf_exportado"
        regras: ["RN-RF026-007"]

      - id: "FA-UC08-03"
        condicao: "exportar_excel_dados_brutos"
        passos:
          - "Usuário clica em 'Exportar Dados Excel'"
          - "Sistema gera arquivo .xlsx com abas separadas para cada gráfico"
          - "Cada aba contém dados brutos do gráfico"
          - "Sistema inicia download"
        resultado: "excel_exportado"
        regras: ["RN-RF026-007"]

      - id: "FA-UC08-04"
        condicao: "configurar_periodo_analise"
        passos:
          - "Usuário clica em filtro de período"
          - "Usuário seleciona: Mês atual, Trimestre, Ano, Customizado"
          - "Sistema recarrega dashboard com período selecionado"
        resultado: "periodo_alterado"

    fluxos_excecao:
      - id: "FE-UC08-01"
        condicao: "dashboard_timeout"
        passos:
          - "Sistema tenta carregar dashboard"
          - "Tempo de carregamento > 3s (muitos dados)"
          - "Sistema exibe mensagem 'Dashboard está demorando. Considere aplicar filtros para otimizar.'"
          - "Sistema sugere filtrar por período menor ou operadora específica"
        resultado: "timeout_otimizacao"
        regras: ["RN-RF026-007"]

    regras_aplicadas:
      - "RN-RF026-007"
      - "RN-RF026-008"
      - "RN-RF026-011"

    resultado_final:
      estado: "dashboard_exibido"


exclusions:
  uc_items: []
  justificativa: |
    Nenhum caso de uso foi excluído. Todos os 9 UCs (UC00-UC08) são necessários
    para cobertura completa do RF-026.
    UC-RF026.md original tinha UC01-UC08 (sem UC00). Ajustado para incluir UC00 Listar Faturas.


historico:
  - versao: "1.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: |
      Versão 1.0 - 9 UCs cobrindo 100% das 15 regras de negócio do RF-026.
      UCs:
      - UC00: Listar Faturas (RN-RF026-011, 012)
      - UC01: Importar Fatura multi-layout + OCR (RN-RF026-001, 002, 011, 012, 015)
      - UC02: Visualizar Fatura com versionamento (RN-RF026-011, 012, 013)
      - UC03: Conciliar Fatura com fuzzy matching (RN-RF026-003, 011, 015)
      - UC04: Auditar Fatura com 25+ regras (RN-RF026-004, 011, 015)
      - UC05: Contestar Fatura com workflow 7 etapas (RN-RF026-005, 011)
      - UC06: Ratear Fatura multi-dimensional (RN-RF026-006, 011, 014)
      - UC07: Aprovar Fatura com DocuSign + mobile (RN-RF026-004, 010, 011, 014, 015)
      - UC08: Dashboard Faturas com KPIs + alertas ML (RN-RF026-007, 008, 011)

      Cobertura de regras:
      - RN-RF026-001 (Importação multi-layout): UC01 ✅
      - RN-RF026-002 (OCR PDF): UC01 ✅
      - RN-RF026-003 (Conciliação fuzzy): UC03 ✅
      - RN-RF026-004 (Auditoria pré-pagamento): UC04, UC07 ✅
      - RN-RF026-005 (Workflow contestação): UC05 ✅
      - RN-RF026-006 (Rateio multi-dimensional): UC06 ✅
      - RN-RF026-007 (Dashboard executivo): UC08 ✅
      - RN-RF026-008 (Alertas preditivos ML): UC08 ✅
      - RN-RF026-009 (APIs operadoras): IMPLÍCITO (UC01, UC05) ✅
      - RN-RF026-010 (Aprovação mobile + DocuSign): UC07 ✅
      - RN-RF026-011 (Multi-tenancy): UC00, UC01, UC02, UC03, UC04, UC05, UC06, UC07, UC08 ✅
      - RN-RF026-012 (Soft delete): UC00, UC01, UC02 ✅
      - RN-RF026-013 (Versionamento): UC02 ✅
      - RN-RF026-014 (Integração ERP): UC06, UC07 ✅
      - RN-RF026-015 (Validação condicional): UC01, UC03, UC04, UC07 ✅

      Todas as 15 regras cobertas ✅
