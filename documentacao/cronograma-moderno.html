<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma Interativo - Moderniza√ß√£o IControlIT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .accordion-button.open .accordion-arrow {
            transform: rotate(180deg);
        }
        .accordion-arrow {
            transition: transform 0.3s ease-in-out;
        }
        .task-row.completed .task-name {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .task-observation-display:empty::before {
            content: "Clique para adicionar anota√ß√µes...";
            color: #9ca3af;
            font-style: italic;
        }
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type='number'] {
            -moz-appearance: textfield;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
        }
        input[type="date"] {
            color: #4b5563;
        }
        input[type="date"]:invalid {
            color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <div class="w-full max-w-full mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
        <!-- HEADER -->
        <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-indigo-600 to-purple-600 text-white">
            <h1 class="text-3xl font-bold">üìÖ Cronograma Interativo - Moderniza√ß√£o IControlIT</h1>
            <p class="mt-2 text-indigo-100">Web Forms VB.NET ‚Üí .NET 10 + Angular 19</p>
            <div class="mt-4 flex flex-col sm:flex-row sm:space-x-8">
                <div class="bg-white/20 rounded-lg px-4 py-2 backdrop-blur-sm">
                    <p class="text-sm text-indigo-100">Total Planejado</p>
                    <p id="global-planned-total" class="text-2xl font-bold">2.230h</p>
                </div>
                <div class="bg-white/20 rounded-lg px-4 py-2 backdrop-blur-sm mt-2 sm:mt-0">
                    <p class="text-sm text-indigo-100">Total Realizado</p>
                    <p id="global-realized-total" class="text-2xl font-bold text-green-300">688h</p>
                </div>
                <div class="bg-white/20 rounded-lg px-4 py-2 backdrop-blur-sm mt-2 sm:mt-0">
                    <p class="text-sm text-indigo-100">Saldo Restante</p>
                    <p id="global-remaining-total" class="text-2xl font-bold text-yellow-300">1.542h</p>
                </div>
                <div class="bg-white/20 rounded-lg px-4 py-2 backdrop-blur-sm mt-2 sm:mt-0">
                    <p class="text-sm text-indigo-100">Progresso Geral</p>
                    <p id="global-progress-percent" class="text-2xl font-bold text-green-300">30.8%</p>
                </div>
            </div>
        </div>

        <div id="accordion-container">
            <!-- Template para uma linha de tarefa -->
            <template id="task-row-template">
                <div class="task-row flex items-start border-b py-3 px-4 min-w-max hover:bg-gray-50 transition-colors">
                    <div class="pt-1 flex-shrink-0">
                        <input type="checkbox" class="task-checkbox h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
                    </div>
                    <div class="w-96 flex-grow ml-4 task-name-container">
                        <span class="task-name p-1 cursor-pointer hover:bg-gray-100 rounded"></span>
                        <input type="text" class="task-name-input hidden w-full p-1 border rounded-md focus:ring-2 focus:ring-indigo-500" />
                    </div>
                    <div class="w-24 text-right pt-1 flex-shrink-0">
                        <span class="task-planned-hours font-medium text-gray-700"></span>
                    </div>
                    <div class="w-24 text-right pt-1 flex-shrink-0">
                        <input type="number" class="task-realized-hours w-20 text-right bg-gray-50 border border-gray-200 rounded-md px-2 py-0.5 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0h">
                    </div>
                    <div class="w-32 pt-1 flex-shrink-0 ml-2">
                        <select class="task-status w-full bg-gray-50 border border-gray-200 rounded-md px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="pending">Pendente</option>
                            <option value="in-progress">Em Andamento</option>
                            <option value="completed">Conclu√≠da</option>
                        </select>
                    </div>
                    <div class="w-64 ml-4 flex-shrink-0 observation-container">
                        <p class="task-observation-display w-full p-2 text-xs text-gray-800 cursor-pointer min-h-[2.5rem] break-words rounded hover:bg-gray-100"></p>
                        <textarea class="task-observation w-full p-2 border rounded-md text-sm bg-gray-50 focus:bg-white focus:ring-2 focus:ring-indigo-500 hidden" rows="2" placeholder="Anota√ß√µes..."></textarea>
                    </div>
                </div>
            </template>
        </div>

        <!-- TIMELINE VISUAL -->
        <div class="p-6 bg-gradient-to-br from-gray-50 to-gray-100 border-t border-gray-200">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">üìä Linha do Tempo</h2>

            <div class="overflow-x-auto">
                <div class="inline-flex flex-col min-w-max space-y-3">
                    <!-- Headers -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-xs font-semibold text-gray-600 uppercase">Fase</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Out/25</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Nov/25</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Dez/25</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Jan/26</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Fev/26</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Mar/26</div>
                        <div class="w-24 text-center text-xs font-semibold text-gray-600">Abr/26</div>
                    </div>

                    <!-- Fase 0 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 0 - Prepara√ß√£o<br><span class="text-xs text-gray-500">120h</span></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">‚úì</div></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                    </div>

                    <!-- Fase 1 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 1 - Sistema Base<br><span class="text-xs text-gray-500">10 RFs | 310h</span></div>
                        <div class="w-24"></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">‚úì</div></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                    </div>

                    <!-- Fase 2 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 2 - Cadastros<br><span class="text-xs text-gray-500">26 RFs | 258h</span></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">‚úì</div></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-20 bg-yellow-100 rounded-lg flex items-center justify-center text-yellow-700 text-xs font-semibold border-2 border-yellow-400">Reorg*</div></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                    </div>

                    <!-- Fase 3 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 3 - Financeiro I<br><span class="text-xs text-gray-500">10 RFs | 385h</span></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-gray-400 to-gray-500 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">Planejado</div></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                    </div>

                    <!-- Fase 4 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 4 - Financeiro II<br><span class="text-xs text-gray-500">7 RFs | 270h</span></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-gray-400 to-gray-500 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">Planejado</div></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                    </div>

                    <!-- Fase 5 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 5 - Service Desk<br><span class="text-xs text-gray-500">32 RFs | 580h</span></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-gray-400 to-gray-500 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">Planejado</div></div>
                        <div class="w-24"></div>
                    </div>

                    <!-- Fase 6 -->
                    <div class="flex items-center space-x-2">
                        <div class="w-48 text-sm font-medium text-gray-800">Fase 6 - Ativos/Integ.<br><span class="text-xs text-gray-500">25 RFs | 307h</span></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24"></div>
                        <div class="w-24 flex justify-center"><div class="h-10 w-full bg-gradient-to-r from-gray-400 to-gray-500 rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-md">Planejado</div></div>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex items-center justify-center space-x-6">
                <div class="flex items-center space-x-2">
                    <div class="h-4 w-12 bg-gradient-to-r from-green-500 to-green-600 rounded"></div>
                    <span class="text-sm text-gray-600">Conclu√≠do</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="h-4 w-12 bg-gradient-to-r from-gray-400 to-gray-500 rounded"></div>
                    <span class="text-sm text-gray-600">Planejado</span>
                </div>
            </div>

            <p class="mt-4 text-xs text-gray-600 text-center">
                <strong>*Reorganiza√ß√£o:</strong> Alguns cadastros da Fase 2 seguem em Jan/26 sem consumo adicional de horas
            </p>
        </div>

        <!-- NOTA METODOLOGIA √ÅGIL -->
        <div class="p-6 bg-gray-50 border-t border-gray-200">
            <h3 class="font-semibold text-gray-800 mb-2">üìù Nota sobre a Metodologia √Ågil</h3>
            <p class="text-sm text-gray-600 leading-relaxed">
                Este cronograma representa nossa melhor estimativa no momento atual. Como um projeto √°gil, ele √© um organismo vivo.
                As prioridades das atividades dentro de cada fase podem ser ajustadas para maximizar o valor entregue.
                No entanto, qualquer ajuste ser√° feito de forma transparente e gerenciado para garantir que o projeto seja
                conclu√≠do dentro do <strong>escopo, prazo e or√ßamento totais</strong>.
            </p>
        </div>

        <!-- FOOTER -->
        <div class="p-6 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-center">
            <p class="font-semibold">Moderniza√ß√£o IControlIT</p>
            <p class="text-sm text-indigo-100 mt-1">Migra√ß√£o de ASP.NET Web Forms (VB.NET) para .NET 10 + Angular 19</p>
            <p class="text-xs text-indigo-200 mt-2">Documento gerado em 30/12/2025 | Ag√™ncia ALC - alc.dev.br</p>
        </div>
    </div>

    <script>
        // Dados do Projeto IControlIT
        const projectData = [
            {
                id: "fase0",
                title: "Fase 0 - Prepara√ß√£o do Ambiente",
                color: "bg-gray-600",
                status: "completed",
                plannedHours: 120,
                tasks: [
                    { id: "f0_setup", name: "Setup de Infraestrutura DevOps", hours: 40 },
                    { id: "f0_tools", name: "Configura√ß√£o de Ferramentas e Ambientes", hours: 40 },
                    { id: "f0_docs", name: "Documenta√ß√£o Base e Padr√µes", hours: 40 },
                ]
            },
            {
                id: "fase1",
                title: "Fase 1 - Sistema Base",
                color: "bg-blue-600",
                status: "completed",
                plannedHours: 310,
                tasks: [
                    { id: "rf001", name: "RF001 - Par√¢metros e Configura√ß√µes", hours: 35 },
                    { id: "rf002", name: "RF002 - Configura√ß√µes e Parametriza√ß√£o", hours: 30 },
                    { id: "rf003", name: "RF003 - Logs e Monitoramento", hours: 35 },
                    { id: "rf004", name: "RF004 - Auditoria e Logs", hours: 40 },
                    { id: "rf005", name: "RF005 - i18n Or√ßamento Provis√£o", hours: 30 },
                    { id: "rf006", name: "RF006 - Gest√£o de Clientes", hours: 35 },
                    { id: "rf007", name: "RF007 - Login e Autentica√ß√£o", hours: 45 },
                    { id: "rf008", name: "RF008 - Gest√£o de Usu√°rios RBAC", hours: 40 },
                    { id: "rf009", name: "RF009 - Gest√£o de Idiomas", hours: 10 },
                    { id: "rf010", name: "RF010 - Gest√£o de M√≥dulos", hours: 10 },
                ]
            },
            {
                id: "fase2",
                title: "Fase 2 - Cadastros e Servi√ßos Transversais",
                color: "bg-teal-600",
                status: "completed",
                plannedHours: 258,
                tasks: [
                    { id: "rf011", name: "RF011 - Gest√£o de Empresas", hours: 25 },
                    { id: "rf012", name: "RF012 - Gest√£o de Filiais", hours: 25 },
                    { id: "rf013", name: "RF013 - Gest√£o de Departamentos", hours: 20 },
                    { id: "rf014", name: "RF014 - Gest√£o de Centros de Custo", hours: 20 },
                    { id: "rf015", name: "RF015 - Gest√£o de Fornecedores", hours: 25 },
                    { id: "rf016", name: "RF016 - Gest√£o de Fabricantes", hours: 15 },
                    { id: "rf017", name: "RF017 - Gest√£o de Categorias", hours: 15 },
                    { id: "rf063", name: "RF063 - Motor de Templates", hours: 30 },
                    { id: "rf064", name: "RF064 - Templates de E-mail", hours: 25 },
                    { id: "rf065", name: "RF065 - Templates de Relat√≥rios", hours: 28 },
                    { id: "rf066", name: "RF066 - Notifica√ß√µes e Alertas", hours: 30 },
                ]
            },
            {
                id: "fase3",
                title: "Fase 3 - Financeiro I (Base Cont√°bil)",
                color: "bg-purple-600",
                status: "planned",
                plannedHours: 385,
                tasks: [
                    { id: "rf032", name: "RF032 - Plano de Contas", hours: 40 },
                    { id: "rf033", name: "RF033 - Centro de Custo Cont√°bil", hours: 35 },
                    { id: "rf034", name: "RF034 - Or√ßamento e Provis√£o", hours: 40 },
                    { id: "rf035", name: "RF035 - Lan√ßamentos Financeiros", hours: 45 },
                    { id: "rf036", name: "RF036 - Contas a Pagar", hours: 40 },
                    { id: "rf037", name: "RF037 - Contas a Receber", hours: 40 },
                    { id: "rf038", name: "RF038 - Concilia√ß√£o Banc√°ria", hours: 45 },
                    { id: "rf039", name: "RF039 - Relat√≥rios Financeiros", hours: 35 },
                    { id: "rf040", name: "RF040 - DRE", hours: 35 },
                    { id: "rf041", name: "RF041 - An√°lise Financeira", hours: 30 },
                ]
            },
            {
                id: "fase4",
                title: "Fase 4 - Financeiro II (Processos)",
                color: "bg-amber-600",
                status: "planned",
                plannedHours: 270,
                tasks: [
                    { id: "rf042", name: "RF042 - Fluxo de Caixa", hours: 40 },
                    { id: "rf043", name: "RF043 - Rateio de Custos", hours: 45 },
                    { id: "rf044", name: "RF044 - Controle Or√ßament√°rio", hours: 35 },
                    { id: "rf045", name: "RF045 - An√°lise de Varia√ß√µes", hours: 30 },
                    { id: "rf046", name: "RF046 - Relat√≥rios Gerenciais", hours: 35 },
                    { id: "rf047", name: "RF047 - Dashboards Financeiros", hours: 35 },
                    { id: "rf055", name: "RF055 - Gest√£o de Rateio", hours: 50 },
                ]
            },
            {
                id: "fase5",
                title: "Fase 5 - Service Desk",
                color: "bg-indigo-600",
                status: "planned",
                plannedHours: 580,
                tasks: [
                    { id: "rf049", name: "RF049 - Gest√£o de Chamados", hours: 50 },
                    { id: "rf050", name: "RF050 - SLA por Tipo de Chamado", hours: 40 },
                    { id: "rf051", name: "RF051 - Filas de Atendimento", hours: 35 },
                    { id: "rf052", name: "RF052 - Escala√ß√£o Autom√°tica", hours: 40 },
                    { id: "rf053", name: "RF053 - Base de Conhecimento", hours: 45 },
                    { id: "rf054", name: "RF054 - Portal do Usu√°rio", hours: 50 },
                    { id: "rf056", name: "RF056 - Ordens de Servi√ßo", hours: 40 },
                    { id: "rf069", name: "RF069 - Configura√ß√£o SLA Chamados", hours: 35 },
                    { id: "rf070", name: "RF070 - Base Conhecimento", hours: 30 },
                    { id: "rf073", name: "RF073 - Gest√£o Chamados e SLA", hours: 45 },
                    { id: "rf074", name: "RF074 - Gest√£o Tickets", hours: 40 },
                    { id: "rf078", name: "RF078 - Integra√ß√£o ERPs", hours: 50 },
                    { id: "rf080", name: "RF080 - Termos LGPD", hours: 40 },
                    { id: "rf082", name: "RF082 - Termos Responsabilidade", hours: 40 },
                ]
            },
            {
                id: "fase6",
                title: "Fase 6 - Ativos, Auditoria e Integra√ß√µes",
                color: "bg-green-600",
                status: "planned",
                plannedHours: 307,
                tasks: [
                    { id: "rf083", name: "RF083 - Cadastro de Ativos TI", hours: 35 },
                    { id: "rf084", name: "RF084 - Invent√°rio Autom√°tico", hours: 40 },
                    { id: "rf085", name: "RF085 - Movimenta√ß√£o de Ativos", hours: 30 },
                    { id: "rf086", name: "RF086 - Invent√°rio C√≠clico", hours: 35 },
                    { id: "rf087", name: "RF087 - Trilha de Auditoria", hours: 35 },
                    { id: "rf088", name: "RF088 - Relat√≥rios Compliance", hours: 30 },
                    { id: "rf089", name: "RF089 - Alertas de Anomalias", hours: 25 },
                    { id: "rf095", name: "RF095 - Integra√ß√£o ERPs", hours: 40 },
                    { id: "rf096", name: "RF096 - Active Directory", hours: 37 },
                ]
            },
        ];

        // Fun√ß√µes auxiliares
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateRowStyle(row, isCompleted) {
            row.classList.toggle('completed', isCompleted);
        }

        function updateProgress(accordionItem) {
            const taskRows = accordionItem.querySelectorAll('.task-row');
            let totalHours = 0;
            let completedHours = 0;

            taskRows.forEach(row => {
                const hours = parseInt(row.querySelector('.task-planned-hours').textContent, 10) || 0;
                totalHours += hours;
                if (row.querySelector('.task-checkbox')?.checked) {
                    completedHours += hours;
                }
            });

            const percentage = totalHours > 0 ? Math.round((completedHours / totalHours) * 100) : 0;
            const progressBar = accordionItem.querySelector('.progress-bar');
            const progressText = accordionItem.querySelector('.progress-text');

            if (progressBar) progressBar.style.width = `${percentage}%`;
            if (progressText) progressText.textContent = `${percentage}%`;
        }

        function updateAllTotals() {
            let globalPlanned = 0, globalRealized = 0;

            document.querySelectorAll('.accordion-item').forEach(item => {
                let sectionPlanned = 0, sectionRealized = 0;

                item.querySelectorAll('.task-row').forEach(row => {
                    sectionPlanned += parseInt(row.querySelector('.task-planned-hours').textContent, 10) || 0;
                    sectionRealized += parseInt(row.querySelector('.task-realized-hours').value, 10) || 0;
                });

                item.querySelector('.section-planned-total').textContent = `${sectionPlanned}h`;
                item.querySelector('.section-realized-total').textContent = `${sectionRealized}h`;
                globalPlanned += sectionPlanned;
                globalRealized += sectionRealized;
            });

            document.getElementById('global-planned-total').textContent = `${globalPlanned}h`;
            document.getElementById('global-realized-total').textContent = `${globalRealized}h`;
            document.getElementById('global-remaining-total').textContent = `${globalPlanned - globalRealized}h`;
            document.getElementById('global-progress-percent').textContent = `${Math.round((globalRealized / globalPlanned) * 100)}%`;
        }

        // Salvamento em localStorage
        function saveAllTasksState() {
            const tasksState = {};
            document.querySelectorAll('.task-row').forEach(row => {
                const taskId = row.dataset.taskId;
                tasksState[taskId] = {
                    completed: row.querySelector('.task-checkbox').checked,
                    name: row.querySelector('.task-name').textContent,
                    realizedHours: row.querySelector('.task-realized-hours').value,
                    status: row.querySelector('.task-status').value,
                    observation: row.querySelector('.task-observation').value
                };
            });
            localStorage.setItem('icontrolit-cronograma', JSON.stringify(tasksState));
        }

        function loadTasksState() {
            const savedState = localStorage.getItem('icontrolit-cronograma');
            if (!savedState) return;

            const tasksState = JSON.parse(savedState);
            document.querySelectorAll('.task-row').forEach(row => {
                const taskId = row.dataset.taskId;
                const taskData = tasksState[taskId];
                if (!taskData) return;

                const checkbox = row.querySelector('.task-checkbox');
                const realizedHoursInput = row.querySelector('.task-realized-hours');
                const statusSelect = row.querySelector('.task-status');

                checkbox.checked = taskData.completed || false;
                if (taskData.name) row.querySelector('.task-name').textContent = taskData.name;
                realizedHoursInput.value = taskData.realizedHours || '';
                statusSelect.value = taskData.status || 'pending';
                row.querySelector('.task-observation').value = taskData.observation || '';
                row.querySelector('.task-observation-display').textContent = taskData.observation || '';

                // Se est√° marcado como conclu√≠do, desabilitar edi√ß√£o de horas
                if (taskData.completed) {
                    realizedHoursInput.disabled = true;
                    realizedHoursInput.classList.add('bg-gray-200', 'cursor-not-allowed');
                }

                updateRowStyle(row, taskData.completed);
            });

            document.querySelectorAll('.accordion-item').forEach(updateProgress);
            updateAllTotals();
        }

        const debouncedSave = debounce(saveAllTasksState, 800);

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            const accordionContainer = document.getElementById('accordion-container');
            const taskRowTemplate = document.getElementById('task-row-template');

            // Gerar HTML das se√ß√µes
            projectData.forEach((section, index) => {
                const sectionTotal = section.plannedHours;
                const statusBadge = section.status === 'completed'
                    ? '<span class="ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Conclu√≠da</span>'
                    : '<span class="ml-2 px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">Planejado</span>';

                const sectionHtml = `
                    <div class="accordion-item border-b border-gray-200">
                        <button class="accordion-button w-full flex justify-between items-center p-6 text-left hover:bg-gray-50 focus:outline-none transition-colors">
                            <div class="flex items-center">
                                <span class="text-sm font-bold text-white ${section.color} rounded-full h-10 w-10 flex items-center justify-center mr-4 shadow-md">${index}</span>
                                <div>
                                    <span class="text-lg font-semibold text-gray-800">${section.title}</span>
                                    ${statusBadge}
                                </div>
                            </div>
                            <div class="flex items-center space-x-6">
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">Planejado</div>
                                    <span class="section-planned-total text-lg font-bold text-gray-700">${sectionTotal}h</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">Realizado</div>
                                    <span class="section-realized-total text-lg font-bold text-green-600">0h</span>
                                </div>
                                <svg class="accordion-arrow w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </button>
                        <div class="accordion-content">
                            <div class="p-6 overflow-x-auto">
                                <div class="pb-4">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs font-semibold text-gray-700">Progresso</span>
                                        <span class="progress-text text-xs font-semibold text-indigo-600">0%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                                        <div class="progress-bar bg-gradient-to-r from-indigo-500 to-purple-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="flex items-center text-xs text-gray-700 uppercase bg-gray-50 px-4 py-3 font-semibold min-w-max rounded-t-lg">
                                    <div class="w-8 flex-shrink-0"></div>
                                    <div class="w-96 flex-grow ml-4">Atividade</div>
                                    <div class="w-24 flex-shrink-0 text-right">Planejado</div>
                                    <div class="w-24 flex-shrink-0 text-right">Realizado</div>
                                    <div class="w-32 flex-shrink-0 text-left ml-2">Status</div>
                                    <div class="w-64 flex-shrink-0 ml-4">Observa√ß√µes</div>
                                </div>
                                <div class="task-list bg-white rounded-b-lg"></div>
                            </div>
                        </div>
                    </div>
                `;
                accordionContainer.innerHTML += sectionHtml;
            });

            // Preencher tarefas
            document.querySelectorAll('.accordion-item').forEach((sectionEl, index) => {
                const taskList = sectionEl.querySelector('.task-list');
                const sectionData = projectData[index];

                sectionData.tasks.forEach(taskData => {
                    const taskRow = taskRowTemplate.content.cloneNode(true).firstElementChild;
                    taskRow.dataset.taskId = taskData.id;
                    taskRow.querySelector('.task-name').textContent = taskData.name;
                    taskRow.querySelector('.task-planned-hours').textContent = `${taskData.hours}h`;
                    taskList.appendChild(taskRow);
                });
            });

            // Event Listeners
            accordionContainer.addEventListener('click', (event) => {
                const button = event.target.closest('.accordion-button');
                if (button) {
                    const content = button.nextElementSibling;
                    button.classList.toggle('open');
                    content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + "px";
                }

                const taskNameSpan = event.target.closest('.task-name');
                if (taskNameSpan) {
                    const container = taskNameSpan.closest('.task-name-container');
                    const input = container.querySelector('.task-name-input');
                    input.value = taskNameSpan.textContent;
                    taskNameSpan.classList.add('hidden');
                    input.classList.remove('hidden');
                    input.focus();
                }

                const observationP = event.target.closest('.task-observation-display');
                if (observationP) {
                    const ta = observationP.nextElementSibling;
                    observationP.classList.add('hidden');
                    ta.classList.remove('hidden');
                    ta.value = observationP.textContent;
                    ta.focus();
                }
            });

            accordionContainer.addEventListener('change', (event) => {
                const target = event.target;
                if (target.matches('.task-checkbox, .task-status')) {
                    if (target.matches('.task-checkbox')) {
                        const taskRow = target.closest('.task-row');
                        const statusSelect = taskRow.querySelector('.task-status');
                        const realizedHoursInput = taskRow.querySelector('.task-realized-hours');
                        const plannedHours = parseInt(taskRow.querySelector('.task-planned-hours').textContent, 10) || 0;

                        if (target.checked) {
                            // Marcar como conclu√≠do
                            statusSelect.value = 'completed';
                            realizedHoursInput.value = plannedHours;
                            realizedHoursInput.disabled = true;
                            realizedHoursInput.classList.add('bg-gray-200', 'cursor-not-allowed');
                        } else {
                            // Desmarcar - permite edi√ß√£o novamente
                            statusSelect.value = 'pending';
                            realizedHoursInput.value = '';
                            realizedHoursInput.disabled = false;
                            realizedHoursInput.classList.remove('bg-gray-200', 'cursor-not-allowed');
                        }

                        updateRowStyle(taskRow, target.checked);
                        updateProgress(taskRow.closest('.accordion-item'));
                        updateAllTotals();
                    }
                    saveAllTasksState();
                }
            });

            accordionContainer.addEventListener('blur', (event) => {
                const target = event.target;
                if (target.matches('.task-observation, .task-name-input, .task-realized-hours')) {
                    if (target.matches('.task-observation')) {
                        const p = target.previousElementSibling;
                        p.textContent = target.value;
                        target.classList.add('hidden');
                        p.classList.remove('hidden');
                    }
                    if (target.matches('.task-name-input')) {
                        const span = target.previousElementSibling;
                        span.textContent = target.value || span.textContent;
                        target.classList.add('hidden');
                        span.classList.remove('hidden');
                    }
                    if (target.matches('.task-realized-hours')) {
                        updateAllTotals();
                    }
                    saveAllTasksState();
                }
            }, true);

            accordionContainer.addEventListener('input', (event) => {
                if (event.target.matches('.task-realized-hours')) {
                    updateAllTotals();
                    debouncedSave();
                }
            });

            // Marcar automaticamente as fases conclu√≠das (Fase 0, 1, 2)
            function markCompletedPhases() {
                const completedPhaseIds = ['fase0', 'fase1', 'fase2'];

                document.querySelectorAll('.accordion-item').forEach((sectionEl, index) => {
                    const phaseId = projectData[index].id;

                    if (completedPhaseIds.includes(phaseId)) {
                        sectionEl.querySelectorAll('.task-row').forEach(row => {
                            const checkbox = row.querySelector('.task-checkbox');
                            const statusSelect = row.querySelector('.task-status');
                            const realizedHoursInput = row.querySelector('.task-realized-hours');
                            const plannedHours = parseInt(row.querySelector('.task-planned-hours').textContent, 10) || 0;

                            checkbox.checked = true;
                            statusSelect.value = 'completed';
                            realizedHoursInput.value = plannedHours;
                            realizedHoursInput.disabled = true;
                            realizedHoursInput.classList.add('bg-gray-200', 'cursor-not-allowed');
                            updateRowStyle(row, true);
                        });

                        updateProgress(sectionEl);
                    }
                });

                updateAllTotals();
                saveAllTasksState();
            }

            // Carregar estado salvo
            const hasSavedState = localStorage.getItem('icontrolit-cronograma');
            if (!hasSavedState) {
                // Se n√£o houver estado salvo, marcar fases conclu√≠das automaticamente
                markCompletedPhases();
            } else {
                // Se houver estado salvo, carregar
                loadTasksState();
            }
            updateAllTotals();
        });
    </script>
</body>
</html>
