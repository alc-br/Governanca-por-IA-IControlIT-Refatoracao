# =============================================
# RF-025: Gestão Completa de Ativos de TI e Telecom
# Versão: 2.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br
# =============================================

rf:
  id: "RF025"
  nome: "Gestão Completa de Ativos de TI e Telecom"
  versao: "2.0"
  data: "2025-12-30"
  fase: "Fase 4 - Financeiro II Processos"
  epic: "EPIC007-FIN"
  status: "em_desenvolvimento"  # draft | aprovado | em_desenvolvimento | concluido

descricao:
  objetivo: |
    Prover sistema completo de gestão de ativos de TI (notebooks, desktops, servidores, smartphones, tablets, impressoras)
    e Telecom (linhas móveis, fixas, aparelhos telefônicos) com rastreamento de ciclo de vida desde aquisição até baixa patrimonial,
    incluindo geração automática de QR Codes para identificação, controle de movimentações com geolocalização GPS,
    cálculo automático de depreciação contábil, alertas de vencimento de garantia e integração bidirecional com sistemas ERP.
  problema_resolvido: |
    Eliminar perda de ativos (redução de 40% no extravio), automatizar inventário físico (reduzindo tempo de 2 semanas para 2 dias),
    garantir compliance contábil com depreciação automatizada e fornecer visibilidade 360° do parque tecnológico.
  publico_afetado: "Gestores de TI, Financeiro, Controladoria, Usuários finais"

metricas_sucesso:
  - nome: "Redução de Extravio"
    meta: "De 15% para 5% dos ativos"
    economia_estimada: "R$500k/ano"
  - nome: "Tempo de Inventário Físico"
    meta: "De 2 semanas (40h/pessoa) para 2 dias (8h/pessoa)"
    reducao: "80%"
  - nome: "Compliance Contábil"
    meta: "Eliminar 100% dos erros de cálculo manual de depreciação"
  - nome: "ROI"
    meta: "Sistema paga-se em 6 meses"

escopo:
  incluso:
    - "Cadastro completo de ativos com geração automática de QR Code único"
    - "Workflow de movimentações com validação de transições de status"
    - "Histórico completo de movimentações (chain of custody) imutável"
    - "Alocação de ativos com responsável obrigatório e termo digital"
    - "Geolocalização GPS obrigatória para inventário mobile"
    - "Depreciação automática mensal (job Hangfire) com 3 métodos"
    - "Alertas automáticos de vencimento de garantia (30/60/90 dias)"
    - "Validação de IMEI para smartphones (algoritmo Luhn + consulta Anatel)"
    - "Workflow de aprovação de 2 níveis para baixa patrimonial"
    - "App mobile MAUI para inventário com scan QR Code"
    - "Dashboard executivo com gráficos tempo real (Chart.js)"
    - "Integração bidirecional com ERP (SAP, TOTVS) via API REST"
    - "Isolamento multi-tenant com filtro obrigatório por Id_Fornecedor"
    - "Soft delete obrigatório para preservação de histórico"
    - "Auditoria completa de operações CREATE/UPDATE/DELETE/ACCESS"
  fora:
    - "Interface visual específica (framework/template)"
    - "Tecnologia de implementação (linguagem, banco de dados)"
    - "Layout, UX ou identidade visual"
    - "Estratégia de deploy ou infraestrutura"
    - "Gestão de contratos (RF separado)"
    - "Gestão de chamados/tickets (RF separado)"

entidades:
  - nome: "Ativo"
    descricao: "Bem patrimonial de TI ou Telecom rastreado pelo sistema"
    multi_tenant: true
    soft_delete: true
    auditoria: true
    campos_principais:
      - "Id_Ativo"
      - "Numero_Patrimonio"
      - "QR_Code_URL"
      - "QR_Code_Base64"
      - "Tipo_Ativo"
      - "Status_Ativo"
      - "Id_Usuario_Responsavel"
      - "Valor_Aquisicao"
      - "Valor_Atual_Depreciado"
      - "Dt_Aquisicao"
      - "Dt_Garantia_Fim"
      - "Latitude"
      - "Longitude"
      - "Id_Fornecedor"

  - nome: "Ativo_Movimentacao"
    descricao: "Histórico completo e imutável de todas as movimentações"
    multi_tenant: true
    soft_delete: false
    auditoria: true
    imutavel: true

  - nome: "Ativo_Depreciacao"
    descricao: "Log de cálculos mensais de depreciação"
    multi_tenant: true
    soft_delete: false
    auditoria: true
    imutavel: true

  - nome: "Ativo_Inventario"
    descricao: "Registros de inventários físicos realizados"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "Ativo_Garantia_Alerta"
    descricao: "Log de notificações de garantia enviadas"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "Ativo_Anexos"
    descricao: "Anexos vinculados a ativos (fotos, NFs, laudos)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "Ativo_Integracao_ERP"
    descricao: "Fila de sincronização com SAP/TOTVS"
    multi_tenant: true
    soft_delete: false
    auditoria: true

  - nome: "Localizacao"
    descricao: "Estrutura hierárquica de localizações (Edifício → Andar → Sala)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

# ==============================================================================
# REGRAS DE NEGÓCIO
# ==============================================================================

regras_negocio:
  - id: "RN-RF025-001"
    titulo: "Número de Patrimônio Único Global"
    descricao: |
      Cada ativo DEVE ter um número de patrimônio único no sistema, gerado automaticamente
      no formato PAT-{TipoAbrev}-{Ano}-{Sequencial}.
      Exemplo: PAT-NB-2025-0001 (Notebook), PAT-SM-2025-0045 (Smartphone).
      Sistema valida unicidade ANTES de salvar com constraint UNIQUE INDEX.
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
      geracao_automatica: true
    validacao:
      tipo: "unicidade"
      mensagem_erro: "Número de patrimônio já existe no sistema"
      http_code: 409

  - id: "RN-RF025-002"
    titulo: "QR Code Gerado Automaticamente"
    descricao: |
      Ao criar ativo, sistema DEVE gerar QR Code único apontando para URL do ativo.
      Armazenado em QR_Code_Base64 (impressão offline) e QR_Code_URL (acesso online).
      Formato: 300x300px, correção de erro nível High (30% danificado ainda funciona).
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: false
      geracao_automatica: true
    biblioteca: "QRCoder (.NET)"
    formato: "300x300px"
    correcao_erro: "High"

  - id: "RN-RF025-003"
    titulo: "Status de Ativo com Transições Válidas"
    descricao: |
      Ativo possui status com transições válidas definidas.
      Transição inválida → HTTP 400 Bad Request com mensagem explicativa.
      Estado Baixado é irreversível (exceto para administradores).
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "transicao_estado"
      mensagem_erro: "Transição de status inválida: {origem} → {destino}"
      http_code: 400
    estados_validos:
      - "Disponivel"
      - "Alocado"
      - "Manutencao"
      - "Reservado"
      - "Perdido"
      - "Baixado"
    transicoes_permitidas:
      Disponivel: ["Alocado", "Reservado", "Manutencao", "Baixado"]
      Alocado: ["Disponivel", "Manutencao", "Perdido", "Baixado"]
      Manutencao: ["Disponivel", "Baixado"]
      Reservado: ["Disponivel", "Alocado"]
      Perdido: ["Disponivel", "Baixado"]
      Baixado: []

  - id: "RN-RF025-004"
    titulo: "Alocação Requer Usuário Responsável"
    descricao: |
      Ao mudar status para Alocado, campo Id_Usuario_Responsavel DEVE ser preenchido obrigatoriamente.
      Usuário responsável recebe email/push com Termo de Responsabilidade digital.
      Devolução limpa responsável automaticamente.
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      notificacao_automatica: true
    validacao:
      tipo: "campo_obrigatorio"
      mensagem_erro: "Responsável obrigatório ao alocar ativo"
      http_code: 400
    campos_afetados: ["Id_Usuario_Responsavel"]

  - id: "RN-RF025-005"
    titulo: "Histórico Completo de Movimentações (Chain of Custody)"
    descricao: |
      TODA alteração de status ou responsável DEVE gerar registro em tabela Ativo_Movimentacao.
      Registros NUNCA podem ser editados ou deletados (apenas INSERT).
      Timeline completa acessível via API.
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
      registro_automatico: true
      imutavel: true
    campos_obrigatorios:
      - "Tipo_Movimentacao"
      - "Status_Origem"
      - "Status_Destino"
      - "Data_Movimentacao"
      - "Usuario_Responsavel_Movimentacao"
    campos_condicionais:
      - campo: "Justificativa"
        obrigatorio_quando: ["Tipo_Movimentacao = Baixa", "Tipo_Movimentacao = Perdido"]

  - id: "RN-RF025-006"
    titulo: "Depreciação Automática Mensal"
    descricao: |
      Job Hangfire executa TODO mês (dia 1 às 02:00 UTC) cálculo de depreciação.
      Métodos suportados: Linear, Acelerada, Soma_Digitos.
      Integração ERP via API REST com retry 3x se falha.
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
      job_hangfire: true
    job_configuracao:
      cron: "0 2 1 * *"  # Dia 1 do mês às 02:00 UTC
      metodos_suportados: ["Linear", "Acelerada", "Soma_Digitos"]
      retry_policy: 3
      integracao_erp: true

  - id: "RN-RF025-007"
    titulo: "Alertas de Garantia Automáticos"
    descricao: |
      Job Hangfire executa DIARIAMENTE (às 08:00 UTC) verificando garantias vencendo.
      Notificações: 90 dias (Email), 60 dias (Email+Push), 30 dias (Email+Push+In-App).
      Sistema registra notificações em Ativo_Garantia_Alerta para evitar duplicatas.
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: false
      job_hangfire: true
    job_configuracao:
      cron: "0 8 * * *"  # Diariamente às 08:00 UTC
      periodos_alerta: [30, 60, 90]
      canais_notificacao:
        90_dias: ["email"]
        60_dias: ["email", "push"]
        30_dias: ["email", "push", "in_app", "dashboard"]

  - id: "RN-RF025-008"
    titulo: "Validação de Campos Obrigatórios por Tipo"
    descricao: |
      Campos obrigatórios variam por Tipo_Ativo.
      TI: Tipo_Ativo, Categoria, Numero_Serie, Id_Marca, Id_Modelo, Valor_Aquisicao, Dt_Aquisicao.
      Telecom: Tipo_Ativo, Categoria, Numero_Linha, Operadora, Tipo_Plano.
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      fluent_validation: true
    validacao:
      tipo: "campos_condicionais"
      mensagem_erro: "Campos obrigatórios faltando para tipo {Tipo_Ativo}: {campos}"
      http_code: 400
    validacoes_por_tipo:
      TI:
        obrigatorios: ["Tipo_Ativo", "Categoria", "Numero_Serie", "Id_Marca", "Id_Modelo", "Valor_Aquisicao", "Dt_Aquisicao"]
        recomendados: ["Sistema_Operacional", "Processador", "Memoria_RAM_GB", "MAC_Address", "Hostname"]
      Telecom:
        obrigatorios: ["Tipo_Ativo", "Categoria", "Numero_Linha", "Operadora", "Tipo_Plano"]
        condicionais:
          - campo: "IMEI"
            obrigatorio_quando: "Tipo_Ativo = Smartphone"

  - id: "RN-RF025-009"
    titulo: "Geolocalização Obrigatória para Inventário Mobile"
    descricao: |
      Ao usar app mobile para inventário, sistema DEVE capturar GPS obrigatoriamente.
      Precisão aceita: <= 20 metros.
      Exceção: Inventário web permite manual mas marca flag InventarioRemoto=TRUE.
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      app_mobile: true
    validacao:
      tipo: "geolocalizacao"
      mensagem_erro: "GPS desabilitado ou precisão insuficiente (> 20m)"
      http_code: 400
      precisao_maxima: 20  # metros
    campos_afetados: ["Latitude", "Longitude", "InventarioRemoto"]

  - id: "RN-RF025-010"
    titulo: "Baixa de Ativo Requer Aprovação"
    descricao: |
      Baixa patrimonial DEVE passar por workflow de aprovação de 2 níveis:
      Nível 1: Gestor imediato, Nível 2: Controller/Financeiro.
      Justificativa obrigatória (mínimo 50 caracteres) + anexos conforme motivo.
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      workflow_aprovacao: true
    validacao:
      tipo: "workflow"
      mensagem_erro: "Baixa requer aprovação de 2 níveis"
      http_code: 403
    workflow:
      niveis_aprovacao: 2
      nivel_1: "Gestor imediato do responsável"
      nivel_2: "Controller/Gerente Financeiro"
    campos_obrigatorios:
      - campo: "Justificativa"
        validacao: "MinLength(50)"
      - campo: "Anexos"
        validacao: "Required"
        tipos_aceitos: ["BO", "Laudo Técnico", "NF Venda"]

  - id: "RN-RF025-011"
    titulo: "IMEI Validation para Smartphones"
    descricao: |
      Se Tipo_Ativo = Smartphone, campo IMEI DEVE ser validado:
      1) Formato: 15 dígitos numéricos
      2) Checksum: Algoritmo de Luhn
      3) Consulta API Anatel para verificar blacklist
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      integracao_externa: true
    validacao:
      tipo: "imei"
      mensagem_erro: "IMEI inválido (formato ou checksum)"
      http_code: 400
    validacoes:
      - tipo: "formato"
        regex: "^[0-9]{15}$"
      - tipo: "checksum"
        algoritmo: "Luhn"
      - tipo: "blacklist"
        api_externa: "Anatel"
    campos_afetados: ["IMEI", "IMEI_Status"]

  - id: "RN-RF025-012"
    titulo: "Isolamento Multi-Tenant Obrigatório"
    descricao: |
      TODAS as queries e operações DEVEM filtrar por Id_Fornecedor do JWT token.
      Tentativa de acesso cruzado → HTTP 403 Forbidden.
      Índice composto (Id_Fornecedor, Status_Ativo) otimiza queries.
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
      query_filter_global: true
    validacao:
      tipo: "multi_tenant"
      mensagem_erro: "Acesso negado: ativo pertence a outro tenant"
      http_code: 403
    seguranca:
      isolamento_obrigatorio: true
      fonte_tenant_id: "JWT Token"
      query_filter_ef_core: true

  - id: "RN-RF025-013"
    titulo: "Soft Delete Obrigatório"
    descricao: |
      Sistema NUNCA deve fazer DELETE físico. Exclusão lógica via Fl_Ativo = FALSE.
      Preservar histórico por 7 anos (compliance).
      Restauração possível apenas para administradores com justificativa.
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
      query_filter_global: true
    seguranca:
      soft_delete: true
      retencao_anos: 7
      query_filter_ef_core: true
      restauracao_apenas_admin: true

  - id: "RN-RF025-014"
    titulo: "Integração com Sistema de Patrimônio Externo"
    descricao: |
      Sistema DEVE sincronizar bidireccionalmente com ERP/patrimônio.
      Webhook Outbound ao criar/atualizar/baixar + API REST Inbound.
      Retry com backoff exponencial (2s, 4s, 8s) + DLQ (RabbitMQ) após 3 falhas.
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
      integracao_externa: true
    integracao:
      tipo: "bidirecional"
      webhook_outbound: true
      api_inbound: true
      formato: "JSON"
      versionamento: ["v1", "v2"]
      retry_policy:
        tentativas: 3
        backoff: [2, 4, 8]  # segundos
      dead_letter_queue: true
      sistemas_suportados: ["SAP", "TOTVS", "Protheus"]

  - id: "RN-RF025-015"
    titulo: "Inventário Periódico Obrigatório"
    descricao: |
      Sistema DEVE rastrear Dt_Ultimo_Inventario por ativo.
      Alertas: >R$5k (6 meses), >R$1k (12 meses), <R$1k (24 meses).
      Dashboard exibe ativos atrasados + notificação semanal para gestores.
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: false
      job_hangfire: true
    periodicidade:
      ativo_alto_valor:
        valor_minimo: 5000
        meses: 6
      ativo_medio_valor:
        valor_minimo: 1000
        meses: 12
      ativo_baixo_valor:
        valor_maximo: 1000
        meses: 24
    alertas:
      dashboard: true
      notificacao_email: "semanal"
      semaforo_vermelho_threshold: "10%"  # >10% ativos atrasados

# ==============================================================================
# PERMISSÕES RBAC
# ==============================================================================

permissoes_rbac:
  - permission_code: "FIN.ATIVOS.VIEW_ANY"
    descricao: "Listar ativos com filtros"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
      - "Financeiro"
    endpoint: "GET /api/ativos"

  - permission_code: "FIN.ATIVOS.VIEW"
    descricao: "Visualizar detalhes de ativo"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
      - "Financeiro"
      - "Usuário"
    endpoint: "GET /api/ativos/{id}"

  - permission_code: "FIN.ATIVOS.CREATE"
    descricao: "Criar novo ativo"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
    endpoint: "POST /api/ativos"

  - permission_code: "FIN.ATIVOS.UPDATE"
    descricao: "Editar ativo existente"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
    endpoint: "PUT /api/ativos/{id}"

  - permission_code: "FIN.ATIVOS.DELETE"
    descricao: "Soft delete de ativo"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
    endpoint: "DELETE /api/ativos/{id}"

  - permission_code: "FIN.ATIVOS.ALOCAR"
    descricao: "Alocar ativo a usuário"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
    endpoint: "POST /api/ativos/{id}/alocar"

  - permission_code: "FIN.ATIVOS.TRANSFERIR"
    descricao: "Transferir ativo entre localizações"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
    endpoint: "POST /api/ativos/{id}/transferir"

  - permission_code: "FIN.ATIVOS.DEVOLVER"
    descricao: "Devolver ativo (liberar)"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
      - "Usuário"  # Pode devolver o próprio ativo
    endpoint: "POST /api/ativos/{id}/devolver"

  - permission_code: "FIN.ATIVOS.MANUTENCAO"
    descricao: "Enviar ativo para manutenção"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
    endpoint: "POST /api/ativos/{id}/manutencao"

  - permission_code: "FIN.ATIVOS.BAIXAR"
    descricao: "Baixa patrimonial (requer aprovação)"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Controller"
    endpoint: "POST /api/ativos/{id}/baixar"

  - permission_code: "FIN.ATIVOS.INVENTARIAR"
    descricao: "Registrar inventário físico"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
      - "Inventariante"
    endpoint: "POST /api/ativos/{id}/inventariar"

  - permission_code: "FIN.ATIVOS.GERAR_QR"
    descricao: "Gerar PDF com QR Codes em lote"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
    endpoint: "GET /api/ativos/qr/gerar-lote"

  - permission_code: "FIN.ATIVOS.HISTORICO"
    descricao: "Visualizar histórico completo de movimentações"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
      - "Financeiro"
      - "Auditoria"
    endpoint: "GET /api/ativos/{id}/historico"

  - permission_code: "FIN.ATIVOS.DASHBOARD"
    descricao: "Acessar dashboard executivo"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor TI"
      - "Financeiro"
      - "Diretoria"
    endpoint: "GET /api/ativos/dashboard"

  - permission_code: "FIN.ATIVOS.REATIVAR"
    descricao: "Reativar ativo soft-deleted (admin only)"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
    endpoint: "POST /api/ativos/{id}/reativar"

# ==============================================================================
# API ENDPOINTS
# ==============================================================================

endpoints:
  - method: "GET"
    route: "/api/ativos"
    descricao: "Listar ativos com paginação e filtros"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.VIEW_ANY"
    request_dto: null
    response_dto: "PaginatedListDto<AtivoDto>"
    filtros:
      - "Tipo_Ativo"
      - "Status_Ativo"
      - "Id_Localizacao"
      - "Id_Usuario_Responsavel"
      - "Valor_Minimo"
      - "Valor_Maximo"
    paginacao: true
    cache: "5min"

  - method: "POST"
    route: "/api/ativos"
    descricao: "Criar novo ativo (gera QR Code automaticamente)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.CREATE"
    request_dto: "CreateAtivoCommand"
    response_dto: "Guid"
    validacoes:
      - "RN-RF025-001"
      - "RN-RF025-002"
      - "RN-RF025-008"
      - "RN-RF025-012"

  - method: "GET"
    route: "/api/ativos/{id}"
    descricao: "Buscar ativo por ID"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.VIEW"
    request_dto: null
    response_dto: "AtivoDetailDto"
    include:
      - "Movimentacoes"
      - "Inventarios"
      - "Anexos"

  - method: "PUT"
    route: "/api/ativos/{id}"
    descricao: "Atualizar dados do ativo"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.UPDATE"
    request_dto: "UpdateAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-008"
      - "RN-RF025-012"
      - "RN-RF025-013"

  - method: "DELETE"
    route: "/api/ativos/{id}"
    descricao: "Soft delete de ativo"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.DELETE"
    request_dto: null
    response_dto: "void"
    validacoes:
      - "RN-RF025-012"
      - "RN-RF025-013"

  - method: "GET"
    route: "/api/ativos/{id}/qr"
    descricao: "Buscar ativo por scan QR Code (mobile app)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.VIEW"
    request_dto: null
    response_dto: "AtivoDto"

  - method: "POST"
    route: "/api/ativos/{id}/alocar"
    descricao: "Alocar ativo a usuário (gera termo responsabilidade)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.ALOCAR"
    request_dto: "AlocarAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-003"
      - "RN-RF025-004"
      - "RN-RF025-005"

  - method: "POST"
    route: "/api/ativos/{id}/transferir"
    descricao: "Transferir ativo entre localizações (captura GPS)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.TRANSFERIR"
    request_dto: "TransferirAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-005"

  - method: "POST"
    route: "/api/ativos/{id}/devolver"
    descricao: "Devolver ativo (liberar para reuso)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.DEVOLVER"
    request_dto: "DevolverAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-003"
      - "RN-RF025-004"
      - "RN-RF025-005"

  - method: "POST"
    route: "/api/ativos/{id}/manutencao"
    descricao: "Enviar ativo para manutenção"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.MANUTENCAO"
    request_dto: "ManutencaoAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-003"
      - "RN-RF025-005"

  - method: "POST"
    route: "/api/ativos/{id}/baixar"
    descricao: "Baixa patrimonial (workflow aprovação 2 níveis)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.BAIXAR"
    request_dto: "BaixarAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-003"
      - "RN-RF025-005"
      - "RN-RF025-010"

  - method: "POST"
    route: "/api/ativos/{id}/inventariar"
    descricao: "Registrar inventário físico (foto + GPS)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.INVENTARIAR"
    request_dto: "InventariarAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-009"
      - "RN-RF025-015"

  - method: "GET"
    route: "/api/ativos/{id}/historico"
    descricao: "Timeline completa de movimentações"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.HISTORICO"
    request_dto: null
    response_dto: "List<MovimentacaoDto>"
    validacoes:
      - "RN-RF025-005"

  - method: "GET"
    route: "/api/ativos/qr/gerar-lote"
    descricao: "Gerar PDF com múltiplos QR Codes"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.GERAR_QR"
    request_dto: "List<Guid>"
    response_dto: "byte[]"  # PDF
    validacoes:
      - "RN-RF025-002"

  - method: "GET"
    route: "/api/ativos/dashboard"
    descricao: "Dashboard executivo (Chart.js)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.DASHBOARD"
    request_dto: null
    response_dto: "DashboardDto"
    cache: "5min"

  - method: "POST"
    route: "/api/ativos/{id}/reativar"
    descricao: "Reativar ativo soft-deleted (admin only)"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.REATIVAR"
    request_dto: "ReativarAtivoCommand"
    response_dto: "void"
    validacoes:
      - "RN-RF025-013"

  - method: "GET"
    route: "/api/ativos/inventario/pendentes"
    descricao: "Listar ativos pendentes de inventário"
    autenticacao: true
    authorization_policy: "FIN.ATIVOS.VIEW_ANY"
    request_dto: null
    response_dto: "List<AtivoDto>"
    validacoes:
      - "RN-RF025-015"

# ==============================================================================
# INTEGRACOES OBRIGATORIAS
# ==============================================================================

integracoes:
  internas:
    - nome: "Autenticacao"
      descricao: "JWT Bearer authentication"
      obrigatoria: true
    - nome: "Multi-Tenancy"
      descricao: "Filtro obrigatório por Id_Fornecedor"
      obrigatoria: true
    - nome: "Auditoria"
      descricao: "Created, CreatedBy, LastModified, LastModifiedBy"
      obrigatoria: true
    - nome: "Central de Funcionalidades"
      descricao: "Registro de funcionalidade no menu"
      obrigatoria: true
  externas:
    - sistema: "ERP (SAP, TOTVS)"
      tipo: "API REST + Webhooks"
      obrigatoria: true
      descricao: "Sincronização bidirecional de ativos e depreciação"
    - sistema: "Anatel API"
      tipo: "API REST"
      obrigatoria: false
      descricao: "Validação de IMEI para smartphones"
    - sistema: "DocuSign / Clicksign"
      tipo: "API REST"
      obrigatoria: false
      descricao: "Termo de responsabilidade digital"

# ==============================================================================
# SEGURANCA
# ==============================================================================

seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: true
  rbac: true
  rate_limiting:
    por_usuario: "100 req/min"
    por_ip: "500 req/min"
  validacao_entrada: "FluentValidation"
  protecao_sql_injection: "EF Core parameterizado"
  cors: "Domínios autorizados"
  headers_seguranca:
    - "Content-Security-Policy"
    - "X-Content-Type-Options"
    - "X-Frame-Options"
  autenticacao: "JWT Bearer"
  logging: "Serilog (JSON estruturado)"
  2fa_operacoes_criticas:
    - "Baixa de ativo"
    - "Alteração de valor > R$10k"

# ==============================================================================
# RASTREABILIDADE
# ==============================================================================

rastreabilidade:
  ucs_esperados:
    - "UC00-RF025-listar-ativos"
    - "UC01-RF025-criar-ativo"
    - "UC02-RF025-visualizar-ativo"
    - "UC03-RF025-editar-ativo"
    - "UC04-RF025-inativar-ativo"
  md_esperado: "MD-RF025-ativos"
  wf_esperado: "WF-RF025-ativos"
  tc_esperados:
    - "TC-RF025-BACKEND.md"
    - "TC-RF025-FRONTEND.md"
    - "TC-RF025-SEGURANCA.md"
    - "TC-RF025-E2E.md"
  user_stories: "user-stories.yaml"

dependencias:
  upstream:
    - documentacao_id: "RF-USR-001"
      descricao: "Gestão de Usuários (campo Id_Usuario_Responsavel)"
    - documentacao_id: "RF-LOC-001"
      descricao: "Gestão de Localizações (hierarquia Filial → Andar → Sala)"
    - documentacao_id: "RF-MRC-001"
      descricao: "Gestão de Marcas e Modelos (normalização)"
  downstream:
    - documentacao_id: "RF-CTR-001"
      descricao: "Gestão de Contratos (vincular ativos a contratos)"
    - documentacao_id: "RF-CHA-001"
      descricao: "Gestão de Chamados (vincular manutenções a tickets)"
    - documentacao_id: "RF-REL-001"
      descricao: "Relatórios Gerenciais (dashboards consolidados)"

# ==============================================================================
# CATALOG (FUNCIONALIDADES CRUD OBRIGATORIAS)
# ==============================================================================

catalog:
  crud:
    - id: "RF-CRUD-01"
      title: "Criar ativo com QR Code automático"
      required: true
    - id: "RF-CRUD-02"
      title: "Listar ativos com filtros e paginação"
      required: true
    - id: "RF-CRUD-03"
      title: "Visualizar detalhes e histórico"
      required: true
    - id: "RF-CRUD-04"
      title: "Atualizar dados do ativo"
      required: true
    - id: "RF-CRUD-05"
      title: "Soft delete de ativo"
      required: true

  validacoes:
    - id: "RF-VAL-01"
      title: "Validar número patrimônio único"
      required: true
    - id: "RF-VAL-02"
      title: "Validar transições de status"
      required: true
    - id: "RF-VAL-03"
      title: "Validar campos obrigatórios por tipo"
      required: true
    - id: "RF-VAL-04"
      title: "Validar IMEI (smartphones)"
      required: false
    - id: "RF-VAL-05"
      title: "Validar GPS (inventário mobile)"
      required: true

  seguranca:
    - id: "RF-SEC-01"
      title: "Isolamento de tenant obrigatório"
      required: true
    - id: "RF-SEC-02"
      title: "Permissões RBAC granulares"
      required: true
    - id: "RF-SEC-03"
      title: "Soft delete obrigatório"
      required: true
    - id: "RF-SEC-04"
      title: "Auditoria completa de operações"
      required: true

  jobs:
    - id: "RF-JOB-01"
      title: "Depreciação automática mensal"
      required: true
    - id: "RF-JOB-02"
      title: "Alertas de garantia diários"
      required: true
    - id: "RF-JOB-03"
      title: "Inventário periódico obrigatório"
      required: true

exclusions:
  documentacao_items: []

# ==============================================================================
# HISTORICO
# ==============================================================================

historico:
  - versao: "2.0"
    data: "2025-12-30"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração v1.0 → v2.0 - Separação RF/RL completa, estrutura YAML 100% sincronizada com RF.md"
  - versao: "1.0"
    data: "2025-11-04"
    autor: "Equipe IControlIT"
    descricao: "Versão inicial com documentação legado misturada"
