# RL-RF040 — Referência ao Legado (Gestão de Troncos Telefônicos)
# Versão: 1.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br

rf_id: RF040
titulo: "Gestão de Troncos Telefônicos"

legado:
  sistema: "IControlIT v1 (VB.NET + ASP.NET Web Forms)"
  versao: "1.0"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server"
  multi_tenant: false
  auditoria: "none"  # Inexistente para eventos de telefonia

# =============================================================================
# SEÇÃO CRÍTICA: Referências ao Legado com Destino Obrigatório
# =============================================================================
# IMPORTANTE: RF040 é uma funcionalidade 100% NOVA sem equivalente no legado
# Todas as referências documentam a AUSÊNCIA de funcionalidade legada
# =============================================================================

referencias:
  # --- Processos Manuais Substituídos ---
  - id: "LEG-RF040-001"
    tipo: "regra_negocio"
    nome: "Verificação Manual de Status de Troncos"
    caminho: "Processo manual: CLI do Asterisk (sip show peers)"
    descricao: |
      Equipe de TI verificava status de troncos manualmente via CLI do PABX Asterisk.
      Comando: asterisk -rx "sip show peers"
      Frequência: 1x por dia (ou sob demanda quando usuários reportavam problemas)
      Não havia registro histórico ou alertas automáticos.

    destino: "substituido"
    justificativa: |
      Substituído por monitoramento automático em tempo real (RN-RF040-01).
      Sistema moderno verifica status a cada 30 segundos usando protocolos apropriados
      (SIP OPTIONS, SNMP GET, API REST) com histórico completo e alertas proativos.
      Ganho: 100% automação + SLA de detecção <1 minuto vs verificação diária.

    documentacao_item_relacionado: "RN-RF040-01"
    uc_relacionado: "UC02"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF040-002"
    tipo: "regra_negocio"
    nome: "Failover Manual de Troncos"
    caminho: "Processo manual: Reconfiguração de rotas no PABX"
    descricao: |
      Em caso de falha de tronco, equipe de TI reconfigurava rotas manualmente no PABX.
      Tempo médio de detecção: 15-60 minutos (dependia de usuários reportarem)
      Tempo médio de correção: 30-120 minutos (reconfiguração + testes)
      Downtime total: 45 minutos a 3 horas

    destino: "substituido"
    justificativa: |
      Substituído por failover automático em <5 segundos (RN-RF040-03).
      Sistema moderno detecta falha após 3 tentativas (90s) e executa failover
      automaticamente com notificações simultâneas (SMS, e-mail, push, chamada).
      Ganho: Redução de 99,86% no tempo de failover (3h → 5s).

    documentacao_item_relacionado: "RN-RF040-03"
    uc_relacionado: "UC03"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF040-003"
    tipo: "regra_negocio"
    nome: "Custeio de Telefonia via Planilha Excel"
    caminho: "Processo manual: Planilha mensal enviada por e-mail"
    descricao: |
      Custeio de troncos era feito manualmente em planilha Excel separada do IControlIT.
      Departamento financeiro recebia faturas das operadoras via e-mail.
      Analista digitava valores na planilha e rateava manualmente por departamento.
      Não havia integração com ERP ou sistema de custeio do IControlIT.
      Erros de digitação eram comuns (10-15% de retrabalho mensal).

    destino: "substituido"
    justificativa: |
      Substituído por custeio automático com rateio proporcional (RN-RF040-07).
      Sistema moderno calcula custo fixo + variável automaticamente e rateia por
      centro de custo baseado em minutos utilizados. Integração com ERP (SAP, TOTVS).
      Ganho: Eliminação de planilhas manuais + redução de 100% de erros de digitação.

    documentacao_item_relacionado: "RN-RF040-07"
    uc_relacionado: "UC00"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF040-004"
    tipo: "regra_negocio"
    nome: "Análise de Disponibilidade Manual"
    caminho: "Processo manual: Extração de logs do PABX"
    descricao: |
      Relatórios de disponibilidade eram gerados manualmente no final do mês.
      Equipe de TI extraia logs do PABX e analisava manualmente em planilha.
      Não havia cálculo de MTBF, MTTR ou comparação com SLA contratado.
      Tempo necessário: 4-8 horas por mês.
      Imprecisão alta (dependia de interpretação manual de logs).

    destino: "substituido"
    justificativa: |
      Substituído por relatório automático de disponibilidade (RN-RF040-09).
      Sistema moderno calcula uptime %, compara com SLA (99,9%), identifica créditos
      devidos e envia relatório automaticamente no dia 5 de cada mês.
      Ganho: 100% automação + precisão total + compliance com SLA.

    documentacao_item_relacionado: "RN-RF040-09"
    uc_relacionado: "UC04"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 3

  # --- Funcionalidades Inexistentes no Legado (Novas) ---
  - id: "LEG-RF040-005"
    tipo: "regra_negocio"
    nome: "Métricas de QoS (Jitter, Latência, Packet Loss, MOS)"
    caminho: "N/A - Funcionalidade inexistente no legado"
    descricao: |
      Sistema legado NÃO coletava métricas de qualidade de voz.
      Não havia medição de jitter, latência, packet loss ou MOS score.
      Problemas de qualidade eram identificados apenas quando usuários reclamavam.
      Não havia baseline de qualidade ou histórico de tendências.

    destino: "substituido"
    justificativa: |
      Nova funcionalidade criada do zero (RN-RF040-02, RN-RF040-11).
      Sistema moderno coleta métricas a cada 30s e calcula MOS score (E-Model ITU-T G.107).
      Dashboard em tempo real com histórico de 90 dias. Alertas proativos se MOS <2.0.
      Ganho: Visibilidade completa de qualidade + proatividade vs reatividade.

    documentacao_item_relacionado: "RN-RF040-02"
    uc_relacionado: "UC02"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF040-006"
    tipo: "regra_negocio"
    nome: "Balanceamento de Carga entre Troncos"
    caminho: "N/A - Funcionalidade inexistente no legado"
    descricao: |
      Sistema legado NÃO possuía balanceamento de carga.
      Troncos eram configurados com prioridade fixa no PABX.
      Sobrecarga de troncos individuais era comum (alguns com 100%, outros com 20%).
      Não havia redistribuição dinâmica de chamadas.

    destino: "substituido"
    justificativa: |
      Nova funcionalidade criada do zero (RN-RF040-04).
      Sistema moderno distribui chamadas com algoritmo Least Call Count (menor carga).
      Utilização uniforme de recursos + preferência por troncos com melhor MOS.
      Ganho: Otimização de recursos + melhor experiência de usuário.

    documentacao_item_relacionado: "RN-RF040-04"
    uc_relacionado: "UC02"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF040-007"
    tipo: "regra_negocio"
    nome: "Alertas Proativos de Congestionamento"
    caminho: "N/A - Funcionalidade inexistente no legado"
    descricao: |
      Sistema legado NÃO possuía alertas proativos.
      Congestionamento era detectado apenas quando chamadas eram rejeitadas (100% utilização).
      Não havia monitoramento de utilização ou alertas preventivos.

    destino: "substituido"
    justificativa: |
      Nova funcionalidade criada do zero (RN-RF040-05).
      Sistema moderno alerta se utilização >80% por >5 minutos consecutivos.
      Redistribuição automática de 50% da carga + sugestões de ações corretivas.
      Ganho: Prevenção de rejeições de chamadas + melhor planejamento de capacidade.

    documentacao_item_relacionado: "RN-RF040-05"
    uc_relacionado: "UC02"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF040-008"
    tipo: "regra_negocio"
    nome: "Simulador de Economia (SIP vs E1)"
    caminho: "N/A - Funcionalidade inexistente no legado"
    descricao: |
      Sistema legado NÃO possuía ferramenta de análise de custo-benefício.
      Decisões de migração tecnológica eram baseadas em "feeling" ou consultoria externa cara.
      Não havia simulação de ROI ou cálculo de break-even point.

    destino: "substituido"
    justificativa: |
      Nova funcionalidade criada do zero (RN-RF040-12).
      Sistema moderno simula economia de migração E1→SIP baseado em uso real (6 meses).
      Cálculo de TCO, ROI, break-even point e projeção 12/24/36 meses.
      Ganho: Decisões baseadas em dados + eliminação de consultoria externa.

    documentacao_item_relacionado: "RN-RF040-12"
    uc_relacionado: "UC06"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF040-009"
    tipo: "regra_negocio"
    nome: "Detecção de Loops e Chamadas Anômalas"
    caminho: "N/A - Funcionalidade inexistente no legado"
    descricao: |
      Sistema legado NÃO possuía detecção de anomalias.
      Loops de chamada eram identificados apenas quando fatura vinha alta.
      Fraudes telefônicas (chamadas DDI para países de risco) passavam despercebidas.
      Prejuízo financeiro frequente (média R$ 5.000/mês por fraudes não detectadas).

    destino: "substituido"
    justificativa: |
      Nova funcionalidade criada do zero (RN-RF040-13).
      Sistema moderno detecta loops (>10 chamadas mesmo número em <5 min) e fraudes.
      Bloqueio automático + alerta + criação de ticket de suporte.
      Ganho: Economia de ~R$ 60.000/ano + segurança proativa.

    documentacao_item_relacionado: "RN-RF040-13"
    uc_relacionado: "UC02"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF040-010"
    tipo: "componente"
    nome: "Integração Automática com PABX"
    caminho: "N/A - Funcionalidade inexistente no legado"
    descricao: |
      Sistema legado NÃO tinha integração automatizada com PABX.
      Alterações de configuração eram feitas manualmente via CLI ou interface web.
      Não havia sincronização de dados entre IControlIT e PABX.

    destino: "substituido"
    justificativa: |
      Nova funcionalidade criada do zero (RN-RF040-10).
      Sistema moderno integra via API REST + SNMP com suporte a Asterisk, FreePBX, Elastix, 3CX.
      Controle centralizado de roteamento + coleta automática de métricas.
      Ganho: 100% automação + eliminação de erros manuais + auditoria completa.

    documentacao_item_relacionado: "RN-RF040-10"
    uc_relacionado: "UC02"
    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

# Telas Legadas (NENHUMA - RF040 é 100% novo)
telas: []

# WebServices Legados (NENHUM - RF040 é 100% novo)
servicos: []

# Tabelas Legadas (NENHUMA - RF040 é 100% novo)
tabelas: []

# Regras de Negócio Implícitas (Processos Manuais Documentados)
regras_implicitas:
  - id: "RL-RN-001"
    descricao: |
      Verificação diária manual de status de troncos via CLI do Asterisk.
      Comando: asterisk -rx "sip show peers"
      Frequência: 1x por dia (manhã) ou sob demanda
    fonte: "Processo operacional da equipe de TI (não documentado formalmente)"

  - id: "RL-RN-002"
    descricao: |
      Failover manual em caso de falha: reconfiguração de rotas no dialplan do Asterisk.
      Tempo médio: 45 min a 3 horas (dependendo de horário e disponibilidade de técnico)
    fonte: "Processo operacional da equipe de TI (não documentado formalmente)"

  - id: "RL-RN-003"
    descricao: |
      Análise mensal de custos via planilha Excel.
      Analista financeiro digitava valores das faturas e rateava manualmente.
      Taxa de erro: 10-15% (erros de digitação, rateio incorreto)
    fonte: "Processo do departamento financeiro (planilha padrão compartilhada)"

  - id: "RL-RN-004"
    descricao: |
      Relatórios de disponibilidade gerados manualmente a partir de logs do PABX.
      Tempo necessário: 4-8 horas por mês.
      Não havia cálculo de MTBF, MTTR ou SLA.
    fonte: "Processo operacional da equipe de TI (extração e análise de logs)"

# Gap Analysis (Legado x Moderno)
gap_analysis:
  - item: "Cadastro de Troncos"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - CRUD completo de troncos"

  - item: "Monitoramento em Tempo Real"
    existe_legado: false
    existe_moderno: true
    notas: "Substituiu verificação manual diária - Polling automático 30s"

  - item: "Métricas de QoS"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Jitter, latência, packet loss, MOS"

  - item: "Failover Automático"
    existe_legado: false
    existe_moderno: true
    notas: "Substituiu failover manual (3h → 5s) - Ganho de 99,86%"

  - item: "Balanceamento de Carga"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Least Call Count"

  - item: "Custeio Automatizado"
    existe_legado: false
    existe_moderno: true
    notas: "Substituiu planilha Excel - Integração com ERP"

  - item: "Dashboard de QoS"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Tempo real + histórico 90 dias"

  - item: "Relatórios MTBF/MTTR"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Análise de confiabilidade"

  - item: "Simulador de Economia"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - ROI SIP vs E1"

  - item: "Detecção de Anomalias"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Loops, fraudes, segurança"

  - item: "Integração com PABX"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - API REST + SNMP"

  - item: "Alertas Proativos"
    existe_legado: false
    existe_moderno: true
    notas: "Substituiu alertas reativos - SMS/e-mail/push/chamada"

  - item: "Auditoria de Telefonia"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Compliance LGPD (7 anos)"

  - item: "Multi-Tenancy"
    existe_legado: false
    existe_moderno: true
    notas: "Funcionalidade 100% nova - Isolamento por Id_Fornecedor"

# Decisões de Modernização
decisoes_modernizacao:
  - decisao: "Criar funcionalidade completamente nova (100% zero-to-one)"
    motivo: |
      Sistema legado não possuía gestão de troncos.
      Processos eram 100% manuais e externos ao IControlIT.
      Impossibilidade de migração de dados (não há dados a migrar).
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Integração bidirecional com PABX via API REST e SNMP"
    motivo: |
      Legado não tinha integração automatizada.
      Tecnologias modernas (API REST) são mais confiáveis que CLI.
      SNMP é padrão de mercado para monitoramento.
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Priorizar automação de failover (<5 segundos)"
    motivo: |
      Legado requeria intervenção manual (>1 hora de downtime).
      Alta disponibilidade é requisito crítico de negócio.
      SLA de 99,9% uptime é padrão de mercado.
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Coletar métricas de QoS e calcular MOS score"
    motivo: |
      Legado não coletava métricas de qualidade.
      MOS é padrão da indústria (ITU-T G.107).
      Permite tomada de decisão baseada em dados objetivos.
    impacto: "medio"
    data: "2025-12-30"

# Riscos de Migração
riscos_migracao:
  - risco: "Ausência de conhecimento de usuários sobre funcionalidade nova"
    impacto: "alto"
    probabilidade: "alta"
    mitigacao: |
      - Treinamento completo (presencial + online)
      - Documentação detalhada (manual de usuário + vídeos tutoriais)
      - Suporte dedicado nos primeiros 90 dias
      - Período de adaptação (piloto em 1 empresa antes de rollout)

  - risco: "Resistência à mudança (processos manuais → automatizados)"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      - Demonstração de benefícios tangíveis (ROI, uptime, economia)
      - Envolvimento de usuários-chave no piloto
      - Feedback contínuo e ajustes
      - Change management (comunicação clara dos benefícios)

  - risco: "Complexidade de integração com múltiplos modelos de PABX"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      - Suporte a modelos principais (Asterisk, FreePBX, Elastix, 3CX)
      - Ambiente de testes/sandbox para validação
      - Documentação oficial dos fabricantes
      - Comunidades ativas para suporte técnico
      - Modo degradado (visualização sem controle) em caso de falha

  - risco: "Falta de dados históricos de troncos para baseline"
    impacto: "baixo"
    probabilidade: "baixa"
    mitigacao: |
      - Cadastro inicial manual de troncos
      - Importação de configuração atual do PABX via API
      - Período de coleta de baseline (30 dias) antes de análises críticas
      - Histórico começa do zero (não há dados a migrar)

  - risco: "Curva de aprendizado de equipe de desenvolvimento"
    impacto: "medio"
    probabilidade: "baixa"
    mitigacao: |
      - Documentação técnica detalhada (RF, UC, MD, TC)
      - PoC (Proof of Concept) inicial com 1 tronco
      - Revisões de código + pair programming
      - Testes automatizados (TC-RF040.yaml) para validação contínua

  - risco: "Dependência de sistemas externos (PABX) para funcionamento"
    impacto: "alto"
    probabilidade: "baixa"
    mitigacao: |
      - Modo degradado: visualização de histórico sem controle em tempo real
      - Retry automático em caso de falha de comunicação (3 tentativas)
      - Alertas para equipe de TI em caso de perda de integração
      - SLA de recuperação de integração (<15 minutos)

# Rastreabilidade (Legado → Moderno)
rastreabilidade:
  - elemento_legado: "Verificação manual diária de troncos (CLI)"
    referencia_rf: "RN-RF040-01"
    referencia_uc: "UC02"
    status: "substituido"

  - elemento_legado: "Failover manual (>1h downtime)"
    referencia_rf: "RN-RF040-03"
    referencia_uc: "UC03"
    status: "substituido"

  - elemento_legado: "Custeio via planilha Excel"
    referencia_rf: "RN-RF040-07"
    referencia_uc: "UC00"
    status: "substituido"

  - elemento_legado: "Relatórios manuais de disponibilidade"
    referencia_rf: "RN-RF040-09"
    referencia_uc: "UC04"
    status: "substituido"

  - elemento_legado: "Nenhum (métricas de QoS inexistentes)"
    referencia_rf: "RN-RF040-02, RN-RF040-11"
    referencia_uc: "UC02"
    status: "funcionalidade_nova"

  - elemento_legado: "Nenhum (balanceamento inexistente)"
    referencia_rf: "RN-RF040-04"
    referencia_uc: "UC02"
    status: "funcionalidade_nova"

  - elemento_legado: "Nenhum (alertas inexistentes)"
    referencia_rf: "RN-RF040-05"
    referencia_uc: "UC02"
    status: "funcionalidade_nova"

  - elemento_legado: "Nenhum (simulador inexistente)"
    referencia_rf: "RN-RF040-12"
    referencia_uc: "UC06"
    status: "funcionalidade_nova"

  - elemento_legado: "Nenhum (detecção de anomalias inexistente)"
    referencia_rf: "RN-RF040-13"
    referencia_uc: "UC02"
    status: "funcionalidade_nova"

  - elemento_legado: "Nenhum (integração PABX inexistente)"
    referencia_rf: "RN-RF040-10"
    referencia_uc: "UC02"
    status: "funcionalidade_nova"

# Changelog
changelog:
  - versao: "1.0"
    data: "2025-12-30"
    descricao: "Documentação da ausência de funcionalidade equivalente no legado - RF040 é 100% nova com 10 referências (todas com destino preenchido)"
    autor: "Agência ALC - alc.dev.br"
