rf_id: RF050
rf_title: "Gestão de Linhas Móveis e Chips SIM"
versao_governanca: "2.0"
data_migracao: "2025-12-30"
epic: "EPIC009-AST-Ativos-Inventario"
fase: "Fase 6 - Ativos, Auditoria e Integrações"

# ==============================================================================
# REGRAS DE NEGÓCIO
# ==============================================================================

regras_negocio:
  - id: "RN-050-001"
    titulo: "Estrutura de Linha Móvel e Chip SIM"
    descricao: "Linha móvel e chip SIM são entidades distintas mas relacionadas. Uma linha representa o número telefônico lógico, enquanto o chip é o hardware físico associado."
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "estrutura_dados"
      mensagem_erro: "Estrutura de linha ou chip inválida"
      http_code: 400

  - id: "RN-050-002"
    titulo: "Operação de Ativação de Linha"
    descricao: "Ativação de nova linha móvel requer chip SIM disponível no estoque, operadora e plano selecionados"
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      workflow_aprovacao: true
    validacao:
      tipo: "pre_requisitos"
      mensagem_erro: "Pré-requisitos de ativação não atendidos"
      http_code: 400

  - id: "RN-050-003"
    titulo: "Operação de Portabilidade"
    descricao: "Portabilidade permite manter número ao trocar de operadora com protocolo ANATEL e prazo mínimo 7 dias úteis"
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      workflow_aprovacao: true
    validacao:
      tipo: "protocolo_anatel"
      mensagem_erro: "Protocolo ANATEL inválido ou prazo insuficiente"
      http_code: 400

  - id: "RN-050-004"
    titulo: "Operação de Troca de Chip"
    descricao: "Troca de chip substitui chip defeituoso/perdido/roubado mantendo número da linha"
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "motivo_troca"
      mensagem_erro: "Motivo de troca inválido ou chip não disponível"
      http_code: 400

  - id: "RN-050-005"
    titulo: "Controle de Estoque de Chips"
    descricao: "Sistema gerencia estoque físico de chips por operadora com estados e movimentações"
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "estoque"
      mensagem_erro: "Estoque de chips insuficiente"
      http_code: 400

  - id: "RN-050-006"
    titulo: "Rastreamento de ICCID, IMSI e IMEI"
    descricao: "Sistema rastreia identificadores únicos de linha, chip e aparelho"
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "formato"
      mensagem_erro: "Formato de ICCID, IMSI ou IMEI inválido"
      http_code: 400

  - id: "RN-050-007"
    titulo: "Workflow de Aprovação para Operações Críticas"
    descricao: "Operações financeiramente relevantes requerem aprovação multi-nível"
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      workflow_aprovacao: true
    validacao:
      tipo: "aprovacao"
      mensagem_erro: "Operação pendente de aprovação"
      http_code: 403

  - id: "RN-050-008"
    titulo: "Integração com APIs de Operadoras"
    descricao: "Sistema sincroniza automaticamente dados com APIs de operadoras"
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
    validacao:
      tipo: "integracao"
      mensagem_erro: "Falha na sincronização com operadora"
      http_code: 500

  - id: "RN-050-009"
    titulo: "Alertas de Vencimento de Contrato"
    descricao: "Sistema envia alertas proativos 30/60/90 dias antes do vencimento"
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: true
    validacao:
      tipo: "alerta"
      mensagem_erro: null
      http_code: null

  - id: "RN-050-010"
    titulo: "Identificação de Linhas Subutilizadas"
    descricao: "Sistema analisa consumo mensal e identifica linhas com baixo uso"
    criticidade: "BAIXA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: true
    validacao:
      tipo: "analise"
      mensagem_erro: null
      http_code: null

  - id: "RN-050-011"
    titulo: "Operação de Suspensão Temporária"
    descricao: "Permite suspender linha temporariamente com cobrança reduzida"
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      workflow_aprovacao: true
    validacao:
      tipo: "prazo"
      mensagem_erro: "Prazo de suspensão inválido"
      http_code: 400

  - id: "RN-050-012"
    titulo: "Operação de Cancelamento Definitivo"
    descricao: "Cancelamento libera número e chip com cálculo de multa se aplicável"
    criticidade: "ALTA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
      workflow_aprovacao: true
    validacao:
      tipo: "cancelamento"
      mensagem_erro: "Cancelamento bloqueado por pendências financeiras"
      http_code: 400

  - id: "RN-050-013"
    titulo: "Dashboard de Estoque e Status de Linhas"
    descricao: "Interface exibe visualmente status em tempo real"
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: true
    validacao:
      tipo: "performance"
      mensagem_erro: null
      http_code: null

  - id: "RN-050-014"
    titulo: "Importação de Linhas via CSV/Excel"
    descricao: "Permite importação em lote de linhas"
    criticidade: "MÉDIA"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "arquivo"
      mensagem_erro: "Formato de arquivo inválido"
      http_code: 400

  - id: "RN-050-015"
    titulo: "Auditoria Completa de Operações de Linhas"
    descricao: "Todas operações são auditadas com retenção 7 anos"
    criticidade: "CRÍTICA"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
    validacao:
      tipo: "auditoria"
      mensagem_erro: null
      http_code: null

# ==============================================================================
# PERMISSÕES RBAC
# ==============================================================================

permissoes_rbac:
  - permission_code: "AST.LINHAS_MOVEIS.VIEW_ANY"
    descricao: "Visualizar lista de linhas móveis"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Operador"
    endpoint: "GET /api/gestao/linhas-moveis"

  - permission_code: "AST.LINHAS_MOVEIS.VIEW"
    descricao: "Visualizar detalhes de uma linha"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Operador"
    endpoint: "GET /api/gestao/linhas-moveis/{id}"

  - permission_code: "AST.LINHAS_MOVEIS.CREATE"
    descricao: "Criar nova linha móvel"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "POST /api/gestao/linhas-moveis"

  - permission_code: "AST.LINHAS_MOVEIS.UPDATE"
    descricao: "Atualizar linha existente"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "PUT /api/gestao/linhas-moveis/{id}"

  - permission_code: "AST.LINHAS_MOVEIS.ACTIVATE"
    descricao: "Ativar nova linha"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "POST /api/gestao/linhas-moveis/{id}/ativar"

  - permission_code: "AST.LINHAS_MOVEIS.PORTABILITY"
    descricao: "Solicitar portabilidade"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "POST /api/gestao/linhas-moveis/{id}/portabilidade"

  - permission_code: "AST.LINHAS_MOVEIS.SWAP_CHIP"
    descricao: "Trocar chip de linha"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Operador"
    endpoint: "POST /api/gestao/linhas-moveis/{id}/trocar-chip"

  - permission_code: "AST.LINHAS_MOVEIS.SUSPEND"
    descricao: "Suspender linha temporariamente"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "POST /api/gestao/linhas-moveis/{id}/suspender"

  - permission_code: "AST.LINHAS_MOVEIS.CANCEL"
    descricao: "Cancelar linha definitivamente"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "POST /api/gestao/linhas-moveis/{id}/cancelar"

  - permission_code: "AST.LINHAS_MOVEIS.DELETE"
    descricao: "Soft delete de linha"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
    endpoint: "DELETE /api/gestao/linhas-moveis/{id}"

  - permission_code: "AST.LINHAS_MOVEIS.APPROVE"
    descricao: "Aprovar operações críticas"
    roles_autorizadas:
      - "Super Admin"
      - "Gestor"
      - "Financeiro"
    endpoint: "POST /api/gestao/operacoes/{id}/aprovar"

  - permission_code: "AST.LINHAS_MOVEIS.IMPORT"
    descricao: "Importar linhas via CSV/Excel"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "POST /api/gestao/linhas-moveis/importar"

  - permission_code: "AST.LINHAS_MOVEIS.EXPORT"
    descricao: "Exportar relatórios"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Operador"
    endpoint: "GET /api/gestao/linhas-moveis/exportar"

  - permission_code: "AST.LINHAS_MOVEIS.DASHBOARD"
    descricao: "Acessar dashboard de estoque"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Operador"
    endpoint: "GET /api/gestao/chips-sim/dashboard"

  - permission_code: "AST.CHIPS_SIM.MANAGE"
    descricao: "Gerenciar estoque de chips"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "GET /api/gestao/chips-sim"

  - permission_code: "AST.LINHAS_MOVEIS.SYNC"
    descricao: "Sincronizar dados com operadora"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
    endpoint: "POST /api/gestao/linhas-moveis/sincronizar/{operadora}"

  - permission_code: "AST.LINHAS_MOVEIS.AUDIT"
    descricao: "Consultar auditoria de operações"
    roles_autorizadas:
      - "Super Admin"
      - "Auditor"
    endpoint: "GET /api/gestao/linhas-moveis/{id}/auditoria"

# ==============================================================================
# API ENDPOINTS
# ==============================================================================

endpoints:
  - method: "GET"
    route: "/api/gestao/linhas-moveis"
    descricao: "Listar linhas com filtros e paginação"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.VIEW_ANY"
    request_dto: "Query params (page, pageSize, status, operadora)"
    response_dto: "PaginatedListDto<LinhaMovelDto>"

  - method: "GET"
    route: "/api/gestao/linhas-moveis/{id}"
    descricao: "Obter detalhes de uma linha"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.VIEW"
    request_dto: "Path param (id)"
    response_dto: "LinhaMovelDto"

  - method: "POST"
    route: "/api/gestao/linhas-moveis"
    descricao: "Criar nova linha"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.CREATE"
    request_dto: "CreateLinhaMovelCommand"
    response_dto: "Guid"

  - method: "PUT"
    route: "/api/gestao/linhas-moveis/{id}"
    descricao: "Atualizar linha existente"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.UPDATE"
    request_dto: "UpdateLinhaMovelCommand"
    response_dto: "bool"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/{id}/ativar"
    descricao: "Ativar nova linha"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.ACTIVATE"
    request_dto: "ActivateLinhaMovelCommand"
    response_dto: "bool"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/{id}/portabilidade"
    descricao: "Solicitar portabilidade"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.PORTABILITY"
    request_dto: "PortabilidadeLinhaCommand"
    response_dto: "Guid (ID da operação)"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/{id}/trocar-chip"
    descricao: "Trocar chip da linha"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.SWAP_CHIP"
    request_dto: "TrocaChipCommand"
    response_dto: "bool"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/{id}/suspender"
    descricao: "Suspender linha temporariamente"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.SUSPEND"
    request_dto: "SuspendLinhaMovelCommand"
    response_dto: "bool"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/{id}/cancelar"
    descricao: "Cancelar linha definitivamente"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.CANCEL"
    request_dto: "CancelLinhaMovelCommand"
    response_dto: "bool"

  - method: "DELETE"
    route: "/api/gestao/linhas-moveis/{id}"
    descricao: "Soft delete de linha"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.DELETE"
    request_dto: "Path param (id)"
    response_dto: "bool"

  - method: "GET"
    route: "/api/gestao/linhas-moveis/{id}/historico"
    descricao: "Obter histórico de operações"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.VIEW"
    request_dto: "Path param (id)"
    response_dto: "List<OperacaoLinhaDto>"

  - method: "GET"
    route: "/api/gestao/chips-sim"
    descricao: "Listar chips no estoque"
    autenticacao: true
    authorization_policy: "AST.CHIPS_SIM.MANAGE"
    request_dto: "Query params (status, operadora)"
    response_dto: "PaginatedListDto<ChipSIMDto>"

  - method: "GET"
    route: "/api/gestao/chips-sim/dashboard"
    descricao: "Obter dados do dashboard de estoque"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.DASHBOARD"
    request_dto: null
    response_dto: "EstoqueDashboardDto"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/importar"
    descricao: "Importar linhas via CSV/Excel"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.IMPORT"
    request_dto: "IFormFile"
    response_dto: "ImportResultDto"

  - method: "GET"
    route: "/api/gestao/linhas-moveis/exportar"
    descricao: "Exportar linhas para arquivo"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.EXPORT"
    request_dto: "Query params (formato, filtros)"
    response_dto: "FileContentResult"

  - method: "POST"
    route: "/api/gestao/linhas-moveis/sincronizar/{operadora}"
    descricao: "Sincronizar dados com operadora"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.SYNC"
    request_dto: "Path param (operadora)"
    response_dto: "SyncResultDto"

  - method: "POST"
    route: "/api/gestao/operacoes/{id}/aprovar"
    descricao: "Aprovar operação pendente"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.APPROVE"
    request_dto: "ApproveOperacaoCommand"
    response_dto: "bool"

  - method: "POST"
    route: "/api/gestao/operacoes/{id}/rejeitar"
    descricao: "Rejeitar operação pendente"
    autenticacao: true
    authorization_policy: "AST.LINHAS_MOVEIS.APPROVE"
    request_dto: "RejectOperacaoCommand"
    response_dto: "bool"

# ==============================================================================
# KPIs E MÉTRICAS
# ==============================================================================

kpis:
  - nome: "Taxa de Ativação"
    descricao: "Quantidade de ativações de linhas por mês"
    meta: "Monitoramento contínuo"
    log_obrigatorio: true

  - nome: "Taxa de Portabilidade"
    descricao: "Quantidade de portabilidades por mês"
    meta: "Monitoramento contínuo"
    log_obrigatorio: true

  - nome: "Taxa de Cancelamento"
    descricao: "Percentual de cancelamentos sobre linhas ativas"
    meta: "<5% ao mês"
    log_obrigatorio: true

  - nome: "Economia por Otimização"
    descricao: "Valor economizado com downgrade/cancelamento de linhas subutilizadas"
    meta: "Maximizar economia"
    log_obrigatorio: true

  - nome: "Estoque de Chips"
    descricao: "Quantidade de chips disponíveis por operadora"
    meta: ">10 chips por operadora"
    log_obrigatorio: true

  - nome: "Tempo Médio de Aprovação"
    descricao: "Tempo médio para aprovar operações críticas"
    meta: "<24 horas"
    log_obrigatorio: true

  - nome: "Linhas Subutilizadas"
    descricao: "Percentual de linhas com consumo abaixo de 10%"
    meta: "Minimizar desperdício"
    log_obrigatorio: true

  - nome: "Tempo de Resposta API"
    descricao: "Tempo de resposta P95 das APIs de linhas"
    meta: "<300ms"
    log_obrigatorio: true

  - nome: "Taxa de Sucesso Sincronização"
    descricao: "Percentual de sincronizações bem-sucedidas com operadoras"
    meta: ">95%"
    log_obrigatorio: true

  - nome: "Disponibilidade do Sistema"
    descricao: "Uptime do sistema de gestão de linhas"
    meta: ">99.9%"
    log_obrigatorio: true

# ==============================================================================
# ALERTAS CRÍTICOS
# ==============================================================================

alertas:
  - evento: "Estoque de Chips Baixo"
    threshold: "<10 chips por operadora"
    severidade: "ALTA"
    canal_notificacao:
      - "email"
      - "slack"

  - evento: "Vencimento de Contrato Próximo"
    threshold: "30/60/90 dias antes do vencimento"
    severidade: "MÉDIA"
    canal_notificacao:
      - "email"
      - "notificacao_inapp"

  - evento: "Falha na Sincronização com Operadora"
    threshold: ">3 falhas consecutivas"
    severidade: "ALTA"
    canal_notificacao:
      - "email"
      - "slack"

  - evento: "Múltiplas Trocas de Chip Suspeitas"
    threshold: ">3 trocas em 30 dias"
    severidade: "CRÍTICA"
    canal_notificacao:
      - "email"
      - "slack"
      - "sms"

  - evento: "Operação Pendente de Aprovação"
    threshold: ">24 horas sem aprovação"
    severidade: "MÉDIA"
    canal_notificacao:
      - "email"
      - "notificacao_inapp"

  - evento: "Linha Subutilizada Detectada"
    threshold: "Consumo <10% por 3 meses"
    severidade: "BAIXA"
    canal_notificacao:
      - "email"
      - "notificacao_inapp"
