rf_id: RF068
rf_title: "Inventário Cíclico e Auditoria de Estoque"
versao_governanca: "2.0"
data_migracao: "2025-12-30"

# ==============================================================================
# ITENS LEGADO RASTREADOS
# ==============================================================================

itens_legado:
  # ------------------------------------------------------------------------------
  # TELAS ASPX
  # ------------------------------------------------------------------------------
  - id: "LEG-RF068-001"
    tipo: "tela"
    titulo: "TelaInventario.aspx - CRUD de Inventários"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\TelaInventario.aspx"
    descricao: |
      Tela de criação, edição e listagem de inventários de estoque.
      Permite selecionar almoxarifado, tipo (Geral/Parcial), datas início/fim e status.
      Não implementa classificação ABC nem bloqueio de almoxarifado.
    regras_implicitas:
      - "Permite criar inventário para almoxarifado inativo (sem validação)"
      - "Status alterado manualmente via combo (não automático)"
      - "Deleção física (sem soft delete)"
      - "Sem bloqueio de movimentações durante inventário"
    destino: "SUBSTITUÍDO"
    justificativa: "Redesenhado com validações completas, multi-tenancy e workflow"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 4 (Funcionalidades 1-3: Criar, Listar, Finalizar Inventário)"
      uc_moderno: "UC-EST-021: Iniciar inventário cíclico ABC"
    migracao_moderna:
      componente_angular: "inventarios-create.component.ts"
      rota_frontend: "/estoque/inventarios/create"
      command_cqrs: "CreateInventarioCommand"
      handler: "CreateInventarioCommandHandler"

  - id: "LEG-RF068-002"
    tipo: "tela"
    titulo: "TelaInventario_Contar.aspx - Registro de Contagem Manual"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\TelaInventario_Contar.aspx"
    descricao: |
      Tela para registrar contagem de itens via seleção manual em dropdown.
      Exibe Qtd_Sistema (readonly) e permite entrada de Qtd_Contada.
      Sem suporte para barcode scan, contagem dupla cega ou validação de divergência > 5%.
    regras_implicitas:
      - "Seleção manual de item em dropdown (propenso a erro)"
      - "Sem barcode scan (contagem lenta)"
      - "Editar contagem sobrescreve valor anterior (histórico não preservado)"
      - "Sem validação de divergência > 5% (aceita qualquer valor)"
      - "Sem contagem dupla cega para itens críticos"
    destino: "SUBSTITUÍDO"
    justificativa: "App mobile PWA com barcode scan, contagem dupla cega e validação de divergência"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-002: Contagem Dupla Cega, RN-RF068-003: Divergência > 5%)"
      uc_moderno: "UC-EST-022: Contar item via app mobile barcode"
    migracao_moderna:
      componente_angular: "inventarios-count-mobile.component.ts (PWA)"
      rota_frontend: "/estoque/inventarios/{id}/contar"
      command_cqrs: "RegistrarContagemCommand"
      handler: "RegistrarContagemCommandHandler"

  - id: "LEG-RF068-003"
    tipo: "tela"
    titulo: "TelaInventario_Divergencias.aspx - Lista de Divergências"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\TelaInventario_Divergencias.aspx"
    descricao: |
      Tela que lista divergências identificadas (Qtd_Contada ≠ Qtd_Sistema).
      Botão "Aplicar Ajustes" atualiza estoque diretamente SEM workflow de aprovação.
      Sem integração com ERP ou relatório de auditoria.
    regras_implicitas:
      - "Aplicação de ajustes em lote sem aprovação de supervisor"
      - "Sem justificativa obrigatória para ajustes"
      - "Sem integração ERP (lançamentos contábeis manuais)"
      - "Sem priorização por classificação ABC ou valor"
    destino: "DESCARTADO"
    justificativa: "Aplicação direta de ajustes sem aprovação viola compliance. Sistema moderno exige workflow."
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-004: Ajuste Exige Aprovação de Supervisor)"
      uc_moderno: "UC-EST-023: Identificar e aprovar divergências"
    migracao_moderna:
      componente_angular: "inventarios-divergencias.component.ts (com workflow de aprovação)"
      rota_frontend: "/estoque/inventarios/{id}/divergencias"
      command_cqrs: "AprovarAjusteCommand"
      handler: "AprovarAjusteCommandHandler"

  - id: "LEG-RF068-004"
    tipo: "tela"
    titulo: "TelaInventario_Relatorio.aspx - Geração de Relatório PDF"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\TelaInventario_Relatorio.aspx"
    descricao: |
      Tela que gera relatório PDF genérico de inventário.
      PDF não compatível com ISO 9001 (sem assinaturas digitais, cabeçalho formal).
      PDF não armazenado automaticamente no DMS (usuário baixa manualmente).
    regras_implicitas:
      - "PDF genérico sem assinatura digital"
      - "Não compatível com ISO 9001"
      - "Sem armazenamento obrigatório (usuário baixa e salva manualmente)"
      - "Formatação inconsistente entre inventários"
    destino: "SUBSTITUÍDO"
    justificativa: "Sistema moderno gera relatório ISO 9001 com assinatura digital e armazenamento obrigatório 7 anos"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-011: Relatório de Auditoria ISO 9001)"
      uc_moderno: "UC-EST-024: Gerar relatório auditoria"
    migracao_moderna:
      componente_angular: "inventarios-relatorio.component.ts"
      rota_frontend: "/estoque/inventarios/{id}/relatorio"
      query_cqrs: "GerarRelatorioInventarioQuery"
      handler: "GerarRelatorioInventarioQueryHandler"

  # ------------------------------------------------------------------------------
  # WEBSERVICES ASMX
  # ------------------------------------------------------------------------------
  - id: "LEG-RF068-005"
    tipo: "webservice"
    titulo: "EstoqueInventarioService.asmx.IniciarInventario"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\WebService\\EstoqueInventarioService.asmx"
    metodos:
      - nome: "IniciarInventario"
        parametros: "idAlmoxarifado As Guid"
        retorno: "Guid (Id do inventário criado)"
    descricao: |
      WebMethod que cria registro de inventário no banco sem validações.
      Não valida se almoxarifado está ativo, não bloqueia movimentações, não gera lista de itens.
      Retorna apenas o GUID do inventário criado.
    destino: "SUBSTITUÍDO"
    justificativa: "Substituído por REST API com validações completas e bloqueio de almoxarifado"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 8 (POST /api/inventarios, PUT /api/inventarios/{id}/iniciar)"
      endpoint_moderno: "POST /api/inventarios"
    migracao_moderna:
      command_cqrs: "CreateInventarioCommand"
      handler: "CreateInventarioCommandHandler"
      validador: "CreateInventarioCommandValidator (FluentValidation)"

  - id: "LEG-RF068-006"
    tipo: "webservice"
    titulo: "EstoqueInventarioService.asmx.ObterItensInventario"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\WebService\\EstoqueInventarioService.asmx"
    metodos:
      - nome: "ObterItensInventario"
        parametros: "idInventario As Guid"
        retorno: "List<InventarioItemDto>"
    descricao: |
      WebMethod que retorna lista de itens do inventário.
      Sem filtro por classificação ABC, sem paginação.
    destino: "SUBSTITUÍDO"
    justificativa: "Substituído por endpoint REST com paginação e filtros"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 8 (GET /api/inventarios/{id}/itens)"
      endpoint_moderno: "GET /api/inventarios/{id}/itens"
    migracao_moderna:
      query_cqrs: "GetInventarioItensQuery"
      handler: "GetInventarioItensQueryHandler"

  - id: "LEG-RF068-007"
    tipo: "webservice"
    titulo: "EstoqueInventarioService.asmx.RegistrarContagem"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\WebService\\EstoqueInventarioService.asmx"
    metodos:
      - nome: "RegistrarContagem"
        parametros: "idItem As Guid, qtdContada As Integer"
        retorno: "Boolean (sucesso/falha)"
    descricao: |
      WebMethod que atualiza qtd_contada do item.
      Sem validação de divergência > 5%, sem histórico de contagens, sem contagem dupla cega.
      Executa UPDATE direto na tabela sobrescrevendo valor anterior.
    destino: "SUBSTITUÍDO"
    justificativa: "Substituído por endpoint com validação de divergência e histórico imutável"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 8 (POST /api/inventarios/{id}/itens/{itemId}/contar)"
      endpoint_moderno: "POST /api/inventarios/{id}/itens/{itemId}/contar"
    migracao_moderna:
      command_cqrs: "RegistrarContagemCommand"
      handler: "RegistrarContagemCommandHandler"
      validador: "RegistrarContagemCommandValidator (valida divergência > 5%)"

  - id: "LEG-RF068-008"
    tipo: "webservice"
    titulo: "EstoqueInventarioService.asmx.AplicarAjustes"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\WebService\\EstoqueInventarioService.asmx"
    metodos:
      - nome: "AplicarAjustes"
        parametros: "idInventario As Guid"
        retorno: "Boolean (sucesso/falha)"
    descricao: |
      WebMethod que aplica TODAS as divergências ao estoque SEM workflow de aprovação.
      Atualiza tabela de estoque diretamente. Sem integração ERP.
    destino: "DESCARTADO"
    justificativa: "Aplicação direta sem aprovação viola compliance. Sistema moderno exige workflow com Supervisor."
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-004: Ajuste Exige Aprovação), Seção 8 (POST /api/inventarios/{id}/ajustes/{ajusteId}/aprovar)"
      endpoint_moderno: "POST /api/inventarios/{id}/ajustes/{ajusteId}/aprovar"
    migracao_moderna:
      command_cqrs: "AprovarAjusteCommand"
      handler: "AprovarAjusteCommandHandler"

  # ------------------------------------------------------------------------------
  # STORED PROCEDURES
  # ------------------------------------------------------------------------------
  - id: "LEG-RF068-009"
    tipo: "stored_procedure"
    titulo: "sp_ObterItensParaInventario"
    caminho_legado: "D:\\IC2\\ic1_legado\\Database\\Procedures\\sp_ObterItensParaInventario.sql"
    parametros_entrada:
      - "@IdAlmoxarifado UNIQUEIDENTIFIER"
    parametros_saida:
      - "Tabela de itens (Código, Nome, Qtd_Sistema)"
    descricao: |
      Stored procedure que gera lista de itens a contar em um almoxarifado.
      Não filtra por classificação ABC (retorna TODOS os itens).
      Sem paginação (pode retornar milhares de registros).
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Application Layer (CQRS Query) com filtro ABC e paginação"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-001: Classificação ABC Obrigatória)"
      regra_moderna: "RN-RF068-001"
    migracao_moderna:
      query_cqrs: "GetItensParaInventarioQuery"
      handler: "GetItensParaInventarioQueryHandler"

  - id: "LEG-RF068-010"
    tipo: "stored_procedure"
    titulo: "sp_CalcularDivergencias"
    caminho_legado: "D:\\IC2\\ic1_legado\\Database\\Procedures\\sp_CalcularDivergencias.sql"
    parametros_entrada:
      - "@IdInventario UNIQUEIDENTIFIER"
    parametros_saida:
      - "Tabela de divergências (Código, Qtd_Sistema, Qtd_Contada, Divergencia, Percentual)"
    descricao: |
      Stored procedure que calcula divergências (Qtd_Contada - Qtd_Sistema).
      Lógica de cálculo é válida: calcula percentual |(Qtd_Contada - Qtd_Sistema) / Qtd_Sistema| * 100
      Não prioriza por classificação ABC ou valor.
    destino: "ASSUMIDO"
    justificativa: "Lógica de cálculo é válida. Movida para Application Layer (CQRS Query) com priorização por ABC."
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-003: Divergência > 5% Exige Recontagem)"
      regra_moderna: "RN-RF068-003"
    migracao_moderna:
      query_cqrs: "GetDivergenciasQuery"
      handler: "GetDivergenciasQueryHandler (ordena por valor DESC, prioriza A)"

  - id: "LEG-RF068-011"
    tipo: "stored_procedure"
    titulo: "sp_AplicarAjustesInventario"
    caminho_legado: "D:\\IC2\\ic1_legado\\Database\\Procedures\\sp_AplicarAjustesInventario.sql"
    parametros_entrada:
      - "@IdInventario UNIQUEIDENTIFIER"
    parametros_saida:
      - "@QtdAjustesAplicados INT OUTPUT"
    descricao: |
      Stored procedure que aplica ajustes de estoque (atualiza Qtd_Atual das tabelas de estoque).
      Executa UPDATE direto SEM validação de aprovação.
      Não envia dados para ERP.
    destino: "DESCARTADO"
    justificativa: "Aplicação direta sem aprovação viola compliance. Sistema moderno exige aprovação + integração ERP."
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-004: Ajuste Exige Aprovação, RN-RF068-010: Integração ERP)"
      regra_moderna: "RN-RF068-004"
    migracao_moderna:
      command_cqrs: "AprovarAjusteCommand"
      handler: "AprovarAjusteCommandHandler"
      evento_dominio: "EstoqueAjustadoEvent (enviado para ERP)"

  - id: "LEG-RF068-012"
    tipo: "stored_procedure"
    titulo: "sp_GerarRelatorioInventario"
    caminho_legado: "D:\\IC2\\ic1_legado\\Database\\Procedures\\sp_GerarRelatorioInventario.sql"
    parametros_entrada:
      - "@IdInventario UNIQUEIDENTIFIER"
    parametros_saida:
      - "Conjunto de dados para relatório (cabeçalho, itens, divergências, totais)"
    descricao: |
      Stored procedure que retorna dados estruturados para geração de relatório PDF.
      Dados em formato genérico, não compatível com ISO 9001 (faltam campos obrigatórios).
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Application Layer + geração de PDF assinado digitalmente compatível ISO 9001"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-011: Relatório de Auditoria ISO 9001)"
      regra_moderna: "RN-RF068-011"
    migracao_moderna:
      query_cqrs: "GerarRelatorioInventarioQuery"
      handler: "GerarRelatorioInventarioQueryHandler (gera PDF assinado)"

  # ------------------------------------------------------------------------------
  # TABELAS LEGADAS
  # ------------------------------------------------------------------------------
  - id: "LEG-RF068-013"
    tipo: "tabela"
    titulo: "Estoque_Inventario"
    schema_legado: "[dbo].[Estoque_Inventario]"
    problemas_identificados:
      - "Falta multi-tenancy: Sem campo ClienteId"
      - "Falta auditoria: Sem Created, CreatedBy, LastModified, LastModifiedBy"
      - "Falta soft delete: Sem Fl_Excluido (deleção física)"
      - "Falta estados intermediários: Status insuficiente (faltam 'AguardandoConciliacao')"
      - "Falta tipo 'Ciclico': Apenas 'Geral' e 'Parcial'"
    destino: "SUBSTITUÍDO"
    justificativa: "Tabela redesenhada com multi-tenancy (ClienteId), auditoria completa, soft delete e estados adicionais"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 6 (Estados da Entidade)"
      md_moderno: "MD-RF068 - Tabela EstoqueInventario"
    migracao_moderna:
      tabela_moderna: "EstoqueInventario"
      migration_ef_core: "20251230_CreateEstoqueInventarioTable.cs"
      campos_adicionais:
        - "ClienteId UNIQUEIDENTIFIER NOT NULL (multi-tenancy)"
        - "Created DATETIME2 NOT NULL (auditoria)"
        - "CreatedBy UNIQUEIDENTIFIER NOT NULL (auditoria)"
        - "LastModified DATETIME2 NULL (auditoria)"
        - "LastModifiedBy UNIQUEIDENTIFIER NULL (auditoria)"
        - "Fl_Excluido BIT NOT NULL DEFAULT 0 (soft delete)"
        - "TipoInventario: Adicionar valor 'Ciclico'"
        - "Status: Adicionar 'AguardandoConciliacao'"

  - id: "LEG-RF068-014"
    tipo: "tabela"
    titulo: "Estoque_Inventario_Item"
    schema_legado: "[dbo].[Estoque_Inventario_Item]"
    problemas_identificados:
      - "Falta classificação ABC: Sem campo ClassificacaoABC"
      - "Falta contagem dupla: Sem Id_Usuario_Contador_2"
      - "Falta aprovação ajuste: Sem Id_Usuario_Aprovador, Data_Aprovacao"
      - "Falta histórico de contagens: Editar contagem sobrescreve valor (sem auditoria)"
      - "Status_Item incompleto: Faltam 'Divergente', 'RecontagemSolicitada', 'AguardandoAprovacao', 'Ajustado', 'Rejeitado'"
    destino: "SUBSTITUÍDO"
    justificativa: "Tabela redesenhada com campos adicionais e tabela de histórico de contagens"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 6 (Estados do Item de Inventário)"
      md_moderno: "MD-RF068 - Tabela EstoqueInventarioItem + EstoqueInventarioItemHistorico"
    migracao_moderna:
      tabela_moderna: "EstoqueInventarioItem"
      migration_ef_core: "20251230_CreateEstoqueInventarioItemTable.cs"
      campos_adicionais:
        - "ClassificacaoABC VARCHAR(1) NOT NULL (A, B ou C)"
        - "Id_Usuario_Contador_2 UNIQUEIDENTIFIER NULL (contagem dupla cega)"
        - "Qtd_Contada_2 INT NULL (segunda contagem)"
        - "Data_Contagem_2 DATETIME2 NULL"
        - "Id_Usuario_Aprovador UNIQUEIDENTIFIER NULL"
        - "Data_Aprovacao DATETIME2 NULL"
        - "Justificativa_Ajuste NVARCHAR(500) NULL"
        - "Status_Item: Adicionar valores ('Divergente', 'RecontagemSolicitada', 'AguardandoAprovacao', 'Ajustado', 'Rejeitado')"
      tabelas_adicionais:
        - "EstoqueInventarioItemHistorico (preserva todas as contagens)"

  # ------------------------------------------------------------------------------
  # REGRAS IMPLÍCITAS NO CÓDIGO
  # ------------------------------------------------------------------------------
  - id: "LEG-RF068-015"
    tipo: "regra_negocio"
    titulo: "Inventário Sem Bloqueio de Almoxarifado"
    localizacao_codigo: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\TelaInventario.aspx.vb - Linha 145"
    descricao: |
      Ao iniciar inventário, almoxarifado NÃO é bloqueado.
      Usuários podem requisitar, receber e transferir itens durante contagem.
      Causa inconsistência entre Qtd_Sistema no momento da contagem e Qtd_Sistema ao finalizar.
    destino: "SUBSTITUÍDO"
    justificativa: "Sistema moderno bloqueia almoxarifado automaticamente ao iniciar inventário"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-005: Bloqueio de Movimentação Durante Inventário)"
      regra_moderna: "RN-RF068-005"
    migracao_moderna:
      handler: "IniciarInventarioCommandHandler (bloqueia almoxarifado ao iniciar)"
      linha_codigo: "almoxarifado.Bloquear(motivoBloqueio: 'Inventário em andamento')"

  - id: "LEG-RF068-016"
    tipo: "regra_negocio"
    titulo: "Divergência Aplicada Sem Aprovação"
    localizacao_codigo: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\TelaInventario_Divergencias.aspx.vb - Linha 78"
    descricao: |
      Botão "Aplicar Ajustes" atualiza quantidade no estoque diretamente sem workflow de aprovação.
      Qualquer usuário com acesso à tela pode aplicar ajustes.
      Não há registro de quem aprovou ou justificativa.
    destino: "DESCARTADO"
    justificativa: "Aplicação direta sem aprovação viola compliance. Sistema moderno exige aprovação de Supervisor."
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-004: Ajuste de Estoque Exige Aprovação de Supervisor)"
      regra_moderna: "RN-RF068-004"
    migracao_moderna:
      command_cqrs: "AprovarAjusteCommand"
      validador: "AprovarAjusteCommandValidator (valida permissão INVENTARIO.APPROVE_ADJUSTMENT)"

  - id: "LEG-RF068-017"
    tipo: "regra_negocio"
    titulo: "Classificação ABC Inexistente (Manual em Excel)"
    localizacao_codigo: "Todo o módulo de inventário (inexistente no sistema)"
    descricao: |
      Legado não implementa classificação ABC automática.
      Inventários são sempre gerais (todos os itens) ou parciais (filtro manual).
      Classificação ABC feita manualmente em planilhas Excel fora do sistema.
    destino: "SUBSTITUÍDO"
    justificativa: "Sistema moderno implementa classificação ABC automática com job Hangfire"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-001: Classificação ABC Obrigatória para Inventário Cíclico)"
      regra_moderna: "RN-RF068-001"
    migracao_moderna:
      job_hangfire: "ClassificarItensABCJob (executa trimestralmente)"
      handler: "ClassificarItensABCCommandHandler"

  - id: "LEG-RF068-018"
    tipo: "regra_negocio"
    titulo: "Histórico de Contagens Não Preservado"
    localizacao_codigo: "D:\\IC2\\ic1_legado\\IControlIT\\Estoque\\WebService\\EstoqueInventarioService.asmx.vb - Método RegistrarContagem - Linha 120"
    descricao: |
      Ao registrar contagem, código executa UPDATE na tabela Estoque_Inventario_Item.
      Se usuário recontar o item, valor anterior é sobrescrito.
      Não há tabela de histórico de contagens.
      Impossível auditar quem contou, quando e qual foi o resultado de cada contagem.
    destino: "SUBSTITUÍDO"
    justificativa: "Sistema moderno implementa histórico imutável de contagens em tabela separada"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-008: Histórico Imutável de Contagens)"
      regra_moderna: "RN-RF068-008"
    migracao_moderna:
      tabela_adicional: "EstoqueInventarioItemHistorico"
      handler: "RegistrarContagemCommandHandler (INSERT em histórico, não UPDATE)"

  - id: "LEG-RF068-019"
    tipo: "regra_negocio"
    titulo: "Integração ERP Inexistente (Lançamentos Manuais)"
    localizacao_codigo: "Todo o módulo de inventário (inexistente no sistema)"
    descricao: |
      Ajustes de estoque (perdas ou sobras) não são enviados automaticamente para ERP.
      Lançamentos contábeis feitos manualmente pela equipe financeira com base em relatório Excel.
      Alto risco de erro e perda de dados.
    destino: "SUBSTITUÍDO"
    justificativa: "Sistema moderno integra com ERP via evento domain EstoqueAjustadoEvent"
    rastreabilidade:
      documentacao_moderno: "RF068 - Seção 5 (RN-RF068-010: Integração com ERP para Ajustes Contábeis)"
      regra_moderna: "RN-RF068-010"
    migracao_moderna:
      evento_dominio: "EstoqueAjustadoEvent"
      handler: "AprovarAjusteCommandHandler (publica evento após aprovação)"
      integracao: "ErpIntegrationService (consome evento, envia para ERP com retry)"

# ==============================================================================
# METADADOS
# ==============================================================================

metadados:
  total_itens_legado: 19
  itens_assumidos: 1     # sp_CalcularDivergencias (lógica válida)
  itens_substituidos: 15  # Telas, webservices, SPs, tabelas, regras implícitas
  itens_descartados: 3    # Aplicação de ajustes sem aprovação (3 itens: tela, webmethod, SP)
  itens_a_revisar: 0
  cobertura_destinos: "100%"

  problemas_legado_documentados: 7
  decisoes_modernizacao: 5
  riscos_migracao: 5

  tags:
    - "inventario"
    - "estoque"
    - "aspx"
    - "vbnet"
    - "webforms"
    - "stored-procedures"
    - "sem-multi-tenancy"
    - "sem-auditoria"
    - "sem-compliance"
