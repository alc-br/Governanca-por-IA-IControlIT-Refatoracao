# RF065 - Templates de Relatórios (Excel/PDF)

**Versão:** 2.0
**Data de Criação:** 2025-01-14
**Última Atualização:** 2025-12-30
**Autor:** Equipe IControlIT
**Status:** Aprovado
**Governança:** v2.0 (Separação RF/RL)

---

## 1. VISÃO GERAL

### 1.1 Objetivo do Requisito

Implementar sistema de geração de relatórios customizáveis em múltiplos formatos (Excel .xlsx, PDF, CSV) com templates reutilizáveis, gráficos dinâmicos (Chart.js), agrupamentos, totalizações automáticas, formatação condicional, múltiplas abas, agendamento de exportações automáticas via Hangfire e envio por e-mail.

### 1.2 Contexto de Negócio

A área de BI precisa de um motor de relatórios flexível e customizável que permita:

- **Eliminação de Hardcoding**: Relatórios configuráveis sem código
- **Customização por Usuário**: Cada usuário cria seus templates
- **Exportação Agendada**: Relatórios gerados automaticamente (diário, semanal, mensal)
- **Dashboards Executivos**: Gráficos e KPIs visuais
- **Compliance**: Assinatura digital PDF, marca d'água, auditoria de exportações

### 1.3 Benefícios Esperados

- Redução de 90% no tempo de criação de relatórios (de 2h para 10 min)
- Eliminação de 100% dos relatórios hardcoded (atualmente ~150 relatórios)
- Automação de 80% dos relatórios recorrentes via agendamento
- Redução de carga em TI (usuário cria seus próprios relatórios)
- Dashboards gerenciais com atualização em tempo real

### 1.4 Escopo

**Incluído:**
- CRUD de templates de relatórios
- Geração em Excel (.xlsx), PDF, CSV
- Gráficos Chart.js (linha, barra, pizza, área)
- Agrupamentos e subtotais automáticos
- Formatação condicional (cores, negrito, etc.)
- Múltiplas abas em Excel
- Parâmetros dinâmicos (filtros de período, centro custo, etc.)
- Agendamento de exportações (Hangfire)
- Envio por e-mail automático
- Cabeçalho e rodapé customizados
- Proteção de planilhas (somente leitura)
- Assinatura digital PDF
- Marca d'água em PDFs
- Integração com cubos OLAP (BI)
- Cache de relatórios pesados (15 min)
- Compactação ZIP de múltiplos relatórios
- Métricas de uso (relatórios mais gerados)

**Excluído:**
- Dashboards interativos em tempo real (RF separado)
- Data warehouse/ETL (RF separado)
- Relatórios analíticos complexos (Power BI/Tableau - ferramentas externas)

### 1.5 Stakeholders

- **Gestores de TI**: Dashboards gerenciais e relatórios estratégicos
- **Analistas de BI**: Criação de templates e cubos OLAP
- **Usuários Finais**: Geração de relatórios operacionais
- **Auditoria**: Rastreabilidade de exportações
- **Compliance**: Assinatura digital e marca d'água

---

## 2. FUNCIONALIDADES

### F01 - CRUD de Templates

Sistema permite criar, visualizar, editar e excluir templates de relatórios com:
- Nome, descrição, categoria
- Consulta SQL parametrizada
- Parâmetros dinâmicos (data, texto, número, select)
- Status ativo/inativo
- Permissões RBAC (quem pode usar)
- Multi-tenancy (isolamento por EmpresaId)

### F02 - Geração em Múltiplos Formatos

Gerar relatórios em 3 formatos:
- **Excel (.xlsx)**: EPPlus library, múltiplas abas, gráficos Chart.js, formatação
- **PDF**: QuestPDF library, layout responsivo, marca d'água, assinatura digital
- **CSV**: Export simples para importação em outros sistemas

### F03 - Gráficos Dinâmicos

Suportar 4 tipos de gráficos (Chart.js):
- **Linha**: Evolução temporal (ex: vendas mensais)
- **Barra**: Comparação entre categorias (ex: vendas por filial)
- **Pizza**: Percentual de distribuição (ex: mix de produtos)
- **Área**: Acumulado temporal (ex: backlog crescente)

Configuração por template:
- Eixo X (campo de agrupamento)
- Eixo Y (campo numérico)
- Título do gráfico
- Cores customizadas

### F04 - Agrupamentos e Subtotais

Permitir agrupar dados e calcular subtotais:
- Agrupar por 1 ou mais campos (ex: Filial → Centro Custo → Produto)
- Subtotais automáticos (soma, média, contagem)
- Quebra de página por grupo (opcional)
- Total geral no final

### F05 - Formatação Condicional

Aplicar cores/formatação baseado em regras:
- **Regras:** >, <, =, BETWEEN, !=
- **Formatação:** Cor de fundo, cor de texto, negrito, itálico
- **Exemplo:** Se Valor > 1000 → fundo verde, texto branco, negrito

### F06 - Múltiplas Abas em Excel

Criar Excel com múltiplas abas (worksheets):
- Cada aba com consulta SQL independente
- Cada aba com gráficos próprios
- Cada aba com agrupamento próprio
- Navegação entre abas

### F07 - Parâmetros Dinâmicos

Relatórios com filtros configuráveis:
- **Tipos de parâmetro:** DATE, TEXT, NUMBER, SELECT (dropdown)
- **Obrigatoriedade:** Parâmetros obrigatórios/opcionais
- **Valor padrão:** Ex: Data Inicial = Início do Mês
- **Validação:** Ranges de data, valores mín/máx

Frontend renderiza formulário dinâmico com base em parâmetros.

### F08 - Agendamento de Exportações

Agendar geração automática de relatórios:
- **Frequência:** Diário, semanal, mensal
- **Dia da semana:** Segunda, terça, etc. (para semanal)
- **Dia do mês:** 1-31 (para mensal)
- **Horário:** Ex: 08:00 AM
- **Destinatários:** Lista de e-mails
- **Formato:** Excel, PDF ou CSV

Job Hangfire executa geração e envio.

### F09 - Envio por E-mail Automático

Enviar relatório gerado por e-mail:
- Assunto configurável
- Corpo do e-mail com resumo
- Anexo (Excel, PDF ou CSV)
- Múltiplos destinatários
- Log de envios bem-sucedidos/falhados

### F10 - Cabeçalho e Rodapé Customizados

Configurar header/footer em PDFs e Excel:
- **Header:** Logo da empresa, título do relatório, data de geração
- **Footer:** Página X de Y, usuário que gerou, timestamp

### F11 - Proteção de Planilhas Excel

Excel gerado com proteção contra edição:
- Planilha somente leitura (usuário pode apenas visualizar/filtrar)
- Proteger células críticas
- Senha opcional (para casos sensíveis)

### F12 - Assinatura Digital PDF

PDFs com assinatura digital para autenticidade:
- Certificado digital X.509
- Timestamp de geração
- Hash do documento
- Validação de autenticidade

### F13 - Marca D'água em PDFs

Adicionar marca d'água configurável:
- Texto: "Confidencial", "Interno", "Público"
- Posição: Diagonal, horizontal, rodapé
- Opacidade: 10-50%
- Cor: Cinza claro

### F14 - Integração com Cubos OLAP

Templates podem consultar cubos OLAP (BI):
- Conexão com SQL Server Analysis Services (SSAS)
- Queries MDX (Multidimensional Expressions)
- Dimensões e medidas configuráveis
- Drill-down e slice/dice

### F15 - Cache de Relatórios

Cachear relatórios pesados para performance:
- Cache Redis com TTL 15 minutos
- Key: TemplateId + Parâmetros (hash)
- Evita re-execução de queries pesadas
- Indicador "Gerado às HH:MM" para usuário saber se é cache

### F16 - Compactação ZIP

Gerar múltiplos relatórios em arquivo ZIP:
- Usuário seleciona N templates
- Sistema gera todos em paralelo (tasks assíncronas)
- Compacta em arquivo .zip
- Download único

### F17 - Métricas de Uso

Rastrear popularidade de templates:
- Quantidade de vezes gerado
- Usuários que mais usam
- Horário de pico
- Formato mais popular (Excel vs PDF)
- Tempo médio de geração

Dashboard de métricas para gestores de BI.

---

## 3. REGRAS DE NEGÓCIO

### RN-RF065-001: Formatos Suportados Obrigatórios

**Descrição:** Sistema DEVE suportar geração de relatórios em 3 formatos: Excel (.xlsx), PDF e CSV.

**Critério de Aceite:**
- Enum `FormatoRelatorio` com 3 valores (Excel, PDF, CSV)
- Usuário seleciona formato antes de gerar
- Cada formato tem gerador específico:
  - Excel: EPPlus library
  - PDF: QuestPDF library
  - CSV: CsvHelper library

**Validações:**
- Formato DEVE ser uma das 3 opções
- NÃO é permitido formato customizado
- Formato DEVE ser especificado ao gerar (não pode ser nulo)

**Prioridade:** CRÍTICA

---

### RN-RF065-002: Gráficos Dinâmicos Chart.js

**Descrição:** Sistema DEVE suportar 4 tipos de gráficos Chart.js: Linha, Barra, Pizza, Área.

**Critério de Aceite:**
- Template possui lista de gráficos configuráveis
- Cada gráfico tem: tipo, campo X, campo Y, título, cores
- Frontend renderiza gráficos usando Chart.js
- Excel exporta gráficos como imagens PNG embedadas
- PDF exporta gráficos como imagens PNG

**Validações:**
- Tipo de gráfico DEVE ser um dos 4 suportados
- Campo X e Campo Y DEVEM existir no resultado da consulta
- Cores DEVEM ser hexadecimais válidos (#RRGGBB)

**Prioridade:** IMPORTANTE

---

### RN-RF065-003: Agrupamentos e Subtotais Automáticos

**Descrição:** Sistema DEVE permitir agrupar dados por 1 ou mais campos e calcular subtotais automáticos (soma, média).

**Critério de Aceite:**
- Template possui configuração de agrupamento
- Campos de agrupamento ordenam resultado
- Subtotais calculados a cada mudança de grupo
- Total geral ao final do relatório
- Quebra de página opcional por grupo

**Validações:**
- Campos de agrupamento DEVEM existir no resultado
- Campos numéricos para soma/média DEVEM ser numeric/decimal
- Quebra de página DEVE funcionar em PDF e Excel

**Prioridade:** IMPORTANTE

---

### RN-RF065-004: Formatação Condicional por Regras

**Descrição:** Sistema DEVE aplicar formatação condicional (cores, negrito) baseado em regras configuráveis.

**Critério de Aceite:**
- Template possui lista de regras de formatação
- Cada regra: campo, operador (>, <, =, BETWEEN), valor, formatação
- Formatação aplicada em Excel e PDF
- Múltiplas regras podem se aplicar (ordem de prioridade)

**Validações:**
- Operador DEVE ser um dos suportados (>, <, =, !=, BETWEEN)
- Valor DEVE ser compatível com tipo do campo
- Cores DEVEM ser hexadecimais válidos

**Exemplo:**
```
Se Valor > 1000 → Fundo Verde (#28a745), Texto Branco (#FFFFFF), Negrito
Se Valor < 100 → Fundo Vermelho (#dc3545), Texto Branco (#FFFFFF)
```

**Prioridade:** MÉDIA

---

### RN-RF065-005: Múltiplas Abas em Excel

**Descrição:** Sistema DEVE permitir criar Excel com múltiplas abas (worksheets), cada uma com consulta SQL independente.

**Critério de Aceite:**
- Template possui lista de abas configuráveis
- Cada aba: nome, consulta SQL, gráficos, agrupamento
- Excel gerado contém todas as abas
- Navegação entre abas funcional

**Validações:**
- Nome da aba DEVE ter máx 31 caracteres (limitação Excel)
- Nome da aba DEVE ser único dentro do template
- Consulta SQL DEVE ser válida e retornar dados

**Prioridade:** IMPORTANTE

---

### RN-RF065-006: Parâmetros Dinâmicos Obrigatórios

**Descrição:** Relatórios PODEM ter parâmetros dinâmicos (filtros) que DEVEM ser preenchidos antes de gerar.

**Critério de Aceite:**
- Template possui lista de parâmetros configuráveis
- Tipos: DATE, TEXT, NUMBER, SELECT (dropdown)
- Parâmetros obrigatórios bloqueiam geração se não preenchidos
- Valor padrão aplicado automaticamente
- Frontend renderiza formulário dinâmico

**Validações:**
- Parâmetros obrigatórios NÃO podem ser vazios
- Parâmetros DATE DEVEM ser datas válidas
- Parâmetros NUMBER DEVEM ser numéricos
- Parâmetros SELECT DEVEM ter ao menos 2 opções

**Exemplo:**
```
Parâmetro: Data Inicial (DATE, obrigatório, padrão: primeiro dia do mês)
Parâmetro: Centro de Custo (SELECT, opcional, opções: [CC001, CC002, CC003])
```

**Prioridade:** CRÍTICA

---

### RN-RF065-007: Agendamento de Exportações via Hangfire

**Descrição:** Sistema DEVE permitir agendar geração automática de relatórios em frequência diária, semanal ou mensal.

**Critério de Aceite:**
- Agendamento possui: template, frequência, dia/horário, destinatários, formato
- Job Hangfire executa geração no horário configurado
- Relatório gerado é enviado por e-mail aos destinatários
- Log de execuções bem-sucedidas/falhadas
- Notificação em caso de falha

**Validações:**
- Frequência DEVE ser DIARIO, SEMANAL ou MENSAL
- Horário DEVE ser válido (00:00 - 23:59)
- Dia da semana DEVE ser SEG-DOM (para semanal)
- Dia do mês DEVE ser 1-31 (para mensal)
- Destinatários DEVEM ser e-mails válidos

**Prioridade:** CRÍTICA

---

### RN-RF065-008: Cabeçalho e Rodapé Customizados

**Descrição:** Relatórios PDF e Excel DEVEM ter cabeçalho e rodapé configuráveis.

**Critério de Aceite:**
- Template possui configuração de header/footer
- Header: Logo empresa, título relatório, data geração
- Footer: Página X de Y, usuário que gerou, timestamp
- Suporta variáveis dinâmicas ({NomeSistema}, {DataGeracao}, {Usuario}, {Pagina}, {TotalPaginas})

**Validações:**
- Logo DEVE ser imagem válida (PNG, JPG) com máx 500KB
- Variáveis dinâmicas DEVEM ser substituídas corretamente

**Prioridade:** MÉDIA

---

### RN-RF065-009: Proteção de Planilhas Excel

**Descrição:** Excel gerado DEVE ter proteção contra edição (somente leitura).

**Critério de Aceite:**
- Planilha bloqueada por padrão (usuário não pode editar células)
- Usuário pode filtrar, ordenar, mas não alterar dados
- Senha opcional para casos sensíveis
- Mensagem "Este relatório está protegido contra edições"

**Validações:**
- Proteção DEVE ser aplicada a todas as abas
- Senha (se configurada) DEVE ter mínimo 6 caracteres

**Prioridade:** MÉDIA

---

### RN-RF065-010: Assinatura Digital PDF

**Descrição:** PDFs sensíveis DEVEM ter assinatura digital para garantir autenticidade.

**Critério de Aceite:**
- Template possui flag "Requerer Assinatura Digital"
- Sistema usa certificado X.509 configurado
- PDF possui timestamp de geração
- Hash SHA-256 do documento
- Validação de autenticidade (PDF Reader mostra selo de verificação)

**Validações:**
- Certificado digital DEVE estar válido (não expirado)
- Certificado DEVE estar configurado no sistema
- PDF assinado DEVE ser válido (Adobe Reader/Foxit verificam)

**Prioridade:** MÉDIA

---

### RN-RF065-011: Marca D'água em PDFs

**Descrição:** PDFs PODEM ter marca d'água configurável (ex: "Confidencial", "Interno").

**Critério de Aceite:**
- Template possui configuração de marca d'água
- Texto, posição (diagonal, horizontal), opacidade, cor
- Marca d'água aplicada em todas as páginas
- Não obstrui leitura do conteúdo

**Validações:**
- Texto DEVE ter máx 30 caracteres
- Opacidade DEVE estar entre 10-50%
- Cor DEVE ser hexadecimal válido

**Prioridade:** BAIXA

---

### RN-RF065-012: Integração com Cubos OLAP

**Descrição:** Templates PODEM consultar cubos OLAP (SQL Server Analysis Services) para relatórios analíticos.

**Critério de Aceite:**
- Template possui flag "Usar OLAP"
- Consulta MDX (Multidimensional Expressions) em vez de SQL
- Dimensões e medidas configuráveis
- Drill-down e slice/dice suportados

**Validações:**
- Conexão OLAP DEVE estar configurada
- Query MDX DEVE ser sintática válida
- Resultado DEVE ser transformado em tabela flat para exibição

**Prioridade:** BAIXA

---

### RN-RF065-013: Cache de Relatórios Pesados

**Descrição:** Relatórios pesados (>1000 linhas ou >5s de execução) DEVEM ser cacheados por 15 minutos.

**Critério de Aceite:**
- Sistema detecta relatórios pesados automaticamente
- Cache Redis com key: TemplateId + Hash(Parâmetros)
- TTL 15 minutos
- Indicador para usuário: "Gerado às HH:MM (cache)"
- Botão "Regenerar" para forçar atualização

**Validações:**
- Cache DEVE ser invalidado ao alterar template
- Cache DEVE ser específico por tenant (ClienteId)
- Cache DEVE expirar após 15 minutos

**Prioridade:** MÉDIA

---

### RN-RF065-014: Compactação ZIP de Múltiplos Relatórios

**Descrição:** Sistema DEVE permitir gerar múltiplos relatórios em arquivo ZIP único.

**Critério de Aceite:**
- Usuário seleciona N templates
- Sistema gera todos em paralelo (tasks assíncronas)
- Compacta em arquivo .zip
- Nome do ZIP: "Relatorios-YYYYMMDD-HHMMSS.zip"
- Download único

**Validações:**
- Limite máximo: 10 relatórios por ZIP
- Tamanho máximo do ZIP: 50 MB
- Se exceder limite, retornar erro

**Prioridade:** BAIXA

---

### RN-RF065-015: Métricas de Uso de Templates

**Descrição:** Sistema DEVE rastrear métricas de uso de cada template.

**Critério de Aceite:**
- Quantidade de vezes gerado (contador)
- Top 10 usuários que mais usam
- Horário de pico (hora do dia com mais gerações)
- Formato mais popular (Excel vs PDF vs CSV)
- Tempo médio de geração (em segundos)
- Dashboard de métricas para gestores de BI

**Validações:**
- Métricas DEVEM ser calculadas apenas para gerações bem-sucedidas
- Dashboard DEVE atualizar em tempo real (SignalR)

**Prioridade:** BAIXA

---

## 4. IMPACTO E DEPENDÊNCIAS

### 4.1 Impacto em Outros Módulos

- **RF066 - Dashboards Interativos**: Utiliza templates como fonte de dados
- **RF067 - Data Warehouse**: Templates consultam DW para relatórios analíticos
- **Todos os módulos**: Qualquer módulo pode criar relatórios específicos

### 4.2 Dependências Técnicas

- **Backend**: .NET 10, EPPlus (Excel), QuestPDF (PDF), CsvHelper (CSV), Hangfire (jobs)
- **Frontend**: Angular 19, Chart.js, ngx-file-upload, Transloco
- **Cache**: Redis (cache de relatórios pesados)
- **Storage**: Azure Blob Storage (relatórios gerados + logs)
- **OLAP**: SQL Server Analysis Services (cubos BI)

### 4.3 Requisitos de Infraestrutura

- Job Hangfire para agendamentos (executa a cada 1 minuto verifica pendências)
- Redis com 2 GB RAM (cache de relatórios)
- Azure Blob Storage com 100 GB (armazenamento de relatórios gerados)
- Certificado digital X.509 para assinatura de PDFs

---

## 5. CENTRAL DE FUNCIONALIDADES

### 5.1 Registro na Central

```sql
INSERT INTO SistemaFuncionalidade (Codigo, Nome, Descricao, Modulo)
VALUES (
  'TPL.RELATORIOS',
  'Templates de Relatórios',
  'Gerador de relatórios customizáveis em Excel/PDF/CSV com gráficos, agrupamentos e agendamento automático',
  'Templates'
);
```

### 5.2 Permissões RBAC

```csharp
public static class RelatoriosPermissions
{
    public const string View = "TPL.RELATORIOS.VIEW";
    public const string Create = "TPL.RELATORIOS.CREATE";
    public const string Edit = "TPL.RELATORIOS.EDIT";
    public const string Delete = "TPL.RELATORIOS.DELETE";
    public const string Generate = "TPL.RELATORIOS.GENERATE";
    public const string Schedule = "TPL.RELATORIOS.SCHEDULE";
    public const string ViewMetrics = "TPL.RELATORIOS.VIEW_METRICS";
}
```

### 5.3 Eventos de Auditoria

- `RELATORIO_GERADO`
- `TEMPLATE_CRIADO`
- `TEMPLATE_ATUALIZADO`
- `AGENDAMENTO_CRIADO`
- `AGENDAMENTO_EXECUTADO`
- `EMAIL_ENVIADO`

### 5.4 Chaves de Tradução (i18n)

```json
{
  "relatorios": {
    "titulo": "Relatórios",
    "gerar": "Gerar Relatório",
    "formatos": {
      "excel": "Excel (.xlsx)",
      "pdf": "PDF",
      "csv": "CSV"
    },
    "graficos": {
      "linha": "Gráfico de Linha",
      "barra": "Gráfico de Barras",
      "pizza": "Gráfico de Pizza",
      "area": "Gráfico de Área"
    },
    "agendamento": {
      "diario": "Diário",
      "semanal": "Semanal",
      "mensal": "Mensal"
    }
  }
}
```

---

## 6. REQUISITOS NÃO FUNCIONAIS

### 6.1 Performance

- Relatório com 1.000 linhas em < 5 segundos
- Relatório com 10.000 linhas em < 15 segundos
- Relatório com 100.000 linhas em < 30 segundos
- Cache Redis reduz tempo de re-geração em 95%

### 6.2 Usabilidade

- Preview antes de exportar (primeiras 100 linhas)
- Wizard intuitivo para criação de templates
- Arrastar e soltar para ordenar colunas
- Validação em tempo real de consultas SQL

### 6.3 Escalabilidade

- Processamento em background via Hangfire
- Geração paralela de múltiplos relatórios (até 5 simultâneos)
- Queue para relatórios muito pesados (>100k linhas)

### 6.4 Segurança

- RBAC por template (quem pode gerar)
- Multi-tenancy obrigatório (EmpresaId)
- Sanitização de SQL para prevenir injection
- Assinatura digital PDF (autenticidade)
- Marca d'água (confidencialidade)

### 6.5 Disponibilidade

- Jobs Hangfire resilientes (retry automático 3x)
- Fallback para geração síncrona se Hangfire falhar
- Logs detalhados de todas as gerações

---

## 7. CRITÉRIOS DE ACEITE

### 7.1 Funcional

- [ ] CRUD de templates implementado
- [ ] Geração em Excel, PDF, CSV
- [ ] Gráficos Chart.js (4 tipos)
- [ ] Agrupamentos e subtotais
- [ ] Formatação condicional
- [ ] Múltiplas abas em Excel
- [ ] Parâmetros dinâmicos
- [ ] Agendamento via Hangfire
- [ ] Envio por e-mail
- [ ] Cabeçalho e rodapé customizados
- [ ] Proteção de planilhas Excel
- [ ] Assinatura digital PDF
- [ ] Marca d'água PDF
- [ ] Integração OLAP
- [ ] Cache Redis
- [ ] Compactação ZIP
- [ ] Métricas de uso

### 7.2 Técnico

- [ ] Clean Architecture + CQRS
- [ ] EPPlus para Excel
- [ ] QuestPDF para PDF
- [ ] CsvHelper para CSV
- [ ] Chart.js para gráficos
- [ ] Hangfire para agendamento
- [ ] Redis para cache
- [ ] Azure Blob Storage
- [ ] Auditoria automática
- [ ] Multi-tenancy
- [ ] Permissões RBAC
- [ ] Testes unitários (>80% cobertura)
- [ ] Testes E2E (Playwright)

### 7.3 Documentação

- [ ] RF065.md v2.0 (11 seções)
- [ ] RF065.yaml (sincronizado)
- [ ] RL-RF065.md (ausência de legado)
- [ ] RL-RF065.yaml (referencias: [])
- [ ] UC-RF065.md (casos de uso)
- [ ] MD-RF065.md (modelo de dados)
- [ ] WF-RF065.md (wireframes)
- [ ] TC-RF065-*.md (casos de teste)
- [ ] STATUS.yaml v2.0

### 7.4 Qualidade

- [ ] Build sem erros
- [ ] Todos os testes passando (100%)
- [ ] Validador RF/RL passou
- [ ] Code review aprovado
- [ ] Sem vulnerabilidades críticas

---

## 8. RISCOS E MITIGAÇÕES

### 8.1 Riscos Técnicos

| Risco | Impacto | Probabilidade | Mitigação |
|-------|---------|---------------|-----------|
| Relatórios muito pesados travam servidor | Alto | Média | Queue + processamento em background + timeout |
| EPPlus/QuestPDF com bugs | Médio | Baixa | Testes extensivos + fallback para libs alternativas |
| Cache Redis indisponível | Médio | Baixa | Fallback para geração sem cache |

### 8.2 Riscos de Negócio

| Risco | Impacto | Probabilidade | Mitigação |
|-------|---------|---------------|-----------|
| Usuários criando SQLs perigosos | Alto | Alta | Validação + whitelist de tabelas + RBAC |
| Templates mal configurados | Médio | Alta | Validação + preview obrigatório |

---

## 9. GLOSSÁRIO

- **EPPlus**: Biblioteca .NET para manipulação de Excel
- **QuestPDF**: Biblioteca .NET para geração de PDFs
- **Chart.js**: Biblioteca JavaScript para gráficos
- **OLAP**: Online Analytical Processing (cubos de dados)
- **MDX**: Multidimensional Expressions (linguagem de query OLAP)
- **TTL**: Time To Live (tempo de expiração de cache)

---

## 10. APROVAÇÕES

| Papel | Nome | Data | Assinatura |
|-------|------|------|------------|
| Product Owner | [Nome] | [Data] | [Assinatura] |
| Tech Lead | [Nome] | [Data] | [Assinatura] |
| Arquiteto | [Nome] | [Data] | [Assinatura] |

---

## 11. HISTÓRICO DE REVISÕES

| Versão | Data | Autor | Descrição |
|--------|------|-------|-----------|
| 1.0 | 2025-01-14 | Equipe IControlIT | Versão inicial aprovada |
| 2.0 | 2025-12-30 | Claude Code | Migração v1.0 → v2.0 (Governança - Separação RF/RL) |

---

**Documento controlado pela Governança v2.0 - IControlIT**
**Última revisão:** 2025-12-30
