rf:
  id: RF016
  nome: Gestão de Categorias de Ativos
  versao: '2.0'
  data: '2025-12-30'
  fase: Fase 2 - Cadastros e Serviços Transversais
  epic: EPIC003-CAD
  status: em_desenvolvimento
descricao:
  objetivo: 'Especificar o Sistema de Gestão de Categorias do IControlIT, responsável por classificar e

    organizar ativos, serviços de telecom, tipos de chamados e demais entidades do sistema através

    de uma estrutura hierárquica e customizável de categorias.

    '
  problema_resolvido: 'Falta de padronização e organização na classificação de ativos, serviços e entidades do sistema.

    Sistema legado possui categorias rígidas e não hierárquicas, dificultando gestão e reporting.

    '
  publico_afetado: '- Gestores de TI (classificação e organização de ativos)

    - Administradores de sistema (configuração de categorias e atributos)

    - Usuários finais (consulta de categorias em formulários)

    - Analistas de BI (relatórios por categoria)

    '
escopo:
  incluso:
  - Criação de categorias hierárquicas (até 10 níveis de profundidade)
  - 'Categorização por tipo: Ativos, Serviços, Chamados, Contratos'
  - Atributos customizados por categoria (campos dinâmicos)
  - Importação em massa via CSV/Excel
  - Validação de hierarquia (impedir loops e inconsistências)
  - Controle de taxa de depreciação por categoria de ativo
  - Templates de categoria reutilizáveis
  - Personalização visual (ícones e cores)
  - Migração de ativos entre categorias
  - Análise de uso (relatório de categorias mais utilizadas)
  - Inativação/exclusão lógica de categorias
  - Controle de acesso e isolamento por tenant (EmpresaId)
  - Auditoria de operações sobre categorias
  fora:
  - Interface visual específica (definido em WF-RF016.md)
  - Tecnologia, framework ou linguagem de implementação
  - Layout, UX ou identidade visual
  - Estratégia de deploy ou infraestrutura
  - Gestão de ativos em si (coberto por outros RFs)
  - Integração com sistemas de depreciação contábil (fora do MVP)
entidades:
- nome: Categoria
  descricao: Classificação hierárquica de entidades (ativos, serviços, chamados, contratos)
  multi_tenant: true
  soft_delete: true
  auditoria: true
- nome: CategoriaAtributo
  descricao: Atributos customizados configuráveis por categoria
  multi_tenant: true
  soft_delete: true
  auditoria: true
- nome: CategoriaTemplate
  descricao: Templates de categoria reutilizáveis
  multi_tenant: true
  soft_delete: true
  auditoria: true
regras_negocio:
- id: RN-RF016-01
  descricao: Hierarquia máxima de 10 níveis
  tipo: validacao
  campos_afetados:
  - CategoriaPaiId
  - Nivel
  obrigatorio: true
  criterio_aceite: '- Tentativa de criar categoria em nível 11 → HTTP 400 "Hierarquia máxima de 10 níveis atingida"

    - Sistema deve calcular nível automaticamente ao definir categoria pai

    '
- id: RN-RF016-02
  descricao: Validação de loops na hierarquia
  tipo: validacao
  campos_afetados:
  - CategoriaPaiId
  obrigatorio: true
  criterio_aceite: '- Categoria A não pode ter Categoria A como pai → HTTP 400 "Categoria não pode ser filha de si mesma"

    - Categoria A com filha B não pode ter B como pai → HTTP 400 "Loop hierárquico detectado"

    - Sistema deve validar toda a árvore antes de salvar

    '
- id: RN-RF016-03
  descricao: Taxa de depreciação válida
  tipo: validacao
  campos_afetados:
  - TaxaDepreciacao
  - Tipo
  obrigatorio: true
  criterio_aceite: '- Taxa < 0% ou > 100% → HTTP 400 "Taxa de depreciação deve estar entre 0% e 100%"

    - Se não informada para tipo "Ativo" → usar valor padrão de 20% ao ano

    - Se informada para tipo diferente de "Ativo" → HTTP 400 "Taxa aplicável apenas para Ativos"

    '
- id: RN-RF016-04
  descricao: Atributos obrigatórios devem ser preenchidos
  tipo: validacao
  campos_afetados:
  - CategoriaAtributos
  obrigatorio: true
  criterio_aceite: '- Criar ativo sem preencher atributo obrigatório → HTTP 400 "Campo [nome_atributo] é obrigatório"

    '
- id: RN-RF016-05
  descricao: Valores únicos devem ser únicos
  tipo: unicidade
  campos_afetados:
  - CategoriaAtributos
  obrigatorio: true
  criterio_aceite: '- Valor duplicado em atributo único → HTTP 400 "Valor ''[valor]'' já existe para [campo]"

    - Validação case-insensitive

    - Respeitar isolamento de tenant

    '
- id: RN-RF016-06
  descricao: Tipos de dados validados
  tipo: validacao
  campos_afetados:
  - CategoriaAtributos.TipoDado
  obrigatorio: true
  criterio_aceite: '- Valor não numérico em campo numérico → HTTP 400

    - Valor não data em campo data → HTTP 400

    - Valor fora de lista em campo enum → HTTP 400

    '
- id: RN-RF016-07
  descricao: Categorias de sistema não podem ser excluídas
  tipo: regra_negocio
  campos_afetados:
  - Fl_Sistema
  obrigatorio: true
  criterio_aceite: '- Tentativa de excluir categoria de sistema → HTTP 400 "Categoria de sistema não pode ser excluída"

    '
- id: RN-RF016-08
  descricao: Inativação em cascata opcional
  tipo: regra_negocio
  campos_afetados:
  - Ativa
  - CategoriaPaiId
  obrigatorio: true
  criterio_aceite: '- Inativar categoria com filhas → perguntar se deseja inativar subcategorias

    - Se Sim → inativar todas

    - Se Não → promover filhas ao nível da categoria pai

    '
- id: RN-RF016-09
  descricao: Atributos herdados
  tipo: regra_negocio
  campos_afetados:
  - CategoriaAtributos
  obrigatorio: true
  criterio_aceite: '- Subcategorias herdam atributos da categoria pai

    - Podem adicionar novos atributos

    - Não podem remover atributos herdados → HTTP 400

    '
- id: RN-RF016-10
  descricao: Templates públicos compartilhados
  tipo: regra_negocio
  campos_afetados:
  - Fl_Publico
  obrigatorio: true
  criterio_aceite: '- Template público visível para todos tenants

    - Template privado visível apenas para tenant criador

    - Outro tenant NÃO pode editar template público, apenas clonar

    '
- id: RN-RF016-11
  descricao: Isolamento multi-tenant
  tipo: seguranca
  campos_afetados:
  - EmpresaId
  obrigatorio: true
  criterio_aceite: '- Tentativa de acesso cross-tenant → HTTP 404

    - Todas consultas devem filtrar por EmpresaId automaticamente

    '
estados:
- id: Ativa
  descricao: Categoria disponível para uso
- id: Inativa
  descricao: Categoria desativada, não aparece em listagens padrão
- id: Excluída
  descricao: Excluída logicamente (soft delete)
transicoes:
  permitidas:
  - de: Ativa
    para: Inativa
    condicao: Usuário com permissão categorias.update
  - de: Inativa
    para: Ativa
    condicao: Usuário com permissão categorias.update
  - de: Ativa
    para: Excluída
    condicao: Usuário com permissão categorias.delete, sem dependências ativas
  - de: Inativa
    para: Excluída
    condicao: Usuário com permissão categorias.delete, sem dependências ativas
  proibidas:
  - de: Excluída
    para: Ativa
    motivo: Exclusão lógica é irreversível via interface
  - de: Excluída
    para: Inativa
    motivo: Exclusão lógica é irreversível via interface
permissoes:
- codigo: categorias.view_any
  descricao: Listar categorias
  modulo: Cadastros
- codigo: categorias.view
  descricao: Visualizar categoria específica
  modulo: Cadastros
- codigo: categorias.create
  descricao: Criar nova categoria
  modulo: Cadastros
- codigo: categorias.update
  descricao: Atualizar categoria existente
  modulo: Cadastros
- codigo: categorias.delete
  descricao: Excluir categoria (soft delete)
  modulo: Cadastros
- codigo: categorias.create_public_template
  descricao: Criar template público (apenas Super Admin)
  modulo: Cadastros
  nivel_minimo: Super Admin
eventos_dominio:
- nome: categoria.criada
  quando: Após criação bem-sucedida
  payload:
  - id
  - nome
  - tipo
  - empresaId
  - usuarioId
  - timestamp
- nome: categoria.atualizada
  quando: Após atualização bem-sucedida
  payload:
  - id
  - camposAlterados[]
  - usuarioId
  - timestamp
- nome: categoria.inativada
  quando: Após inativação
  payload:
  - id
  - nome
  - usuarioId
  - timestamp
- nome: categoria.excluida
  quando: Após exclusão lógica
  payload:
  - id
  - nome
  - usuarioId
  - timestamp
- nome: categoria.hierarquia_alterada
  quando: Após mudança de categoria pai
  payload:
  - id
  - paiAntigoId
  - paiNovoId
  - usuarioId
  - timestamp
- nome: categoria.template_criado
  quando: Após criação de template
  payload:
  - templateId
  - categoriaOrigemId
  - publico
  - usuarioId
  - timestamp
integracoes:
  internas:
  - nome: Autenticação
    obrigatoria: true
    descricao: JWT Bearer Token para identificar usuário
  - nome: Multi-Tenancy
    obrigatoria: true
    descricao: Isolamento automático por EmpresaId
  - nome: Auditoria
    obrigatoria: true
    descricao: Registro automático de todas operações CUD
  - nome: Internacionalização (i18n)
    obrigatoria: true
    descricao: Suporte a múltiplos idiomas (pt-BR, en-US, es-ES)
    documentacao_relacionada: RF-REF-048
  - nome: Permissões RBAC
    obrigatoria: true
    descricao: Controle de acesso baseado em roles
    documentacao_relacionada: RF-001
  externas:
  - sistema: Sistema Legado VB.NET/ASPX
    tipo: Consulta
    obrigatoria: false
    descricao: Consulta para mapear categorias existentes durante migração
endpoints_api:
- rota: /api/categorias
  metodo: GET
  descricao: Listar categorias
  autenticacao: true
  autorizacao: categorias.view_any
- rota: /api/categorias/{id}
  metodo: GET
  descricao: Obter categoria por ID
  autenticacao: true
  autorizacao: categorias.view
- rota: /api/categorias
  metodo: POST
  descricao: Criar categoria
  autenticacao: true
  autorizacao: categorias.create
- rota: /api/categorias/{id}
  metodo: PUT
  descricao: Atualizar categoria
  autenticacao: true
  autorizacao: categorias.update
- rota: /api/categorias/{id}
  metodo: DELETE
  descricao: Excluir categoria (soft delete)
  autenticacao: true
  autorizacao: categorias.delete
- rota: /api/categorias/{id}/hierarquia
  metodo: PUT
  descricao: Alterar categoria pai
  autenticacao: true
  autorizacao: categorias.update
- rota: /api/categorias/{id}/atributos
  metodo: POST
  descricao: Adicionar atributo customizado
  autenticacao: true
  autorizacao: categorias.update
- rota: /api/categorias/templates
  metodo: GET
  descricao: Listar templates
  autenticacao: true
  autorizacao: categorias.view_any
- rota: /api/categorias/templates
  metodo: POST
  descricao: Criar template
  autenticacao: true
  autorizacao: categorias.create
- rota: /api/categorias/importar
  metodo: POST
  descricao: Importar em massa (CSV/Excel)
  autenticacao: true
  autorizacao: categorias.create
- rota: /api/categorias/relatorio-uso
  metodo: GET
  descricao: Relatório de uso de categorias
  autenticacao: true
  autorizacao: categorias.view_any
seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: true
  validacao_entrada: true
  protecao_sql_injection: true
  protecao_xss: true
  rate_limiting:
    enabled: true
    limite: 100
    periodo: 1 minuto
    por: usuário
kpis:
- nome: Total de Categorias Cadastradas
  descricao: Quantidade total de categorias ativas por tenant
  meta: '> 20 categorias por tenant em 3 meses'
- nome: Profundidade Média de Hierarquia
  descricao: Nível médio de profundidade das categorias
  meta: 2-4 níveis (evitar > 6 níveis)
- nome: Taxa de Uso de Templates
  descricao: Percentual de categorias criadas a partir de templates
  meta: '> 30% utilizando templates'
- nome: Categorias sem Ativos Associados
  descricao: Categorias criadas mas sem uso real
  alerta: '> 20% de categorias vazias indica problema de organização'
- nome: Tempo Médio de Resposta API
  descricao: Latência média das consultas de categoria
  meta: < 200ms (p95)
rastreabilidade:
  ucs_esperados:
  - id: UC00-RF016
    titulo: Visão geral e navegação
    status: criado
  - id: UC01-RF016
    titulo: Criar e editar categoria
    status: criado
  - id: UC02-RF016
    titulo: Gerenciar hierarquia
    status: criado
  - id: UC03-RF016
    titulo: Configurar atributos customizados
    status: criado
  - id: UC04-RF016
    titulo: Importar categorias em massa
    status: criado
  dependencias:
  - documentacao_id: RF-001
    tipo: dependencia
    descricao: Configurações Gerais (parâmetros de sistema)
  - documentacao_id: RF-AUD-002
    tipo: integracao
    descricao: Auditoria de operações
  - documentacao_id: RF-REF-048
    tipo: integracao
    descricao: Internacionalização (i18n)
  - documentacao_id: RF-025
    tipo: dependente
    descricao: Gestão de Ativos (usa categorias)
  - documentacao_id: RF-032
    tipo: dependente
    descricao: Gestão de Serviços (usa categorias)
catalog:
  crud:
  - id: RF-CRUD-01
    title: Criar categoria
    required: true
    endpoint: POST /api/categorias
  - id: RF-CRUD-02
    title: Listar categorias
    required: true
    endpoint: GET /api/categorias
  - id: RF-CRUD-03
    title: Visualizar categoria
    required: true
    endpoint: GET /api/categorias/{id}
  - id: RF-CRUD-04
    title: Atualizar categoria
    required: true
    endpoint: PUT /api/categorias/{id}
  - id: RF-CRUD-05
    title: Excluir categoria (soft delete)
    required: true
    endpoint: DELETE /api/categorias/{id}
  validacoes:
  - id: RF-VAL-01
    title: Validar campos obrigatórios
    required: true
    regra: RN-RF016-04
  - id: RF-VAL-02
    title: Validar unicidade de valores
    required: true
    regra: RN-RF016-05
  - id: RF-VAL-03
    title: Validar tipos de dados
    required: true
    regra: RN-RF016-06
  - id: RF-VAL-04
    title: Validar hierarquia (loops)
    required: true
    regra: RN-RF016-02
  - id: RF-VAL-05
    title: Validar profundidade máxima
    required: true
    regra: RN-RF016-01
  seguranca:
  - id: RF-SEC-01
    title: Isolamento de tenant
    required: true
    regra: RN-RF016-11
  - id: RF-SEC-02
    title: Permissões RBAC
    required: true
  - id: RF-SEC-03
    title: Proteção SQL Injection
    required: true
  - id: RF-SEC-04
    title: Proteção XSS
    required: true
  - id: RF-SEC-05
    title: Rate Limiting
    required: true
exclusions:
  documentacao_items:
  - id: EX-RF016-01
    justificativa: Interface visual específica (ver WF-RF016.md)
  - id: EX-RF016-02
    justificativa: Integração com sistemas de depreciação contábil (fora do MVP)
  - id: EX-RF016-03
    justificativa: Gestão de ativos propriamente dita (outros RFs)
tecnologias_principais:
  backend:
  - .NET 10.0
  - Entity Framework Core 10
  - MediatR (CQRS)
  - FluentValidation
  frontend:
  - Angular 19
  - Angular Material
  - Transloco (i18n)
  banco_dados:
  - SQLite (dev/local)
  - SQL Server (produção)
historico:
- versao: '2.0'
  data: '2025-12-30'
  autor: Agência ALC - alc.dev.br
  descricao: 'Migração para v2.0: separação RF/RL, estruturação completa, 11 regras de negócio, endpoints API, KPIs'
- versao: '1.0'
  data: '2025-11-03'
  autor: Agência ALC - alc.dev.br
  descricao: Versão inicial estrutura simplificada (5 seções)
