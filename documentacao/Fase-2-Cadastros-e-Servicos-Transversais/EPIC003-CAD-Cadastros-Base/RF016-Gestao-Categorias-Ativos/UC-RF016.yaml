# =============================================
# UC-RF016 - Gestão de Categorias de Ativos (Casos de Uso)
# Versão: 2.0
# Autor: Agência ALC - alc.dev.br
# Data: 2025-12-31
# =============================================

uc:
  documentacao: "RF016"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Categorias"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RF-CRUD-02"  # Listar categorias
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa tela de Categorias"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema exibe árvore hierárquica de categorias"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema permite expandir/colapsar níveis"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema exibe filtros: Nome, Tipo, Ativo/Inativo"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema valida permissão categorias.view_any"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por nome"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por tipo (Ativo, Serviço, Chamado, Contrato)"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por status (Ativa/Inativa)"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum registro encontrado"
          required: true

    precondicoes:
      - permissao: "categorias.view_any"

    gatilho: "Usuario acessa menu Categorias"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_tela_categorias"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_categorias_tenant"
      - passo: 4
        ator: "sistema"
        acao: "exibir_arvore_hierarquica"
      - passo: 5
        ator: "sistema"
        acao: "permitir_expandir_colapsar"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada_recarregada"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "erro_403_acesso_negado"

    regras_aplicadas:
      - "RN-RF016-11" # Isolamento multi-tenant

    resultado_final:
      estado: "lista_exibida_estrutura_arvore"

  - id: "UC01"
    nome: "Criar Categoria"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF-CRUD-01"  # Criar categoria
        - "RF-VAL-01"   # Validar campos obrigatórios
        - "RF-VAL-04"   # Validar hierarquia (loops)
        - "RF-VAL-05"   # Validar profundidade máxima
        - "RF-SEC-01"   # Isolamento de tenant
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Criar Categoria"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão categorias.create"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário preenche: Nome, Tipo, Descrição"
          required: true
        - id: "FP-UC01-005"
          title: "Usuário opcionalmente define categoria pai"
          required: false
        - id: "FP-UC01-006"
          title: "Sistema valida campos obrigatórios"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema valida hierarquia (loops, profundidade)"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema cria categoria"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema retorna sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Definir taxa de depreciação (se tipo = Ativo)"
          required: false
        - id: "FA-UC01-002"
          title: "Definir ícone e cor personalizados"
          required: false
        - id: "FA-UC01-003"
          title: "Criar a partir de template"
          required: false
        - id: "FE-UC01-001"
          title: "Campo obrigatório não preenchido"
          required: true
        - id: "FE-UC01-002"
          title: "Loop hierárquico detectado"
          required: true
        - id: "FE-UC01-003"
          title: "Profundidade > 10 níveis"
          required: true
        - id: "FE-UC01-004"
          title: "Taxa de depreciação inválida"
          required: true

    precondicoes:
      - permissao: "categorias.create"

    gatilho: "Usuario clica em Criar Categoria"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_criar_categoria"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 5
        ator: "sistema"
        acao: "validar_dados"
      - passo: 6
        ator: "sistema"
        acao: "validar_hierarquia"
      - passo: 7
        ator: "sistema"
        acao: "persistir_categoria"
      - passo: 8
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "tipo_ativo_selecionado"
        resultado: "exibir_campo_taxa_depreciacao"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "campos_obrigatorios_vazios"
        resultado: "erro_400_lista_campos"
      - id: "FE-UC01-02"
        condicao: "loop_hierarquico"
        resultado: "erro_400_loop_detectado"
      - id: "FE-UC01-03"
        condicao: "profundidade_11"
        resultado: "erro_400_max_10_niveis"

    regras_aplicadas:
      - "RN-RF016-01" # Hierarquia máxima de 10 níveis
      - "RN-RF016-02" # Validação de loops
      - "RN-RF016-03" # Taxa de depreciação válida
      - "RN-RF016-11" # Isolamento multi-tenant

    resultado_final:
      estado: "categoria_criada_auditada"

  - id: "UC02"
    nome: "Visualizar Categoria"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      documentacao_items:
        - "RF-CRUD-03"  # Visualizar categoria
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona categoria na árvore"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão categorias.view"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida isolamento tenant"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema exibe detalhes da categoria"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe hierarquia (pai e filhas)"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema exibe atributos customizados"
          required: true
        - id: "FP-UC02-007"
          title: "Sistema exibe estatísticas de uso"
          required: true
        - id: "FE-UC02-001"
          title: "Categoria não encontrada"
          required: true
        - id: "FE-UC02-002"
          title: "Categoria de outro tenant"
          required: true

    precondicoes:
      - permissao: "categorias.view"

    gatilho: "Usuario clica em categoria na arvore"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_categoria"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_detalhes"
      - passo: 5
        ator: "sistema"
        acao: "exibir_informacoes"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "categoria_nao_existe"
        resultado: "erro_404"
      - id: "FE-UC02-02"
        condicao: "categoria_outro_tenant"
        resultado: "erro_404_nao_revelar"

    regras_aplicadas:
      - "RN-RF016-11" # Isolamento multi-tenant

    resultado_final:
      estado: "detalhes_exibidos"

  - id: "UC03"
    nome: "Editar Categoria"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF-CRUD-04"  # Atualizar categoria
        - "RF-VAL-01"   # Validar campos obrigatórios
        - "RF-VAL-04"   # Validar hierarquia
        - "RF-VAL-05"   # Validar profundidade
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário clica em Editar categoria"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão categorias.update"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema carrega dados atuais"
          required: true
        - id: "FP-UC03-004"
          title: "Usuário altera campos permitidos"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema persiste alterações"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC03-001"
          title: "Alterar categoria pai"
          required: false
        - id: "FA-UC03-002"
          title: "Alterar taxa de depreciação"
          required: false
        - id: "FE-UC03-001"
          title: "Validação de campos falha"
          required: true
        - id: "FE-UC03-002"
          title: "Loop hierárquico ao mudar pai"
          required: true
        - id: "FE-UC03-003"
          title: "Categoria de sistema protegida"
          required: true

    precondicoes:
      - permissao: "categorias.update"

    gatilho: "Usuario clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_editar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 4
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 5
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 6
        ator: "sistema"
        acao: "persistir_mudancas"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "validacao_falha"
        resultado: "erro_400_mensagem_clara"
      - id: "FE-UC03-02"
        condicao: "loop_ao_mudar_pai"
        resultado: "erro_400_loop_detectado"

    regras_aplicadas:
      - "RN-RF016-01" # Hierarquia máxima 10 níveis
      - "RN-RF016-02" # Validação de loops
      - "RN-RF016-07" # Categorias de sistema protegidas

    resultado_final:
      estado: "categoria_atualizada"

  - id: "UC04"
    nome: "Inativar/Excluir Categoria"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      documentacao_items:
        - "RF-CRUD-05"  # Excluir categoria (soft delete)
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário seleciona Inativar/Excluir"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão categorias.delete"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema verifica dependências"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema pergunta sobre subcategorias (se houver)"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema executa soft delete"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC04-001"
          title: "Inativar em cascata (com filhas)"
          required: false
        - id: "FA-UC04-002"
          title: "Promover filhas ao nível pai"
          required: false
        - id: "FE-UC04-001"
          title: "Categoria com dependências ativas"
          required: true
        - id: "FE-UC04-002"
          title: "Categoria de sistema protegida"
          required: true

    precondicoes:
      - permissao: "categorias.delete"

    gatilho: "Usuario clica em Inativar ou Excluir"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_inativar_excluir"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "verificar_dependencias"
      - passo: 4
        ator: "sistema"
        acao: "perguntar_sobre_filhas"
      - passo: 5
        ator: "sistema"
        acao: "executar_soft_delete"
      - passo: 6
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos:
      - id: "FA-UC04-01"
        condicao: "usuario_escolhe_cascata"
        resultado: "inativar_todas_filhas"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "dependencias_ativas"
        resultado: "erro_400_listar_dependencias"
      - id: "FE-UC04-02"
        condicao: "categoria_sistema"
        resultado: "erro_400_protegida"

    regras_aplicadas:
      - "RN-RF016-07" # Categorias de sistema não podem ser excluídas
      - "RN-RF016-08" # Inativação em cascata opcional

    resultado_final:
      estado: "categoria_inativada_ou_excluida"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão YAML estruturado sincronizado com RF016.yaml v2.0. Criação inicial do UC.yaml para RF016."
