rf_id: RF022
rf_title: "Gestão de Fornecedores"
versao_governanca: "2.0"
data_migracao: "2025-12-30"
autor: "Agência ALC - alc.dev.br"

# ==============================================================================
# ITENS LEGADO RASTREADOS
# ==============================================================================

itens_legado:
  # ----------------------------------------------------------------------------
  # TELAS ASPX
  # ----------------------------------------------------------------------------
  - id: "LEG-RF022-001"
    tipo: "tela"
    titulo: "Empresa_Contratada.aspx"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\IControlIT\\Cadastro\\Empresa_Contratada.aspx"
    descricao: |
      Tela de cadastro/edição de empresas contratadas (fornecedores) usando ASP.NET Web Forms.
      Tela simples com 4 campos principais: Descrição (Razão Social), CNPJ, Contato, Observação.
      Problemas: Erros de nomenclatura (label CPNJ, campo txtTelefone para Observação),
      validação apenas frontend, exclusão física, sem auditoria.
    regras_implicitas:
      - "CNPJ obrigatório no frontend (RequiredFieldValidator) mas backend aceitava NULL"
      - "Exclusão física sem verificação de vínculos (contratos ativos)"
      - "Campo ReadOnly laranja (txtIdentificacao) exibia ID técnico"
      - "Sem validação de CNPJ duplicado"
      - "Botão Excluir executava DELETE físico"
    destino: "SUBSTITUÍDO"
    justificativa: "Tela completamente redesenhada em Angular 19 com dados cadastrais completos, validações backend, soft delete, auditoria e UX moderna"
    rastreabilidade:
      documentacao_moderno: "RF-022 - Seção 4 (Funcionalidades), Seção 5 (Regras de Negócio RN-001 a RN-020)"
      uc_moderno: "UC01-RF022 (Criar Fornecedor), UC02-RF022 (Editar Fornecedor)"
    migracao_moderna:
      componente_angular: "fornecedores-create.component.ts, fornecedores-edit.component.ts"
      rota_frontend: "/configuracoes/cadastros/fornecedores/create, /configuracoes/cadastros/fornecedores/edit/:id"
      endpoints_api: "POST /api/v1/fornecedores, PUT /api/v1/fornecedores/{id}"

  # ----------------------------------------------------------------------------
  # WEBSERVICES ASMX
  # ----------------------------------------------------------------------------
  - id: "LEG-RF022-002"
    tipo: "webservice"
    titulo: "WS_Fornecedor.asmx"
    caminho_legado: "D:\\IC2\\ic1_legado\\IControlIT\\WebServices\\WS_Fornecedor.asmx"
    metodos:
      - nome: "ListarFornecedores"
        parametros: "idFornecedor (int), tipoFornecedor (string)"
        retorno: "List<Fornecedor>"
        descricao: "Listar fornecedores por tipo. SEM PAGINAÇÃO (retorna todos registros)"

      - nome: "BuscarFornecedor"
        parametros: "idFornecedor (int)"
        retorno: "Fornecedor"
        descricao: "Buscar fornecedor por ID. SEM validação multi-tenant"

      - nome: "InserirFornecedor"
        parametros: "objFornecedor (Fornecedor)"
        retorno: "int (ID inserido)"
        descricao: "Criar fornecedor. Validação parcial, sem verificar CNPJ único"

      - nome: "AtualizarFornecedor"
        parametros: "objFornecedor (Fornecedor)"
        retorno: "bool"
        descricao: "Atualizar fornecedor. SEM auditoria de campos alterados"

      - nome: "InativarFornecedor"
        parametros: "idFornecedor (int)"
        retorno: "bool"
        descricao: "EXCLUSÃO FÍSICA (DELETE), não soft delete"

      - nome: "AdicionarContato"
        parametros: "idFornecedor (int), objContato (Contato)"
        retorno: "int"
        descricao: "Adicionar contato. SEM validação de contato principal duplicado"
    descricao: |
      Webservice SOAP para operações CRUD de fornecedores.
      Problemas: SOAP sem padrão REST, sem autenticação JWT, sem paginação,
      exclusão física, validações inconsistentes, sem versionamento de API.
    destino: "SUBSTITUÍDO"
    justificativa: "Webservices SOAP substituídos por REST API moderna com autenticação JWT, paginação, soft delete, validações completas, versionamento /api/v1/"
    rastreabilidade:
      documentacao_moderno: "RF-022 - Seção 11 (API Endpoints)"
      endpoint_moderno: "GET /api/v1/fornecedores, POST /api/v1/fornecedores, PUT /api/v1/fornecedores/{id}, DELETE /api/v1/fornecedores/{id}"
    migracao_moderna:
      command_cqrs: "CreateFornecedorCommand, UpdateFornecedorCommand, DeleteFornecedorCommand"
      handler: "CreateFornecedorCommandHandler, UpdateFornecedorCommandHandler, DeleteFornecedorCommandHandler"
      query_cqrs: "GetFornecedoresQuery, GetFornecedorByIdQuery"

  # ----------------------------------------------------------------------------
  # STORED PROCEDURES
  # ----------------------------------------------------------------------------
  - id: "LEG-RF022-003"
    tipo: "stored_procedure"
    titulo: "sp_InserirFornecedor"
    caminho_legado: "Database\\Procedures\\sp_InserirFornecedor.sql"
    parametros_entrada:
      - "@IdFornecedor INT"
      - "@Descricao VARCHAR(50)"
      - "@CNPJ VARCHAR(20)"
      - "@Contato VARCHAR(50)"
      - "@Observacao VARCHAR(200)"
      - "@FLAtivo BIT"
    parametros_saida:
      - "@IdFornecedor INT OUTPUT"
    descricao: |
      Stored procedure para inserir fornecedor.
      Executava INSERT direto sem validar CNPJ duplicado.
      Retornava ID gerado via SCOPE_IDENTITY().
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Application Layer (CQRS Handler) com validações completas (RN-RF022-001, RN-RF022-002)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-001 (CNPJ único), RN-RF022-002 (Validação CNPJ)"
      regra_moderna: "RN-RF022-001, RN-RF022-002, RN-RF022-004, RN-RF022-005"
    migracao_moderna:
      handler: "CreateFornecedorCommandHandler"
      validacao: "CreateFornecedorCommandValidator (FluentValidation)"

  - id: "LEG-RF022-004"
    tipo: "stored_procedure"
    titulo: "sp_AtualizarFornecedor"
    caminho_legado: "Database\\Procedures\\sp_AtualizarFornecedor.sql"
    parametros_entrada:
      - "@IdFornecedor INT"
      - "@Descricao VARCHAR(50)"
      - "@CNPJ VARCHAR(20)"
      - "@Contato VARCHAR(50)"
      - "@Observacao VARCHAR(200)"
    parametros_saida: []
    descricao: |
      Stored procedure para atualizar fornecedor.
      Executava UPDATE direto sem auditoria de campos alterados.
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Application Layer com auditoria completa (RN-RF022-015)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-015 (Auditoria completa)"
      regra_moderna: "RN-RF022-015"
    migracao_moderna:
      handler: "UpdateFornecedorCommandHandler"
      auditoria: "Fornecedor_Historico (registra payload_antes e payload_depois)"

  # ----------------------------------------------------------------------------
  # TABELAS LEGADAS
  # ----------------------------------------------------------------------------
  - id: "LEG-RF022-005"
    tipo: "tabela"
    titulo: "Fornecedor"
    schema_legado: "[dbo].[Fornecedor]"
    colunas_principais:
      - "Id_Fornecedor INT PRIMARY KEY IDENTITY"
      - "Id_Fornecedor INT"
      - "Descricao VARCHAR(50)"
      - "CNPJ VARCHAR(20)"
      - "Contato VARCHAR(50)"
      - "Observacao VARCHAR(200)"
      - "FL_Ativo BIT DEFAULT 1"
    problemas_identificados:
      - "Sem FK para Id_Fornecedor (não valida tenant)"
      - "Descricao VARCHAR(50) muito curto (fornecedor com razão social longa truncava)"
      - "Sem campos de auditoria (Created, CreatedBy, LastModified, LastModifiedBy)"
      - "Sem validação UNIQUE para CNPJ (permitia duplicatas)"
      - "FL_Ativo sem uso consistente (alguns deletes físicos ignoravam)"
    destino: "SUBSTITUÍDO"
    justificativa: "Tabela redesenhada com multi-tenancy rigoroso (TenantId FK), auditoria completa, soft delete, CNPJ único, campos expandidos"
    rastreabilidade:
      documentacao_moderno: "RF-022 - Seção 7 (Modelo de Dados)"
      md_moderno: "MD-RF022.md - Entidade Fornecedor"
    migracao_moderna:
      tabela_moderna: "Fornecedor"
      migration_ef_core: "20251230_CreateFornecedorTable.cs"
      mudancas_estruturais:
        - "Id INT → Id UNIQUEIDENTIFIER"
        - "Id_Fornecedor INT → TenantId UNIQUEIDENTIFIER NOT NULL (FK)"
        - "Descricao VARCHAR(50) → Nome NVARCHAR(200) NOT NULL"
        - "Adicionado: NomeFantasia NVARCHAR(200)"
        - "CNPJ VARCHAR(20) → CNPJ VARCHAR(14) (apenas dígitos)"
        - "Adicionado: CPF VARCHAR(11) (pessoa física)"
        - "Adicionado: Tipo NVARCHAR(50) (Enum TipoFornecedor)"
        - "FL_Ativo BIT → Status NVARCHAR(50) + IsDeleted BIT (soft delete)"
        - "Adicionado: NotaGeral DECIMAL(3,2)"
        - "Adicionado: Created, CreatedBy, LastModified, LastModifiedBy, DeletedAt, DeletedBy"

  - id: "LEG-RF022-006"
    tipo: "tabela"
    titulo: "Fornecedor_Contato"
    schema_legado: "[dbo].[Fornecedor_Contato]"
    colunas_principais:
      - "Id_Contato INT PRIMARY KEY IDENTITY"
      - "Id_Fornecedor INT"
      - "Nome VARCHAR(100)"
      - "Cargo VARCHAR(50)"
      - "Telefone VARCHAR(20)"
      - "Email VARCHAR(100)"
    problemas_identificados:
      - "Sem campo IsPrincipal (permitia múltiplos contatos principais do mesmo tipo)"
      - "Sem campo TipoContato (valores livres, sem enum)"
      - "Sem validação de e-mail"
      - "Telefone único (não separava fixo/celular)"
    destino: "SUBSTITUÍDO"
    justificativa: "Tabela redesenhada com TipoContato enum (COMERCIAL, TECNICO, FINANCEIRO, JURIDICO), IsPrincipal, separação TelefoneFixo/TelefoneCelular, validação e-mail"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-009 (Apenas um contato principal por tipo), RN-RF022-017 (Telefone obrigatório), RN-RF022-018 (Validação tipo contato)"
      md_moderno: "MD-RF022.md - Entidade FornecedorContato"
    migracao_moderna:
      tabela_moderna: "FornecedorContato"
      migration_ef_core: "20251230_CreateFornecedorContatoTable.cs"
      mudancas_estruturais:
        - "Id_Contato INT → Id UNIQUEIDENTIFIER"
        - "Id_Fornecedor INT → FornecedorId UNIQUEIDENTIFIER NOT NULL (FK)"
        - "Adicionado: TipoContato NVARCHAR(50) NOT NULL (Enum)"
        - "Telefone VARCHAR(20) → TelefoneFixo VARCHAR(20) + TelefoneCelular VARCHAR(20)"
        - "Adicionado: IsPrincipal BIT DEFAULT 0"
        - "Adicionado: Created, CreatedBy, LastModified, LastModifiedBy"

  - id: "LEG-RF022-007"
    tipo: "tabela"
    titulo: "Fornecedor_Avaliacao (NÃO EXISTIA)"
    schema_legado: "null"
    descricao: |
      Tabela NÃO EXISTIA no sistema legado.
      Sistema legado não tinha funcionalidade de avaliação de fornecedores.
    destino: "NOVA"
    justificativa: "Nova funcionalidade no RF-022 para avaliar performance de fornecedores (rating 1-5 estrelas com critérios: qualidade, prazo, atendimento, preço)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-010 (Nota válida), RN-RF022-011 (Cálculo automático), RN-RF022-012 (Atualização automática nota), RN-RF022-019 (Comentário obrigatório avaliação negativa)"
      md_moderno: "MD-RF022.md - Entidade FornecedorAvaliacao"
    migracao_moderna:
      tabela_moderna: "FornecedorAvaliacao"
      migration_ef_core: "20251230_CreateFornecedorAvaliacaoTable.cs"
      colunas:
        - "Id UNIQUEIDENTIFIER PRIMARY KEY"
        - "FornecedorId UNIQUEIDENTIFIER NOT NULL (FK)"
        - "AvaliadorId UNIQUEIDENTIFIER NOT NULL (FK User)"
        - "NotaQualidade DECIMAL(3,2) NOT NULL"
        - "NotaPrazo DECIMAL(3,2) NOT NULL"
        - "NotaAtendimento DECIMAL(3,2) NOT NULL"
        - "NotaPreco DECIMAL(3,2) NOT NULL"
        - "NotaGeral DECIMAL(3,2) NOT NULL (calculada)"
        - "Comentario NVARCHAR(1000)"
        - "Created DATETIME2 NOT NULL"
        - "CreatedBy UNIQUEIDENTIFIER NOT NULL"

  - id: "LEG-RF022-008"
    tipo: "tabela"
    titulo: "Fornecedor_Documento (NÃO EXISTIA)"
    schema_legado: "null"
    descricao: |
      Tabela NÃO EXISTIA no sistema legado.
      Sistema legado não permitia anexar documentos obrigatórios (contratos sociais, certidões, certificações).
    destino: "NOVA"
    justificativa: "Nova funcionalidade no RF-022 para gestão de documentos obrigatórios com alertas de vencimento (compliance fiscal e regulatório)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-013 (Validação documentos vencidos)"
      md_moderno: "MD-RF022.md - Entidade FornecedorDocumento"
    migracao_moderna:
      tabela_moderna: "FornecedorDocumento"
      migration_ef_core: "20251230_CreateFornecedorDocumentoTable.cs"
      colunas:
        - "Id UNIQUEIDENTIFIER PRIMARY KEY"
        - "FornecedorId UNIQUEIDENTIFIER NOT NULL (FK)"
        - "TipoDocumento NVARCHAR(100) NOT NULL (Contrato Social, Certidão, ISO, etc)"
        - "NumeroDocumento NVARCHAR(100)"
        - "DataEmissao DATE"
        - "DataVencimento DATE"
        - "ArquivoUrl NVARCHAR(500)"
        - "ArquivoNome NVARCHAR(200)"
        - "Created DATETIME2 NOT NULL"
        - "CreatedBy UNIQUEIDENTIFIER NOT NULL"

  - id: "LEG-RF022-009"
    tipo: "tabela"
    titulo: "Fornecedor_Historico (NÃO EXISTIA COMPLETO)"
    schema_legado: "null (auditoria parcial inconsistente)"
    descricao: |
      Auditoria parcial e inconsistente no legado.
      Algumas operações eram auditadas, outras não.
      Sem padrão de campos (ora registrava JSON, ora campos soltos).
    destino: "NOVA"
    justificativa: "Tabela de auditoria padronizada para compliance fiscal (retenção 7 anos, RN-RF022-015)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-015 (Auditoria completa)"
      md_moderno: "MD-RF022.md - Entidade FornecedorHistorico"
    migracao_moderna:
      tabela_moderna: "FornecedorHistorico"
      migration_ef_core: "20251230_CreateFornecedorHistoricoTable.cs"
      colunas:
        - "Id UNIQUEIDENTIFIER PRIMARY KEY"
        - "FornecedorId UNIQUEIDENTIFIER NOT NULL (FK)"
        - "Operacao NVARCHAR(50) NOT NULL (CREATE, UPDATE, DELETE, RATE, BLOCK)"
        - "UsuarioId UNIQUEIDENTIFIER NOT NULL"
        - "Timestamp DATETIME2 NOT NULL"
        - "PayloadAntes NVARCHAR(MAX) (JSON)"
        - "PayloadDepois NVARCHAR(MAX) (JSON)"
        - "CamposAlterados NVARCHAR(500)"
        - "IpAddress NVARCHAR(50)"

  # ----------------------------------------------------------------------------
  # REGRAS IMPLÍCITAS
  # ----------------------------------------------------------------------------
  - id: "LEG-RF022-010"
    tipo: "regra_negocio"
    titulo: "CNPJ opcional (não documentado)"
    localizacao_codigo: "Empresa_Contratada.aspx.vb - Método btnSalvar_Click"
    descricao: |
      CNPJ era obrigatório no frontend (RequiredFieldValidator),
      mas backend aceitava NULL sem validação.
      Inconsistência entre frontend e backend.
    destino: "ASSUMIDO"
    justificativa: "CNPJ permanece opcional no sistema moderno (pode ser pessoa física com CPF - RN-RF022-003)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-002 (Validação CNPJ), RN-RF022-003 (Validação CPF)"
      regra_moderna: "RN-RF022-002, RN-RF022-003"
    migracao_moderna:
      validador: "CreateFornecedorCommandValidator"
      linha_codigo: "RuleFor(x => x.Cnpj).Must(BeValidCnpj).When(x => !string.IsNullOrEmpty(x.Cnpj))"

  - id: "LEG-RF022-011"
    tipo: "regra_negocio"
    titulo: "Exclusão sem verificação de vínculos"
    localizacao_codigo: "Empresa_Contratada.aspx.vb - Método btnExcluir_Click, WS_Fornecedor.asmx.vb - Método InativarFornecedor"
    descricao: |
      Sistema permitia excluir fornecedor (DELETE físico) mesmo com contratos ativos vinculados.
      Causava perda de integridade referencial e erros em relatórios.
    destino: "SUBSTITUÍDO"
    justificativa: "Corrigido no sistema moderno: RN-RF022-007 bloqueia inativação com contratos ativos (HTTP 409), soft delete (RN-RF022-015)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-007 (Não inativar com contratos ativos)"
      regra_moderna: "RN-RF022-007"
    migracao_moderna:
      validador: "DeleteFornecedorCommandValidator"
      linha_codigo: "RuleFor(x => x.Id).MustAsync(async (id, ct) => !await HasActiveContracts(id, ct)).WithMessage('Não é possível inativar fornecedor com contratos ativos')"

  - id: "LEG-RF022-012"
    tipo: "regra_negocio"
    titulo: "Contato principal não validado"
    localizacao_codigo: "WS_Fornecedor.asmx.vb - Método AdicionarContato"
    descricao: |
      Sistema permitia adicionar múltiplos contatos marcados como "principais" do mesmo tipo
      (ex: 2 contatos comerciais principais).
    destino: "SUBSTITUÍDO"
    justificativa: "Corrigido no sistema moderno: RN-RF022-009 valida unicidade de contato principal por tipo (HTTP 409 se tentar duplicar)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-009 (Apenas um contato principal por tipo)"
      regra_moderna: "RN-RF022-009"
    migracao_moderna:
      validador: "CreateContatoCommandValidator"
      linha_codigo: "RuleFor(x => x).MustAsync(async (cmd, ct) => !await HasPrincipalOfType(cmd.FornecedorId, cmd.TipoContato, ct)).When(x => x.IsPrincipal).WithMessage('Já existe um contato principal do tipo {TipoContato}')"

  - id: "LEG-RF022-013"
    tipo: "regra_negocio"
    titulo: "CNPJ com formatação inconsistente"
    localizacao_codigo: "Empresa_Contratada.aspx.vb, sp_InserirFornecedor.sql"
    descricao: |
      CNPJ armazenado ora com pontuação (99.999.999/9999-99),
      ora sem (14 dígitos puros).
      Dificultava buscas e validações.
    destino: "SUBSTITUÍDO"
    justificativa: "Padronizado no sistema moderno: armazenar apenas dígitos (14 caracteres), formatar apenas no frontend (RN-RF022-002)"
    rastreabilidade:
      documentacao_moderno: "RF-022 - RN-RF022-002 (Validação CNPJ)"
      regra_moderna: "RN-RF022-002"
    migracao_moderna:
      validador: "CreateFornecedorCommandValidator"
      linha_codigo: "RuleFor(x => x.Cnpj).Must(BeValidCnpj).When(x => !string.IsNullOrEmpty(x.Cnpj)); // Remove pontuação antes de validar"
      script_migracao: "UPDATE Fornecedor SET CNPJ = REPLACE(REPLACE(REPLACE(CNPJ, '.', ''), '/', ''), '-', '') WHERE CNPJ IS NOT NULL"

# ==============================================================================
# BANCOS LEGADOS MAPEADOS (se aplicável)
# ==============================================================================

bancos_legados:
  - nome: "IControlIT_Cliente01"
    servidor: "SQL-LEGADO-01"
    tabelas_relacionadas:
      - "Fornecedor"
      - "Fornecedor_Contato"
    destino: "CONSOLIDADO"
    justificativa: "Migrado para banco único com multi-tenancy (TenantId) usando Row-Level Security"
    banco_moderno: "IControlIT.db (SQLite dev) / SQL Server moderno (prod)"

  - nome: "IControlIT_Cliente02"
    servidor: "SQL-LEGADO-01"
    tabelas_relacionadas:
      - "Fornecedor"
      - "Fornecedor_Contato"
    destino: "CONSOLIDADO"
    justificativa: "Migrado para banco único com multi-tenancy (TenantId) usando Row-Level Security"
    banco_moderno: "IControlIT.db (SQLite dev) / SQL Server moderno (prod)"

  - nome: "IControlIT_Cliente03"
    servidor: "SQL-LEGADO-02"
    tabelas_relacionadas:
      - "Fornecedor"
      - "Fornecedor_Contato"
    destino: "CONSOLIDADO"
    justificativa: "Migrado para banco único com multi-tenancy (TenantId) usando Row-Level Security"
    banco_moderno: "IControlIT.db (SQLite dev) / SQL Server moderno (prod)"

# ==============================================================================
# PROBLEMAS LEGADO IDENTIFICADOS
# ==============================================================================

problemas_legado:
  - id: "PROB-RF022-001"
    titulo: "Multi-database sem governança"
    severidade: "CRÍTICA"
    descricao: |
      Cada cliente tinha banco SQL Server separado (IControlIT_ClienteXX).
      Dificultava manutenção, backup, deploy, versionamento de schema.
      Scripts de migration tinham que rodar em 100+ bancos.
    impacto: "Operacional alto, custo de manutenção elevado, risco de inconsistência de schema"
    solucao_moderna: "Banco único com multi-tenancy via TenantId + Row-Level Security. Migration automática via EF Core."

  - id: "PROB-RF022-002"
    titulo: "Código misturado em code-behind VB.NET"
    severidade: "ALTA"
    descricao: |
      Lógica de negócio misturada em arquivos .aspx.vb (code-behind).
      Dificultava testes unitários, reuso, manutenção.
      Validações ora no frontend, ora no backend, ora ausentes.
    impacto: "Qualidade de código baixa, dívida técnica alta, bugs recorrentes"
    solucao_moderna: "Clean Architecture + CQRS. Lógica de negócio em Handlers (Application Layer), validações em Validators (FluentValidation), separação clara backend/frontend."

  - id: "PROB-RF022-003"
    titulo: "Webservices SOAP sem padrão REST"
    severidade: "ALTA"
    descricao: |
      Webservices ASMX (SOAP) dificultavam integração moderna.
      Sem versionamento de API, sem paginação, sem autenticação JWT.
      Quebra de compatibilidade em cada mudança.
    impacto: "Dificulta integrações externas, performance ruim, falta de controle de versão"
    solucao_moderna: "REST API com versionamento /api/v1/, autenticação JWT Bearer, paginação obrigatória, DTOs tipados, HTTP status codes padronizados."

  - id: "PROB-RF022-004"
    titulo: "Validações inconsistentes"
    severidade: "ALTA"
    descricao: |
      Validação de CNPJ apenas no frontend (MaskedEditValidator).
      Backend aceitava CNPJ inválido ou duplicado.
      Validação de contato principal não existia.
    impacto: "Dados inconsistentes no banco, duplicatas, erros em relatórios"
    solucao_moderna: "Validações sempre no backend (FluentValidation), frontend apenas UX. RN-RF022-001 (CNPJ único), RN-RF022-002 (CNPJ válido), RN-RF022-009 (contato principal único)."

  - id: "PROB-RF022-005"
    titulo: "Exclusão física sem soft delete"
    severidade: "MÉDIA"
    descricao: |
      Botão "Excluir" executava DELETE físico.
      Perda de dados históricos, impossibilidade de auditoria, violação de compliance.
    impacto: "Perda de histórico, não conformidade com LGPD/GDPR, impossibilidade de restauração"
    solucao_moderna: "Soft delete obrigatório (IsDeleted + DeletedAt + DeletedBy). RN-RF022-015 (auditoria completa com retenção 7 anos)."

  - id: "PROB-RF022-006"
    titulo: "Auditoria parcial e inconsistente"
    severidade: "ALTA"
    descricao: |
      Algumas operações auditadas em Fornecedor_Historico (inconsistente).
      Outras operações sem auditoria.
      Sem padrão de campos (ora JSON, ora campos soltos).
    impacto: "Não conformidade fiscal, impossibilidade de rastrear alterações, risco legal"
    solucao_moderna: "Auditoria completa padronizada em FornecedorHistorico (RN-RF022-015): todas operações (CREATE/UPDATE/DELETE/RATE/BLOCK), payload_antes/payload_depois em JSON, retenção 7 anos."

# ==============================================================================
# METADADOS
# ==============================================================================

metadados:
  total_itens_legado: 13
  itens_assumidos: 1   # RL-RN-001: CNPJ opcional
  itens_substituidos: 11  # Telas, Webservices, Tabelas, Regras
  itens_descartados: 0
  itens_novos: 3  # Avaliacao, Documento, Historico completo
  itens_a_revisar: 0
  cobertura_destinos: "100%"

  contagem_por_tipo:
    telas: 1
    webservices: 1
    stored_procedures: 2
    tabelas: 5  # 2 substituídas + 3 novas
    regras_negocio: 4
    bancos_legados: 3

  problemas_criticos: 2  # Multi-database, Auditoria
  problemas_altos: 4  # Código misturado, SOAP, Validações, Exclusão física
  problemas_medios: 0

# ==============================================================================
# CHANGELOG
# ==============================================================================

changelog:
  - versao: "1.0"
    data: "2025-12-30"
    descricao: "Criação inicial - Separação RF/RL na migração v1.0 → v2.0, 13 itens rastreados, 100% com destino definido"
    autor: "Agência ALC - alc.dev.br"
