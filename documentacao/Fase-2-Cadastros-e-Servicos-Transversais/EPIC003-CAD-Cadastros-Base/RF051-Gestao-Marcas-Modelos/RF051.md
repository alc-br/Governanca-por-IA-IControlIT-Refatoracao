# RF051: Gestão de Marcas e Modelos de Ativos

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC003-CAD-Cadastros-Base
**Fase**: Fase 2 - Cadastros e Serviços Transversais

---

## 1. OBJETIVO DO REQUISITO

Implementar sistema completo de catalogação de **Fabricantes, Marcas e Modelos** de equipamentos e ativos de TI/Telecom, permitindo padronização, rastreamento detalhado de especificações técnicas e gerenciamento do ciclo de vida de produtos, servindo como base para gestão de ativos, compras e inventário.

Este documento define **o que o sistema deve fazer**, sob quais condições e quais garantias devem ser preservadas, sem especificar tecnologia ou implementação.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] Cadastro completo de Fabricantes (nome, país de origem, website, logo, contato)
- [x] Cadastro de Marcas vinculadas a Fabricantes
- [x] Cadastro detalhado de Modelos com especificações técnicas
- [x] Gerenciamento de SKUs e Part Numbers únicos
- [x] Importação em massa de catálogos de fabricantes (CSV/Excel)
- [x] Especificações técnicas customizadas por tipo de ativo (JSON dinâmico)
- [x] Homologação de modelos para uso corporativo
- [x] Controle de ciclo de vida (EOL - End of Life, descontinuado)
- [x] Histórico imutável de preços por modelo
- [x] Integração com APIs externas para busca de especificações
- [x] Relacionamento com Tipos de Ativos (RF049)
- [x] Auditoria completa de todas as operações
- [x] Controle de acesso RBAC
- [x] Isolamento multi-tenant

### 2.2 Fora do escopo (não objetivos)

- Interface visual específica (responsabilidade do frontend)
- Tecnologia, framework ou linguagem de implementação
- Layout, UX ou identidade visual
- Estratégia de deploy ou infraestrutura
- Gestão de contratos com fabricantes (RF futuro)
- Integração direta com e-commerce de fabricantes
- Sistema de cotação automática

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| **Fabricante** | Empresa que produz equipamentos/ativos (ex: Dell, HP, Lenovo) |
| **Marca** | Linha de produtos de um Fabricante (ex: Dell Latitude, HP ProBook) |
| **Modelo** | Versão específica de um produto (ex: Dell Latitude 5420, HP ProBook 450 G8) |
| **Part Number** | Código único do fabricante para identificar um modelo específico |
| **SKU** | Stock Keeping Unit - Código interno de identificação de produto |
| **Especificações Técnicas** | Características detalhadas do modelo (CPU, RAM, HD, dimensões, peso, etc.) |
| **Homologação** | Aprovação do modelo para uso/compra na organização |
| **EOL (End of Life)** | Modelo descontinuado pelo fabricante (não mais produzido/vendido) |
| **Tenant** | Unidade lógica de isolamento de dados (empresa/Fornecedor) |
| **Multi-Tenancy** | Isolamento de dados entre empresas no mesmo sistema |

---

## 4. FUNCIONALIDADES COBERTAS

### Fabricantes
1. Criar fabricante com informações completas
2. Atualizar dados de fabricante existente
3. Consultar fabricante por ID
4. Listar fabricantes com paginação e filtros
5. Marcar fabricante como inativo
6. Upload de logo do fabricante

### Marcas
7. Criar marca vinculada a fabricante
8. Atualizar marca existente
9. Consultar marca por ID
10. Listar marcas com filtros (por fabricante, status)
11. Marcar marca como inativa

### Modelos
12. Criar modelo com especificações técnicas detalhadas
13. Atualizar modelo existente
14. Consultar modelo por ID
15. Listar modelos com filtros avançados (fabricante, marca, tipo de ativo, homologado, EOL)
16. Adicionar/editar especificações técnicas (JSON dinâmico)
17. Upload de imagens do modelo (múltiplas fotos)
18. Marcar modelo como EOL (End of Life)
19. Homologar/desomologar modelo para uso corporativo
20. Vincular modelo a Tipo de Ativo (RF049)
21. Registrar histórico de preços (imutável)
22. Importar catálogo de modelos (CSV/Excel)
23. Buscar especificações em APIs externas (integração)
24. Consultar ativos cadastrados com este modelo

---

## 5. REGRAS DE NEGÓCIO

### RN-RF051-001 — Nome de Fabricante Único

**Descrição**: O nome do fabricante deve ser único dentro do sistema (por tenant).

**Justificativa**: Evitar duplicação de fabricantes e garantir integridade do catálogo.

**Critério de Aceite**:
- Tentativa de cadastrar fabricante com nome já existente → rejeitar (HTTP 400)
- Validação case-insensitive (Dell = DELL = dell)
- Permitir mesmo nome em tenants diferentes

**Validação**:
- Tipo: Unicidade
- Mensagem: "Já existe um fabricante com este nome cadastrado"
- HTTP Code: 400

---

### RN-RF051-002 — Part Number Único por Fabricante

**Descrição**: O Part Number deve ser único dentro do mesmo fabricante, mas pode se repetir entre fabricantes diferentes.

**Justificativa**: Cada fabricante tem sua própria numeração de produtos, mas dentro do mesmo fabricante não pode haver duplicação.

**Critério de Aceite**:
- Mesmo Part Number em fabricantes diferentes → permitido
- Part Number duplicado no mesmo fabricante → rejeitar (HTTP 400)
- Validação case-insensitive

**Validação**:
- Tipo: Unicidade composta (FabricanteId + PartNumber)
- Mensagem: "Este fabricante já possui um modelo com este Part Number"
- HTTP Code: 400

---

### RN-RF051-003 — Desomologação Automática ao Marcar EOL

**Descrição**: Quando um modelo for marcado como EOL (End of Life), deve ser automaticamente desomologado para uso corporativo.

**Justificativa**: Produtos EOL não devem ser comprados ou utilizados em novos projetos, apenas para manutenção de ativos existentes.

**Critério de Aceite**:
- Marcar modelo como EOL → desmarcar homologação automaticamente
- Alertar usuário sobre quantidade de ativos existentes com este modelo
- Permitir override manual (manter homologado mesmo EOL) com justificativa obrigatória

**Validação**:
- Tipo: Regra de negócio condicional
- Mensagem: "Modelo EOL não pode estar homologado. Existem X ativos cadastrados com este modelo."
- HTTP Code: 200 (com warning)

---

### RN-RF051-004 — Especificações Técnicas em JSON Válido

**Descrição**: As especificações técnicas devem ser armazenadas em formato JSON válido, permitindo campos customizados por categoria de ativo.

**Justificativa**: Flexibilidade para diferentes tipos de ativos (notebooks, desktops, smartphones) terem especificações diferentes.

**Critério de Aceite**:
- JSON inválido → rejeitar (HTTP 400)
- Permitir estrutura dinâmica (não schema rígido)
- Validar tipos básicos (strings, números, booleanos, arrays)
- Suportar nested objects

**Exemplo de JSON válido**:
```json
{
  "processador": "Intel Core i7-11800H",
  "ram": "32GB DDR4",
  "armazenamento": {
    "tipo": "SSD NVMe",
    "capacidade": "1TB"
  },
  "tela": {
    "tamanho": "15.6 polegadas",
    "resolucao": "1920x1080",
    "tecnologia": "IPS"
  },
  "peso": "2.1 kg",
  "dimensoes": {
    "largura": 35.8,
    "profundidade": 23.3,
    "altura": 1.9,
    "unidade": "cm"
  }
}
```

**Validação**:
- Tipo: Formato/Estrutura
- Mensagem: "Especificações técnicas devem estar em formato JSON válido"
- HTTP Code: 400

---

### RN-RF051-005 — Histórico de Preços Imutável

**Descrição**: Registros de histórico de preços não podem ser alterados ou excluídos após criação. Novo preço = novo registro.

**Justificativa**: Rastreamento histórico de variações de preço para análise de custos, relatórios financeiros e conformidade.

**Critério de Aceite**:
- Tentativa de UPDATE em registro de preço → rejeitar (HTTP 403)
- Tentativa de DELETE em registro de preço → rejeitar (HTTP 403)
- Novo preço → criar novo registro com data/hora atual
- Manter histórico completo (sem limite de tempo)

**Validação**:
- Tipo: Segurança/Integridade
- Mensagem: "Histórico de preços é imutável. Crie um novo registro para atualizar o preço."
- HTTP Code: 403

---

### RN-RF051-006 — Modelo Deve Pertencer a Marca do Mesmo Fabricante

**Descrição**: Um modelo só pode ser vinculado a uma marca que pertença ao mesmo fabricante.

**Justificativa**: Integridade referencial da hierarquia Fabricante → Marca → Modelo.

**Critério de Aceite**:
- Tentativa de vincular modelo a marca de fabricante diferente → rejeitar (HTTP 400)
- Validação automática ao criar/atualizar modelo
- Mensagem clara indicando o erro

**Validação**:
- Tipo: Integridade referencial
- Mensagem: "A marca selecionada não pertence ao fabricante deste modelo"
- HTTP Code: 400

---

### RN-RF051-007 — Fabricante Inativo Não Permite Novos Modelos

**Descrição**: Não é permitido cadastrar novos modelos para fabricantes marcados como inativos.

**Justificativa**: Fabricantes inativos são aqueles que não são mais utilizados/comercializados. Modelos existentes são mantidos para histórico.

**Critério de Aceite**:
- Tentativa de criar modelo para fabricante inativo → rejeitar (HTTP 400)
- Permitir edição de modelos existentes
- Permitir reativar fabricante antes de adicionar novos modelos

**Validação**:
- Tipo: Regra de negócio
- Mensagem: "Não é possível cadastrar modelos para fabricantes inativos. Reative o fabricante primeiro."
- HTTP Code: 400

---

### RN-RF051-008 — Marca Inativa Não Permite Novos Modelos

**Descrição**: Não é permitido cadastrar novos modelos para marcas marcadas como inativas.

**Justificativa**: Marcas inativas são linhas de produtos descontinuadas. Modelos existentes são mantidos para histórico.

**Critério de Aceite**:
- Tentativa de criar modelo para marca inativa → rejeitar (HTTP 400)
- Permitir edição de modelos existentes
- Permitir reativar marca antes de adicionar novos modelos

**Validação**:
- Tipo: Regra de negócio
- Mensagem: "Não é possível cadastrar modelos para marcas inativas. Reative a marca primeiro."
- HTTP Code: 400

---

### RN-RF051-009 — SKU Único no Sistema (Global)

**Descrição**: O SKU interno deve ser único em todo o sistema (não apenas por tenant), pois é usado para integração com sistemas externos.

**Justificativa**: O SKU é usado como referência global para integração com ERPs, sistemas de compras e inventário.

**Critério de Aceite**:
- SKU duplicado em qualquer tenant → rejeitar (HTTP 400)
- Validação global (não apenas por EmpresaId)
- SKU opcional (pode ser NULL)
- Se preenchido, deve ser único

**Validação**:
- Tipo: Unicidade global
- Mensagem: "Este SKU já está em uso no sistema"
- HTTP Code: 400

---

### RN-RF051-010 — Homologação Requer Justificativa

**Descrição**: Ao homologar um modelo para uso corporativo, deve ser obrigatório informar uma justificativa técnica/comercial.

**Justificativa**: Documentar critérios de decisão para homologação, permitindo auditoria e revisões futuras.

**Critério de Aceite**:
- Homologação sem justificativa → rejeitar (HTTP 400)
- Justificativa mínima: 20 caracteres
- Justificativa máxima: 500 caracteres
- Armazenar usuário, data e justificativa no histórico

**Validação**:
- Tipo: Campo obrigatório condicional
- Mensagem: "Informe a justificativa para homologação do modelo (mínimo 20 caracteres)"
- HTTP Code: 400

---

### RN-RF051-011 — Importação em Massa Valida Todos os Registros

**Descrição**: Ao importar catálogo de modelos via CSV/Excel, o sistema deve validar todos os registros ANTES de persistir qualquer dado (transação atômica).

**Justificativa**: Evitar importação parcial que deixe base de dados inconsistente.

**Critério de Aceite**:
- Se 1 registro for inválido → rejeitar TODOS (rollback completo)
- Retornar relatório detalhado com linha e erro de cada registro inválido
- Não persistir nenhum dado se houver erros
- Validar todas as regras de negócio em cada linha

**Validação**:
- Tipo: Transação atômica
- Mensagem: "Importação falhou. Corrija os erros e tente novamente: [lista de erros]"
- HTTP Code: 400

---

### RN-RF051-012 — Imagens do Modelo (Máximo 10)

**Descrição**: Cada modelo pode ter no máximo 10 imagens associadas.

**Justificativa**: Limite técnico para performance e armazenamento.

**Critério de Aceite**:
- Tentativa de upload de 11ª imagem → rejeitar (HTTP 400)
- Formatos permitidos: JPG, PNG, WEBP
- Tamanho máximo por imagem: 5MB
- Resolução mínima: 800x600
- Resolução máxima: 4096x4096

**Validação**:
- Tipo: Limite de quantidade/tamanho
- Mensagem: "Máximo de 10 imagens por modelo. Exclua imagens existentes antes de adicionar novas."
- HTTP Code: 400

---

## 6. ESTADOS DA ENTIDADE

### Fabricante

| Estado | Descrição |
|--------|-----------|
| `active` | Fabricante ativo, aceita novos modelos/marcas |
| `inactive` | Fabricante inativo, não aceita novos modelos/marcas (mantém existentes) |

### Marca

| Estado | Descrição |
|--------|-----------|
| `active` | Marca ativa, aceita novos modelos |
| `inactive` | Marca inativa, não aceita novos modelos (mantém existentes) |

### Modelo

| Estado | Descrição |
|--------|-----------|
| `active` | Modelo ativo, disponível para uso |
| `eol` | End of Life - descontinuado pelo fabricante |
| `inactive` | Modelo inativo (decisão interna, não EOL do fabricante) |

### Transições permitidas

| Entidade | De | Para | Observação |
|----------|---|------|------------|
| Fabricante | active | inactive | Inativar fabricante |
| Fabricante | inactive | active | Reativar fabricante |
| Marca | active | inactive | Inativar marca |
| Marca | inactive | active | Reativar marca |
| Modelo | active | eol | Marcar como EOL (desomologa automaticamente) |
| Modelo | active | inactive | Inativar modelo |
| Modelo | inactive | active | Reativar modelo |
| Modelo | eol | active | Reativar modelo EOL (requer justificativa) |

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre | Payload |
|--------|---------------|---------|
| `fabricante.criado` | Após criação de fabricante | FabricanteId, Nome, Tenant |
| `fabricante.atualizado` | Após atualização de fabricante | FabricanteId, Campos alterados |
| `fabricante.inativado` | Ao marcar como inativo | FabricanteId, Motivo |
| `marca.criada` | Após criação de marca | MarcaId, FabricanteId, Nome |
| `marca.atualizada` | Após atualização de marca | MarcaId, Campos alterados |
| `marca.inativada` | Ao marcar como inativo | MarcaId, Motivo |
| `modelo.criado` | Após criação de modelo | ModeloId, MarcaId, PartNumber |
| `modelo.atualizado` | Após atualização de modelo | ModeloId, Campos alterados |
| `modelo.marcado_eol` | Ao marcar como EOL | ModeloId, QuantidadeAtivosImpactados |
| `modelo.homologado` | Ao homologar modelo | ModeloId, Justificativa, UsuarioId |
| `modelo.desomologado` | Ao desomologar modelo | ModeloId, Motivo |
| `preco.registrado` | Ao adicionar preço ao histórico | ModeloId, Valor, Moeda, DataReferencia |

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- Nenhuma operação pode violar isolamento de tenant (exceto SKU global)
- Nenhuma regra de negócio pode ser ignorada
- Erros devem ser previsíveis e rastreáveis
- Auditoria deve registrar quem, quando e o que mudou em TODAS as entidades
- Histórico de preços é imutável (append-only)
- Hierarquia Fabricante → Marca → Modelo deve ser respeitada
- Especificações técnicas devem ser validadas como JSON
- Importação em massa deve ser transacional (tudo ou nada)

---

## 9. SEGURANÇA

### Validação de Entrada
- Todos os campos obrigatórios devem ser validados
- Formato de JSON técnico deve ser validado
- Tamanho e formato de imagens devem ser validados
- Proteção contra SQL Injection (usar ORM com parametrização)
- Proteção contra XSS (sanitização de inputs)

### Controle de Permissões
- Criar fabricante: `CAD.MARCAS_MODELOS.FABRICANTES.CREATE`
- Editar fabricante: `CAD.MARCAS_MODELOS.FABRICANTES.UPDATE`
- Inativar fabricante: `CAD.MARCAS_MODELOS.FABRICANTES.DELETE`
- Criar marca: `CAD.MARCAS_MODELOS.MARCAS.CREATE`
- Editar marca: `CAD.MARCAS_MODELOS.MARCAS.UPDATE`
- Inativar marca: `CAD.MARCAS_MODELOS.MARCAS.DELETE`
- Criar modelo: `CAD.MARCAS_MODELOS.MODELOS.CREATE`
- Editar modelo: `CAD.MARCAS_MODELOS.MODELOS.UPDATE`
- Marcar EOL: `CAD.MARCAS_MODELOS.MODELOS.EOL`
- Homologar modelo: `CAD.MARCAS_MODELOS.MODELOS.HOMOLOGAR`
- Importar catálogo: `CAD.MARCAS_MODELOS.MODELOS.IMPORT`
- Visualizar histórico preços: `CAD.MARCAS_MODELOS.PRECOS.VIEW`
- Registrar preço: `CAD.MARCAS_MODELOS.PRECOS.CREATE`

### Isolamento Multi-Tenant
- Fabricantes, Marcas e Modelos isolados por EmpresaId
- SKU é global (único em todo o sistema)
- Validação automática de tenant em todas as queries

### Auditoria
- Todas as operações CREATE, UPDATE, DELETE devem ser auditadas
- Campos obrigatórios: CreatedBy, CreatedAt, LastModifiedBy, LastModifiedAt
- Homologação/Desomologação devem registrar justificativa
- Histórico de preços é naturalmente auditável (imutável)

---

## 10. ARTEFATOS DERIVADOS

Este RF é base para:

- **UC-RF051.md** (Casos de Uso) - 5 UCs padrão + específicos
- **MD-RF051.md** (Modelo de Dados) - DDL completo com tabelas Fabricante, Marca, Modelo, ModeloPreco
- **WF-RF051.md** (Wireframes) - Telas de listagem, cadastro, homologação
- **MT-RF051.yaml** (Massas de Teste) - Dados válidos/inválidos para testes
- **TC-RF051.yaml** (Casos de Teste) - Testes backend, frontend, segurança, E2E

---

## 11. RASTREABILIDADE

| Artefato | Status | Observação |
|----------|--------|------------|
| Casos de Uso (UC-RF051.md) | Criado | 5 UCs obrigatórios + UCs específicos |
| Modelo de Dados (MD-RF051.md) | Criado | Tabelas: Fabricante, Marca, Modelo, ModeloPreco, ModeloImagem |
| Wireframes (WF-RF051.md) | Criado | Fluxos de cadastro, homologação, EOL |
| Massas de Teste (MT-RF051.yaml) | Pendente | Aguardando CONTRATO-DOCUMENTACAO-GOVERNADA-TESTES |
| Casos de Teste (TC-RF051.yaml) | Pendente | Aguardando CONTRATO-DOCUMENTACAO-GOVERNADA-TESTES |
| Backend | Concluído | Clean Architecture + CQRS |
| Frontend | Concluído | Angular 19 + Standalone Components |
| Testes TI (Backend) | Não executado | Aguardando CONTRATO-EXECUCAO-TESTES |
| Testes TI (Frontend) | Não executado | Aguardando CONTRATO-EXECUCAO-TESTES |
| Testes E2E | Não executado | Aguardando CONTRATO-EXECUCAO-TESTES |

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 2.0 | 2025-12-30 | Migração para Governança v2.0 - Separação RF/RL completa. Adição de 11 seções obrigatórias, mínimo 12 regras de negócio, remoção de referências ao legado. | Agência ALC - alc.dev.br |
| 1.0 | 2025-11-03 | Versão inicial simplificada (5 seções) | Agência ALC - alc.dev.br |
