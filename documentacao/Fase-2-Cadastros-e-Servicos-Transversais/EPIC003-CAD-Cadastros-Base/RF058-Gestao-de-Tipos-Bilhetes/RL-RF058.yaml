rl_id: RL-RF058
rf_id: RF058
rf_correspondente: RF058
titulo: Referência ao Legado - Tipos de Bilhetes
versao: "1.0"
data_criacao: "2025-12-30"
status: mapeamento_completo

sistema_origem:
  nome: IControlIT v1
  tecnologia: ASP.NET Web Forms + VB.NET
  modulo: Cadastros Base
  funcionalidade: Gestão de Tipos de Bilhetes

localizacao_codigo_legado:
  paginas_aspx:
    - path: ic1_legado/IControlIT/Cadastros/TiposBilhetes/Lista.aspx
      tipo: listagem
    - path: ic1_legado/IControlIT/Cadastros/TiposBilhetes/Novo.aspx
      tipo: criacao
    - path: ic1_legado/IControlIT/Cadastros/TiposBilhetes/Editar.aspx
      tipo: edicao
    - path: ic1_legado/IControlIT/Cadastros/TiposBilhetes/Detalhes.aspx
      tipo: visualizacao

  code_behind:
    - ic1_legado/IControlIT/Cadastros/TiposBilhetes/Lista.aspx.vb
    - ic1_legado/IControlIT/Cadastros/TiposBilhetes/Novo.aspx.vb
    - ic1_legado/IControlIT/Cadastros/TiposBilhetes/Editar.aspx.vb
    - ic1_legado/IControlIT/Cadastros/TiposBilhetes/Detalhes.aspx.vb

  helpers:
    - ic1_legado/IControlIT/App_Code/Helpers/TipoBilheteHelper.vb

  stored_procedures:
    - SP_TipoBilhete_Listar
    - SP_TipoBilhete_Inserir
    - SP_TipoBilhete_Atualizar
    - SP_TipoBilhete_Excluir
    - SP_TipoBilhete_Buscar

implementacao_legada:
  funcionalidades:
    - id: FUNC-LEGACY-001
      nome: Listagem de Tipos de Bilhetes
      arquivo: Lista.aspx
      tecnologia: GridView + ViewState
      destino: SUBSTITUIDO
      componente_moderno: TiposBilhetesListComponent (Angular)
      melhorias:
        - Paginação server-side
        - Filtros avançados
        - Performance otimizada

    - id: FUNC-LEGACY-002
      nome: Criação de Tipo de Bilhete
      arquivo: Novo.aspx
      tecnologia: Web Forms + RequiredFieldValidator
      destino: SUBSTITUIDO
      componente_moderno: CreateTipoBilheteCommand (CQRS)
      melhorias:
        - FluentValidation
        - Auditoria automática
        - Multi-tenancy automático

    - id: FUNC-LEGACY-003
      nome: Edição de Tipo de Bilhete
      arquivo: Editar.aspx
      tecnologia: Web Forms + CustomValidator
      destino: SUBSTITUIDO
      componente_moderno: UpdateTipoBilheteCommand (CQRS)
      melhorias:
        - Validação robusta
        - Tracking automático de alterações

    - id: FUNC-LEGACY-004
      nome: Visualização de Detalhes
      arquivo: Detalhes.aspx
      tecnologia: DetailsView
      destino: SUBSTITUIDO
      componente_moderno: GetTipoBilheteByIdQuery (CQRS)
      melhorias:
        - Auditoria de acesso
        - Performance otimizada

    - id: FUNC-LEGACY-005
      nome: Exclusão/Inativação
      arquivo: Lista.aspx (GridView Command)
      tecnologia: Soft delete via SP
      destino: ASSUMIDO
      componente_moderno: DeleteTipoBilheteCommand
      melhorias:
        - Confirmação moderna (Angular Material Dialog)

regras_negocio_legado:
  - id: RN-LEGACY-001
    descricao: Nome único por empresa
    implementacao_legado: CustomValidator + SP
    destino: ASSUMIDO
    implementacao_moderna: FluentValidation
    status: implementado

  - id: RN-LEGACY-002
    descricao: Tamanho mínimo Nome (3 chars)
    implementacao_legado: RequiredFieldValidator
    destino: ASSUMIDO
    implementacao_moderna: FluentValidation
    status: implementado

  - id: RN-LEGACY-003
    descricao: Tamanho máximo Nome (100)
    implementacao_legado: MaxLength no banco
    destino: ASSUMIDO
    implementacao_moderna: FluentValidation + EF
    status: implementado

  - id: RN-LEGACY-004
    descricao: Descrição obrigatória
    implementacao_legado: RequiredFieldValidator
    destino: ASSUMIDO
    implementacao_moderna: FluentValidation
    status: implementado

  - id: RN-LEGACY-005
    descricao: Soft delete
    implementacao_legado: UPDATE Excluido=1
    destino: ASSUMIDO
    implementacao_moderna: DeleteCommand
    status: implementado

  - id: RN-LEGACY-006
    descricao: Multi-tenancy
    implementacao_legado: WHERE EmpresaId manual
    destino: ASSUMIDO
    implementacao_moderna: Query Filters EF Core
    status: implementado

  - id: RN-LEGACY-007
    descricao: Status padrão Ativo
    implementacao_legado: DEFAULT 1 no banco
    destino: ASSUMIDO
    implementacao_moderna: Constructor Entity
    status: implementado

validacoes_legado:
  client_side:
    - tipo: RequiredFieldValidator
      campo: Nome
      destino: SUBSTITUIDO
      moderna: Reactive Forms Validators.required

    - tipo: RegularExpressionValidator
      campo: Nome
      pattern: "^[a-zA-Z0-9\\s\\-]{3,100}$"
      destino: SUBSTITUIDO
      moderna: Reactive Forms Validators.pattern

    - tipo: CustomValidator
      campo: Nome
      validacao: Nome único
      destino: SUBSTITUIDO
      moderna: AsyncValidator (API call)

  server_side:
    - tipo: Page.IsValid
      destino: SUBSTITUIDO
      moderna: FluentValidation automatic

    - tipo: Helper.ExisteNome()
      destino: SUBSTITUIDO
      moderna: FluentValidation MustAsync

banco_dados_legado:
  tabela: TipoBilhete
  estrutura_mantida: true
  percentual_manutencao: 95

  campos:
    - nome: Id
      tipo: UNIQUEIDENTIFIER
      status: MANTIDO

    - nome: EmpresaId
      tipo: UNIQUEIDENTIFIER
      status: MANTIDO

    - nome: Nome
      tipo: NVARCHAR(100)
      status: MANTIDO

    - nome: Descricao
      tipo: NVARCHAR(500)
      status: MANTIDO

    - nome: Ativo
      tipo: BIT
      status: MANTIDO

    - nome: DataCriacao
      tipo: DATETIME
      status: MELHORADO
      novo_tipo: DATETIME2
      motivo: Maior precisão

    - nome: UsuarioCriacaoId
      tipo: UNIQUEIDENTIFIER
      status: MANTIDO

    - nome: DataAlteracao
      tipo: DATETIME
      status: MELHORADO
      novo_tipo: DATETIME2

    - nome: UsuarioAlteracaoId
      tipo: UNIQUEIDENTIFIER
      status: MANTIDO

    - nome: Excluido
      tipo: BIT
      status: MANTIDO

  indices:
    - nome: IX_TipoBilhete_EmpresaId
      status: MANTIDO

    - nome: IX_TipoBilhete_Nome
      status: MANTIDO

    - nome: IX_TipoBilhete_Nome_Empresa
      status: MANTIDO
      tipo: UNIQUE

    - nome: IX_TipoBilhete_Ativo
      status: ADICIONADO
      motivo: Performance em filtros

stored_procedures_substituidas:
  - nome: SP_TipoBilhete_Listar
    destino: SUBSTITUIDO
    componente_moderno: GetTiposBilhetesQuery.cs
    tecnologia: LINQ + EF Core
    beneficios:
      - Type-safety
      - IntelliSense
      - Testabilidade

  - nome: SP_TipoBilhete_Inserir
    destino: SUBSTITUIDO
    componente_moderno: CreateTipoBilheteCommand.cs
    tecnologia: CQRS + MediatR
    beneficios:
      - Separação de responsabilidades
      - Auditoria automática

  - nome: SP_TipoBilhete_Atualizar
    destino: SUBSTITUIDO
    componente_moderno: UpdateTipoBilheteCommand.cs
    tecnologia: CQRS + MediatR
    beneficios:
      - Tracking automático de alterações

  - nome: SP_TipoBilhete_Excluir
    destino: SUBSTITUIDO
    componente_moderno: DeleteTipoBilheteCommand.cs
    tecnologia: CQRS + MediatR

  - nome: SP_TipoBilhete_Buscar
    destino: SUBSTITUIDO
    componente_moderno: GetTipoBilheteByIdQuery.cs
    tecnologia: LINQ + EF Core

integracoes_legado:
  permissoes:
    implementacao_legado: Web.config + IsInRole()
    destino: SUBSTITUIDO
    implementacao_moderna: AuthorizationPolicies + RBAC
    melhorias:
      - Permissões granulares (VIEW, CREATE, EDIT, DELETE)
      - Validação em múltiplas camadas

  auditoria:
    implementacao_legado: Trigger SQL + Tabela AuditLog
    destino: SUBSTITUIDO
    implementacao_moderna: AuditInterceptor (EF Core)
    melhorias:
      - Automático
      - Captura antes/depois (JSON)
      - Registro de ACCESS
      - Retenção 7 anos (LGPD)

  multi_tenancy:
    implementacao_legado: EmpresaId em Session + WHERE manual
    destino: SUBSTITUIDO
    implementacao_moderna: Query Filters globais + HttpContext
    melhorias:
      - Automático
      - Row-Level Security

interface_legado:
  tecnologias:
    - ASP.NET Web Forms 4.5
    - Master Pages
    - GridView/DetailsView
    - UpdatePanel (AJAX)
    - jQuery 1.x
    - Bootstrap 3

  componentes_principais:
    - tipo: GridView
      destino: SUBSTITUIDO
      componente_moderno: MatTable (Angular Material)

    - tipo: DetailsView
      destino: SUBSTITUIDO
      componente_moderno: Angular Reactive Forms

    - tipo: UpdatePanel
      destino: REMOVIDO
      motivo: SPA não precisa AJAX parcial

  navegacao_legado:
    fluxo: Lista.aspx → Novo.aspx → Lista.aspx?msg=sucesso
    destino: SUBSTITUIDO
    fluxo_moderno: /cadastros/tipos-bilhetes → /novo → redirect + toast
    melhorias:
      - Rotas RESTful
      - Navegação SPA (sem reload)
      - Feedback via Snackbar

gaps_analise:
  funcionalidades_descontinuadas:
    - nome: Export para Excel (GridView)
      motivo: Biblioteca obsoleta
      alternativa: Export via API (CSV/Excel)

    - nome: Print direto do GridView
      motivo: Recurso legacy
      alternativa: Print via CSS @media

    - nome: Ordenação via ViewState
      motivo: Performance ruim
      alternativa: MatSort (client-side)

  funcionalidades_novas:
    - nome: Paginação Server-Side
      descricao: PaginatedList no backend
      justificativa: Performance em grandes volumes

    - nome: Busca Avançada
      descricao: Múltiplos filtros simultâneos
      justificativa: Melhor UX

    - nome: Histórico de Alterações
      descricao: Auditoria completa com diff
      justificativa: Compliance LGPD

    - nome: Notificações Real-Time
      descricao: SignalR para atualizações
      justificativa: Colaboração multi-usuário

    - nome: Temas Dark/Light
      descricao: Material Theming
      justificativa: Acessibilidade

melhorias_arquiteturais:
  - aspecto: Arquitetura
    legado: N-Tier (UI → BLL → DAL)
    moderno: Clean Architecture + CQRS
    beneficio: Separação de responsabilidades

  - aspecto: Banco de Dados
    legado: Stored Procedures
    moderno: Entity Framework Core + LINQ
    beneficio: Type-safety, produtividade

  - aspecto: Validação
    legado: ASP.NET Validators
    moderno: FluentValidation
    beneficio: Testabilidade, reutilização

  - aspecto: API
    legado: Não existia
    moderno: Minimal APIs (.NET 10)
    beneficio: Reuso, integração mobile

  - aspecto: Frontend
    legado: Server-rendered (ASPX)
    moderno: SPA (Angular 19)
    beneficio: Performance, UX moderna

  - aspecto: Testes
    legado: Manuais
    moderno: Unitários + Integração + E2E
    beneficio: Qualidade, CI/CD

  - aspecto: i18n
    legado: Não existia
    moderno: Transloco (3 idiomas)
    beneficio: Globalização

  - aspecto: Segurança
    legado: Role-based (limitado)
    moderno: RBAC granular + Policies
    beneficio: Controle fino de acesso

matriz_rastreabilidade:
  - componente_legado: Lista.aspx
    status: SUBSTITUIDO
    destino: TiposBilhetesListComponent
    tecnologia: Angular Standalone

  - componente_legado: Novo.aspx
    status: SUBSTITUIDO
    destino: TiposBilhetesFormComponent
    tecnologia: Reactive Forms

  - componente_legado: Editar.aspx
    status: SUBSTITUIDO
    destino: TiposBilhetesFormComponent
    observacao: Mesma tela (modo edição)

  - componente_legado: Detalhes.aspx
    status: SUBSTITUIDO
    destino: TiposBilhetesDetailsComponent
    observacao: Somente leitura

  - componente_legado: TipoBilheteHelper.vb
    status: SUBSTITUIDO
    destino: Commands/Queries (CQRS)
    observacao: Separação leitura/escrita

  - componente_legado: SP_TipoBilhete_*
    status: SUBSTITUIDO
    destino: EF Core LINQ
    beneficio: Type-safety

  - componente_legado: Validators (ASPX)
    status: SUBSTITUIDO
    destino: FluentValidation + Reactive Forms
    observacao: Client + Server

  - componente_legado: GridView Paginação
    status: SUBSTITUIDO
    destino: MatPaginator
    beneficio: Performance melhorada

  - componente_legado: Web.config (autorização)
    status: SUBSTITUIDO
    destino: AuthorizationPolicies
    beneficio: RBAC granular

  - componente_legado: Trigger Auditoria
    status: SUBSTITUIDO
    destino: AuditInterceptor
    beneficio: Automático EF Core

resumo_migracao:
  percentual_codigo_reutilizado: 0
  percentual_estrutura_banco_mantida: 95
  percentual_regras_negocio_preservadas: 100
  percentual_funcionalidades_mantidas: 100
  funcionalidades_adicionais: 5

beneficios_modernizacao:
  - Performance: Paginação server-side, queries LINQ otimizadas
  - Manutenibilidade: Clean Architecture, testes automatizados
  - Segurança: RBAC granular, auditoria completa, LGPD compliance
  - UX: Interface moderna, responsiva, acessível
  - Escalabilidade: API RESTful, SPA, cloud-ready
  - Produtividade: CQRS, MediatR, FluentValidation

riscos_mitigados:
  - risco: ViewState grande
    mitigacao: SPA (sem ViewState)

  - risco: Postbacks lentos
    mitigacao: API calls assíncronas

  - risco: Código acoplado
    mitigacao: Clean Architecture

  - risco: Testes difíceis
    mitigacao: Arquitetura testável

  - risco: Multi-idioma complexo
    mitigacao: Transloco built-in

referencias:
  - id: REF-RF058-001
    nome: Listagem de Tipos de Bilhetes
    tipo: tela
    caminho: ic1_legado/IControlIT/Cadastros/TiposBilhetes/Lista.aspx
    descricao: Tela de listagem com GridView e filtros
    destino: substituido
    componente_moderno: TiposBilhetesListComponent (Angular)

  - id: REF-RF058-002
    nome: Helper de Tipos de Bilhetes
    tipo: componente
    caminho: ic1_legado/IControlIT/App_Code/Helpers/TipoBilheteHelper.vb
    descricao: Classe com lógica de negócio e acesso a dados
    destino: substituido
    componente_moderno: Commands/Queries (CQRS)

metadados:
  versao_documento: "1.0"
  template_utilizado: TEMPLATE-RL.md v1.0
  data_criacao: "2025-12-30"
  responsavel: Equipe IControlIT
  projeto: Modernização IControlIT (Web Forms → .NET 10 + Angular 19)
