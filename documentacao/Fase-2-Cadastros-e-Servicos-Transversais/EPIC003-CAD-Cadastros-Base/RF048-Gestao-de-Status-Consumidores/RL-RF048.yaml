# =============================================
# RL-RF048 - Referência ao Legado (Gestão de Status de Consumidores)
# Versão: 1.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br
# =============================================

rf_id: RF048
titulo: "Gestão de Status de Consumidores"

legado:
  sistema: "IControlIT v1 (ASP.NET Web Forms + VB.NET)"
  versao: "1.x"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server"
  multi_tenant: false # Parcial (Id_Fornecedor sem Query Filter)
  auditoria: "none" # Campos de auditoria existiam mas raramente eram preenchidos

# SEÇÃO CRÍTICA: Referencias ao Legado com Destino Obrigatório
# Cada item DEVE ter campo "destino" preenchido
referencias:
  - id: "LEG-RF048-001"
    tipo: "componente"
    nome: "Flag Fl_Ativo (Tabela Consumidor)"
    caminho: "ic1_legado/BancoDados/Interno/K2A.sql (tabela Consumidor)"
    descricao: |
      Flag booleana (BIT) que indicava se consumidor estava ativo ou inativo.
      - Fl_Ativo=1: Consumidor ativo
      - Fl_Ativo=0: Consumidor inativo

      Problemas:
      - Sem validação de transições (podia mudar diretamente via UPDATE SQL)
      - Sem justificativa obrigatória
      - Sem auditoria de mudanças
      - Sem notificações automáticas
      - Podia coexistir com Fl_Bloqueado=1 (estado inconsistente)

    destino: "substituido"
    justificativa: |
      Substituído por enum Status com valores (Pendente, Ativo, Suspenso, Bloqueado, Inativo).
      RF moderno implementa workflow de transições com validação, aprovação multi-nível, histórico imutável e notificações automáticas.
      Migração: Flag Fl_Ativo será convertida para Status='Ativo' ou Status='Inativo' durante migração de dados.

    documentacao_item_relacionado: "RN-RF048-01"
    uc_relacionado: "UC05"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF048-002"
    tipo: "componente"
    nome: "Flag Fl_Bloqueado (Tabela Consumidor)"
    caminho: "ic1_legado/BancoDados/Interno/K2A.sql (tabela Consumidor)"
    descricao: |
      Flag booleana (BIT) que indicava se consumidor estava bloqueado.
      - Fl_Bloqueado=1: Consumidor bloqueado (acesso totalmente negado)
      - Fl_Bloqueado=0: Consumidor não bloqueado

      Problemas:
      - Bloqueio era manual (financeiro executava UPDATE SQL direto)
      - Sem integração com faturamento (bloqueio por inadimplência era ad-hoc)
      - Sem histórico de bloqueios
      - Sem processo de aprovação para desbloquear
      - Sem notificações para consumidor ou gestores

    destino: "substituido"
    justificativa: |
      Substituído por Status='Bloqueado' no enum de status.
      RF moderno implementa:
      - Bloqueio automático por inadimplência via job noturno (RN-RF048-09)
      - Escalonamento (30, 45, 60 dias)
      - Aprovação multi-nível para desbloqueio (Gestor + Financeiro)
      - Notificações automáticas multi-canal
      - Histórico completo de bloqueios/desbloqueios
      Migração: Flag Fl_Bloqueado=1 será convertida para Status='Bloqueado'.

    documentacao_item_relacionado: "RN-RF048-09"
    uc_relacionado: "UC05"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF048-003"
    tipo: "componente"
    nome: "Flag Fl_Suspenso (Tabela Consumidor)"
    caminho: "ic1_legado/BancoDados/Interno/K2A.sql (tabela Consumidor)"
    descricao: |
      Flag booleana (BIT) raramente utilizada que indicava suspensão temporária.
      - Fl_Suspenso=1: Consumidor suspenso (comportamento inconsistente)
      - Fl_Suspenso=0: Consumidor não suspenso

      Problemas:
      - Comportamento não bem definido (variava entre implementações)
      - Raramente usado (< 1% dos consumidores)
      - Sem integração com políticas ou faturamento
      - Sem diferenciação clara entre Suspenso vs. Bloqueado

    destino: "substituido"
    justificativa: |
      Substituído por Status='Suspenso' com comportamento bem definido:
      - Bloqueio de novas operações
      - Mantém acesso de consulta
      - Faturamento parcial (configurável)
      - Aplicação automática de políticas (RN-RF048-05)
      Migração: Flag Fl_Suspenso=1 será convertida para Status='Suspenso' (raros casos).

    documentacao_item_relacionado: "RN-RF048-01"
    uc_relacionado: "UC05"

    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF048-004"
    tipo: "regra_negocio"
    nome: "UPDATE SQL manual de status"
    caminho: "ic1_legado/IControlIT/Scripts/ManutencaoStatus.sql (presumido)"
    descricao: |
      Mudanças de status eram feitas via UPDATE SQL direto nas tabelas de consumidores.
      Exemplo:
      UPDATE Consumidor SET Fl_Ativo = 0 WHERE Id_Consumidor = @Id

      Problemas:
      - Sem validação de transições permitidas
      - Sem auditoria (impossível rastrear quem executou)
      - Sem notificações
      - Sem aprovação
      - Risco de estados inconsistentes (múltiplas flags=1 simultaneamente)

    destino: "substituido"
    justificativa: |
      Substituído por Commands com validação completa:
      - ChangeStatusConsumidorCommand (RN-RF048-02)
      - Validação de matriz de transições antes de aplicar
      - Auditoria automática via AuditInterceptor
      - Notificações assíncronas via RF067
      - Aprovação multi-nível para transições críticas (RN-RF048-03)
      - Histórico imutável de todas as mudanças (RN-RF048-04)

    documentacao_item_relacionado: "RN-RF048-02"
    uc_relacionado: "UC05"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF048-005"
    tipo: "regra_negocio"
    nome: "Bloqueio manual por inadimplência"
    caminho: "ic1_legado/IControlIT/Financeiro/BloqueioInadimplencia.sql (presumido)"
    descricao: |
      Bloqueio por inadimplência era executado manualmente pelo financeiro:
      1. Consultar faturas vencidas > 60 dias via SELECT SQL
      2. Executar UPDATE SQL para marcar Fl_Bloqueado=1
      3. Enviar e-mail manual para consumidor (às vezes esquecido)

      Problemas:
      - Processo manual sujeito a erros e esquecimentos
      - Sem escalonamento (notificação preventiva)
      - Sem auditoria de bloqueios
      - Sem reativação automática ao regularizar débito
      - Inconsistente (dependia de execução manual)

    destino: "substituido"
    justificativa: |
      Substituído por job automático noturno (RN-RF048-09):
      - Executa diariamente às 02:00 AM
      - Escalonamento: >30 dias (notifica), >45 dias (suspende), >60 dias (bloqueia)
      - Integração com RF026 (Faturamento) para verificar débitos
      - Notificações automáticas multi-canal (e-mail, SMS)
      - Reativação automática ao regularizar (RN-RF048-10)
      - Auditoria completa de bloqueios executados
      - Prazos customizados para clientes VIP

    documentacao_item_relacionado: "RN-RF048-09"
    uc_relacionado: null

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF048-006"
    tipo: "regra_negocio"
    nome: "Reativação manual via telefone"
    caminho: "Processo de negócio não documentado"
    descricao: |
      Reativação de consumidor bloqueado era feita manualmente:
      1. Consumidor ligava para o financeiro reclamando de bloqueio
      2. Financeiro verificava débitos manualmente
      3. Se regularizado, executava UPDATE SQL para Fl_Bloqueado=0
      4. Aprovação era verbal (não rastreada no sistema)

      Problemas:
      - Processo não rastreado (sem auditoria)
      - Aprovação verbal (sem registro formal)
      - Demora no atendimento (horas ou dias)
      - Sem notificação automática de reativação

    destino: "substituido"
    justificativa: |
      Substituído por reativação automática (RN-RF048-10):
      - Sistema monitora eventos de pagamento via RF026
      - Ao regularizar débito, cria solicitação de reativação automática
      - Notifica aprovadores (Gestor + Financeiro)
      - Reativa automaticamente após aprovação
      - Opção de reativação automática sem aprovação (configurável)
      - Auditoria completa do processo
      - Notificações para consumidor e stakeholders

    documentacao_item_relacionado: "RN-RF048-10"
    uc_relacionado: "UC06"

    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF048-007"
    tipo: "componente"
    nome: "Ausência de tabela de histórico de status"
    caminho: "ic1_legado/BancoDados/Interno/K2A.sql (tabela inexistente)"
    descricao: |
      Sistema legado NÃO possuía tabela de histórico de mudanças de status.
      Impossível rastrear:
      - Quando consumidor mudou de status
      - Quem mudou o status
      - Por que mudou (justificativa)
      - Status anterior vs. novo

      Impactos:
      - Impossibilidade de auditoria
      - Não conformidade com LGPD (sem rastreabilidade)
      - Disputas sem evidências
      - Métricas de ciclo de vida impossíveis de calcular

    destino: "descartado"
    justificativa: |
      Não há histórico legado para migrar.
      RF moderno cria tabela StatusConsumidorHistorico (RN-RF048-04) com:
      - Registro imutável de todas as mudanças
      - Data/Hora, Usuário, Status Anterior, Status Novo, Justificativa, IP
      - Retenção de 7 anos (conformidade LGPD)
      - Histórico começa do zero no sistema moderno (sem dados retroativos)

    documentacao_item_relacionado: "RN-RF048-04"
    uc_relacionado: "UC09"

    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF048-008"
    tipo: "regra_negocio"
    nome: "Notificações manuais via e-mail"
    caminho: "Processo de negócio não documentado"
    descricao: |
      Notificações de mudança de status eram manuais:
      - Financeiro enviava e-mail manualmente ao bloquear consumidor
      - Gestores eram notificados verbalmente ou via e-mail ad-hoc
      - Consumidor não era notificado automaticamente

      Problemas:
      - Inconsistente (esquecimento frequente)
      - Atraso na comunicação
      - Sem template padronizado
      - Sem rastreabilidade (e-mails não arquivados)

    destino: "substituido"
    justificativa: |
      Substituído por notificações automáticas (RN-RF048-06):
      - Sistema envia notificações automáticas via Central de E-mails (RF067)
      - Canais: E-mail, SMS (crítico), Notificação in-app
      - Stakeholders notificados: Consumidor, Gestor, Financeiro, TI
      - Conteúdo padronizado: Status anterior/novo, Motivo, Impactos, Próximas ações
      - Notificações assíncronas (não bloqueiam mudança de status)
      - Rastreabilidade completa (logs de envio)

    documentacao_item_relacionado: "RN-RF048-06"
    uc_relacionado: "UC05"

    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF048-009"
    tipo: "regra_negocio"
    nome: "Mudanças em lote via scripts SQL"
    caminho: "ic1_legado/IControlIT/Scripts/BloqueioEmMassa.sql (presumido)"
    descricao: |
      Mudanças de status em massa eram feitas via scripts SQL:
      UPDATE Consumidor SET Fl_Bloqueado = 1 WHERE Id_Fornecedor = @Id AND [condição]

      Problemas:
      - Sem controle de quantidade (podia bloquear milhares sem limite)
      - Sem auditoria de quem executou
      - Sem relatório de sucesso/falha
      - Sem notificações para consumidores afetados
      - Risco de bloquear consumidores errados (erro em WHERE)

    destino: "substituido"
    justificativa: |
      Substituído por processamento em lote controlado (RN-RF048-07):
      - ProcessBatchStatusChangeCommand
      - Processamento assíncrono via Hangfire (job em background)
      - Limite máximo de 1.000 registros por lote
      - Validação individual de cada transição
      - Relatório consolidado de sucesso/falha
      - Rollback em caso de falha crítica (>50%)
      - Auditoria completa de operação em lote
      - Notificações opcionais (podem ser desabilitadas com confirmação)

    documentacao_item_relacionado: "RN-RF048-07"
    uc_relacionado: "UC08"

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF048-010"
    tipo: "componente"
    nome: "Ausência de dashboard de status"
    caminho: "ic1_legado/IControlIT/ (funcionalidade inexistente)"
    descricao: |
      Sistema legado NÃO possuía dashboard de status.
      Para visualizar status de consumidores, usuários precisavam:
      - Executar consultas SQL manuais
      - Exportar para Excel e criar gráficos manualmente
      - Solicitar relatórios ao TI (demora de horas/dias)

      Impactos:
      - Falta de visibilidade operacional
      - Tomada de decisão lenta
      - Impossibilidade de monitoramento em tempo real

    destino: "descartado"
    justificativa: |
      Funcionalidade nova sem equivalente legado.
      RF moderno cria dashboard em tempo real (RN-RF048-12):
      - Total de consumidores por status (cards coloridos)
      - Gráfico de evolução temporal de status
      - Lista de consumidores com status crítico (Bloqueado, Suspenso)
      - Timeline de últimas transições
      - Cores semânticas: Verde (Ativo), Amarelo (Suspenso), Vermelho (Bloqueado), Cinza (Inativo), Azul (Pendente)
      - Atualização em tempo real via SignalR
      - Dados históricos (>3 meses) carregam sob demanda

    documentacao_item_relacionado: "RN-RF048-12"
    uc_relacionado: "UC10"

    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF048-011"
    tipo: "regra_negocio"
    nome: "Faturamento não sincronizado com status"
    caminho: "ic1_legado/IControlIT/Faturamento/ (integração inexistente)"
    descricao: |
      Mudança de status NÃO suspendia faturamento automaticamente.
      Resultado:
      - Consumidor inativado (Fl_Ativo=0) continuava sendo faturado
      - Financeiro precisava suspender faturamento manualmente
      - Atraso entre inativação e suspensão de cobrança
      - Cobranças indevidas gerando estornos e reclamações

      Problemas:
      - Falta de integração entre status e faturamento
      - Processos manuais sujeitos a erro
      - Inconsistência entre status operacional e faturamento

    destino: "substituido"
    justificativa: |
      Substituído por integração automática com faturamento (RN-RF048-11):
      - Mudança de status gera evento para módulo de faturamento (RF026)
      - Status com faturamento: Ativo (100%), Suspenso (parcial configurável)
      - Status sem faturamento: Inativo, Bloqueado, Pendente
      - Ajuste automático da próxima cobrança
      - Períodos já processados não são afetados retroativamente
      - Integração via eventos de domínio assíncronos

    documentacao_item_relacionado: "RN-RF048-11"
    uc_relacionado: "UC05"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF048-012"
    tipo: "componente"
    nome: "Campos de auditoria raramente preenchidos"
    caminho: "ic1_legado/BancoDados/Interno/K2A.sql (tabela Consumidor)"
    descricao: |
      Tabela Consumidor possuía campos de auditoria:
      - Id_Usuario_Alteracao INT NULL
      - Dt_Alteracao DATETIME NULL

      Problemas:
      - Campos eram NULL na maioria dos registros (> 80%)
      - Quando preenchidos, não capturavam mudanças de status especificamente
      - Sem registro de valor anterior (impossível saber o que mudou)
      - Sem IP de origem

    destino: "substituido"
    justificativa: |
      Substituído por auditoria completa (RN-RF048-13):
      - AuditInterceptor automático do Entity Framework Core
      - Auditoria de TODAS as operações (não opcional)
      - Dados auditados: Usuário, Data/Hora, Ação, Dados antes/depois, IP, Justificativa
      - Retenção de 7 anos
      - Histórico de transições em tabela separada (StatusConsumidorHistorico)

    documentacao_item_relacionado: "RN-RF048-13"
    uc_relacionado: null

    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

# Telas Legadas (nenhuma encontrada)
telas: []

# WebServices Legados (nenhum encontrado)
servicos: []

# Tabelas Legadas com Problemas
tabelas:
  - nome: "Consumidor"
    finalidade: "Armazenar dados de consumidores"
    problemas:
      - "Múltiplas flags de status independentes (Fl_Ativo, Fl_Bloqueado, Fl_Suspenso) permitindo estados inconsistentes"
      - "Sem enumeração de status possíveis (falta de padronização)"
      - "Sem tabela de histórico (impossibilidade de rastrear transições)"
      - "Campos de auditoria (Id_Usuario_Alteracao, Dt_Alteracao) raramente preenchidos"
      - "Sem workflow de transições (UPDATE SQL direto)"
      - "Multi-tenancy parcial (Id_Fornecedor sem Query Filter)"

  - nome: "Contrato"
    finalidade: "Contratos de consumidores"
    problemas:
      - "Flag Fl_Contrato_Ativo não sincronizada com status de consumidor"
      - "Permitia consumidor ativo com contrato inativo (inconsistência)"

  - nome: "Fatura"
    finalidade: "Faturas de consumidores"
    problemas:
      - "Sem integração automática com bloqueio por inadimplência"
      - "Bloqueio manual via consulta SQL e UPDATE"

# Regras de Negócio Implícitas (não documentadas no legado)
regras_implicitas:
  - id: "RL-RN-001"
    descricao: |
      Consumidor com Fl_Ativo=0 não podia realizar novas operações, mas mantinha histórico visível.
    fonte: "Comportamento observado em múltiplas telas (não documentado)"

  - id: "RL-RN-002"
    descricao: |
      Consumidor com Fl_Bloqueado=1 tinha acesso totalmente bloqueado, incluindo consultas.
    fonte: "Comportamento observado em autenticação (não documentado)"

  - id: "RL-RN-003"
    descricao: |
      Fl_Suspenso era raramente usado e não tinha comportamento bem definido (inconsistente entre implementações).
    fonte: "Análise de código e dados (< 1% dos consumidores com Fl_Suspenso=1)"

  - id: "RL-RN-004"
    descricao: |
      Bloqueio por inadimplência era manual: Financeiro consultava faturas vencidas >60 dias e executava UPDATE SQL direto para Fl_Bloqueado=1.
    fonte: "Processo de negócio não documentado (informado por usuários)"

  - id: "RL-RN-005"
    descricao: |
      Reativação de consumidor bloqueado exigia ligação telefônica para o financeiro e aprovação verbal (não rastreado no sistema).
    fonte: "Processo de negócio não documentado (informado por usuários)"

  - id: "RL-RN-006"
    descricao: |
      Mudança de Fl_Ativo=1 para Fl_Ativo=0 não suspendia faturamento automaticamente (gerava cobrança indevida em alguns casos).
    fonte: "Reclamações de usuários e análise de código de faturamento"

  - id: "RL-RN-007"
    descricao: |
      Não havia notificação automática de bloqueio, levando a reclamações de consumidores que descobriam bloqueio ao tentar usar o sistema.
    fonte: "Reclamações de usuários documentadas em tickets de suporte"

  - id: "RL-RN-008"
    descricao: |
      Status de consumidor não era sincronizado com status de contrato, permitindo consumidor ativo com contrato inativo.
    fonte: "Inconsistências encontradas em auditoria de dados"

# Gap Analysis (Legado x Moderno)
gap_analysis:
  - item: "Estados de Status Formais"
    existe_legado: false
    existe_moderno: true
    notas: "Legado usava flags booleanas independentes. Moderno usa enum de 5 estados."

  - item: "Workflow de Transições"
    existe_legado: false
    existe_moderno: true
    notas: "Legado permitia UPDATE direto. Moderno valida matriz de transições."

  - item: "Aprovação Multi-Nível"
    existe_legado: false
    existe_moderno: true
    notas: "Legado não tinha aprovações formais. Moderno requer Gestor + Financeiro para transições críticas."

  - item: "Histórico de Transições"
    existe_legado: false
    existe_moderno: true
    notas: "Legado não tinha histórico. Moderno mantém 7 anos para LGPD."

  - item: "Aplicação Automática de Políticas"
    existe_legado: false
    existe_moderno: true
    notas: "Legado aplicava políticas manualmente. Moderno aplica automaticamente ao mudar status."

  - item: "Notificações Automáticas"
    existe_legado: false
    existe_moderno: true
    notas: "Legado enviava e-mails manuais (inconsistente). Moderno envia notificações automáticas multi-canal."

  - item: "Processamento em Lote Controlado"
    existe_legado: false
    existe_moderno: true
    notas: "Legado usava scripts SQL sem limite ou auditoria. Moderno processa até 1.000 via job assíncrono."

  - item: "Bloqueio Automático por Inadimplência"
    existe_legado: false
    existe_moderno: true
    notas: "Legado bloqueava manualmente via SQL. Moderno bloqueia automaticamente com escalonamento (30, 45, 60 dias)."

  - item: "Reativação Automática"
    existe_legado: false
    existe_moderno: true
    notas: "Legado reativava via telefone (verbal). Moderno reativa automaticamente ao regularizar débito."

  - item: "Dashboard em Tempo Real"
    existe_legado: false
    existe_moderno: true
    notas: "Legado não tinha dashboard. Moderno tem dashboard em tempo real via SignalR."

  - item: "Integração com Faturamento"
    existe_legado: false
    existe_moderno: true
    notas: "Legado não sincronizava status com faturamento. Moderno integra via eventos de domínio."

  - item: "Auditoria Completa"
    existe_legado: false # Parcial
    existe_moderno: true
    notas: "Legado tinha campos de auditoria raramente preenchidos. Moderno tem auditoria automática completa (7 anos)."

  - item: "Multi-Tenancy com Query Filter"
    existe_legado: false # Parcial
    existe_moderno: true
    notas: "Legado tinha Id_Fornecedor sem Query Filter. Moderno tem Id_Fornecedor com Query Filter automático."

  - item: "Permissões RBAC Granulares"
    existe_legado: false
    existe_moderno: true
    notas: "Legado tinha permissões genéricas (editar consumidor). Moderno tem permissões granulares (VIEW, CHANGE, APPROVE, ADMIN)."

# Decisões de Modernização
decisoes_modernizacao:
  - decisao: "Substituir flags booleanas por enum de status"
    motivo: |
      Prevenir estados inconsistentes, padronizar workflow, facilitar validação de transições.
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Criar tabela de histórico imutável"
    motivo: |
      Conformidade LGPD, rastreabilidade, auditoria.
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Implementar workflow de aprovações"
    motivo: |
      Controle de operações com impacto financeiro alto, rastreabilidade de responsabilidades.
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Automatizar bloqueio por inadimplência"
    motivo: |
      Eficiência operacional, consistência, redução de trabalho manual do financeiro.
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Implementar notificações automáticas"
    motivo: |
      Transparência, comunicação eficiente, redução de reclamações.
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Criar dashboard em tempo real"
    motivo: |
      Visibilidade operacional, tomada de decisão informada, monitoramento proativo.
    impacto: "baixo"
    data: "2025-12-30"

# Riscos de Migração
riscos_migracao:
  - risco: "Flags booleanas legadas inconsistentes (Fl_Ativo=1 + Fl_Bloqueado=1)"
    impacto: "alto"
    probabilidade: "alta"
    mitigacao: |
      Script de migração com lógica de prioridade: Bloqueado > Suspenso > Inativo > Ativo.
      Validar e corrigir inconsistências antes da migração.
      Gerar relatório de consumidores com estados inconsistentes para revisão manual.

  - risco: "Ausência de histórico legado"
    impacto: "medio"
    probabilidade: "alta"
    mitigacao: |
      Aceitar que histórico começa do zero no sistema moderno.
      Não tentar criar histórico retroativo falso (violaria auditoria).
      Comunicar usuários que histórico anterior não está disponível.

  - risco: "Processos de aprovação manuais (verbal) passam a ser rastreados"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      Treinamento de usuários sobre novo processo de aprovação formal.
      Comunicação clara de mudança de processo (e-mail, vídeos).
      Período de transição com duplo controle (permitir aprovação verbal + sistema temporariamente).

  - risco: "Bloqueio automático pode bloquear clientes VIP sem aviso"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      Configurar prazos customizados para clientes VIP.
      Notificações preventivas 7 dias antes do bloqueio.
      Whitelist de clientes VIP com bloqueio apenas manual.

  - risco: "Reativação automática pode reativar consumidor bloqueado por fraude"
    impacto: "alto"
    probabilidade: "baixa"
    mitigacao: |
      Diferenciar motivo de bloqueio (inadimplência vs. fraude/segurança).
      Reativação automática SOMENTE para bloqueio por inadimplência.
      Bloqueios por fraude/segurança requerem aprovação manual sempre.

  - risco: "Falta de integração com sistema de faturamento legado durante transição"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      Garantir integração completa com RF026 (Faturamento) antes de ativar bloqueio automático.
      Testar extensivamente em ambiente de homologação com dados reais.
      Monitorar primeiras execuções do job noturno de bloqueio.

  - risco: "Usuários acostumados com UPDATE SQL direto perdem acesso"
    impacto: "medio"
    probabilidade: "alta"
    mitigacao: |
      Comunicar mudança com antecedência mínima de 30 dias.
      Treinar usuários para usar interface nova (dashboard + formulários).
      Criar permissões RBAC adequadas para cada perfil.
      Fornecer views somente leitura para consultas SQL simples.

# Rastreabilidade (Legado → Moderno)
rastreabilidade:
  - elemento_legado: "Flag Fl_Ativo (Consumidor)"
    referencia_rf: "RN-RF048-01, RN-RF048-02"
    referencia_uc: "UC05"
    status: "substituido"

  - elemento_legado: "Flag Fl_Bloqueado (Consumidor)"
    referencia_rf: "RN-RF048-01, RN-RF048-09"
    referencia_uc: "UC05"
    status: "substituido"

  - elemento_legado: "Flag Fl_Suspenso (Consumidor)"
    referencia_rf: "RN-RF048-01, RN-RF048-05"
    referencia_uc: "UC05"
    status: "substituido"

  - elemento_legado: "UPDATE SQL manual de status"
    referencia_rf: "RN-RF048-02, RN-RF048-03"
    referencia_uc: "UC05"
    status: "substituido"

  - elemento_legado: "Bloqueio manual por inadimplência"
    referencia_rf: "RN-RF048-09"
    referencia_uc: null
    status: "substituido"

  - elemento_legado: "Reativação manual via telefone"
    referencia_rf: "RN-RF048-10"
    referencia_uc: "UC06"
    status: "substituido"

  - elemento_legado: "Ausência de histórico"
    referencia_rf: "RN-RF048-04"
    referencia_uc: "UC09"
    status: "descartado"

  - elemento_legado: "Notificações manuais via e-mail"
    referencia_rf: "RN-RF048-06"
    referencia_uc: "UC05"
    status: "substituido"

  - elemento_legado: "Mudanças em lote via scripts SQL"
    referencia_rf: "RN-RF048-07"
    referencia_uc: "UC08"
    status: "substituido"

  - elemento_legado: "Ausência de dashboard"
    referencia_rf: "RN-RF048-12"
    referencia_uc: "UC10"
    status: "descartado"

  - elemento_legado: "Faturamento não sincronizado com status"
    referencia_rf: "RN-RF048-11"
    referencia_uc: "UC05"
    status: "substituido"

  - elemento_legado: "Campos de auditoria raramente preenchidos"
    referencia_rf: "RN-RF048-13"
    referencia_uc: null
    status: "substituido"

# Changelog
changelog:
  - versao: "1.0"
    data: "2025-12-30"
    descricao: "Documentação inicial de referência ao legado - Análise de sistema sem módulo estruturado de status"
    autor: "Agência ALC - alc.dev.br"
