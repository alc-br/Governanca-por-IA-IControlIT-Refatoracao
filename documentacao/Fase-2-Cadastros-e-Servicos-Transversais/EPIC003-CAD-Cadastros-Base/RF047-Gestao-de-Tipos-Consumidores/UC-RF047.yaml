uc:
  documentacao: "RF047"
  versao: "2.0"
  data: "2025-12-31"

exclusions:
  uc_items: []

historico:
  - versao: "1.0"
    data: "2025-12-18"
    autor: "Architect Agent"
    descricao: "Versão stub incompleta"
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica completa com 5 UCs (UC00-UC04) cobrindo 15 regras de negócio"

casos_de_uso:
  - id: "UC00"
    nome: "Listar Tipos de Consumidores"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false
    covers:
      documentacao_items:
        - "FUNC-004"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa funcionalidade Tipos de Consumidores"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega tipos do tenant (TenantId)"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação (50 registros/página)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe lista com colunas (código, nome, descrição, fornecedor, quantidade consumidores, ativo/inativo, cor, ícone)"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por status (ativo/inativo)"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por fornecedor"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por hierarquia (tipos raiz vs filhos)"
          required: false
        - id: "FA-UC00-004"
          title: "Ordenar por coluna (código, nome, quantidade consumidores)"
          required: false
        - id: "FA-UC00-005"
          title: "Exportar para Excel/CSV"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum tipo cadastrado → estado vazio"
          required: true
    regras_aplicadas:
      - "RN-RF047-009"

  - id: "UC01"
    nome: "Criar Tipo de Consumidor"
    ator_principal: "usuario_autenticado"
    tipo: "escrita"
    impacta_dados: true
    covers:
      documentacao_items:
        - "FUNC-001"
        - "FUNC-007"
        - "FUNC-008"
        - "FUNC-009"
        - "FUNC-010"
        - "FUNC-011"
        - "FUNC-012"
        - "FUNC-013"
        - "FUNC-017"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário acessa formulário de criação"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC01-003"
          title: "Usuário preenche campos obrigatórios (código, nome, fornecedor)"
          required: true
        - id: "FP-UC01-004"
          title: "Sistema valida código único por fornecedor (RN-RF047-001)"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema valida formato código [A-Z0-9_]{3,20}"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema valida limite de 50 tipos por fornecedor (RN-RF047-009)"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema cria tipo com TenantId automático"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Definir tipo pai (hierarquia)"
          required: false
        - id: "FA-UC01-002"
          title: "Configurar quotas (dados, voz, SMS) - valor -1 = ilimitado (RN-RF047-004)"
          required: false
        - id: "FA-UC01-003"
          title: "Configurar custo fixo mensal (RN-RF047-008)"
          required: false
        - id: "FA-UC01-004"
          title: "Configurar permissões default (RN-RF047-012)"
          required: false
        - id: "FA-UC01-005"
          title: "Configurar regras de auto-classificação (regex, domínio, departamento) (RN-RF047-005)"
          required: false
        - id: "FA-UC01-006"
          title: "Marcar como tipo padrão (RN-RF047-002)"
          required: false
        - id: "FA-UC01-007"
          title: "Marcar como tipo crítico (RN-RF047-006)"
          required: false
        - id: "FA-UC01-008"
          title: "Configurar cor hexadecimal e ícone Material Icons (RN-RF047-014)"
          required: false
        - id: "FA-UC01-009"
          title: "Configurar template de provisioning automático"
          required: false
        - id: "FE-UC01-001"
          title: "Código duplicado no fornecedor → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "Formato de código inválido → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "Limite de 50 tipos excedido → HTTP 400"
          required: true
        - id: "FE-UC01-004"
          title: "Tipo pai cria loop acíclico → HTTP 400 (RN-RF047-003)"
          required: true
        - id: "FE-UC01-005"
          title: "Hierarquia excede 5 níveis → HTTP 400 (RN-RF047-003)"
          required: true
        - id: "FE-UC01-006"
          title: "Quota inválida (< -1) → HTTP 400"
          required: true
        - id: "FE-UC01-007"
          title: "Cor não está no formato #RRGGBB → HTTP 400"
          required: true
    regras_aplicadas:
      - "RN-RF047-001"
      - "RN-RF047-002"
      - "RN-RF047-003"
      - "RN-RF047-004"
      - "RN-RF047-005"
      - "RN-RF047-009"

  - id: "UC02"
    nome: "Visualizar Tipo de Consumidor"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false
    covers:
      documentacao_items:
        - "FUNC-003"
        - "FUNC-016"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona tipo na listagem"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida tenant (TenantId)"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados completos (código, nome, descrição, fornecedor, hierarquia, quotas, custo fixo)"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema carrega consumidores vinculados"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema carrega histórico de mudanças (últimos 30 dias)"
          required: true
        - id: "FP-UC02-007"
          title: "Sistema exibe dados formatados"
          required: true
        - id: "FA-UC02-001"
          title: "Visualizar tipo pai (se houver)"
          required: false
        - id: "FA-UC02-002"
          title: "Visualizar tipos filhos (se houver)"
          required: false
        - id: "FA-UC02-003"
          title: "Visualizar permissões default"
          required: false
        - id: "FA-UC02-004"
          title: "Visualizar regras de auto-classificação"
          required: false
        - id: "FA-UC02-005"
          title: "Visualizar template de provisioning"
          required: false
        - id: "FA-UC02-006"
          title: "Filtrar consumidores vinculados por status (ativo/inativo)"
          required: false
        - id: "FA-UC02-007"
          title: "Visualizar histórico completo (7 anos) (RN-RF047-015)"
          required: false
        - id: "FE-UC02-001"
          title: "Tipo não encontrado → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Tipo de outro tenant → HTTP 404"
          required: true
    regras_aplicadas:
      - "RN-RF047-011"
      - "RN-RF047-015"

  - id: "UC03"
    nome: "Editar Tipo de Consumidor"
    ator_principal: "usuario_autenticado"
    tipo: "escrita"
    impacta_dados: true
    covers:
      documentacao_items:
        - "FUNC-002"
        - "FUNC-007"
        - "FUNC-008"
        - "FUNC-009"
        - "FUNC-013"
        - "FUNC-017"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário seleciona tipo e acessa edição"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida tenant (TenantId)"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega dados atuais (código READONLY)"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário modifica campos (nome, descrição, quotas, custo, permissões, etc.)"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema valida mudanças (hierarquia acíclica, quotas >= -1, etc.)"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema salva alterações"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema registra auditoria com diff de campos"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC03-001"
          title: "Alterar tipo pai (revalidar hierarquia acíclica) (RN-RF047-003)"
          required: false
        - id: "FA-UC03-002"
          title: "Alterar quotas (validar -1 = ilimitado)"
          required: false
        - id: "FA-UC03-003"
          title: "Alterar custo fixo mensal"
          required: false
        - id: "FA-UC03-004"
          title: "Alterar permissões default (aplicar a novos consumidores apenas)"
          required: false
        - id: "FA-UC03-005"
          title: "Alterar regras de auto-classificação (prioridades)"
          required: false
        - id: "FA-UC03-006"
          title: "Marcar/desmarcar tipo padrão (RN-RF047-002)"
          required: false
        - id: "FA-UC03-007"
          title: "Marcar/desmarcar tipo crítico (RN-RF047-006)"
          required: false
        - id: "FA-UC03-008"
          title: "Alterar cor e ícone"
          required: false
        - id: "FE-UC03-001"
          title: "Tentativa de alterar código → HTTP 400 (código imutável)"
          required: true
        - id: "FE-UC03-002"
          title: "Tipo de outro tenant → HTTP 404"
          required: true
        - id: "FE-UC03-003"
          title: "Tipo pai cria loop → HTTP 400"
          required: true
        - id: "FE-UC03-004"
          title: "Hierarquia excede 5 níveis → HTTP 400"
          required: true
        - id: "FE-UC03-005"
          title: "Quota inválida → HTTP 400"
          required: true
        - id: "FE-UC03-006"
          title: "Desmarcar tipo padrão sem definir outro → HTTP 400"
          required: true
    regras_aplicadas:
      - "RN-RF047-001"
      - "RN-RF047-002"
      - "RN-RF047-003"
      - "RN-RF047-004"
      - "RN-RF047-006"

  - id: "UC04"
    nome: "Inativar Tipo de Consumidor"
    ator_principal: "usuario_autenticado"
    tipo: "escrita"
    impacta_dados: true
    covers:
      documentacao_items:
        - "FUNC-005"
        - "FUNC-014"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário seleciona tipo e acessa inativação"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida tenant (TenantId)"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema valida que tipo NÃO é padrão"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema exibe confirmação com quantidade de consumidores vinculados"
          required: true
        - id: "FP-UC04-006"
          title: "Usuário confirma inativação"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema inicia job de migração em massa (background)"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema migra consumidores para tipo padrão do fornecedor (RN-RF047-007)"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema marca tipo como inativo"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema envia notificação de conclusão"
          required: true
        - id: "FA-UC04-001"
          title: "Tipo sem consumidores → inativação imediata (sem job)"
          required: false
        - id: "FA-UC04-002"
          title: "Reativar tipo inativado (UC especial não coberto aqui, usar CAD.TIPOS_CONSUMIDORES.REACTIVATE)"
          required: false
        - id: "FE-UC04-001"
          title: "Tipo é o padrão do fornecedor → HTTP 400 (Tipo padrão não pode ser inativado)"
          required: true
        - id: "FE-UC04-002"
          title: "Tipo de outro tenant → HTTP 404"
          required: true
        - id: "FE-UC04-003"
          title: "Tipo padrão do fornecedor não encontrado → HTTP 400 (bloqueio de migração)"
          required: true
        - id: "FE-UC04-004"
          title: "Job de migração falha → rollback + notificação de erro"
          required: true
    regras_aplicadas:
      - "RN-RF047-002"
      - "RN-RF047-007"
      - "RN-RF047-015"
