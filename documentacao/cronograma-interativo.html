<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronograma Interativo do Projeto IControlIT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .accordion-button.open .accordion-arrow {
            transform: rotate(180deg);
        }
        .accordion-arrow {
            transition: transform 0.3s ease-in-out;
        }
        .task-row.completed .task-name {
            text-decoration: line-through;
            color: #9ca3af;
        }
        .task-observation-display:empty::before {
            content: "Clique para adicionar anota√ß√µes...";
            color: #9ca3af;
            font-style: italic;
        }
        input[type='number']::-webkit-inner-spin-button,
        input[type='number']::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type='number'] {
            -moz-appearance: textfield;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
        }
        input[type="date"] {
            color: #4b5563;
        }
        input[type="date"]:invalid {
            color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">

    <div class="w-full max-w-full mx-auto bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="p-6 border-b border-gray-200">
            <h1 class="text-2xl font-bold text-gray-900">Cronograma Detalhado do Projeto IControlIT</h1>
            <p class="mt-1 text-sm text-gray-600">Moderniza√ß√£o: Web Forms VB.NET ‚Üí .NET 10 + Angular 19</p>
            <div class="mt-4 flex flex-col sm:flex-row sm:space-x-6">
                 <p class="mt-1 text-gray-600">Total Planejado: <span id="global-planned-total" class="font-semibold text-blue-600">0h</span></p>
                 <p class="mt-1 text-gray-600">Total Realizado: <span id="global-realized-total" class="font-semibold text-green-600">0h</span></p>
            </div>
        </div>

        <div id="accordion-container">
            <!-- Template para uma linha de tarefa -->
            <template id="task-row-template">
                <div class="task-row flex items-start border-b py-3 px-4 min-w-max">
                    <div class="pt-1 flex-shrink-0"><input type="checkbox" class="task-checkbox h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"></div>
                    <div class="w-96 flex-grow ml-4 task-name-container"><span class="task-name p-1 cursor-pointer"></span><input type="text" class="task-name-input hidden w-full p-1 border rounded-md" /></div>
                    <div class="w-32 pt-1 flex-shrink-0"><select class="task-sprint w-full bg-gray-50 border border-gray-200 rounded-md px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-blue-500"></select></div>
                    <div class="w-40 pt-1 flex-shrink-0 pl-2"><input type="date" class="task-due-date w-full bg-gray-50 border border-gray-200 rounded-md px-2 py-0.5 text-xs focus:outline-none focus:ring-1 focus:ring-blue-500"></div>
                    <div class="w-40 pt-1 flex-shrink-0 pl-2"><input type="date" class="task-completed-date w-full bg-gray-50 border border-gray-200 rounded-md px-2 py-0.5 text-xs focus:outline-none focus:ring-1 focus:ring-blue-500"></div>
                    <div class="w-24 text-right pt-1 flex-shrink-0"><span class="task-planned-hours font-medium"></span></div>
                    <div class="w-24 text-right pt-1 flex-shrink-0"><input type="number" class="task-realized-hours w-20 text-right bg-gray-50 border border-gray-200 rounded-md px-2 py-0.5 focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="0h"></div>
                    <div class="w-64 ml-4 flex-shrink-0 observation-container">
                        <p class="task-observation-display w-full p-2 text-xs text-gray-800 cursor-pointer min-h-[2.5rem] break-words"></p>
                        <textarea class="task-observation w-full p-2 border rounded-md text-sm bg-gray-50 focus:bg-white focus:ring-1 focus:ring-blue-500 hidden" rows="2" placeholder="Anota√ß√µes..."></textarea>
                    </div>
                </div>
            </template>
        </div>

        <div class="p-6 mt-4">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Cronograma de Entregas por Fase</h2>
             <div class="space-y-4">
                <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                    <p class="font-semibold text-gray-800">‚úÖ Fase 0: Prepara√ß√£o do Ambiente (Out/2025)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 120h | <span class="font-medium">Status:</span> Conclu√≠da</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> Infraestrutura DevOps, pipelines CI/CD, ambientes configurados e documenta√ß√£o base estabelecida.</p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                    <p class="font-semibold text-gray-800">‚úÖ Fase 1: Sistema Base (Nov/2025)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 310h | <span class="font-medium">Status:</span> Conclu√≠da</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> Sistema de autentica√ß√£o completo (login, JWT, RBAC), par√¢metros centralizados, auditoria, i18n e gest√£o de usu√°rios funcionando 100%.</p>
                </div>
                <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                    <p class="font-semibold text-gray-800">‚úÖ Fase 2: Cadastros e Servi√ßos Transversais (Dez/2025)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 258h | <span class="font-medium">Status:</span> Conclu√≠da</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> M√≥dulo de cadastros base (empresas, filiais, departamentos, fornecedores), motor de templates, sistema de notifica√ß√µes e alertas implementados.</p>
                    <p class="text-xs text-amber-700 mt-2 italic">‚ö†Ô∏è Alguns cadastros seguem em Jan/2026 sem consumo adicional de horas (reorganiza√ß√£o estrat√©gica por adiantamento do Financeiro).</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                    <p class="font-semibold text-gray-800">üìã Fase 3: Financeiro I - Base Cont√°bil (Jan/2026)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 385h | <span class="font-medium">Status:</span> Planejado</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> Plano de contas, centro de custo cont√°bil, or√ßamento/provis√£o, lan√ßamentos financeiros, contas a pagar/receber, concilia√ß√£o banc√°ria e DRE completos.</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                    <p class="font-semibold text-gray-800">üìã Fase 4: Financeiro II - Processos Avan√ßados (Fev/2026)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 270h | <span class="font-medium">Status:</span> Planejado</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> Fluxo de caixa (proje√ß√µes e realizados), rateio de custos customizado, controle or√ßament√°rio com alertas, an√°lise de varia√ß√µes e dashboards financeiros interativos.</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                    <p class="font-semibold text-gray-800">üìã Fase 5: Service Desk Completo (Mar/2026)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 580h | <span class="font-medium">Status:</span> Planejado</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> Gest√£o completa de chamados/tickets, SLA por tipo e prioridade, filas de atendimento, escala√ß√£o autom√°tica, base de conhecimento, portal do usu√°rio, integra√ß√£o com ERPs e sistema de termos (LGPD/responsabilidade).</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                    <p class="font-semibold text-gray-800">üìã Fase 6: Ativos, Auditoria e Integra√ß√µes (Abr/2026)</p>
                    <p class="text-sm text-gray-600 mt-1"><span class="font-medium">Horas:</span> 307h | <span class="font-medium">Status:</span> Planejado</p>
                    <p class="text-sm text-gray-600"><span class="font-medium">Entreg√°vel:</span> Gest√£o de ativos de TI, invent√°rio autom√°tico/c√≠clico, trilha de auditoria completa, relat√≥rios de compliance, integra√ß√µes com ERPs (SAP, TOTVS, Senior), Active Directory/LDAP e APIs de fornecedores.</p>
                </div>
            </div>
        </div>

        <div class="p-6 bg-gray-50 text-sm text-gray-600">
             <h3 class="font-semibold text-gray-800">Nota sobre a Metodologia √Ågil</h3>
             <p class="mt-2">Este cronograma representa nossa melhor estimativa no momento atual. Como um projeto √°gil, ele √© um organismo vivo. As prioridades das atividades dentro de cada fase podem ser ajustadas em conjunto com o Product Owner para maximizar o valor entregue a cada sprint. No entanto, qualquer ajuste ser√° feito de forma transparente e gerenciado para garantir que o projeto seja conclu√≠do dentro do escopo, prazo e or√ßamento totais.</p>
        </div>

        <div class="p-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white text-center">
            <p class="font-semibold text-lg">Moderniza√ß√£o IControlIT</p>
            <p class="text-sm text-blue-100 mt-1">Migra√ß√£o de ASP.NET Web Forms (VB.NET) para .NET 10 + Angular 19</p>
            <p class="text-xs text-blue-200 mt-2">Documento gerado automaticamente em 30/12/2025 | Ag√™ncia ALC - alc.dev.br</p>
        </div>
    </div>

    <script>
        // --- DADOS DO PROJETO ---
        const projectData = [
            {
                id: "fase0",
                title: "Fase 0 - Prepara√ß√£o do Ambiente",
                color: "bg-gray-400",
                tasks: [
                    { id: "f0_infra_devops", name: "Infraestrutura DevOps", hours: 40 },
                    { id: "f0_config_ferramentas", name: "Configura√ß√£o de Ferramentas", hours: 40 },
                    { id: "f0_docs_padroes", name: "Documenta√ß√£o e Padr√µes", hours: 40 },
                ]
            },
            {
                id: "fase1",
                title: "Fase 1 - Sistema Base",
                color: "bg-blue-500",
                tasks: [
                    { id: "rf001", name: "RF001 - Par√¢metros e Configura√ß√µes Centralizadas", hours: 35 },
                    { id: "rf002", name: "RF002 - Configura√ß√µes e Parametriza√ß√£o", hours: 30 },
                    { id: "rf003", name: "RF003 - Logs, Monitoramento e Observabilidade", hours: 35 },
                    { id: "rf004", name: "RF004 - Auditoria e Logs do Sistema", hours: 40 },
                    { id: "rf005", name: "RF005 - i18n Or√ßamento e Provis√£o", hours: 30 },
                    { id: "rf006", name: "RF006 - Gest√£o de Clientes (Multi-tenancy)", hours: 35 },
                    { id: "rf007", name: "RF007 - Login e Autentica√ß√£o (JWT)", hours: 45 },
                    { id: "rf008", name: "RF008 - Gest√£o de Usu√°rios e RBAC", hours: 40 },
                    { id: "rf009", name: "RF009 - Gest√£o de Idiomas", hours: 10 },
                    { id: "rf010", name: "RF010 - Gest√£o de M√≥dulos do Sistema", hours: 10 },
                ]
            },
            {
                id: "fase2",
                title: "Fase 2 - Cadastros e Servi√ßos Transversais",
                color: "bg-teal-500",
                tasks: [
                    { id: "rf011", name: "RF011 - Gest√£o de Empresas", hours: 25 },
                    { id: "rf012", name: "RF012 - Gest√£o de Filiais", hours: 25 },
                    { id: "rf013", name: "RF013 - Gest√£o de Departamentos", hours: 20 },
                    { id: "rf014", name: "RF014 - Gest√£o de Centros de Custo", hours: 20 },
                    { id: "rf015", name: "RF015 - Gest√£o de Fornecedores", hours: 25 },
                    { id: "rf016", name: "RF016 - Gest√£o de Fabricantes", hours: 15 },
                    { id: "rf017", name: "RF017 - Gest√£o de Categorias de Produtos", hours: 15 },
                    { id: "rf018", name: "RF018 - Gest√£o de Status Gen√©ricos", hours: 10 },
                    { id: "rf019", name: "RF019 - Outros Cadastros Base (Tipos diversos)", hours: 20 },
                    { id: "rf063", name: "RF063 - Motor de Templates (Template Engine)", hours: 30 },
                    { id: "rf064", name: "RF064 - Templates de E-mail", hours: 25 },
                    { id: "rf065", name: "RF065 - Templates de Relat√≥rios (Excel/PDF)", hours: 28 },
                    { id: "rf066", name: "RF066 - Notifica√ß√µes e Alertas (Push, E-mail, SMS)", hours: 30 },
                ]
            },
            {
                id: "fase3",
                title: "Fase 3 - Financeiro I (Base Cont√°bil)",
                color: "bg-purple-500",
                tasks: [
                    { id: "rf032", name: "RF032 - Plano de Contas", hours: 40 },
                    { id: "rf033", name: "RF033 - Centro de Custo Cont√°bil", hours: 35 },
                    { id: "rf034", name: "RF034 - Or√ßamento e Provis√£o", hours: 40 },
                    { id: "rf035", name: "RF035 - Lan√ßamentos Financeiros", hours: 45 },
                    { id: "rf036", name: "RF036 - Contas a Pagar", hours: 40 },
                    { id: "rf037", name: "RF037 - Contas a Receber", hours: 40 },
                    { id: "rf038", name: "RF038 - Concilia√ß√£o Banc√°ria", hours: 45 },
                    { id: "rf039", name: "RF039 - Relat√≥rios Financeiros", hours: 35 },
                    { id: "rf040", name: "RF040 - DRE (Demonstrativo de Resultados)", hours: 35 },
                    { id: "rf041", name: "RF041 - An√°lise Financeira", hours: 30 },
                ]
            },
            {
                id: "fase4",
                title: "Fase 4 - Financeiro II (Processos Avan√ßados)",
                color: "bg-amber-500",
                tasks: [
                    { id: "rf042", name: "RF042 - Fluxo de Caixa (Proje√ß√µes e Realizados)", hours: 40 },
                    { id: "rf043", name: "RF043 - Rateio de Custos por Centro/Departamento", hours: 45 },
                    { id: "rf044", name: "RF044 - Controle Or√ßament√°rio com Alertas", hours: 35 },
                    { id: "rf045", name: "RF045 - An√°lise de Varia√ß√µes Or√ßament√°rias", hours: 30 },
                    { id: "rf046", name: "RF046 - Relat√≥rios Gerenciais Financeiros", hours: 35 },
                    { id: "rf047", name: "RF047 - Dashboards Financeiros Interativos", hours: 35 },
                    { id: "rf055", name: "RF055 - Gest√£o de Rateio Customizado", hours: 50 },
                ]
            },
            {
                id: "fase5",
                title: "Fase 5 - Service Desk Completo",
                color: "bg-indigo-500",
                tasks: [
                    { id: "rf049", name: "RF049 - Gest√£o de Chamados/Tickets", hours: 50 },
                    { id: "rf050", name: "RF050 - SLA por Tipo de Chamado e Prioridade", hours: 40 },
                    { id: "rf051", name: "RF051 - Filas de Atendimento", hours: 35 },
                    { id: "rf052", name: "RF052 - Escala√ß√£o Autom√°tica de Chamados", hours: 40 },
                    { id: "rf053", name: "RF053 - Base de Conhecimento", hours: 45 },
                    { id: "rf054", name: "RF054 - Portal do Usu√°rio", hours: 50 },
                    { id: "rf056", name: "RF056 - Gest√£o de Ordens de Servi√ßo", hours: 40 },
                    { id: "rf058", name: "RF058 - Gest√£o de Tipos de Bilhetes", hours: 25 },
                    { id: "rf059", name: "RF059 - Gest√£o de Status/Tipos Gen√©ricos", hours: 20 },
                    { id: "rf060", name: "RF060 - Gest√£o de Tipos de Chamado", hours: 25 },
                    { id: "rf069", name: "RF069 - Configura√ß√£o de SLA para Chamados", hours: 35 },
                    { id: "rf073", name: "RF073 - Gest√£o de Chamados e SLA", hours: 45 },
                    { id: "rf074", name: "RF074 - Gest√£o de Tickets Completa", hours: 40 },
                    { id: "rf078", name: "RF078 - Integra√ß√£o com ERPs", hours: 50 },
                    { id: "rf080", name: "RF080 - Gest√£o de Termos de Aceite (LGPD)", hours: 40 },
                ]
            },
            {
                id: "fase6",
                title: "Fase 6 - Ativos, Auditoria e Integra√ß√µes",
                color: "bg-green-500",
                tasks: [
                     { id: "rf083", name: "RF083 - Cadastro de Ativos de TI (Hardware/Software)", hours: 35 },
                     { id: "rf084", name: "RF084 - Invent√°rio Autom√°tico de Ativos", hours: 40 },
                     { id: "rf085", name: "RF085 - Movimenta√ß√£o de Ativos", hours: 30 },
                     { id: "rf086", name: "RF086 - Invent√°rio C√≠clico e Auditoria de Estoque", hours: 35 },
                     { id: "rf087", name: "RF087 - Trilha de Auditoria Completa", hours: 35 },
                     { id: "rf088", name: "RF088 - Relat√≥rios de Compliance", hours: 30 },
                     { id: "rf089", name: "RF089 - Alertas de Anomalias e Seguran√ßa", hours: 25 },
                     { id: "rf095", name: "RF095 - Integra√ß√£o com ERPs (SAP, TOTVS, Senior)", hours: 40 },
                     { id: "rf096", name: "RF096 - Integra√ß√£o Active Directory/LDAP", hours: 37 },
                ]
            },
        ];

        // --- FUN√á√ïES DE L√ìGICA E UI ---

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function updateRowStyle(row, isCompleted) { row.classList.toggle('completed', isCompleted); }

        function updateProgress(accordionItem) {
            const taskRows = accordionItem.querySelectorAll('.task-row');
            let totalHours = 0;
            let completedHours = 0;

            taskRows.forEach(row => {
                const hours = parseInt(row.querySelector('.task-planned-hours').textContent, 10) || 0;
                totalHours += hours;
                if (row.querySelector('.task-checkbox')?.checked) { completedHours += hours; }
            });

            const percentage = totalHours > 0 ? Math.round((completedHours / totalHours) * 100) : 0;
            const progressBar = accordionItem.querySelector('.progress-bar');
            const progressText = accordionItem.querySelector('.progress-text');

            if (progressBar) progressBar.style.width = `${percentage}%`;
            if (progressText) progressText.textContent = `${percentage}%`;
        }

        function updateAllTotals() {
            let globalPlanned = 0, globalRealized = 0;
            document.querySelectorAll('.accordion-item').forEach(item => {
                let sectionPlanned = 0, sectionRealized = 0;
                item.querySelectorAll('.task-row').forEach(row => {
                    sectionPlanned += parseInt(row.querySelector('.task-planned-hours').textContent, 10) || 0;
                    sectionRealized += parseInt(row.querySelector('.task-realized-hours').value, 10) || 0;
                });

                item.querySelector('.section-planned-total').textContent = `${sectionPlanned}h`;
                item.querySelector('.section-realized-total').textContent = `${sectionRealized}h`;
                globalPlanned += sectionPlanned;
                globalRealized += sectionRealized;
            });

            document.getElementById('global-planned-total').textContent = `${globalPlanned}h`;
            document.getElementById('global-realized-total').textContent = `${globalRealized}h`;
        }

        // --- SALVAMENTO LOCAL ---

        function saveAllTasksState() {
            const tasksState = {};
            document.querySelectorAll('.task-row').forEach(row => {
                const taskId = row.dataset.taskId;
                tasksState[taskId] = {
                    completed: row.querySelector('.task-checkbox').checked,
                    name: row.querySelector('.task-name').textContent,
                    sprint: row.querySelector('.task-sprint').value,
                    dueDate: row.querySelector('.task-due-date').value,
                    completedDate: row.querySelector('.task-completed-date').value,
                    realizedHours: row.querySelector('.task-realized-hours').value,
                    observation: row.querySelector('.task-observation').value
                };
            });

            localStorage.setItem('icontrolit-cronograma', JSON.stringify(tasksState));
        }

        function loadTasksState() {
            const saved = localStorage.getItem('icontrolit-cronograma');
            if (!saved) return;

            const tasksState = JSON.parse(saved);
            document.querySelectorAll('.task-row').forEach(taskRow => {
                const taskId = taskRow.dataset.taskId;
                const taskData = tasksState[taskId] || {};

                taskRow.querySelector('.task-checkbox').checked = taskData.completed || false;
                const nameSpan = taskRow.querySelector('.task-name');
                if (taskData.name) nameSpan.textContent = taskData.name;
                taskRow.querySelector('.task-sprint').value = taskData.sprint || '';
                taskRow.querySelector('.task-due-date').value = taskData.dueDate || '';
                taskRow.querySelector('.task-completed-date').value = taskData.completedDate || '';
                taskRow.querySelector('.task-realized-hours').value = taskData.realizedHours || '';
                const p = taskRow.querySelector('.task-observation-display');
                p.textContent = taskData.observation || '';
                taskRow.querySelector('.task-observation').value = taskData.observation || '';

                updateRowStyle(taskRow, taskData.completed);
            });

            document.querySelectorAll('.accordion-item').forEach(updateProgress);
            updateAllTotals();
        }

        const debouncedSave = debounce(saveAllTasksState, 800);

        // --- L√ìGICA DE INICIALIZA√á√ÉO E EVENTOS ---
        document.addEventListener('DOMContentLoaded', () => {
            const accordionContainer = document.getElementById('accordion-container');
            const taskRowTemplate = document.getElementById('task-row-template');

            // --- GERA√á√ÉO DIN√ÇMICA DO HTML ---
            projectData.forEach((section, index) => {
                const sectionTotal = section.tasks.reduce((sum, task) => sum + task.hours, 0);

                const sectionHtml = `
                    <div class="accordion-item border-b border-gray-200">
                        <button class="accordion-button w-full flex justify-between items-center p-6 text-left hover:bg-gray-50 focus:outline-none">
                            <div class="flex items-center">
                                <span class="text-sm font-bold text-white ${section.color} rounded-full h-8 w-8 flex items-center justify-center mr-4">${index}</span>
                                <span class="text-lg font-semibold text-gray-800">${section.title}</span>
                            </div>
                            <div class="flex items-center space-x-4">
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">Planejado</div>
                                    <span class="section-planned-total text-lg font-bold text-gray-700">${sectionTotal}h</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500">Realizado</div>
                                    <span class="section-realized-total text-lg font-bold text-green-600">0h</span>
                                </div>
                                <svg class="accordion-arrow w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </div>
                        </button>
                        <div class="accordion-content">
                            <div class="p-6 overflow-x-auto">
                                <div class="pb-4">
                                    <div class="flex justify-between items-center mb-1"><span class="text-xs font-semibold text-gray-700">Progresso</span><span class="progress-text text-xs font-semibold text-blue-600">0%</span></div>
                                    <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="progress-bar bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div></div>
                                </div>
                                <div class="flex items-center text-xs text-gray-700 uppercase bg-gray-50 px-4 py-3 font-semibold min-w-max">
                                    <div class="w-8 flex-shrink-0"></div>
                                    <div class="w-96 flex-grow ml-4">Atividade</div>
                                    <div class="w-32 flex-shrink-0 text-left">Sprint</div>
                                    <div class="w-40 flex-shrink-0 text-left">Data de Entrega</div>
                                    <div class="w-40 flex-shrink-0 text-left">Realizada</div>
                                    <div class="w-24 flex-shrink-0 text-right">Planejado</div>
                                    <div class="w-24 flex-shrink-0 text-right">Realizado</div>
                                    <div class="w-64 flex-shrink-0 ml-4">Observa√ß√µes</div>
                                </div>
                                <div class="task-list"></div>
                            </div>
                        </div>
                    </div>
                `;
                accordionContainer.innerHTML += sectionHtml;
            });

            // Preenche as tarefas em cada se√ß√£o
            document.querySelectorAll('.accordion-item').forEach((sectionEl, index) => {
                const taskList = sectionEl.querySelector('.task-list');
                const sectionData = projectData[index];
                sectionData.tasks.forEach(taskData => {
                    const taskRow = taskRowTemplate.content.cloneNode(true).firstElementChild;
                    taskRow.dataset.taskId = taskData.id;
                    taskRow.querySelector('.task-name').textContent = taskData.name;
                    taskRow.querySelector('.task-planned-hours').textContent = `${taskData.hours}h`;
                    taskList.appendChild(taskRow);
                });
            });

            // Preenche os dropdowns de Sprint
            const sprintSelects = document.querySelectorAll('.task-sprint');
            sprintSelects.forEach(select => {
                select.innerHTML = '<option value="">Selecione...</option>' +
                                  Array.from({length: 30}, (_, i) => `<option value="Sprint ${i + 1}">Sprint ${i + 1}</option>`).join('');
            });


            // Adiciona Event Listeners
            accordionContainer.addEventListener('click', (event) => {
                const button = event.target.closest('.accordion-button');
                if (button) {
                    const content = button.nextElementSibling;
                    button.classList.toggle('open');
                    content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + "px";
                }

                const taskNameSpan = event.target.closest('.task-name');
                if(taskNameSpan) {
                     const container = taskNameSpan.closest('.task-name-container');
                     const input = container.querySelector('.task-name-input');
                     input.value = taskNameSpan.textContent;
                     taskNameSpan.classList.add('hidden');
                     input.classList.remove('hidden');
                     input.focus();
                }

                const observationP = event.target.closest('.task-observation-display');
                if(observationP) {
                    const ta = observationP.nextElementSibling;
                    observationP.classList.add('hidden');
                    ta.classList.remove('hidden');
                    ta.value = observationP.textContent;
                    ta.focus();
                }
            });

            accordionContainer.addEventListener('change', (event) => {
                const target = event.target;
                if (target.matches('.task-checkbox, .task-sprint, .task-due-date, .task-completed-date')) {
                    if (target.matches('.task-checkbox')) {
                        const taskRow = target.closest('.task-row');
                        updateRowStyle(taskRow, target.checked);
                        updateProgress(taskRow.closest('.accordion-item'));
                    }
                    saveAllTasksState();
                }
            });

            accordionContainer.addEventListener('blur', (event) => {
                const target = event.target;
                if (target.matches('.task-observation, .task-name-input, .task-realized-hours')) {
                    if (target.matches('.task-observation')) {
                        const p = target.previousElementSibling;
                        p.textContent = target.value;
                        target.classList.add('hidden');
                        p.classList.remove('hidden');
                    }
                    if (target.matches('.task-name-input')) {
                        const span = target.previousElementSibling;
                        span.textContent = target.value || span.textContent;
                        target.classList.add('hidden');
                        span.classList.remove('hidden');
                    }
                     if (target.matches('.task-realized-hours')) { updateAllTotals(); }
                    saveAllTasksState();
                }
            }, true);

            accordionContainer.addEventListener('input', (event) => {
                if(event.target.matches('.task-realized-hours')) {
                    updateAllTotals();
                    debouncedSave();
                }
            });

            accordionContainer.addEventListener('keydown', (event) => {
                if (event.target.matches('.task-name-input') && (event.key === 'Enter' || event.key === 'Escape')) {
                    if(event.key === 'Escape') { event.target.value = event.target.previousElementSibling.textContent; }
                    event.target.blur();
                }
            });

            // Carrega estado salvo
            loadTasksState();
            updateAllTotals();
        });
    </script>
</body>
</html>
