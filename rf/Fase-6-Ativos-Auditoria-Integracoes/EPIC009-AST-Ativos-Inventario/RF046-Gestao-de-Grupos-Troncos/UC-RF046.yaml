# =============================================
# UC - Casos de Uso (Contrato Comportamental)
# Versão: 2.0
# Autor padrão: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF046"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Grupos de Troncos"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF046-CRUD-02"
        - "RF046-SEC-01"
        - "RF046-SEC-02"
        - "RF046-RN-03"
        - "RN-RF046-015"
      regras_negocio:
        - "RN-UC00-001"
        - "RN-UC00-002"
        - "RN-UC00-003"
        - "RN-UC00-004"
      permissoes:
        - "AST.GRUPOS_TRONCOS.LIST"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade de grupos de troncos"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão AST.GRUPOS_TRONCOS.LIST"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega registros do tenant (filtro FornecedorId)"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação (padrão 20 registros) e ordenação"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe lista com colunas principais"
          required: true
        - id: "FA-UC00-001"
          title: "Buscar por nome ou tipo de grupo"
          required: false
        - id: "FA-UC00-002"
          title: "Ordenar por coluna"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por status"
          required: false
        - id: "FA-UC00-004"
          title: "Filtrar por algoritmo de balanceamento"
          required: false
        - id: "FA-UC00-005"
          title: "Visualizar dashboard em tempo real via SignalR"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403 Forbidden"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum registro encontrado → estado vazio exibido"
          required: true

    precondicoes:
      - permissao: "AST.GRUPOS_TRONCOS.LIST"

    gatilho: "Usuario acessa a funcionalidade pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_registros_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_lista"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"
      - id: "FA-UC00-02"
        condicao: "usuario_ordena_coluna"
        resultado: "lista_ordenada"
      - id: "FA-UC00-03"
        condicao: "usuario_filtra_status"
        resultado: "lista_filtrada_status"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado_403"
      - id: "FE-UC00-02"
        condicao: "nenhum_registro"
        resultado: "estado_vazio"

    regras_aplicadas:
      - "RN-UC00-001"
      - "RN-UC00-002"
      - "RN-UC00-003"
      - "RN-UC00-004"
      - "RN-RF046-015"

    resultado_final:
      estado: "lista_exibida"

  - id: "UC01"
    nome: "Criar Grupo de Troncos"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF046-CRUD-01"
        - "RF046-VAL-01"
        - "RF046-VAL-02"
        - "RF046-VAL-03"
        - "RF046-VAL-04"
        - "RF046-VAL-05"
        - "RF046-SEC-01"
        - "RF046-SEC-02"
        - "RN-RF046-001"
        - "RN-RF046-002"
        - "RN-RF046-003"
        - "RN-RF046-004"
        - "RN-RF046-005"
        - "RN-RF046-006"
        - "RN-RF046-011"
        - "RN-RF046-015"
      regras_negocio:
        - "RN-UC01-001"
        - "RN-UC01-002"
        - "RN-UC01-003"
        - "RN-UC01-004"
        - "RN-UC01-005"
        - "RN-UC01-006"
      permissoes:
        - "AST.GRUPOS_TRONCOS.CREATE"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Novo Grupo de Troncos"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão AST.GRUPOS_TRONCOS.CREATE"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário informa dados do grupo"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema valida dados"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema cria registro com FornecedorId"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema publica evento GrupoTronco.Criado"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar e adicionar troncos imediatamente"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação"
          required: false
        - id: "FE-UC01-001"
          title: "Campo obrigatório ausente"
          required: true
        - id: "FE-UC01-002"
          title: "Nome duplicado no mesmo tenant"
          required: true
        - id: "FE-UC01-003"
          title: "Intervalo de health check < 10s"
          required: true
        - id: "FE-UC01-004"
          title: "Algoritmo LCR sem custo configurado"
          required: true
        - id: "FE-UC01-005"
          title: "Erro inesperado"
          required: true

    precondicoes:
      - permissao: "AST.GRUPOS_TRONCOS.CREATE"

    gatilho: "Usuario clica em Novo"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 2
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 3
        ator: "usuario"
        acao: "salvar"
      - passo: 4
        ator: "sistema"
        acao: "validar_dados"
      - passo: 5
        ator: "sistema"
        acao: "persistir_registro"
      - passo: 6
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 7
        ator: "sistema"
        acao: "publicar_evento"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_400"
      - id: "FE-UC01-02"
        condicao: "nome_duplicado"
        resultado: "conflict_409"
      - id: "FE-UC01-03"
        condicao: "health_check_invalido"
        resultado: "erro_400"
      - id: "FE-UC01-04"
        condicao: "lcr_sem_custo"
        resultado: "erro_400"

    regras_aplicadas:
      - "RN-UC01-001"
      - "RN-UC01-002"
      - "RN-UC01-003"
      - "RN-UC01-004"
      - "RN-UC01-005"
      - "RN-UC01-006"
      - "RN-RF046-001"
      - "RN-RF046-002"
      - "RN-RF046-003"
      - "RN-RF046-004"
      - "RN-RF046-006"

    resultado_final:
      estado: "grupo_criado"

  - id: "UC02"
    nome: "Visualizar Grupo de Troncos"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF046-CRUD-03"
        - "RF046-SEC-01"
        - "RF046-SEC-02"
        - "RF046-SEC-03"
        - "RF046-SEC-04"
        - "RF046-RN-01"
        - "RF046-RN-02"
        - "RF046-RN-03"
        - "RF046-RN-04"
        - "RF046-RN-05"
        - "RN-RF046-007"
        - "RN-RF046-008"
        - "RN-RF046-009"
        - "RN-RF046-010"
        - "RN-RF046-012"
        - "RN-RF046-014"
        - "RN-RF046-015"
      regras_negocio:
        - "RN-UC02-001"
        - "RN-UC02-002"
        - "RN-UC02-003"
        - "RN-UC02-004"
      permissoes:
        - "AST.GRUPOS_TRONCOS.LIST"
        - "AST.GRUPOS_TRONCOS.MONITOR"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona grupo"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida tenant (FornecedorId)"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados do grupo e troncos"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe dados estruturados"
          required: true
        - id: "FA-UC02-001"
          title: "Atualizar métricas em tempo real via SignalR"
          required: false
        - id: "FA-UC02-002"
          title: "Exportar relatório de uso"
          required: false
        - id: "FE-UC02-001"
          title: "Registro inexistente"
          required: true
        - id: "FE-UC02-002"
          title: "Registro de outro tenant"
          required: true
        - id: "FE-UC02-003"
          title: "Registro soft-deleted"
          required: true

    precondicoes:
      - permissao: "AST.GRUPOS_TRONCOS.LIST"

    gatilho: "Usuario seleciona registro"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_grupo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "sistema"
        acao: "exibir_detalhes"

    fluxos_alternativos:
      - id: "FA-UC02-01"
        condicao: "usuario_exporta_relatorio"
        resultado: "pdf_ou_excel_gerado"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "registro_inexistente"
        resultado: "not_found_404"
      - id: "FE-UC02-02"
        condicao: "registro_outro_tenant"
        resultado: "not_found_404"

    regras_aplicadas:
      - "RN-UC02-001"
      - "RN-UC02-002"
      - "RN-UC02-003"
      - "RN-UC02-004"
      - "RN-RF046-014"
      - "RN-RF046-015"

    resultado_final:
      estado: "detalhes_exibidos"

  - id: "UC03"
    nome: "Editar Grupo de Troncos"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF046-CRUD-04"
        - "RF046-VAL-01"
        - "RF046-VAL-02"
        - "RF046-VAL-03"
        - "RF046-VAL-04"
        - "RF046-VAL-05"
        - "RF046-SEC-01"
        - "RF046-SEC-02"
        - "RF046-SEC-04"
        - "RN-RF046-001"
        - "RN-RF046-002"
        - "RN-RF046-003"
        - "RN-RF046-004"
        - "RN-RF046-005"
        - "RN-RF046-006"
        - "RN-RF046-011"
        - "RN-RF046-013"
        - "RN-RF046-015"
      regras_negocio:
        - "RN-UC03-001"
        - "RN-UC03-002"
        - "RN-UC03-003"
        - "RN-UC03-004"
        - "RN-UC03-005"
      permissoes:
        - "AST.GRUPOS_TRONCOS.UPDATE"
        - "AST.GRUPOS_TRONCOS.CONFIGURE_ROUTING"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário clica em Editar"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega dados atuais"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário altera dados"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema persiste alterações"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema atualiza auditoria"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema publica evento GrupoTronco.Atualizado"
          required: true
        - id: "FP-UC03-010"
          title: "Se mudança de algoritmo → recalcula roteamento"
          required: true
        - id: "FP-UC03-011"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição"
          required: false
        - id: "FA-UC03-002"
          title: "Forçar atualização com forceUpdate=true"
          required: false
        - id: "FE-UC03-001"
          title: "Campo obrigatório ausente"
          required: true
        - id: "FE-UC03-002"
          title: "Nome duplicado no mesmo tenant"
          required: true
        - id: "FE-UC03-003"
          title: "Alteração com chamadas ativas"
          required: true
        - id: "FE-UC03-004"
          title: "Soma de pesos ≠ 100% (WEIGHTED)"
          required: true
        - id: "FE-UC03-005"
          title: "Registro de outro tenant"
          required: true

    precondicoes:
      - permissao: "AST.GRUPOS_TRONCOS.UPDATE"

    gatilho: "Usuario clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_editar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 4
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 5
        ator: "usuario"
        acao: "salvar"
      - passo: 6
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 7
        ator: "sistema"
        acao: "persistir_alteracoes"
      - passo: 8
        ator: "sistema"
        acao: "atualizar_auditoria"
      - passo: 9
        ator: "sistema"
        acao: "publicar_evento"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_400"
      - id: "FE-UC03-02"
        condicao: "chamadas_ativas"
        resultado: "conflict_409"
      - id: "FE-UC03-03"
        condicao: "pesos_invalidos"
        resultado: "erro_400"

    regras_aplicadas:
      - "RN-UC03-001"
      - "RN-UC03-002"
      - "RN-UC03-003"
      - "RN-UC03-004"
      - "RN-UC03-005"
      - "RN-RF046-003"
      - "RN-RF046-013"

    resultado_final:
      estado: "grupo_atualizado"

  - id: "UC04"
    nome: "Inativar Grupo de Troncos"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF046-CRUD-05"
        - "RF046-VAL-01"
        - "RF046-SEC-01"
        - "RF046-SEC-02"
        - "RF046-SEC-04"
        - "RN-RF046-001"
        - "RN-RF046-013"
        - "RN-RF046-014"
        - "RN-RF046-015"
      regras_negocio:
        - "RN-UC04-001"
        - "RN-UC04-002"
        - "RN-UC04-003"
        - "RN-UC04-004"
        - "RN-UC04-005"
        - "RN-UC04-006"
      permissoes:
        - "AST.GRUPOS_TRONCOS.DELETE"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário clica em Inativar"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema exibe confirmação"
          required: true
        - id: "FP-UC04-003"
          title: "Usuário confirma ação"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema valida ausência de chamadas ativas"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema marca FlExcluido = TRUE"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema desvincula troncos"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema publica evento GrupoTronco.Inativado"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar inativação"
          required: false
        - id: "FE-UC04-001"
          title: "Grupo possui chamadas ativas"
          required: true
        - id: "FE-UC04-002"
          title: "Registro de outro tenant"
          required: true
        - id: "FE-UC04-003"
          title: "Registro já inativado"
          required: true

    precondicoes:
      - permissao: "AST.GRUPOS_TRONCOS.DELETE"

    gatilho: "Usuario clica em Inativar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_inativar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_confirmacao"
      - passo: 3
        ator: "usuario"
        acao: "confirmar"
      - passo: 4
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 5
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 6
        ator: "sistema"
        acao: "validar_sem_chamadas"
      - passo: 7
        ator: "sistema"
        acao: "marcar_excluido"
      - passo: 8
        ator: "sistema"
        acao: "desvincular_troncos"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 10
        ator: "sistema"
        acao: "publicar_evento"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "chamadas_ativas"
        resultado: "conflict_409"
      - id: "FE-UC04-02"
        condicao: "registro_outro_tenant"
        resultado: "not_found_404"
      - id: "FE-UC04-03"
        condicao: "ja_inativado"
        resultado: "not_found_404"

    regras_aplicadas:
      - "RN-UC04-001"
      - "RN-UC04-002"
      - "RN-UC04-003"
      - "RN-UC04-004"
      - "RN-UC04-005"
      - "RN-UC04-006"
      - "RN-RF046-014"

    resultado_final:
      estado: "grupo_inativado"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração para template v2.0 com 5 UCs canônicos. Cobertura 100% do RF046."
  - versao: "1.0"
    data: "2025-12-18"
    autor: "-"
    descricao: "Versão inicial com 9 UCs"
