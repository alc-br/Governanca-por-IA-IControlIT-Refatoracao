# Casos de Uso - RF039 - Gestão de Bilhetes

**Versão:** 1.0
**Data:** 2025-12-18
**RF Relacionado:** [RF039 - Gestão de Bilhetes](./RF039.md)

## Índice de Casos de Uso

| UC | Nome | Complexidade |
|----|------|--------------|
| UC00 | Listar Bilhetes | Média |
| UC01 | Importar Bilhetes de Operadora | Alta |
| UC02 | Visualizar Bilhete | Baixa |
| UC03 | Processar Bilhetes em Lote | Alta |
| UC04 | Conciliar Bilhetes vs Fatura | Alta |
| UC05 | Identificar Anomalias em Bilhetes | Alta |
| UC06 | Exportar Bilhetes | Média |
| UC07 | Relatório de Consumo por Usuário | Média |
| UC08 | Dashboard de Bilhetagem | Média |

## UC00 - Listar Bilhetes
**Objetivo:** Listagem paginada de bilhetes telefônicos com filtros.
**Fluxo:** Grid com Número Origem, Número Destino, Data/Hora, Duração, Valor, Tipo (Local/DDD/DDI/Móvel), Operadora.
**RN-039-001:** Filtros: Período, Linha, Tipo Chamada, Valor Min/Max.

## UC01 - Importar Bilhetes de Operadora
**Objetivo:** Upload de arquivo CSV/TXT da operadora e parsing automático.
**Fluxo:** Upload → Detecta formato operadora (Vivo/Claro/Tim/Oi) → Parse campos → Validação → Importação.
**RN-039-002:** Formatos suportados: CSV padrão Anatel, TXT legado operadoras.
**RN-039-003:** Duplicados ignorados (chave: Número Origem + Data/Hora + Número Destino).
**RN-039-004:** Importação > 100k registros executa via job background.

## UC02 - Visualizar Bilhete
**Objetivo:** Detalhes completos do bilhete + classificação + custos.
**Fluxo:** Exibe origem, destino, data/hora, duração, valor, tipo chamada, operadora, usuário vinculado, centro custo.

## UC03 - Processar Bilhetes em Lote
**Objetivo:** Classificar e vincular bilhetes a usuários/centros de custo.
**Fluxo:** Job analisa bilhetes não processados → Vincula número origem a usuário → Aplica regras tarifação → Calcula custo → Marca como processado.
**RN-039-005:** Números não reconhecidos marcados como "Não Identificado" para revisão manual.

## UC04 - Conciliar Bilhetes vs Fatura
**Objetivo:** Comparar soma de bilhetes vs valor fatura operadora para identificar divergências.
**Fluxo:** Seleciona fatura → Sistema soma bilhetes do período → Compara valores → Exibe divergência (%).
**RN-039-006:** Divergência > 5% gera alerta para revisão.
**RN-039-007:** Detalhamento de divergência: bilhetes faltantes, valores discrepantes.

## UC05 - Identificar Anomalias em Bilhetes
**Objetivo:** Detectar padrões suspeitos via ML: chamadas longas, horários incomuns, DDI excessivo.
**Fluxo:** Job diário analisa bilhetes → Detecta: Duração > 2h, Chamadas 22h-6h, DDI > R$ 500/mês, Números premium.
**RN-039-008:** Anomalias geram ticket automático para investigação.

## UC06 - Exportar Bilhetes
**Objetivo:** Exportar bilhetes filtrados em CSV/Excel para análise externa.
**Fluxo:** Aplica filtros → Exporta com colunas configuráveis.
**RN-039-009:** Máximo 500k registros por exportação.

## UC07 - Relatório de Consumo por Usuário
**Objetivo:** Relatório detalhado de consumo telefônico por usuário: minutos, valor, tipos chamada.
**Fluxo:** Seleciona período + usuários → Gera relatório com: Total minutos, Total valor, Distribuição Local/DDD/DDI/Móvel, Top 10 destinos.
**Formatos:** PDF, Excel.

## UC08 - Dashboard de Bilhetagem
**Objetivo:** Dashboard gerencial com KPIs de consumo telefônico.
**Componentes:** KPIs (Total minutos mês, Total valor, Média por usuário), Gráfico linha (evolução mensal), Pizza (distribuição por tipo), Top 10 usuários, Alertas de anomalias.

## Integrações
- Central de Funcionalidades: Feature "Bilhetes Telefônicos"
- i18n: `bilhetes.titulo`, `bilhetes.tipo.local`, `bilhetes.importar`
- Auditoria: IMPORT, PROCESS, EXPORT, ANOMALY_DETECT
- RBAC: Visualizar (Gestor), Importar (Operador), Conciliar (Financeiro)

## Histórico
| Versão | Data | Descrição |
|--------|------|-----------|
| 1.0 | 2025-12-18 | Criação inicial - 9 UCs |
