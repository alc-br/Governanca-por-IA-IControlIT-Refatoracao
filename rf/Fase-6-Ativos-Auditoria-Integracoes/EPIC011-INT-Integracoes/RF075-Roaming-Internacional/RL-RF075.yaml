# RL-RF075 - Referência ao Legado: Roaming Internacional
# Versão: 2.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br

rf_id: RF075
titulo: "Roaming Internacional"

legado:
  sistema: "VB.NET + ASP.NET Web Forms"
  versao: "IC1 Legado"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server"
  multi_tenant: false
  auditoria: "partial"

# SEÇÃO CRÍTICA: Referências ao Legado com Destino Obrigatório
# IMPORTANTE: Módulo Roaming Internacional NÃO EXISTE no legado
# Todas as referências abaixo são "descartado" ou "substituido" pois eram PLANEJADAS mas não implementadas

referencias:
  - id: "LEG-RF075-001"
    tipo: "tela"
    nome: "SolicitarRoaming.aspx"
    caminho: "ic1_legado/IControlIT/Mobile/SolicitarRoaming.aspx (NÃO EXISTE)"
    descricao: |
      Tela mencionada na documentação v1.0 do RF075.md, mas NÃO ENCONTRADA no código legado.
      Deveria permitir solicitação de roaming com campos: país, datas, tipo de serviço, justificativa.

    destino: "descartado"
    justificativa: |
      Esta tela NUNCA FOI IMPLEMENTADA no legado. Não há código, tabelas ou lógica relacionada.
      A funcionalidade será criada do zero no sistema moderno (greenfield).
      Não há nada para modernizar, apenas desenvolver como novo módulo.

    rf_item_relacionado: null
    uc_relacionado: "UC01-criar-solicitacao-roaming"
    complexidade: "alta"
    risco_migracao: "baixo"  # Baixo porque não existe
    prioridade: 3

  - id: "LEG-RF075-002"
    tipo: "tela"
    nome: "AprovarRoaming.aspx"
    caminho: "ic1_legado/IControlIT/Mobile/AprovarRoaming.aspx (NÃO EXISTE)"
    descricao: |
      Tela de aprovação mencionada na documentação v1.0, mas NÃO ENCONTRADA no código legado.

    destino: "descartado"
    justificativa: |
      Tela NUNCA IMPLEMENTADA. Não há workflow de aprovação no legado.
      Sistema moderno implementará workflow com MediatR + SignalR (totalmente novo).

    rf_item_relacionado: "RN-RF075-01"
    uc_relacionado: "UC03-aprovar-rejeitar-solicitacao"
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF075-003"
    tipo: "tela"
    nome: "ConsultarRoaming.aspx"
    caminho: "ic1_legado/IControlIT/Mobile/ConsultarRoaming.aspx (NÃO EXISTE)"
    descricao: |
      Tela de consulta mencionada na documentação v1.0, mas NÃO ENCONTRADA.

    destino: "descartado"
    justificativa: |
      Tela NUNCA IMPLEMENTADA. Sistema moderno criará listagem com Angular 19 (novo).

    rf_item_relacionado: null
    uc_relacionado: "UC00-listar-solicitacoes-roaming"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 4

  - id: "LEG-RF075-004"
    tipo: "tela"
    nome: "RelatorioConsumo.aspx"
    caminho: "ic1_legado/IControlIT/Mobile/RelatorioConsumo.aspx (NÃO EXISTE)"
    descricao: |
      Tela de relatório mencionada na documentação v1.0, mas NÃO ENCONTRADA.

    destino: "descartado"
    justificativa: |
      Tela NUNCA IMPLEMENTADA. Sistema moderno criará relatórios com Power BI (novo).

    rf_item_relacionado: null
    uc_relacionado: "UC04-monitorar-consumo-roaming"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 5

  - id: "LEG-RF075-005"
    tipo: "webservice"
    nome: "WSRoamingInternacional.asmx.vb"
    caminho: "ic1_legado/WebService/WSRoamingInternacional.asmx.vb (NÃO EXISTE)"
    descricao: |
      WebService SOAP mencionado na documentação v1.0 com métodos:
      - CriaSolicitacao()
      - AprovaRoaming()
      - RejeitaRoaming()
      - ListaSolicitacoes()
      - SincronizaConsumo()

      Porém, este arquivo NÃO EXISTE no código legado.

    destino: "substituido"
    justificativa: |
      Mesmo que existisse, SOAP seria substituído por APIs REST (.NET 10 Minimal APIs).
      Como não existe, será implementado do zero como endpoints REST.

    rf_item_relacionado: null
    uc_relacionado: null
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 1

  - id: "LEG-RF075-006"
    tipo: "stored_procedure"
    nome: "sp_AprovaRoaming"
    caminho: "Database/dbo.sp_AprovaRoaming (NÃO EXISTE)"
    descricao: |
      Stored procedure mencionada na documentação v1.0, mas NÃO EXISTE no banco legado.

    destino: "substituido"
    justificativa: |
      Mesmo que existisse, lógica seria migrada para Commands/Handlers MediatR.
      Como não existe, será implementado do zero em .NET 10.

    rf_item_relacionado: "RN-RF075-01"
    uc_relacionado: "UC03-aprovar-rejeitar-solicitacao"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF075-007"
    tipo: "stored_procedure"
    nome: "sp_DesativaRoaming"
    caminho: "Database/dbo.sp_DesativaRoaming (NÃO EXISTE)"
    descricao: |
      Stored procedure mencionada na documentação v1.0, mas NÃO EXISTE.

    destino: "substituido"
    justificativa: |
      Lógica será implementada em Background Job .NET 10 (Hosted Service).

    rf_item_relacionado: "RN-RF075-04"
    uc_relacionado: null
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF075-008"
    tipo: "stored_procedure"
    nome: "sp_RelatorioConsumoRoaming"
    caminho: "Database/dbo.sp_RelatorioConsumoRoaming (NÃO EXISTE)"
    descricao: |
      Stored procedure de relatório mencionada na documentação v1.0, mas NÃO EXISTE.

    destino: "substituido"
    justificativa: |
      Relatórios serão implementados com Query Handlers MediatR + Power BI.

    rf_item_relacionado: null
    uc_relacionado: "UC04-monitorar-consumo-roaming"
    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 5

  - id: "LEG-RF075-009"
    tipo: "stored_procedure"
    nome: "sp_SincronizaOperadora"
    caminho: "Database/dbo.sp_SincronizaOperadora (NÃO EXISTE)"
    descricao: |
      Stored procedure de sincronização mencionada na documentação v1.0, mas NÃO EXISTE.

    destino: "substituido"
    justificativa: |
      Sincronização será implementada com Hosted Service + integração REST assíncrona.
      Polling manual será substituído por webhooks.

    rf_item_relacionado: "RN-RF075-13"
    uc_relacionado: null
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 1

  - id: "LEG-RF075-010"
    tipo: "componente"
    nome: "RoamingInternacional (Tabela)"
    caminho: "Database/dbo.RoamingInternacional (NÃO EXISTE)"
    descricao: |
      Tabela principal mencionada na documentação v1.0 com campos:
      - Id_Roaming
      - Id_Usuario
      - Id_Pais
      - Dt_Inicio, Dt_Fim
      - Tx_Justificativa
      - Tx_Status
      - Campos de auditoria básica

      Porém, esta tabela NÃO EXISTE no banco legado (IC1_LEGADO).

    destino: "substituido"
    justificativa: |
      Tabela será criada do zero com padrões do IControlIT moderno:
      - Multi-tenancy (Id_Conglomerado obrigatório)
      - Soft delete (Fl_Excluido)
      - Auditoria completa (campos de criação, alteração, exclusão)
      - Status como FK (não VARCHAR)
      - Criptografia de dados sensíveis
      - História de alterações (tabela de auditoria separada)

    rf_item_relacionado: null
    uc_relacionado: null
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 1

  - id: "LEG-RF075-011"
    tipo: "componente"
    nome: "ConsumoRoaming (Tabela)"
    caminho: "Database/dbo.ConsumoRoaming (NÃO EXISTE)"
    descricao: |
      Tabela de consumo mencionada na documentação v1.0 com campos:
      - Id_Consumo
      - Id_Roaming
      - Dt_Consumo
      - Qn_DadosGB, Qn_MinutosVoz, Qn_SMS
      - Vr_CustoUSD

      Porém, esta tabela NÃO EXISTE no banco legado.

    destino: "substituido"
    justificativa: |
      Tabela será criada do zero com:
      - Multi-tenancy
      - Auditoria completa
      - Campo de sincronização com operadora
      - Campo de limiar de alerta enviado (Ultimo_Limiar_Alertado)

    rf_item_relacionado: "RN-RF075-02, RN-RF075-03"
    uc_relacionado: "UC04-monitorar-consumo-roaming"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF075-012"
    tipo: "regra_negocio"
    nome: "Aprovação Sequencial por Email"
    caminho: "ic1_legado/IControlIT/Helpers/EmailHelper.vb (NÃO CONFIRMADO)"
    descricao: |
      Documentação v1.0 menciona workflow de aprovação sequencial por email.
      Porém, como o módulo não existe, esta regra nunca foi implementada.

    destino: "substituido"
    justificativa: |
      Workflow será implementado com:
      - MediatR Commands/Handlers
      - SignalR para notificações em tempo real
      - Email + Dashboard (não apenas email)
      - Estados explícitos (Solicitada, Aprovada, Rejeitada, etc)

    rf_item_relacionado: "RN-RF075-01, RN-RF075-05, RN-RF075-08"
    uc_relacionado: "UC03-aprovar-rejeitar-solicitacao"
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 1

  - id: "LEG-RF075-013"
    tipo: "regra_negocio"
    nome: "Limites Globais por Usuário"
    caminho: "Não implementado (módulo não existe)"
    descricao: |
      Documentação v1.0 menciona que legado tinha "limites globais por usuário".
      Porém, como o módulo não existe, esta regra nunca foi implementada.

    destino: "substituido"
    justificativa: |
      Sistema moderno terá limites granulares por:
      - País/Região (não global)
      - Perfil de gasto (Econômico, Padrão, Premium)
      - Tipo de serviço (Dados, Voz, SMS separados)

    rf_item_relacionado: "RN-RF075-02, RN-RF075-12"
    uc_relacionado: null
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF075-014"
    tipo: "regra_negocio"
    nome: "Relatórios Gerados 1x/Dia"
    caminho: "Não implementado (módulo não existe)"
    descricao: |
      Documentação v1.0 menciona que legado gerava relatórios 1x/dia.
      Porém, como o módulo não existe, esta funcionalidade nunca existiu.

    destino: "substituido"
    justificativa: |
      Sistema moderno terá:
      - Monitoramento em tempo real (background job a cada 30 min)
      - Dashboard com dados em tempo real (SignalR)
      - Relatórios sob demanda (Power BI)

    rf_item_relacionado: "RN-RF075-13"
    uc_relacionado: "UC04-monitorar-consumo-roaming"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 4

  - id: "LEG-RF075-015"
    tipo: "componente"
    nome: "WebService SOAP com Operadoras (Integração)"
    caminho: "Não implementado (módulo não existe)"
    descricao: |
      Documentação v1.0 menciona integração SOAP com operadoras via polling manual.
      Porém, como o módulo não existe, nunca houve integração.

    destino: "substituido"
    justificativa: |
      Sistema moderno terá:
      - APIs REST com operadoras (Vivo, Claro, TIM, Oi)
      - Webhooks para callbacks assíncronos (não polling)
      - Retry policy com exponential backoff
      - Circuit breaker pattern para resiliência

    rf_item_relacionado: "RN-RF075-06"
    uc_relacionado: null
    complexidade: "alta"
    risco_migracao: "medio"  # Médio porque requer contrato com operadoras
    prioridade: 1

# Telas Legadas (estrutura detalhada)
# NOTA: Todas as telas são NÃO EXISTENTES
telas: []

# WebServices Legados
# NOTA: Todos os WebServices são NÃO EXISTENTES
servicos: []

# Tabelas Legadas com Problemas
# NOTA: Todas as tabelas são NÃO EXISTENTES
tabelas: []

# Regras de Negócio Implícitas
# NOTA: Não há regras implícitas porque o módulo não existe
regras_implicitas: []

# Gap Analysis (Legado x Moderno)
gap_analysis:
  - item: "Módulo Roaming Internacional"
    existe_legado: false
    existe_moderno: true
    notas: "RF075 é funcionalidade 100% NOVA (greenfield)"

  - item: "Tabelas de Roaming"
    existe_legado: false
    existe_moderno: true
    notas: "Criar tabelas do zero com padrões IControlIT (multi-tenancy, auditoria, soft delete)"

  - item: "Workflow de Aprovação"
    existe_legado: false
    existe_moderno: true
    notas: "Implementar com MediatR + SignalR (não existia no legado)"

  - item: "Integração com Operadoras"
    existe_legado: false
    existe_moderno: true
    notas: "Integrar APIs REST (Vivo, Claro, TIM, Oi) - não havia integração no legado"

  - item: "Monitoramento de Consumo"
    existe_legado: false
    existe_moderno: true
    notas: "Criar background jobs .NET 10 - não existia no legado"

  - item: "Alertas Escalonados"
    existe_legado: false
    existe_moderno: true
    notas: "Implementar sistema de alertas (50%, 75%, 90%, 100%) - não existia no legado"

# Decisões de Modernização
decisoes_modernizacao:
  - decisao: "Implementar como Módulo Greenfield (Novo)"
    motivo: |
      Não há código legado para modernizar. RF075 é funcionalidade totalmente nova.
      Implementação do zero seguindo padrões do IControlIT modernizado.
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Não Migrar Dados Legados (Pois Não Existem)"
    motivo: |
      Tabelas RoamingInternacional e ConsumoRoaming não existem no legado.
      Banco iniciará vazio. Primeira solicitação será após go-live.
    impacto: "baixo"
    data: "2025-12-30"

  - decisao: "Integração com Operadoras via REST (Não SOAP)"
    motivo: |
      Operadoras modernas (Vivo, Claro, TIM, Oi) usam APIs REST.
      Documentação v1.0 menciona SOAP, mas será REST no moderno.
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Limites Granulares por País (Não Globais)"
    motivo: |
      Documentação v1.0 menciona limites globais no legado.
      Sistema moderno terá limites por país, região, perfil de gasto.
    impacto: "medio"
    data: "2025-12-30"

# Riscos de Migração
riscos_migracao:
  - risco: "Integração com Operadoras pode falhar (APIs não disponíveis)"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      - Implementar retry policy com exponential backoff
      - Criar fallback para ativação manual
      - Alertas de falha para admin
      - Documentar APIs de cada operadora antes do desenvolvimento

  - risco: "Usuários não sabem que módulo existe (novo)"
    impacto: "medio"
    probabilidade: "alta"
    mitigacao: |
      - Campanha de comunicação interna
      - Treinamento para usuários e gestores
      - Onboarding nas telas (tooltips, guias)

  - risco: "Limites mal configurados causam custos excessivos"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      - Validação obrigatória de limites (não pode ser zero)
      - Alertas em múltiplos limiares (50%, 75%, 90%, 100%)
      - Dashboard de monitoramento em tempo real
      - Relatórios de custo por país

  - risco: "Background jobs podem falhar e não monitorar consumo"
    impacto: "alto"
    probabilidade: "baixa"
    mitigacao: |
      - Monitoramento com Application Insights
      - Alertas de falha de job
      - Retry automático 3x
      - Fallback para sincronização manual

  - risco: "Dados sensíveis (ApiKey, MSISDN) podem vazar"
    impacto: "critico"
    probabilidade: "baixa"
    mitigacao: |
      - Criptografia AES-256 em repouso
      - Chaves em Azure Key Vault
      - Auditoria de acesso a dados sensíveis
      - Testes de segurança (penetration testing)

# Rastreabilidade (Legado → Moderno)
rastreabilidade:
  - elemento_legado: "Nenhum (módulo não existe)"
    referencia_rf: "RF-075"
    referencia_uc: "UC00-UC04"
    status: "novo_modulo"

# Changelog
changelog:
  - versao: "2.0"
    data: "2025-12-30"
    descricao: "Documentação corrigida: módulo Roaming Internacional NÃO EXISTE no legado. Todos os itens com destino explícito (descartado/substituído)."
    autor: "Agência ALC - alc.dev.br"

  - versao: "1.0"
    data: "2025-12-28"
    descricao: "Documentação inicial (baseada em suposição de existência do módulo - INCORRETO)"
    autor: "Claude Architect"

# RESUMO DE DESTINOS
# - descartado: 4 itens (telas que nunca foram implementadas)
# - substituido: 11 itens (funcionalidades que serão implementadas de forma moderna)
# - assumido: 0 itens (nada será mantido do legado)
# - a_revisar: 0 itens (nada precisa revisão)
#
# TOTAL: 15 itens (100% com destino explícito)
