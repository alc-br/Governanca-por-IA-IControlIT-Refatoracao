uc:
  rf: "RF061"
  versao: "2.1"
  data: "2025-12-31"

exclusions:
  uc_items: []

historico:
  - versao: "1.0"
    data: "2025-12-18"
    autor: "Architect Agent"
    descricao: "Versão stub incompleta com 11 UCs"
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica INCOMPLETA com 5 UCs (UC00-UC04) - 68.75% cobertura"
  - versao: "2.1"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica COMPLETA com 9 UCs (UC00-UC08) cobrindo 100% das 16 regras de negócio"

casos_de_uso:
  - id: "UC00"
    nome: "Listar Ordens de Serviço"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false
    covers:
      rf_items:
        - "RF-CRUD-02"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa funcionalidade Ordens de Serviço"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega OSs do tenant (EmpresaId)"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação (50 registros/página)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe lista com colunas (número, tipo, técnico, localização, data agendada, status, SLA)"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por status (AGUARDANDO_AGENDAMENTO, AGENDADA, EM_ATENDIMENTO, FINALIZADA, CANCELADA)"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por técnico"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por período (data agendada)"
          required: false
        - id: "FA-UC00-004"
          title: "Filtrar por SLA (dentro do prazo, atrasada, vencida)"
          required: false
        - id: "FA-UC00-005"
          title: "Ordenar por coluna (número, data, SLA)"
          required: false
        - id: "FA-UC00-006"
          title: "Exportar para Excel/CSV"
          required: false
        - id: "FA-UC00-007"
          title: "Visualizar mapa com OSs abertas (geolocalização)"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhuma OS cadastrada → estado vazio"
          required: true
    regras_aplicadas:
      - "RN-RF061-016"

  - id: "UC01"
    nome: "Criar Ordem de Serviço"
    ator_principal: "usuario_autenticado"
    tipo: "escrita"
    impacta_dados: true
    covers:
      rf_items:
        - "RF-CRUD-01"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário acessa formulário de criação"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC01-003"
          title: "Usuário preenche campos obrigatórios (tipo, descrição, localização, cliente, data prevista)"
          required: true
        - id: "FP-UC01-004"
          title: "Sistema valida campos obrigatórios"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema gera número único (OS-YYYY-NNNNN)"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema cria OS com EmpresaId automático"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema define status inicial: AGUARDANDO_AGENDAMENTO"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Criação automática a partir de solicitação aprovada (RN-RF061-001)"
          required: false
        - id: "FA-UC01-002"
          title: "Agendar imediatamente (técnico + data/hora) → status AGENDADA"
          required: false
        - id: "FA-UC01-003"
          title: "Anexar ativo relacionado"
          required: false
        - id: "FA-UC01-004"
          title: "Definir prioridade (BAIXA, MÉDIA, ALTA, CRÍTICA)"
          required: false
        - id: "FA-UC01-005"
          title: "Carrega checklist template do tipo de OS"
          required: false
        - id: "FE-UC01-001"
          title: "Campo obrigatório ausente → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "Tipo de OS não encontrado → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "Cliente de outro tenant → HTTP 403"
          required: true
    regras_aplicadas:
      - "RN-RF061-001"
      - "RN-RF061-003"
      - "RN-RF061-016"

  - id: "UC02"
    nome: "Visualizar Ordem de Serviço"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false
    covers:
      rf_items:
        - "RF-CRUD-03"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona OS na listagem"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida tenant (EmpresaId)"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados completos (cabeçalho, técnico, agendamento, checklist, peças, fotos)"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema carrega histórico de mudanças de status"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema carrega assinatura digital (se houver)"
          required: true
        - id: "FP-UC02-007"
          title: "Sistema calcula tempo de atendimento (se finalizada)"
          required: true
        - id: "FP-UC02-008"
          title: "Sistema exibe dados formatados"
          required: true
        - id: "FA-UC02-001"
          title: "Visualizar checklist preenchido pelo técnico"
          required: false
        - id: "FA-UC02-002"
          title: "Visualizar fotos de evidência (antes/depois)"
          required: false
        - id: "FA-UC02-003"
          title: "Visualizar assinatura digital do cliente"
          required: false
        - id: "FA-UC02-004"
          title: "Visualizar peças utilizadas com valores"
          required: false
        - id: "FA-UC02-005"
          title: "Visualizar checkpoints de geolocalização (check-in/check-out)"
          required: false
        - id: "FA-UC02-006"
          title: "Visualizar avaliação NPS do cliente"
          required: false
        - id: "FA-UC02-007"
          title: "Visualizar timeline completa da OS"
          required: false
        - id: "FA-UC02-008"
          title: "Download PDF assinado"
          required: false
        - id: "FE-UC02-001"
          title: "OS não encontrada → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "OS de outro tenant → HTTP 404"
          required: true
    regras_aplicadas:
      - "RN-RF061-008"
      - "RN-RF061-016"

  - id: "UC03"
    nome: "Executar Ordem de Serviço (Check-in/Check-out)"
    ator_principal: "tecnico"
    tipo: "escrita"
    impacta_dados: true
    covers:
      rf_items:
        - "RF-CRUD-04"
      uc_items:
        - id: "FP-UC03-001"
          title: "Técnico acessa OS agendada"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC03-003"
          title: "Técnico clica Iniciar Atendimento"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema captura geolocalização (lat, lon, data/hora) (RN-RF061-007)"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema registra check-in"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema muda status para EM_ATENDIMENTO"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema inicia cálculo de SLA"
          required: true
        - id: "FP-UC03-008"
          title: "Técnico preenche checklist obrigatório (RN-RF061-003)"
          required: true
        - id: "FP-UC03-009"
          title: "Técnico adiciona peças utilizadas (se houver) (RN-RF061-005)"
          required: false
        - id: "FP-UC03-010"
          title: "Técnico upload fotos de evidência (antes/depois) (RN-RF061-006)"
          required: false
        - id: "FP-UC03-011"
          title: "Técnico clica Concluir Atendimento"
          required: true
        - id: "FP-UC03-012"
          title: "Sistema valida checklist completo (itens obrigatórios preenchidos)"
          required: true
        - id: "FP-UC03-013"
          title: "Sistema captura geolocalização de check-out (RN-RF061-007)"
          required: true
        - id: "FP-UC03-014"
          title: "Sistema calcula tempo de atendimento (check-out - check-in) (RN-RF061-008)"
          required: true
        - id: "FP-UC03-015"
          title: "Sistema muda status para AGUARDANDO_ASSINATURA"
          required: true
        - id: "FP-UC03-016"
          title: "Técnico solicita assinatura do cliente"
          required: true
        - id: "FP-UC03-017"
          title: "Cliente assina digitalmente (canvas touchscreen) (RN-RF061-004)"
          required: true
        - id: "FP-UC03-018"
          title: "Sistema captura nome, CPF, data/hora, IP, hash SHA-256"
          required: true
        - id: "FP-UC03-019"
          title: "Sistema armazena assinatura"
          required: true
        - id: "FP-UC03-020"
          title: "Sistema finaliza OS (status: FINALIZADA)"
          required: true
        - id: "FP-UC03-021"
          title: "Sistema dá baixa automática em peças no estoque (RN-RF061-005)"
          required: true
        - id: "FP-UC03-022"
          title: "Sistema gera pré-nota para faturamento (RN-RF061-012)"
          required: true
        - id: "FP-UC03-023"
          title: "Sistema atualiza histórico de performance do técnico (RN-RF061-013)"
          required: true
        - id: "FP-UC03-024"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC03-025"
          title: "Sistema envia notificação ao cliente"
          required: true
        - id: "FA-UC03-001"
          title: "Pausar execução temporariamente (aguardando peça) → requer justificativa"
          required: false
        - id: "FA-UC03-002"
          title: "Reagendar (cliente ausente, emergência) → requer justificativa (RN-RF061-009)"
          required: false
        - id: "FA-UC03-003"
          title: "Solicitar avaliação NPS ao cliente (RN-RF061-011)"
          required: false
        - id: "FA-UC03-004"
          title: "Adicionar observações técnicas"
          required: false
        - id: "FE-UC03-001"
          title: "Check-in em horário diferente do agendado → alerta + registro"
          required: true
        - id: "FE-UC03-002"
          title: "GPS desabilitado → bloquear check-in até ativar"
          required: true
        - id: "FE-UC03-003"
          title: "Checklist incompleto → bloquear finalização"
          required: true
        - id: "FE-UC03-004"
          title: "Assinatura ausente → bloquear finalização"
          required: true
        - id: "FE-UC03-005"
          title: "Estoque insuficiente → alertar mas permitir finalização"
          required: true
        - id: "FE-UC03-006"
          title: "Falha na geração de pré-nota → registrar erro e notificar gestor"
          required: true
    regras_aplicadas:
      - "RN-RF061-003"
      - "RN-RF061-004"
      - "RN-RF061-005"
      - "RN-RF061-006"
      - "RN-RF061-007"
      - "RN-RF061-008"
      - "RN-RF061-009"
      - "RN-RF061-011"
      - "RN-RF061-012"
      - "RN-RF061-013"

  - id: "UC04"
    nome: "Cancelar Ordem de Serviço"
    ator_principal: "gestor_atendente"
    tipo: "escrita"
    impacta_dados: true
    covers:
      rf_items:
        - "RF-CRUD-05"
      uc_items:
        - id: "FP-UC04-001"
          title: "Gestor seleciona OS e acessa cancelamento"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida que OS NÃO está finalizada"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema exibe formulário de justificativa"
          required: true
        - id: "FP-UC04-005"
          title: "Usuário preenche justificativa (mínimo 20 caracteres)"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema valida justificativa"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema muda status para CANCELADA"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema registra justificativa, data/hora, usuário"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema envia notificação ao cliente"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC04-001"
          title: "Liberar técnico alocado para outras OSs"
          required: false
        - id: "FA-UC04-002"
          title: "Devolver peças reservadas ao estoque"
          required: false
        - id: "FE-UC04-001"
          title: "OS já finalizada → HTTP 400 (OS finalizada não pode ser cancelada)"
          required: true
        - id: "FE-UC04-002"
          title: "Justificativa < 20 caracteres → HTTP 400"
          required: true
        - id: "FE-UC04-003"
          title: "OS de outro tenant → HTTP 403"
          required: true
    regras_aplicadas:
      - "RN-RF061-016"

  - id: "UC05"
    nome: "Agendar Ordem de Serviço"
    ator_principal: "atendente_gestor"
    tipo: "escrita"
    impacta_dados: true
    covers:
      rf_items:
        - "RF-VAL-02"
      uc_items:
        - id: "FP-UC05-001"
          title: "Atendente seleciona OS em AGUARDANDO_AGENDAMENTO"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC05-003"
          title: "Usuário acessa tela de agendamento"
          required: true
        - id: "FP-UC05-004"
          title: "Sistema carrega tipos de OS e SLAs (RN-RF061-010)"
          required: true
        - id: "FP-UC05-005"
          title: "Usuário seleciona técnico"
          required: true
        - id: "FP-UC05-006"
          title: "Sistema consulta disponibilidade do técnico (RN-RF061-002)"
          required: true
        - id: "FP-UC05-007"
          title: "Sistema verifica OSs já agendadas para o técnico"
          required: true
        - id: "FP-UC05-008"
          title: "Sistema calcula janelas livres considerando duração estimada"
          required: true
        - id: "FP-UC05-009"
          title: "Sistema exibe agenda com slots disponíveis (verde) e ocupados (vermelho)"
          required: true
        - id: "FP-UC05-010"
          title: "Usuário seleciona data/hora disponível"
          required: true
        - id: "FP-UC05-011"
          title: "Sistema valida que slot está livre"
          required: true
        - id: "FP-UC05-012"
          title: "Sistema muda status para AGENDADA"
          required: true
        - id: "FP-UC05-013"
          title: "Sistema envia notificação 24h antes (SMS/WhatsApp/Email) (RN-RF061-014)"
          required: true
        - id: "FP-UC05-014"
          title: "Sistema inclui link para cliente confirmar presença"
          required: true
        - id: "FP-UC05-015"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC05-016"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC05-001"
          title: "Cliente confirmar presença via link → status CONFIRMADA"
          required: false
        - id: "FA-UC05-002"
          title: "Visualizar histórico de agendamentos do técnico"
          required: false
        - id: "FA-UC05-003"
          title: "Filtrar janelas por período (manhã, tarde)"
          required: false
        - id: "FE-UC05-001"
          title: "Horário ocupado → HTTP 400 (Técnico já possui OS agendada neste horário)"
          required: true
        - id: "FE-UC05-002"
          title: "Técnico de outro tenant → HTTP 403"
          required: true
        - id: "FE-UC05-003"
          title: "Técnico inativo → HTTP 400"
          required: true
    regras_aplicadas:
      - "RN-RF061-002"
      - "RN-RF061-010"
      - "RN-RF061-014"
      - "RN-RF061-016"

  - id: "UC06"
    nome: "Reagendar Ordem de Serviço"
    ator_principal: "atendente_gestor_tecnico"
    tipo: "escrita"
    impacta_dados: true
    covers:
      rf_items:
        - "RF-VAL-02"
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário seleciona OS agendada ou confirmada"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC06-003"
          title: "Usuário acessa reagendamento"
          required: true
        - id: "FP-UC06-004"
          title: "Sistema exibe formulário com justificativa obrigatória (RN-RF061-009)"
          required: true
        - id: "FP-UC06-005"
          title: "Usuário preenche justificativa (mínimo 20 caracteres)"
          required: true
        - id: "FP-UC06-006"
          title: "Sistema valida justificativa"
          required: true
        - id: "FP-UC06-007"
          title: "Sistema exibe agenda do técnico (ou permite trocar técnico)"
          required: true
        - id: "FP-UC06-008"
          title: "Sistema consulta disponibilidade (RN-RF061-002)"
          required: true
        - id: "FP-UC06-009"
          title: "Usuário seleciona nova data/hora"
          required: true
        - id: "FP-UC06-010"
          title: "Sistema valida slot disponível"
          required: true
        - id: "FP-UC06-011"
          title: "Sistema atualiza data agendada"
          required: true
        - id: "FP-UC06-012"
          title: "Sistema registra justificativa, data/hora, usuário responsável"
          required: true
        - id: "FP-UC06-013"
          title: "Sistema envia notificação automática ao cliente (RN-RF061-009)"
          required: true
        - id: "FP-UC06-014"
          title: "Sistema registra em auditoria"
          required: true
        - id: "FP-UC06-015"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC06-001"
          title: "Trocar técnico ao reagendar"
          required: false
        - id: "FA-UC06-002"
          title: "Visualizar histórico de reagendamentos"
          required: false
        - id: "FE-UC06-001"
          title: "Justificativa < 20 caracteres → HTTP 400"
          required: true
        - id: "FE-UC06-002"
          title: "OS finalizada ou cancelada → HTTP 400 (não pode reagendar)"
          required: true
        - id: "FE-UC06-003"
          title: "Novo horário ocupado → HTTP 400"
          required: true
    regras_aplicadas:
      - "RN-RF061-002"
      - "RN-RF061-009"
      - "RN-RF061-016"

  - id: "UC07"
    nome: "Monitorar SLA de Ordens de Serviço"
    ator_principal: "gestor"
    tipo: "leitura"
    impacta_dados: false
    covers:
      rf_items:
        - "RF-VAL-03"
      uc_items:
        - id: "FP-UC07-001"
          title: "Gestor acessa dashboard de SLA"
          required: true
        - id: "FP-UC07-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC07-003"
          title: "Sistema carrega OSs do tenant com SLAs"
          required: true
        - id: "FP-UC07-004"
          title: "Sistema calcula tempo restante em horário comercial (8h-18h, seg-sex) (RN-RF061-010)"
          required: true
        - id: "FP-UC07-005"
          title: "Sistema classifica OSs (Dentro do Prazo, Alerta 20%, Vencida)"
          required: true
        - id: "FP-UC07-006"
          title: "Sistema exibe relatório com colunas (número, tipo, técnico, SLA definido, tempo restante, status SLA)"
          required: true
        - id: "FP-UC07-007"
          title: "Sistema destaca visualmente OSs com alerta (amarelo) e vencidas (vermelho)"
          required: true
        - id: "FA-UC07-001"
          title: "Filtrar por status SLA (Dentro do Prazo, Alerta, Vencida)"
          required: false
        - id: "FA-UC07-002"
          title: "Filtrar por técnico"
          required: false
        - id: "FA-UC07-003"
          title: "Filtrar por período"
          required: false
        - id: "FA-UC07-004"
          title: "Exportar relatório Excel/PDF"
          required: false
        - id: "FA-UC07-005"
          title: "Receber alerta por email quando SLA atingir 20% (RN-RF061-010)"
          required: false
        - id: "FA-UC07-006"
          title: "Receber alerta por SMS quando SLA vencer (RN-RF061-010)"
          required: false
        - id: "FE-UC07-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC07-002"
          title: "Nenhuma OS com SLA → estado vazio"
          required: true
    regras_aplicadas:
      - "RN-RF061-010"
      - "RN-RF061-016"

  - id: "UC08"
    nome: "Visualizar Dashboard e Mapa de OSs"
    ator_principal: "gestor"
    tipo: "leitura"
    impacta_dados: false
    covers:
      rf_items:
        - "RF-SEC-01"
      uc_items:
        - id: "FP-UC08-001"
          title: "Gestor acessa dashboard de OSs"
          required: true
        - id: "FP-UC08-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC08-003"
          title: "Sistema carrega OSs abertas do tenant (RN-RF061-015)"
          required: true
        - id: "FP-UC08-004"
          title: "Sistema carrega checkpoints de geolocalização (check-in dos técnicos)"
          required: true
        - id: "FP-UC08-005"
          title: "Sistema exibe mapa com pins coloridos por status"
          required: true
        - id: "FP-UC08-006"
          title: "Sistema destaca técnicos em campo com ícone diferenciado (EM_ATENDIMENTO)"
          required: true
        - id: "FP-UC08-007"
          title: "Sistema atualiza mapa automaticamente a cada 30 segundos (RN-RF061-015)"
          required: true
        - id: "FP-UC08-008"
          title: "Sistema exibe painel com totalizadores (Total OSs, Agendadas, Em Atendimento, Finalizadas Hoje)"
          required: true
        - id: "FA-UC08-001"
          title: "Filtrar por status (AGENDADA, EM_ATENDIMENTO, CONFIRMADA)"
          required: false
        - id: "FA-UC08-002"
          title: "Filtrar por técnico"
          required: false
        - id: "FA-UC08-003"
          title: "Filtrar por região geográfica (zoom no mapa)"
          required: false
        - id: "FA-UC08-004"
          title: "Clicar em pin → exibir resumo da OS (número, cliente, técnico, horário)"
          required: false
        - id: "FA-UC08-005"
          title: "Visualizar histórico de performance por técnico (RN-RF061-013)"
          required: false
        - id: "FA-UC08-006"
          title: "Visualizar ranking de técnicos (NPS médio, OSs concluídas) (RN-RF061-013)"
          required: false
        - id: "FE-UC08-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC08-002"
          title: "Nenhuma OS aberta → mapa vazio + mensagem"
          required: true
    regras_aplicadas:
      - "RN-RF061-013"
      - "RN-RF061-015"
      - "RN-RF061-016"
