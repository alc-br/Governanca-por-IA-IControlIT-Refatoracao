# Casos de Uso - RF033 - Gest√£o de Chamados

**Vers√£o:** 1.0
**Data:** 2025-12-18
**RF Relacionado:** [RF033 - Gest√£o de Chamados](./RF033.md)

---

## √çndice de Casos de Uso

| UC | Nome | Descri√ß√£o | Complexidade |
|----|------|-----------|--------------|
| UC00 | Listar Chamados | Listagem paginada com filtros avan√ßados e prioriza√ß√£o | M√©dia |
| UC01 | Criar Chamado | Abertura de chamado com anexos e SLA autom√°tico | M√©dia |
| UC02 | Visualizar Chamado | Detalhes completos com hist√≥rico de intera√ß√µes | Baixa |
| UC03 | Editar Chamado | Altera√ß√£o de prioridade, categoria e reatribui√ß√£o | M√©dia |
| UC04 | Fechar Chamado | Encerramento com solu√ß√£o e avalia√ß√£o | Baixa |
| UC05 | Comentar em Chamado | Adicionar coment√°rios internos/externos | Baixa |
| UC06 | Escalar Chamado | Escalonamento autom√°tico por SLA ou manual | Alta |
| UC07 | Anexar Arquivos | Upload de evid√™ncias e documentos | Baixa |
| UC08 | Atribuir T√©cnico | Distribui√ß√£o manual ou autom√°tica via round-robin | M√©dia |
| UC09 | Acompanhar SLA | Monitoramento de prazos e alertas de vencimento | M√©dia |

---

## UC00 - Listar Chamados

**Complexidade:** M√©dia
**Estimativa:** 4h Backend + 6h Frontend

### Objetivo
Exibir listagem paginada de chamados com filtros avan√ßados (status, prioridade, t√©cnico, categoria), ordena√ß√£o, busca textual e indicadores visuais de SLA (verde/amarelo/vermelho).

### Atores
- T√©cnico de Suporte, Gestor de TI, Solicitante

### Pr√©-condi√ß√µes
- Usu√°rio autenticado
- Permiss√£o: `CHAMADOS.LISTAR`

### Fluxo Principal
1. Sistema exibe grid com colunas: N√∫mero, T√≠tulo, Solicitante, T√©cnico, Prioridade, Status, SLA, Data Abertura
2. Aplica filtros padr√£o: Status ‚â† Fechado, ordenado por Prioridade DESC, Data Abertura DESC
3. Exibe badge de SLA: üü¢ > 50% prazo | üü° 20-50% | üî¥ < 20% ou vencido
4. Usu√°rio clica em chamado ‚Üí redireciona para UC02 (Visualizar)

### Regras de Neg√≥cio
- **RN-033-001**: T√©cnico v√™ apenas chamados atribu√≠dos a ele (exceto gestor)
- **RN-033-002**: Solicitante v√™ apenas seus pr√≥prios chamados
- **RN-033-003**: SLA cr√≠tico (< 20%) exibe em vermelho piscante

---

## UC01 - Criar Chamado

**Complexidade:** M√©dia
**Estimativa:** 5h Backend + 7h Frontend

### Objetivo
Abrir novo chamado com t√≠tulo, descri√ß√£o, categoria, prioridade sugerida, anexos opcionais e c√°lculo autom√°tico de SLA baseado em matriz prioridade √ó categoria.

### Atores
- Qualquer usu√°rio autenticado (auto-atribui√ß√£o como solicitante)

### Pr√©-condi√ß√µes
- Usu√°rio autenticado
- Permiss√£o: `CHAMADOS.CRIAR`

### Fluxo Principal
1. Usu√°rio preenche:
   - **T√≠tulo*** (min 10 caracteres)
   - **Descri√ß√£o*** (rich text, min 30 caracteres)
   - **Categoria***: Hardware, Software, Rede, Acesso, Outro
   - **Prioridade sugerida**: Baixa, M√©dia, Alta, Urgente (sistema sugere baseado em palavras-chave)
   - **Anexos**: at√© 5 arquivos, 10MB cada (imagens, PDFs, logs)
2. Sistema calcula SLA automaticamente:
   - Urgente + Hardware = 2h
   - Alta + Software = 4h
   - M√©dia = 24h
   - Baixa = 72h
3. Cria chamado com Status = "Aberto"
4. Envia notifica√ß√£o para fila de t√©cnicos
5. Envia email confirma√ß√£o ao solicitante

### Regras de Neg√≥cio
- **RN-033-004**: Palavras-chave como "parado", "urgente", "travado" ‚Üí Prioridade Alta automaticamente
- **RN-033-005**: SLA inicia imediatamente ap√≥s cria√ß√£o (hor√°rio comercial 8h-18h)
- **RN-033-006**: N√∫mero do chamado formato: `YYYY-NNNNNN` (ex: 2025-000042)

---

## UC02 - Visualizar Chamado

**Complexidade:** Baixa
**Estimativa:** 3h Backend + 4h Frontend

### Objetivo
Exibir todos os detalhes do chamado incluindo hist√≥rico cronol√≥gico de intera√ß√µes (coment√°rios, mudan√ßas de status, reatribui√ß√µes), anexos e timeline de SLA.

### Atores
- T√©cnico atribu√≠do, Gestor, Solicitante

### Pr√©-condi√ß√µes
- Chamado existe
- Permiss√£o: `CHAMADOS.VISUALIZAR` (filtro por atribui√ß√£o/solicitante)

### Fluxo Principal
1. Sistema exibe:
   - **Cabe√ßalho**: N√∫mero, Status, Prioridade, SLA restante
   - **Detalhes**: T√≠tulo, Descri√ß√£o, Categoria, Solicitante, T√©cnico, Datas
   - **Timeline**: Hist√≥rico de a√ß√µes (abertura, coment√°rios, mudan√ßas status, escalonamentos)
   - **Anexos**: Lista de arquivos com preview/download
   - **A√ß√µes**: Comentar, Editar, Fechar, Escalar (conforme permiss√µes)

### Fluxos Alternativos
- **FA-01**: Se SLA vencido, exibe alerta vermelho: "‚ö†Ô∏è SLA vencido h√° X horas"
- **FA-02**: Se coment√°rio interno, exibe apenas para t√©cnicos (oculto de solicitante)

---

## UC03 - Editar Chamado

**Complexidade:** M√©dia
**Estimativa:** 4h Backend + 5h Frontend

### Objetivo
Alterar prioridade, categoria, descri√ß√£o, t√©cnico atribu√≠do ou status do chamado. Registra auditoria de mudan√ßas e recalcula SLA se necess√°rio.

### Atores
- T√©cnico atribu√≠do, Gestor

### Pr√©-condi√ß√µes
- Chamado n√£o est√° Fechado
- Permiss√£o: `CHAMADOS.EDITAR`

### Fluxo Principal
1. Usu√°rio altera campos permitidos:
   - Prioridade ‚Üí Recalcula SLA
   - Categoria ‚Üí Recalcula SLA
   - T√©cnico ‚Üí Notifica novo t√©cnico
   - Status ‚Üí Valida transi√ß√£o permitida (Aberto ‚Üí Em Atendimento ‚Üí Aguardando Cliente ‚Üí Resolvido ‚Üí Fechado)
2. Sistema registra auditoria: campo alterado, valor anterior, valor novo, usu√°rio, timestamp
3. Notifica solicitante sobre mudan√ßa cr√≠tica (prioridade, t√©cnico, status)

### Regras de Neg√≥cio
- **RN-033-007**: Apenas gestor pode rebaixar prioridade de Urgente para Baixa
- **RN-033-008**: Mudan√ßa de prioridade Baixa‚ÜíUrgente requer justificativa obrigat√≥ria
- **RN-033-009**: Reatribui√ß√£o para t√©cnico com > 10 chamados abertos exige confirma√ß√£o

---

## UC04 - Fechar Chamado

**Complexidade:** Baixa
**Estimativa:** 3h Backend + 4h Frontend

### Objetivo
Encerrar chamado com registro de solu√ß√£o aplicada, tempo total de atendimento, avalia√ß√£o do solicitante (1-5 estrelas) e op√ß√£o de reabrir em 48h.

### Atores
- T√©cnico atribu√≠do

### Pr√©-condi√ß√µes
- Chamado em Status = "Resolvido"
- Permiss√£o: `CHAMADOS.FECHAR`

### Fluxo Principal
1. T√©cnico marca Status = "Resolvido" e preenche:
   - **Solu√ß√£o aplicada*** (min 50 caracteres)
   - **Causa raiz**: Identificada ou N√£o Identificada
   - **Tempo de atendimento**: calculado automaticamente (abertura ‚Üí fechamento)
2. Sistema envia email ao solicitante:
   - "Seu chamado foi resolvido. Avalie o atendimento: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê"
   - Link para reabrir se problema persistir (v√°lido 48h)
3. Solicitante avalia (opcional) e confirma fechamento
4. Status muda para "Fechado" ap√≥s avalia√ß√£o OU 48h sem resposta

### Regras de Neg√≥cio
- **RN-033-010**: Chamado pode ser reaberto apenas 1 vez em 48h
- **RN-033-011**: Avalia√ß√£o < 3 estrelas notifica gestor automaticamente
- **RN-033-012**: SLA cumprido? (Sim/N√£o) registrado para m√©tricas

---

## UC05 - Comentar em Chamado

**Complexidade:** Baixa
**Estimativa:** 2h Backend + 3h Frontend

### Objetivo
Adicionar coment√°rios internos (vis√≠veis apenas para t√©cnicos) ou externos (vis√≠veis para solicitante) com notifica√ß√µes por email.

### Atores
- T√©cnico, Gestor, Solicitante

### Pr√©-condi√ß√µes
- Chamado n√£o est√° Fechado
- Permiss√£o: `CHAMADOS.COMENTAR`

### Fluxo Principal
1. Usu√°rio digita coment√°rio (rich text, min 10 caracteres)
2. Seleciona visibilidade:
   - ‚ö´ **Externo** (solicitante v√™)
   - ‚ö™ **Interno** (apenas t√©cnicos)
3. Anexa arquivos opcionais (screenshots, logs)
4. Sistema:
   - Salva coment√°rio com timestamp
   - Notifica destinat√°rios por email
   - Adiciona √† timeline do chamado

### Regras de Neg√≥cio
- **RN-033-013**: Coment√°rio interno n√£o notifica solicitante
- **RN-033-014**: Solicitante s√≥ pode criar coment√°rios externos
- **RN-033-015**: @mencionar t√©cnico no coment√°rio envia notifica√ß√£o individual

---

## UC06 - Escalar Chamado

**Complexidade:** Alta
**Estimativa:** 6h Backend + 5h Frontend

### Objetivo
Escalonar chamado para n√≠vel superior (N1‚ÜíN2‚ÜíN3) automaticamente por SLA vencido ou manualmente por decis√£o do t√©cnico/gestor.

### Atores
- Sistema (autom√°tico), T√©cnico, Gestor

### Pr√©-condi√ß√µes
- SLA vencido OU decis√£o manual de escalonamento

### Fluxo Principal - Autom√°tico
1. Job Hangfire executa a cada 15 minutos:
   ```sql
   SELECT * FROM Chamados
   WHERE Status IN ('Aberto', 'Em Atendimento')
     AND DATEDIFF(MINUTE, Dt_Abertura, GETDATE()) > SLA_Minutos
     AND Fl_Escalado = 0;
   ```
2. Para cada chamado vencido:
   - Incrementa n√≠vel (N1‚ÜíN2)
   - Reatribui para fila do n√≠vel superior
   - Adiciona coment√°rio autom√°tico: "üî¥ Escalado automaticamente por SLA vencido"
   - Notifica gestor do n√≠vel superior
3. Se N3 vencido ‚Üí Cria incidente cr√≠tico e notifica diretoria

### Fluxo Principal - Manual
1. T√©cnico/Gestor clica "Escalar Chamado"
2. Preenche:
   - **Motivo***: Complexidade t√©cnica, Falta de acesso, Outro
   - **Justificativa***: (min 30 caracteres)
   - **N√≠vel destino**: N2, N3, Especialista
3. Sistema reatribui e notifica

### Regras de Neg√≥cio
- **RN-033-016**: Escalonamento autom√°tico ocorre a cada 15min (job)
- **RN-033-017**: N3 vencido cria incidente cr√≠tico automaticamente
- **RN-033-018**: Hist√≥rico de escalonamentos vis√≠vel na timeline

---

## UC07 - Anexar Arquivos

**Complexidade:** Baixa
**Estimativa:** 3h Backend + 3h Frontend

### Objetivo
Fazer upload de arquivos (screenshots, logs, documentos) para o chamado com armazenamento em Azure Blob Storage e preview inline para imagens.

### Atores
- T√©cnico, Solicitante

### Pr√©-condi√ß√µes
- Chamado existe
- Permiss√£o: `CHAMADOS.ANEXAR`

### Fluxo Principal
1. Usu√°rio arrasta arquivos ou clica "Anexar Arquivo"
2. Valida:
   - Tamanho ‚â§ 10MB por arquivo
   - M√°ximo 5 arquivos por upload
   - Tipos permitidos: `.png, .jpg, .pdf, .txt, .log, .docx, .xlsx`
3. Faz upload para Azure Blob Storage (`chamados/{id}/{timestamp}-{filename}`)
4. Salva metadados no banco (nome, tamanho, tipo, URL, hash SHA-256)
5. Exibe preview inline para imagens

### Regras de Neg√≥cio
- **RN-033-019**: Arquivos exclu√≠dos logicamente (soft delete, reten√ß√£o 90 dias)
- **RN-033-020**: Hash SHA-256 calculado para verifica√ß√£o de integridade
- **RN-033-021**: Execut√°veis bloqueados (`.exe, .bat, .sh`)

---

## UC08 - Atribuir T√©cnico

**Complexidade:** M√©dia
**Estimativa:** 4h Backend + 4h Frontend

### Objetivo
Atribuir chamado a t√©cnico espec√≠fico manualmente ou via distribui√ß√£o autom√°tica round-robin considerando carga de trabalho atual.

### Atores
- Sistema (autom√°tico), Gestor

### Pr√©-condi√ß√µes
- Chamado em Status = "Aberto"
- Permiss√£o: `CHAMADOS.ATRIBUIR`

### Fluxo Principal - Autom√°tico
1. Sistema detecta novo chamado sem t√©cnico atribu√≠do
2. Executa algoritmo round-robin:
   ```sql
   SELECT TOP 1 t.Id_Usuario, COUNT(c.Id_Chamado) AS Carga
   FROM Tecnicos t
   LEFT JOIN Chamados c ON t.Id_Usuario = c.Id_Tecnico
     AND c.Status NOT IN ('Fechado', 'Cancelado')
   WHERE t.Fl_Ativo = 1
     AND t.Nivel = @NivelChamado
   GROUP BY t.Id_Usuario
   ORDER BY COUNT(c.Id_Chamado) ASC;
   ```
3. Atribui ao t√©cnico com menor carga
4. Notifica t√©cnico: "Novo chamado #2025-000042 atribu√≠do a voc√™"

### Fluxo Principal - Manual
1. Gestor acessa chamado ‚Üí "Atribuir T√©cnico"
2. Seleciona t√©cnico da lista (exibe carga atual)
3. Confirma atribui√ß√£o
4. Sistema notifica t√©cnico e registra auditoria

### Regras de Neg√≥cio
- **RN-033-022**: Reatribui√ß√£o > 3 vezes notifica gestor (poss√≠vel chamado complexo)
- **RN-033-023**: T√©cnico pode recusar chamado se carga > 15 chamados abertos
- **RN-033-024**: SLA pausa durante reatribui√ß√£o (max 15min)

---

## UC09 - Acompanhar SLA

**Complexidade:** M√©dia
**Estimativa:** 5h Backend + 6h Frontend

### Objetivo
Monitorar tempo restante de SLA com indicadores visuais, alertas progressivos (80%, 90%, 100%) e dashboard gerencial de cumprimento de SLAs.

### Atores
- T√©cnico, Gestor

### Pr√©-condi√ß√µes
- Chamado possui SLA definido

### Fluxo Principal
1. Sistema calcula tempo restante em tempo real:
   ```typescript
   const slaMinutos = chamado.sla_minutos;
   const tempoDecorrido = minutosEntre(chamado.dt_abertura, now);
   const tempoRestante = slaMinutos - tempoDecorrido;
   const percentualRestante = (tempoRestante / slaMinutos) * 100;
   ```
2. Exibe badge visual:
   - üü¢ > 50% restante
   - üü° 20-50% restante (alerta amarelo)
   - üî¥ < 20% restante (alerta vermelho)
   - ‚ö´ Vencido (alerta cr√≠tico)
3. Envia notifica√ß√µes:
   - 80% decorrido ‚Üí Email t√©cnico
   - 90% decorrido ‚Üí Email t√©cnico + gestor
   - 100% vencido ‚Üí Email gestor + escalonamento autom√°tico (UC06)

### Dashboard Gestor
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SLA - √öltimos 30 dias                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚úÖ Cumpridos: 142 (85%)                ‚îÇ
‚îÇ ‚ö†Ô∏è Vencidos: 25 (15%)                  ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ üìä Por Categoria:                      ‚îÇ
‚îÇ Hardware: 90% cumprimento              ‚îÇ
‚îÇ Software: 82% cumprimento              ‚îÇ
‚îÇ Rede: 78% cumprimento (cr√≠tico)        ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ üî• Chamados Cr√≠ticos (SLA < 20%):      ‚îÇ
‚îÇ #2025-000142 - Rede inst√°vel (15%)     ‚îÇ
‚îÇ #2025-000138 - Login travado (8%)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Regras de Neg√≥cio
- **RN-033-025**: SLA conta apenas hor√°rio comercial (8h-18h, seg-sex)
- **RN-033-026**: Feriados n√£o contam para SLA (configur√°vel)
- **RN-033-027**: Status "Aguardando Cliente" pausa SLA temporariamente
- **RN-033-028**: M√©trica de cumprimento SLA impacta avalia√ß√£o de t√©cnicos

---

## Integra√ß√µes Obrigat√≥rias

### 1. Central de Funcionalidades
- Registrar feature "Gest√£o de Chamados" com 10 UCs
- Vincular permiss√µes: CHAMADOS.LISTAR, CRIAR, EDITAR, FECHAR, etc.

### 2. Internacionaliza√ß√£o (i18n)
- Chaves de tradu√ß√£o: `chamados.titulo`, `chamados.status.aberto`, `chamados.prioridade.urgente`
- Idiomas: pt-BR, en-US, es-ES

### 3. Auditoria
- Auditar: Cria√ß√£o, Edi√ß√£o, Fechamento, Escalonamento, Reatribui√ß√£o
- Reten√ß√£o: 7 anos (LGPD)

### 4. Controle de Acesso (RBAC)
- Perfis: Solicitante (criar/visualizar), T√©cnico (atribuir/resolver), Gestor (escalar/reatribuir)
- Regra: T√©cnico v√™ apenas chamados atribu√≠dos a ele (exceto gestor)

---

## Chaves de Tradu√ß√£o (i18n)

```json
{
  "chamados.titulo": "Gest√£o de Chamados",
  "chamados.criar": "Abrir Chamado",
  "chamados.numero": "N√∫mero",
  "chamados.status.aberto": "Aberto",
  "chamados.status.em_atendimento": "Em Atendimento",
  "chamados.status.resolvido": "Resolvido",
  "chamados.status.fechado": "Fechado",
  "chamados.prioridade.baixa": "Baixa",
  "chamados.prioridade.media": "M√©dia",
  "chamados.prioridade.alta": "Alta",
  "chamados.prioridade.urgente": "Urgente",
  "chamados.sla.vencido": "SLA vencido h√° {horas} horas",
  "chamados.escalar": "Escalar Chamado",
  "chamados.avaliar": "Avaliar Atendimento"
}
```

---

## Hist√≥rico de Altera√ß√µes

| Vers√£o | Data | Autor | Descri√ß√£o |
|--------|------|-------|-----------|
| 1.0 | 2025-12-18 | Architect Agent | Cria√ß√£o inicial - 10 casos de uso |
