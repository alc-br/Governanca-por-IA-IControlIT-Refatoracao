# RF028: Gestão de SLA - Operações

**Versao**: 1.0 | **Data**: 2025-12-28
**RF Relacionado**: RF072 (Escalação Automática), RF077 (Ordens de Serviço) | **EPIC**: EPIC008-SD-Service-Desk
**Fase**: Fase 5 - Service Desk

---

## 1. RESUMO EXECUTIVO

### 1.1 Descrição Geral

Este requisito especifica o **Módulo de Gestão de SLA para Operações** do sistema IControlIT, responsável por definir, monitorar e garantir o cumprimento de Service Level Agreements (SLAs) para operações de ativos. O módulo gerencia metas de tempo (resposta, resolução, atendimento) para operações como instalação, movimentação, configuração, desinstalação e manutenção de ativos.

O sistema calcula automaticamente o tempo de SLA consumido, gera alertas em cascata (50%, 75%, 90%, 100%) e escala automaticamente quando o SLA está prestes a vencer. Suporta múltiplos calendários de atendimento (24x7, horário comercial, dias úteis), pausa automática fora do horário, integração com feriados nacionais via BrasilAPI e versionamento completo de SLAs para auditoria.

### 1.2 Importância Estratégica

O módulo de Gestão de SLA para Operações é crítico para:

- **Conformidade Contratual**: Garante que todos os SLAs contratados sejam respeitados e medidos objetivamente, reduzindo litígios e disputas com clientes. Fornece evidência auditável de cumprimento ou desvios.
- **Eficiência Operacional**: Prioriza automaticamente operações por criticidade do ativo e nível de alerta, otimizando alocação de recursos técnicos. Elimina necessidade de monitoramento manual e reduz tempo de resposta.
- **Satisfação do Cliente**: Oferece transparência em tempo real (dashboard SignalR) sobre status de operações, estimativa de conclusão e alertas preventivos. Reduz surpresas e aumenta confiança.
- **Escalação Inteligente**: Automatiza escalação em cascata (Level 1 → 2 → 3 → Manager) quando SLA está em risco, garantindo que operações críticas recebam atenção imediata.
- **Relatórios Gerenciais**: Fornece métricas de compliance (% atendimento, tempo médio, violações) para análise de performance, identificação de gargalos e otimização contínua.
- **Auditoria Completa**: Registra todas as alterações de SLA, cálculos, pausas e escalaçoes, permitindo rastreamento completo para fins regulatórios (ISO 27001, SOC 2).

### 1.3 Conceitos Fundamentais

**Service Level Agreement (SLA)**: Contrato formal que define metas de tempo para responder, resolver e entregar uma operação. Inclui definições de:
- **Tempo de Resposta**: Prazo máximo para iniciar atendimento após abertura da operação.
- **Tempo de Resolução**: Prazo máximo para completar e entregar a operação.
- **Tempo de Atendimento**: Prazo máximo para que o cliente valide e aceite a operação.
- Exemplo: P1 = 2h resposta / 4h resolução / 8h atendimento.

**Prioridade**: Classificação de urgência baseada no tipo de ativo (crítico, alto, médio, baixo). Define metas de SLA automaticamente.
- P1 (Crítico): Ativo essencial para operação (servidores, switches, links críticos).
- P2 (Alto): Ativo importante (estações de trabalho, impressoras em áreas críticas).
- P3 (Médio): Ativo padrão (computadores pessoais, monitores).
- P4 (Baixo): Ativo não essencial (periféricos, cabos).

**Calendário de Atendimento**: Define em que dias/horários o SLA corre. Tipos:
- **24x7**: SLA corre 24 horas, 7 dias por semana (crítico).
- **Horário Comercial**: SLA corre de 08:00 às 18:00 (pausa fora desse horário).
- **Dias Úteis**: SLA corre apenas segunda a sexta, 08:00 às 18:00 (pausa fins de semana e feriados).

**Pausa de SLA**: Suspensão do contador de SLA quando:
- Fora do horário de atendimento (ex: 18h01 até 08h00 no dia útil).
- Aguardando ação do cliente (aguardando acesso, aguardando peça, etc).
- Aguardando terceiro (fornecedor de peça, operadora de telecom).

**Escalação Automática**: Transferência de responsabilidade quando SLA está em risco:
- **Level 1**: Técnico primeiro nível → Alert 50% SLA.
- **Level 2**: Técnico especialista → Alert 75% SLA.
- **Level 3**: Gerente técnico → Alert 90% SLA.
- **Manager**: Gerente de operações → Alert 100% SLA (SLA vencido).

**Versionamento de SLA**: Histórico de alterações de configuração com:
- Data de vigência (from/to).
- Alterações realizadas (mudança de meta, prioridade, calendário).
- Usuário que fez a alteração.
- Motivo (ajuste de performance, novo contrato, etc).

### 1.4 Legado vs Modernizado

| Aspecto | Legado (VB.NET) | Modernizado (.NET 10 + Angular) |
|---------|-----------------|--------------------------------|
| **CRUD de SLA** | WebService WSSLA.asmx, tabela SLAOperacao | API REST /api/sla-operacoes, Entity Framework |
| **Cálculo de SLA** | Stored Procedure paCalculaSLA, cálculo em VB | CQRS Query SLA, algoritmo C# otimizado |
| **Alertas** | Job de background simples, email | SignalR em tempo real, múltiplos canais (email, SMS, push) |
| **Escalação** | Manual via interface ASPX | Automática com regras de negócio, workflow |
| **Calendário** | Hardcoded (dias úteis apenas) | Flexível (24x7, comercial, dias úteis), integração com feriados |
| **Pausa de SLA** | Manual (usuário cria campo) | Automática (fora horário) + manual (aguardando cliente) |
| **Relatórios** | Report Services em SQL | Angular charts + API /api/sla-operacoes/metricas |
| **Auditoria** | AuditLog simples (CREATE/UPDATE/DELETE) | Event Sourcing (SLACalculado, SLAPausado, SLARetomado, SLAEscalado) |
| **Versionamento** | Não existe (sobrescreve dados) | Tabela SLAOperacaoVersion com histórico completo |
| **Feriados** | Manual cada empresa | BrasilAPI integrada (calendario nacional) |
| **Multi-tenancy** | Por banco de dados | Por ClienteId com isolamento de dados |

### 1.5 Funcionalidades Principais

1. **CRUD de SLA para Operações** - Criar, ler, atualizar, excluir SLAs com validações de negócio obrigatórias.
2. **Definição de Metas por Prioridade** - Configurar tempo resposta/resolução/atendimento automaticamente baseado em prioridade (P1-P4).
3. **Priorização por Tipo de Ativo** - Mapear tipo de ativo para prioridade (crítico = P1, etc) com fallback automático.
4. **Calendário de Atendimento Flexível** - Suportar 24x7, horário comercial, dias úteis com exceções por empresa.
5. **Pausa Automática Fora do Horário** - Suspender contador SLA automaticamente fora horário (com auditoria).
6. **Cálculo Automático de SLA Consumido vs Disponível** - Algoritmo que exclui pausas, feriados e fins de semana.
7. **Alertas em Cascata (50%, 75%, 90%, 100%)** - Notificações progressivas quando SLA está em risco.
8. **Escalação Automática por Nível (L1 → L2 → L3 → Manager)** - Transfer responsabilidade automaticamente quando alertas disparam.
9. **Dashboard de SLA em Tempo Real (SignalR)** - Visualização live de status de todas as operações com atualização push.
10. **Relatórios de Compliance** - Percentual de atendimento, tempo médio, violações por período/cliente/tipo.
11. **Integração com Ordens de Serviço (RF077)** - Sincronizar automaticamente status de OS com SLA.
12. **Multi-tenancy por ClienteId** - Isolamento completo de dados por cliente com SLAs independentes.
13. **Auditoria Completa de SLA** - Registrar todas as operações (criação, cálculo, pausa, retomada, escalação).
14. **Versionamento de SLA** - Histórico de alterações com vigência (from/to) para rastreabilidade.
15. **Exportação de Métricas** - Extrair dados em Excel, PDF, CSV para análise externa.

---

## 2. REGRAS DE NEGÓCIO

### RN-SLA-028-01: Validação de Hierarquia de Tempos SLA

**Descrição**: Tempo de resposta deve ser sempre menor que tempo de resolução, que deve ser menor que tempo de atendimento. Valida a coerência da meta de SLA.

**Justificativa**: Evita configurações ilógicas que causariam SLA impossível de atingir. Exemplo inválido: resposta=8h, resolução=4h (impossível responder em 8h e resolver em 4h).

**Implementação**:
```csharp
public class SLAOperacaoValidator
{
    public static ValidationResult ValidarHierarquia(
        TimeSpan tempoResposta,
        TimeSpan tempoResolucao,
        TimeSpan tempoAtendimento)
    {
        if (tempoResposta >= tempoResolucao)
            return ValidationResult.Invalid("Tempo de resposta deve ser menor que resolução");

        if (tempoResolucao >= tempoAtendimento)
            return ValidationResult.Invalid("Tempo de resolução deve ser menor que atendimento");

        return ValidationResult.Valid();
    }
}
```

**Exemplos**:
- Válido: resposta=2h, resolução=4h, atendimento=8h (P1)
- Inválido: resposta=4h, resolução=4h, atendimento=8h (resposta=resolução viola)

---

### RN-SLA-028-02: Cálculo de SLA Exclui Pausas e Feriados

**Descrição**: O contador de SLA não inclui períodos de pausa (fora horário, aguardando cliente) e feriados nacionais. Apenas tempo produtivo conta.

**Justificativa**: Garante fairness - não penaliza operação por limite de horário ou comportamento do cliente. Aumenta aceitação do SLA pelo cliente.

**Implementação**:
```csharp
public class SLACalculator
{
    public static decimal CalcularSLAConsumido(
        DateTimeOffset dataAbertura,
        DateTimeOffset dataAtual,
        IEnumerable<PausaSLA> pausas,
        Calendario calendario)
    {
        var tempoTotal = dataAtual - dataAbertura;
        var tempoProdutivo = tempoTotal;

        // Deduzir pausas
        foreach (var pausa in pausas.Where(p => p.DataFim <= dataAtual))
        {
            tempoProdutivo -= (pausa.DataFim.Value - pausa.DataInicio);
        }

        // Deduzir feriados
        var feriados = calendario.ObtendFeriadosEntre(dataAbertura, dataAtual);
        foreach (var feriado in feriados)
        {
            tempoProdutivo -= TimeSpan.FromDays(1);
        }

        // Deduzir fins de semana se calendar não é 24x7
        if (calendario.Tipo != TipoCalendario.Vinte4x7)
        {
            tempoProdutivo = DeduzeFinsDeSemana(tempoProdutivo, dataAbertura, dataAtual);
        }

        return (decimal)(tempoProdutivo.TotalHours / calendario.MetaResposta.TotalHours);
    }

    private static TimeSpan DeduzeFinsDeSemana(
        TimeSpan tempoProdutivo,
        DateTimeOffset inicio,
        DateTimeOffset fim)
    {
        var deducao = TimeSpan.Zero;
        var data = inicio;
        while (data < fim)
        {
            if (data.DayOfWeek == DayOfWeek.Saturday || data.DayOfWeek == DayOfWeek.Sunday)
                deducao += TimeSpan.FromDays(1);
            data = data.AddDays(1);
        }
        return tempoProdutivo - deducao;
    }
}
```

**Exemplos**:
- OS aberta segunda 08h, resolvida terça 10h: SLA consumido = 26h (exclui segunda 18-08=10h, feriado se houver).
- Pausa de 2h aguardando cliente: contador pausado, não conta na SLA.

---

### RN-SLA-028-03: Pausa Automática Fora de Horário de Atendimento

**Descrição**: Quando a operação passa para fora do horário de atendimento, o contador de SLA é automaticamente pausado. Quando volta ao horário, retoma automaticamente.

**Justificativa**: Evita penalizar por período fora de expediente. Se SLA é "dias úteis 8-18h", não faz sentido contar à noite.

**Implementação**:
```csharp
public class PausaSLAService
{
    public async Task ProcessarMudancaHorario(
        long ordemServicoId,
        Calendario calendario,
        CancellationToken cancellationToken)
    {
        var agora = DateTimeOffset.UtcNow;
        var estaNoHorarioAtendimento = calendario.EstaNoHorarioAtendimento(agora);

        var ultimaPausa = await _context.PausaSLA
            .Where(p => p.OrdemServicoId == ordemServicoId && p.DataFim == null)
            .FirstOrDefaultAsync(cancellationToken);

        if (!estaNoHorarioAtendimento && ultimaPausa == null)
        {
            // Iniciar pausa
            var pausa = new PausaSLA
            {
                OrdemServicoId = ordemServicoId,
                DataInicio = agora,
                TipoPausa = TipoPausa.ForaHorario,
                MotivoInterno = $"Pausa automática fora horário {calendario.Tipo}"
            };
            _context.PausaSLA.Add(pausa);

            await _context.SaveChangesAsync(cancellationToken);

            await _auditoria.RegistrarEvento(
                "SLA_PAUSADO_AUTOMATICO",
                ordemServicoId,
                new { motivo = pausa.MotivoInterno });
        }
        else if (estaNoHorarioAtendimento && ultimaPausa != null)
        {
            // Retomar pausa
            ultimaPausa.DataFim = agora;
            _context.PausaSLA.Update(ultimaPausa);

            await _context.SaveChangesAsync(cancellationToken);

            await _auditoria.RegistrarEvento(
                "SLA_RETOMADO_AUTOMATICO",
                ordemServicoId,
                new { duracaoPausa = (ultimaPausa.DataFim - ultimaPausa.DataInicio).TotalHours });
        }
    }
}
```

**Exemplos**:
- OS em andamento às 17:45 (ainda em horário). Às 18:05 SLA pausa automaticamente.
- Pausa retoma na terça às 08:00 quando expediente reabre.

---

### RN-SLA-028-04: Alertas em Cascata (50%, 75%, 90%, 100%)

**Descrição**: Sistema calcula percentual de SLA consumido e gera alertas em milestones (50%, 75%, 90%, 100%). Cada alerta pode disparar notificação e escalação.

**Justificativa**: Alerta progressiva permite ação preventiva. Alert 50% é informativo, 75% requer atenção, 90% é crítico, 100% é violação.

**Implementação**:
```csharp
public class AlertaSLAService
{
    private readonly decimal[] THRESHOLDS = new[] { 0.50m, 0.75m, 0.90m, 1.00m };

    public async Task VerificarEDispararAlertas(
        long slaOperacaoId,
        OrdemServico ordemServico,
        CancellationToken cancellationToken)
    {
        var sla = await _context.SLAOperacao
            .Include(s => s.ConfiguracaoAlertas)
            .FirstOrDefaultAsync(s => s.Id == slaOperacaoId, cancellationToken);

        var percentualConsumido = CalcularPercentualConsumido(ordemServico, sla);

        var alertasJaGerados = await _context.AlertaSLA
            .Where(a => a.OrdemServicoId == ordemServico.Id)
            .Select(a => a.PercentualLimiar)
            .ToListAsync(cancellationToken);

        foreach (var threshold in THRESHOLDS.Where(t => t > percentualConsumido &&
                 !alertasJaGerados.Contains(t)))
        {
            if (percentualConsumido >= threshold)
            {
                var alerta = new AlertaSLA
                {
                    OrdemServicoId = ordemServico.Id,
                    SLAOperacaoId = slaOperacaoId,
                    PercentualLimiar = threshold,
                    DataAlerta = DateTimeOffset.UtcNow,
                    Status = StatusAlerta.Ativo,
                    Severidade = threshold switch
                    {
                        0.50m => Severidade.Informativo,
                        0.75m => Severidade.Aviso,
                        0.90m => Severidade.Critico,
                        1.00m => Severidade.Violacao,
                        _ => Severidade.Informativo
                    }
                };

                _context.AlertaSLA.Add(alerta);
                await _notificacaoService.EnviarAlerta(alerta, cancellationToken);

                // Escalação se necessário
                if (threshold >= 0.75m)
                {
                    await _escalacaoService.Escalar(ordemServico, threshold, cancellationToken);
                }
            }
        }

        await _context.SaveChangesAsync(cancellationToken);
    }

    private decimal CalcularPercentualConsumido(OrdemServico os, SLAOperacao sla)
    {
        var tempoDecorrido = DateTimeOffset.UtcNow - os.DataAbertura;
        var metaSLA = os.Prioridade switch
        {
            Prioridade.P1 => sla.MetaRespostaP1,
            Prioridade.P2 => sla.MetaRespostaP2,
            Prioridade.P3 => sla.MetaRespostaP3,
            Prioridade.P4 => sla.MetaRespostaP4,
            _ => sla.MetaRespostaP3
        };

        return (decimal)(tempoDecorrido.TotalHours / metaSLA.TotalHours);
    }
}
```

**Exemplos**:
- SLA P1 = 2h resposta. Após 1h → alerta 50% (informativo).
- Após 1h30min → alerta 75% (aviso, pode escalar).
- Após 1h48min → alerta 90% (crítico, escalação obrigatória).
- Após 2h → alerta 100% (violação, manager notificado).

---

### RN-SLA-028-05: Escalação Automática Quando SLA Estoura

**Descrição**: Quando SLA atinge 90% (crítico), sistema automaticamente transfere operação para Level 2. Quando atinge 100%, transfere para Level 3, depois para Manager.

**Justificativa**: Garante que operações críticas recebem atenção de pessoas mais experientes/sênior automaticamente, sem esperar por ação manual.

**Implementação**:
```csharp
public class EscalacaoSLAService
{
    public async Task EscalarOperacao(
        OrdemServico ordemServico,
        decimal percentualSLA,
        CancellationToken cancellationToken)
    {
        var nivelEscalacao = DeterminaNivelEscalacao(percentualSLA);
        var nivelAtual = ordemServico.NivelEscalacao ?? 1;

        if (nivelEscalacao <= nivelAtual)
            return; // Já foi escalado, não voltar para trás

        var novoResponsavel = await _usuarioService
            .ObtendTecnicoDisponivel(nivelEscalacao, ordemServico.ClienteId, cancellationToken);

        if (novoResponsavel == null)
        {
            // Escalar para gerente se nenhum técnico disponível
            novoResponsavel = await _usuarioService.ObtendGerente(ordemServico.ClienteId, cancellationToken);
        }

        var escalacao = new Escalacao
        {
            OrdemServicoId = ordemServico.Id,
            UsuarioOrigemId = ordemServico.ResponsavelId,
            UsuarioDestinoId = novoResponsavel.Id,
            DataEscalacao = DateTimeOffset.UtcNow,
            Motivo = $"SLA em risco ({percentualSLA:P0})",
            Nivel = nivelEscalacao
        };

        ordemServico.ResponsavelId = novoResponsavel.Id;
        ordemServico.NivelEscalacao = nivelEscalacao;

        _context.Escalacao.Add(escalacao);
        _context.OrdemServico.Update(ordemServico);

        await _context.SaveChangesAsync(cancellationToken);

        await _notificacaoService.NotificarEscalacao(
            novoResponsavel,
            ordemServico,
            escalacao,
            cancellationToken);

        await _auditoria.RegistrarEvento(
            "SLA_ESCALADO",
            ordemServico.Id,
            new { nivelEscalacao, usuarioAtribuido = novoResponsavel.Nome });
    }

    private int DeterminaNivelEscalacao(decimal percentualSLA)
    {
        return percentualSLA switch
        {
            >= 1.00m => 4, // Manager (SLA violado)
            >= 0.90m => 3, // Level 3 (crítico)
            >= 0.75m => 2, // Level 2 (aviso)
            >= 0.50m => 1, // Level 1 (informativo)
            _ => 1
        };
    }
}
```

**Exemplos**:
- Level 1 técnico recebe OS (P1, SLA = 2h resposta).
- Após 1h30min (75% SLA) → escalado para Level 2 (especialista).
- Após 1h48min (90% SLA) → escalado para Level 3 (gerente técnico).
- Após 2h (100% SLA) → escalado para Manager (operações).

---

### RN-SLA-028-06: Metas de SLA para Prioridade P1 (Crítico)

**Descrição**: Prioridade P1 define metas: 2 horas resposta, 4 horas resolução, 8 horas atendimento. Aplicável a ativos críticos (servidores, switches principais, links críticos).

**Justificativa**: Ativos P1 impactam operação, requerem resposta rápida e resolução completa no mesmo dia.

**Validação**:
```sql
ALTER TABLE [sla_operacao] ADD CONSTRAINT [chk_meta_p1]
CHECK (
    meta_resposta_p1 <= INTERVAL '2 hours' AND
    meta_resposta_p1 < meta_resolucao_p1 AND
    meta_resolucao_p1 <= INTERVAL '4 hours' AND
    meta_resolucao_p1 < meta_atendimento_p1 AND
    meta_atendimento_p1 <= INTERVAL '8 hours'
);
```

**Exemplos**:
- P1: Servidor de produção down → 2h resposta, 4h resolução.
- P1: Switch core offline → 2h resposta, 4h resolução.

---

### RN-SLA-028-07: Metas de SLA para Prioridade P2 (Alto)

**Descrição**: Prioridade P2 define metas: 4 horas resposta, 8 horas resolução, 24 horas atendimento. Aplicável a ativos importantes (estações críticas, impressoras em áreas críticas).

**Justificativa**: Ativos P2 impactam áreas importantes mas não críticas. Permitem resolução em turno subsequente.

**Validação**:
```sql
ALTER TABLE [sla_operacao] ADD CONSTRAINT [chk_meta_p2]
CHECK (
    meta_resposta_p2 <= INTERVAL '4 hours' AND
    meta_resposta_p2 < meta_resolucao_p2 AND
    meta_resolucao_p2 <= INTERVAL '8 hours' AND
    meta_resolucao_p2 < meta_atendimento_p2 AND
    meta_atendimento_p2 <= INTERVAL '24 hours'
);
```

**Exemplos**:
- P2: Estação de trabalho de gerente → 4h resposta, 8h resolução.
- P2: Impressora em área crítica → 4h resposta, 8h resolução.

---

### RN-SLA-028-08: Metas de SLA para Prioridade P3 (Médio)

**Descrição**: Prioridade P3 define metas: 8 horas resposta, 24 horas resolução, 48 horas atendimento. Aplicável a ativos padrão (computadores pessoais, monitores).

**Justificativa**: Ativos P3 são genéricos. Permitem resposta no turno seguinte e resolução em até 2 dias.

**Validação**:
```sql
ALTER TABLE [sla_operacao] ADD CONSTRAINT [chk_meta_p3]
CHECK (
    meta_resposta_p3 <= INTERVAL '8 hours' AND
    meta_resposta_p3 < meta_resolucao_p3 AND
    meta_resolucao_p3 <= INTERVAL '24 hours' AND
    meta_resolucao_p3 < meta_atendimento_p3 AND
    meta_atendimento_p3 <= INTERVAL '48 hours'
);
```

**Exemplos**:
- P3: Computador pessoal → 8h resposta, 24h resolução.
- P3: Monitor → 8h resposta, 24h resolução.

---

### RN-SLA-028-09: Metas de SLA para Prioridade P4 (Baixo)

**Descrição**: Prioridade P4 define metas: 24 horas resposta, 72 horas resolução, 5 dias atendimento. Aplicável a ativos não essenciais (periféricos, cabos).

**Justificativa**: Ativos P4 não impactam operação. Permitem resolução em sua conveniência dentro de 5 dias úteis.

**Validação**:
```sql
ALTER TABLE [sla_operacao] ADD CONSTRAINT [chk_meta_p4]
CHECK (
    meta_resposta_p4 <= INTERVAL '24 hours' AND
    meta_resposta_p4 < meta_resolucao_p4 AND
    meta_resolucao_p4 <= INTERVAL '72 hours' AND
    meta_resolucao_p4 < meta_atendimento_p4 AND
    meta_atendimento_p4 <= INTERVAL '5 days'
);
```

**Exemplos**:
- P4: Cabo de rede → 24h resposta, 72h resolução.
- P4: Perifério → 24h resposta, 72h resolução.

---

### RN-SLA-028-10: Multi-tenancy por ClienteId Obrigatório

**Descrição**: Toda operação de SLA deve incluir ClienteId obrigatoriamente. Dados de um cliente nunca são visíveis para outro cliente. Isolamento em nível de banco.

**Justificativa**: Atende LGPD, ISO 27001. Garante que dados de cliente A não vazam para cliente B mesmo em caso de bug.

**Implementação**:
```csharp
public class SLAOperacaoRepository
{
    public async Task<SLAOperacao> ObterPorIdAsync(
        long id,
        Guid clienteId,
        CancellationToken cancellationToken)
    {
        return await _context.SLAOperacao
            .AsNoTracking()
            .Where(s => s.Id == id && s.ClienteId == clienteId)
            .FirstOrDefaultAsync(cancellationToken)
            ?? throw new EntidadeNaoEncontradaException($"SLA {id} não encontrado");
    }

    public async Task<PagedResult<SLAOperacao>> ListarPorClienteAsync(
        Guid clienteId,
        int pagina,
        int registrosPorPagina,
        CancellationToken cancellationToken)
    {
        var query = _context.SLAOperacao
            .AsNoTracking()
            .Where(s => s.ClienteId == clienteId && !s.IsDeleted);

        var total = await query.CountAsync(cancellationToken);
        var registros = await query
            .Skip((pagina - 1) * registrosPorPagina)
            .Take(registrosPorPagina)
            .OrderByDescending(s => s.DataCriacao)
            .ToListAsync(cancellationToken);

        return new PagedResult<SLAOperacao> { Total = total, Items = registros };
    }
}
```

**Exemplos**:
- ClienteId = A tenta acessar SLA de ClienteId = B → acesso negado.
- Filtro automático em todas as queries.

---

### RN-SLA-028-11: Soft Delete com IsDeleted Flag

**Descrição**: Exclusão lógica via flag IsDeleted = true. Nunca deleta permanentemente da base. Permite auditoria futura e recovery.

**Justificativa**: LGPD, auditoria regulatória, compliance. Histórico de SLAs deletados deve ser rastreável.

**Implementação**:
```csharp
public class SLAOperacaoService
{
    public async Task DeletarAsync(long id, Guid clienteId, CancellationToken cancellationToken)
    {
        var sla = await _repository.ObterPorIdAsync(id, clienteId, cancellationToken);

        sla.IsDeleted = true;
        sla.DataDelecao = DateTimeOffset.UtcNow;
        sla.UsuarioDeletouId = _usuarioAtual.Id;

        _context.SLAOperacao.Update(sla);
        await _context.SaveChangesAsync(cancellationToken);

        await _auditoria.RegistrarEvento(
            "SLA_OPERACAO_DELETADO",
            id,
            new { clienteId, motivoDelecao = "Soft delete" });
    }

    // Listagem padrão exclui deletados
    public async Task<List<SLAOperacao>> ListarAsync(
        Guid clienteId,
        CancellationToken cancellationToken)
    {
        return await _context.SLAOperacao
            .Where(s => s.ClienteId == clienteId && !s.IsDeleted)
            .ToListAsync(cancellationToken);
    }
}
```

**Exemplos**:
- DELETE /api/sla-operacoes/5 marca IsDeleted = true.
- GET /api/sla-operacoes não retorna SLAs deletados.
- SELECT * WHERE IsDeleted = true retorna auditoria.

---

### RN-SLA-028-12: Integração com BrasilAPI para Feriados Nacionais

**Descrição**: Sistema consulta BrasilAPI (https://brasilapi.com.br/api/feriados/v1/2024) para obter feriados nacionais e estaduais. Feriados são automaticamente excluídos do cálculo de SLA.

**Justificativa**: Evita contar tempo em feriados (de lei) como tempo de SLA. Garante justiça ao cliente.

**Implementação**:
```csharp
public class FeriadoService
{
    private const string BRASIL_API_URL = "https://brasilapi.com.br/api/feriados/v1";

    public async Task<IEnumerable<Feriado>> ObterFeriadosPorAnoAsync(
        int ano,
        string uf,
        CancellationToken cancellationToken)
    {
        try
        {
            using var client = new HttpClient();
            var url = $"{BRASIL_API_URL}/{ano}";

            var response = await client.GetAsync(url, cancellationToken);
            response.EnsureSuccessStatusCode();

            var json = await response.Content.ReadAsStringAsync(cancellationToken);
            var feriados = JsonSerializer.Deserialize<List<FeriadoDto>>(json);

            return feriados
                .Where(f => string.IsNullOrEmpty(uf) || f.State == uf || f.State == null)
                .Select(f => new Feriado
                {
                    Data = DateOnly.Parse(f.Date),
                    Nome = f.Name,
                    Tipo = f.Type == "national" ? TipoFeriado.Nacional : TipoFeriado.Estadual,
                    UF = f.State
                })
                .ToList();
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Erro ao consultar BrasilAPI feriados");
            // Fallback: usar feriados em cache
            return await _cache.ObterFeriadosEmCacheAsync(ano, cancellationToken);
        }
    }

    public async Task<bool> EhFeriadoAsync(
        DateOnly data,
        string uf,
        CancellationToken cancellationToken)
    {
        var feriados = await ObterFeriadosPorAnoAsync(data.Year, uf, cancellationToken);
        return feriados.Any(f => f.Data == data);
    }
}
```

**Exemplos**:
- 25/12 (Natal) não conta em SLA de nenhuma empresa.
- 20/11 (Consciência Negra) em alguns estados não conta.
- BrasilAPI consultada anualmente e cacheada.

---

## 3. REFERÊNCIAS AO LEGADO

### 3.1 Banco de Dados Legado

**Banco**: `ic1_legado`

**Tabela Principal**: `SLAOperacao`
```sql
CREATE TABLE [dbo].[SLAOperacao](
    [Id] [int] IDENTITY(1,1) NOT NULL,
    [Nome] [varchar](100) NOT NULL,
    [Descricao] [varchar](500) NULL,
    [MetaRespostaP1] [int] NOT NULL, -- minutos
    [MetaRespostaP2] [int] NOT NULL,
    [MetaRespostaP3] [int] NOT NULL,
    [MetaRespostaP4] [int] NOT NULL,
    [MetaResolucaoP1] [int] NOT NULL,
    [MetaResolucaoP2] [int] NOT NULL,
    [MetaResolucaoP3] [int] NOT NULL,
    [MetaResolucaoP4] [int] NOT NULL,
    [MetaAtendimentoP1] [int] NOT NULL,
    [MetaAtendimentoP2] [int] NOT NULL,
    [MetaAtendimentoP3] [int] NOT NULL,
    [MetaAtendimentoP4] [int] NOT NULL,
    [IdCalendario] [int] NOT NULL,
    [DataCriacao] [datetime] NOT NULL,
    [UsuarioCriacao] [varchar](50) NOT NULL,
    [DataAlteracao] [datetime] NULL,
    [UsuarioAlteracao] [varchar](50) NULL,
    [IdEmpresa] [int] NOT NULL,
    CONSTRAINT [PK_SLAOperacao] PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [FK_SLAOperacao_Calendario] FOREIGN KEY ([IdCalendario]) REFERENCES [Calendario]([Id]),
    CONSTRAINT [FK_SLAOperacao_Empresa] FOREIGN KEY ([IdEmpresa]) REFERENCES [Empresa]([Id])
)
```

**Campos Importantes**:

| Campo Legado | Descrição | Uso no Modernizado |
|--------------|-----------|-------------------|
| `Id` | Chave primária | SLAOperacao.Id (mapeado) |
| `Nome` | Nome descritivo | SLAOperacao.Nome |
| `MetaRespostaP1-P4` | Metas em minutos | SLAOperacao.MetaResposta (TimeSpan) |
| `IdCalendario` | FK para Calendario | SLAOperacao.CalendarioId (FK) |
| `IdEmpresa` | FK para Empresa | SLAOperacao.ClienteId (FK para Cliente) |
| `DataCriacao/Alteracao` | Timestamps | Auditoria.DataCriacao / DataAlteracao |

### 3.2 Stored Procedures Legado

| Procedure | Descrição | Migração |
|-----------|-----------|----------|
| `pa_CalculaSLA` | Calcula SLA consumido para uma OS | Query Handler `CalcularSLAConsumidoQuery` |
| `pa_ListarSLAOperacao` | Lista SLAs da empresa | Query Handler `ListarSLAOperacaoQuery` |
| `pa_InsertSLAOperacao` | Insere novo SLA | Command Handler `CriarSLAOperacaoCommand` |
| `pa_UpdateSLAOperacao` | Atualiza SLA existente | Command Handler `AtualizarSLAOperacaoCommand` |

### 3.3 Telas ASPX

| Página | Descrição | Tela Moderna |
|--------|-----------|--------------|
| `SLAOperacao.aspx` | Formulário de criar/editar SLA | `/sla-operacoes/novo`, `/sla-operacoes/{id}/editar` |
| `SLAOperacaoLista.aspx` | Listagem de SLAs | `/sla-operacoes` (com filtros) |
| `SLAOperacaoConsulta.aspx` | Consulta de SLA de uma OS | `/sla-operacoes/{id}/calcular` |

### 3.4 WebServices Legado (VB.NET)

**Arquivo**: `D:\IC2\ic1_legado\WebService\WSSLA.asmx.vb`

| Método | Descrição | Endpoint Moderno |
|--------|-----------|-----------------|
| `ListarSLAOperacao(idEmpresa)` | Retorna lista de SLAs | GET /api/sla-operacoes |
| `ObterSLAOperacao(id)` | Retorna SLA por ID | GET /api/sla-operacoes/{id} |
| `CriarSLAOperacao(nome, metas)` | Cria novo SLA | POST /api/sla-operacoes |
| `AtualizarSLAOperacao(id, dados)` | Atualiza SLA | PUT /api/sla-operacoes/{id} |
| `DeletarSLAOperacao(id)` | Marca como deletado | DELETE /api/sla-operacoes/{id} |
| `CalcularSLAOS(idOS)` | Calcula SLA de uma OS | GET /api/sla-operacoes/{id}/calcular |

---

## 4. INTEGRAÇÕES OBRIGATÓRIAS

### 4.1 Central de Funcionalidades (Feature Flags)

**FeatureKey**: `SLA_OPERACOES_GESTAO`

**Configuração**:
```json
{
    "featureKey": "SLA_OPERACOES_GESTAO",
    "nome": "Gestão de SLA - Operações",
    "descricao": "Habilita criação, leitura, atualização e exclusão de SLAs para operações de ativos",
    "habilitado": true,
    "isSystemFeature": false,
    "modulo": "ServiceDesk",
    "condicoes": {
        "clienteIds": ["*"]
    }
}
```

**FeatureKey**: `SLA_OPERACOES_ALERTAS`

**Configuração**:
```json
{
    "featureKey": "SLA_OPERACOES_ALERTAS",
    "nome": "Alertas de SLA em Cascata",
    "descricao": "Habilita alertas automáticos em 50%, 75%, 90%, 100% de SLA consumido",
    "habilitado": true,
    "isSystemFeature": false,
    "modulo": "ServiceDesk"
}
```

**FeatureKey**: `SLA_OPERACOES_ESCALACAO`

**Configuração**:
```json
{
    "featureKey": "SLA_OPERACOES_ESCALACAO",
    "nome": "Escalação Automática de SLA",
    "descricao": "Habilita escalação automática quando SLA está em risco (75%+)",
    "habilitado": true,
    "isSystemFeature": false,
    "modulo": "ServiceDesk"
}
```

**Nota**: Features podem ser desabilitadas por cliente para testes ou manutenção.

---

### 4.2 Internacionalização (i18n)

**Chaves de Tradução**:

```json
{
    "sla": {
        "operacoes": {
            "title": "Gestão de SLA - Operações",
            "description": "Configure metas de SLA para operações de ativos",
            "breadcrumb": "SLA Operações",
            "novo": "Novo SLA",
            "editar": "Editar SLA",
            "listar": "SLAs de Operações",
            "form": {
                "nome": "Nome do SLA",
                "nomeHelper": "Ex: SLA Padrão Produção",
                "descricao": "Descrição",
                "descricaoHelper": "Descreva o propósito deste SLA",
                "calendario": "Calendário de Atendimento",
                "calendarioHelper": "Selecione 24x7, Comercial ou Dias Úteis",
                "metaRespostaP1": "Meta Resposta P1 (horas)",
                "metaRespostaP1Helper": "Padrão: 2 horas",
                "metaResolucaoP1": "Meta Resolução P1 (horas)",
                "metaResolucaoP1Helper": "Padrão: 4 horas",
                "metaAtendimentoP1": "Meta Atendimento P1 (horas)",
                "metaAtendimentoP1Helper": "Padrão: 8 horas"
            },
            "messages": {
                "success": "SLA salvo com sucesso",
                "successCreate": "SLA criado com sucesso",
                "successUpdate": "SLA atualizado com sucesso",
                "successDelete": "SLA deletado com sucesso",
                "error": "Erro ao salvar SLA"
            },
            "validation": {
                "required": "Campo obrigatório",
                "minLength": "Mínimo {{min}} caracteres",
                "maxLength": "Máximo {{max}} caracteres",
                "invalidHierarchy": "Tempo resposta < resolução < atendimento"
            }
        }
    }
}
```

---

### 4.3 Auditoria

**Operações Auditadas**:

| Operacao | Codigo | Dados Registrados |
|----------|--------|-------------------|
| Criar SLA | `SLA_OP_CREATE` | Nome, metas (P1-P4), calendário, responsável |
| Atualizar SLA | `SLA_OP_UPDATE` | Campos alterados (before/after), motivo |
| Deletar SLA | `SLA_OP_DELETE` | ID deletado, motivo, data, usuário |
| Calcular SLA | `SLA_OP_CALC` | OS ID, percentual consumido, tempo produtivo |
| Pausar SLA | `SLA_OP_PAUSE` | OS ID, tipo pausa, motivo, duração |
| Retomar SLA | `SLA_OP_RESUME` | OS ID, duração pausa anterior |
| Escalar SLA | `SLA_OP_ESCALATE` | OS ID, nível anterior/novo, motivo |
| Alerta de SLA | `SLA_OP_ALERT` | OS ID, percentual alerta, severidade |
| Versionar SLA | `SLA_OP_VERSION` | ID novo SLA, campos alterados, data vigência |

**Retenção**: 10 anos (conforme Lei de Proteção de Dados + conformidade ISO 27001 e SOC 2).

---

### 4.4 Controle de Acesso (RBAC)

**Permissões**:

| Permissão | Descrição | Perfis |
|-----------|-----------|--------|
| `sla:operacoes:create` | Criar novo SLA | Gerente Técnico, Admin Tenant |
| `sla:operacoes:read` | Visualizar SLAs | Todos |
| `sla:operacoes:update` | Editar SLA existente | Gerente Técnico, Admin Tenant |
| `sla:operacoes:delete` | Deletar SLA (soft delete) | Gerente Técnico, Admin Tenant |
| `sla:operacoes:export` | Exportar dados de SLA | Gerente Técnico, Admin Tenant, Manager |
| `sla:operacoes:metrics` | Acessar relatórios e métricas | Manager, Gerente Técnico, Admin Tenant |
| `sla:operacoes:pause` | Pausar SLA manualmente | Gerente Técnico, Level 2, Level 3 |
| `sla:operacoes:resume` | Retomar SLA pausado | Gerente Técnico, Level 2, Level 3 |
| `sla:operacoes:escalate` | Escalar SLA manualmente | Gerente Técnico, Level 3, Manager |

**Nota**: Permissões são verificadas em controller via atributo `[Authorize(Policy = "sla:operacoes:read")]`. Multi-tenancy garantido via filter `ClienteId` em todas as queries.

---

## 5. ENDPOINTS DA API

### 5.1 CRUD Principal

| Método | Endpoint | Descrição | Permissão |
|--------|----------|-----------|-----------|
| GET | `/api/sla-operacoes` | Listar SLAs da empresa | `sla:operacoes:read` |
| GET | `/api/sla-operacoes/{id}` | Obter SLA por ID | `sla:operacoes:read` |
| POST | `/api/sla-operacoes` | Criar novo SLA | `sla:operacoes:create` |
| PUT | `/api/sla-operacoes/{id}` | Atualizar SLA | `sla:operacoes:update` |
| DELETE | `/api/sla-operacoes/{id}` | Deletar SLA (soft delete) | `sla:operacoes:delete` |

### 5.2 Operações Especiais

| Método | Endpoint | Descrição | Permissão |
|--------|----------|-----------|-----------|
| GET | `/api/sla-operacoes/{id}/calcular` | Calcular SLA de uma OS | `sla:operacoes:read` |
| POST | `/api/sla-operacoes/{id}/pausar` | Pausar SLA manualmente | `sla:operacoes:pause` |
| POST | `/api/sla-operacoes/{id}/retomar` | Retomar SLA pausado | `sla:operacoes:resume` |
| POST | `/api/sla-operacoes/{id}/escalar` | Escalar SLA manualmente | `sla:operacoes:escalate` |
| GET | `/api/sla-operacoes/dashboard/compliance` | Dashboard compliance SLA | `sla:operacoes:metrics` |
| GET | `/api/sla-operacoes/dashboard/violacoes` | SLAs estourados | `sla:operacoes:metrics` |
| GET | `/api/sla-operacoes/dashboard/em-risco` | SLAs em risco (75%+) | `sla:operacoes:metrics` |
| POST | `/api/sla-operacoes/{id}/versionar` | Criar nova versão de SLA | `sla:operacoes:update` |
| GET | `/api/sla-operacoes/{id}/versoes` | Listar versões históricas | `sla:operacoes:read` |
| GET | `/api/sla-operacoes/export/excel` | Exportar SLAs em Excel | `sla:operacoes:export` |
| GET | `/api/sla-operacoes/export/pdf` | Exportar relatório em PDF | `sla:operacoes:export` |
| GET | `/api/sla-operacoes/metricas` | Métricas gerenciais (KPIs) | `sla:operacoes:metrics` |
| GET | `/api/sla-operacoes/alertas` | Listar alertas ativos | `sla:operacoes:read` |

---

## 6. FLUXOS PRINCIPAIS

### 6.1 Fluxo de Cálculo de SLA

```
Ordem de Serviço Aberta
    |
    v
Validar Tipo Ativo → Obter Prioridade (P1-P4)
    |
    v
Selecionar SLA Aplicável
    |
    v
Iniciar Cronômetro SLA
    |
    +--- Fora de Horário? → Pausar SLA Automaticamente
    |
    v (Dentro de Horário)
Calcular Tempo Produtivo (exclui pausas, feriados)
    |
    v
Calcular % Consumido = (Tempo Produtivo / Meta) * 100
    |
    +--- >= 50%? → Gerar Alerta (Informativo)
    |
    +--- >= 75%? → Gerar Alerta (Aviso) + Notificar Level 2
    |
    +--- >= 90%? → Gerar Alerta (Crítico) + Escalar para Level 3
    |
    +--- >= 100%? → Gerar Alerta (Violação) + Escalar para Manager
    |
    v
Registrar Evento de Cálculo (Auditoria)
    |
    v
Atualizar Dashboard SignalR (tempo real)
    |
    v
OS Resolvida → Registrar SLA Finalizado
    |
    v
Calcular Metrics (compliance, tempo médio, etc)
    |
    v
Fim
```

### 6.2 Fluxo de Escalação Automática

```
SLA em Risco Detectado (75%+)
    |
    v
Verificar Nível Atual (L1, L2, L3, Manager)
    |
    +--- L1 (técnico)?
    |    |
    |    v
    |    Escalar para L2 (especialista)
    |    |
    |    v
    |    Notificar L2 por Email + SMS
    |    |
    |    v
    |    Registrar Escalação (Auditoria)
    |
    +--- L2 (especialista)?
    |    |
    |    v
    |    Se SLA >= 90%: Escalar para L3 (gerente)
    |    Senão: Manter L2 com alert
    |
    +--- L3 (gerente)?
    |    |
    |    v
    |    Se SLA >= 100%: Escalar para Manager
    |    Senão: Manter L3 com alert crítico
    |
    +--- Manager?
    |    |
    |    v
    |    SLA Violado - Registrar Violação
    |    Gerar Ticket de Compensação para Cliente
    |    Notificar Diretoria por Email
    |
    v
Atualizar Dashboard com Nova Atribuição
    |
    v
Fim
```

### 6.3 Fluxo de Pausa Automática

```
Sistema Detecta Mudança de Horário
    |
    v
Saiu de Horário de Atendimento?
    |
    +--- SIM
    |    |
    |    v
    |    Verificar se existe pausa ativa
    |    |
    |    +--- NÃO tem pausa
    |    |    |
    |    |    v
    |    |    Criar PausaSLA(TipoPausa=ForaHorario)
    |    |    DataInicio = agora
    |    |    DataFim = NULL
    |    |
    |    +--- JÁ tem pausa
    |    |    |
    |    |    v
    |    |    Ignorar (já pausado)
    |    |
    |    v
    |    Registrar Evento: SLA_PAUSADO_AUTOMATICO
    |    |
    |    v
    |    Notificar Responsável (opcional)
    |
    +--- NÃO (voltou para horário)
    |    |
    |    v
    |    Verificar se existe pausa ativa de "ForaHorario"
    |    |
    |    +--- SIM
    |    |    |
    |    |    v
    |    |    Fechar pausa: DataFim = agora
    |    |    Registrar Evento: SLA_RETOMADO_AUTOMATICO
    |    |    Recalcular % consumido com nova pausa
    |    |    Verificar se precisa gerar novos alertas
    |    |
    |    +--- NÃO
    |    |    |
    |    |    v
    |    |    Ignorar (já retomado)
    |
    v
Atualizar Dashboard
    |
    v
Fim
```

---

## 7. SEGURANÇA

### 7.1 Proteções Implementadas

| Proteção | Descrição |
|----------|-----------|
| **RBAC (Role-Based Access Control)** | Permissões granulares (sla:operacoes:*) verificadas em todos os endpoints |
| **Multi-tenancy (ClienteId)** | Isolamento de dados por cliente via filter automático em todas as queries |
| **Soft Delete** | Exclusão lógica com IsDeleted flag, auditoria completa |
| **Auditoria Completa** | Todos os eventos (CREATE, UPDATE, DELETE, CALC, PAUSE, ESCALATE) registrados |
| **SQL Injection Protection** | Entity Framework com parameterized queries, sem SQL dinâmico |
| **XSS Protection** | Angular sanitize + Content Security Policy headers |
| **CSRF Protection** | Anti-forgery tokens em POST/PUT/DELETE |
| **Data Encryption** | Dados sensíveis criptografados em repouso (AES-256) |
| **Rate Limiting** | Limite de 100 requisições por minuto por IP |
| **Input Validation** | Validação em cliente (Angular) + servidor (C#) com dados tipados |

### 7.2 Testes de Segurança Obrigatórios

- [ ] SQL Injection em campos Nome, Descrição de SLA
- [ ] XSS em campos Nome, Descrição, Motivo pausa
- [ ] CSRF Protection em POST /api/sla-operacoes
- [ ] Validação de permissões (usuário sem sla:operacoes:read não vê dados)
- [ ] Multi-tenancy (ClienteId=A não vê dados de ClienteId=B)
- [ ] Soft delete (SLA deletado não aparece em listagem padrão)
- [ ] Rate limiting (> 100 req/min retorna 429)
- [ ] Validação de campos obrigatórios
- [ ] Validação de hierarquia de tempos (resposta < resolução < atendimento)
- [ ] Auditoria registra todas as operações

---

## 8. MÉTRICAS E INDICADORES

### 8.1 KPIs

| KPI | Meta | Medição |
|-----|------|---------|
| **Taxa de Compliance SLA** | >= 95% | (Operações no prazo / Total operações) * 100 |
| **Tempo Médio de Resposta** | <= Meta SLA | Média (DataResposta - DataAbertura) excluindo pausas |
| **Tempo Médio de Resolução** | <= Meta SLA | Média (DataResolução - DataAbertura) excluindo pausas |
| **% Violações SLA** | <= 5% | (Operações atrasadas / Total operações) * 100 |
| **Tempo de Escalação** | <= 30 min | Média (DataEscalacao - DataAlerta) |
| **Quantidade de Alertas Gerados** | >= 1 por violação | Total alertas / período |
| **Taxa de Reescalação** | <= 10% | (Operações escaladas 2+ vezes / Total escaladas) * 100 |
| **Disponibilidade da API** | >= 99.9% | Uptime / tempo total |
| **Performance de Cálculo SLA** | <= 100ms | P95 latency (GET /api/sla-operacoes/{id}/calcular) |
| **Taxa de Pausa Automática** | >= 80% | (Pausas automáticas / Total pausas) |

### 8.2 Alertas

| Alerta | Condição | Ação |
|--------|----------|------|
| **SLA Crítico (90%)** | Operação atinge 90% SLA | Escalar para Level 3, notificar por email + SMS |
| **SLA Violado (100%)** | Operação ultrapassa meta | Escalar para Manager, abrir ticket compensação |
| **Múltiplas Escalações** | OS escalada 3+ vezes | Notificar Diretor de Operações, análise root cause |
| **Taxa Compliance Baixa** | Taxa mensal < 90% | Gerar relatório para direção, planejar melhoria |
| **Feriado não Registrado** | Consulta BrasilAPI falha | Usar cache, notificar admin para sincronizar |
| **Calendário Inválido** | SLA sem calendário associado | Não permitir criar OS, notificar admin |
| **Pausa Longa** | Pausa > 24h | Notificar responsável, investigar motivo |
| **Integração com Feriados Falha** | BrasilAPI indisponível | Usar cache, log de erro, alerta admin |

---

## 9. PRÓXIMOS PASSOS

1. **Modelo de Dados**: Criar [MD-RF028](./MD-RF028.md) com DDL completo (SLAOperacao, PausaSLA, AlertaSLA, EscalacaoSLA, SLAOperacaoVersion)
2. **Casos de Uso**: Criar [UC-RF028](./UC-RF028.md) com 5 cenários (Criar SLA, Calcular SLA em Tempo Real, Pausar/Retomar, Escalação Automática, Gerar Relatório)
3. **Workflow UI**: Criar [WF-RF028](./WF-RF028.md) com telas Angular (Listagem, Formulário, Dashboard, Relatórios)
4. **User Stories**: Criar [user-stories.yaml](./user-stories.yaml) com mínimo 3 stories implementáveis
5. **Implementação Backend**: Commands/Queries/Handlers, Entity Framework migrations
6. **Implementação Frontend**: Angular components, services, rotas
7. **Testes Automatizados**: Tester-Backend validará contrato, Playwright E2E
8. **Documentação de Testes**: TC-RF028-BACKEND.md, TC-RF028-FRONTEND.md, TC-RF028-E2E.md

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 1.0 | 2025-12-28 | Versão inicial com 12 regras de negócio, 13 endpoints, fluxos e segurança | Claude Code |

---

**Última Atualização**: 2025-12-28
**Autor**: Claude Code
**Revisão**: Pendente de aprovação
