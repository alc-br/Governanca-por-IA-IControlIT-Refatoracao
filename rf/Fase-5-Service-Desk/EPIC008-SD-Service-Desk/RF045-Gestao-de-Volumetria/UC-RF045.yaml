uc:
  rf: RF045
  versao: '2.0'
  data: '2025-12-31'
casos_de_uso:
- id: UC00
  nome: Listar Registros Volumetria
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-02
    uc_items:
    - id: FP-UC00-001
      title: Usuário acessa Dashboard de Volumetria
      required: true
    - id: FP-UC00-002
      title: Sistema valida permissão volumetria.dashboard.view
      required: true
    - id: FP-UC00-003
      title: Sistema carrega snapshots volumétricos por data
      required: true
    - id: FP-UC00-004
      title: 'Sistema exibe grid: Data Captura, Total Ativos, Total Usuários, Total Contratos, Total Faturas, Crescimento
        (%)'
      required: true
    - id: FA-UC00-001
      title: Filtrar por período (últimos 7, 30, 90 dias)
      required: false
    - id: FA-UC00-002
      title: Ordenar por coluna
      required: false
    - id: FE-UC00-001
      title: Usuário sem permissão
      required: true
  precondicoes:
  - permissao: volumetria.dashboard.view
  gatilho: Usuario acessa Dashboard Volumetria
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessar_dashboard
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_snapshots_tenant
  - passo: 4
    ator: sistema
    acao: exibir_grid_volumetria
  fluxos_excecao:
  - id: FE-UC00-01
    condicao: sem_permissao
    resultado: erro_403_acesso_negado
  regras_aplicadas:
  - RN-RF045-01
  resultado_final:
    estado: lista_snapshots_exibida
- id: UC01
  nome: Capturar Volumetria Automática
  ator_principal: sistema
  tipo: acao
  impacta_dados: true
  covers:
    rf_items:
    - RF-VAL-03
    uc_items:
    - id: FP-UC01-001
      title: Job diário dispara às 02:00
      required: true
    - id: FP-UC01-002
      title: Sistema executa queries de contagem em tabelas core
      required: true
    - id: FP-UC01-003
      title: Sistema exclui health checks (/health, /ping, /metrics) da contagem
      required: true
    - id: FP-UC01-004
      title: Sistema registra snapshot em VolumetriaConsumo
      required: true
    - id: FP-UC01-005
      title: Sistema executa agregação hourly/daily/monthly
      required: true
    - id: FP-UC01-006
      title: Sistema deleta dados raw após agregação
      required: true
    - id: FE-UC01-001
      title: Falha em query de contagem
      required: true
  precondicoes: []
  gatilho: Job agendado (02:00 diário)
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: disparar_job_02h
  - passo: 2
    ator: sistema
    acao: executar_queries_contagem
  - passo: 3
    ator: sistema
    acao: excluir_health_checks
  - passo: 4
    ator: sistema
    acao: registrar_snapshot
  - passo: 5
    ator: sistema
    acao: agregar_dados
  - passo: 6
    ator: sistema
    acao: deletar_raw
  fluxos_excecao:
  - id: FE-UC01-01
    condicao: query_falha
    resultado: log_erro_retry_1h
  regras_aplicadas:
  - RN-RF045-01
  - RN-RF045-06
  - RN-RF045-08
  resultado_final:
    estado: snapshot_capturado_agregado
- id: UC02
  nome: Visualizar Volumetria
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-03
    uc_items:
    - id: FP-UC02-001
      title: Usuário seleciona snapshot na listagem
      required: true
    - id: FP-UC02-002
      title: Sistema valida permissão volumetria.detalhes.view
      required: true
    - id: FP-UC02-003
      title: Sistema exibe detalhes com breakdown por módulo
      required: true
    - id: FP-UC02-004
      title: Sistema exibe comparação com snapshot anterior (delta absoluto e %)
      required: true
    - id: FA-UC02-001
      title: Drill-down até request individual (últimos 7 dias)
      required: false
    - id: FE-UC02-001
      title: Usuário sem permissão
      required: true
  precondicoes:
  - permissao: volumetria.detalhes.view
  gatilho: Usuario seleciona snapshot
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: selecionar_snapshot
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_breakdown
  - passo: 4
    ator: sistema
    acao: calcular_delta
  - passo: 5
    ator: sistema
    acao: exibir_detalhes
  fluxos_alternativos:
  - id: FA-UC02-01
    condicao: usuario_drilldown
    resultado: exibir_requests_individuais_7_dias
  regras_aplicadas:
  - RN-RF045-14
  resultado_final:
    estado: detalhes_snapshot_exibidos
- id: UC03
  nome: Dashboard de Crescimento
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-02
    uc_items:
    - id: FP-UC03-001
      title: Usuário acessa Dashboard de Crescimento
      required: true
    - id: FP-UC03-002
      title: Sistema valida permissão volumetria.dashboard.view
      required: true
    - id: FP-UC03-003
      title: Sistema carrega dados agregados (últimos 90 dias)
      required: true
    - id: FP-UC03-004
      title: 'Sistema exibe gráfico de linha: Total registros por dia'
      required: true
    - id: FP-UC03-005
      title: 'Sistema exibe gráfico de barras empilhadas: Distribuição por módulo'
      required: true
    - id: FP-UC03-006
      title: 'Sistema calcula KPIs: Crescimento médio diário, projeção próximos 30 dias'
      required: true
    - id: FE-UC03-001
      title: Usuário sem permissão
      required: true
  precondicoes:
  - permissao: volumetria.dashboard.view
  gatilho: Usuario acessa Dashboard Crescimento
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessar_dashboard_crescimento
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_dados_90_dias
  - passo: 4
    ator: sistema
    acao: exibir_grafico_linha
  - passo: 5
    ator: sistema
    acao: exibir_grafico_barras
  - passo: 6
    ator: sistema
    acao: calcular_kpis
  regras_aplicadas:
  - RN-RF045-12
  resultado_final:
    estado: dashboard_crescimento_exibido
- id: UC04
  nome: Projetar Capacidade Futura
  ator_principal: usuario_autenticado
  tipo: acao
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-03
    uc_items:
    - id: FP-UC04-001
      title: Usuário acessa Projeção de Capacidade
      required: true
    - id: FP-UC04-002
      title: Sistema valida permissão volumetria.detalhes.view
      required: true
    - id: FP-UC04-003
      title: Sistema verifica se fornecedor tem >= 3 meses histórico
      required: true
    - id: FP-UC04-004
      title: Sistema aplica regressão linear (Azure ML)
      required: true
    - id: FP-UC04-005
      title: Sistema calcula crescimento médio últimos 6 meses
      required: true
    - id: FP-UC04-006
      title: Sistema projeta 12 meses futuros
      required: true
    - id: FP-UC04-007
      title: 'Sistema gera alertas de capacidade (ex: ''Banco atingirá 1M registros em 4 meses'')'
      required: true
    - id: FA-UC04-001
      title: '< 3 meses histórico: usar média simples'
      required: false
    - id: FE-UC04-001
      title: Usuário sem permissão
      required: true
  precondicoes:
  - permissao: volumetria.detalhes.view
  gatilho: Usuario acessa Projeção Capacidade
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessar_projecao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: verificar_historico
  - passo: 4
    ator: sistema
    acao: aplicar_ml
  - passo: 5
    ator: sistema
    acao: calcular_crescimento
  - passo: 6
    ator: sistema
    acao: projetar_12_meses
  - passo: 7
    ator: sistema
    acao: gerar_alertas
  fluxos_alternativos:
  - id: FA-UC04-01
    condicao: historico_insuficiente
    resultado: usar_media_simples
  regras_aplicadas:
  - RN-RF045-10
  resultado_final:
    estado: projecao_exibida_com_alertas
- id: UC05
  nome: Alertar Limite de Capacidade
  ator_principal: sistema
  tipo: acao
  impacta_dados: true
  covers:
    rf_items:
    - RF-VAL-01
    uc_items:
    - id: FP-UC05-001
      title: Job semanal verifica volumetria vs limites
      required: true
    - id: FP-UC05-002
      title: Sistema valida quota configurada por fornecedor
      required: true
    - id: FP-UC05-003
      title: Sistema calcula % consumo da quota
      required: true
    - id: FP-UC05-004
      title: 'Se >= 80% ou previsão esgotamento em 7 dias: notificar admin'
      required: true
    - id: FP-UC05-005
      title: Sistema registra alerta em VolumetriaAlerta
      required: true
    - id: FA-UC05-001
      title: Quota ilimitada (apenas Super Admin)
      required: false
    - id: FE-UC05-001
      title: Fornecedor sem quota configurada
      required: true
  precondicoes: []
  gatilho: Job semanal
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: disparar_job_semanal
  - passo: 2
    ator: sistema
    acao: validar_quota_fornecedor
  - passo: 3
    ator: sistema
    acao: calcular_percentual
  - passo: 4
    ator: sistema
    acao: verificar_thresholds
  - passo: 5
    ator: sistema
    acao: notificar_admin
  - passo: 6
    ator: sistema
    acao: registrar_alerta
  fluxos_excecao:
  - id: FE-UC05-01
    condicao: sem_quota
    resultado: erro_400_quota_obrigatoria
  regras_aplicadas:
  - RN-RF045-02
  - RN-RF045-03
  resultado_final:
    estado: alerta_enviado_registrado
- id: UC06
  nome: Relatório de Uso por Módulo
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-02
    uc_items:
    - id: FP-UC06-001
      title: Usuário acessa Relatório de Uso
      required: true
    - id: FP-UC06-002
      title: Sistema valida permissão volumetria.dashboard.view
      required: true
    - id: FP-UC06-003
      title: Sistema calcula distribuição percentual entre módulos
      required: true
    - id: FP-UC06-004
      title: 'Sistema exibe relatório comparativo: Ativos (35%), Faturas (25%), Contratos (20%), etc'
      required: true
    - id: FP-UC06-005
      title: Sistema identifica módulos subutilizados ou com crescimento acelerado
      required: true
    - id: FA-UC06-001
      title: Exportar relatório em CSV/Excel
      required: false
    - id: FE-UC06-001
      title: Usuário sem permissão
      required: true
  precondicoes:
  - permissao: volumetria.dashboard.view
  gatilho: Usuario acessa Relatorio Uso
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessar_relatorio
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: calcular_distribuicao
  - passo: 4
    ator: sistema
    acao: exibir_relatorio
  - passo: 5
    ator: sistema
    acao: identificar_tendencias
  fluxos_alternativos:
  - id: FA-UC06-01
    condicao: usuario_exporta
    resultado: gerar_csv_excel
  regras_aplicadas:
  - RN-RF045-11
  resultado_final:
    estado: relatorio_uso_exibido
- id: UC07
  nome: Comparar Volumetria entre Períodos
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-02
    uc_items:
    - id: FP-UC07-001
      title: Usuário acessa Comparação de Períodos
      required: true
    - id: FP-UC07-002
      title: Sistema valida permissão volumetria.detalhes.view
      required: true
    - id: FP-UC07-003
      title: Usuário seleciona períodos (mês a mês ou ano a ano)
      required: true
    - id: FP-UC07-004
      title: Sistema calcula deltas (absoluto e %)
      required: true
    - id: FP-UC07-005
      title: 'Sistema exibe tabela: Métrica, Jan 2024, Jan 2025, Δ absoluto, Δ %'
      required: true
    - id: FA-UC07-001
      title: Comparar trimestres ou semestres
      required: false
    - id: FE-UC07-001
      title: Usuário sem permissão
      required: true
  precondicoes:
  - permissao: volumetria.detalhes.view
  gatilho: Usuario acessa Comparação Períodos
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessar_comparacao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: usuario
    acao: selecionar_periodos
  - passo: 4
    ator: sistema
    acao: calcular_deltas
  - passo: 5
    ator: sistema
    acao: exibir_tabela_comparacao
  regras_aplicadas:
  - RN-RF045-13
  resultado_final:
    estado: comparacao_exibida
- id: UC08
  nome: Configurar Quota de Fornecedor
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RF-CRUD-01
    - RF-SEC-02
    uc_items:
    - id: FP-UC08-001
      title: Usuário acessa Configuração de Quotas
      required: true
    - id: FP-UC08-002
      title: Sistema valida permissão VOL.QUOTAS.CREATE
      required: true
    - id: FP-UC08-003
      title: 'Sistema exibe form: Fornecedor*, Quota_GB*, Quota_Requests*, Vigencia_Inicio*, Vigencia_Fim'
      required: true
    - id: FP-UC08-004
      title: Usuário preenche quotas obrigatórias
      required: true
    - id: FP-UC08-005
      title: Sistema valida quota >= 0 (0 = ilimitado apenas Super Admin)
      required: true
    - id: FP-UC08-006
      title: Sistema salva quota com EmpresaId
      required: true
    - id: FP-UC08-007
      title: Sistema registra auditoria VOL_QUOTA_CONFIGURADA
      required: true
    - id: FE-UC08-001
      title: Usuário não é Super Admin tentando quota ilimitada
      required: true
  precondicoes:
  - permissao: VOL.QUOTAS.CREATE
  gatilho: Usuario clica em Configurar Quota
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessar_config_quotas
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: exibir_form
  - passo: 4
    ator: usuario
    acao: preencher_quotas
  - passo: 5
    ator: sistema
    acao: validar_quota
  - passo: 6
    ator: sistema
    acao: salvar_quota
  - passo: 7
    ator: sistema
    acao: registrar_auditoria
  fluxos_excecao:
  - id: FE-UC08-01
    condicao: quota_ilimitada_sem_permissao
    resultado: erro_403_super_admin_required
  regras_aplicadas:
  - RN-RF045-02
  resultado_final:
    estado: quota_configurada
- id: UC09
  nome: Atualizar Limites e Quotas
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RF-CRUD-04
    - RF-SEC-02
    uc_items:
    - id: FP-UC09-001
      title: Usuário seleciona quota existente
      required: true
    - id: FP-UC09-002
      title: Sistema valida permissão VOL.QUOTAS.UPDATE
      required: true
    - id: FP-UC09-003
      title: Sistema exibe form preenchido com valores atuais
      required: true
    - id: FP-UC09-004
      title: Usuário altera quotas ou vigência
      required: true
    - id: FP-UC09-005
      title: Sistema valida se fornecedor não ultrapassou nova quota
      required: true
    - id: FP-UC09-006
      title: Sistema atualiza quota com versionamento
      required: true
    - id: FP-UC09-007
      title: Sistema registra auditoria VOL_QUOTA_ATUALIZADA
      required: true
    - id: FE-UC09-001
      title: Nova quota menor que consumo atual
      required: true
  precondicoes:
  - permissao: VOL.QUOTAS.UPDATE
  gatilho: Usuario clica em Editar Quota
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: selecionar_quota
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: exibir_form_preenchido
  - passo: 4
    ator: usuario
    acao: alterar_quotas
  - passo: 5
    ator: sistema
    acao: validar_consumo_atual
  - passo: 6
    ator: sistema
    acao: atualizar_com_versao
  - passo: 7
    ator: sistema
    acao: registrar_auditoria
  fluxos_excecao:
  - id: FE-UC09-01
    condicao: quota_menor_consumo
    resultado: erro_400_consumo_excede_quota
  regras_aplicadas:
  - RN-RF045-02
  - RN-RF045-04
  resultado_final:
    estado: quota_atualizada
- id: UC10
  nome: Exportar Dados de Volumetria
  ator_principal: usuario_autenticado
  tipo: acao
  impacta_dados: false
  covers:
    rf_items:
    - RF-CRUD-05
    - RF-VAL-02
    - RF-SEC-02
    uc_items:
    - id: FP-UC10-001
      title: Usuário clica em Exportar Volumetria
      required: true
    - id: FP-UC10-002
      title: Sistema valida permissão VOL.EXPORT
      required: true
    - id: FP-UC10-003
      title: 'Sistema exibe form: Periodo*, Fornecedor (opcional), Formato (CSV/Excel)'
      required: true
    - id: FP-UC10-004
      title: Usuário seleciona período e formato
      required: true
    - id: FP-UC10-005
      title: Sistema valida tamanho estimado (máx 1 GB)
      required: true
    - id: FP-UC10-006
      title: Sistema gera arquivo com isolamento multi-tenant
      required: true
    - id: FP-UC10-007
      title: Sistema disponibiliza download
      required: true
    - id: FP-UC10-008
      title: Sistema registra auditoria VOL_EXPORT_REALIZADO
      required: true
    - id: FE-UC10-001
      title: Tamanho estimado > 1 GB
      required: true
  precondicoes:
  - permissao: VOL.EXPORT
  gatilho: Usuario clica em Exportar
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: clicar_exportar
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: exibir_form
  - passo: 4
    ator: usuario
    acao: selecionar_opcoes
  - passo: 5
    ator: sistema
    acao: validar_tamanho
  - passo: 6
    ator: sistema
    acao: gerar_arquivo_isolado
  - passo: 7
    ator: sistema
    acao: disponibilizar_download
  - passo: 8
    ator: sistema
    acao: registrar_auditoria
  fluxos_excecao:
  - id: FE-UC10-01
    condicao: arquivo_muito_grande
    resultado: erro_400_reduzir_periodo
  regras_aplicadas:
  - RN-RF045-05
  resultado_final:
    estado: dados_exportados
- id: UC11
  nome: Aplicar Throttling Progressivo
  ator_principal: sistema
  tipo: acao
  impacta_dados: true
  covers:
    rf_items:
    - RF-SEC-03
    - RF-SEC-01
    uc_items:
    - id: FP-UC11-001
      title: Sistema monitora consumo em tempo real
      required: true
    - id: FP-UC11-002
      title: Sistema detecta 95% da quota atingida
      required: true
    - id: FP-UC11-003
      title: Sistema aplica rate limit de 50%
      required: true
    - id: FP-UC11-004
      title: Sistema detecta 99% da quota atingida
      required: true
    - id: FP-UC11-005
      title: Sistema aplica rate limit de 80%
      required: true
    - id: FP-UC11-006
      title: Sistema detecta 100% da quota atingida
      required: true
    - id: FP-UC11-007
      title: Sistema bloqueia POST/PUT/DELETE (GET permitido)
      required: true
    - id: FP-UC11-008
      title: Sistema registra auditoria VOL_THROTTLING_APLICADO
      required: true
    - id: FP-UC11-009
      title: Sistema garante isolamento (fornecedor A não afeta B)
      required: true
  precondicoes: []
  gatilho: Sistema detecta quota atingindo limites
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: monitorar_consumo
  - passo: 2
    ator: sistema
    acao: detectar_95_porcento
  - passo: 3
    ator: sistema
    acao: aplicar_limit_50
  - passo: 4
    ator: sistema
    acao: detectar_99_porcento
  - passo: 5
    ator: sistema
    acao: aplicar_limit_80
  - passo: 6
    ator: sistema
    acao: detectar_100_porcento
  - passo: 7
    ator: sistema
    acao: bloquear_modificacoes
  - passo: 8
    ator: sistema
    acao: registrar_auditoria
  - passo: 9
    ator: sistema
    acao: garantir_isolamento
  fluxos_excecao: []
  regras_aplicadas:
  - RN-RF045-04
  - RN-RF045-05
  resultado_final:
    estado: throttling_ativo
exclusions:
  uc_items: []
historico:
- versao: '2.0'
  data: '2025-12-31'
  autor: Agência ALC - alc.dev.br
  descricao: Versão YAML estruturado sincronizado com RF045.yaml v2.0. Criação inicial do UC.yaml para RF045 com 8 casos de
    uso (UC00-UC07).
