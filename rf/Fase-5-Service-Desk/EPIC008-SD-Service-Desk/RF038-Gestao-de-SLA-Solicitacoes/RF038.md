# RF038 - Gestão de SLA Solicitações

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC008-SD - Service Desk
**Fase**: Fase 5 - Service Desk

---

## 1. OBJETIVO DO REQUISITO

Implementar sistema completo de Service Level Agreement (SLA) para solicitações de serviços de TI, com cálculo automático de prazos, monitoramento em tempo real, alertas escalonados, escalação automática e gestão de exceções. O sistema deve garantir o cumprimento de prazos contratuais, transparência no atendimento e compliance com acordos de nível de serviço.

Este documento define **o que o sistema deve fazer** em termos de gestão de SLA, servindo como contrato oficial entre negócio, desenvolvimento e testes.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] Configuração de SLA por tipo de solicitação e prioridade
- [x] Cálculo automático de prazos considerando calendário e horário de atendimento
- [x] Monitoramento em tempo real de solicitações ativas
- [x] Alertas escalonados (50%, 80%, 100%, breach)
- [x] Escalação automática em caso de breach
- [x] Pausa e retomada de SLA com justificativa
- [x] Extensão de prazo com aprovação
- [x] Dashboard de monitoramento em tempo real
- [x] Relatórios de compliance e performance
- [x] Registro de não-conformidades
- [x] SLA diferenciado por nível de cliente
- [x] Notificações push (SignalR)
- [x] Análise de tendências e heatmap de horários críticos

### 2.2 Fora do escopo (não objetivos)

- Interface visual específica (design de telas)
- Tecnologia de implementação (framework, linguagem)
- Estratégia de deploy ou infraestrutura
- Integração com sistemas de terceiros (CRM, ERP)

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| **SLA** | Service Level Agreement - Acordo de Nível de Serviço que define prazo de atendimento |
| **Breach** | Violação de SLA quando prazo é ultrapassado sem resolução |
| **MTTR** | Mean Time To Resolution - Tempo médio de resolução |
| **Escalação** | Transferência automática de responsabilidade para nível superior |
| **Não-Conformidade** | Registro formal de descumprimento de SLA |
| **Horário de Atendimento** | Janela de tempo em que o suporte está disponível (8x5, 12x5, 24x7) |
| **Tenant** | Fornecedor/empresa isolado no sistema multi-tenant |

---

## 4. FUNCIONALIDADES COBERTAS

1. Configurar SLA por tipo de solicitação e prioridade
2. Calcular automaticamente data/hora limite de atendimento
3. Monitorar solicitações ativas em tempo real
4. Enviar alertas automáticos escalonados
5. Escalar automaticamente solicitações em breach
6. Pausar e retomar SLA com justificativa
7. Solicitar e aprovar extensões de prazo
8. Visualizar dashboard de monitoramento em tempo real
9. Gerar relatórios de compliance e MTTR
10. Registrar e tratar não-conformidades
11. Configurar SLA diferenciado por nível de cliente
12. Enviar notificações push para supervisores

---

## 5. REGRAS DE NEGÓCIO

### RN-RF038-001 — Cálculo de Prazo de SLA

**Descrição**: O prazo de atendimento é calculado automaticamente com base em tipo de solicitação, prioridade, horário de atendimento e calendário de feriados.

**Justificativa**: Garantir que prazos sejam consistentes e considerem apenas horário comercial efetivo.

**Critério de Aceite**:
- Tipo de solicitação DEVE ter SLA configurado
- Prazo DEVE considerar apenas dias/horas úteis conforme horário de atendimento
- Feriados DEVEM ser excluídos do cálculo
- Data limite DEVE ser recalculada em caso de pausa/retomada

**Exemplo**:
```
Solicitação criada: 14/01/2025 16:00 (terça)
Tipo: Incidente de Sistema
Prioridade: Alta
SLA configurado: 8 horas úteis
Horário: 08:00-18:00 (seg-sex)

Cálculo:
14/01 16:00→18:00 = 2h
15/01 08:00→14:00 = 6h
Data limite: 15/01/2025 14:00
```

---

### RN-RF038-002 — Alertas Escalonados por Proximidade do Prazo

**Descrição**: Sistema envia alertas automáticos em 4 níveis conforme prazo se aproxima.

**Critério de Aceite**:
- 50% do prazo → alerta ao atendente responsável
- 80% do prazo → alerta ao supervisor + flag amarelo
- 100% do prazo → alerta ao gerente + flag vermelho + escalação
- Breach → alerta ao diretor + não-conformidade
- Alertas NÃO DEVEM duplicar (controle no banco)
- Apenas solicitações em aberto DEVEM disparar alertas

---

### RN-RF038-003 — Escalação Automática em Caso de Breach

**Descrição**: Solicitação que ultrapassa prazo sem resolução é automaticamente escalada para próximo nível.

**Critério de Aceite**:
- Ao atingir 100% do prazo, verificar regra de escalação
- Se regra existe, reassignar para nível superior
- Notificar todos os envolvidos (original, supervisor, novo responsável)
- Registrar escalação na auditoria com timestamp e motivo
- Regra de escalação DEVE estar configurada
- Novo responsável DEVE estar ativo e disponível
- Solicitação NÃO pode estar pausada

---

### RN-RF038-004 — Pausa e Retomada de SLA

**Descrição**: Sistema permite pausar temporariamente cálculo de SLA em situações específicas.

**Justificativa**: Evitar penalização por fatores externos fora do controle.

**Critério de Aceite**:
- Motivo da pausa é OBRIGATÓRIO (mín. 10 caracteres)
- Durante pausa, tempo NÃO é contabilizado
- Ao retomar, recalcular data limite considerando tempo já decorrido
- Histórico completo de pausas/retomadas DEVE ser registrado
- Apenas usuários com permissão PODEM pausar/retomar
- Solicitação NÃO pode estar finalizada
- NÃO permitir múltiplas pausas simultâneas

**Exemplo**:
```
Criada: 14/01 10:00 | SLA: 16h úteis | Prazo: 15/01 18:00
Pausada: 14/01 14:00 (4h decorridas, 12h restantes)
Retomada: 16/01 09:00
Novo prazo: 16/01 09:00 + 12h = 17/01 13:00
```

---

### RN-RF038-005 — Horário de Atendimento por Tipo de Solicitação

**Descrição**: Cada tipo de solicitação pode ter horário de atendimento específico.

**Justificativa**: Diferentes serviços têm diferentes níveis de criticidade e disponibilidade.

**Critério de Aceite**:
- Tipos disponíveis: 8x5, 12x5, 24x7, Customizado
- **8x5**: Segunda a sexta, 08:00-17:00
- **12x5**: Segunda a sexta, 07:00-19:00
- **24x7**: Todos os dias, 24 horas
- **Customizado**: Definir manualmente dias e horários
- Horário inicial DEVE ser menor que final
- Ao menos 1 dia da semana DEVE estar ativo
- Horário customizado DEVE ter mínimo 4h/dia

---

### RN-RF038-006 — Calendário de Feriados Corporativos

**Descrição**: Sistema permite cadastrar feriados que são excluídos do cálculo de SLA.

**Critério de Aceite**:
- Tipos de feriados: Nacional, Estadual, Municipal, Corporativo
- Feriados podem ser recorrentes ou pontuais
- Nome do feriado é OBRIGATÓRIO
- Data NÃO pode ser no passado (novos cadastros)
- Ao calcular SLA, sistema DEVE pular feriados automaticamente
- Permitir importação de calendários externos (Google, Outlook)

---

### RN-RF038-007 — Extensão de Prazo com Justificativa

**Descrição**: Supervisores/gerentes podem solicitar extensão de prazo com justificativa e aprovação.

**Critério de Aceite**:
- Novo prazo DEVE ser maior que prazo original
- Justificativa OBRIGATÓRIA (mín. 20 caracteres)
- Apenas 1 extensão pendente por solicitação
- Máximo 2 extensões por solicitação
- Aprovador recebe notificação
- Se aprovado, novo prazo é aplicado e alertas recalculados
- Histórico completo de extensões registrado

---

### RN-RF038-008 — Dashboard de Monitoramento em Tempo Real

**Descrição**: Dashboard centralizado exibe status de solicitações ativas com indicadores visuais.

**Critério de Aceite**:
- Cores por proximidade do prazo:
  - Verde: 0-50%
  - Amarelo: 50-80%
  - Vermelho: 80-100%
  - Preto: Breach
- Filtros por: prioridade, tipo, atendente, status
- Ordenação: prazo mais próximo primeiro
- Auto-refresh a cada 60 segundos (SignalR)
- Apenas solicitações em aberto exibidas
- Dashboard DEVE respeitar multi-tenancy
- Dados cacheados por 30s para performance

---

### RN-RF038-009 — Relatório de Taxa de Cumprimento de SLA

**Descrição**: Relatório exibindo % de solicitações resolvidas dentro do prazo.

**Critério de Aceite**:
- Cálculo: (Dentro do prazo / Total finalizadas) × 100
- Detalhamento por: tipo, prioridade, atendente, período
- Comparação com períodos anteriores (MoM, YoY)
- Exportação em PDF, Excel, CSV
- Período DEVE ser válido (máx. 24 meses no passado)
- Dados consolidados e cacheados para performance

---

### RN-RF038-010 — Notificações Push para Supervisores (SignalR)

**Descrição**: Supervisores recebem notificações em tempo real sobre eventos críticos.

**Critério de Aceite**:
- Eventos que disparam notificação:
  - Solicitação atingiu 80% do prazo
  - Solicitação atingiu 100% (breach iminente)
  - Breach confirmado
  - Escalação automática realizada
  - Solicitação crítica criada
- Notificação exibe: número, tipo, prazo restante, ação sugerida
- Usuário DEVE ter permissão de supervisor ou superior
- Respeitar preferências do usuário
- Máximo 1 notificação por solicitação por evento

---

### RN-RF038-011 — Análise de Tendências de Desempenho

**Descrição**: Sistema analisa histórico e identifica tendências de melhoria ou piora.

**Critério de Aceite**:
- Análise mensal de taxa de cumprimento
- Comparação com 3 meses anteriores
- Identificar tendências:
  - Melhoria sustentada: crescente 3+ meses
  - Piora sustentada: decrescente 3+ meses
  - Volatilidade: variação >10% mês a mês
  - Estabilidade: variação <5%
- Alertas automáticos para gestores em piora
- Análise requer mínimo 3 meses de dados
- Alertas enviados apenas 1x por mês

---

### RN-RF038-012 — Heatmap de Horários Críticos

**Descrição**: Visualização gráfica dos horários e dias com maior volume de breaches.

**Critério de Aceite**:
- Mapa de calor: dias da semana vs horários (00-23h)
- Cores indicam quantidade de breaches
- Filtro por período (última semana, mês, trimestre)
- Drill-down para ver solicitações específicas
- Dados agregados para evitar sobrecarga
- Cache de 1h para relatórios pesados

---

### RN-RF038-013 — SLA Diferenciado por Cliente/Contrato

**Descrição**: Clientes VIP podem ter SLAs mais rigorosos que o padrão.

**Critério de Aceite**:
- Níveis de serviço:
  - Bronze: SLA padrão
  - Prata: SLA -20%
  - Ouro: SLA -40%
  - Platinum: SLA -50%
- Ao criar solicitação, identificar nível e ajustar prazo
- Dashboard destaca solicitações de clientes VIP
- Nível DEVE estar configurado no cliente
- Ajuste NÃO pode resultar em prazo menor que 1h

---

### RN-RF038-014 — Registro de Não-Conformidade para Breaches

**Descrição**: Todo breach gera automaticamente registro de não-conformidade.

**Critério de Aceite**:
- Registro inclui: número solicitação, tempo atraso, atendente, supervisor, impacto
- Supervisor DEVE preencher análise de causa raiz e plano de ação
- Não-conformidades não tratadas em 5 dias úteis → alerta gerência
- Relatório mensal enviado para diretoria
- Análise de causa raiz OBRIGATÓRIA (mín. 50 caracteres)
- Ação corretiva OBRIGATÓRIA (mín. 30 caracteres)
- Prazo de implementação NÃO pode ser maior que 30 dias

---

### RN-RF038-015 — Métricas de Tempo Médio de Resolução (MTTR)

**Descrição**: Sistema calcula automaticamente MTTR por tipo, prioridade e equipe.

**Critério de Aceite**:
- Cálculo: Σ(tempo de resolução) / Total de solicitações finalizadas
- Segmentação por: tipo, prioridade, equipe, atendente, período
- Comparação com SLA configurado (MTTR < 80% do SLA)
- Alerta se MTTR > 90% do SLA (risco de breaches)
- MTTR calculado APENAS para solicitações finalizadas
- Outliers (>3x desvio padrão) excluídos do cálculo

---

## 6. ESTADOS DA ENTIDADE

### Estados de Configuração de SLA

| Estado | Descrição |
|--------|-----------|
| `draft` | Configuração criada, não ativa |
| `active` | Configuração ativa e em uso |
| `inactive` | Configuração desativada |
| `deleted` | Excluída logicamente |

### Estados de Solicitação em Relação a SLA

| Estado | Descrição |
|--------|-----------|
| `dentro_prazo` | 0-50% do prazo decorrido |
| `em_alerta` | 50-80% do prazo decorrido |
| `critico` | 80-100% do prazo decorrido |
| `breach` | Prazo ultrapassado |
| `pausado` | SLA pausado temporariamente |
| `finalizado` | Solicitação resolvida |

### Transições Permitidas

| De | Para | Condição |
|----|------|----------|
| `draft` | `active` | Aprovação |
| `active` | `inactive` | Desativação manual |
| `inactive` | `active` | Reativação |
| `dentro_prazo` | `em_alerta` | 50% do prazo decorrido |
| `em_alerta` | `critico` | 80% do prazo decorrido |
| `critico` | `breach` | 100% do prazo ultrapassado |
| `*` | `pausado` | Pausa manual com permissão |
| `pausado` | estado anterior | Retomada |

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando Ocorre | Payload |
|--------|---------------|---------|
| `sla.config.criada` | Após criação de configuração | `{configId, tipo, prioridade, prazo}` |
| `sla.calculado` | Após cálculo de prazo para solicitação | `{solicitacaoId, dataLimite, percentual}` |
| `sla.alerta.50` | 50% do prazo decorrido | `{solicitacaoId, atendente}` |
| `sla.alerta.80` | 80% do prazo decorrido | `{solicitacaoId, supervisor}` |
| `sla.alerta.100` | 100% do prazo atingido | `{solicitacaoId, gerente}` |
| `sla.breach` | Prazo ultrapassado | `{solicitacaoId, tempoAtraso, ncNumero}` |
| `sla.escalado` | Escalação automática realizada | `{solicitacaoId, nivelAnterior, novoResponsavel}` |
| `sla.pausado` | SLA pausado | `{solicitacaoId, motivo, usuarioId}` |
| `sla.retomado` | SLA retomado | `{solicitacaoId, novaDataLimite}` |
| `sla.extensao.solicitada` | Extensão solicitada | `{solicitacaoId, novoPrazo, justificativa}` |
| `sla.extensao.aprovada` | Extensão aprovada | `{solicitacaoId, aprovadorId, novoPrazo}` |

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- Nenhuma operação pode violar isolamento multi-tenant
- Nenhuma regra de negócio pode ser ignorada
- Alertas DEVEM ser enviados nos percentuais exatos (50%, 80%, 100%)
- Escalação DEVE ocorrer automaticamente ao atingir 100% sem resolução
- Cálculo de prazo DEVE considerar apenas horário de atendimento e excluir feriados
- Pausa/retomada DEVE recalcular prazo corretamente
- Todas as operações DEVEM ser auditadas
- Dashboard DEVE atualizar em tempo real (SignalR)
- Relatórios DEVEM ser precisos e baseados em dados consolidados

---

## 9. SEGURANÇA

- Validação de entrada obrigatória (motivo pausa, justificativa extensão)
- Proteção contra injeção SQL
- Controle de permissões granular (visualizar, configurar, pausar, aprovar)
- Isolamento multi-tenant estrito (fornecedor só vê seus dados)
- Auditoria completa de todas as operações
- Notificações apenas para usuários autorizados

---

## 10. ARTEFATOS DERIVADOS

Este RF é base para:

- **UC-RF038.md** - 12 Casos de Uso (UC00 a UC11)
- **MT-RF038.yaml** - Massas de Teste para validação
- **TC-RF038.yaml** - Casos de Teste automatizados
- **MD-RF038.md** - Modelo de Dados (tabelas SLA)
- **WF-RF038.md** - Wireframes e fluxos de tela

---

## 11. RASTREABILIDADE

| Artefato | Status | Observações |
|----------|--------|-------------|
| UC-RF038.md | Pendente | 12 casos de uso a criar |
| MT-RF038.yaml | Pendente | Massas para testes |
| TC-RF038.yaml | Pendente | Casos de teste backend/frontend |
| MD-RF038.md | Pendente | Modelo de dados SLA |
| WF-RF038.md | Pendente | Wireframes dashboard |

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 2.0 | 2025-12-30 | Migração v1.0→v2.0: separação RF/RL, 11 seções canônicas, 15 RNs em linguagem natural, ZERO referências ao legado | Agência ALC - alc.dev.br |
| 1.0 | 2025-01-14 | Versão inicial com conteúdo legado misturado | Architect Agent |
