rf_id: RF093
titulo: "Indicadores de Performance e Compliance"
versao: "2.0"
data_criacao: "2025-12-28"
data_atualizacao: "2025-12-30"
status: "Em Elaboração"
epic: "EPIC008-SD-Service-Desk"
fase: "Fase 5 - Service Desk"

objetivo: |
  Implementar sistema completo de gestão de KPIs (Key Performance Indicators) para IControlIT,
  permitindo definição, cálculo automático, acompanhamento e análise de métricas críticas
  relacionadas a SLA, contratos, ativos, custos e compliance.

escopo:
  incluido:
    - Definição e gerenciamento de KPIs personalizados com fórmulas configuráveis
    - Cálculo automático periódico via agendamento em background (Hangfire)
    - Definição de metas com limites de alerta (verde, amarelo, vermelho)
    - Dashboards em tempo real com atualização automática (SignalR)
    - Sistema de alertas para desvios de meta
    - Trilha de auditoria completa de cálculos e alterações
    - Integração com sistemas de SLA, Contratos, Ativos e Custos
    - Exportação para ferramentas de BI (Power BI, Tableau)
    - Validação avançada de fórmulas customizadas
    - Suporte a indicadores de compliance (SOX, LGPD, ISO 27001)

  excluido:
    - Machine Learning para predição de KPIs (release futura)
    - Integração com sistemas externos de BI além de Power BI e Tableau
    - Criação automática de ações corretivas baseadas em alertas

beneficios:
  - Visibilidade em tempo real do desempenho operacional
  - Identificação proativa de problemas e desvios
  - Tomada de decisão baseada em dados objetivos
  - Compliance com padrões regulatórios (SOX, LGPD, ISO 27001)
  - Redução de riscos operacionais e financeiros
  - Automação completa de cálculos manuais
  - Histórico completo para análise de tendências

stakeholders:
  - nome: "Gestores de TI"
    interesse: "Acompanhamento de performance de serviços e ativos"
  - nome: "Equipe Financeira"
    interesse: "Monitoramento de custos e TCO"
  - nome: "Equipe de Compliance"
    interesse: "Verificação de aderência a normas"
  - nome: "Service Desk"
    interesse: "Acompanhamento de SLA e qualidade de atendimento"
  - nome: "Alta Gestão"
    interesse: "Visão estratégica através de dashboards executivos"

funcionalidades:
  - id: "F001"
    nome: "Gerenciamento de KPIs"
    descricao: "Cadastro, edição, listagem e exclusão de KPIs com validação de fórmulas"

  - id: "F002"
    nome: "Metas e Limites de Alerta"
    descricao: "Configuração de metas com três zonas (verde, amarelo, vermelho)"

  - id: "F003"
    nome: "Cálculo Automático"
    descricao: "Execução automática periódica via Hangfire com retry em caso de falha"

  - id: "F004"
    nome: "Indicadores de SLA"
    descricao: "Cálculo automático de métricas de Service Level Agreement"

  - id: "F005"
    nome: "Indicadores de Contratos"
    descricao: "Cálculo de performance contratual e economia em renegociações"

  - id: "F006"
    nome: "Indicadores de Ativos"
    descricao: "Cálculo de TCO, taxa de utilização e disponibilidade"

  - id: "F007"
    nome: "Indicadores de Custos"
    descricao: "Monitoramento de despesas, ROI e variação orçamentária"

  - id: "F008"
    nome: "Indicadores de Compliance"
    descricao: "Aderência a SOX, LGPD, ISO 27001 e incidentes de segurança"

  - id: "F009"
    nome: "Alertas Automáticos"
    descricao: "Geração automática de alertas para desvios de meta"

  - id: "F010"
    nome: "Dashboards em Tempo Real"
    descricao: "Visualização interativa com atualização via SignalR"

  - id: "F011"
    nome: "Auditoria Completa"
    descricao: "Registro imutável de cálculos e alterações"

  - id: "F012"
    nome: "Exportação para BI"
    descricao: "Integração com Power BI (OData) e Tableau (WDC)"

casos_uso:
  - id: "UC00"
    nome: "Listar KPIs"
    ator: "Gestor, Analista"
    resumo: "Visualizar lista paginada de KPIs com filtros e ordenação"

  - id: "UC01"
    nome: "Cadastrar KPI"
    ator: "Administrador, Gestor de KPIs"
    resumo: "Criar novo KPI com validação de fórmula e agendamento automático"

  - id: "UC02"
    nome: "Editar KPI"
    ator: "Administrador, Gestor de KPIs"
    resumo: "Alterar KPI existente com auditoria de alterações"

  - id: "UC03"
    nome: "Visualizar Detalhes do KPI"
    ator: "Gestor, Analista"
    resumo: "Exibir histórico, metas, alertas e próxima execução"

  - id: "UC04"
    nome: "Configurar Metas"
    ator: "Gestor de KPIs"
    resumo: "Definir limites verde/amarelo/vermelho com vigência"

  - id: "UC05"
    nome: "Visualizar Dashboard"
    ator: "Gestor, Analista, Alta Gestão"
    resumo: "Acessar dashboard em tempo real com atualização SignalR"

  - id: "UC06"
    nome: "Reconhecer Alerta"
    ator: "Gestor, Responsável pelo KPI"
    resumo: "Marcar alerta como reconhecido com comentário"

  - id: "UC07"
    nome: "Exportar para Power BI"
    ator: "Analista de BI, Gestor"
    resumo: "Gerar endpoint OData e fornecer template .pbix"

regras_negocio:
  - id: "RN-KPI-093-01"
    nome: "Estrutura de KPI"
    descricao: "Todo KPI deve possuir código único, nome, descrição, tipo, fórmula, unidade, agregação e periodicidade"
    prioridade: "ALTA"
    categoria: "Estrutura de Dados"

  - id: "RN-KPI-093-02"
    nome: "Validação de Fórmulas Customizadas"
    descricao: "Fórmulas devem ser validadas antes da gravação (sintaxe, balanceamento, campos, divisão por zero, referências circulares)"
    prioridade: "CRÍTICA"
    categoria: "Validação"

  - id: "RN-KPI-093-03"
    nome: "Cálculo Automático via Hangfire"
    descricao: "KPIs devem ser calculados automaticamente conforme periodicidade com retry até 3 vezes"
    prioridade: "ALTA"
    categoria: "Processamento"

  - id: "RN-KPI-093-04"
    nome: "Metas Configuráveis com Limites de Alerta"
    descricao: "Cada KPI pode ter metas com três zonas (verde/amarelo/vermelho) e vigência definida"
    prioridade: "ALTA"
    categoria: "Configuração"

  - id: "RN-KPI-093-05"
    nome: "Indicadores de SLA"
    descricao: "Cálculo automático de métricas de SLA baseado em solicitações finalizadas"
    prioridade: "ALTA"
    categoria: "Cálculo Específico"

  - id: "RN-KPI-093-06"
    nome: "Indicadores de Contratos"
    descricao: "Cálculo de métricas contratuais considerando apenas contratos vigentes"
    prioridade: "MÉDIA"
    categoria: "Cálculo Específico"

  - id: "RN-KPI-093-07"
    nome: "Indicadores de Ativos"
    descricao: "Cálculo de TCO, utilização e disponibilidade de ativos"
    prioridade: "ALTA"
    categoria: "Cálculo Específico"

  - id: "RN-KPI-093-08"
    nome: "Alertas Automáticos de Desvio"
    descricao: "Alertas gerados automaticamente quando KPI atinge zona amarela ou vermelha"
    prioridade: "ALTA"
    categoria: "Notificação"

  - id: "RN-KPI-093-09"
    nome: "Auditoria Completa de Cálculos"
    descricao: "Todo cálculo e alteração deve ser registrado com snapshot de dados"
    prioridade: "CRÍTICA"
    categoria: "Auditoria"

  - id: "RN-KPI-093-10"
    nome: "Exportação para Power BI e Tableau"
    descricao: "Sistema disponibiliza endpoint OData e WDC com autenticação via API Key"
    prioridade: "MÉDIA"
    categoria: "Integração"

permissoes:
  - codigo: "KPI.VIEW"
    nome: "Visualizar KPIs"
    descricao: "Permite visualizar lista e detalhes de KPIs"
    papeis: ["Todos os usuários autenticados"]

  - codigo: "KPI.CREATE"
    nome: "Criar KPI"
    descricao: "Permite cadastrar novos KPIs"
    papeis: ["Administrador", "Gestor de KPIs"]

  - codigo: "KPI.UPDATE"
    nome: "Editar KPI"
    descricao: "Permite alterar KPIs existentes"
    papeis: ["Administrador", "Gestor de KPIs"]

  - codigo: "KPI.DELETE"
    nome: "Excluir KPI"
    descricao: "Permite excluir KPIs"
    papeis: ["Administrador"]

  - codigo: "KPI.CONFIG_TARGETS"
    nome: "Configurar Metas"
    descricao: "Permite definir e alterar metas"
    papeis: ["Administrador", "Gestor de KPIs"]

  - codigo: "KPI.VIEW_DASHBOARD"
    nome: "Visualizar Dashboard"
    descricao: "Permite acessar dashboards de KPIs"
    papeis: ["Todos os usuários autenticados"]

  - codigo: "KPI.EXPORT"
    nome: "Exportar Dados"
    descricao: "Permite exportar dados para BI/CSV/PDF"
    papeis: ["Analista", "Gestor"]

  - codigo: "KPI.MANAGE_ALERTS"
    nome: "Gerenciar Alertas"
    descricao: "Permite reconhecer e comentar alertas"
    papeis: ["Gestor de KPIs", "Responsáveis"]

  - codigo: "KPI.VIEW_AUDIT"
    nome: "Visualizar Auditoria"
    descricao: "Permite acessar trilha de auditoria"
    papeis: ["Administrador", "Auditor"]

  - codigo: "KPI.EXECUTE_CALC"
    nome: "Executar Cálculo Manual"
    descricao: "Permite forçar recálculo de KPI"
    papeis: ["Administrador"]

integracoes:
  internas:
    - rf: "RF028"
      nome: "Solicitações de Service Desk"
      tipo: "Consumo de dados (leitura)"
      finalidade: "Cálculo de indicadores de SLA"
      impacto: "Alterações em RF028 podem afetar cálculo de KPIs de SLA"

    - rf: "RF029"
      nome: "SLA (Service Level Agreement)"
      tipo: "Consumo de dados (leitura)"
      finalidade: "Definição de metas de SLA"
      impacto: "Alterações em SLA devem recalcular KPIs relacionados"

    - rf: "RF023"
      nome: "Gestão de Contratos"
      tipo: "Consumo de dados (leitura)"
      finalidade: "Cálculo de indicadores de contratos"
      impacto: "Alterações em valores contratuais recalculam KPIs de custo"

    - rf: "RF090"
      nome: "Gestão de Fornecedores"
      tipo: "Consumo de dados (leitura)"
      finalidade: "Análise de performance de fornecedores"
      impacto: "Permite criação de KPIs de qualidade de fornecedores"

    - rf: "RF094"
      nome: "Gestão de Custos de TI"
      tipo: "Consumo de dados (leitura)"
      finalidade: "Cálculo de indicadores financeiros"
      impacto: "Novos lançamentos atualizam KPIs de custo"

    - rf: "RF079"
      nome: "Gestão de Compliance"
      tipo: "Consumo de dados (leitura)"
      finalidade: "Cálculo de indicadores de compliance"
      impacto: "Novos controles melhoram indicadores de compliance"

  externas:
    - nome: "Hangfire"
      tipo: "Biblioteca/Framework"
      finalidade: "Agendamento e execução de cálculos automáticos"
      configuracao: "Jobs recorrentes criados ao cadastrar/editar KPI"

    - nome: "SignalR"
      tipo: "Biblioteca/Framework"
      finalidade: "Atualização em tempo real de dashboards"
      configuracao: "Hubs KpiHub e AlertHub com autenticação JWT"

    - nome: "Power BI"
      tipo: "Ferramenta de BI externa"
      finalidade: "Análises avançadas e relatórios executivos"
      configuracao: "Endpoint OData em /odata/kpis com API Key"

    - nome: "Tableau"
      tipo: "Ferramenta de BI externa"
      finalidade: "Visualizações e análises customizadas"
      configuracao: "Web Data Connector (WDC) JavaScript com OAuth 2.0"

entidades:
  - nome: "KpiDefinition"
    descricao: "Definição completa de cada indicador"
    atributos_principais:
      - "Id (Guid, PK)"
      - "Code (string, único)"
      - "Name (string)"
      - "Type (enum: SLA, Contract, Asset, Cost, Compliance, Custom)"
      - "Formula (string)"
      - "Periodicity (enum: Hourly, Daily, Weekly, Monthly, Yearly)"
      - "ClienteId (int, FK)"

  - nome: "KpiTarget"
    descricao: "Metas e limites de alerta"
    atributos_principais:
      - "Id (Guid, PK)"
      - "KpiDefinitionId (Guid, FK)"
      - "GreenThreshold (decimal)"
      - "YellowThreshold (decimal)"
      - "RedThreshold (decimal)"
      - "ValidFrom (DateTime)"
      - "ValidUntil (DateTime)"

  - nome: "KpiCalculation"
    descricao: "Histórico de cálculos executados"
    atributos_principais:
      - "Id (Guid, PK)"
      - "KpiDefinitionId (Guid, FK)"
      - "CalculatedValue (decimal)"
      - "CalculatedAt (DateTime)"
      - "Status (enum: Green, Yellow, Red)"

  - nome: "KpiAlert"
    descricao: "Alertas gerados por desvios"
    atributos_principais:
      - "Id (Guid, PK)"
      - "KpiDefinitionId (Guid, FK)"
      - "Severity (enum: Warning, Critical)"
      - "Status (enum: Pending, Acknowledged, Resolved)"

  - nome: "KpiAuditLog"
    descricao: "Auditoria de alterações"
    atributos_principais:
      - "Id (Guid, PK)"
      - "EntityType (enum: KpiDefinition, KpiTarget)"
      - "Action (enum: Created, Updated, Deleted, CalculationExecuted)"
      - "Timestamp (DateTime)"

requisitos_nao_funcionais:
  performance:
    - "RNF-KPI-093-01: Cálculo de KPI individual < 10 segundos"
    - "RNF-KPI-093-02: Dashboard carrega < 3 segundos"
    - "RNF-KPI-093-03: Latência SignalR < 500ms"
    - "RNF-KPI-093-04: Suporta 1.000 KPIs ativos simultaneamente"

  escalabilidade:
    - "RNF-KPI-093-06: Suporta 500 usuários simultâneos em dashboards"
    - "RNF-KPI-093-07: Hangfire executa 50 cálculos em paralelo"
    - "RNF-KPI-093-08: Armazena 5 anos de histórico sem degradação"

  seguranca:
    - "RNF-KPI-093-12: Autenticação obrigatória via JWT"
    - "RNF-KPI-093-13: Autorização RBAC granular"
    - "RNF-KPI-093-14: Multi-tenancy estrito por ClienteId"
    - "RNF-KPI-093-15: API Key obrigatória para integrações"

  compliance:
    - "RNF-KPI-093-27: Conformidade com LGPD"
    - "RNF-KPI-093-28: Conformidade com SOX"
    - "RNF-KPI-093-29: Suporte a ISO 27001"
    - "RNF-KPI-093-30: Retenção de auditoria por 7 anos"

dependencias:
  upstream:
    - rf: "RF028"
      tipo: "Forte"
      descricao: "Dados de solicitações são essenciais para KPIs de SLA"
    - rf: "RF029"
      tipo: "Forte"
      descricao: "Configurações de SLA definem metas padrão"
    - rf: "RF094"
      tipo: "Forte"
      descricao: "Dados de custos são essenciais para KPIs financeiros"

  downstream:
    - rf: "RF001"
      tipo: "Alto"
      descricao: "Fornece dados para Dashboard Executivo"
    - rf: "RF100"
      tipo: "Médio"
      descricao: "KPIs são fonte para Relatórios Gerenciais"

tecnologias:
  backend:
    - ".NET 10"
    - "Entity Framework Core 10"
    - "MediatR (CQRS)"
    - "FluentValidation"
    - "Hangfire"
    - "SignalR"

  frontend:
    - "Angular 19"
    - "Standalone Components"
    - "ApexCharts"
    - "Transloco (i18n)"

  integracoes:
    - "OData v4"
    - "Web Data Connector"
    - "SignalR"

historico:
  - versao: "1.0"
    data: "2025-12-28"
    autor: "Equipe IControlIT"
    descricao: "Versão inicial com código C# e legado misturado"

  - versao: "2.0"
    data: "2025-12-30"
    autor: "Equipe IControlIT"
    descricao: "Migração para governança v2.0 - Separação RF/RL - Remoção de código - Linguagem natural apenas"
