# RF056 - Gestão de Filas de Atendimento

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC008-SD-Service-Desk
**Fase**: Fase-5-Service-Desk

---

## 1. OBJETIVO DO REQUISITO

Implementar sistema de gestão de filas inteligentes para distribuição automática de solicitações de Service Desk entre atendentes, considerando especialidade técnica, carga de trabalho atual, SLA e prioridade. O sistema deve garantir balanceamento equitativo, escalação automática de solicitações não atendidas e métricas em tempo real de performance.

Este documento define **o que o sistema deve fazer**, não como implementar tecnicamente.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] Criação e gestão de múltiplas filas por categoria de serviço
- [x] Distribuição automática de solicitações para atendentes qualificados
- [x] Priorização inteligente baseada em SLA, prioridade e tempo de espera
- [x] Balanceamento de carga entre atendentes
- [x] Gestão de disponibilidade de atendentes (status)
- [x] Escalação automática de solicitações não atendidas
- [x] Transferência manual entre atendentes
- [x] Métricas e KPIs em tempo real
- [x] Controle de acesso e isolamento por tenant
- [x] Auditoria completa de operações

### 2.2 Fora do escopo (não objetivos)

- Interface visual específica (layout/UX)
- Tecnologia, framework ou linguagem de implementação
- Estratégia de deploy ou infraestrutura
- Integração com telefonia ou chat
- Pesquisa de satisfação do atendimento

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| Fila | Conjunto ordenado de solicitações aguardando atendimento |
| Atendente | Usuário responsável por resolver solicitações |
| Skill | Competência técnica do atendente (Mobile, Desktop, Rede, etc) |
| Carga | Número de solicitações abertas atribuídas a um atendente |
| Routing | Processo de atribuir solicitação ao atendente mais adequado |
| Escalação | Transferência automática para supervisor após tempo limite |
| SLA | Service Level Agreement - tempo máximo de resolução |
| Tenant | Unidade lógica de isolamento de dados (empresa cliente) |

---

## 4. FUNCIONALIDADES COBERTAS

1. **Gerenciar Filas por Categoria**
   - Criar filas separadas por tipo de serviço (Mobile, Desktop, Rede, Licenças)
   - Visualizar tamanho atual e tempo médio de espera por fila
   - Configurar regras de priorização específicas por fila

2. **Distribuir Solicitações Automaticamente**
   - Atribuir solicitação ao atendente disponível com skill adequada
   - Priorizar atendentes com menor carga de trabalho
   - Respeitar ordem de prioridade (Crítica > Alta > Média > Baixa)
   - Considerar percentual de SLA consumido

3. **Gerenciar Disponibilidade de Atendentes**
   - Registrar status do atendente (Disponível, Ocupado, Pausa, Ausente)
   - Agendar pausas automáticas (almoço, coffee break)
   - Redistribuir solicitações quando atendente fica indisponível
   - Registrar histórico de mudanças de status

4. **Escalonar Solicitações Automaticamente**
   - Detectar solicitações não atendidas após tempo limite (padrão: 30 minutos)
   - Transferir automaticamente para supervisor ou pool de escalação
   - Notificar supervisor sobre escalações

5. **Transferir Solicitações entre Atendentes**
   - Permitir transferência manual com justificativa
   - Validar skill do atendente destino
   - Registrar histórico de transferências

6. **Monitorar Métricas em Tempo Real**
   - Exibir dashboard com KPIs atualizados via SignalR
   - Mostrar total de solicitações por fila
   - Calcular tempo médio de espera
   - Indicar taxa de atendimento dentro do SLA

7. **Priorizar VIPs**
   - Identificar automaticamente solicitantes VIP (CEO, Diretores)
   - Atribuir prioridade crítica automaticamente
   - Notificar atendentes imediatamente

8. **Gerar Relatórios de Produtividade**
   - Consolidar métricas mensais por atendente
   - Calcular taxa de SLA por atendente
   - Medir tempo médio de resolução

---

## 5. REGRAS DE NEGÓCIO

### RN-RF056-001 — Priorização na Fila

**Descrição**: Solicitações na fila devem ser ordenadas por três critérios nesta ordem: (1) Prioridade da solicitação, (2) Percentual de SLA consumido, (3) Tempo de espera (mais antigo primeiro).

**Justificativa**: Garantir que solicitações urgentes e com risco de vencer SLA sejam atendidas primeiro.

**Critério de Aceite**:
- Solicitação com prioridade CRÍTICA deve vir antes de ALTA
- Entre solicitações de mesma prioridade, aquela com maior % SLA consumido tem precedência
- Entre solicitações com mesma prioridade e % SLA, a mais antiga vem primeiro

---

### RN-RF056-002 — Routing por Skills

**Descrição**: Solicitações só podem ser atribuídas a atendentes que possuam skill adequada à categoria da solicitação.

**Justificativa**: Garantir que atendentes tenham competência técnica para resolver a solicitação.

**Critério de Aceite**:
- Solicitação de categoria "MOBILE" só pode ser atribuída a atendente com skill "MOBILE"
- Atendente sem skill na categoria não deve receber a solicitação mesmo se disponível
- Sistema deve notificar supervisor se não houver atendente qualificado disponível

---

### RN-RF056-003 — Balanceamento de Carga

**Descrição**: Ao distribuir solicitações, priorizar atendentes disponíveis com menor carga de trabalho atual.

**Justificativa**: Evitar sobrecarga de atendentes e garantir distribuição equilibrada.

**Critério de Aceite**:
- Entre atendentes disponíveis e qualificados, escolher aquele com menos solicitações abertas
- Atendente que atingiu limite máximo (padrão: 5) não deve receber novas atribuições
- Redistribuição deve ocorrer automaticamente quando atendente fica indisponível

---

### RN-RF056-004 — Escalação Automática

**Descrição**: Solicitações que permanecerem na fila por mais de 30 minutos sem atribuição devem ser escaladas automaticamente para supervisor.

**Justificativa**: Evitar que solicitações fiquem indefinidamente sem atendimento.

**Critério de Aceite**:
- Job automático deve executar a cada 10 minutos verificando tempo de espera
- Solicitação com >30 minutos deve ser transferida para pool de supervisores
- Supervisor deve ser notificado sobre a escalação
- Histórico de escalação deve ser registrado

---

### RN-RF056-005 — Limite de Solicitações Simultâneas

**Descrição**: Cada atendente pode ter no máximo 5 solicitações abertas simultaneamente.

**Justificativa**: Evitar sobrecarga e garantir qualidade do atendimento.

**Critério de Aceite**:
- Tentativa de atribuir 6ª solicitação deve ser rejeitada
- Atendente deve ser marcado como "OCUPADO" automaticamente ao atingir limite
- Atendente deve voltar a "DISPONÍVEL" quando carga < limite

---

### RN-RF056-006 — Status de Disponibilidade

**Descrição**: Atendentes podem alterar manualmente seu status entre: DISPONÍVEL, PAUSA, AUSENTE. Status OCUPADO é controlado automaticamente pelo sistema.

**Justificativa**: Dar flexibilidade ao atendente para gerenciar sua disponibilidade.

**Critério de Aceite**:
- Status DISPONÍVEL: pode receber novas solicitações
- Status PAUSA: não recebe novas solicitações, mantém atribuições atuais
- Status AUSENTE: não recebe novas solicitações, solicitações atuais são redistribuídas
- Status OCUPADO: gerenciado pelo sistema quando atinge limite de carga
- Mudança de status deve ser auditada (quem, quando, motivo)

---

### RN-RF056-007 — Pausas Automáticas

**Descrição**: Sistema deve marcar automaticamente atendentes como "PAUSA" em horários configurados (ex: 12h-13h para almoço).

**Justificativa**: Garantir pausas para descanso e alimentação.

**Critério de Aceite**:
- Horários de pausa devem ser configuráveis por empresa
- Atendente em pausa automática não recebe novas atribuições
- Atendente deve retornar automaticamente a "DISPONÍVEL" após fim da pausa
- Solicitações em andamento não devem ser redistribuídas durante pausa

---

### RN-RF056-008 — Redistribuição em Ausência

**Descrição**: Quando atendente altera status para "AUSENTE", suas solicitações abertas devem ser redistribuídas automaticamente.

**Justificativa**: Evitar que solicitações fiquem bloqueadas por atendente ausente.

**Critério de Aceite**:
- Solicitações EM_ATENDIMENTO devem voltar para status AGUARDANDO_ATENDIMENTO
- Solicitações devem retornar à fila respeitando priorização
- Processo de redistribuição deve ser auditado
- Atendentes disponíveis devem ser notificados sobre novas solicitações na fila

---

### RN-RF056-009 — Filas por Categoria

**Descrição**: Sistema deve manter filas separadas por categoria de serviço (MOBILE, DESKTOP, REDE, LICENÇAS, OUTROS).

**Justificativa**: Organizar solicitações por especialidade técnica.

**Critério de Aceite**:
- Cada categoria deve ter fila independente
- Dashboard deve mostrar métricas por fila
- Atendente deve poder visualizar apenas filas de suas skills

---

### RN-RF056-010 — Priorização de VIPs

**Descrição**: Solicitações abertas por usuários com cargo CEO ou Diretor devem automaticamente receber prioridade CRÍTICA e flag VIP.

**Justificativa**: Garantir atendimento prioritário a executivos.

**Critério de Aceite**:
- Sistema deve identificar cargo do solicitante automaticamente
- Prioridade CRÍTICA deve ser aplicada independente da seleção manual
- Flag VIP deve ser visível para atendente
- Notificação imediata deve ser enviada para próximo atendente disponível

---

### RN-RF056-011 — Transferência entre Atendentes

**Descrição**: Atendente pode transferir solicitação para outro atendente, desde que o destinatário possua skill adequada.

**Justificativa**: Permitir redistribuição manual quando necessário.

**Critério de Aceite**:
- Atendente destino deve ter skill compatível com categoria da solicitação
- Motivo da transferência é obrigatório
- Histórico de transferências deve ser registrado
- Atendente destino deve ser notificado

---

### RN-RF056-012 — Métricas em Tempo Real

**Descrição**: Dashboard de métricas deve ser atualizado automaticamente a cada 30 segundos via SignalR.

**Justificativa**: Fornecer visibilidade em tempo real do estado das filas.

**Critério de Aceite**:
- Atualização deve ocorrer via push (SignalR), não polling
- Métricas devem incluir: total na fila, tempo médio de espera, atendentes disponíveis, taxa SLA
- Filtros por categoria devem ser aplicáveis
- Dashboard deve funcionar para múltiplos usuários simultâneos

---

### RN-RF056-013 — Fila de Retorno (Follow-up)

**Descrição**: Solicitações reabertas devem retornar automaticamente para o atendente original, se disponível.

**Justificativa**: Manter continuidade do atendimento.

**Critério de Aceite**:
- Solicitação reaberta deve verificar disponibilidade do atendente original
- Se disponível e carga < limite, atribuir ao atendente original
- Se indisponível ou carga excedida, retornar para fila com priorização normal
- Histórico de reabertura deve ser registrado

---

### RN-RF056-014 — SLA Pausado em Pendência Externa

**Descrição**: Quando solicitação for marcada como "AGUARDANDO_CLIENTE", o SLA deve ser pausado automaticamente.

**Justificativa**: Não penalizar atendente por tempo de espera de terceiros.

**Critério de Aceite**:
- Status AGUARDANDO_CLIENTE deve pausar contagem de SLA
- Motivo da pendência é obrigatório
- Cliente deve ser notificado sobre pendência
- Retomada do atendimento deve reativar contagem de SLA

---

### RN-RF056-015 — Relatório de Produtividade

**Descrição**: Sistema deve gerar relatório mensal consolidado de produtividade por atendente.

**Justificativa**: Avaliar performance individual e do time.

**Critério de Aceite**:
- Relatório deve incluir: total de atendimentos, tempo médio de resolução, taxa SLA, pesquisa de satisfação média
- Dados devem ser filtráveis por período e categoria
- Relatório deve ser exportável (PDF, Excel)
- Acesso restrito a supervisores e gestores

---

## 6. ESTADOS DA ENTIDADE

### 6.1 Estados da Solicitação

| Estado | Descrição |
|--------|-----------|
| AGUARDANDO_ATENDIMENTO | Na fila, sem atendente atribuído |
| EM_ATENDIMENTO | Atribuída a atendente, em resolução |
| AGUARDANDO_CLIENTE | Pausada aguardando retorno do cliente |
| RESOLVIDA | Solução aplicada, aguardando confirmação |
| FECHADA | Confirmada pelo cliente, finalizada |
| CANCELADA | Cancelada antes da resolução |

### 6.2 Estados do Atendente

| Estado | Descrição |
|--------|-----------|
| DISPONIVEL | Pode receber novas solicitações |
| OCUPADO | Atingiu limite de carga (automático) |
| PAUSA | Em pausa (manual ou automática) |
| AUSENTE | Indisponível, solicitações redistribuídas |

### 6.3 Transições Permitidas (Solicitação)

| De | Para |
|----|------|
| AGUARDANDO_ATENDIMENTO | EM_ATENDIMENTO |
| EM_ATENDIMENTO | AGUARDANDO_CLIENTE |
| EM_ATENDIMENTO | RESOLVIDA |
| AGUARDANDO_CLIENTE | EM_ATENDIMENTO |
| RESOLVIDA | FECHADA |
| RESOLVIDA | EM_ATENDIMENTO (reabertura) |
| Qualquer | CANCELADA |

### 6.4 Transições Permitidas (Atendente)

| De | Para |
|----|------|
| DISPONIVEL | OCUPADO (automático) |
| DISPONIVEL | PAUSA |
| DISPONIVEL | AUSENTE |
| OCUPADO | DISPONIVEL (automático) |
| PAUSA | DISPONIVEL |
| AUSENTE | DISPONIVEL |

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre |
|--------|---------------|
| solicitacao.adicionada_fila | Solicitação entra na fila |
| solicitacao.atribuida | Solicitação atribuída a atendente |
| solicitacao.transferida | Transferência entre atendentes |
| solicitacao.escalada | Escalação automática para supervisor |
| solicitacao.redistribuida | Redistribuição por ausência de atendente |
| atendente.status_alterado | Mudança de status do atendente |
| fila.atualizada | Mudança no tamanho ou ordem da fila |
| metricas.atualizadas | Atualização de KPIs (a cada 30s) |

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- Nenhuma operação pode violar isolamento de tenant (empresa cliente)
- Nenhuma regra de negócio pode ser ignorada
- Todas as mudanças de estado devem ser auditadas
- Notificações em tempo real devem funcionar via SignalR
- Métricas devem ser precisas e calculadas em tempo real
- Escalação automática não pode falhar
- Redistribuição deve ocorrer sem perda de solicitações

---

## 9. SEGURANÇA

- Validação de entrada obrigatória em todos os endpoints
- Proteção contra injeção de código
- Controle de permissões RBAC para todas as operações
- Isolamento multi-tenant obrigatório (EmpresaId em todas as consultas)
- Auditoria completa (Created, CreatedBy, LastModified, LastModifiedBy)
- Soft delete obrigatório (sem exclusão física)

---

## 10. ARTEFATOS DERIVADOS

Este RF é base para:

- **UC-RF056.md** - Casos de Uso detalhados
- **MD-RF056.md** - Modelo de Dados completo
- **WF-RF056.md** - Wireframes e fluxos de tela
- **TC-RF056.yaml** - Casos de Teste automatizados
- **MT-RF056.yaml** - Massas de Teste

---

## 11. RASTREABILIDADE

| Artefato | Status | Gerado |
|----------|--------|--------|
| Casos de Uso | ✅ | Sim |
| Modelo de Dados | ✅ | Sim |
| Wireframes | ✅ | Sim |
| Massas de Teste | ⏳ | Pendente |
| Casos de Teste | ⏳ | Pendente |

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 2.0 | 2025-12-30 | Migração v1.0 → v2.0 - Separação RF/RL completa, adequação ao contrato moderno | Agência ALC - alc.dev.br |
| 1.0 | 2025-01-14 | Versão inicial com 15 regras de negócio | Equipe IControlIT |
