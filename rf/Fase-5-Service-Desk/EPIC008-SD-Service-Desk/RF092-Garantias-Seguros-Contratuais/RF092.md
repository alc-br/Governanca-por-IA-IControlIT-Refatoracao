# RF092 — Gestão Completa de Garantias e Seguros Contratuais

**Versão:** 2.0
**Data:** 2025-12-31
**Fase:** Fase 5 - Service Desk
**EPIC:** EPIC008-SD-Service-Desk
**Status:** EM_DOCUMENTACAO

---

## 1. VISÃO GERAL

### 1.1. Descrição Geral

Este Requisito Funcional (RF) define o sistema completo de gestão de garantias contratuais e apólices de seguro vinculadas a ativos da organização. O sistema permite:

- **Cadastro e controle de garantias contratuais** vinculadas a ativos (fabricante, fornecedor, terceiros, própria)
- **Gestão de apólices de seguro** com múltiplas coberturas, valores e vigências
- **Workflow formal de sinistros** (solicitação → análise → aprovação → pagamento)
- **Alertas automáticos de vencimento** de garantias e apólices (90, 60, 30, 15 dias)
- **Renovação automática de apólices** 30 dias antes do vencimento
- **Dashboard com KPIs e métricas** de cobertura, sinistros e valores segurados

O sistema garante compliance com LGPD e SOX através de auditoria completa de todas as operações, rastreabilidade de transições de estado e controle rigoroso de permissões de acesso.

### 1.2. Importância e Justificativa

A gestão adequada de garantias e seguros é **CRÍTICA** para:

1. **Proteção Patrimonial**: Garantir que ativos valiosos estejam cobertos por garantias ou apólices de seguro em caso de danos, perdas ou roubos.

2. **Compliance Regulatório**: Atender exigências de SOX (Sarbanes-Oxley) e LGPD para rastreabilidade completa de operações financeiras e dados sensíveis.

3. **Gestão de Riscos**: Identificar ativos sem cobertura ou com coberturas vencidas, minimizando exposição financeira da organização.

4. **Otimização de Custos**: Centralizar informações de apólices permite negociações mais eficazes com seguradoras e evita duplicação de coberturas.

5. **Agilidade Operacional**: Workflow automatizado de sinistros reduz tempo de aprovação e melhora experiência dos usuários.

6. **Prevenção de Perdas**: Alertas automáticos evitam vencimentos não tratados que deixariam ativos descobertos.

### 1.3. Conceitos-Chave

**Garantia Contratual**
Compromisso formal do fabricante, fornecedor ou terceiro de reparar ou substituir um ativo em caso de defeito durante um período determinado. Pode ser:
- **Fabricante**: Garantia original do fabricante do equipamento
- **Fornecedor**: Garantia estendida oferecida pelo fornecedor
- **Terceiros**: Garantia contratada com empresa especializada
- **Própria**: Auto-garantia da organização (reserva financeira)

**Apólice de Seguro**
Contrato com seguradora que garante indenização em caso de sinistros (roubo, dano, perda total). Contém:
- **Número de Apólice**: Identificação única por seguradora
- **Prêmio Mensal/Anual**: Valor pago periodicamente à seguradora
- **Limite de Cobertura**: Valor máximo de indenização
- **Franquia**: Valor pago pelo segurado em caso de sinistro
- **Coberturas**: Tipos de eventos cobertos (roubo, incêndio, dano elétrico, etc.)

**Sinistro**
Evento coberto pela apólice que gera solicitação de indenização. Segue workflow:
1. **SOLICITAÇÃO**: Registro inicial do sinistro
2. **EM ANÁLISE**: Seguradora/gestor analisa documentação
3. **APROVADO**: Sinistro aprovado para pagamento
4. **RECUSADO**: Sinistro recusado (estado terminal)
5. **PAGO**: Indenização paga ao solicitante

**Cobertura Total**
Soma de todas as garantias ativas e apólices vigentes de um ativo, indicando o valor total de proteção disponível.

### 1.4. Principais Funcionalidades

1. **Gestão de Garantias Contratuais**
   - Cadastro de garantias vinculadas a ativos específicos
   - Tipos: Fabricante, Fornecedor, Terceiros, Própria
   - Controle de vigência (data início, data fim)
   - Valor de cobertura (opcional)
   - Vinculação a contratos (quando aplicável)
   - Validação de sobreposição de períodos para mesmo ativo
   - Cálculo automático de status (Ativa, Vencendo, Vencida, Futura)

2. **Gestão de Apólices de Seguro**
   - Cadastro de apólices com número único por seguradora
   - Vinculação a seguradora (entidade Fornecedor)
   - Valores: Prêmio mensal, Limite de cobertura, Franquia
   - Coberturas estruturadas (array de objetos JSON)
   - Vigência (data início, data fim)
   - Cálculo automático de prêmio anual (mensal * 12)
   - Validação de franquia < limite de cobertura

3. **Workflow de Sinistros**
   - Registro de sinistro vinculado a apólice ativa
   - Workflow formal com estados e transições controladas
   - Histórico completo de mudanças de status (audit trail)
   - Validação de transições (state machine)
   - Estado RECUSADO terminal (não pode reabrir automaticamente)
   - Valor estimado e valor aprovado separados

4. **Alertas Automáticos de Vencimento**
   - Job Hangfire executado diariamente às 8h
   - Alertas em 4 marcos temporais: 90, 60, 30, 15 dias antes do vencimento
   - Notificações por email para responsáveis configurados
   - Evita duplicação: apenas 1 alerta por marco temporal
   - Registro em AuditLog de alertas enviados

5. **Renovação Automática de Apólices**
   - Job Hangfire executado diariamente às 6h
   - Identifica apólices vencendo em 30 dias
   - Cria automaticamente nova apólice com vigência subsequente
   - Incrementa número da apólice (ex: 12345 → 12345-R1)
   - Notifica responsável por email
   - Opção de renovação manual via comando específico

6. **Dashboard com KPIs e Métricas**
   - Total de garantias ativas
   - Garantias vencendo em 30 dias (alerta)
   - Valor total de cobertura
   - Garantias por tipo (gráfico de pizza)
   - Total de apólices ativas
   - Valor total segurado
   - Prêmio anual total
   - Sinistros pendentes (SOLICITAÇÃO + EM ANÁLISE)
   - Sinistros por status (gráfico de barras)
   - Taxa de aprovação de sinistros

7. **Auditoria e Compliance**
   - Auditoria completa via AuditInterceptor (EF Core)
   - Campos: Created, CreatedBy, LastModified, LastModifiedBy, UserIP
   - Soft delete: IsDeleted, DeletedAt, DeletedBy
   - Histórico de transições de sinistros em tabela separada
   - Retenção de 7 anos (compliance SOX)
   - Rastreabilidade total de quem fez o quê e quando

---

## 2. REGRAS DE NEGÓCIO

### RN-GAR-092-01: Garantia Vinculada a Ativo Válido

**Descrição:**
Toda garantia contratual DEVE estar obrigatoriamente vinculada a um ativo existente e válido no sistema.

**Justificativa:**
Garantias órfãs (sem ativo) não fazem sentido de negócio e geram inconsistências nos cálculos de cobertura.

**Critérios de Aceitação:**
- O campo `AtivoId` deve referenciar um ativo válido na tabela `Ativos`
- Validação deve ocorrer antes da criação ou edição da garantia
- Erro HTTP 400 se ativo não existir ou tiver sido excluído
- Mensagem de erro clara: "O ativo informado não existe ou foi excluído"

**Exemplos Válidos:**
- AtivoId = Guid existente na tabela Ativos
- Navigation property Ativo carregada corretamente

**Exemplos Inválidos:**
- AtivoId = Guid.Empty (não permitido)
- AtivoId = Guid inexistente (erro 400)
- AtivoId = null (obrigatório)

---

### RN-GAR-092-02: Data de Término Posterior à Data de Início

**Descrição:**
A data de término da garantia DEVE ser obrigatoriamente posterior à data de início. Garantias com datas invertidas ou iguais são inválidas.

**Justificativa:**
Período de vigência negativo ou zero não faz sentido de negócio e quebraria cálculos de status e alertas.

**Critérios de Aceitação:**
- `DataFim > DataInicio` (estritamente maior, não permite igualdade)
- Validação no backend via FluentValidation
- Validação no frontend via custom validator
- Check constraint no banco de dados
- Erro HTTP 400 se validação falhar

**Exemplos Válidos:**
- DataInicio = 2025-01-01, DataFim = 2025-12-31 (válido, 365 dias)
- DataInicio = hoje, DataFim = hoje + 1 ano (válido)

**Exemplos Inválidos:**
- DataInicio = 2025-12-31, DataFim = 2025-01-01 (invertido, inválido)
- DataInicio = DataFim (mesma data, inválido)

---

### RN-GAR-092-03: Alertas Automáticos de Vencimento

**Descrição:**
O sistema DEVE enviar automaticamente alertas de vencimento de garantias e apólices em 4 marcos temporais: **90 dias, 60 dias, 30 dias e 15 dias** antes da data de término.

**Justificativa:**
Alertas antecipados permitem planejamento de renovações ou substituição de ativos antes da perda de cobertura.

**Critérios de Aceitação:**
- Job Hangfire executado diariamente às 8h da manhã
- Query identifica garantias/apólices nos marcos temporais (DataFim - hoje IN (90, 60, 30, 15))
- Email enviado para responsáveis configurados
- Notificação registrada em AuditLog
- Evitar duplicação: apenas 1 alerta por garantia/apólice por marco temporal

**Destinatários:**
- Responsável pelo ativo (se definido)
- Gestor do centro de custo vinculado ao ativo
- Grupo de Service Desk (configurável por empresa)

**Exemplo:**
- Garantia vence em 2025-04-01
- Hoje é 2025-01-02 (exatamente 90 dias antes)
- Sistema envia alerta por email + registra em AuditLog

---

### RN-GAR-092-04: Número de Apólice Único por Seguradora

**Descrição:**
Cada apólice DEVE ter um número único dentro do contexto de uma mesma seguradora. É permitido o mesmo número para seguradoras diferentes.

**Justificativa:**
Evitar duplicação de apólices e confusão na gestão de sinistros. Seguradoras diferentes podem usar mesma numeração.

**Critérios de Aceitação:**
- Unique constraint no banco de dados: `(NumeroApolice, SeguradoraId)`
- Validação assíncrona no frontend (AsyncValidator)
- Validação no backend via FluentValidation com query
- Erro HTTP 409 (Conflict) se número duplicado para mesma seguradora

**Exemplos Válidos:**
- Seguradora A - Número 12345 (primeira apólice)
- Seguradora B - Número 12345 (seguradora diferente, permitido)

**Exemplos Inválidos:**
- Seguradora A - Número 12345 (já existe outra apólice com mesmo número para Seguradora A)

---

### RN-GAR-092-05: Sinistros Apenas para Apólices Ativas

**Descrição:**
Um sinistro SOMENTE pode ser registrado contra uma apólice que esteja ATIVA no momento do registro. Apólices vencidas, canceladas ou inativas não podem receber novos sinistros.

**Justificativa:**
Evitar registro de sinistros contra apólices sem vigência, que não serão honrados pela seguradora.

**Critérios de Aceitação:**
- Validar se `DataInicio <= DataOcorrenciaSinistro <= DataFim`
- Validar se `IsDeleted = false` (apólice não cancelada)
- Erro HTTP 400 se apólice inativa com mensagem clara
- Query de validação antes da criação do sinistro

**Exemplos Válidos:**
- Apólice vigente de 2025-01-01 a 2025-12-31
- Sinistro com DataOcorrencia = 2025-06-15 (dentro da vigência)

**Exemplos Inválidos:**
- Apólice vencida (DataFim = 2024-12-31, hoje = 2025-01-15)
- Apólice cancelada (IsDeleted = true)
- Sinistro com DataOcorrencia fora da vigência

---

### RN-GAR-092-06: Cálculo de Cobertura Total por Ativo

**Descrição:**
O sistema DEVE calcular e exibir a cobertura total de um ativo somando o valor de todas as garantias **ativas e vigentes** vinculadas a ele.

**Justificativa:**
Indicador financeiro importante para avaliar exposição de risco e adequação de coberturas.

**Critérios de Aceitação:**
- Fórmula: `CoberturaTotal = SUM(ValorCobertura) WHERE AtivoId = X AND IsDeleted = false AND DataFim >= hoje`
- Exibido na tela de detalhes do ativo (card de garantias)
- Atualizado automaticamente ao criar/editar/excluir garantia
- Cache de 5 minutos no backend para otimizar performance

**Exemplo:**
- Ativo X possui:
  - Garantia Fabricante: R$ 10.000 (vigente até 2025-12-31)
  - Garantia Fornecedor: R$ 5.000 (vigente até 2025-06-30)
  - Garantia Terceiros: R$ 3.000 (vencida em 2024-12-31, **NÃO entra no cálculo**)
- **Cobertura Total = R$ 15.000**

---

### RN-GAR-092-07: Workflow Formal de Estados de Sinistro

**Descrição:**
Sinistros DEVEM seguir um workflow formal com estados e transições definidas. Transições inválidas são bloqueadas pelo sistema.

**Estados Válidos:**
1. **SOLICITAÇÃO**: Estado inicial ao criar sinistro
2. **EM ANÁLISE**: Sinistro em análise pela seguradora ou gestor
3. **APROVADO**: Sinistro aprovado para pagamento
4. **RECUSADO**: Sinistro recusado pela seguradora (estado terminal)
5. **PAGO**: Indenização paga ao solicitante (estado terminal)

**Transições Permitidas:**

**De SOLICITAÇÃO:**
- → EM ANÁLISE (iniciar análise)
- → RECUSADO (recusar diretamente em casos óbvios)

**De EM ANÁLISE:**
- → APROVADO (aprovar sinistro após análise)
- → RECUSADO (recusar após análise)
- → SOLICITAÇÃO (devolver para complementação de documentação)

**De APROVADO:**
- → PAGO (registrar pagamento de indenização)

**De RECUSADO:**
- ❌ **NENHUMA TRANSIÇÃO** (estado terminal, ver RN-GAR-092-14)

**De PAGO:**
- ❌ **NENHUMA TRANSIÇÃO** (estado terminal)

**Auditoria Obrigatória de Transições:**
- StatusAnterior
- StatusNovo
- UsuarioId (quem executou a transição)
- DataTransicao
- Justificativa (obrigatória em transição para RECUSADO)
- IP do usuário

**Critérios de Aceitação:**
- State machine valida transição antes de executar
- Erro HTTP 400 se transição inválida
- Histórico gravado em tabela `SinistroStatusHistorico`
- Justificativa obrigatória em transições para RECUSADO

---

### RN-GAR-092-08: Renovação Automática de Apólices

**Descrição:**
O sistema DEVE renovar automaticamente apólices de seguro **30 dias antes da data de vencimento**, criando uma nova apólice com vigência subsequente e notificando o responsável.

**Justificativa:**
Evitar lapsos de cobertura por esquecimento de renovação manual. Garante continuidade de proteção dos ativos.

**Critérios de Aceitação:**
- Job Hangfire executado diariamente às 6h da manhã
- Identifica apólices com `DataFim = hoje + 30 dias`
- Cria nova apólice automaticamente com:
  - `DataInicio = DataFim_anterior + 1 dia`
  - `DataFim = DataInicio + 365 dias` (ou período configurável)
  - Mesmo SeguradoraId, valores e coberturas
  - `NumeroApolice` incrementado com sufixo (ex: 12345 → 12345-R1)
- Envia email de notificação ao responsável
- Registra operação em AuditLog
- Renovação manual também disponível via comando específico

**Dados Copiados da Apólice Original:**
- SeguradoraId
- ValorPremioMensal
- ValorLimiteCobertura
- ValorFranquia
- Coberturas (array JSON)

**Dados Novos Gerados:**
- NumeroApolice (incrementado: 12345-R1, 12345-R2, etc.)
- DataInicio (DataFim_anterior + 1 dia)
- DataFim (DataInicio + período configurado)
- Created, CreatedBy (audit trail)

---

### RN-GAR-092-09: Auditoria Completa de Operações

**Descrição:**
TODAS as operações de criação, edição e exclusão DEVEM ser auditadas automaticamente com usuário, IP, timestamp e dados antes/depois.

**Justificativa:**
Compliance com LGPD (rastreabilidade de acesso a dados) e SOX (auditoria financeira obrigatória).

**Critérios de Aceitação:**
- AuditInterceptor do EF Core captura automaticamente todas as mudanças
- Campos obrigatórios em TODAS as entidades:
  - `Created` (DateTime, NOT NULL)
  - `CreatedBy` (Guid, FK → Users)
  - `LastModified` (DateTime?)
  - `LastModifiedBy` (Guid?)
  - `UserIP` (string(45))
- Soft delete obrigatório:
  - `IsDeleted` (bool, default false)
  - `DeletedAt` (DateTime?)
  - `DeletedBy` (Guid?)
- Registro em tabela `AuditLogs` com JSON before/after
- Retenção de 7 anos (compliance SOX)

**Eventos Auditados:**
- INSERT: Criação de garantia, apólice, sinistro
- UPDATE: Edição de dados, mudança de status
- DELETE: Soft delete (IsDeleted = true)
- WORKFLOW: Transições de estado de sinistro (tabela SinistroStatusHistorico)

---

### RN-GAR-092-10: Validação de Sobreposição de Períodos

**Descrição:**
O sistema NÃO DEVE permitir criar ou editar garantias com períodos de vigência sobrepostos para o mesmo ativo. Períodos devem ser disjuntos (não overlapping).

**Justificativa:**
Evitar duplicação de coberturas e confusão sobre qual garantia está ativa em determinado período.

**Critérios de Aceitação:**
- Validar antes de criar ou editar garantia
- Query verifica se existe garantia com:
  `AtivoId = X AND DataInicio <= NovaDataFim AND DataFim >= NovaDataInicio`
- Erro HTTP 409 (Conflict) se sobreposição detectada
- Mensagem clara indicando período conflitante

**Fórmula de Detecção de Sobreposição:**
```
Sobreposição existe SE:
  NovaDataInicio <= ExistenteDataFim AND NovaDataFim >= ExistenteDataInicio
```

**Exemplos Válidos:**
- Garantia 1: 2025-01-01 a 2025-06-30
- Garantia 2: 2025-07-01 a 2025-12-31 (sem sobreposição, permitido)

**Exemplos Inválidos:**
- Garantia 1: 2025-01-01 a 2025-06-30
- Garantia 2: 2025-06-01 a 2025-12-31 (sobreposição de 30 dias, bloqueado)

---

### RN-GAR-092-11: Franquia Menor que Limite de Cobertura

**Descrição:**
Em apólices de seguro, o valor da franquia (valor pago pelo segurado em caso de sinistro) DEVE ser obrigatoriamente MENOR que o limite máximo de cobertura da apólice.

**Justificativa:**
Franquia >= Limite de Cobertura tornaria a apólice inútil (segurado pagaria tudo sozinho). Validação de negócio essencial.

**Critérios de Aceitação:**
- `ValorFranquia < ValorLimiteCobertura` (estritamente menor)
- Validação no backend via FluentValidation
- Validação no frontend via custom validator
- Check constraint no banco de dados
- Erro HTTP 400 se validação falhar

**Exemplos Válidos:**
- Franquia = R$ 5.000, Limite = R$ 100.000 (válido)
- Franquia = R$ 0, Limite = R$ 50.000 (válido, sem franquia)

**Exemplos Inválidos:**
- Franquia = R$ 100.000, Limite = R$ 100.000 (iguais, inválido)
- Franquia = R$ 150.000, Limite = R$ 100.000 (maior, inválido)

---

### RN-GAR-092-12: Status de Garantia Derivado das Datas

**Descrição:**
O status de uma garantia (Ativa, Vencendo, Vencida, Futura) é CALCULADO automaticamente com base nas datas de vigência em relação à data atual. Não é um campo editável.

**Justificativa:**
Evitar inconsistências de dados manuais. Status derivado garante sempre a informação correta em tempo real.

**Regras de Cálculo:**

**VENCIDA:**
- Condição: `DataFim < hoje`
- Cor: Vermelho (red)
- Ícone: warning

**VENCENDO:**
- Condição: `DataFim >= hoje AND DataFim <= hoje + 30 dias`
- Cor: Laranja (orange)
- Ícone: schedule

**ATIVA:**
- Condição: `DataFim > hoje + 30 dias AND DataInicio <= hoje`
- Cor: Verde (green)
- Ícone: check_circle

**FUTURA:**
- Condição: `DataInicio > hoje`
- Cor: Azul (blue)
- Ícone: schedule

**Critérios de Aceitação:**
- Status calculado em propriedade computada no DTO (backend)
- Não armazenado no banco de dados
- Exibição com badge colorido (Material Chip)
- Pipe customizado no frontend para formatação

---

### RN-GAR-092-13: Prêmio Anual Calculado Automaticamente

**Descrição:**
O prêmio anual de uma apólice de seguro é CALCULADO automaticamente multiplicando o prêmio mensal por 12. Não é um campo editável.

**Justificativa:**
Evitar inconsistências e erros de digitação. Cálculo automático garante precisão.

**Critérios de Aceitação:**
- Fórmula: `ValorPremioAnual = ValorPremioMensal * 12`
- Calculado em propriedade computada no DTO (backend)
- Não armazenado no banco de dados
- Exibido em formulários e relatórios
- Formatado como moeda BRL (currency pipe)

**Exemplos:**
- Mensal = R$ 1.500,00 → Anual = R$ 18.000,00
- Mensal = R$ 850,50 → Anual = R$ 10.206,00

---

### RN-GAR-092-14: Sinistro Recusado Não Reabre Automaticamente

**Descrição:**
Um sinistro que tenha sido RECUSADO pela seguradora NÃO PODE ser reaberto ou ter seu status alterado de volta para SOLICITAÇÃO automaticamente. Para contestar uma recusa, é necessário registrar um NOVO sinistro.

**Justificativa:**
Manter integridade do histórico e evitar manipulação de registros de recusa. Contestações devem gerar novo processo formal.

**Critérios de Aceitação:**
- Estado RECUSADO é terminal (não permite transições de saída na state machine)
- Tentativa de transição retorna erro HTTP 400 com mensagem clara
- Para contestar: criar novo sinistro com campo `SinistroOrigemId` referenciando o recusado
- Histórico de sinistros vinculados mantido para rastreabilidade

**Workflow de Contestação:**
1. Usuário visualiza sinistro RECUSADO
2. Clica em "Contestar Recusa" (se permitido por permissão)
3. Sistema abre formulário de novo sinistro pré-preenchido
4. Campo `SinistroOrigemId` automaticamente vinculado ao recusado
5. Usuário anexa documentação adicional e justificativa
6. Novo sinistro inicia em estado SOLICITAÇÃO
7. Histórico registra vínculo entre sinistros

---

### RN-GAR-092-15: Apólice Cancelada Rejeita Novos Sinistros

**Descrição:**
Uma apólice de seguro que tenha sido CANCELADA (IsDeleted = true) NÃO PODE receber novos sinistros. Apenas apólices ativas e vigentes podem ter sinistros registrados.

**Justificativa:**
Evitar registro de sinistros contra apólices inativas que não serão honrados pela seguradora.

**Critérios de Aceitação:**
- Validar `IsDeleted = false` antes de criar sinistro
- Erro HTTP 400 se apólice cancelada
- Mensagem clara: "Não é possível registrar sinistro para apólice cancelada"
- Query de validação antes da criação do sinistro

**Exemplos Válidos:**
- ApoliceId = Guid de apólice ativa (IsDeleted = false, DataFim >= hoje)

**Exemplos Inválidos:**
- ApoliceId = Guid de apólice cancelada (IsDeleted = true)

---

## 4. INTEGRACOES OBRIGATORIAS

### 4.1. i18n (Internacionalização)

**Implementação:** Transloco (Angular)

**Chaves Principais:**
- `garantias.titulo` - "Garantias Contratuais"
- `garantias.lista.titulo` - "Lista de Garantias"
- `garantias.form.criar` - "Criar Garantia"
- `garantias.form.editar` - "Editar Garantia"
- `garantias.status.ativa` - "Ativa"
- `garantias.status.vencendo` - "Vencendo"
- `garantias.status.vencida` - "Vencida"
- `garantias.status.futura` - "Futura"
- `apolices.titulo` - "Apólices de Seguro"
- `sinistros.titulo` - "Sinistros"
- `sinistros.workflow.solicitacao` - "Solicitação"
- `sinistros.workflow.analise` - "Em Análise"
- `sinistros.workflow.aprovado` - "Aprovado"
- `sinistros.workflow.recusado` - "Recusado"
- `sinistros.workflow.pago` - "Pago"

**Idiomas Obrigatórios:**
- pt-BR (default)
- en (fallback)
- es (fallback)

### 4.2. Auditoria

**Implementação:** AuditInterceptor (EF Core)

**Campos Obrigatórios:**
- Created, CreatedBy, LastModified, LastModifiedBy, UserIP
- IsDeleted, DeletedAt, DeletedBy

**Tabela:** AuditLogs
**Retenção:** 7 anos (compliance SOX)

### 4.3. Permissões RBAC

**Implementação:** Role-Based Access Control

**Validação:**
- RequirePermission attribute em Commands
- RequireAuthorization policy em Endpoints
- PermissionGuard no Angular

**Matriz:** Permission → Role → User

### 4.4. Central de Funcionalidades

**Módulo:** Service Desk - Garantias e Seguros

**Funcionalidades:**

1. **FUNC-SD-GARANTIAS**
   - Nome: "Gestão de Garantias Contratuais"
   - Rota: `/service-desk/garantias`
   - Ícone: verified_user

2. **FUNC-SD-APOLICES**
   - Nome: "Gestão de Apólices de Seguro"
   - Rota: `/service-desk/apolices`
   - Ícone: shield

3. **FUNC-SD-SINISTROS**
   - Nome: "Gestão de Sinistros"
   - Rota: `/service-desk/sinistros`
   - Ícone: report_problem

---

## 5. CENTRAL DE FUNCIONALIDADES

### FUNC-SD-GARANTIAS

**Nome:** Gestão de Garantias Contratuais
**Módulo:** Service Desk
**Rota:** `/service-desk/garantias`
**Ícone:** verified_user
**Descrição:** Cadastro e controle de garantias contratuais vinculadas a ativos.

**Permissões Necessárias:**
- SD.GARANTIAS.LISTAR (mínimo para acessar)
- SD.GARANTIAS.CREATE (criar novas garantias)
- SD.GARANTIAS.UPDATE (editar garantias existentes)
- SD.GARANTIAS.DELETE (excluir garantias)
- SD.GARANTIAS.DASHBOARD (visualizar KPIs)

### FUNC-SD-APOLICES

**Nome:** Gestão de Apólices de Seguro
**Módulo:** Service Desk
**Rota:** `/service-desk/apolices`
**Ícone:** shield
**Descrição:** Gestão completa de apólices de seguro com múltiplas coberturas.

**Permissões Necessárias:**
- SD.APOLICES.LISTAR (mínimo para acessar)
- SD.APOLICES.CREATE (criar novas apólices - restrito a ServiceDeskManager)
- SD.APOLICES.UPDATE (editar apólices - restrito a ServiceDeskManager)
- SD.APOLICES.RENEW (renovar apólices manualmente - restrito a ServiceDeskManager)

### FUNC-SD-SINISTROS

**Nome:** Gestão de Sinistros
**Módulo:** Service Desk
**Rota:** `/service-desk/sinistros`
**Ícone:** report_problem
**Descrição:** Workflow completo de sinistros (solicitação, análise, aprovação, pagamento).

**Permissões Necessárias:**
- SD.SINISTROS.LISTAR (visualizar lista de sinistros)
- SD.SINISTROS.CREATE (registrar novo sinistro)
- SD.SINISTROS.UPDATE_STATUS (atualizar status - workflow)
- SD.SINISTROS.DASHBOARD (visualizar KPIs de sinistros)

---

**FIM DO DOCUMENTO RF092 v2.0**
