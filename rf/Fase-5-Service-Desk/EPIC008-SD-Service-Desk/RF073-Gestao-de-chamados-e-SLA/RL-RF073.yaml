# Template de Referência ao Legado (RL-RF073.yaml)
# Versão: 2.0
# Data: 2025-12-30
# Autor: Agência ALC - alc.dev.br

rf_id: RF073
titulo: "Gestão de Chamados e SLA"

legado:
  sistema: "VB.NET + ASP.NET Web Forms"
  versao: "ASP.NET 4.x + SQL Server 2012+"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server multi-database (SC_CLIENTE_NOME)"
  multi_tenant: false
  auditoria: "partial"  # Triggers SQL (não estruturada)

# SEÇÃO CRÍTICA: Referencias ao Legado com Destino Obrigatório
# Cada item DEVE ter campo "destino" preenchido
referencias:
  # ------------------------------------------------------------------------------
  # TELAS ASPX
  # ------------------------------------------------------------------------------
  - id: "LEG-RF073-001"
    tipo: "tela"
    nome: "Chamado.aspx (Listagem de Chamados)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado.aspx"
    descricao: |
      Listagem de chamados com filtros por status, prioridade, categoria e técnico.
      Grid paginado (50 registros/página), refresh automático 30 segundos.
      Campos: Número, Descrição (truncado 100 chars), Status, Prioridade, SLA, Atribuído a, Criado em.
      Comportamentos: ViewState para paginação, filtros não persistentes, sem ordenação customizada.
    destino: "substituido"
    justificativa: |
      Tela legada substituída por componente Angular com paginação otimizada, filtros persistentes,
      ordenação customizada e RBAC (usuário vê apenas seus chamados ou da equipe).
    rf_item_relacionado: "RN-RF073-01"
    uc_relacionado: "UC00"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF073-002"
    tipo: "tela"
    nome: "Chamado_Consulta.aspx (Detalhes do Chamado)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_Consulta.aspx"
    descricao: |
      Exibe detalhes completos: Número, Solicitante, Descrição, Categoria, Prioridade, Status,
      Ativos Afetados, Datas (Criação/Resposta/Resolução), SLA Status, Comentários, Anexos.
      Comportamentos: Comentários sem flag interno/externo, SLA calculado real-time (lento),
      anexos sem antivírus, edição inline status sem confirmação.
    destino: "substituido"
    justificativa: |
      Substituída por tela Angular com comentários internos/externos, SLA pré-calculado via job,
      anexos com antivírus, confirmação obrigatória para mudanças críticas.
    rf_item_relacionado: "RN-RF073-07, RN-RF073-09"
    uc_relacionado: "UC02"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF073-003"
    tipo: "tela"
    nome: "Chamado_Solicitacao.aspx (Abrir Novo Chamado)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_Solicitacao.aspx"
    descricao: |
      Formulário: Descrição (min 10 chars - deveria ser 20), Categoria (3 níveis cascata),
      Prioridade (manual), Ativos (CheckBoxList), Contato, Anexo (sem limite tamanho).
      Comportamentos: Prioridade fixa (não calcula matriz), cascata via PostBack (lento),
      upload sem validação, sem detecção automática de contrato.
    destino: "substituido"
    justificativa: |
      Substituída por formulário Angular com validações rigorosas (min 20 chars),
      matriz Impacto x Urgência automática, upload limitado 5MB, detecção automática de contrato via ativo.
    rf_item_relacionado: "RN-RF073-01, RN-RF073-02, RN-RF073-11"
    uc_relacionado: "UC01"
    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF073-004"
    tipo: "tela"
    nome: "Chamado_SLA_Consulta.aspx (Monitoramento de SLA)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_SLA_Consulta.aspx"
    descricao: |
      Dashboard KPIs: Taxa Conformidade, Chamados Vencidos, Em Risco, Tempo Médio Resposta/Resolução.
      Comportamentos: Cálculo real-time sem cache (lento), sem filtro período, sem drill-down,
      gráficos PNG gerados server-side (GDI+).
    destino: "substituido"
    justificativa: |
      Substituído por dashboard Angular com ApexCharts, cache Redis (5 min), filtros período,
      drill-down para listas detalhadas.
    rf_item_relacionado: "RN-RF073-06"
    uc_relacionado: "UC10"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF073-005"
    tipo: "tela"
    nome: "Chamado_Fila_Atendimento.aspx (Gestão de Filas)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_Fila_Atendimento.aspx"
    descricao: |
      Criar/editar filas: Nome, Descrição, Técnicos (CheckBoxList).
      Comportamentos: Sem skill-based routing automático, atribuição manual,
      sem validação disponibilidade técnico, filas não mapeadas a categorias.
    destino: "assumido"
    justificativa: |
      Conceito de filas mantido mas com melhorias: skill-based routing automático,
      load balancing, mapeamento automático categoria → fila.
    rf_item_relacionado: "RN-RF073-05"
    uc_relacionado: "UC09"
    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF073-006"
    tipo: "tela"
    nome: "Chamado_Data_Parada.aspx (Registrar Parada)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_Data_Parada.aspx"
    descricao: |
      Registrar downtime: Data Início, Data Fim, Motivo.
      Comportamentos: Recálculo manual SLA (não automático), sem validação sobreposição,
      paradas sem auditoria, sem limite quantidade paradas.
    destino: "assumido"
    justificativa: |
      Funcionalidade mantida com melhorias: recálculo automático SLA via job,
      validação sobreposição, auditoria completa (quem criou/alterou).
    rf_item_relacionado: "RN-RF073-04"
    uc_relacionado: "UC08"
    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 3

  # ------------------------------------------------------------------------------
  # WEBSERVICES
  # ------------------------------------------------------------------------------
  - id: "LEG-RF073-007"
    tipo: "webservice"
    nome: "WSChamado.asmx - Solicitacao_Incluir"
    caminho: "ic1_legado/WS_IControlIT/WSChamado.asmx.vb"
    descricao: |
      Método SOAP para criar chamado via XML. Recebe xmlDados (string), retorna XML com ID ou erro.
      Comportamentos: Autenticação Basic Auth, XML parsing manual (vulnerável XXE),
      sem rate limiting, erros genéricos.
    destino: "substituido"
    justificativa: |
      Substituído por REST API POST /api/tickets com JWT, JSON, OpenAPI/Swagger,
      validação FluentValidation, erros estruturados HTTP 400/500.
    rf_item_relacionado: "RN-RF073-01"
    uc_relacionado: "UC01"
    migracao_moderna:
      endpoint_moderno: "POST /api/tickets"
      autenticacao: "JWT Bearer Token"
      formato: "JSON"

  - id: "LEG-RF073-008"
    tipo: "webservice"
    nome: "WSChamado.asmx - Solicitacao_Atualizar"
    caminho: "ic1_legado/WS_IControlIT/WSChamado.asmx.vb"
    descricao: |
      Método SOAP para atualizar status/prioridade. Sem validação de transição de estado.
    destino: "substituido"
    justificativa: |
      Substituído por REST API PUT /api/tickets/{id} com validação de transições permitidas.
    rf_item_relacionado: "RN-RF073-03"
    uc_relacionado: "UC03"
    migracao_moderna:
      endpoint_moderno: "PUT /api/tickets/{id}"

  - id: "LEG-RF073-009"
    tipo: "webservice"
    nome: "WSChamado.asmx - Solicitacao_Detalhes"
    caminho: "ic1_legado/WS_IControlIT/WSChamado.asmx.vb"
    descricao: |
      Retorna DataSet em XML. Performance ruim (lazy loading N+1 queries).
    destino: "substituido"
    justificativa: |
      Substituído por GET /api/tickets/{id} com eager loading (Include), retorna JSON estruturado.
    rf_item_relacionado: null
    uc_relacionado: "UC02"
    migracao_moderna:
      endpoint_moderno: "GET /api/tickets/{id}"

  - id: "LEG-RF073-010"
    tipo: "webservice"
    nome: "WSChamado.asmx - Solicitacao_SLA_Recalcular"
    caminho: "ic1_legado/WS_IControlIT/WSChamado.asmx.vb"
    descricao: |
      Recalcula SLA manualmente (usado em batch noturno).
    destino: "substituido"
    justificativa: |
      Substituído por Job Hangfire automático (a cada 5 min), não requer chamada manual.
    rf_item_relacionado: "RN-RF073-06"
    uc_relacionado: null
    migracao_moderna:
      job_hangfire: "SlaRecalculationJob (Cron: */5 * * * *)"

  - id: "LEG-RF073-011"
    tipo: "webservice"
    nome: "ServiceNow/Handler.asmx - ProcessIncidentUpdate"
    caminho: "ic1_legado/WS_IControlIT/Connect/ServiceNow/Handler.asmx"
    descricao: |
      Recebe webhooks ServiceNow (XML), cria/atualiza chamados IControlIT.
      Comportamentos: Sincronização unidirecional (ServiceNow → IControlIT), sem retry,
      mapeamento manual hardcoded, sem validação signature.
    destino: "substituido"
    justificativa: |
      Substituído por integração bidirecional (IControlIT ↔ ServiceNow) com mapeamento automático,
      retry com Polly, validação HMAC signature.
    rf_item_relacionado: "RN-RF073-10"
    uc_relacionado: null
    migracao_moderna:
      endpoint_moderno: "POST /api/webhooks/servicenow"
      validacao: "HMAC SHA256 signature"

  # ------------------------------------------------------------------------------
  # STORED PROCEDURES
  # ------------------------------------------------------------------------------
  - id: "LEG-RF073-012"
    tipo: "stored_procedure"
    nome: "pa_Solicitacao_Incluir"
    caminho: "Database/Procedures/pa_Solicitacao_Incluir.sql"
    descricao: |
      Cria chamado: valida usuário/categoria, calcula próximo ID (MAX+1), insere Solicitacao,
      calcula SLA, insere Solicitacao_SLA.
      Problemas: Race condition (MAX+1 não thread-safe), sem transaction,
      validações espalhadas entre VB.NET e SQL.
    destino: "substituido"
    justificativa: |
      Lógica movida para CreateTicketCommandHandler (CQRS) com IDbContextTransaction,
      GUID em vez de INT sequencial (elimina race condition).
    rf_item_relacionado: "RN-RF073-01, RN-RF073-03"
    uc_relacionado: "UC01"
    migracao_moderna:
      handler: "CreateTicketCommandHandler"
      validacao: "CreateTicketCommandValidator (FluentValidation)"

  - id: "LEG-RF073-013"
    tipo: "stored_procedure"
    nome: "pa_Solicitacao_SLA_Recalcular"
    caminho: "Database/Procedures/pa_Solicitacao_SLA_Recalcular.sql"
    descricao: |
      Recalcula SLA: cursor SQL (RBAR), calcula tempo decorrido, subtrai paradas,
      compara com data esperada, atualiza Status SLA.
      Problemas: Performance (cursor), lock escalation (deadlocks),
      não considera horário comercial.
    destino: "substituido"
    justificativa: |
      Substituído por Job Hangfire com batch processing set-based,
      índices otimizados, consideração horário comercial.
    rf_item_relacionado: "RN-RF073-06"
    uc_relacionado: null
    migracao_moderna:
      job_hangfire: "SlaRecalculationJob"
      otimizacao: "Batch set-based em vez de cursor"

  - id: "LEG-RF073-014"
    tipo: "stored_procedure"
    nome: "pa_Solicitacao_Lista"
    caminho: "Database/Procedures/pa_Solicitacao_Lista.sql"
    descricao: |
      Listagem paginada: múltiplos JOINs, filtra por Fornecedor/status/prioridade,
      OFFSET/FETCH para paginação.
      Problemas: N+1 queries (anexos buscados em loop VB.NET), sem índices compostos,
      sem cache (query idêntica a cada 30s).
    destino: "substituido"
    justificativa: |
      Substituído por Query LINQ com Include() (eager loading), índices compostos,
      cache Redis (5 min).
    rf_item_relacionado: null
    uc_relacionado: "UC00"
    migracao_moderna:
      query: "GetTicketsQuery"
      cache: "Redis (5 min TTL)"

  # ------------------------------------------------------------------------------
  # TABELAS LEGADAS
  # ------------------------------------------------------------------------------
  - id: "LEG-RF073-015"
    tipo: "tabela"
    nome: "Solicitacao"
    caminho: "Database/dbo.Solicitacao"
    descricao: |
      Tabela principal: Id_Solicitacao (PK), Cd_Fornecedor, Cd_Usuario, Cd_Prioridade,
      Ds_Solicitacao, Dt_Criacao, St_Solicitacao, Cd_Usuario_Atribuido, Fl_Excluido.
      Problemas: Cd_Fornecedor sem FK, St_Solicitacao VARCHAR sem constraint,
      sem auditoria nativa, soft delete sem índice, sem ParentTicketId.
    destino: "substituido"
    justificativa: |
      Tabela redesenhada como Ticket: GUID PK, FK com constraint, Status Enum,
      auditoria automática (Created/Modified), soft delete indexado, ParentTicketId para reabertura.
    rf_item_relacionado: "RN-RF073-01, RN-RF073-08, RN-RF073-12"
    uc_relacionado: "UC01"
    migracao_moderna:
      tabela_moderna: "Ticket"
      migration_ef_core: "20251230_CreateTicketTable.cs"

  - id: "LEG-RF073-016"
    tipo: "tabela"
    nome: "Solicitacao_SLA"
    caminho: "Database/dbo.Solicitacao_SLA"
    descricao: |
      Controle SLA: Dt_Resposta_Esperada, Dt_Resolucao_Esperada, Dt_Resposta_Real,
      Dt_Resolucao_Real, St_SLA.
      Problemas: Sem FK cascade, St_SLA VARCHAR (aceita valores inválidos),
      sem histórico mudanças, não armazena pausas (calculado on-the-fly).
    destino: "substituido"
    justificativa: |
      Redesenhada como TicketSLA com FK cascade, Status Enum,
      campo TempoSuspenso (TimeSpan pré-calculado).
    rf_item_relacionado: "RN-RF073-03, RN-RF073-06"
    uc_relacionado: null
    migracao_moderna:
      tabela_moderna: "TicketSLA"
      migration_ef_core: "20251230_CreateTicketSLATable.cs"

  - id: "LEG-RF073-017"
    tipo: "tabela"
    nome: "Solicitacao_Data_Parada"
    caminho: "Database/dbo.Solicitacao_Data_Parada"
    descricao: |
      Registro downtime: Dt_Inicio, Dt_Fim, Ds_Motivo.
      Problemas: Sem validação Dt_Fim > Dt_Inicio, sem auditoria (quem criou/alterou),
      sem validação sobreposição.
    destino: "assumido"
    justificativa: |
      Mantida como TicketDowntime com melhorias: constraint CHECK (DataFim > DataInicio),
      auditoria (Created/CreatedBy), validação sobreposição no handler.
    rf_item_relacionado: "RN-RF073-04"
    uc_relacionado: "UC08"
    migracao_moderna:
      tabela_moderna: "TicketDowntime"
      migration_ef_core: "20251230_CreateTicketDowntimeTable.cs"

  - id: "LEG-RF073-018"
    tipo: "tabela"
    nome: "Solicitacao_Fila_Atendimento"
    caminho: "Database/dbo.Solicitacao_Fila_Atendimento"
    descricao: |
      Filas atendimento: Nm_Fila, Ds_Fila, Cd_Fornecedor.
      Problemas: Sem relação N:N com técnicos (lista IDs em VARCHAR),
      sem skill set estruturado.
    destino: "assumido"
    justificativa: |
      Mantida como QueueAtendimento com melhorias: tabela junction QueueTecnico (N:N),
      campo SkillSet (JSON ou normalizado), mapeamento automático categoria → fila.
    rf_item_relacionado: "RN-RF073-05"
    uc_relacionado: "UC09"
    migracao_moderna:
      tabela_moderna: "QueueAtendimento + QueueTecnico (junction)"
      migration_ef_core: "20251230_CreateQueueTables.cs"

  # ------------------------------------------------------------------------------
  # REGRAS IMPLÍCITAS
  # ------------------------------------------------------------------------------
  - id: "LEG-RF073-019"
    tipo: "regra_negocio"
    nome: "Número de chamado sequencial por cliente"
    caminho: "Database/Procedures/pa_Solicitacao_Incluir.sql"
    descricao: |
      Número gerado como MAX(Id_Solicitacao) + 1 WHERE Cd_Fornecedor = @Cd_Fornecedor.
      Formato exibido: CHD-YYYY-NNN (ex: CHD-2025-001).
      Localização código: Linha 45 de pa_Solicitacao_Incluir.sql
    destino: "assumido"
    justificativa: |
      Numeração sequencial mantida mas usando SEQUENCE SQL Server (thread-safe) em vez de MAX+1.
    rf_item_relacionado: "RN-RF073-01"
    uc_relacionado: "UC01"
    migracao_moderna:
      implementacao: "SQL Server SEQUENCE + formato CHD-{Year}-{Sequence:D6}"

  - id: "LEG-RF073-020"
    tipo: "regra_negocio"
    nome: "Prioridade fixa por cliente específico (hardcoded)"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado.aspx.vb"
    descricao: |
      Cliente "Empresa XYZ" (Cd_Fornecedor=5) sempre recebe P1,
      independente de impacto/urgência.
      Localização código: Linha 123 de Chamado.aspx.vb
    destino: "descartado"
    justificativa: |
      Regra de exceção não documentada, será substituída por matriz Impacto x Urgência universal.
      Clientes VIP podem configurar SLA diferenciado via contrato (RF029).
    rf_item_relacionado: "RN-RF073-02"
    uc_relacionado: null

  - id: "LEG-RF073-021"
    tipo: "regra_negocio"
    nome: "SLA pausa durante finais de semana"
    caminho: "Database/Procedures/pa_Solicitacao_SLA_Recalcular.sql"
    descricao: |
      Chamado criado sexta-feira pós-18h, SLA inicia segunda-feira 08h.
      Localização código: Linha 78 de pa_Solicitacao_SLA_Recalcular.sql
    destino: "assumido"
    justificativa: |
      Regra válida, será configurável via tabela HorarioComercial (RF029).
    rf_item_relacionado: "RN-RF073-03"
    uc_relacionado: null
    migracao_moderna:
      configuracao: "Tabela HorarioComercial (Dia semana, HoraInicio, HoraFim)"

  - id: "LEG-RF073-022"
    tipo: "regra_negocio"
    nome: "Comentários com palavra 'urgente' escalam automaticamente"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_Consulta.aspx.vb"
    descricao: |
      Comentário contém 'urgente' ou 'crítico' → Prioridade elevada para P1.
      Localização código: Linha 234 de Chamado_Consulta.aspx.vb
    destino: "descartado"
    justificativa: |
      Regra não documentada, facilmente abusável. Escalação manual via Manager.
    rf_item_relacionado: null
    uc_relacionado: null

  - id: "LEG-RF073-023"
    tipo: "regra_negocio"
    nome: "Técnico não pode fechar próprio chamado"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado_Consulta.aspx.vb"
    descricao: |
      Se usuário logado é técnico atribuído, botão "Fechar" desabilitado.
      Apenas Manager pode fechar.
      Localização código: Linha 567 de Chamado_Consulta.aspx.vb
    destino: "descartado"
    justificativa: |
      Regra restritiva sem justificativa. Moderno permitirá técnico fechar após resolver
      (status Resolvido → Fechado automático após 24h sem reabertura).
    rf_item_relacionado: null
    uc_relacionado: "UC04"

  - id: "LEG-RF073-024"
    tipo: "regra_negocio"
    nome: "Reabertura dentro 48h não gera novo chamado"
    caminho: "ic1_legado/IControlIT/Chamado/Chamado.aspx.vb"
    descricao: |
      Reabertura < 48h: reverte status para "Em Andamento" (não cria novo).
      Reabertura > 48h: cria novo chamado.
      Localização código: Linha 789 de Chamado.aspx.vb
    destino: "a_revisar"
    justificativa: |
      Regra de janela temporal pode ser válida, mas precisa decisão negócio se 48h adequado.
      Sugere-se sempre criar novo (melhora auditoria).
    rf_item_relacionado: "RN-RF073-08"
    uc_relacionado: "UC05"
    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 4

  - id: "LEG-RF073-025"
    tipo: "regra_negocio"
    nome: "Primeiro comentário técnico define data de resposta"
    caminho: "Database/Procedures/pa_Solicitacao_Atualizar.sql"
    descricao: |
      Campo Dt_Resposta_Real preenchido no momento do primeiro comentário técnico
      (não no momento da atribuição).
      Localização código: Linha 123 de pa_Solicitacao_Atualizar.sql
    destino: "assumido"
    justificativa: |
      Regra válida. Atribuição automática não conta como resposta; apenas comentário explícito.
    rf_item_relacionado: "RN-RF073-03"
    uc_relacionado: "UC06"

  - id: "LEG-RF073-026"
    tipo: "regra_negocio"
    nome: "Chamados P1 sem resposta em 30 min escalam para CEO"
    caminho: "Database/Jobs/SQL_Agent_Escalacao_P1.sql"
    descricao: |
      Job SQL a cada 10 min, busca P1 sem resposta há > 30 min, envia email CEO.
      Localização: SQL Server Agent Job 'Escalacao_P1' (não documentado no código VB.NET)
    destino: "assumido"
    justificativa: |
      Regra válida mas email CEO excessivo. Moderno escalará:
      Supervisor fila (30 min) → Manager (1h) → CEO (2h).
    rf_item_relacionado: "RN-RF073-06"
    uc_relacionado: null
    migracao_moderna:
      escalacao: "3 níveis (Supervisor → Manager → CEO)"

  - id: "LEG-RF073-027"
    tipo: "regra_negocio"
    nome: "Integração ServiceNow só para cliente 'Banco ABC'"
    caminho: "ic1_legado/IControlIT/Web.config"
    descricao: |
      Sincronização ServiceNow habilitada apenas para Cd_Fornecedor=12.
      Localização: Web.config <appSettings key='ServiceNow_ClienteId' value='12'/>
    destino: "assumido"
    justificativa: |
      Integração será configurável via Feature Flag (SERVICEDESK_SERVICENOW_SYNC) ativada por cliente.
    rf_item_relacionado: "RN-RF073-10"
    uc_relacionado: null
    migracao_moderna:
      feature_flag: "SERVICEDESK_SERVICENOW_SYNC (habilitado por ClienteId)"

# Gap Analysis (Legado x Moderno)
gap_analysis:
  - item: "Priorização automática via matriz Impacto x Urgência"
    existe_legado: false
    existe_moderno: true
    notas: "Legado usa priorização manual (usuário escolhe P1-P4). Moderno calcula automaticamente."

  - item: "Skill-based routing automático"
    existe_legado: false
    existe_moderno: true
    notas: "Legado requer atribuição manual por Manager. Moderno roteia automaticamente por competência e carga."

  - item: "Comentários internos vs externos"
    existe_legado: false
    existe_moderno: true
    notas: "Legado não distingue visibilidade. Moderno separa Interno (equipe) vs Externo (cliente)."

  - item: "Notificações real-time via SignalR"
    existe_legado: false
    existe_moderno: true
    notas: "Legado usa refresh automático 30s (polling). Moderno usa SignalR (push real-time)."

  - item: "Integração ServiceNow bidirecional"
    existe_legado: false  # Legado é unidirecional
    existe_moderno: true
    notas: "Legado: Snow → IC apenas. Moderno: IC ↔ Snow (bidirecional)."

  - item: "Anexos com antivírus obrigatório"
    existe_legado: false
    existe_moderno: true
    notas: "Legado aceita upload direto sem scanning. Moderno exige antivírus antes de armazenar."

  - item: "Auditoria estruturada com retenção 7 anos"
    existe_legado: false  # Legado tem triggers SQL (parcial)
    existe_moderno: true
    notas: "Legado usa triggers SQL não estruturados. Moderno tem middleware + tabela dedicada."

  - item: "Multi-tenancy single database (RLS)"
    existe_legado: false  # Legado usa multi-database
    existe_moderno: true
    notas: "Legado: banco separado por cliente. Moderno: single database com ClienteId (Row-Level Security)."

# Metadados
metadados:
  total_itens_legado: 27
  itens_assumidos: 9
  itens_substituidos: 16
  itens_descartados: 3
  itens_a_revisar: 1
  cobertura_destinos: "100%"

# Changelog
changelog:
  - versao: "1.0"
    data: "2025-12-30"
    descricao: "Documentação inicial de referência ao legado - 27 itens rastreados com 100% destinos definidos"
    autor: "Agência ALC - alc.dev.br"
