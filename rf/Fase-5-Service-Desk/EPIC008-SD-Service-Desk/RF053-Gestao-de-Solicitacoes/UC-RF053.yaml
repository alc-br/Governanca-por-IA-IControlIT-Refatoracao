# =============================================
# UC - Casos de Uso RF053 - Gestão de Solicitações
# Versão: 2.0
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF053"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Solicitações"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-02"
        - "RN-RF053-01"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade Solicitações pelo menu"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão (VIEW_OWN ou VIEW_ALL)"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega solicitações do tenant com filtro de permissão"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação (50 registros por página)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe lista com indicadores visuais de status e SLA"
          required: true
        - id: "FA-UC00-001"
          title: "Buscar por número, título ou solicitante"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por status, tipo, prioridade, período"
          required: false
        - id: "FA-UC00-003"
          title: "Ordenar por data, prioridade, SLA"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → acesso negado HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhuma solicitação → estado vazio exibido"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.VIEW_OWN ou GES.SOLICITACOES.VIEW_ALL"

    gatilho: "Usuario acessa a funcionalidade Solicitações pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu_solicitacoes"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_solicitacoes_tenant_filtrado_por_permissao"
      - passo: 4
        ator: "sistema"
        acao: "exibir_lista_com_indicadores"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado_403"

    regras_aplicadas:
      - "RN-RF053-01"

    resultado_final:
      estado: "lista_solicitacoes_exibida"

  - id: "UC01"
    nome: "Criar Solicitação"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-01"
        - "RN-RF053-01"
        - "RN-RF053-02"
        - "RN-RF053-03"
        - "RN-RF053-04"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Novo"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão CREATE"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário com campos dinâmicos do tipo"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário preenche tipo, título, descrição, impacto"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema calcula prioridade automaticamente"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema valida campos obrigatórios"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema cria solicitação com status ABERTA"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema dispara workflow de aprovação se configurado"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema envia notificação para aprovadores"
          required: true
        - id: "FA-UC01-001"
          title: "Anexar arquivos durante criação"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação"
          required: false
        - id: "FE-UC01-001"
          title: "Erro de validação → exibir mensagens estruturadas"
          required: true
        - id: "FE-UC01-002"
          title: "Tipo inativo → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.CREATE"

    gatilho: "Usuario clica em Novo"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "exibir_formulario_dinamico"
      - passo: 2
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 3
        ator: "sistema"
        acao: "calcular_prioridade"
      - passo: 4
        ator: "usuario"
        acao: "salvar"
      - passo: 5
        ator: "sistema"
        acao: "validar_dados"
      - passo: 6
        ator: "sistema"
        acao: "criar_solicitacao"
      - passo: 7
        ator: "sistema"
        acao: "disparar_workflow"
      - passo: 8
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros"

    regras_aplicadas:
      - "RN-RF053-01"
      - "RN-RF053-02"
      - "RN-RF053-03"
      - "RN-RF053-04"

    resultado_final:
      estado: "solicitacao_criada"

  - id: "UC02"
    nome: "Visualizar Solicitação"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-03"
        - "RN-RF053-01"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário clica em uma solicitação na listagem"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão (VIEW_OWN ou VIEW_ALL)"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema carrega dados completos da solicitação"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema exibe linha do tempo de histórico"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe chat com mensagens"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema exibe anexos com botões de download"
          required: true
        - id: "FP-UC02-007"
          title: "Sistema exibe indicador de SLA com % consumido"
          required: true
        - id: "FA-UC02-001"
          title: "Expandir/recolher seções"
          required: false
        - id: "FE-UC02-001"
          title: "Solicitação não encontrada → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Acesso negado por permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.VIEW_OWN ou GES.SOLICITACOES.VIEW_ALL"

    gatilho: "Usuario clica em uma solicitacao na listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_solicitacao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados_completos"
      - passo: 4
        ator: "sistema"
        acao: "exibir_detalhes_com_timeline"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "solicitacao_nao_encontrada"
        resultado: "http_404"

    regras_aplicadas:
      - "RN-RF053-01"

    resultado_final:
      estado: "detalhes_solicitacao_exibidos"

  - id: "UC03"
    nome: "Editar Solicitação"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-04"
        - "RN-RF053-05"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário clica em Editar na visualização"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão UPDATE"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida status (apenas ABERTA ou EM_APROVACAO)"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema exibe formulário preenchido"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário modifica campos permitidos"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema atualiza registro no banco"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema reinicia workflow de aprovação"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema registra auditoria com alterações"
          required: true
        - id: "FE-UC03-001"
          title: "Status não permite edição → HTTP 400"
          required: true
        - id: "FE-UC03-002"
          title: "Erro de validação → exibir mensagens"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.UPDATE"
      - status_permitido: "ABERTA ou EM_APROVACAO"

    gatilho: "Usuario clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "validar_status_edicao"
      - passo: 2
        ator: "sistema"
        acao: "exibir_formulario_preenchido"
      - passo: 3
        ator: "usuario"
        acao: "modificar_campos"
      - passo: 4
        ator: "usuario"
        acao: "salvar"
      - passo: 5
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 6
        ator: "sistema"
        acao: "atualizar_registro"
      - passo: 7
        ator: "sistema"
        acao: "reiniciar_workflow"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "status_invalido_para_edicao"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-05"

    resultado_final:
      estado: "solicitacao_atualizada"

  - id: "UC04"
    nome: "Aprovar ou Rejeitar Solicitação"
    ator_principal: "aprovador"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-03"
        - "RN-RF053-04"
      uc_items:
        - id: "FP-UC04-001"
          title: "Aprovador acessa solicitação pendente"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida se é aprovador do nível atual"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema exibe botões Aprovar/Rejeitar"
          required: true
        - id: "FP-UC04-004"
          title: "Aprovador clica em Aprovar ou Rejeitar"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema solicita justificativa (obrigatória se rejeitar)"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema valida justificativa (mín 20 caracteres)"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema registra aprovação/rejeição no banco"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema incrementa NivelAprovacaoAtual"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema notifica próximo aprovador ou atendentes"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC04-001"
          title: "Aprovar via mobile com token temporário"
          required: false
        - id: "FE-UC04-001"
          title: "Aprovador inválido → HTTP 403"
          required: true
        - id: "FE-UC04-002"
          title: "Justificativa inválida → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.APPROVE"
      - status: "EM_APROVACAO"

    gatilho: "Aprovador acessa solicitacao pendente"

    fluxo_principal:
      - passo: 1
        ator: "aprovador"
        acao: "acessar_solicitacao"
      - passo: 2
        ator: "sistema"
        acao: "validar_aprovador_nivel"
      - passo: 3
        ator: "aprovador"
        acao: "clicar_aprovar_ou_rejeitar"
      - passo: 4
        ator: "sistema"
        acao: "solicitar_justificativa"
      - passo: 5
        ator: "aprovador"
        acao: "informar_justificativa"
      - passo: 6
        ator: "sistema"
        acao: "registrar_decisao"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_workflow"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "aprovador_invalido"
        resultado: "http_403"

    regras_aplicadas:
      - "RN-RF053-03"
      - "RN-RF053-04"

    resultado_final:
      estado: "decisao_registrada"

  - id: "UC05"
    nome: "Atribuir Solicitação a Atendente"
    ator_principal: "coordenador"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-06"
      uc_items:
        - id: "FP-UC05-001"
          title: "Coordenador acessa solicitação aprovada"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema valida permissão ASSIGN"
          required: true
        - id: "FP-UC05-003"
          title: "Sistema exibe dropdown de atendentes disponíveis"
          required: true
        - id: "FP-UC05-004"
          title: "Coordenador seleciona atendente e confirma"
          required: true
        - id: "FP-UC05-005"
          title: "Sistema atribui solicitação ao atendente"
          required: true
        - id: "FP-UC05-006"
          title: "Sistema muda status para EM_ATENDIMENTO"
          required: true
        - id: "FP-UC05-007"
          title: "Sistema envia notificação para atendente"
          required: true
        - id: "FP-UC05-008"
          title: "Sistema registra auditoria"
          required: true
        - id: "FA-UC05-001"
          title: "Reatribuir para outro atendente"
          required: false
        - id: "FE-UC05-001"
          title: "Atendente inválido → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.ASSIGN"
      - status: "APROVADA"

    gatilho: "Coordenador clica em Atribuir"

    fluxo_principal:
      - passo: 1
        ator: "coordenador"
        acao: "acessar_solicitacao_aprovada"
      - passo: 2
        ator: "sistema"
        acao: "exibir_dropdown_atendentes"
      - passo: 3
        ator: "coordenador"
        acao: "selecionar_atendente"
      - passo: 4
        ator: "sistema"
        acao: "atribuir_e_mudar_status"
      - passo: 5
        ator: "sistema"
        acao: "notificar_atendente"

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "atendente_invalido"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-06"

    resultado_final:
      estado: "solicitacao_atribuida"

  - id: "UC06"
    nome: "Adicionar Comentário ou Mensagem no Chat"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-12"
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário acessa solicitação"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema exibe chat na aba Conversas"
          required: true
        - id: "FP-UC06-003"
          title: "Usuário digita mensagem"
          required: true
        - id: "FP-UC06-004"
          title: "Usuário marca como Pública ou Interna"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema valida comprimento (máx 4000 caracteres)"
          required: true
        - id: "FP-UC06-006"
          title: "Sistema salva mensagem no banco"
          required: true
        - id: "FP-UC06-007"
          title: "Sistema notifica usuários via SignalR"
          required: true
        - id: "FP-UC06-008"
          title: "Sistema exibe mensagem no chat instantaneamente"
          required: true
        - id: "FA-UC06-001"
          title: "Adicionar @menção em comentário"
          required: false
        - id: "FE-UC06-001"
          title: "Mensagem muito longa → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.UPDATE ou VIEW_OWN"

    gatilho: "Usuario digita mensagem e clica Enviar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_conversas"
      - passo: 2
        ator: "usuario"
        acao: "digitar_mensagem"
      - passo: 3
        ator: "usuario"
        acao: "selecionar_visibilidade"
      - passo: 4
        ator: "usuario"
        acao: "enviar"
      - passo: 5
        ator: "sistema"
        acao: "validar_mensagem"
      - passo: 6
        ator: "sistema"
        acao: "salvar_e_notificar_signalr"

    fluxos_excecao:
      - id: "FE-UC06-01"
        condicao: "mensagem_muito_longa"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-12"

    resultado_final:
      estado: "mensagem_enviada"

  - id: "UC07"
    nome: "Anexar Arquivos"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-11"
      uc_items:
        - id: "FP-UC07-001"
          title: "Usuário acessa aba Anexos"
          required: true
        - id: "FP-UC07-002"
          title: "Usuário clica em Adicionar Arquivo"
          required: true
        - id: "FP-UC07-003"
          title: "Sistema abre seletor de arquivos"
          required: true
        - id: "FP-UC07-004"
          title: "Usuário seleciona arquivo (máx 10MB)"
          required: true
        - id: "FP-UC07-005"
          title: "Sistema valida tamanho e tipo (jpg, png, pdf, docx)"
          required: true
        - id: "FP-UC07-006"
          title: "Sistema executa scan antivirus"
          required: true
        - id: "FP-UC07-007"
          title: "Sistema faz upload para Azure Blob Storage"
          required: true
        - id: "FP-UC07-008"
          title: "Sistema salva registro de anexo no banco"
          required: true
        - id: "FP-UC07-009"
          title: "Sistema exibe anexo na lista"
          required: true
        - id: "FA-UC07-001"
          title: "Fazer upload de múltiplos arquivos"
          required: false
        - id: "FE-UC07-001"
          title: "Arquivo muito grande → HTTP 413"
          required: true
        - id: "FE-UC07-002"
          title: "Tipo de arquivo não permitido → HTTP 400"
          required: true
        - id: "FE-UC07-003"
          title: "Vírus detectado → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.UPDATE"

    gatilho: "Usuario clica em Adicionar Arquivo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_adicionar_arquivo"
      - passo: 2
        ator: "sistema"
        acao: "abrir_seletor"
      - passo: 3
        ator: "usuario"
        acao: "selecionar_arquivo"
      - passo: 4
        ator: "sistema"
        acao: "validar_tamanho_tipo"
      - passo: 5
        ator: "sistema"
        acao: "scan_antivirus"
      - passo: 6
        ator: "sistema"
        acao: "upload_azure_blob"
      - passo: 7
        ator: "sistema"
        acao: "salvar_registro_anexo"

    fluxos_excecao:
      - id: "FE-UC07-01"
        condicao: "arquivo_muito_grande"
        resultado: "http_413"
      - id: "FE-UC07-02"
        condicao: "virus_detectado"
        resultado: "http_400_virus"

    regras_aplicadas:
      - "RN-RF053-11"

    resultado_final:
      estado: "arquivo_anexado"

  - id: "UC08"
    nome: "Fechar Solicitação com Solução"
    ator_principal: "atendente"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-07"
        - "RN-RF053-13"
      uc_items:
        - id: "FP-UC08-001"
          title: "Atendente acessa solicitação em atendimento"
          required: true
        - id: "FP-UC08-002"
          title: "Sistema valida permissão CLOSE"
          required: true
        - id: "FP-UC08-003"
          title: "Atendente clica em Fechar"
          required: true
        - id: "FP-UC08-004"
          title: "Sistema exibe modal com campos obrigatórios"
          required: true
        - id: "FP-UC08-005"
          title: "Atendente informa solução aplicada (mín 50 caracteres)"
          required: true
        - id: "FP-UC08-006"
          title: "Sistema valida campos"
          required: true
        - id: "FP-UC08-007"
          title: "Sistema muda status para FECHADA"
          required: true
        - id: "FP-UC08-008"
          title: "Sistema registra data de fechamento"
          required: true
        - id: "FP-UC08-009"
          title: "Sistema dispara pesquisa NPS automática"
          required: true
        - id: "FP-UC08-010"
          title: "Sistema cria ativo se solicitação for aquisição"
          required: true
        - id: "FP-UC08-011"
          title: "Sistema registra auditoria"
          required: true
        - id: "FE-UC08-001"
          title: "Solução muito curta → HTTP 400"
          required: true
        - id: "FE-UC08-002"
          title: "Status inválido → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.CLOSE"
      - status: "EM_ATENDIMENTO"

    gatilho: "Atendente clica em Fechar"

    fluxo_principal:
      - passo: 1
        ator: "atendente"
        acao: "clicar_fechar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_modal_solucao"
      - passo: 3
        ator: "atendente"
        acao: "informar_solucao"
      - passo: 4
        ator: "sistema"
        acao: "validar_solucao"
      - passo: 5
        ator: "sistema"
        acao: "fechar_solicitacao"
      - passo: 6
        ator: "sistema"
        acao: "disparar_nps"
      - passo: 7
        ator: "sistema"
        acao: "criar_ativo_se_aplicavel"

    fluxos_excecao:
      - id: "FE-UC08-01"
        condicao: "solucao_muito_curta"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-07"
      - "RN-RF053-13"

    resultado_final:
      estado: "solicitacao_fechada"

  - id: "UC09"
    nome: "Cancelar Solicitação"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-08"
      uc_items:
        - id: "FP-UC09-001"
          title: "Usuário acessa solicitação própria"
          required: true
        - id: "FP-UC09-002"
          title: "Sistema valida permissão (VIEW_OWN ou DELETE)"
          required: true
        - id: "FP-UC09-003"
          title: "Usuário clica em Cancelar"
          required: true
        - id: "FP-UC09-004"
          title: "Sistema exibe modal de confirmação"
          required: true
        - id: "FP-UC09-005"
          title: "Usuário informa justificativa (mín 20 caracteres)"
          required: true
        - id: "FP-UC09-006"
          title: "Sistema valida justificativa"
          required: true
        - id: "FP-UC09-007"
          title: "Sistema muda status para CANCELADA"
          required: true
        - id: "FP-UC09-008"
          title: "Sistema registra justificativa no histórico"
          required: true
        - id: "FP-UC09-009"
          title: "Sistema notifica aprovadores e atendentes"
          required: true
        - id: "FE-UC09-001"
          title: "Justificativa muito curta → HTTP 400"
          required: true
        - id: "FE-UC09-002"
          title: "Solicitação já fechada → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.VIEW_OWN ou GES.SOLICITACOES.DELETE"
      - status_nao_permitido: "FECHADA ou CANCELADA"

    gatilho: "Usuario clica em Cancelar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_cancelar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_modal_justificativa"
      - passo: 3
        ator: "usuario"
        acao: "informar_justificativa"
      - passo: 4
        ator: "sistema"
        acao: "validar_justificativa"
      - passo: 5
        ator: "sistema"
        acao: "cancelar_solicitacao"
      - passo: 6
        ator: "sistema"
        acao: "notificar_envolvidos"

    fluxos_excecao:
      - id: "FE-UC09-01"
        condicao: "justificativa_muito_curta"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-08"

    resultado_final:
      estado: "solicitacao_cancelada"

  - id: "UC10"
    nome: "Reabrir Solicitação"
    ator_principal: "solicitante"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-09"
      uc_items:
        - id: "FP-UC10-001"
          title: "Solicitante acessa solicitação fechada"
          required: true
        - id: "FP-UC10-002"
          title: "Sistema valida prazo (7 dias corridos)"
          required: true
        - id: "FP-UC10-003"
          title: "Sistema exibe botão Reabrir"
          required: true
        - id: "FP-UC10-004"
          title: "Solicitante clica em Reabrir"
          required: true
        - id: "FP-UC10-005"
          title: "Sistema solicita motivo da reabertura (mín 30 caracteres)"
          required: true
        - id: "FP-UC10-006"
          title: "Sistema valida motivo"
          required: true
        - id: "FP-UC10-007"
          title: "Sistema muda status para EM_ATENDIMENTO"
          required: true
        - id: "FP-UC10-008"
          title: "Sistema atribui ao mesmo atendente anterior"
          required: true
        - id: "FP-UC10-009"
          title: "Sistema registra reabertura no histórico"
          required: true
        - id: "FP-UC10-010"
          title: "Sistema notifica atendente"
          required: true
        - id: "FE-UC10-001"
          title: "Prazo expirado → HTTP 400"
          required: true
        - id: "FE-UC10-002"
          title: "Motivo muito curto → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.VIEW_OWN"
      - status: "FECHADA"
      - prazo: "ate 7 dias corridos"

    gatilho: "Solicitante clica em Reabrir"

    fluxo_principal:
      - passo: 1
        ator: "solicitante"
        acao: "clicar_reabrir"
      - passo: 2
        ator: "sistema"
        acao: "validar_prazo_7_dias"
      - passo: 3
        ator: "sistema"
        acao: "solicitar_motivo"
      - passo: 4
        ator: "solicitante"
        acao: "informar_motivo"
      - passo: 5
        ator: "sistema"
        acao: "validar_motivo"
      - passo: 6
        ator: "sistema"
        acao: "reabrir_solicitacao"
      - passo: 7
        ator: "sistema"
        acao: "atribuir_atendente_anterior"

    fluxos_excecao:
      - id: "FE-UC10-01"
        condicao: "prazo_expirado"
        resultado: "http_400_prazo_expirado"

    regras_aplicadas:
      - "RN-RF053-09"

    resultado_final:
      estado: "solicitacao_reaberta"

  - id: "UC11"
    nome: "Pausar ou Retomar SLA"
    ator_principal: "atendente"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-10"
      uc_items:
        - id: "FP-UC11-001"
          title: "Atendente acessa solicitação em atendimento"
          required: true
        - id: "FP-UC11-002"
          title: "Sistema valida permissão UPDATE"
          required: true
        - id: "FP-UC11-003"
          title: "Atendente clica em Pausar SLA"
          required: true
        - id: "FP-UC11-004"
          title: "Sistema solicita motivo (mín 20 caracteres)"
          required: true
        - id: "FP-UC11-005"
          title: "Sistema muda status para AGUARDANDO_SOLICITANTE"
          required: true
        - id: "FP-UC11-006"
          title: "Sistema pausa contagem de SLA"
          required: true
        - id: "FP-UC11-007"
          title: "Sistema notifica solicitante"
          required: true
        - id: "FA-UC11-001"
          title: "Retomar SLA quando solicitante responder"
          required: false
        - id: "FE-UC11-001"
          title: "Motivo muito curto → HTTP 400"
          required: true
        - id: "FE-UC11-002"
          title: "SLA já pausado → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.UPDATE"
      - status: "EM_ATENDIMENTO"

    gatilho: "Atendente clica em Pausar SLA"

    fluxo_principal:
      - passo: 1
        ator: "atendente"
        acao: "clicar_pausar_sla"
      - passo: 2
        ator: "sistema"
        acao: "solicitar_motivo"
      - passo: 3
        ator: "atendente"
        acao: "informar_motivo"
      - passo: 4
        ator: "sistema"
        acao: "validar_motivo"
      - passo: 5
        ator: "sistema"
        acao: "pausar_sla_e_mudar_status"
      - passo: 6
        ator: "sistema"
        acao: "notificar_solicitante"

    fluxos_excecao:
      - id: "FE-UC11-01"
        condicao: "sla_ja_pausado"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-10"

    resultado_final:
      estado: "sla_pausado"

  - id: "UC12"
    nome: "Escalar Solicitação Automaticamente"
    ator_principal: "sistema"
    tipo: "batch"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-14"
      uc_items:
        - id: "FP-UC12-001"
          title: "Job verifica solicitações a cada 15 minutos"
          required: true
        - id: "FP-UC12-002"
          title: "Sistema identifica solicitações com SLA > 100%"
          required: true
        - id: "FP-UC12-003"
          title: "Sistema notifica coordenador quando SLA = 100%"
          required: true
        - id: "FP-UC12-004"
          title: "Sistema notifica gerente quando SLA = 150%"
          required: true
        - id: "FP-UC12-005"
          title: "Sistema notifica diretor quando SLA = 200%"
          required: true
        - id: "FP-UC12-006"
          title: "Sistema registra escalação no histórico"
          required: true
        - id: "FE-UC12-001"
          title: "Erro ao enviar notificação → log de erro"
          required: true

    precondicoes:
      - tipo: "job_automatico"

    gatilho: "Job executado a cada 15 minutos"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "executar_job_escalacao"
      - passo: 2
        ator: "sistema"
        acao: "identificar_solicitacoes_criticas"
      - passo: 3
        ator: "sistema"
        acao: "calcular_percentual_sla"
      - passo: 4
        ator: "sistema"
        acao: "escalar_para_nivel_apropriado"
      - passo: 5
        ator: "sistema"
        acao: "registrar_escalacao"

    fluxos_excecao:
      - id: "FE-UC12-01"
        condicao: "erro_notificacao"
        resultado: "log_erro_continua_execucao"

    regras_aplicadas:
      - "RN-RF053-14"

    resultado_final:
      estado: "escalacoes_processadas"

  - id: "UC13"
    nome: "Responder Pesquisa de Satisfação (NPS)"
    ator_principal: "solicitante"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-13"
      uc_items:
        - id: "FP-UC13-001"
          title: "Solicitante recebe link de pesquisa por email"
          required: true
        - id: "FP-UC13-002"
          title: "Solicitante clica no link"
          required: true
        - id: "FP-UC13-003"
          title: "Sistema valida token de pesquisa"
          required: true
        - id: "FP-UC13-004"
          title: "Sistema exibe pergunta: 'De 0 a 10, recomendaria?'"
          required: true
        - id: "FP-UC13-005"
          title: "Solicitante seleciona nota (0-10)"
          required: true
        - id: "FP-UC13-006"
          title: "Sistema classifica: Detrator (0-6), Neutro (7-8), Promotor (9-10)"
          required: true
        - id: "FP-UC13-007"
          title: "Sistema solicita comentário adicional (opcional)"
          required: true
        - id: "FP-UC13-008"
          title: "Sistema salva resposta no banco"
          required: true
        - id: "FP-UC13-009"
          title: "Sistema registra data de resposta"
          required: true
        - id: "FP-UC13-010"
          title: "Sistema exibe mensagem de agradecimento"
          required: true
        - id: "FE-UC13-001"
          title: "Token inválido ou expirado → HTTP 400"
          required: true
        - id: "FE-UC13-002"
          title: "Pesquisa já respondida → HTTP 400"
          required: true

    precondicoes:
      - tipo: "pesquisa_disparada_apos_fechamento"

    gatilho: "Solicitante clica no link de pesquisa"

    fluxo_principal:
      - passo: 1
        ator: "solicitante"
        acao: "clicar_link_email"
      - passo: 2
        ator: "sistema"
        acao: "validar_token"
      - passo: 3
        ator: "sistema"
        acao: "exibir_pergunta_nps"
      - passo: 4
        ator: "solicitante"
        acao: "selecionar_nota"
      - passo: 5
        ator: "sistema"
        acao: "classificar_resposta"
      - passo: 6
        ator: "sistema"
        acao: "salvar_resposta"

    fluxos_excecao:
      - id: "FE-UC13-01"
        condicao: "token_invalido"
        resultado: "http_400_token_invalido"

    regras_aplicadas:
      - "RN-RF053-13"

    resultado_final:
      estado: "pesquisa_respondida"

  - id: "UC14"
    nome: "Delegar Aprovador Temporariamente"
    ator_principal: "aprovador"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF053-15"
      uc_items:
        - id: "FP-UC14-001"
          title: "Aprovador acessa configurações de delegação"
          required: true
        - id: "FP-UC14-002"
          title: "Sistema valida permissão APPROVE"
          required: true
        - id: "FP-UC14-003"
          title: "Aprovador clica em Delegar Aprovações"
          required: true
        - id: "FP-UC14-004"
          title: "Sistema exibe formulário de delegação"
          required: true
        - id: "FP-UC14-005"
          title: "Aprovador seleciona substituto e período (máx 90 dias)"
          required: true
        - id: "FP-UC14-006"
          title: "Sistema valida período (máx 90 dias corridos)"
          required: true
        - id: "FP-UC14-007"
          title: "Sistema cria registro de delegação"
          required: true
        - id: "FP-UC14-008"
          title: "Sistema notifica substituto"
          required: true
        - id: "FP-UC14-009"
          title: "Sistema redireciona aprovações pendentes para substituto"
          required: true
        - id: "FA-UC14-001"
          title: "Cancelar delegação antes do prazo"
          required: false
        - id: "FE-UC14-001"
          title: "Período > 90 dias → HTTP 400"
          required: true
        - id: "FE-UC14-002"
          title: "Substituto inválido → HTTP 400"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.APPROVE"

    gatilho: "Aprovador clica em Delegar Aprovacoes"

    fluxo_principal:
      - passo: 1
        ator: "aprovador"
        acao: "acessar_configuracoes_delegacao"
      - passo: 2
        ator: "aprovador"
        acao: "selecionar_substituto_e_periodo"
      - passo: 3
        ator: "sistema"
        acao: "validar_periodo_maximo"
      - passo: 4
        ator: "sistema"
        acao: "criar_delegacao"
      - passo: 5
        ator: "sistema"
        acao: "redirecionar_aprovacoes"

    fluxos_excecao:
      - id: "FE-UC14-01"
        condicao: "periodo_maior_90_dias"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-15"

    resultado_final:
      estado: "delegacao_criada"

  - id: "UC15"
    nome: "Visualizar Dashboard de Solicitações"
    ator_principal: "gestor"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF053-02"
      uc_items:
        - id: "FP-UC15-001"
          title: "Gestor acessa Dashboard de Solicitações"
          required: true
        - id: "FP-UC15-002"
          title: "Sistema valida permissão VIEW_ALL"
          required: true
        - id: "FP-UC15-003"
          title: "Sistema carrega métricas em tempo real via SignalR"
          required: true
        - id: "FP-UC15-004"
          title: "Sistema exibe cards: Abertas, Em Aprovação, Em Atendimento, Fechadas"
          required: true
        - id: "FP-UC15-005"
          title: "Sistema exibe gráfico de prioridades"
          required: true
        - id: "FP-UC15-006"
          title: "Sistema exibe alertas de SLA crítico (>80%)"
          required: true
        - id: "FP-UC15-007"
          title: "Sistema atualiza métricas a cada 30 segundos"
          required: true
        - id: "FP-UC15-008"
          title: "Sistema garante latência < 500ms no carregamento"
          required: true
        - id: "FA-UC15-001"
          title: "Filtrar por período (7d, 30d, 90d)"
          required: false
        - id: "FE-UC15-001"
          title: "Erro SignalR → fallback para polling HTTP"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.VIEW_ALL"

    gatilho: "Gestor acessa Dashboard"

    fluxo_principal:
      - passo: 1
        ator: "gestor"
        acao: "acessar_dashboard"
      - passo: 2
        ator: "sistema"
        acao: "conectar_signalr"
      - passo: 3
        ator: "sistema"
        acao: "carregar_metricas_tempo_real"
      - passo: 4
        ator: "sistema"
        acao: "exibir_dashboard"

    fluxos_excecao:
      - id: "FE-UC15-01"
        condicao: "erro_signalr"
        resultado: "fallback_polling_http"

    regras_aplicadas:
      - "RN-RF053-02"

    resultado_final:
      estado: "dashboard_exibido"

  - id: "UC16"
    nome: "Exportar Relatório de Solicitações"
    ator_principal: "gestor"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF053-02"
      uc_items:
        - id: "FP-UC16-001"
          title: "Gestor acessa funcionalidade Relatórios"
          required: true
        - id: "FP-UC16-002"
          title: "Sistema valida permissão VIEW_ALL"
          required: true
        - id: "FP-UC16-003"
          title: "Gestor seleciona período (máx 12 meses)"
          required: true
        - id: "FP-UC16-004"
          title: "Gestor seleciona formato (Excel ou PDF)"
          required: true
        - id: "FP-UC16-005"
          title: "Sistema valida período (máx 12 meses)"
          required: true
        - id: "FP-UC16-006"
          title: "Sistema gera relatório com: Total, Por Status, Por Tipo, Média SLA"
          required: true
        - id: "FP-UC16-007"
          title: "Sistema oferece download do arquivo"
          required: true
        - id: "FA-UC16-001"
          title: "Aplicar filtros adicionais (tipo, status, atendente)"
          required: false
        - id: "FE-UC16-001"
          title: "Período > 12 meses → HTTP 400"
          required: true
        - id: "FE-UC16-002"
          title: "Erro na geração → HTTP 500"
          required: true

    precondicoes:
      - permissao: "GES.SOLICITACOES.VIEW_ALL"

    gatilho: "Gestor clica em Exportar Relatorio"

    fluxo_principal:
      - passo: 1
        ator: "gestor"
        acao: "acessar_relatorios"
      - passo: 2
        ator: "gestor"
        acao: "selecionar_periodo_e_formato"
      - passo: 3
        ator: "sistema"
        acao: "validar_periodo_maximo"
      - passo: 4
        ator: "sistema"
        acao: "gerar_relatorio"
      - passo: 5
        ator: "sistema"
        acao: "oferecer_download"

    fluxos_excecao:
      - id: "FE-UC16-01"
        condicao: "periodo_muito_longo"
        resultado: "http_400"

    regras_aplicadas:
      - "RN-RF053-02"

    resultado_final:
      estado: "relatorio_gerado"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versao completa com 17 UCs cobrindo 100% do RF053"
  - versao: "1.0"
    data: "2025-12-18"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versao inicial basica (depreciada)"
