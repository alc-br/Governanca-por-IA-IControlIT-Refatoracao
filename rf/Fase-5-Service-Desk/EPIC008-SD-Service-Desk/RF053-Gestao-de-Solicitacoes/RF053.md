# RF053 - Gestão de Solicitações

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC008-SD-Service-Desk
**Fase**: Fase 5 - Service Desk

---

## 1. OBJETIVO DO REQUISITO

Prover um sistema completo de gestão de solicitações internas (service desk) que permita aos usuários solicitar ativos de TI, mobile e telecom através de um portal self-service, com workflow de aprovação configurável, controle automático de SLA, notificações em tempo real e integração com gestão de ativos.

O sistema deve garantir rastreabilidade completa, auditoria de 7 anos (LGPD), aprovação mobile, delegação de aprovadores e métricas de qualidade de atendimento.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- Criação de solicitações com formulário dinâmico por tipo
- Workflow de aprovação multi-nível configurável
- Controle automático de SLA com pausas e alertas
- Atribuição e roteamento de solicitações para atendentes
- Aprovação mobile com notificação push
- Chat interno por solicitação
- Anexos múltiplos com validação
- Pesquisa de satisfação automática (NPS)
- Dashboard em tempo real (SignalR)
- Delegação temporária de aprovadores
- Escalonamento automático por atraso
- Reabertura de solicitações (7 dias)
- Integração com gestão de ativos
- Exportação de relatórios (Excel/PDF)
- Auditoria completa de operações

### 2.2 Fora do escopo (não objetivos)

- Gestão de conhecimento (base de conhecimento/FAQ)
- Gestão de incidentes externos (clientes)
- SLA por cliente externo
- Integração com ferramentas de monitoramento
- Chatbot / IA para atendimento

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| Solicitação | Pedido formal de ativo, serviço ou suporte de TI |
| Solicitante | Usuário que abre a solicitação |
| Atendente | Membro da equipe de TI responsável pelo atendimento |
| Aprovador | Usuário autorizado a aprovar/rejeitar solicitações |
| SLA | Service Level Agreement - Prazo máximo de atendimento |
| Workflow | Fluxo de aprovação multi-nível configurável |
| Escalonamento | Notificação automática a níveis superiores por atraso |
| Delegação | Transferência temporária de autoridade de aprovação |
| Tenant | Empresa isolada logicamente no sistema multi-tenant |

---

## 4. FUNCIONALIDADES COBERTAS

1. Criar solicitação (formulário dinâmico por tipo)
2. Listar solicitações (próprias ou todas, conforme permissão)
3. Visualizar detalhes de solicitação
4. Atualizar solicitação (adicionar comentários, anexos)
5. Aprovar/rejeitar solicitação (workflow multi-nível)
6. Atribuir solicitação a atendente
7. Fechar solicitação (com solução registrada)
8. Cancelar solicitação (com justificativa)
9. Reabrir solicitação (dentro de 7 dias)
10. Delegar aprovação temporariamente
11. Pausar/retomar SLA
12. Enviar mensagem no chat interno
13. Adicionar anexos
14. Responder pesquisa de satisfação
15. Exportar relatórios

---

## 5. REGRAS DE NEGÓCIO

### RN-RF053-01 — Tipos de Solicitação Configuráveis

**Descrição**: O sistema deve permitir cadastro de tipos de solicitação com campos dinâmicos específicos (JSON schema).

**Justificativa**: Diferentes solicitações (novo celular, reparo, troca) requerem informações distintas.

**Critério de Aceite**:
- Tipo de solicitação define campos obrigatórios e opcionais
- Formulário frontend renderiza campos dinamicamente
- Validação respeita configuração do tipo
- Campos dinâmicos armazenados em JSON

**Exemplo**:
```json
{
  "tipo": "NOVO_CELULAR",
  "campos": [
    {"nome": "justificativa", "tipo": "texto", "obrigatorio": true},
    {"nome": "modelo_desejado", "tipo": "select", "opcoes": ["iPhone 15", "Samsung S24"]},
    {"nome": "centro_custo", "tipo": "texto", "obrigatorio": true}
  ]
}
```

---

### RN-RF053-02 — Prioridade Automática por Regras

**Descrição**: A prioridade deve ser calculada automaticamente baseado em: cargo do solicitante, tipo de solicitação, impacto no negócio.

**Critério de Aceite**:
- Sistema aplica motor de regras para calcular prioridade (1-5)
- Prioridade define SLA automático (Crítica=4h, Urgente=1dia, Alta=2dias, Normal=5dias, Baixa=10dias)
- Usuário pode sugerir prioridade, mas sistema pode sobrepor

**Implementação**:
```csharp
public enum PrioridadeSolicitacao
{
    Baixa = 1,      // 10 dias úteis
    Normal = 2,     // 5 dias úteis
    Alta = 3,       // 2 dias úteis
    Urgente = 4,    // 1 dia útil
    Critica = 5     // 4 horas
}
```

---

### RN-RF053-03 — Workflow de Aprovação Multi-Nível

**Descrição**: Solicitações podem requerer aprovação em múltiplos níveis configuráveis por tipo/valor.

**Critério de Aceite**:
- Workflow configurável por tipo de solicitação
- Níveis sequenciais (Gestor → TI → Diretoria)
- Rejeição em qualquer nível cancela workflow
- Aprovação no último nível libera para atendimento
- Histórico completo de aprovações auditado

**Fluxo**:
1. Valor < R$ 1.000 → Somente gestor direto
2. Valor R$ 1.000-5.000 → Gestor + TI
3. Valor > R$ 5.000 → Gestor + TI + Diretoria

---

### RN-RF053-04 — SLA Automático com Pausas

**Descrição**: SLA calculado em dias/horas úteis, com pausa automática em pendências externas.

**Critério de Aceite**:
- SLA inicia na criação da solicitação
- Pausar SLA quando: aguardando resposta solicitante, aguardando fornecedor, falta de estoque, aprovação orçamento
- Retomar SLA quando pendência resolvida
- Tempo pausado não conta no SLA total
- Alertas automáticos em 50%, 80% e 100% do SLA

**Motivos de pausa válidos**:
- Aguardando resposta do solicitante
- Aguardando fornecedor externo
- Aguardando aprovação de orçamento
- Falta de estoque

---

### RN-RF053-05 — Aprovação Mobile com Notificação Push

**Descrição**: Aprovadores recebem notificação push e podem aprovar/rejeitar via app mobile.

**Critério de Aceite**:
- Notificação push ao receber solicitação para aprovação
- Link direto para tela de aprovação mobile
- Token de segurança temporário (15 min) para aprovação rápida
- Aprovação registra IP, timestamp, dispositivo

---

### RN-RF053-06 — Delegação de Aprovadores

**Descrição**: Aprovadores podem delegar temporariamente (ex: férias, viagem).

**Critério de Aceite**:
- Delegação com data início e fim (máximo 90 dias)
- Delegações não podem sobrepor
- Solicitações pendentes redirecionadas automaticamente
- Notificar aprovador original e delegado
- Registro de quem aprovou (original ou delegado) mantido

---

### RN-RF053-07 — Anexos Obrigatórios por Tipo

**Descrição**: Tipos de solicitação podem exigir anexos específicos (fotos, orçamentos, autorizações).

**Critério de Aceite**:
- Configuração define anexos obrigatórios por tipo
- Bloquear envio se anexos faltando
- Formatos aceitos: JPG, PNG, PDF, DOC, XLS
- Limite: 10 MB por arquivo, 50 MB total por solicitação
- Validação de vírus obrigatória

---

### RN-RF053-08 — Escalonamento Automático

**Descrição**: Solicitações com SLA vencido escalam automaticamente para níveis superiores.

**Critério de Aceite**:
- Job verifica SLA a cada hora
- 100% SLA → Notificar supervisor TI
- 150% SLA → Notificar gerente TI
- 200% SLA → Notificar diretor TI
- Marcação de escalonamento auditada

---

### RN-RF053-09 — Chat Interno por Solicitação

**Descrição**: Canal de comunicação interno entre solicitante e atendentes, centralizado na solicitação.

**Critério de Aceite**:
- Mensagens públicas (solicitante vê) e internas (só atendentes)
- Suporte a anexos em mensagens
- Notificação de nova mensagem (e-mail/push)
- Histórico completo auditado

---

### RN-RF053-10 — Integração com Gestão de Ativos

**Descrição**: Ao aprovar solicitação de novo ativo, criar automaticamente registro no inventário.

**Critério de Aceite**:
- Aprovação de "NOVO_ATIVO" dispara criação no inventário
- Status inicial: "EM_AQUISICAO"
- Vínculo solicitação ↔ ativo mantido
- Atualização automática quando ativo recebido

---

### RN-RF053-11 — Reabertura de Solicitações

**Descrição**: Solicitações fechadas podem ser reabertas dentro de 7 dias se problema persistir.

**Critério de Aceite**:
- Somente solicitante original pode reabrir
- Prazo máximo: 7 dias após fechamento
- Reabertura notifica último atendente
- Métrica de reabertura contabilizada (qualidade)

---

### RN-RF053-12 — Pesquisa de Satisfação Automática

**Descrição**: Ao fechar solicitação, enviar automaticamente pesquisa NPS.

**Critério de Aceite**:
- E-mail automático com link para pesquisa
- Perguntas: Nota 0-10 (NPS), Agilidade (1-5), Comunicação (1-5), Comentários
- Prazo para resposta: 7 dias
- Dashboard com métricas de satisfação

---

### RN-RF053-13 — Cancelamento com Justificativa

**Descrição**: Cancelamentos exigem justificativa obrigatória e permissão.

**Critério de Aceite**:
- Somente Supervisor TI ou Administrador pode cancelar
- Justificativa obrigatória (mínimo 20 caracteres)
- Notificar solicitante do cancelamento
- Cancelamento auditado

---

### RN-RF053-14 — Dashboard em Tempo Real

**Descrição**: Dashboard atualiza automaticamente via SignalR sem refresh.

**Critério de Aceite**:
- Evento "SolicitacaoNova" → Adiciona na lista
- Evento "SolicitacaoAtualizada" → Atualiza registro
- Evento "SolicitacaoFechada" → Remove da lista aberta
- Latência < 500ms

**Métricas exibidas**:
- Total solicitações abertas
- Solicitações vencendo SLA hoje
- Taxa atendimento no prazo (%)
- Tempo médio de atendimento

---

### RN-RF053-15 — Exportação de Relatórios

**Descrição**: Permitir exportação de relatórios em Excel/PDF.

**Critério de Aceite**:
- Filtros: período, tipo, status, prioridade, atendente
- Formato Excel: tabela com todas as colunas
- Formato PDF: formatado para impressão
- Auditoria de exportações

**Relatórios disponíveis**:
- Solicitações por período
- SLA por tipo
- Ranking de solicitantes
- Performance de atendentes

---

## 6. ESTADOS DA ENTIDADE

| Estado | Descrição |
|--------|-----------|
| ABERTA | Criada, aguardando aprovação ou atendimento |
| EM_APROVACAO | Aguardando aprovação de um ou mais níveis |
| APROVADA | Aprovada, aguardando atribuição a atendente |
| REJEITADA | Rejeitada em workflow de aprovação |
| EM_ATENDIMENTO | Atribuída a atendente, em andamento |
| AGUARDANDO_SOLICITANTE | Pausada aguardando resposta do solicitante |
| FECHADA | Finalizada com solução registrada |
| CANCELADA | Cancelada por supervisor com justificativa |

### Transições permitidas

| De | Para | Condição |
|----|------|----------|
| ABERTA | EM_APROVACAO | Se workflow configurado |
| ABERTA | EM_ATENDIMENTO | Se não requer aprovação |
| EM_APROVACAO | APROVADA | Aprovação concluída |
| EM_APROVACAO | REJEITADA | Rejeição em qualquer nível |
| APROVADA | EM_ATENDIMENTO | Atribuída a atendente |
| EM_ATENDIMENTO | AGUARDANDO_SOLICITANTE | Pendência externa |
| AGUARDANDO_SOLICITANTE | EM_ATENDIMENTO | Retorno solicitante |
| EM_ATENDIMENTO | FECHADA | Solução registrada |
| FECHADA | EM_ATENDIMENTO | Reabertura (< 7 dias) |
| * | CANCELADA | Cancelamento por supervisor |

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre |
|--------|---------------|
| SolicitacaoCriada | Após criação bem-sucedida |
| SolicitacaoEnviadaParaAprovacao | Ao iniciar workflow |
| SolicitacaoAprovada | Após aprovação de nível |
| SolicitacaoRejeitada | Após rejeição |
| SolicitacaoAtribuida | Ao atribuir a atendente |
| SolicitacaoFechada | Ao fechar com solução |
| SolicitacaoCancelada | Ao cancelar |
| SolicitacaoReaberta | Ao reabrir |
| SLAVencendo | Ao atingir 80% do SLA |
| SLAVencido | Ao atingir 100% do SLA |
| EscalonamentoAutomatico | Ao escalonar por atraso |
| MensagemAdicionada | Nova mensagem no chat |
| AnexoAdicionado | Novo anexo anexado |

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- Nenhuma operação pode violar isolamento de tenant (EmpresaId)
- Nenhuma regra de negócio pode ser ignorada
- Erros devem retornar códigos HTTP apropriados (400, 403, 404, 500)
- Auditoria completa: quem, quando, o que, IP, antes/depois
- SLA calculado apenas em dias/horas úteis
- Notificações não podem falhar silenciosamente (retry automático)
- Multi-tenancy obrigatório em todas as queries
- Soft delete obrigatório (Fl_Excluido)

---

## 9. SEGURANÇA

- Validação de entrada em todos os payloads
- Proteção contra SQL Injection, XSS, CSRF
- Controle de permissões RBAC por operação
- Isolamento multi-tenant rigoroso
- Anexos validados: tipo, tamanho, antivírus
- Tokens de aprovação mobile temporários (15 min)
- Histórico de ações auditado (IP, user-agent, timestamp)

---

## 10. ARTEFATOS DERIVADOS

Este RF é base para:

- UC-RF053.md (Casos de Uso - UC00 a UC14)
- MT-RF053.yaml (Massas de Teste)
- TC-RF053.yaml (Casos de Teste)
- WF-RF053.md (Wireframes e Fluxos)
- MD-RF053.yaml (Modelo de Dados)

---

## 11. RASTREABILIDADE

| Artefato | Status |
|----------|--------|
| UC-RF053.md | Pendente |
| MT-RF053.yaml | Pendente |
| TC-RF053.yaml | Pendente |
| WF-RF053.md | Pendente |
| MD-RF053.yaml | Pendente |

---

## 12. INTEGRAÇÕES OBRIGATÓRIAS

### 12.1 Central de Funcionalidades
- Código: `GES.SOLICITACOES`
- Módulo: Gestão

### 12.2 Internacionalização (i18n)
- Namespace: `solicitacoes`
- Idiomas: pt-BR, en-US, es-ES
- Chaves obrigatórias: status, prioridade, tipos, mensagens de validação

### 12.3 Auditoria
- Operações auditadas: CRIADA, APROVADA, REJEITADA, ATRIBUIDA, FECHADA, CANCELADA, REABERTA, ANEXO_ADICIONADO, MENSAGEM_ENVIADA
- Retenção: 7 anos (LGPD)

### 12.4 Controle de Acesso (RBAC)

Permissões obrigatórias:
- `GES.SOLICITACOES.CREATE` - Criar solicitação
- `GES.SOLICITACOES.VIEW_OWN` - Ver próprias solicitações
- `GES.SOLICITACOES.VIEW_ALL` - Ver todas solicitações
- `GES.SOLICITACOES.APPROVE` - Aprovar/rejeitar
- `GES.SOLICITACOES.ASSIGN` - Atribuir a atendente
- `GES.SOLICITACOES.CLOSE` - Fechar solicitação
- `GES.SOLICITACOES.CANCEL` - Cancelar solicitação
- `GES.SOLICITACOES.REOPEN` - Reabrir solicitação
- `GES.SOLICITACOES.EXPORT` - Exportar relatórios

---

## 13. PERFORMANCE

- Listagem de solicitações: < 1s para 10.000 registros
- Criação de solicitação: < 2s
- Dashboard em tempo real: latência < 500ms
- Upload de anexos: suporte a múltiplos arquivos simultâneos
- Notificações push: latência < 1s

---

## 14. USABILIDADE

- Interface intuitiva para usuários não técnicos
- Formulários com autocompletar e sugestões
- Mobile-first para aprovações
- Notificações não invasivas
- Feedback visual claro de status
- Acessibilidade WCAG 2.1 AA

---

## 15. EXCLUSÕES

Este RF **NÃO** cobre:
- Gestão de conhecimento (KB/FAQ)
- Atendimento a clientes externos
- Integração com ferramentas de monitoramento
- Chatbot / IA conversacional
- Gestão de contratos de SLA por cliente
- Cobrança por atendimento

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 2.0 | 2025-12-30 | Migração v1.0 → v2.0 - Separação RF/RL, contrato funcional moderno | Agência ALC - alc.dev.br |
| 1.0 | 2025-01-14 | Versão inicial | Equipe IControlIT |
