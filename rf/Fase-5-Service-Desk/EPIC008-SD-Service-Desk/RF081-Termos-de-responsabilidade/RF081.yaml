rf:
  id: RF081
  nome: Termos de Responsabilidade por Ativos e Equipamentos
  versao: '2.0'
  data: '2025-12-31'
  fase: Fase 5 - Service Desk e Governança
  epic: EPIC008-SD-Service-Desk
  status: draft
descricao:
  objetivo: Garantir que 100% dos ativos entregues sejam formalmente aceitos por seus responsáveis, criando prova legal de
    custódia para proteção patrimonial, conformidade LGPD e eficiência operacional.
  problema_resolvido: Falta de rastreabilidade formal de quem tem qual equipamento, ausência de prova legal de aceite, penalidades
    manuais por retenção, notificações manuais de vencimento.
  publico_afetado: Gestores de TI, Almoxarifes, Usuários Finais (que recebem equipamentos), Departamento Jurídico (auditoria
    LGPD/SOX)
escopo:
  incluso:
  - CRUD de termos de responsabilidade customizados por tipo de ativo
  - Versionamento automático de termos com histórico imutável
  - Captura de aceite com assinatura digital (SignaturePad)
  - Validação de identidade obrigatória (CPF via BrasilAPI ou matrícula corporativa)
  - Registro de contexto completo (timestamp UTC, IP, GPS, User-Agent)
  - Notificações automáticas de vencimento (30/15/7 dias antes)
  - Cálculo automático de penalidades por retenção além do prazo
  - Revogação formal de termo (devolução/perda/roubo)
  - Comprovante PDF com QRCode para verificação de autenticidade
  - Dashboard com métricas de aceites (pendentes, ativos, vencidos, revogados)
  - Integração com RF-027 (Movimentação de Ativos) via webhook
  - Auditoria LGPD completa (rastreamento de aceites)
  - Suporte multi-idioma (pt-BR, en-US, es-ES)
  - Multi-tenancy com isolamento por ClienteId
  fora:
  - Interface visual específica (design/layout delegado ao frontend)
  - Gestão de ativos (responsabilidade do RF-024)
  - Workflows de movimentação (responsabilidade do RF-027)
  - Gestão de contratos (responsabilidade do RF-027)
entidades:
- nome: TipoAtivo
  descricao: Categoria de equipamento (Notebook, Telefone, Badge, etc.) com termo customizado
  multi_tenant: true
  soft_delete: false
  auditoria: true
- nome: TermoResponsabilidade
  descricao: Documento formal que especifica responsabilidades do usuário sobre ativo
  multi_tenant: true
  soft_delete: false
  auditoria: true
- nome: TermoVersao
  descricao: Histórico de versões de termos (append-only, imutável)
  multi_tenant: true
  soft_delete: false
  auditoria: true
- nome: AceiteTermo
  descricao: Registro de aceite com assinatura digital, timestamp UTC, geolocalização
  multi_tenant: true
  soft_delete: false
  auditoria: true
- nome: RevogacaoTermo
  descricao: Registro de revogação de termo (devolução/perda/roubo)
  multi_tenant: true
  soft_delete: false
  auditoria: true
- nome: CobrancaPenalidade
  descricao: Multa acumulada por retenção de ativo além do prazo
  multi_tenant: true
  soft_delete: false
  auditoria: true
regras_negocio:
- id: RN-TRM-081-01
  descricao: Sistema DEVE suportar no mínimo 12 tipos de ativos diferentes, cada um com termo customizado
  tipo: regra_negocio
  campos_afetados:
  - TipoAtivo.Nome
  - TipoAtivo.DiasVigenciaDefault
  - TipoAtivo.PenaldidaDiariaRetenção
  obrigatorio: true
- id: RN-TRM-081-02
  descricao: Antes de capturar aceite, sistema DEVE validar identidade do usuário via CPF (BrasilAPI) ou matrícula corporativa
  tipo: validacao
  campos_afetados:
  - AceiteTermo.UsuarioId
  - AceiteTermo.CPF_Validado
  obrigatorio: true
- id: RN-TRM-081-03
  descricao: Aceite DEVE capturar assinatura rasterizada (PNG) via SignaturePad, timestamp UTC sincronizado (NTP), geolocalização
    (IP + GPS se autorizado), User-Agent
  tipo: validacao
  campos_afetados:
  - AceiteTermo.AssinaturaPNG
  - AceiteTermo.DataHoraAceiteUTC
  - AceiteTermo.IPAddress
  - AceiteTermo.Latitude
  - AceiteTermo.Longitude
  - AceiteTermo.UserAgent
  obrigatorio: true
- id: RN-TRM-081-04
  descricao: Quando conteúdo de termo é alterado, sistema cria automaticamente nova versão com histórico completo e changelog.
    Versões anteriores são imutáveis (append-only)
  tipo: regra_negocio
  campos_afetados:
  - TermoResponsabilidade.Versao
  - TermoVersao.Numero
  - TermoVersao.Changelog
  obrigatorio: true
- id: RN-TRM-081-05
  descricao: Usuário que recebeu equipamento novo ou cujo termo está vencido NÃO pode acessar certos módulos do sistema até
    aceitar termo vigente
  tipo: seguranca
  campos_afetados:
  - AceiteTermo.Status
  obrigatorio: true
- id: RN-TRM-081-06
  descricao: Sistema DEVE gerar notificações automáticas (email, SMS, in-app via SignalR) com 30, 15 e 7 dias antes do vencimento
  tipo: regra_negocio
  campos_afetados:
  - AceiteTermo.DataVencimento
  obrigatorio: true
- id: RN-TRM-081-07
  descricao: Quando termo vence e ativo não é devolvido, sistema calcula automaticamente multa de retenção (fixa diária, progressiva
    ou custo de reposição)
  tipo: regra_negocio
  campos_afetados:
  - TipoAtivo.TipoPenalidade
  - TipoAtivo.PenaldidaDiariaRetenção
  - AceiteTermo.PenuldadeAcumulada
  obrigatorio: true
- id: RN-TRM-081-08
  descricao: Quando equipamento é devolvido ou perdido, termo é revogado automaticamente com registro imutável de data, motivo,
    quem revogou
  tipo: regra_negocio
  campos_afetados:
  - RevogacaoTermo.Motivo
  - RevogacaoTermo.DataRevogacao
  - RevogacaoTermo.UsuarioRevogadorId
  obrigatorio: true
- id: RN-TRM-081-09
  descricao: 'Dashboard exibe métricas em tempo real: total aceites (Pendente/Ativo/Vencido/Revogado), taxa aceite (%), tempo
    médio, penalidades acumuladas'
  tipo: regra_negocio
  campos_afetados:
  - AceiteTermo.Status
  obrigatorio: false
- id: RN-TRM-081-10
  descricao: Após aceitar termo, sistema gera PDF com QRCode único que permite verificar autenticidade online
  tipo: regra_negocio
  campos_afetados:
  - AceiteTermo.HashSHA256Assinatura
  obrigatorio: true
- id: RN-TRM-081-11
  descricao: Quando ativo é transferido para novo usuário via RF-027, webhook automático dispara criação de novo termo pendente
    de aceite
  tipo: regra_negocio
  campos_afetados:
  - AceiteTermo.AtivoId
  - AceiteTermo.UsuarioId
  obrigatorio: true
- id: RN-TRM-081-12
  descricao: Interface e termos devem ser traduzidos para português, inglês e espanhol. Isolamento completo por ClienteId
  tipo: seguranca
  campos_afetados:
  - TermoResponsabilidade.ClienteId
  - AceiteTermo.ClienteId
  obrigatorio: true
estados:
- id: rascunho
  descricao: Termo criado mas ainda não vigente
- id: vigente
  descricao: Termo ativo sendo usado para aceites
- id: obsoleto
  descricao: Termo antigo substituído por nova versão
- id: pendente_aceite
  descricao: Aceite pendente - aguardando usuário assinar
- id: aceito
  descricao: Termo aceito formalmente pelo usuário
- id: vencido
  descricao: Termo vencido - equipamento deveria estar devolvido
- id: revogado
  descricao: Termo revogado - equipamento devolvido ou perdido
transicoes:
  permitidas:
  - de: rascunho
    para: vigente
  - de: vigente
    para: obsoleto
  - de: pendente_aceite
    para: aceito
  - de: aceito
    para: vencido
  - de: aceito
    para: revogado
  - de: vencido
    para: revogado
  proibidas:
  - de: revogado
    para: aceito
  - de: obsoleto
    para: vigente
permissoes:
- codigo: termo:create
  descricao: Criar termo de responsabilidade
- codigo: termo:read
  descricao: Visualizar termo (conteúdo e histórico)
- codigo: termo:update
  descricao: Editar termo vigente (cria nova versão)
- codigo: termo:delete
  descricao: Excluir termo (rascunho apenas)
- codigo: aceite:read
  descricao: Ver aceites (próprio ou equipe)
- codigo: aceite:aceitar
  descricao: Aceitar termo (próprio usuário)
- codigo: aceite:revogar
  descricao: Revogar aceite (gestor/almoxarife)
- codigo: dashboard:view
  descricao: Acessar dashboard de aceites
- codigo: comprovante:export
  descricao: Exportar/baixar comprovante PDF
- codigo: relatorio:penalidades
  descricao: Gerar relatório de penalidades acumuladas
integracoes:
  internas:
  - Autenticacao (JWT)
  - Multi-Tenancy (ClienteId)
  - Auditoria (LGPD)
  - Central de Funcionalidades (Feature Flags)
  - i18n (Transloco)
  - RBAC (Permissões)
  externas:
  - sistema: BrasilAPI
    tipo: REST API
    obrigatoria: true
    descricao: Validação de CPF em tempo real
  - sistema: RF-027 (Movimentação de Ativos)
    tipo: Webhook
    obrigatoria: true
    descricao: Criação automática de termo pendente ao entregar ativo
  - sistema: RF-024 (Gestão de Ativos)
    tipo: Database
    obrigatoria: true
    descricao: Relacionamento com entidade Ativo
  - sistema: Azure Blob Storage
    tipo: Cloud Storage
    obrigatoria: true
    descricao: Armazenamento de comprovantes PDF
seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: false
  hash_integridade: true
  timestamp_utc: true
  validacao_identidade: true
rastreabilidade:
  ucs_esperados:
  - UC00-listar-termos
  - UC01-criar-termo
  - UC02-aceitar-termo
  - UC03-revogar-termo
  - UC04-dashboard-aceites
  - UC05-notificar-vencimento
catalog:
  crud:
  - id: RF-CRUD-01
    title: Criar termo de responsabilidade
    required: true
  - id: RF-CRUD-02
    title: Listar termos vigentes
    required: true
  - id: RF-CRUD-03
    title: Visualizar termo completo com histórico
    required: true
  - id: RF-CRUD-04
    title: Atualizar termo (versionamento automático)
    required: true
  - id: RF-CRUD-05
    title: Excluir termo (rascunho apenas)
    required: false
  validacoes:
  - id: RF-VAL-01
    title: Validar identidade do usuário (CPF/matrícula)
    required: true
  - id: RF-VAL-02
    title: Validar assinatura digital (não vazia)
    required: true
  - id: RF-VAL-03
    title: Validar unicidade de aceite (usuário não pode aceitar mesmo termo 2x)
    required: true
  - id: RF-VAL-04
    title: Validar vigência do termo (não pode aceitar termo obsoleto)
    required: true
  seguranca:
  - id: RF-SEC-01
    title: Isolamento de tenant (ClienteId obrigatório)
    required: true
  - id: RF-SEC-02
    title: Permissões RBAC (matriz de permissões)
    required: true
  - id: RF-SEC-03
    title: Hash SHA-256 para integridade de assinaturas
    required: true
  - id: RF-SEC-04
    title: Timestamp UTC sincronizado com NTP
    required: true
  - id: RF-SEC-05
    title: Auditoria LGPD completa (quem/quando/onde)
    required: true
  funcionalidades_especificas:
  - id: RF-FUNC-01
    title: Versionamento automático de termos
    required: true
  - id: RF-FUNC-02
    title: Captura de assinatura digital (SignaturePad)
    required: true
  - id: RF-FUNC-03
    title: Notificações automáticas de vencimento (30/15/7 dias)
    required: true
  - id: RF-FUNC-04
    title: Cálculo automático de penalidades
    required: true
  - id: RF-FUNC-05
    title: Geração de comprovante PDF com QRCode
    required: true
  - id: RF-FUNC-06
    title: Dashboard de aceites com métricas
    required: true
  - id: RF-FUNC-07
    title: Integração webhook com RF-027
    required: true
exclusions:
  rf_items:
  - id: EX-RF081-01
    justificativa: Gestão de ativos (delegado ao RF-024)
  - id: EX-RF081-02
    justificativa: Workflows de movimentação (delegado ao RF-027)
  - id: EX-RF081-03
    justificativa: Gestão de contratos comerciais (delegado ao RF-027)
historico:
- versao: '2.0'
  data: '2025-12-31'
  autor: Claude Code
  descricao: Migração v1.0 → v2.0 - Separação RF/RL completa, estruturação YAML
- versao: '1.0'
  data: '2025-12-28'
  autor: Claude Code
  descricao: Versão inicial com 12 regras de negócio e 5 operações especiais
