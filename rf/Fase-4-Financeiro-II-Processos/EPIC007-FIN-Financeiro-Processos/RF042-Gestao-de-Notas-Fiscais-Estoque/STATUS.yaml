rf: RF042
fase: Fase-4-Financeiro-II-Processos
epic: EPIC007-FIN-Financeiro-Processos
titulo: Gestao de Notas Fiscais Estoque


skeleton:
  criado: True
  data_criacao: "2025-12-27"
  observacao: "Backend parcialmente implementado: 10% completo. Implementado: CRUD basico Notas Fiscais Estoque (5 endpoints - NotasFiscaisEstoque.cs). Faltam: Importacao automatica XML NFe via email (Hangfire job 15min conecta IMAP/Exchange caixa nfe@empresa.com + extrai anexos XML + parser layout SEFAZ v4.0 + deteccao duplicatas + Azure Blob Storage 7 anos retencao), validacao automatica SEFAZ (WebService consulta chave acesso 44 digitos + verifica status 100=Autorizada/101=Cancelada + protocolo autorizacao + retry 3x backoff exponencial indisponibilidade), OCR PDFs escaneados (Tesseract + Azure Form Recognizer extracao chave/numero/emitente/itens/valores taxa precisao >95% + validacao cruzada busca XML SEFAZ se detectar chave), conciliacao pedidos compra (matching automatico CNPJ fornecedor + numero pedido + comparacao item a item codigo/descricao/quantidade/valor + alertas divergencia quantidade ±5%/preco ±2%/itens nao previstos + workflow aprovacao divergencias >R$1.000), calculo automatico impostos (ICMS proprio/ST/DIFAL + IPI Tabela TIPI + PIS/COFINS cumulativo/nao-cumulativo + ISS servicos + reducao base calculo), rateio frete despesas acessorias (proporcional peso ou valor cada item + seguro/despesas aduaneiras + criterios configuraveis peso/valor/quantidade/percentual fixo + impacto custo medio estoque), lancamento automatico estoque (entrada apos aprovacao NFe + atualiza quantidade/custo medio/ultima compra + gera movimentacao rastreavel + notifica almoxarifado recebimento fisico + integracao codigo barras conferencia), gestao divergencias workflow (dashboard NFes pendentes aprovacao + workflow Comprador→Gestor→Financeiro + comentarios anexos cada etapa + SLA configuravel aprovar 24h + relatorio divergencias por fornecedor), geracao DANFE PDF/A (QR Code consulta SEFAZ + marca dagua NFes canceladas + impressao lote + envio email fornecedor/transportadora)."
documentacao:
  versao: "2.0"  # Governança v2.0 - Separação RF/RL
  data_migracao: "2025-12-30"
  rf: True        # RF042.md v2.0 (contrato moderno - 11 seções)
  rf_yaml: True   # RF042.yaml (estruturado - sincronizado com RF.md)
  rl: True        # RL-RF042.md (referência ao legado - 7 seções)
  rl_yaml: True   # RL-RF042.yaml (rastreabilidade - 100% com destinos)
  uc: True        # UC-RF042.md v2.0 (8 UCs - UC00-UC07)
  uc_yaml: True   # UC-RF042.yaml (estrutura canônica - 100% cobertura das 15 RNs)
  md: True
  wf: True

  arquivos_obrigatorios_presentes: True
  separacao_rf_rl_validada: True
  validador_uc_exit_code: 0
  validador_uc_data: "2025-12-31"
  validador_uc_taxa_conformidade: "100%"

desenvolvimento:
  backend:
    status: skeleton   # not_started | in_progress | done | skeleton
    branch: null
  frontend:
    status: not_started
    branch: null

testes:
  backend: not_run        # not_run | pass | fail
  frontend: not_run
  e2e: not_run
  seguranca: not_run

documentacao_testes:
  backend: False
  frontend: False
  e2e: False
  seguranca: False

testes_ti:
  backend: not_run
  frontend: not_run
  e2e: not_run
  seguranca: not_run

testes_qa:
  executado: False       # True quando QA executou
  aprovado: False        # True quando usuario aprovou

devops:
  work_item_id: 567
  test_plan_id: null
  last_sync: "2025-12-27 15:31:43"
  board_column: "Skeleton"

# ==============================================================================
# VALIDAÇÃO SEPARAÇÃO RF/RL (OBRIGATÓRIA v2.0)
# ==============================================================================

separacao_rf_rl:
  rf_limpo: True                # RF não contém conteúdo legado
  rl_completo: True             # RL contém TODA memória legado
  itens_com_destino: True       # 100% itens RL têm campo destino
  validador_executado: True     # validator-rl.py passou (exit code 0)
  validador_data: "2025-12-30"
  validador_resultado: "6 gaps menores (tipo tabela/integracao não padrão - não bloqueantes)"

# ==============================================================================
# ESTATÍSTICAS MIGRAÇÃO
# ==============================================================================

estatisticas:
  total_rns: 15                 # Regras de negócio extraídas (RN-RF042-001 a 015)
  total_endpoints_api: 13       # Endpoints REST documentados
  total_permissoes_rbac: 10     # Permissões RBAC definidas
  total_integracoes_obrigatorias: 4  # i18n, auditoria, RBAC, Central
  itens_legado_rastreados: 31   # Itens em RL-RF042.yaml (31 LEG-RF042-XXX)
  bancos_legados_mapeados: 1    # Banco "IControlIT_Legado" (SQL Server)
  problemas_legado_identificados: 10  # 10 problemas documentados em RL

  linhas_documentacao:
    rf_md: 970
    rf_yaml: 600
    rl_md: 1700
    rl_yaml: 850
    total: 4120

governanca:
  contrato_ativo: null
  ultimo_manifesto: null
  migracao_v2_completa: True
  data_migracao_v2: "2025-12-30"
