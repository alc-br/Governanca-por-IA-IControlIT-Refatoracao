# =============================================
# RF037 - Gestão de Custos por Ativo (TCO)
# Versão: 2.0
# Autor: Agência ALC - alc.dev.br
# Data: 2025-12-30
# =============================================

rf:
  id: "RF037"
  nome: "Gestão de Custos por Ativo (TCO)"
  versao: "2.0"
  data: "2025-12-30"
  fase: "Fase 4 - Financeiro II - Processos"
  epic: "EPIC007-FIN"
  status: "em_desenvolvimento" # draft | aprovado | em_desenvolvimento | concluido

descricao:
  objetivo: "Implementar um sistema completo de TCO (Total Cost of Ownership) para rastreamento, análise e otimização de todos os custos associados a ativos específicos ao longo de seu ciclo de vida."
  problema_resolvido: "Falta de visibilidade sobre custos totais de ativos (CAPEX + OPEX), decisões baseadas em intuição ao invés de dados, ausência de análise de ROI, custos ocultos não identificados."
  publico_afetado: "Gestores de ativos, equipe financeira, controllers, diretoria, auditores."

escopo:
  incluso:
    - "Registro de custos por categoria (aquisição, manutenção, licenças, consumíveis, energia, depreciação)"
    - "Cálculo automático de TCO total e por categoria"
    - "Sistema de depreciação automática mensal (métodos linear e acelerado)"
    - "Análise de ROI e payback period"
    - "Projeção de custos futuros baseada em histórico"
    - "Comparação e benchmarking entre ativos do mesmo tipo"
    - "Alertas de custos acima da média"
    - "Recomendação automática de substituição de ativos"
    - "Dashboard de TCO com gráficos interativos"
    - "Exportação de relatórios de TCO"
    - "Controle de acesso e isolamento por tenant"
    - "Auditoria completa de operações"
  fora:
    - "Interface visual específica (design, layout, UX)"
    - "Tecnologia, framework ou linguagem de programação"
    - "Integração com sistema de contabilidade externo (será RF futuro)"
    - "Cálculo de impostos sobre ativos"
    - "Gestão de garantias (módulo específico)"
    - "Análise preditiva de falhas com IA/ML (fase futura)"

entidades:
  - nome: "CustoAtivo"
    descricao: "Custo associado a um ativo específico"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "BeneficioAtivo"
    descricao: "Benefício gerado por um ativo (para cálculo de ROI)"
    multi_tenant: true
    soft_delete: true
    auditoria: true

  - nome: "AtivoTCOCache"
    descricao: "Cache de TCO total e por categoria (materialized view)"
    multi_tenant: false
    soft_delete: false
    auditoria: false

regras_negocio:
  - id: "RN-RF037-01"
    descricao: "Campos obrigatórios: AtivoId, TipoCustoAtivoId, Valor, DataOcorrencia, Categoria"
    tipo: "validacao"
    campos_afetados: ["AtivoId", "TipoCustoAtivoId", "Valor", "DataOcorrencia", "Categoria"]
    obrigatorio: true

  - id: "RN-RF037-02"
    descricao: "Recalcular TCO automaticamente ao criar, editar ou excluir custo"
    tipo: "regra_negocio"
    campos_afetados: ["TCOTotal", "TCOAquisicao", "TCOManutencao", "TCOLicencas", "TCOConsumiveis"]
    obrigatorio: true

  - id: "RN-RF037-03"
    descricao: "Depreciação automática mensal no dia 1 às 02:00 UTC para ativos depreciáveis"
    tipo: "regra_negocio"
    campos_afetados: ["FlDepreciadoTotalmente", "TCODepreciacao"]
    obrigatorio: true

  - id: "RN-RF037-04"
    descricao: "Calcular ROI = ((Benefícios - Custos) / Custos) * 100"
    tipo: "regra_negocio"
    campos_afetados: ["ROIPercentual", "PaybackPeriodMeses"]
    obrigatorio: true

  - id: "RN-RF037-05"
    descricao: "Alertar quando TCO > 130% da média de ativos do mesmo tipo"
    tipo: "regra_negocio"
    campos_afetados: ["FlCustoAcimaDaMedia", "PercentualAcimaMedia"]
    obrigatorio: true

  - id: "RN-RF037-06"
    descricao: "Custos de manutenção vinculados a OrdemServico, licenças a Contrato"
    tipo: "validacao"
    campos_afetados: ["OrdemServicoId", "ContratoId", "Categoria"]
    obrigatorio: true

  - id: "RN-RF037-07"
    descricao: "Categorizar custos como CAPEX (Aquisicao) ou OPEX (demais)"
    tipo: "regra_negocio"
    campos_afetados: ["Categoria", "TipoCusto"]
    obrigatorio: true

  - id: "RN-RF037-08"
    descricao: "Projetar custos futuros baseado em média dos últimos 12 meses"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: false

  - id: "RN-RF037-09"
    descricao: "Comparar TCO entre ativos do mesmo tipo e classificar (Econômico/Normal/Custoso)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: false

  - id: "RN-RF037-10"
    descricao: "DataOcorrencia não pode ser anterior à DataAquisicao do ativo"
    tipo: "validacao"
    campos_afetados: ["DataOcorrencia"]
    obrigatorio: true

  - id: "RN-RF037-11"
    descricao: "Soft delete com recálculo automático de TCO"
    tipo: "regra_negocio"
    campos_afetados: ["FlExcluido"]
    obrigatorio: true

  - id: "RN-RF037-12"
    descricao: "Visualizar TCO agregado por período (mensal, trimestral, anual)"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: false

  - id: "RN-RF037-13"
    descricao: "Exportar relatório de TCO em Excel/PDF com breakdown por categoria"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: false

  - id: "RN-RF037-14"
    descricao: "Recomendar substituição quando TCO anual > 50% do valor de ativo novo"
    tipo: "regra_negocio"
    campos_afetados: []
    obrigatorio: false

  - id: "RN-RF037-15"
    descricao: "Auditoria completa com retenção de 7 anos (LGPD)"
    tipo: "seguranca"
    campos_afetados: ["UsuarioCriacaoId", "DataCriacao", "UsuarioAlteracaoId", "DataAlteracao"]
    obrigatorio: true

  - id: "RN-RF037-16"
    descricao: "Isolamento por tenant (FornecedorId)"
    tipo: "seguranca"
    campos_afetados: ["FornecedorId"]
    obrigatorio: true

estados:
  - id: "ativo"
    descricao: "Custo válido e contabilizado no TCO (FlExcluido = false)"
  - id: "excluido"
    descricao: "Custo removido logicamente, não conta no TCO (FlExcluido = true)"

transicoes:
  permitidas:
    - de: "ativo"
      para: "excluido"
  proibidas: []

eventos_dominio:
  - nome: "CustoAtivoCriadoDomainEvent"
    descricao: "Disparado após criação de custo - recalcula TCO"
  - nome: "CustoAtivoEditadoDomainEvent"
    descricao: "Disparado após edição de custo - recalcula TCO"
  - nome: "CustoAtivoExcluidoDomainEvent"
    descricao: "Disparado após exclusão lógica - recalcula TCO"
  - nome: "TCORecalculadoDomainEvent"
    descricao: "Disparado após atualização do TCO total e por categoria"
  - nome: "DepreciacaoCalculadaDomainEvent"
    descricao: "Disparado após cálculo mensal de depreciação"
  - nome: "AlertaCustoAcimaDaMediaDomainEvent"
    descricao: "Disparado quando ativo ultrapassa 30% da média de custos"

permissoes:
  - codigo: "GES.CUSTOS_ATIVO.VIEW"
    descricao: "Visualizar custos de um ativo"
  - codigo: "GES.CUSTOS_ATIVO.VIEW_ANY"
    descricao: "Listar todos os custos"
  - codigo: "GES.CUSTOS_ATIVO.CREATE"
    descricao: "Criar novo custo"
  - codigo: "GES.CUSTOS_ATIVO.UPDATE"
    descricao: "Atualizar custo existente"
  - codigo: "GES.CUSTOS_ATIVO.DELETE"
    descricao: "Excluir custo (soft delete)"
  - codigo: "GES.CUSTOS_ATIVO.EXPORT"
    descricao: "Exportar relatório de TCO"
  - codigo: "GES.CUSTOS_ATIVO.VIEW_ROI"
    descricao: "Visualizar análise de ROI"

integracoes:
  internas:
    - "Autenticação (JWT Bearer)"
    - "Multi-Tenancy (FornecedorId)"
    - "Auditoria (AuditInterceptor)"
    - "Gestão de Ativos (RF025)"
    - "Gestão de Contratos (RF023)"
    - "Ordens de Serviço (RF futuro)"
  externas: []

seguranca:
  isolamento_tenant: true
  auditoria_obrigatoria: true
  soft_delete: true

endpoints:
  - metodo: "POST"
    rota: "/api/custos-ativo"
    descricao: "Criar novo custo associado a ativo"
    permissao: "GES.CUSTOS_ATIVO.CREATE"

  - metodo: "PUT"
    rota: "/api/custos-ativo/{id}"
    descricao: "Atualizar custo existente"
    permissao: "GES.CUSTOS_ATIVO.UPDATE"

  - metodo: "GET"
    rota: "/api/custos-ativo/{id}"
    descricao: "Consultar custo por ID"
    permissao: "GES.CUSTOS_ATIVO.VIEW"

  - metodo: "GET"
    rota: "/api/custos-ativo"
    descricao: "Listar custos com filtros (AtivoId, Categoria, Período)"
    permissao: "GES.CUSTOS_ATIVO.VIEW_ANY"

  - metodo: "DELETE"
    rota: "/api/custos-ativo/{id}"
    descricao: "Excluir custo (soft delete)"
    permissao: "GES.CUSTOS_ATIVO.DELETE"

  - metodo: "GET"
    rota: "/api/custos-ativo/tco/{ativoId}"
    descricao: "Calcular TCO total e por categoria de um ativo"
    permissao: "GES.CUSTOS_ATIVO.VIEW"

  - metodo: "GET"
    rota: "/api/custos-ativo/roi/{ativoId}"
    descricao: "Calcular ROI e payback period de um ativo"
    permissao: "GES.CUSTOS_ATIVO.VIEW_ROI"

  - metodo: "GET"
    rota: "/api/custos-ativo/projecao/{ativoId}"
    descricao: "Projetar custos futuros baseado em histórico"
    permissao: "GES.CUSTOS_ATIVO.VIEW"

  - metodo: "GET"
    rota: "/api/custos-ativo/comparar/{tipoAtivoId}"
    descricao: "Comparar TCO entre ativos do mesmo tipo"
    permissao: "GES.CUSTOS_ATIVO.VIEW_ANY"

  - metodo: "GET"
    rota: "/api/custos-ativo/dashboard/{ativoId}"
    descricao: "Dashboard de TCO com agregações e gráficos"
    permissao: "GES.CUSTOS_ATIVO.VIEW"

  - metodo: "GET"
    rota: "/api/custos-ativo/relatorio/{ativoId}"
    descricao: "Exportar relatório de TCO (Excel/PDF)"
    permissao: "GES.CUSTOS_ATIVO.EXPORT"

  - metodo: "GET"
    rota: "/api/custos-ativo/recomendacao/{ativoId}"
    descricao: "Obter recomendação de substituição de ativo"
    permissao: "GES.CUSTOS_ATIVO.VIEW_ROI"

rastreabilidade:
  ucs_esperados:
    - "UC00-listar-custos-ativo"
    - "UC01-criar-custo-ativo"
    - "UC02-visualizar-custo-ativo"
    - "UC03-editar-custo-ativo"
    - "UC04-excluir-custo-ativo"
    - "UC05-calcular-tco"
    - "UC06-calcular-roi"
    - "UC07-projetar-custos"
    - "UC08-comparar-ativos"
    - "UC09-exportar-relatorio"
    - "UC10-dashboard-tco"

catalog:
  crud:
    - id: "RF037-CRUD-01"
      title: "Criar custo associado a ativo"
      required: true
    - id: "RF037-CRUD-02"
      title: "Listar custos de um ativo"
      required: true
    - id: "RF037-CRUD-03"
      title: "Visualizar detalhes de um custo"
      required: true
    - id: "RF037-CRUD-04"
      title: "Atualizar custo existente"
      required: true
    - id: "RF037-CRUD-05"
      title: "Excluir custo (soft delete)"
      required: true

  calculos:
    - id: "RF037-CALC-01"
      title: "Calcular TCO total automaticamente"
      required: true
    - id: "RF037-CALC-02"
      title: "Calcular TCO por categoria"
      required: true
    - id: "RF037-CALC-03"
      title: "Calcular depreciação mensal automática"
      required: true
    - id: "RF037-CALC-04"
      title: "Calcular ROI e payback period"
      required: true
    - id: "RF037-CALC-05"
      title: "Projetar custos futuros"
      required: true
    - id: "RF037-CALC-06"
      title: "Comparar TCO entre ativos"
      required: true

  validacoes:
    - id: "RF037-VAL-01"
      title: "Validar campos obrigatórios"
      required: true
    - id: "RF037-VAL-02"
      title: "Validar data de ocorrência vs. data de aquisição"
      required: true
    - id: "RF037-VAL-03"
      title: "Validar vinculação a ordem de serviço ou contrato"
      required: true

  seguranca:
    - id: "RF037-SEC-01"
      title: "Isolamento por tenant (FornecedorId)"
      required: true
    - id: "RF037-SEC-02"
      title: "Permissões RBAC (7 permissões específicas)"
      required: true
    - id: "RF037-SEC-03"
      title: "Auditoria completa de operações"
      required: true

  alertas:
    - id: "RF037-ALERT-01"
      title: "Alertar quando custo > 30% da média"
      required: true
    - id: "RF037-ALERT-02"
      title: "Recomendar substituição quando TCO anual > 50% valor novo"
      required: false

exclusions:
  rf_items: []

historico:
  - versao: "2.0"
    data: "2025-12-30"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração v1.0 → v2.0: separação RF/RL, estrutura canônica YAML, sincronização 100% com RF.md"

  - versao: "1.0"
    data: "2025-12-17"
    autor: "Architect Agent"
    descricao: "Versão inicial (incluía referências ao legado misturadas)"
