# =============================================
# UC-RF037 - Casos de Uso Canônicos
# RF037 — Gestão de Custos por Ativo (TCO)
# Versão: 2.0
# Data: 2025-12-31
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF037"
  versao: "2.0"
  data: "2025-12-31"
  fase: "Fase 4 - Financeiro II - Processos"
  epic: "EPIC007-FIN-Financeiro-Processos"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Custos por Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-01"
        - "RN-RF037-09"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa Custos por Ativo > Listagem"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão custos_ativo.view_any"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega custos do tenant atual"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica filtros"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema aplica paginação"
          required: true
        - id: "FP-UC00-006"
          title: "Sistema exibe grid"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por Ativo específico"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por TipoCusto"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por Categoria"
          required: false
        - id: "FA-UC00-004"
          title: "Filtrar por período"
          required: false
        - id: "FA-UC00-005"
          title: "Ordenar por Valor, Data, Ativo"
          required: false
        - id: "FA-UC00-006"
          title: "Exportar para Excel"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum custo encontrado → Estado vazio"
          required: true

    precondicoes:
      - permissao: "custos_ativo.view_any"

    gatilho: "Usuario acessa menu Custos por Ativo > Listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu_custos_por_ativo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao_view_any"
      - passo: 3
        ator: "sistema"
        acao: "carregar_custos_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_filtros_paginacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_grid_custos"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro_ativo"
        resultado: "lista_filtrada_por_ativo"
      - id: "FA-UC00-02"
        condicao: "usuario_aplica_filtro_tipo_custo"
        resultado: "lista_filtrada_por_tipo"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "HTTP 403 - Acesso negado"
      - id: "FE-UC00-02"
        condicao: "sem_custos"
        resultado: "Estado vazio exibido"

    regras_aplicadas:
      - "RN-RF037-01"
      - "RN-RF037-09"

    resultado_final:
      estado: "lista_custos_exibida"


  - id: "UC01"
    nome: "Criar Custo Associado a Ativo"
    ator_principal: "gestor_financeiro"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF037-01"
        - "RN-RF037-02"
        - "RN-RF037-08"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário acessa Novo Custo"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão create"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário seleciona Ativo"
          required: true
        - id: "FP-UC01-005"
          title: "Usuário seleciona TipoCusto"
          required: true
        - id: "FP-UC01-006"
          title: "Usuário informa Valor"
          required: true
        - id: "FP-UC01-007"
          title: "Usuário informa Data"
          required: true
        - id: "FP-UC01-008"
          title: "Usuário seleciona Categoria"
          required: true
        - id: "FP-UC01-009"
          title: "Usuário pode anexar documentos"
          required: false
        - id: "FP-UC01-010"
          title: "Sistema valida campos obrigatórios"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema valida regra RN-RF037-02"
          required: true
        - id: "FP-UC01-012"
          title: "Sistema valida regra RN-RF037-08"
          required: true
        - id: "FP-UC01-013"
          title: "Sistema cria registro"
          required: true
        - id: "FP-UC01-014"
          title: "Sistema invalida cache TCO"
          required: true
        - id: "FP-UC01-015"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-016"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar e criar outro custo"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação"
          required: false
        - id: "FE-UC01-001"
          title: "Campo obrigatório vazio"
          required: true
        - id: "FE-UC01-002"
          title: "Valor <= 0"
          required: true
        - id: "FE-UC01-003"
          title: "Ativo já possui custo Aquisição"
          required: true
        - id: "FE-UC01-004"
          title: "Data futura"
          required: true
        - id: "FE-UC01-005"
          title: "Ativo de outro tenant"
          required: true

    precondicoes:
      - permissao: "custos_ativo.create"
      - condicao: "ativo_existe"

    gatilho: "Usuario clica em Novo Custo"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "exibir_formulario_custo"
      - passo: 2
        ator: "usuario"
        acao: "preencher_campos_obrigatorios"
      - passo: 3
        ator: "usuario"
        acao: "salvar"
      - passo: 4
        ator: "sistema"
        acao: "validar_dados_custo"
      - passo: 5
        ator: "sistema"
        acao: "persistir_custo"
      - passo: 6
        ator: "sistema"
        acao: "invalidar_cache_tco"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou_valor_zero"
        resultado: "Exibir erro: Valor deve ser maior que zero"
      - id: "FE-UC01-02"
        condicao: "ativo_ja_possui_aquisicao"
        resultado: "Exibir erro: Ativo já possui custo de aquisição"

    regras_aplicadas:
      - "RN-RF037-01"
      - "RN-RF037-02"
      - "RN-RF037-08"

    resultado_final:
      estado: "custo_criado_cache_invalidado"


  - id: "UC02"
    nome: "Visualizar Detalhes do Custo"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-01"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário clica em custo na listagem"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão view"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema exibe dados do custo"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe anexos"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema exibe impacto no TCO"
          required: true
        - id: "FP-UC02-007"
          title: "Sistema exibe auditoria"
          required: true
        - id: "FA-UC02-001"
          title: "Download de anexo"
          required: false
        - id: "FA-UC02-002"
          title: "Ver histórico de alterações"
          required: false
        - id: "FE-UC02-001"
          title: "Custo inexistente"
          required: true
        - id: "FE-UC02-002"
          title: "Custo de outro tenant"
          required: true
        - id: "FE-UC02-003"
          title: "Usuário sem permissão"
          required: true

    precondicoes:
      - permissao: "custos_ativo.view"

    gatilho: "Usuario clica em custo na listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "seleciona_custo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao_e_tenant"
      - passo: 3
        ator: "sistema"
        acao: "exibir_detalhes_custo"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "custo_nao_existe"
        resultado: "HTTP 404"
      - id: "FE-UC02-02"
        condicao: "custo_outro_tenant"
        resultado: "HTTP 404"

    regras_aplicadas:
      - "RN-RF037-01"

    resultado_final:
      estado: "detalhes_custo_exibidos"


  - id: "UC03"
    nome: "Editar Custo de Ativo"
    ator_principal: "gestor_financeiro"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF037-04"
        - "RN-RF037-08"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário acessa edição de custo"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão update"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega dados do custo"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema exibe formulário preenchido"
          required: true
        - id: "FP-UC03-006"
          title: "Usuário altera dados"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema verifica regra RN-RF037-04"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema persiste alterações"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema invalida cache TCO"
          required: true
        - id: "FP-UC03-011"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC03-012"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição"
          required: false
        - id: "FA-UC03-002"
          title: "Alterar anexos"
          required: false
        - id: "FE-UC03-001"
          title: "Valor <= 0"
          required: true
        - id: "FE-UC03-002"
          title: "Data futura"
          required: true
        - id: "FE-UC03-003"
          title: "Custo Aquisição alteração > 10%"
          required: true
        - id: "FE-UC03-004"
          title: "Custo de outro tenant"
          required: true
        - id: "FE-UC03-005"
          title: "Custo excluído"
          required: true

    precondicoes:
      - permissao: "custos_ativo.update"

    gatilho: "Usuario clica em editar custo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicita_edicao"
      - passo: 2
        ator: "sistema"
        acao: "carregar_dados_formulario"
      - passo: 3
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 4
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 5
        ator: "sistema"
        acao: "persistir_mudancas"
      - passo: 6
        ator: "sistema"
        acao: "invalidar_cache_tco"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "alteracao_significativa_aquisicao"
        resultado: "Requer aprovação do gestor"

    regras_aplicadas:
      - "RN-RF037-04"
      - "RN-RF037-08"

    resultado_final:
      estado: "custo_atualizado_cache_invalidado"


  - id: "UC04"
    nome: "Excluir Custo (Soft Delete)"
    ator_principal: "gestor_financeiro"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF037-05"
        - "RN-RF037-09"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário solicita exclusão"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema exibe confirmação"
          required: true
        - id: "FP-UC04-003"
          title: "Usuário confirma"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema valida permissão delete"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema valida regra RN-RF037-05"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema solicita justificativa"
          required: true
        - id: "FP-UC04-008"
          title: "Usuário informa justificativa"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema executa soft delete"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema invalida cache TCO"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-012"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar exclusão"
          required: false
        - id: "FE-UC04-001"
          title: "Custo tipo Aquisição"
          required: true
        - id: "FE-UC04-002"
          title: "Justificativa vazia"
          required: true
        - id: "FE-UC04-003"
          title: "Custo já excluído"
          required: true
        - id: "FE-UC04-004"
          title: "Custo de outro tenant"
          required: true

    precondicoes:
      - permissao: "custos_ativo.delete"

    gatilho: "Usuario clica em excluir custo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicita_exclusao"
      - passo: 2
        ator: "sistema"
        acao: "exigir_confirmacao"
      - passo: 3
        ator: "usuario"
        acao: "confirmar_exclusao"
      - passo: 4
        ator: "sistema"
        acao: "validar_regras_exclusao"
      - passo: 5
        ator: "sistema"
        acao: "solicitar_justificativa"
      - passo: 6
        ator: "sistema"
        acao: "executar_soft_delete"
      - passo: 7
        ator: "sistema"
        acao: "invalidar_cache_tco"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "custo_tipo_aquisicao"
        resultado: "Bloqueio: Aquisição não pode ser excluída"

    regras_aplicadas:
      - "RN-RF037-05"
      - "RN-RF037-09"

    resultado_final:
      estado: "custo_soft_deleted"


  - id: "UC05"
    nome: "Calcular TCO Total do Ativo"
    ator_principal: "sistema_automatizado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF037-03"
        - "RN-RF037-07"
        - "RN-RF037-10"
      uc_items:
        - id: "FP-UC05-001"
          title: "Usuário acessa Ver TCO"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema verifica cache TCO"
          required: true
        - id: "FP-UC05-003"
          title: "Se cache válido retorna cache"
          required: true
        - id: "FP-UC05-004"
          title: "Se cache inválido recalcula"
          required: true
        - id: "FP-UC05-005"
          title: "Sistema soma todos os custos"
          required: true
        - id: "FP-UC05-006"
          title: "Sistema aplica regra RN-RF037-07"
          required: true
        - id: "FP-UC05-007"
          title: "Sistema calcula depreciação acumulada"
          required: true
        - id: "FP-UC05-008"
          title: "Sistema gera breakdown"
          required: true
        - id: "FP-UC05-009"
          title: "Sistema armazena em cache"
          required: true
        - id: "FP-UC05-010"
          title: "Sistema exibe TCO total + breakdown"
          required: true
        - id: "FA-UC05-001"
          title: "Forçar recálculo"
          required: false
        - id: "FE-UC05-001"
          title: "Ativo sem custos"
          required: true

    precondicoes:
      - condicao: "ativo_possui_custos"

    gatilho: "Usuario acessa Ver TCO do ativo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicita_ver_tco"
      - passo: 2
        ator: "sistema"
        acao: "verificar_cache"
      - passo: 3
        ator: "sistema"
        acao: "calcular_ou_recuperar_tco"
      - passo: 4
        ator: "sistema"
        acao: "exibir_tco_breakdown"

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "ativo_sem_custos"
        resultado: "Mensagem: Ativo sem custos cadastrados"

    regras_aplicadas:
      - "RN-RF037-03"
      - "RN-RF037-07"
      - "RN-RF037-10"

    resultado_final:
      estado: "tco_calculado_exibido"


  - id: "UC06"
    nome: "Calcular ROI e Payback do Ativo"
    ator_principal: "gestor_financeiro"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-11"
        - "RN-RF037-12"
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário acessa Análise ROI"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema valida permissão analyze"
          required: true
        - id: "FP-UC06-003"
          title: "Sistema carrega TCO do ativo"
          required: true
        - id: "FP-UC06-004"
          title: "Sistema carrega benefícios"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema calcula ROI"
          required: true
        - id: "FP-UC06-006"
          title: "Sistema calcula Payback"
          required: true
        - id: "FP-UC06-007"
          title: "Sistema exibe ROI + Payback + Gráfico"
          required: true
        - id: "FA-UC06-001"
          title: "Projetar ROI futuro"
          required: false
        - id: "FE-UC06-001"
          title: "Ativo sem benefícios"
          required: true
        - id: "FE-UC06-002"
          title: "ROI negativo"
          required: true

    precondicoes:
      - permissao: "custos_ativo.analyze"
      - condicao: "ativo_possui_custos_beneficios"

    gatilho: "Usuario acessa Análise ROI"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicita_analise_roi"
      - passo: 2
        ator: "sistema"
        acao: "carregar_tco_beneficios"
      - passo: 3
        ator: "sistema"
        acao: "calcular_roi_payback"
      - passo: 4
        ator: "sistema"
        acao: "exibir_analise_completa"

    fluxos_excecao:
      - id: "FE-UC06-01"
        condicao: "sem_beneficios"
        resultado: "Mensagem: Cadastre benefícios para calcular ROI"

    regras_aplicadas:
      - "RN-RF037-11"
      - "RN-RF037-12"

    resultado_final:
      estado: "roi_payback_exibidos"


  - id: "UC07"
    nome: "Projetar Custos Futuros"
    ator_principal: "gestor_financeiro"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-13"
        - "RN-RF037-14"
      uc_items:
        - id: "FP-UC07-001"
          title: "Usuário acessa Projeção de Custos"
          required: true
        - id: "FP-UC07-002"
          title: "Sistema valida permissão analyze"
          required: true
        - id: "FP-UC07-003"
          title: "Sistema analisa histórico recorrentes"
          required: true
        - id: "FP-UC07-004"
          title: "Sistema identifica padrões"
          required: true
        - id: "FP-UC07-005"
          title: "Sistema calcula depreciação futura"
          required: true
        - id: "FP-UC07-006"
          title: "Sistema projeta custos 12/24/36 meses"
          required: true
        - id: "FP-UC07-007"
          title: "Sistema exibe projeção + gráfico"
          required: true
        - id: "FA-UC07-001"
          title: "Ajustar parâmetros projeção"
          required: false
        - id: "FE-UC07-001"
          title: "Histórico insuficiente"
          required: true

    precondicoes:
      - permissao: "custos_ativo.analyze"
      - condicao: "ativo_possui_historico"

    gatilho: "Usuario acessa Projeção de Custos"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicita_projecao"
      - passo: 2
        ator: "sistema"
        acao: "analisar_historico_padroes"
      - passo: 3
        ator: "sistema"
        acao: "calcular_projecao_futura"
      - passo: 4
        ator: "sistema"
        acao: "exibir_projecao"

    fluxos_excecao:
      - id: "FE-UC07-01"
        condicao: "historico_insuficiente"
        resultado: "Mensagem: Histórico insuficiente para projeção"

    regras_aplicadas:
      - "RN-RF037-13"
      - "RN-RF037-14"

    resultado_final:
      estado: "projecao_custos_exibida"


  - id: "UC08"
    nome: "Comparar TCO entre Ativos"
    ator_principal: "gestor_financeiro"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-15"
      uc_items:
        - id: "FP-UC08-001"
          title: "Usuário acessa Comparar Custos"
          required: true
        - id: "FP-UC08-002"
          title: "Sistema valida permissão compare"
          required: true
        - id: "FP-UC08-003"
          title: "Sistema exibe seletor de ativos"
          required: true
        - id: "FP-UC08-004"
          title: "Usuário seleciona 2+ ativos"
          required: true
        - id: "FP-UC08-005"
          title: "Sistema valida regra RN-RF037-15"
          required: true
        - id: "FP-UC08-006"
          title: "Sistema calcula TCO de cada ativo"
          required: true
        - id: "FP-UC08-007"
          title: "Sistema gera tabela comparativa"
          required: true
        - id: "FP-UC08-008"
          title: "Sistema destaca outliers"
          required: true
        - id: "FA-UC08-001"
          title: "Exportar comparação Excel"
          required: false
        - id: "FA-UC08-002"
          title: "Comparar breakdown"
          required: false
        - id: "FE-UC08-001"
          title: "Ativos categorias diferentes"
          required: true
        - id: "FE-UC08-002"
          title: "Menos de 2 ativos"
          required: true

    precondicoes:
      - permissao: "custos_ativo.compare"
      - condicao: "minimo_2_ativos_mesma_categoria"

    gatilho: "Usuario acessa Comparar Custos"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_ativos_comparacao"
      - passo: 2
        ator: "sistema"
        acao: "validar_mesma_categoria"
      - passo: 3
        ator: "sistema"
        acao: "calcular_tco_todos_ativos"
      - passo: 4
        ator: "sistema"
        acao: "exibir_tabela_comparativa"

    fluxos_excecao:
      - id: "FE-UC08-01"
        condicao: "categorias_diferentes"
        resultado: "Erro: Selecione ativos da mesma categoria"

    regras_aplicadas:
      - "RN-RF037-15"

    resultado_final:
      estado: "comparacao_tco_exibida"


  - id: "UC09"
    nome: "Exportar Relatório de TCO"
    ator_principal: "gestor_financeiro"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-01"
      uc_items:
        - id: "FP-UC09-001"
          title: "Usuário acessa Relatórios > TCO"
          required: true
        - id: "FP-UC09-002"
          title: "Sistema valida permissão export"
          required: true
        - id: "FP-UC09-003"
          title: "Sistema exibe filtros"
          required: true
        - id: "FP-UC09-004"
          title: "Usuário define filtros e formato"
          required: true
        - id: "FP-UC09-005"
          title: "Sistema gera relatório"
          required: true
        - id: "FP-UC09-006"
          title: "Sistema gera arquivo Excel/PDF"
          required: true
        - id: "FP-UC09-007"
          title: "Sistema disponibiliza download"
          required: true
        - id: "FA-UC09-001"
          title: "Agendar envio automático"
          required: false
        - id: "FE-UC09-001"
          title: "Nenhum ativo selecionado"
          required: true
        - id: "FE-UC09-002"
          title: "Erro ao gerar arquivo"
          required: true

    precondicoes:
      - permissao: "custos_ativo.export"

    gatilho: "Usuario acessa Relatórios > TCO"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "definir_filtros_formato"
      - passo: 2
        ator: "sistema"
        acao: "gerar_relatorio_tco"
      - passo: 3
        ator: "sistema"
        acao: "disponibilizar_download"

    fluxos_excecao:
      - id: "FE-UC09-01"
        condicao: "nenhum_ativo_selecionado"
        resultado: "Erro: Selecione ao menos um ativo"

    regras_aplicadas:
      - "RN-RF037-01"

    resultado_final:
      estado: "relatorio_tco_gerado"


  - id: "UC10"
    nome: "Dashboard de TCO e KPIs"
    ator_principal: "diretor_financeiro"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF037-16"
      uc_items:
        - id: "FP-UC10-001"
          title: "Usuário acessa Dashboard > TCO"
          required: true
        - id: "FP-UC10-002"
          title: "Sistema valida permissão dashboard"
          required: true
        - id: "FP-UC10-003"
          title: "Sistema calcula KPIs"
          required: true
        - id: "FP-UC10-004"
          title: "Sistema calcula TCO total"
          required: true
        - id: "FP-UC10-005"
          title: "Sistema calcula média TCO"
          required: true
        - id: "FP-UC10-006"
          title: "Sistema conta ativos com custo excessivo"
          required: true
        - id: "FP-UC10-007"
          title: "Sistema calcula tendência crescimento"
          required: true
        - id: "FP-UC10-008"
          title: "Sistema exibe cards KPI"
          required: true
        - id: "FP-UC10-009"
          title: "Sistema exibe gráficos"
          required: true
        - id: "FA-UC10-001"
          title: "Filtrar dashboard por período"
          required: false
        - id: "FA-UC10-002"
          title: "Drill-down em categoria"
          required: false
        - id: "FE-UC10-001"
          title: "Nenhum custo cadastrado"
          required: true

    precondicoes:
      - permissao: "custos_ativo.dashboard"

    gatilho: "Usuario acessa Dashboard TCO"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_dashboard"
      - passo: 2
        ator: "sistema"
        acao: "calcular_kpis_tempo_real"
      - passo: 3
        ator: "sistema"
        acao: "exibir_dashboard_completo"

    fluxos_excecao:
      - id: "FE-UC10-01"
        condicao: "sem_custos"
        resultado: "Mensagem: Nenhum dado disponível"

    regras_aplicadas:
      - "RN-RF037-16"

    resultado_final:
      estado: "dashboard_kpis_exibido"


  - id: "UC11"
    nome: "Registrar Benefício do Ativo"
    ator_principal: "gestor_financeiro"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF037-11"
      uc_items:
        - id: "FP-UC11-001"
          title: "Usuário acessa Registrar Benefício"
          required: true
        - id: "FP-UC11-002"
          title: "Sistema valida permissão manage_benefits"
          required: true
        - id: "FP-UC11-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC11-004"
          title: "Usuário seleciona TipoBeneficio"
          required: true
        - id: "FP-UC11-005"
          title: "Usuário informa Valor"
          required: true
        - id: "FP-UC11-006"
          title: "Sistema valida campos"
          required: true
        - id: "FP-UC11-007"
          title: "Sistema cria registro"
          required: true
        - id: "FP-UC11-008"
          title: "Sistema invalida cache ROI"
          required: true
        - id: "FP-UC11-009"
          title: "Sistema confirma sucesso"
          required: true
        - id: "FA-UC11-001"
          title: "Editar benefício existente"
          required: false
        - id: "FA-UC11-002"
          title: "Excluir benefício soft delete"
          required: false
        - id: "FE-UC11-001"
          title: "Valor <= 0"
          required: true
        - id: "FE-UC11-002"
          title: "Ativo de outro tenant"
          required: true

    precondicoes:
      - permissao: "custos_ativo.manage_benefits"

    gatilho: "Usuario clica em Registrar Benefício"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "preencher_formulario_beneficio"
      - passo: 2
        ator: "sistema"
        acao: "validar_dados_beneficio"
      - passo: 3
        ator: "sistema"
        acao: "persistir_beneficio"
      - passo: 4
        ator: "sistema"
        acao: "invalidar_cache_roi"

    fluxos_excecao:
      - id: "FE-UC11-01"
        condicao: "valor_invalido"
        resultado: "Erro: Valor deve ser maior que zero"

    regras_aplicadas:
      - "RN-RF037-11"

    resultado_final:
      estado: "beneficio_registrado_cache_roi_invalidado"


  - id: "UC12"
    nome: "Alertar Custos Excessivos"
    ator_principal: "sistema_automatizado"
    tipo: "batch"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF037-06"
      uc_items:
        - id: "FP-UC12-001"
          title: "Job diário executa análise"
          required: true
        - id: "FP-UC12-002"
          title: "Sistema calcula TCO de cada ativo"
          required: true
        - id: "FP-UC12-003"
          title: "Sistema calcula média TCO por categoria"
          required: true
        - id: "FP-UC12-004"
          title: "Sistema identifica ativos > threshold"
          required: true
        - id: "FP-UC12-005"
          title: "Sistema gera alerta"
          required: true
        - id: "FP-UC12-006"
          title: "Sistema envia notificação"
          required: true
        - id: "FP-UC12-007"
          title: "Sistema registra alerta"
          required: true
        - id: "FA-UC12-001"
          title: "Configurar threshold customizado"
          required: false
        - id: "FE-UC12-001"
          title: "Nenhum ativo excede threshold"
          required: true

    precondicoes:
      - condicao: "job_habilitado"

    gatilho: "Job diário automatizado"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "calcular_tco_todos_ativos"
      - passo: 2
        ator: "sistema"
        acao: "identificar_outliers"
      - passo: 3
        ator: "sistema"
        acao: "gerar_enviar_alertas"

    fluxos_excecao:
      - id: "FE-UC12-01"
        condicao: "nenhum_outlier"
        resultado: "Nenhum alerta gerado"

    regras_aplicadas:
      - "RN-RF037-06"

    resultado_final:
      estado: "alertas_gerados_enviados"


exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica completa - 13 UCs cobrindo 100% do RF037"
  - versao: "1.0"
    data: "2025-12-18"
    autor: "Equipe Técnica"
    descricao: "Versão inicial básica (9 UCs)"
