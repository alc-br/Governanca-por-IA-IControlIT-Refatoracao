# =============================================
# UC - Casos de Uso RF025 (Gestão de Ativos)
# Versão: 1.0
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF025"
  versao: "1.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Ativos"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-02"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade via menu"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão FIN.ATIVOS.VIEW_ANY"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega ativos do tenant"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe lista"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por Tipo de Ativo"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por Status"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por Localização"
          required: false
        - id: "FA-UC00-004"
          title: "Filtrar por Responsável"
          required: false
        - id: "FA-UC00-005"
          title: "Filtrar por faixa de Valor"
          required: false
        - id: "FA-UC00-006"
          title: "Ordenar por coluna"
          required: false
        - id: "FA-UC00-007"
          title: "Buscar por Número de Patrimônio"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum registro → estado vazio"
          required: true
        - id: "FE-UC00-003"
          title: "Erro ao carregar → mensagem e retry"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.VIEW_ANY"

    gatilho: "Usuário acessa a funcionalidade via menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_ativos_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_lista"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado"
      - id: "FE-UC00-02"
        condicao: "nenhum_registro"
        resultado: "estado_vazio"

    regras_aplicadas:
      - "RN-RF025-012"  # Multi-tenant
      - "RN-RF025-013"  # Soft delete

    resultado_final:
      estado: "lista_exibida"

  - id: "UC01"
    nome: "Criar Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-01"
        - "RF-VAL-01"
        - "RF-VAL-03"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Novo Ativo"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário seleciona Tipo de Ativo"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema ajusta campos obrigatórios"
          required: true
        - id: "FP-UC01-006"
          title: "Usuário preenche dados"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema valida dados"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema gera Número de Patrimônio"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema gera QR Code"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema armazena QR_Code_Base64 e URL"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema cria registro"
          required: true
        - id: "FP-UC01-012"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-013"
          title: "Sistema exibe mensagem sucesso"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar e criar outro"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação"
          required: false
        - id: "FA-UC01-003"
          title: "Upload de foto"
          required: false
        - id: "FA-UC01-004"
          title: "Upload de NF"
          required: false
        - id: "FE-UC01-001"
          title: "Erro de validação"
          required: true
        - id: "FE-UC01-002"
          title: "Número patrimônio duplicado → HTTP 409"
          required: true
        - id: "FE-UC01-003"
          title: "IMEI inválido → HTTP 400"
          required: true
        - id: "FE-UC01-004"
          title: "Campos obrigatórios ausentes → HTTP 400"
          required: true
        - id: "FE-UC01-005"
          title: "Erro inesperado"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.CREATE"

    gatilho: "Usuário clica em Novo Ativo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_novo_ativo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "selecionar_tipo_ativo"
      - passo: 5
        ator: "sistema"
        acao: "ajustar_campos_obrigatorios"
      - passo: 6
        ator: "usuario"
        acao: "preencher_dados"
      - passo: 7
        ator: "sistema"
        acao: "validar_dados"
      - passo: 8
        ator: "sistema"
        acao: "gerar_numero_patrimonio"
      - passo: 9
        ator: "sistema"
        acao: "gerar_qr_code"
      - passo: 10
        ator: "sistema"
        acao: "armazenar_qr_code"
      - passo: 11
        ator: "sistema"
        acao: "criar_registro"
      - passo: 12
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 13
        ator: "sistema"
        acao: "exibir_mensagem_sucesso"

    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "usuario_salvar_e_novo"
        resultado: "formulario_resetado"
      - id: "FA-UC01-02"
        condicao: "usuario_cancelar"
        resultado: "formulario_fechado"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros"
      - id: "FE-UC01-02"
        condicao: "numero_patrimonio_duplicado"
        resultado: "http_409_conflict"
      - id: "FE-UC01-03"
        condicao: "imei_invalido"
        resultado: "http_400_bad_request"

    regras_aplicadas:
      - "RN-RF025-001"  # Número patrimônio único
      - "RN-RF025-002"  # QR Code automático
      - "RN-RF025-008"  # Campos obrigatórios por tipo
      - "RN-RF025-011"  # IMEI validation
      - "RN-RF025-012"  # Multi-tenant

    resultado_final:
      estado: "ativo_criado"

  - id: "UC02"
    nome: "Visualizar Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-03"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona ativo"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema carrega histórico"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema carrega anexos"
          required: true
        - id: "FP-UC02-007"
          title: "Sistema exibe QR Code"
          required: true
        - id: "FP-UC02-008"
          title: "Sistema exibe auditoria"
          required: true
        - id: "FA-UC02-001"
          title: "Imprimir QR Code"
          required: false
        - id: "FA-UC02-002"
          title: "Visualizar via scan QR"
          required: false
        - id: "FA-UC02-003"
          title: "Editar ativo"
          required: false
        - id: "FA-UC02-004"
          title: "Alocar ativo"
          required: false
        - id: "FE-UC02-001"
          title: "Ativo não encontrado → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Ativo de outro tenant → HTTP 403"
          required: true
        - id: "FE-UC02-003"
          title: "Erro ao carregar → retry"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.VIEW"

    gatilho: "Usuário seleciona ativo na listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_ativo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "sistema"
        acao: "carregar_historico"
      - passo: 6
        ator: "sistema"
        acao: "carregar_anexos"
      - passo: 7
        ator: "sistema"
        acao: "exibir_detalhes"

    fluxos_alternativos:
      - id: "FA-UC02-01"
        condicao: "usuario_imprimir_qr"
        resultado: "qr_code_impresso"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "ativo_nao_encontrado"
        resultado: "http_404_not_found"
      - id: "FE-UC02-02"
        condicao: "ativo_outro_tenant"
        resultado: "http_403_forbidden"

    regras_aplicadas:
      - "RN-RF025-005"  # Chain of custody
      - "RN-RF025-012"  # Multi-tenant

    resultado_final:
      estado: "detalhes_exibidos"

  - id: "UC03"
    nome: "Editar Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-04"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário solicita edição"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida tenant"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega dados"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário altera dados"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema persiste"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema atualiza LastModified"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema exibe mensagem sucesso"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição"
          required: false
        - id: "FA-UC03-002"
          title: "Upload de anexo"
          required: false
        - id: "FE-UC03-001"
          title: "Erro de validação"
          required: true
        - id: "FE-UC03-002"
          title: "Conflito de edição concorrente"
          required: true
        - id: "FE-UC03-003"
          title: "Tentativa editar Número Patrimônio → bloqueado"
          required: true
        - id: "FE-UC03-004"
          title: "Tentativa editar outro tenant → HTTP 403"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.UPDATE"

    gatilho: "Usuário solicita edição de ativo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_edicao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "usuario"
        acao: "alterar_dados"
      - passo: 6
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 7
        ator: "sistema"
        acao: "persistir_alteracoes"
      - passo: 8
        ator: "sistema"
        acao: "atualizar_last_modified"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos:
      - id: "FA-UC03-01"
        condicao: "usuario_cancelar"
        resultado: "formulario_fechado"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros"
      - id: "FE-UC03-02"
        condicao: "conflito_edicao"
        resultado: "exibir_alerta"

    regras_aplicadas:
      - "RN-RF025-008"  # Campos obrigatórios
      - "RN-RF025-012"  # Multi-tenant
      - "RN-RF025-013"  # Soft delete

    resultado_final:
      estado: "ativo_atualizado"

  - id: "UC04"
    nome: "Excluir Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-05"
        - "RF-SEC-03"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário solicita exclusão"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema exige confirmação"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema verifica dependências"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema executa soft delete"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema exibe mensagem sucesso"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar exclusão"
          required: false
        - id: "FA-UC04-002"
          title: "Reativar ativo (apenas Admin)"
          required: false
        - id: "FE-UC04-001"
          title: "Dependências ativas → HTTP 400"
          required: true
        - id: "FE-UC04-002"
          title: "Ativo já excluído → HTTP 410"
          required: true
        - id: "FE-UC04-003"
          title: "DELETE físico → bloqueado"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.DELETE"

    gatilho: "Usuário solicita exclusão de ativo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_exclusao"
      - passo: 2
        ator: "sistema"
        acao: "exigir_confirmacao"
      - passo: 3
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 4
        ator: "sistema"
        acao: "verificar_dependencias"
      - passo: 5
        ator: "sistema"
        acao: "executar_soft_delete"
      - passo: 6
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos:
      - id: "FA-UC04-01"
        condicao: "usuario_cancelar"
        resultado: "exclusao_cancelada"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "dependencias_ativas"
        resultado: "http_400_bad_request"
      - id: "FE-UC04-02"
        condicao: "ativo_ja_excluido"
        resultado: "http_410_gone"

    regras_aplicadas:
      - "RN-RF025-013"  # Soft delete obrigatório

    resultado_final:
      estado: "ativo_excluido"

  - id: "UC05"
    nome: "Alocar Ativo"
    ator_principal: "gestor_ti"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-VAL-02"
      uc_items:
        - id: "FP-UC05-001"
          title: "Usuário seleciona ativo e clica Alocar"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC05-003"
          title: "Sistema valida status"
          required: true
        - id: "FP-UC05-004"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC05-005"
          title: "Usuário seleciona responsável"
          required: true
        - id: "FP-UC05-006"
          title: "Sistema valida transição status"
          required: true
        - id: "FP-UC05-007"
          title: "Sistema atualiza status Alocado"
          required: true
        - id: "FP-UC05-008"
          title: "Sistema preenche Id_Usuario_Responsavel"
          required: true
        - id: "FP-UC05-009"
          title: "Sistema registra movimentação"
          required: true
        - id: "FP-UC05-010"
          title: "Sistema gera Termo Responsabilidade"
          required: true
        - id: "FP-UC05-011"
          title: "Sistema envia email/push com termo"
          required: true
        - id: "FP-UC05-012"
          title: "Sistema exibe mensagem sucesso"
          required: true
        - id: "FA-UC05-001"
          title: "Cancelar alocação"
          required: false
        - id: "FA-UC05-002"
          title: "Capturar GPS (mobile)"
          required: false
        - id: "FE-UC05-001"
          title: "Ativo não disponível → HTTP 400"
          required: true
        - id: "FE-UC05-002"
          title: "Transição inválida → HTTP 400"
          required: true
        - id: "FE-UC05-003"
          title: "Responsável não informado → HTTP 400"
          required: true
        - id: "FE-UC05-004"
          title: "Falha gerar termo → loga erro"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.ALOCAR"
      - status_ativo: "Disponivel ou Reservado"

    gatilho: "Usuário clica em Alocar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_alocar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_status"
      - passo: 4
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 5
        ator: "usuario"
        acao: "selecionar_responsavel"
      - passo: 6
        ator: "sistema"
        acao: "validar_transicao"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_status_alocado"
      - passo: 8
        ator: "sistema"
        acao: "preencher_responsavel"
      - passo: 9
        ator: "sistema"
        acao: "registrar_movimentacao"
      - passo: 10
        ator: "sistema"
        acao: "gerar_termo"
      - passo: 11
        ator: "sistema"
        acao: "enviar_notificacao"

    fluxos_alternativos:
      - id: "FA-UC05-01"
        condicao: "usuario_cancelar"
        resultado: "alocacao_cancelada"

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "ativo_nao_disponivel"
        resultado: "http_400_bad_request"
      - id: "FE-UC05-02"
        condicao: "transicao_invalida"
        resultado: "http_400_bad_request"

    regras_aplicadas:
      - "RN-RF025-003"  # Transições válidas
      - "RN-RF025-004"  # Responsável obrigatório
      - "RN-RF025-005"  # Chain of custody

    resultado_final:
      estado: "ativo_alocado"

  # UCs UC06-UC15 seguem estrutura similar, continuando...

  - id: "UC06"
    nome: "Transferir Ativo"
    ator_principal: "gestor_ti"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-VAL-05"
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário clica Transferir"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema valida permissão"
          required: true
        - id: "FP-UC06-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC06-004"
          title: "Usuário seleciona nova localização"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema captura GPS (mobile)"
          required: true
        - id: "FP-UC06-006"
          title: "Sistema valida precisão GPS"
          required: true
        - id: "FP-UC06-007"
          title: "Sistema registra movimentação"
          required: true
        - id: "FP-UC06-008"
          title: "Sistema atualiza localização"
          required: true
        - id: "FP-UC06-009"
          title: "Sistema exibe mensagem sucesso"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.TRANSFERIR"

    gatilho: "Usuário clica em Transferir"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_transferir"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "selecionar_localizacao"
      - passo: 5
        ator: "sistema"
        acao: "capturar_gps"
      - passo: 6
        ator: "sistema"
        acao: "validar_gps"
      - passo: 7
        ator: "sistema"
        acao: "registrar_movimentacao"
      - passo: 8
        ator: "sistema"
        acao: "atualizar_localizacao"

    regras_aplicadas:
      - "RN-RF025-005"  # Chain of custody
      - "RN-RF025-009"  # GPS obrigatório

    resultado_final:
      estado: "ativo_transferido"

  - id: "UC07"
    nome: "Devolver Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-VAL-02"
      uc_items:
        - id: "FP-UC07-001"
          title: "Usuário clica Devolver"
          required: true
        - id: "FP-UC07-007"
          title: "Sistema atualiza status Disponivel"
          required: true
        - id: "FP-UC07-008"
          title: "Sistema limpa Id_Usuario_Responsavel"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.DEVOLVER"
      - status_ativo: "Alocado"

    gatilho: "Usuário clica em Devolver"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_devolver"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_status"
      - passo: 4
        ator: "sistema"
        acao: "exibir_checklist"
      - passo: 5
        ator: "usuario"
        acao: "preencher_checklist"
      - passo: 6
        ator: "sistema"
        acao: "validar_transicao"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_status_disponivel"
      - passo: 8
        ator: "sistema"
        acao: "limpar_responsavel"
      - passo: 9
        ator: "sistema"
        acao: "registrar_movimentacao"

    regras_aplicadas:
      - "RN-RF025-003"  # Transições válidas
      - "RN-RF025-004"  # Limpa responsável
      - "RN-RF025-005"  # Chain of custody

    resultado_final:
      estado: "ativo_devolvido"

  - id: "UC08"
    nome: "Enviar para Manutenção"
    ator_principal: "gestor_ti"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-VAL-02"
      uc_items:
        - id: "FP-UC08-001"
          title: "Usuário clica Enviar Manutenção"
          required: true
        - id: "FP-UC08-007"
          title: "Sistema atualiza status Manutencao"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.MANUTENCAO"

    gatilho: "Usuário clica em Enviar Manutenção"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_manutencao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_status"
      - passo: 4
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 5
        ator: "usuario"
        acao: "informar_motivo"
      - passo: 6
        ator: "sistema"
        acao: "validar_transicao"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_status_manutencao"
      - passo: 8
        ator: "sistema"
        acao: "registrar_movimentacao"

    regras_aplicadas:
      - "RN-RF025-003"  # Transições válidas
      - "RN-RF025-005"  # Chain of custody

    resultado_final:
      estado: "ativo_em_manutencao"

  - id: "UC09"
    nome: "Baixar Ativo"
    ator_principal: "controller_financeiro"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-VAL-02"
      uc_items:
        - id: "FP-UC09-001"
          title: "Usuário clica Baixar Ativo"
          required: true
        - id: "FP-UC09-012"
          title: "Sistema atualiza status Baixado"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.BAIXAR"

    gatilho: "Usuário clica em Baixar Ativo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_baixar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "informar_justificativa"
      - passo: 5
        ator: "usuario"
        acao: "selecionar_motivo"
      - passo: 6
        ator: "usuario"
        acao: "anexar_documentos"
      - passo: 7
        ator: "sistema"
        acao: "validar_justificativa"
      - passo: 8
        ator: "sistema"
        acao: "validar_anexos"
      - passo: 9
        ator: "sistema"
        acao: "iniciar_aprovacao_nivel1"
      - passo: 10
        ator: "sistema"
        acao: "aguardar_aprovacao_nivel1"
      - passo: 11
        ator: "sistema"
        acao: "iniciar_aprovacao_nivel2"
      - passo: 12
        ator: "sistema"
        acao: "atualizar_status_baixado"
      - passo: 13
        ator: "sistema"
        acao: "registrar_movimentacao"
      - passo: 14
        ator: "sistema"
        acao: "enviar_evento_erp"

    regras_aplicadas:
      - "RN-RF025-003"  # Transições válidas
      - "RN-RF025-005"  # Chain of custody
      - "RN-RF025-010"  # Aprovação 2 níveis
      - "RN-RF025-014"  # Integração ERP

    resultado_final:
      estado: "ativo_baixado"

  - id: "UC10"
    nome: "Inventariar Ativo"
    ator_principal: "inventariante"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-VAL-05"
      uc_items:
        - id: "FP-UC10-001"
          title: "Usuário abre app e clica Inventariar"
          required: true
        - id: "FP-UC10-010"
          title: "Sistema atualiza Dt_Ultimo_Inventario"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.INVENTARIAR"

    gatilho: "Usuário clica em Inventariar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "abrir_app"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "usuario"
        acao: "escanear_qr_code"
      - passo: 4
        ator: "sistema"
        acao: "carregar_ativo"
      - passo: 5
        ator: "sistema"
        acao: "capturar_gps"
      - passo: 6
        ator: "sistema"
        acao: "validar_gps"
      - passo: 7
        ator: "usuario"
        acao: "tirar_foto"
      - passo: 8
        ator: "usuario"
        acao: "confirmar_estado"
      - passo: 9
        ator: "sistema"
        acao: "registrar_inventario"
      - passo: 10
        ator: "sistema"
        acao: "atualizar_dt_ultimo_inventario"

    regras_aplicadas:
      - "RN-RF025-009"  # GPS obrigatório
      - "RN-RF025-015"  # Inventário periódico

    resultado_final:
      estado: "ativo_inventariado"

  - id: "UC11"
    nome: "Consultar Histórico de Movimentações"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items: []
      uc_items:
        - id: "FP-UC11-001"
          title: "Usuário clica Histórico"
          required: true
        - id: "FP-UC11-006"
          title: "Sistema exibe timeline"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.HISTORICO"

    gatilho: "Usuário clica em Histórico"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_historico"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_movimentacoes"
      - passo: 4
        ator: "sistema"
        acao: "ordenar_cronologicamente"
      - passo: 5
        ator: "sistema"
        acao: "exibir_timeline"
      - passo: 6
        ator: "sistema"
        acao: "exibir_responsaveis"

    regras_aplicadas:
      - "RN-RF025-005"  # Chain of custody imutável

    resultado_final:
      estado: "historico_exibido"

  - id: "UC12"
    nome: "Gerar QR Code em Lote"
    ator_principal: "gestor_ti"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items: []
      uc_items:
        - id: "FP-UC12-001"
          title: "Usuário seleciona ativos"
          required: true
        - id: "FP-UC12-007"
          title: "Sistema disponibiliza PDF"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.GERAR_QR"

    gatilho: "Usuário clica em Gerar QR Codes"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_ativos"
      - passo: 2
        ator: "usuario"
        acao: "clicar_gerar_qr"
      - passo: 3
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 4
        ator: "sistema"
        acao: "gerar_pdf"
      - passo: 5
        ator: "sistema"
        acao: "incluir_numero_patrimonio"
      - passo: 6
        ator: "sistema"
        acao: "formatar_impressora"
      - passo: 7
        ator: "sistema"
        acao: "disponibilizar_download"
      - passo: 8
        ator: "sistema"
        acao: "registrar_log"

    regras_aplicadas:
      - "RN-RF025-002"  # QR Code 300x300px

    resultado_final:
      estado: "pdf_gerado"

  - id: "UC13"
    nome: "Visualizar Dashboard Executivo"
    ator_principal: "gestor_ti_diretoria"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items: []
      uc_items:
        - id: "FP-UC13-001"
          title: "Usuário acessa Dashboard"
          required: true
        - id: "FP-UC13-009"
          title: "Sistema exibe alertas garantia"
          required: true

    precondicoes:
      - permissao: "FIN.ATIVOS.DASHBOARD"

    gatilho: "Usuário acessa Dashboard"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_dashboard"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados_cache"
      - passo: 4
        ator: "sistema"
        acao: "exibir_grafico_status"
      - passo: 5
        ator: "sistema"
        acao: "exibir_grafico_tipo"
      - passo: 6
        ator: "sistema"
        acao: "exibir_grafico_utilizacao"
      - passo: 7
        ator: "sistema"
        acao: "exibir_top10_caros"
      - passo: 8
        ator: "sistema"
        acao: "exibir_ativos_atrasados"
      - passo: 9
        ator: "sistema"
        acao: "exibir_alertas_garantia"

    regras_aplicadas:
      - "RN-RF025-015"  # Inventário periódico

    resultado_final:
      estado: "dashboard_exibido"

  - id: "UC14"
    nome: "Calcular Depreciação Mensal (Job)"
    ator_principal: "sistema"
    tipo: "batch"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-JOB-01"
      uc_items:
        - id: "FP-UC14-001"
          title: "Job inicia dia 1 02:00 UTC"
          required: true
        - id: "FP-UC14-011"
          title: "Sistema registra log"
          required: true

    precondicoes:
      - job_hangfire: "configurado dia 1 do mês 02:00 UTC"

    gatilho: "Agendamento Hangfire"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "iniciar_job"
      - passo: 2
        ator: "sistema"
        acao: "carregar_ativos"
      - passo: 3
        ator: "sistema"
        acao: "identificar_metodo"
      - passo: 4
        ator: "sistema"
        acao: "calcular_depreciacao"
      - passo: 5
        ator: "sistema"
        acao: "atualizar_valor_depreciado"
      - passo: 6
        ator: "sistema"
        acao: "atualizar_dt_depreciacao"
      - passo: 7
        ator: "sistema"
        acao: "registrar_calculo"
      - passo: 8
        ator: "sistema"
        acao: "enviar_erp"
      - passo: 9
        ator: "sistema"
        acao: "retry_3x"
      - passo: 10
        ator: "sistema"
        acao: "enviar_dlq"
      - passo: 11
        ator: "sistema"
        acao: "registrar_log"

    regras_aplicadas:
      - "RN-RF025-006"  # Depreciação automática
      - "RN-RF025-014"  # Integração ERP

    resultado_final:
      estado: "depreciacao_calculada"

  - id: "UC15"
    nome: "Enviar Alertas de Garantia (Job)"
    ator_principal: "sistema"
    tipo: "batch"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-JOB-02"
      uc_items:
        - id: "FP-UC15-001"
          title: "Job inicia diariamente 08:00 UTC"
          required: true
        - id: "FP-UC15-008"
          title: "Sistema registra log"
          required: true

    precondicoes:
      - job_hangfire: "configurado diariamente 08:00 UTC"

    gatilho: "Agendamento Hangfire"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "iniciar_job"
      - passo: 2
        ator: "sistema"
        acao: "carregar_ativos_garantia"
      - passo: 3
        ator: "sistema"
        acao: "verificar_notificacoes_enviadas"
      - passo: 4
        ator: "sistema"
        acao: "enviar_email_90d"
      - passo: 5
        ator: "sistema"
        acao: "enviar_email_push_60d"
      - passo: 6
        ator: "sistema"
        acao: "enviar_email_push_inapp_30d"
      - passo: 7
        ator: "sistema"
        acao: "registrar_notificacao"
      - passo: 8
        ator: "sistema"
        acao: "registrar_log"

    regras_aplicadas:
      - "RN-RF025-007"  # Alertas automáticos

    resultado_final:
      estado: "alertas_enviados"

exclusions:
  uc_items: []

historico:
  - versao: "1.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão inicial com 16 UCs cobrindo 100% do RF025"
