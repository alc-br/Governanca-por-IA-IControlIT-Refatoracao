# =============================================
# UC-RF036 - Casos de Uso - Gestão de Custos Fixos
# Versão: 1.0
# Data: 2025-12-31
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF036"
  rf_id: "RF036"
  rf_nome: "Gestão de Custos Fixos"
  versao: "2.0"
  data: "2025-12-31"
  autor: "Agência ALC - alc.dev.br"
  total_ucs: 11
  total_regras_cobertas: 13
  cobertura_percentual: 100

casos_de_uso:
  - id: "UC00"
    nome: "Listar Custos Fixos"
    tipo: "leitura"
    complexidade: "media"
    objetivo: "Permitir ao usuário listar todos os custos fixos cadastrados com filtros, ordenação e paginação."
    covers:
      rf_items:
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.VIEW"
    poscondicoes:
      - "Lista de custos fixos exibida conforme filtros aplicados"
      - "Apenas custos do conglomerado do usuário são retornados"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa tela de Custos Fixos"
      - passo: 2
        acao: "Sistema lista custos fixos com paginação (20 registros/página), colunas: Descrição, Tipo, Valor Orçado, Data Início, Data Fim, Fornecedor, Status"
      - passo: 3
        acao: "Sistema permite filtros: tipo de custo, fornecedor, status, período (Data Início)"
      - passo: 4
        acao: "Sistema permite ordenação por qualquer coluna"
      - passo: 5
        acao: "Usuário visualiza lista filtrada"
    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "Nenhum custo fixo encontrado"
        passos:
          - "Passo 2: Sistema exibe mensagem: Nenhum custo fixo encontrado"
    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "Usuário sem permissão"
        passos:
          - "Passo 1: Sistema retorna HTTP 403 com mensagem: Acesso negado"
    regras_aplicadas:
      - "RN-RF036-13"

  - id: "UC01"
    nome: "Criar Custo Fixo"
    tipo: "escrita"
    complexidade: "alta"
    objetivo: "Permitir ao usuário cadastrar um novo custo fixo mensal com informações obrigatórias e opcionais."
    covers:
      rf_items:
        - "RN-RF036-01"
        - "RN-RF036-08"
        - "RN-RF036-09"
        - "RN-RF036-10"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.CREATE"
    poscondicoes:
      - "Custo fixo criado no banco de dados"
      - "Status inicial = Ativo"
      - "Registro auditado (UsuarioCriacaoId, DataCriacao)"
      - "Se Data Início ≤ hoje → custo elegível para provisionamento automático"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa tela de Custos Fixos e clica em Novo Custo Fixo"
      - passo: 2
        acao: "Sistema exibe formulário com campos obrigatórios e opcionais"
      - passo: 3
        acao: "Usuário preenche formulário e clica em Salvar"
      - passo: 4
        acao: "Sistema valida campos obrigatórios, limites, Data Fim > Data Início, Fornecedor/Contrato do mesmo ConglomeradoId"
      - passo: 5
        acao: "Sistema cria custo fixo com ConglomeradoId do usuário, Status informado, auditoria"
      - passo: 6
        acao: "Sistema exibe mensagem de sucesso e redireciona para listagem"
    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "Usuário cancela criação"
        passos:
          - "Passo 3: Usuário clica em Cancelar"
          - "Sistema descarta dados e volta para listagem"
    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "Campo obrigatório ausente"
        passos:
          - "Passo 4: Sistema retorna HTTP 400 com mensagem específica"
      - id: "FE-UC01-02"
        condicao: "Descrição excede 500 caracteres"
        passos:
          - "Passo 4: Sistema retorna HTTP 400"
      - id: "FE-UC01-03"
        condicao: "Valor Orçado ≤ 0"
        passos:
          - "Passo 4: Sistema retorna HTTP 400"
      - id: "FE-UC01-04"
        condicao: "Data Início futura"
        passos:
          - "Passo 4: Sistema retorna HTTP 400"
      - id: "FE-UC01-05"
        condicao: "Data Fim < Data Início"
        passos:
          - "Passo 4: Sistema retorna HTTP 400"
      - id: "FE-UC01-06"
        condicao: "Fornecedor de outro conglomerado"
        passos:
          - "Passo 4: Sistema retorna HTTP 400"
    regras_aplicadas:
      - "RN-RF036-01"
      - "RN-RF036-08"
      - "RN-RF036-09"
      - "RN-RF036-10"
      - "RN-RF036-13"

  - id: "UC02"
    nome: "Visualizar Custo Fixo"
    tipo: "leitura"
    complexidade: "baixa"
    objetivo: "Permitir ao usuário visualizar detalhes completos de um custo fixo específico, incluindo lançamentos históricos e projeções."
    covers:
      rf_items:
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.VIEW"
      - "Custo fixo existe e pertence ao ConglomeradoId do usuário"
    poscondicoes:
      - "Detalhes do custo fixo exibidos"
      - "Histórico de lançamentos exibido (últimos 12 meses)"
      - "Projeção de custos futuros exibida (próximos 3 meses)"
    fluxo_principal:
      - passo: 1
        acao: "Usuário clica em custo fixo na listagem"
      - passo: 2
        acao: "Sistema valida que custo fixo pertence ao ConglomeradoId do usuário"
      - passo: 3
        acao: "Sistema exibe dados principais, histórico de lançamentos, gráfico de evolução, projeção futura, auditoria"
      - passo: 4
        acao: "Usuário visualiza informações"
    fluxos_alternativos: []
    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "Custo fixo não encontrado ou de outro conglomerado"
        passos:
          - "Passo 2: Sistema retorna HTTP 404"
    regras_aplicadas:
      - "RN-RF036-13"

  - id: "UC03"
    nome: "Editar Custo Fixo"
    tipo: "escrita"
    complexidade: "media"
    objetivo: "Permitir ao usuário alterar informações de um custo fixo existente."
    covers:
      rf_items:
        - "RN-RF036-01"
        - "RN-RF036-08"
        - "RN-RF036-09"
        - "RN-RF036-10"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.UPDATE"
      - "Custo fixo existe e pertence ao ConglomeradoId do usuário"
    poscondicoes:
      - "Custo fixo atualizado no banco de dados"
      - "Registro auditado (UsuarioAlteracaoId, DataAlteracao)"
      - "Se status mudou para Ativo → custo elegível para provisionamento futuro"
      - "Se status mudou para Inativo/Cancelado → provisionamento automático para"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa tela de visualização e clica em Editar"
      - passo: 2
        acao: "Sistema exibe formulário preenchido com dados atuais"
      - passo: 3
        acao: "Usuário altera campos desejados e clica em Salvar"
      - passo: 4
        acao: "Sistema valida campos obrigatórios, limites, Data Fim > Data Início, Fornecedor/Contrato do mesmo ConglomeradoId"
      - passo: 5
        acao: "Sistema atualiza custo fixo com UsuarioAlteracaoId e DataAlteracao"
      - passo: 6
        acao: "Sistema exibe mensagem de sucesso"
    fluxos_alternativos:
      - id: "FA-UC03-01"
        condicao: "Usuário cancela edição"
        passos:
          - "Passo 3: Usuário clica em Cancelar"
          - "Sistema descarta alterações e volta para visualização"
    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "Campo obrigatório ausente"
        passos:
          - "Passo 4: Sistema retorna HTTP 400"
      - id: "FE-UC03-02"
        condicao: "Validações diversas (mesmas de UC01)"
        passos:
          - "Passo 4: Sistema retorna HTTP 400 conforme violação"
      - id: "FE-UC03-03"
        condicao: "Custo fixo não encontrado ou de outro conglomerado"
        passos:
          - "Passo 1: Sistema retorna HTTP 404"
    regras_aplicadas:
      - "RN-RF036-01"
      - "RN-RF036-08"
      - "RN-RF036-09"
      - "RN-RF036-10"
      - "RN-RF036-13"

  - id: "UC04"
    nome: "Inativar Custo Fixo"
    tipo: "escrita"
    complexidade: "baixa"
    objetivo: "Permitir ao usuário inativar um custo fixo, interrompendo provisionamento automático futuro."
    covers:
      rf_items:
        - "RN-RF036-10"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.UPDATE"
      - "Custo fixo existe, pertence ao ConglomeradoId do usuário e tem status Ativo"
    poscondicoes:
      - "Status do custo fixo = Inativo"
      - "Provisionamento automático NÃO cria mais lançamentos futuros para este custo"
      - "Lançamentos históricos permanecem inalterados"
      - "Registro auditado (UsuarioAlteracaoId, DataAlteracao)"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa tela de visualização e clica em Inativar"
      - passo: 2
        acao: "Sistema exibe confirmação"
      - passo: 3
        acao: "Usuário confirma"
      - passo: 4
        acao: "Sistema atualiza Status = Inativo, UsuarioAlteracaoId, DataAlteracao"
      - passo: 5
        acao: "Sistema exibe mensagem de sucesso"
    fluxos_alternativos:
      - id: "FA-UC04-01"
        condicao: "Usuário cancela inativação"
        passos:
          - "Passo 3: Usuário clica em Cancelar"
          - "Sistema descarta ação e mantém status atual"
    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "Custo fixo não encontrado ou de outro conglomerado"
        passos:
          - "Passo 1: Sistema retorna HTTP 404"
      - id: "FE-UC04-02"
        condicao: "Custo fixo já está inativo"
        passos:
          - "Passo 1: Sistema retorna HTTP 400"
    regras_aplicadas:
      - "RN-RF036-10"
      - "RN-RF036-13"

  - id: "UC05"
    nome: "Provisionar Custos Fixos (Job Automático)"
    tipo: "job"
    complexidade: "alta"
    objetivo: "Executar job automático mensal que cria lançamentos de custos fixos ativos para o mês corrente."
    covers:
      rf_items:
        - "RN-RF036-02"
        - "RN-RF036-10"
        - "RN-RF036-13"
    precondicoes:
      - "Job configurado para executar no 1º dia útil do mês"
      - "Existem custos fixos com Status = Ativo"
    poscondicoes:
      - "Lançamentos criados para todos os custos fixos elegíveis"
      - "Cada lançamento tem Status = Provisionado, FlProvisionamentoAutomatico = true"
      - "Notificações enviadas aos responsáveis"
      - "Log de execução do job registrado"
    fluxo_principal:
      - passo: 1
        acao: "Sistema inicia job no 1º dia útil do mês"
      - passo: 2
        acao: "Sistema consulta custos fixos com Status=Ativo, DataInicio≤hoje, DataFim IS NULL OU DataFim≥hoje"
      - passo: 3
        acao: "Para cada custo fixo elegível: verifica se já existe lançamento (evita duplicatas), busca lançamento mês anterior, calcula Valor Provisionado, cria lançamento com ConglomeradoId do custo fixo"
      - passo: 4
        acao: "Sistema envia notificação ao responsável de cada custo fixo"
      - passo: 5
        acao: "Sistema registra log de execução"
    fluxos_alternativos:
      - id: "FA-UC05-01"
        condicao: "Nenhum custo fixo elegível"
        passos:
          - "Passo 2: Sistema não encontra custos fixos elegíveis"
          - "Sistema registra log e finaliza job com sucesso"
    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "Erro ao criar lançamento"
        passos:
          - "Passo 3: Sistema registra erro no log"
          - "Sistema continua processando próximo custo fixo (não bloqueia job inteiro)"
    regras_aplicadas:
      - "RN-RF036-02"
      - "RN-RF036-10"
      - "RN-RF036-13"

  - id: "UC06"
    nome: "Registrar Valor Realizado"
    tipo: "escrita"
    complexidade: "alta"
    objetivo: "Permitir ao usuário informar o valor efetivamente realizado de um lançamento provisionado, com validação automática de variação orçamentária e detecção de anomalias."
    covers:
      rf_items:
        - "RN-RF036-03"
        - "RN-RF036-04"
        - "RN-RF036-05"
        - "RN-RF036-07"
        - "RN-RF036-12"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.UPDATE"
      - "Lançamento existe, pertence ao ConglomeradoId do usuário e tem Status = Provisionado"
    poscondicoes:
      - "Valor Realizado registrado no lançamento"
      - "Variação orçamentária calculada automaticamente"
      - "Se variação ≥10% → Alerta emitido"
      - "Se variação ≥20% → Justificativa obrigatória"
      - "Se variação ≥30% → Status = Aguardando Aprovação"
      - "Detecção de anomalias executada"
      - "Registro auditado"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa lançamento com Status=Provisionado e clica em Registrar Valor Realizado"
      - passo: 2
        acao: "Sistema exibe formulário: Valor Realizado*, Justificativa (obrigatório SE variação>20%), Data Realização*"
      - passo: 3
        acao: "Usuário preenche Valor Realizado e clica em Salvar"
      - passo: 4
        acao: "Sistema calcula Variação % = |ValorRealizado - ValorOrcado| / ValorOrcado × 100"
      - passo: 5
        acao: "Sistema valida: SE variação≥20% E Justificativa ausente → HTTP 400, Justificativa≥10 caracteres"
      - passo: 6
        acao: "Sistema atualiza lançamento com ValorRealizado, Justificativa, DataRealizacao, auditoria"
      - passo: 7
        acao: "Sistema determina novo Status: SE variação<30% → Realizado, SE variação≥30% → Aguardando Aprovação + RequereAprovacaoGerencial=true"
      - passo: 8
        acao: "Sistema executa detecção de anomalias: busca últimos 6 meses, SE histórico<3 meses pula, calcula média e σ, SE ValorRealizado > média + (2×σ) → FlAnomalia=true + DescricaoAnomalia + alerta"
      - passo: 9
        acao: "Sistema emite alerta de variação orçamentária conforme nível (10%, 20%, 30%)"
      - passo: 10
        acao: "Sistema exibe mensagem de sucesso"
    fluxos_alternativos:
      - id: "FA-UC06-01"
        condicao: "Usuário cancela registro"
        passos:
          - "Passo 3: Usuário clica em Cancelar"
          - "Sistema descarta dados e volta para visualização"
    fluxos_excecao:
      - id: "FE-UC06-01"
        condicao: "Variação >20% sem justificativa"
        passos:
          - "Passo 5: Sistema retorna HTTP 400"
      - id: "FE-UC06-02"
        condicao: "Justificativa < 10 caracteres"
        passos:
          - "Passo 5: Sistema retorna HTTP 400"
      - id: "FE-UC06-03"
        condicao: "Lançamento já possui Status = Pago"
        passos:
          - "Passo 1: Sistema retorna HTTP 400"
      - id: "FE-UC06-04"
        condicao: "Lançamento não encontrado ou de outro conglomerado"
        passos:
          - "Passo 1: Sistema retorna HTTP 404"
    regras_aplicadas:
      - "RN-RF036-03"
      - "RN-RF036-04"
      - "RN-RF036-05"
      - "RN-RF036-07"
      - "RN-RF036-12"
      - "RN-RF036-13"

  - id: "UC07"
    nome: "Aprovar Lançamento"
    tipo: "escrita"
    complexidade: "media"
    objetivo: "Permitir a um gestor aprovar ou reprovar lançamentos que ultrapassaram variação orçamentária de 30%."
    covers:
      rf_items:
        - "RN-RF036-05"
        - "RN-RF036-12"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.APROVAR"
      - "Lançamento existe, pertence ao ConglomeradoId do usuário e tem Status = Aguardando Aprovação"
    poscondicoes:
      - "SE aprovado: Status = Aprovado + AprovadoPor = usuário autenticado"
      - "SE reprovado: Status = Cancelado + MotivoReprovacao registrado"
      - "Registro auditado"
      - "Notificação enviada ao responsável do custo fixo"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa lançamento com Status=Aguardando Aprovação"
      - passo: 2
        acao: "Sistema exibe dados do lançamento e botões: Aprovar | Reprovar"
      - passo: 3
        acao: "Usuário clica em Aprovar"
      - passo: 4
        acao: "Sistema confirma: Tem certeza que deseja aprovar este lançamento?"
      - passo: 5
        acao: "Usuário confirma"
      - passo: 6
        acao: "Sistema atualiza Status=Aprovado, AprovadoPor, DataAprovacao, auditoria"
      - passo: 7
        acao: "Sistema envia notificação ao responsável do custo fixo"
      - passo: 8
        acao: "Sistema exibe mensagem de sucesso"
    fluxos_alternativos:
      - id: "FA-UC07-01"
        condicao: "Usuário reprova lançamento"
        passos:
          - "Passo 3: Usuário clica em Reprovar"
          - "Sistema exibe campo: Motivo da Reprovação* (≥10 caracteres)"
          - "Usuário preenche motivo e confirma"
          - "Sistema atualiza Status=Cancelado, MotivoReprovacao, ReprovadoPor, DataReprovacao"
          - "Sistema envia notificação ao responsável"
          - "Sistema exibe mensagem de sucesso"
      - id: "FA-UC07-02"
        condicao: "Usuário cancela ação"
        passos:
          - "Passo 5: Usuário clica em Cancelar"
          - "Sistema descarta ação e mantém status atual"
    fluxos_excecao:
      - id: "FE-UC07-01"
        condicao: "Usuário sem permissão"
        passos:
          - "Passo 1: Sistema retorna HTTP 403"
      - id: "FE-UC07-02"
        condicao: "Lançamento não está aguardando aprovação"
        passos:
          - "Passo 1: Sistema retorna HTTP 400"
      - id: "FE-UC07-03"
        condicao: "Motivo de reprovação < 10 caracteres"
        passos:
          - "FA-UC07-01: Sistema retorna HTTP 400"
      - id: "FE-UC07-04"
        condicao: "Lançamento já está pago"
        passos:
          - "Passo 1: Sistema retorna HTTP 400"
    regras_aplicadas:
      - "RN-RF036-05"
      - "RN-RF036-12"
      - "RN-RF036-13"

  - id: "UC08"
    nome: "Configurar Rateio"
    tipo: "escrita"
    complexidade: "media"
    objetivo: "Permitir ao usuário configurar distribuição percentual de um custo fixo entre múltiplos centros de custo."
    covers:
      rf_items:
        - "RN-RF036-06"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.UPDATE"
      - "Custo fixo existe e pertence ao ConglomeradoId do usuário"
    poscondicoes:
      - "Itens de rateio criados/atualizados"
      - "Soma dos percentuais = 100%"
      - "Registro auditado"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa tela de visualização e clica em Configurar Rateio"
      - passo: 2
        acao: "Sistema exibe formulário com grid de rateio: Centro de Custo, Percentual (%), botões: Adicionar Linha | Remover Linha"
      - passo: 3
        acao: "Usuário adiciona linhas: seleciona Centro de Custo (apenas do mesmo ConglomeradoId), informa Percentual (0 < x ≤ 100)"
      - passo: 4
        acao: "Usuário clica em Salvar"
      - passo: 5
        acao: "Sistema valida: ao menos 1 item, cada Percentual > 0 e ≤ 100, soma = 100%, cada Centro de Custo pertence ao mesmo ConglomeradoId"
      - passo: 6
        acao: "Sistema salva itens de rateio com CustoFixoId, CentroCustoId, Percentual, ConglomeradoId, auditoria"
      - passo: 7
        acao: "Sistema exibe mensagem de sucesso"
    fluxos_alternativos:
      - id: "FA-UC08-01"
        condicao: "Usuário remove rateio existente"
        passos:
          - "Passo 1: Usuário acessa formulário e remove todas as linhas"
          - "Sistema permite salvar sem itens de rateio (rateio é opcional)"
      - id: "FA-UC08-02"
        condicao: "Usuário cancela configuração"
        passos:
          - "Passo 4: Usuário clica em Cancelar"
          - "Sistema descarta alterações"
    fluxos_excecao:
      - id: "FE-UC08-01"
        condicao: "Soma dos percentuais ≠ 100%"
        passos:
          - "Passo 5: Sistema retorna HTTP 400"
      - id: "FE-UC08-02"
        condicao: "Percentual ≤ 0 ou > 100"
        passos:
          - "Passo 5: Sistema retorna HTTP 400"
      - id: "FE-UC08-03"
        condicao: "Centro de Custo de outro conglomerado"
        passos:
          - "Passo 5: Sistema retorna HTTP 400"
    regras_aplicadas:
      - "RN-RF036-06"
      - "RN-RF036-13"

  - id: "UC09"
    nome: "Dashboard de Custos Fixos"
    tipo: "leitura"
    complexidade: "alta"
    objetivo: "Exibir visão consolidada dos custos fixos com KPIs, gráficos e análises comparativas."
    covers:
      rf_items:
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.VIEW"
      - "Existem custos fixos e lançamentos no ConglomeradoId do usuário"
    poscondicoes:
      - "Dashboard exibido com dados atualizados"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa menu Custos Fixos > Dashboard"
      - passo: 2
        acao: "Sistema exibe KPIs (Total Custos Fixos Ativos, Total Orçado mês corrente, Total Realizado mês corrente, Variação %), Top 10 Maiores Custos Fixos, Gráfico Evolução Mensal por Categoria (últimos 12 meses), Análise YoY, Ranking Maiores Variações (Top 5), Alertas Ativos"
      - passo: 3
        acao: "Usuário visualiza dashboard"
    fluxos_alternativos:
      - id: "FA-UC09-01"
        condicao: "Nenhum dado disponível"
        passos:
          - "Passo 2: Sistema exibe mensagem: Nenhum custo fixo encontrado para exibir no dashboard"
    fluxos_excecao: []
    regras_aplicadas:
      - "RN-RF036-13"

  - id: "UC10"
    nome: "Projeção de Custos"
    tipo: "leitura"
    complexidade: "media"
    objetivo: "Projetar valores futuros de custos fixos para os próximos 3, 6 ou 12 meses, considerando recorrência e sazonalidade."
    covers:
      rf_items:
        - "RN-RF036-02"
        - "RN-RF036-08"
        - "RN-RF036-13"
    precondicoes:
      - "Usuário autenticado"
      - "Usuário possui permissão GES.CUSTOS_FIXOS.VIEW"
      - "Existem custos fixos ativos no ConglomeradoId do usuário"
    poscondicoes:
      - "Projeção de custos exibida em formato de tabela e gráfico"
    fluxo_principal:
      - passo: 1
        acao: "Usuário acessa menu Custos Fixos > Projeção de Custos"
      - passo: 2
        acao: "Sistema exibe filtros: Período de Projeção (3, 6, 12 meses - padrão: 3 meses), Categoria (dropdown: Todas, Aluguel, Suporte, etc.)"
      - passo: 3
        acao: "Usuário seleciona período e clica em Gerar Projeção"
      - passo: 4
        acao: "Sistema calcula projeção: para cada custo fixo ativo, SE DataFim < período projetado → NÃO incluir meses após DataFim, SE Status=Ativo E DataInicio≤mês projetado → Valor Projetado = média dos últimos 3 meses OU Valor Orçado, agrupa por mês e categoria"
      - passo: 5
        acao: "Sistema exibe Tabela de Projeção (Mês/Ano, Categoria, Valor Projetado, Quantidade de Custos) e Gráfico de Barras (séries por categoria)"
      - passo: 6
        acao: "Usuário visualiza projeção"
    fluxos_alternativos:
      - id: "FA-UC10-01"
        condicao: "Usuário exporta projeção"
        passos:
          - "Passo 6: Usuário clica em Exportar para Excel"
          - "Sistema gera arquivo Excel com dados da projeção"
          - "Sistema inicia download"
    fluxos_excecao:
      - id: "FE-UC10-01"
        condicao: "Nenhum custo fixo ativo"
        passos:
          - "Passo 4: Sistema exibe mensagem: Nenhum custo fixo ativo encontrado para projeção"
    regras_aplicadas:
      - "RN-RF036-02"
      - "RN-RF036-08"
      - "RN-RF036-13"

rastreabilidade:
  regras_negocio:
    - id: "RN-RF036-01"
      casos_uso: ["UC01", "UC03"]
    - id: "RN-RF036-02"
      casos_uso: ["UC05", "UC10"]
    - id: "RN-RF036-03"
      casos_uso: ["UC06"]
    - id: "RN-RF036-04"
      casos_uso: ["UC06"]
    - id: "RN-RF036-05"
      casos_uso: ["UC06", "UC07"]
    - id: "RN-RF036-06"
      casos_uso: ["UC08"]
    - id: "RN-RF036-07"
      casos_uso: ["UC06"]
    - id: "RN-RF036-08"
      casos_uso: ["UC01", "UC03", "UC10"]
    - id: "RN-RF036-09"
      casos_uso: ["UC01", "UC03"]
    - id: "RN-RF036-10"
      casos_uso: ["UC01", "UC03", "UC04", "UC05"]
    - id: "RN-RF036-11"
      casos_uso: [] # Dashboard - alertas automáticos
      observacao: "Alertas de vencimento são exibidos automaticamente no Dashboard (UC09)"
    - id: "RN-RF036-12"
      casos_uso: ["UC06", "UC07"]
    - id: "RN-RF036-13"
      casos_uso: ["UC00", "UC01", "UC02", "UC03", "UC04", "UC05", "UC06", "UC07", "UC08", "UC09", "UC10"]

padroes_gerais:
  multi_tenancy:
    descricao: "Todas as operações filtram automaticamente por ConglomeradoId do usuário autenticado"
    aplicacao: "TODOS os UCs"
    regra: "RN-RF036-13"
  auditoria:
    descricao: "Todas as operações de CREATE, UPDATE, DELETE geram registros de auditoria"
    campos: ["UsuarioCriacaoId", "DataCriacao", "UsuarioAlteracaoId", "DataAlteracao"]
    aplicacao: "UC01, UC03, UC04, UC05, UC06, UC07, UC08"
  rbac:
    descricao: "Controle de acesso baseado em permissões RBAC"
    permissoes:
      - codigo: "GES.CUSTOS_FIXOS.VIEW"
        descricao: "Visualizar custos fixos"
        ucs: ["UC00", "UC02", "UC09", "UC10"]
      - codigo: "GES.CUSTOS_FIXOS.CREATE"
        descricao: "Criar custo fixo"
        ucs: ["UC01"]
      - codigo: "GES.CUSTOS_FIXOS.UPDATE"
        descricao: "Editar custo fixo"
        ucs: ["UC03", "UC04", "UC06", "UC08"]
      - codigo: "GES.CUSTOS_FIXOS.DELETE"
        descricao: "Excluir custo fixo (soft delete)"
        ucs: []
      - codigo: "GES.CUSTOS_FIXOS.APROVAR"
        descricao: "Aprovar lançamentos com variação >30%"
        ucs: ["UC07"]
      - codigo: "GES.CUSTOS_FIXOS.PROVISIONAR"
        descricao: "Executar provisionamento manual"
        ucs: []
      - codigo: "GES.CUSTOS_FIXOS.EXPORT"
        descricao: "Exportar relatórios de custos fixos"
        ucs: ["UC10"]
  soft_delete:
    descricao: "Exclusões são lógicas (FlExcluido = true)"
    aplicacao: "Todas as entidades (CustoFixo, LancamentoCustoFixo, RateioCustoFixo)"
  validacoes:
    descricao: "Validações retornam HTTP 400 com mensagens específicas"
    aplicacao: "UC01, UC03, UC04, UC06, UC07, UC08"

exclusions:
  uc_items: []

historico:
  - versao: "1.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Geração completa de UCs v1.0 YAML conforme CONTRATO-GERACAO-DOCS-UC.md: 11 UCs cobrindo 13 RNs"
