# Casos de Uso - RF031: GestÃ£o de Plano de Contas ContÃ¡bil Multi-Dimensional

**VersÃ£o:** 1.0
**Data:** 2025-01-14
**RF Relacionado:** [RF031 - GestÃ£o de Plano de Contas ContÃ¡bil Multi-Dimensional](../RF031.md)

---

## Ãndice de Casos de Uso

| UC | Nome | DescriÃ§Ã£o |
|----|------|-----------|
| UC01 | Listar Plano de Contas | Lista hierÃ¡rquica de contas contÃ¡beis com drill-down |
| UC02 | Criar Conta ContÃ¡bil | CriaÃ§Ã£o de nova conta na estrutura hierÃ¡rquica |
| UC03 | Editar Conta ContÃ¡bil | EdiÃ§Ã£o de conta existente com versionamento |
| UC04 | Visualizar Conta ContÃ¡bil | VisualizaÃ§Ã£o detalhada com histÃ³rico |
| UC05 | Inativar/Excluir Conta ContÃ¡bil | Soft delete com validaÃ§Ã£o de dependÃªncias |
| UC06 | Mover Conta na Hierarquia | Drag-and-drop com preview de impacto |
| UC07 | Importar Estrutura de ERP | ImportaÃ§Ã£o multi-layout (SAP, TOTVS, Oracle, etc.) |
| UC08 | Classificar LanÃ§amentos Automaticamente | Engine de regras com ML para classificaÃ§Ã£o |
| UC09 | Gerar RelatÃ³rio DRE Multi-Dimensional | DRE com drill-down e anÃ¡lises comparativas |

---

## UC01 - Listar Plano de Contas

### DescriÃ§Ã£o
Permite visualizar a estrutura hierÃ¡rquica completa do plano de contas contÃ¡bil com atÃ© 7 nÃ­veis de profundidade, com capacidade de expandir/contrair nÃ³s e filtrar por tipo de conta.

### Atores
- UsuÃ¡rio autenticado (Controller, CFO, Gerente Financeiro, Analista ContÃ¡bil, Consulta)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.VIEW`
- Ao menos uma estrutura de plano de contas cadastrada

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Acessa menu "GestÃ£o > Plano de Contas" | - |
| 2 | - | Carrega estrutura hierÃ¡rquica (tree view) |
| 3 | - | Exibe contas nÃ­vel 1 (Classe: Ativo, Passivo, Receitas, Custos, Despesas) |
| 4 | Clica em Ã­cone expandir (+) ao lado de uma conta | - |
| 5 | - | Carrega e exibe contas filhas do prÃ³ximo nÃ­vel |
| 6 | Pode filtrar por tipo (SintÃ©tica/AnalÃ­tica) | Aplica filtro e atualiza tree |
| 7 | Pode buscar por cÃ³digo ou nome da conta | Sistema destaca e expande caminho atÃ© a conta encontrada |

### Campos Exibidos na Listagem

| Campo | DescriÃ§Ã£o | Formato |
|-------|-----------|---------|
| CÃ³digo ContÃ¡bil | Ex: 5.1.2.01.001 | Text, tree indentation |
| Nome da Conta | Ex: Telefonia MÃ³vel Corporativa | Text, bold para sintÃ©ticas |
| Tipo | SintÃ©tica (S) ou AnalÃ­tica (A) | Badge colorido |
| NÃ­vel | NÃ­vel hierÃ¡rquico (1-7) | NÃºmero |
| Permite LanÃ§amento | Sim/NÃ£o (sÃ³ analÃ­ticas) | Icon check/cross |
| Status | Ativo/Inativo | Badge verde/vermelho |
| AÃ§Ãµes | Editar, Mover, Excluir | BotÃµes |

### Fluxos Alternativos

**FA01 - Lista Vazia**
- **CondiÃ§Ã£o:** NÃ£o existem contas cadastradas para este conglomerado
- **AÃ§Ã£o:** Sistema exibe mensagem "Nenhuma conta cadastrada. Clique em 'Nova Conta' ou 'Importar Estrutura' para comeÃ§ar"

**FA02 - Expandir Todos os NÃ­veis**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em botÃ£o "Expandir Tudo"
- **AÃ§Ã£o:** Sistema expande recursivamente todos os nÃ³s atÃ© nÃ­vel mÃ¡ximo (limite 1000 contas visÃ­veis por performance)

**FA03 - Exportar para Excel**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Exportar"
- **AÃ§Ã£o:** Sistema gera Excel com estrutura flat (colunas: CÃ³digo, Nome, Tipo, NÃ­vel, Pai, Status)

### ExceÃ§Ãµes

**EX01 - Erro ao Carregar Hierarquia**
- **CondiÃ§Ã£o:** Falha na query ao banco (timeout, erro de conexÃ£o)
- **AÃ§Ã£o:** Sistema exibe mensagem "Erro ao carregar plano de contas. Tente novamente." + botÃ£o "Recarregar"

**EX02 - Hierarquia Circular Detectada (Dados Corrompidos)**
- **CondiÃ§Ã£o:** Banco contÃ©m loop circular (A â†’ B â†’ C â†’ A)
- **AÃ§Ã£o:** Sistema detecta loop, exibe alerta "Estrutura contÃ¡bil com inconsistÃªncia detectada. Contate o administrador." e registra erro em log

### PÃ³s-condiÃ§Ãµes
- Estrutura hierÃ¡rquica exibida corretamente
- UsuÃ¡rio pode navegar pelos nÃ­veis

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-01: Estrutura HierÃ¡rquica AtÃ© 7 NÃ­veis ConfigurÃ¡veis
- RN-RF031-14: Isolamento Multi-Tenant com Row-Level Security

### Wireframe Simplificado
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Plano de Contas ContÃ¡bil                    [+ Nova Conta] [â¬†ï¸ Importar] [â¬‡ï¸ Exportar] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Buscar: [_____________]  Filtro: [Todas â–¼] [Expandir Tudo]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+] 1. Ativo                                  (S) NÃ­vel 1   [â‹®] â”‚
â”‚ [+] 2. Passivo                                (S) NÃ­vel 1   [â‹®] â”‚
â”‚ [-] 3. Receitas                               (S) NÃ­vel 1   [â‹®] â”‚
â”‚   [+] 3.1 Receitas Operacionais              (S) NÃ­vel 2   [â‹®] â”‚
â”‚   [-] 3.2 Outras Receitas                    (S) NÃ­vel 2   [â‹®] â”‚
â”‚     [+] 3.2.1 Receitas Financeiras           (S) NÃ­vel 3   [â‹®] â”‚
â”‚ [+] 4. Custos                                 (S) NÃ­vel 1   [â‹®] â”‚
â”‚ [-] 5. Despesas                               (S) NÃ­vel 1   [â‹®] â”‚
â”‚   [-] 5.1 Despesas Administrativas           (S) NÃ­vel 2   [â‹®] â”‚
â”‚     [-] 5.1.2 Despesas Gerais                (S) NÃ­vel 3   [â‹®] â”‚
â”‚       [-] 5.1.2.01 Despesas Telecom          (S) NÃ­vel 4   [â‹®] â”‚
â”‚         â†’ 5.1.2.01.001 Telefonia MÃ³vel       (A) NÃ­vel 5 âœ… [ğŸ“][ğŸ—‘ï¸] â”‚
â”‚         â†’ 5.1.2.01.002 Telefonia Fixa        (A) NÃ­vel 5 âœ… [ğŸ“][ğŸ—‘ï¸] â”‚
â”‚         â†’ 5.1.2.01.003 Internet/Links        (A) NÃ­vel 5 âœ… [ğŸ“][ğŸ—‘ï¸] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Legenda: (S)=SintÃ©tica, (A)=AnalÃ­tica, âœ…=Permite LanÃ§amento
```

---

## UC02 - Criar Conta ContÃ¡bil

### DescriÃ§Ã£o
Permite criar nova conta contÃ¡bil na estrutura hierÃ¡rquica, definindo cÃ³digo, nome, tipo (SintÃ©tica/AnalÃ­tica) e conta pai.

### Atores
- UsuÃ¡rio autenticado com permissÃ£o de criaÃ§Ã£o (Controller, CFO, Gerente Financeiro, Analista ContÃ¡bil)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.CREATE`
- Se criar conta filha, conta pai deve existir e estar ativa

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Clica em botÃ£o "Nova Conta" | - |
| 2 | - | Exibe modal de criaÃ§Ã£o com formulÃ¡rio em branco |
| 3 | Seleciona conta pai no dropdown hierÃ¡rquico (opcional para nÃ­vel 1) | - |
| 4 | Informa cÃ³digo contÃ¡bil (ex: 5.1.2.01.004) | Sistema valida formato e unicidade em tempo real |
| 5 | Informa nome da conta (ex: Cloud Computing) | - |
| 6 | Seleciona tipo de conta (SintÃ©tica ou AnalÃ­tica) | Sistema exibe descriÃ§Ã£o de cada tipo |
| 7 | Se tipo = AnalÃ­tica, marca checkbox "Permite LanÃ§amento" (prÃ©-marcado) | - |
| 8 | Define natureza do saldo (Devedora/Credora) | - |
| 9 | Adiciona observaÃ§Ãµes (campo opcional) | - |
| 10 | Clica em "Salvar" | - |
| 11 | - | Valida todos os campos conforme regras de negÃ³cio |
| 12 | - | Salva conta no banco com auditoria completa |
| 13 | - | Exibe mensagem "Conta criada com sucesso" |
| 14 | - | Redireciona para tree view com novo item expandido e destacado |

### Campos do FormulÃ¡rio

| Campo | Tipo | ObrigatÃ³rio | ValidaÃ§Ã£o |
|-------|------|-------------|-----------|
| Conta Pai | Dropdown hierÃ¡rquico | NÃ£o (se nÃ­vel 1) | Deve existir e estar ativa |
| CÃ³digo ContÃ¡bil | Text | Sim | Ãšnico, max 50 caracteres, formato configurÃ¡vel |
| Nome da Conta | Text | Sim | Max 200 caracteres |
| Tipo de Conta | Radio (SintÃ©tica/AnalÃ­tica) | Sim | - |
| Permite LanÃ§amento | Checkbox | NÃ£o | SÃ³ habilitado se tipo = AnalÃ­tica |
| Natureza Saldo | Radio (Devedora/Credora) | Sim | - |
| ObservaÃ§Ãµes | Textarea | NÃ£o | Max 500 caracteres |

### Fluxos Alternativos

**FA01 - Cancelar**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Cancelar" ou fecha modal
- **AÃ§Ã£o:** Sistema descarta dados e retorna Ã  listagem

**FA02 - Sugerir CÃ³digo AutomÃ¡tico**
- **CondiÃ§Ã£o:** UsuÃ¡rio deixa campo cÃ³digo em branco e seleciona conta pai
- **AÃ§Ã£o:** Sistema sugere prÃ³ximo cÃ³digo sequencial (ex: se pai = 5.1.2, sugere 5.1.2.01)

**FA03 - Criar e Adicionar Outra**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Salvar e Criar Outra"
- **AÃ§Ã£o:** Sistema salva, limpa formulÃ¡rio mantendo conta pai selecionada

### ExceÃ§Ãµes

**EX01 - CÃ³digo Duplicado**
- **CondiÃ§Ã£o:** CÃ³digo jÃ¡ existe no sistema
- **AÃ§Ã£o:** Sistema destaca campo com erro e exibe "CÃ³digo contÃ¡bil jÃ¡ existe. Utilize cÃ³digo Ãºnico."

**EX02 - Hierarquia Circular**
- **CondiÃ§Ã£o:** SeleÃ§Ã£o de conta pai criaria loop (sistema previne via UI, mas valida no backend)
- **AÃ§Ã£o:** Sistema bloqueia save e exibe "OperaÃ§Ã£o criaria hierarquia circular"

**EX03 - Limite de 7 NÃ­veis Atingido**
- **CondiÃ§Ã£o:** Tentar criar conta nÃ­vel 8 ou superior
- **AÃ§Ã£o:** Sistema bloqueia save e exibe "Estrutura limitada a 7 nÃ­veis hierÃ¡rquicos"

**EX04 - AprovaÃ§Ã£o Workflow NecessÃ¡ria**
- **CondiÃ§Ã£o:** Cliente configurou que criaÃ§Ã£o de conta nÃ­vel 1-3 exige aprovaÃ§Ã£o de Controller/CFO
- **AÃ§Ã£o:** Sistema salva como "Aguardando AprovaÃ§Ã£o", envia notificaÃ§Ã£o e exibe mensagem "Conta criada. Aguardando aprovaÃ§Ã£o de [Controller]."

### PÃ³s-condiÃ§Ãµes
- Nova conta criada no banco com Id_Usuario_Criacao, Dt_Criacao
- Conta visÃ­vel na tree view
- Log de auditoria registrado

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-01: Estrutura HierÃ¡rquica AtÃ© 7 NÃ­veis ConfigurÃ¡veis
- RN-RF031-02: Builder Visual Drag-and-Drop com Preview Impacto (validaÃ§Ãµes de hierarquia)
- RN-RF031-10: Auditoria Completa com Trilha de MudanÃ§as

---

## UC03 - Editar Conta ContÃ¡bil

### DescriÃ§Ã£o
Permite editar uma conta contÃ¡bil existente, alterando nome, tipo, configuraÃ§Ãµes, com versionamento e justificativa obrigatÃ³ria para mudanÃ§as estruturais.

### Atores
- UsuÃ¡rio autenticado com permissÃ£o de ediÃ§Ã£o (Controller, CFO, Gerente Financeiro, Analista ContÃ¡bil)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.EDIT`
- Conta existe e nÃ£o estÃ¡ excluÃ­da

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Seleciona conta na tree view e clica em Ã­cone "Editar" (ğŸ“) | - |
| 2 | - | Carrega dados da conta em modal de ediÃ§Ã£o |
| 3 | - | Exibe formulÃ¡rio preenchido (cÃ³digo bloqueado para ediÃ§Ã£o) |
| 4 | Altera nome da conta | - |
| 5 | Pode alterar tipo de SintÃ©tica para AnalÃ­tica (nunca o contrÃ¡rio se houver lanÃ§amentos) | Sistema valida se mudanÃ§a Ã© permitida |
| 6 | Pode alterar natureza saldo | Sistema alerta se houver lanÃ§amentos afetados |
| 7 | Atualiza observaÃ§Ãµes | - |
| 8 | Se mudanÃ§a estrutural (tipo, natureza), informa justificativa obrigatÃ³ria | - |
| 9 | Clica em "Salvar" | - |
| 10 | - | Valida se mudanÃ§as sÃ£o permitidas |
| 11 | - | Se mudanÃ§a estrutural, cria nova versÃ£o na tabela `Plano_Conta_Versao` |
| 12 | - | Atualiza conta com Id_Usuario_Alteracao, Dt_Alteracao |
| 13 | - | Exibe mensagem "Conta atualizada com sucesso" |

### Campos EditÃ¡veis

| Campo | EditÃ¡vel | RestriÃ§Ãµes |
|-------|----------|------------|
| CÃ³digo ContÃ¡bil | âŒ NÃ£o | ImutÃ¡vel apÃ³s criaÃ§Ã£o (evita quebra de referÃªncias) |
| Nome da Conta | âœ… Sim | Max 200 caracteres |
| Tipo de Conta | âš ï¸ Condicional | SÃ³ SintÃ©ticaâ†’AnalÃ­tica se sem lanÃ§amentos filhos |
| Permite LanÃ§amento | âš ï¸ Condicional | SÃ³ se tipo = AnalÃ­tica |
| Natureza Saldo | âš ï¸ Condicional | Alerta se houver lanÃ§amentos |
| ObservaÃ§Ãµes | âœ… Sim | Max 500 caracteres |

### Fluxos Alternativos

**FA01 - Cancelar**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Cancelar"
- **AÃ§Ã£o:** Sistema descarta alteraÃ§Ãµes e retorna Ã  listagem

**FA02 - Preview de Impacto**
- **CondiÃ§Ã£o:** MudanÃ§a estrutural (ex: tipo, natureza)
- **AÃ§Ã£o:** Sistema exibe modal "Impacto das AlteraÃ§Ãµes":
  - Quantidade de lanÃ§amentos afetados (Ãºltimos 12 meses)
  - RelatÃ³rios que usam esta conta
  - UsuÃ¡rios que precisarÃ£o atualizar regras de classificaÃ§Ã£o

### ExceÃ§Ãµes

**EX01 - Conta com LanÃ§amentos NÃ£o Pode Virar SintÃ©tica**
- **CondiÃ§Ã£o:** Tentar mudar conta AnalÃ­tica (com lanÃ§amentos) para SintÃ©tica
- **AÃ§Ã£o:** Sistema bloqueia e exibe "Conta possui lanÃ§amentos. NÃ£o pode ser alterada para SintÃ©tica."

**EX02 - Conta JÃ¡ Foi Alterada Por Outro UsuÃ¡rio**
- **CondiÃ§Ã£o:** Conflito de ediÃ§Ã£o concorrente (versÃ£o mudou)
- **AÃ§Ã£o:** Sistema exibe "Conta foi alterada por [outro usuÃ¡rio]. Atualize a pÃ¡gina e tente novamente."

**EX03 - AprovaÃ§Ã£o Workflow NecessÃ¡ria**
- **CondiÃ§Ã£o:** MudanÃ§a estrutural em conta nÃ­vel 1-3 exige aprovaÃ§Ã£o
- **AÃ§Ã£o:** Sistema salva como "Aguardando AprovaÃ§Ã£o", notifica Controller/CFO

### PÃ³s-condiÃ§Ãµes
- Conta atualizada no banco
- Se mudanÃ§a estrutural, nova versÃ£o criada em `Plano_Conta_Versao`
- Log de auditoria registrado com campos alterados (antes/depois)

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-02: Builder Visual Drag-and-Drop com Preview Impacto
- RN-RF031-10: Auditoria Completa com Trilha de MudanÃ§as
- RN-RF031-15: Soft Delete com HistÃ³rico Versionado

---

## UC04 - Visualizar Conta ContÃ¡bil

### DescriÃ§Ã£o
Permite visualizar todos os detalhes de uma conta contÃ¡bil, incluindo histÃ³rico de versÃµes, lanÃ§amentos recentes e anÃ¡lises.

### Atores
- UsuÃ¡rio autenticado

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.VIEW_DETAILS`
- Conta existe

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Clica em conta na tree view (duplo clique ou Ã­cone ğŸ‘ï¸) | - |
| 2 | - | Carrega dados completos da conta |
| 3 | - | Exibe tela de detalhes (modal ou pÃ¡gina) com abas |

### InformaÃ§Ãµes Exibidas

**Aba "Dados Gerais":**
| Campo | DescriÃ§Ã£o |
|-------|-----------|
| CÃ³digo ContÃ¡bil | Ex: 5.1.2.01.001 |
| Nome da Conta | Ex: Telefonia MÃ³vel Corporativa |
| Tipo | SintÃ©tica / AnalÃ­tica |
| NÃ­vel HierÃ¡rquico | 1-7 |
| Conta Pai | CÃ³digo e nome (com link para visualizar) |
| Contas Filhas | Lista de filhas (com links) |
| Permite LanÃ§amento | Sim/NÃ£o |
| Natureza Saldo | Devedora/Credora |
| Status | Ativo/Inativo |
| ObservaÃ§Ãµes | Texto livre |
| Data CriaÃ§Ã£o | Com timestamp e usuÃ¡rio |
| Ãšltima AlteraÃ§Ã£o | Com timestamp e usuÃ¡rio |

**Aba "LanÃ§amentos Recentes":** (Se conta analÃ­tica)
- Tabela com Ãºltimos 20 lanÃ§amentos contÃ¡beis
- Colunas: Data, HistÃ³rico, DÃ©bito, CrÃ©dito, Saldo, Documento

**Aba "HistÃ³rico de VersÃµes":**
- Timeline de todas as alteraÃ§Ãµes
- Para cada versÃ£o: Data, UsuÃ¡rio, Campos alterados (antesâ†’depois), Justificativa

**Aba "EstatÃ­sticas":** (Se conta analÃ­tica)
- Total lanÃ§amentos (mÃªs atual, ano atual, acumulado)
- Saldo atual (dÃ©bito/crÃ©dito)
- GrÃ¡fico evoluÃ§Ã£o mensal Ãºltimos 12 meses

### Fluxos Alternativos

**FA01 - Editar a Partir da VisualizaÃ§Ã£o**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Editar" (se tiver permissÃ£o)
- **AÃ§Ã£o:** Sistema redireciona para UC03

**FA02 - Exportar HistÃ³rico**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Exportar HistÃ³rico"
- **AÃ§Ã£o:** Sistema gera Excel com todas as versÃµes

### ExceÃ§Ãµes

**EX01 - Conta NÃ£o Encontrada**
- **CondiÃ§Ã£o:** Conta foi excluÃ­da ou Id invÃ¡lido
- **AÃ§Ã£o:** Sistema exibe "Conta nÃ£o encontrada" e redireciona para listagem

### PÃ³s-condiÃ§Ãµes
- Nenhuma alteraÃ§Ã£o no sistema

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-01: Estrutura HierÃ¡rquica AtÃ© 7 NÃ­veis ConfigurÃ¡veis

---

## UC05 - Inativar/Excluir Conta ContÃ¡bil

### DescriÃ§Ã£o
Permite inativar (soft delete) uma conta contÃ¡bil com validaÃ§Ã£o de dependÃªncias e confirmaÃ§Ã£o mÃºltipla.

### Atores
- UsuÃ¡rio autenticado com permissÃ£o de exclusÃ£o (Controller, CFO, Gerente Financeiro)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.DELETE`
- Conta existe e nÃ£o estÃ¡ excluÃ­da
- Conta nÃ£o possui contas filhas ativas

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Seleciona conta e clica em Ã­cone "Excluir" (ğŸ—‘ï¸) | - |
| 2 | - | Verifica se conta possui lanÃ§amentos ou contas filhas |
| 3 | - | Exibe diÃ¡logo de confirmaÃ§Ã£o com resumo de impacto |
| 4 | LÃª informaÃ§Ãµes e confirma exclusÃ£o | - |
| 5 | Informa justificativa obrigatÃ³ria (mÃ­nimo 20 caracteres) | - |
| 6 | Clica em "Confirmar ExclusÃ£o" | - |
| 7 | - | Marca conta como excluÃ­da (FlExcluido = true) |
| 8 | - | Registra justificativa, usuÃ¡rio e timestamp |
| 9 | - | Exibe mensagem "Conta excluÃ­da com sucesso" |
| 10 | - | Remove conta da tree view |

### DiÃ¡logo de ConfirmaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  Confirmar ExclusÃ£o de Conta                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Conta: 5.1.2.01.001 - Telefonia MÃ³vel Corporativa    â”‚
â”‚                                                        â”‚
â”‚ Impacto da OperaÃ§Ã£o:                                  â”‚
â”‚ â€¢ LanÃ§amentos afetados: 1.250 (Ãºltimos 12 meses)     â”‚
â”‚ â€¢ RelatÃ³rios que usam esta conta: 5                   â”‚
â”‚ â€¢ Contas filhas: Nenhuma                              â”‚
â”‚                                                        â”‚
â”‚ âš ï¸ ATENÃ‡ÃƒO: Esta Ã© uma exclusÃ£o lÃ³gica (soft delete).â”‚
â”‚ A conta permanecerÃ¡ no histÃ³rico mas nÃ£o aparecerÃ¡   â”‚
â”‚ em novas operaÃ§Ãµes.                                   â”‚
â”‚                                                        â”‚
â”‚ Justificativa (obrigatÃ³rio):                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [ReorganizaÃ§Ã£o estrutura contÃ¡bil 2025]        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚         [Cancelar]  [Confirmar ExclusÃ£o]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fluxos Alternativos

**FA01 - Cancelar ExclusÃ£o**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Cancelar"
- **AÃ§Ã£o:** Sistema fecha diÃ¡logo sem fazer alteraÃ§Ãµes

**FA02 - Restaurar Conta ExcluÃ­da**
- **CondiÃ§Ã£o:** Administrador acessa tela "Contas Inativas" e clica em "Restaurar"
- **AÃ§Ã£o:** Sistema marca FlExcluido = false, registra justificativa de restauraÃ§Ã£o, conta volta Ã  tree view

### ExceÃ§Ãµes

**EX01 - Conta Possui Contas Filhas Ativas**
- **CondiÃ§Ã£o:** Tentar excluir conta com filhas ativas
- **AÃ§Ã£o:** Sistema bloqueia e exibe "NÃ£o Ã© possÃ­vel excluir. Conta possui [N] contas filhas ativas. Exclua ou mova as filhas primeiro."

**EX02 - Conta Possui LanÃ§amentos Recentes (PerÃ­odo NÃ£o Fechado)**
- **CondiÃ§Ã£o:** Conta possui lanÃ§amentos no perÃ­odo contÃ¡bil aberto
- **AÃ§Ã£o:** Sistema exibe aviso extra "ATENÃ‡ÃƒO: Conta possui lanÃ§amentos no perÃ­odo atual. Recomendamos aguardar fechamento contÃ¡bil." mas permite exclusÃ£o se usuÃ¡rio confirmar

**EX03 - Conta Usada em Regras de ClassificaÃ§Ã£o AutomÃ¡tica**
- **CondiÃ§Ã£o:** Conta Ã© destino de 10+ regras de classificaÃ§Ã£o
- **AÃ§Ã£o:** Sistema alerta "Conta Ã© usada em [N] regras de classificaÃ§Ã£o automÃ¡tica. Atualize as regras antes de excluir." e exibe lista de regras

### PÃ³s-condiÃ§Ãµes
- Conta marcada como excluÃ­da (FlExcluido = true)
- Conta nÃ£o aparece mais em listagens padrÃ£o
- Log de auditoria com justificativa registrado
- Conta permanece acessÃ­vel em relatÃ³rios histÃ³ricos

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-15: Soft Delete com HistÃ³rico Versionado
- RN-RF031-10: Auditoria Completa com Trilha de MudanÃ§as

---

## UC06 - Mover Conta na Hierarquia (Drag-and-Drop)

### DescriÃ§Ã£o
Permite reorganizar a estrutura contÃ¡bil movendo contas para novos pais via drag-and-drop com preview de impacto em lanÃ§amentos e relatÃ³rios.

### Atores
- UsuÃ¡rio autenticado com permissÃ£o de movimentaÃ§Ã£o (Controller, CFO, Gerente Financeiro)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.MOVE`
- Conta existe e nÃ£o estÃ¡ excluÃ­da
- Novo pai existe e nÃ£o estÃ¡ excluÃ­do

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Clica e arrasta conta na tree view | Sistema destaca com borda |
| 2 | Move mouse sobre conta destino (novo pai) | Sistema destaca destino com fundo colorido |
| 3 | Solta conta sobre novo pai | - |
| 4 | - | Valida se movimento Ã© permitido (nÃ£o cria loop, nÃ­vel <= 7) |
| 5 | - | Carrega preview de impacto |
| 6 | - | Exibe modal "Preview de Impacto" com estatÃ­sticas |
| 7 | LÃª informaÃ§Ãµes de impacto | - |
| 8 | Informa justificativa obrigatÃ³ria | - |
| 9 | Clica em "Confirmar MovimentaÃ§Ã£o" | - |
| 10 | - | Atualiza campo `PaiId` da conta |
| 11 | - | Recalcula cÃ³digos automÃ¡ticos se configurado |
| 12 | - | Registra auditoria com justificativa |
| 13 | - | Exibe mensagem "Conta movida com sucesso" |
| 14 | - | Atualiza tree view com nova posiÃ§Ã£o |

### Preview de Impacto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” Preview de Impacto da MovimentaÃ§Ã£o                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Conta: 5.1.2.01.001 - Telefonia MÃ³vel                 â”‚
â”‚ De:    5.1.2.01 - Despesas Telecom                     â”‚
â”‚ Para:  5.1.3.02 - Despesas ComunicaÃ§Ã£o                 â”‚
â”‚                                                          â”‚
â”‚ Impacto:                                                â”‚
â”‚ â€¢ LanÃ§amentos afetados: 1.250 (Ãºltimos 12 meses)       â”‚
â”‚ â€¢ RelatÃ³rios afetados: 5 (DRE Gerencial, BalanÃ§o, ...) â”‚
â”‚ â€¢ UsuÃ¡rios que usam esta conta em regras: 3            â”‚
â”‚ â€¢ Novo nÃ­vel hierÃ¡rquico: 5 (atualmente 5)             â”‚
â”‚                                                          â”‚
â”‚ âš ï¸ ApÃ³s a movimentaÃ§Ã£o:                                â”‚
â”‚ - CÃ³digo pode ser recalculado automaticamente          â”‚
â”‚ - RelatÃ³rios serÃ£o afetados imediatamente               â”‚
â”‚ - UsuÃ¡rios serÃ£o notificados da mudanÃ§a                â”‚
â”‚                                                          â”‚
â”‚ Justificativa (obrigatÃ³rio):                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [ReorganizaÃ§Ã£o estrutura contÃ¡bil conforme       â”‚   â”‚
â”‚ â”‚  novo plano DRE 2025]                            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚         [Cancelar]  [Confirmar MovimentaÃ§Ã£o]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fluxos Alternativos

**FA01 - Cancelar MovimentaÃ§Ã£o**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Cancelar" no preview
- **AÃ§Ã£o:** Sistema descarta alteraÃ§Ã£o, conta volta Ã  posiÃ§Ã£o original na tree

**FA02 - Recalcular CÃ³digos Automaticamente**
- **CondiÃ§Ã£o:** Cliente configurou recalculo automÃ¡tico de cÃ³digos
- **AÃ§Ã£o:** Sistema atualiza cÃ³digo da conta e de todas as filhas recursivamente (ex: de 5.1.2.01.001 para 5.1.3.02.001)

### ExceÃ§Ãµes

**EX01 - Movimento Criaria Loop Circular**
- **CondiÃ§Ã£o:** Tentar mover conta pai para dentro de uma conta filha
- **AÃ§Ã£o:** Sistema impede drop e exibe tooltip "Movimento criaria hierarquia circular"

**EX02 - Movimento Ultrapassaria 7 NÃ­veis**
- **CondiÃ§Ã£o:** Conta tem filhas e movimento colocaria filhas alÃ©m do nÃ­vel 7
- **AÃ§Ã£o:** Sistema impede drop e exibe "Movimento ultrapassaria limite de 7 nÃ­veis hierÃ¡rquicos"

**EX03 - AprovaÃ§Ã£o Workflow NecessÃ¡ria**
- **CondiÃ§Ã£o:** MovimentaÃ§Ã£o de conta nÃ­vel 1-3 exige aprovaÃ§Ã£o
- **AÃ§Ã£o:** Sistema salva como "Aguardando AprovaÃ§Ã£o", notifica Controller/CFO

### PÃ³s-condiÃ§Ãµes
- Conta movida para novo pai
- CÃ³digo recalculado se configurado
- Auditoria registrada com justificativa
- UsuÃ¡rios afetados notificados

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-02: Builder Visual Drag-and-Drop com Preview Impacto
- RN-RF031-10: Auditoria Completa com Trilha de MudanÃ§as

---

## UC07 - Importar Estrutura de ERP

### DescriÃ§Ã£o
Permite importar estrutura de plano de contas de arquivo exportado de ERP (SAP, TOTVS, Protheus, Oracle, Sankhya) com validaÃ§Ã£o, preview e reconciliaÃ§Ã£o automÃ¡tica.

### Atores
- UsuÃ¡rio autenticado com permissÃ£o de importaÃ§Ã£o (Controller, CFO, Administrador)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.IMPORT_ERP`
- Arquivo de importaÃ§Ã£o preparado conforme template

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Clica em botÃ£o "Importar Estrutura" | - |
| 2 | - | Exibe modal de importaÃ§Ã£o |
| 3 | Seleciona tipo de ERP (SAP, TOTVS, Protheus, Oracle, Sankhya, Customizado) | Sistema carrega template correspondente |
| 4 | Faz upload do arquivo (CSV, TXT, XML, JSON conforme ERP) | - |
| 5 | - | Valida formato do arquivo e encoding |
| 6 | - | Parse das primeiras 10 linhas e exibe preview |
| 7 | Visualiza preview e confirma mapeamento de colunas | Se necessÃ¡rio, ajusta mapeamento |
| 8 | Clica em "Processar ImportaÃ§Ã£o" | - |
| 9 | - | Processa arquivo completo (batch se >1000 linhas) |
| 10 | - | Valida cada conta (cÃ³digo Ãºnico, hierarquia, obrigatÃ³rios) |
| 11 | - | Identifica contas novas vs. existentes (reconciliaÃ§Ã£o) |
| 12 | - | Exibe resumo da importaÃ§Ã£o |
| 13 | Revisa resumo (novas: 120, atualizadas: 30, erros: 2) | - |
| 14 | Clica em "Confirmar ImportaÃ§Ã£o" | - |
| 15 | - | Salva contas novas e atualiza existentes |
| 16 | - | Exibe mensagem "ImportaÃ§Ã£o concluÃ­da: 120 contas criadas, 30 atualizadas, 2 erros." |
| 17 | - | Disponibiliza log de erros para download |

### Templates PrÃ©-Configurados

**SAP FI/CO (`.txt` delimitado TAB):**
```
CONT_COD	CONT_DESC	CONT_TIPO	CONT_PAI	CONT_NATUREZA
100000	ATIVO	S	NULL	D
110000	ATIVO CIRCULANTE	S	100000	D
111001	CAIXA E EQUIVALENTES	A	110000	D
```

**TOTVS Protheus 12 (`.csv` encoding ISO-8859-1, separador `;`):**
```
CT1_CONTA;CT1_DESC01;CT1_CLASSE;CT1_CTASUP;CT1_NORMAL
1;ATIVO;1;;1
1.01;ATIVO CIRCULANTE;1;1;1
1.01.01;CAIXA;2;1.01;1
```

**Oracle Financials (XML):**
```xml
<ChartOfAccounts>
  <Account>
    <Code>100000</Code>
    <Name>ATIVO</Name>
    <Type>SUMMARY</Type>
    <Parent></Parent>
  </Account>
</ChartOfAccounts>
```

### Preview de ImportaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Importar Estrutura de ERP                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tipo ERP: [SAP FI/CO â–¼]                                 â”‚
â”‚ Arquivo: [ğŸ“„ plano_contas_sap.txt]  [Upload]            â”‚
â”‚                                                           â”‚
â”‚ Preview (10 primeiras linhas):                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ CÃ³digo  â”‚ Nome             â”‚ Tipo â”‚ Pai     â”‚ Nat â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ 100000  â”‚ ATIVO            â”‚ S    â”‚         â”‚ D   â”‚   â”‚
â”‚ â”‚ 110000  â”‚ ATIVO CIRCULANTE â”‚ S    â”‚ 100000  â”‚ D   â”‚   â”‚
â”‚ â”‚ 111001  â”‚ CAIXA            â”‚ A    â”‚ 110000  â”‚ D   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                           â”‚
â”‚ Mapeamento de Colunas:                                   â”‚
â”‚ â€¢ CONT_COD â†’ CÃ³digo ContÃ¡bil âœ…                          â”‚
â”‚ â€¢ CONT_DESC â†’ Nome da Conta âœ…                           â”‚
â”‚ â€¢ CONT_TIPO â†’ Tipo (S/A) âœ…                              â”‚
â”‚ â€¢ CONT_PAI â†’ Conta Pai âœ…                                â”‚
â”‚                                                           â”‚
â”‚         [Cancelar]  [Processar ImportaÃ§Ã£o]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Resumo da ImportaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resumo da ImportaÃ§Ã£o                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Total de linhas processadas: 152                         â”‚
â”‚                                                           â”‚
â”‚ âœ… Contas novas a criar: 120                             â”‚
â”‚ âš ï¸  Contas existentes a atualizar: 30                    â”‚
â”‚ âŒ Erros encontrados: 2                                  â”‚
â”‚                                                           â”‚
â”‚ Erros:                                                    â”‚
â”‚ â€¢ Linha 45: CÃ³digo duplicado "5.1.2.01"                  â”‚
â”‚ â€¢ Linha 87: Conta pai "9.9.9.99" nÃ£o existe              â”‚
â”‚                                                           â”‚
â”‚ âš ï¸ ATENÃ‡ÃƒO: Contas existentes serÃ£o atualizadas com     â”‚
â”‚ dados do arquivo (nome, tipo, pai). LanÃ§amentos nÃ£o     â”‚
â”‚ serÃ£o afetados.                                          â”‚
â”‚                                                           â”‚
â”‚ [Baixar Log Completo]  [Cancelar]  [Confirmar Import.]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fluxos Alternativos

**FA01 - Criar Template Customizado**
- **CondiÃ§Ã£o:** ERP nÃ£o estÃ¡ na lista prÃ©-configurada
- **AÃ§Ã£o:** UsuÃ¡rio clica em "Criar Template Customizado", sistema exibe wizard para mapear colunas manualmente

**FA02 - ReconciliaÃ§Ã£o Inteligente**
- **CondiÃ§Ã£o:** 80%+ das contas do arquivo jÃ¡ existem no sistema
- **AÃ§Ã£o:** Sistema pergunta "Detectamos que maioria das contas jÃ¡ existe. Deseja: [Atualizar existentes] [Apenas criar novas] [Cancelar]"

### ExceÃ§Ãµes

**EX01 - Arquivo Formato InvÃ¡lido**
- **CondiÃ§Ã£o:** Arquivo nÃ£o corresponde ao template selecionado
- **AÃ§Ã£o:** Sistema exibe "Formato de arquivo invÃ¡lido. Verifique se selecionou o tipo de ERP correto." + amostra do erro

**EX02 - Encoding InvÃ¡lido**
- **CondiÃ§Ã£o:** Arquivo com encoding nÃ£o suportado (ex: UTF-16 quando espera ISO-8859-1)
- **AÃ§Ã£o:** Sistema detecta encoding e pergunta "Arquivo detectado como [UTF-16]. Converter para [ISO-8859-1]? [Sim] [NÃ£o]"

**EX03 - Arquivo Muito Grande (>10.000 linhas)**
- **CondiÃ§Ã£o:** Arquivo excede limite de processamento sÃ­ncrono
- **AÃ§Ã£o:** Sistema exibe "Arquivo grande. Processamento serÃ¡ executado em background. VocÃª receberÃ¡ e-mail quando concluir." e cria job assÃ­ncrono

**EX04 - Hierarquia Circular no Arquivo**
- **CondiÃ§Ã£o:** Arquivo contÃ©m loop (Aâ†’Bâ†’Câ†’A)
- **AÃ§Ã£o:** Sistema detecta e exibe "Hierarquia circular detectada: Conta [A] â†’ [B] â†’ [C] â†’ [A]. Corrija o arquivo e tente novamente."

### PÃ³s-condiÃ§Ãµes
- Contas novas criadas no banco
- Contas existentes atualizadas (se confirmado)
- Log de importaÃ§Ã£o registrado com estatÃ­sticas
- Arquivo original e log de erros arquivados

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-06: ImportaÃ§Ã£o Multi-Layout de ERPs
- RN-RF031-12: ReconciliaÃ§Ã£o AutomÃ¡tica com Engine Fuzzy Matching

---

## UC08 - Classificar LanÃ§amentos Automaticamente

### DescriÃ§Ã£o
Permite aplicar regras de classificaÃ§Ã£o automÃ¡tica a lanÃ§amentos importados, usando biblioteca de 50+ templates e engine de Machine Learning para sugerir contas contÃ¡beis.

### Atores
- UsuÃ¡rio autenticado com permissÃ£o de classificaÃ§Ã£o (Controller, CFO, Gerente Financeiro, Analista ContÃ¡bil)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.EXECUTE_CLASSIFICACAO`
- Existem lanÃ§amentos "Aguardando ClassificaÃ§Ã£o"
- Ao menos uma regra de classificaÃ§Ã£o cadastrada

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Acessa menu "GestÃ£o > ClassificaÃ§Ã£o AutomÃ¡tica" | - |
| 2 | - | Exibe lista de lanÃ§amentos aguardando classificaÃ§Ã£o |
| 3 | - | Para cada lanÃ§amento, exibe sugestÃ£o automÃ¡tica com score de confianÃ§a |
| 4 | Visualiza lanÃ§amento com campos: Fornecedor, DescriÃ§Ã£o, Valor, Data | - |
| 5 | Visualiza sugestÃ£o: "Conta 5.1.2.01.001 - Telefonia MÃ³vel (98% confianÃ§a)" | - |
| 6 | Clica em "Aceitar SugestÃ£o" | - |
| 7 | - | Atribui conta sugerida ao lanÃ§amento |
| 8 | - | Move lanÃ§amento para "Classificado" |
| 9 | - | Exibe prÃ³ximo lanÃ§amento |
| 10 | Repete processo para todos lanÃ§amentos | - |
| 11 | Ao final, clica em "Finalizar ClassificaÃ§Ã£o" | - |
| 12 | - | Exibe resumo: "100 lanÃ§amentos classificados (95 automÃ¡ticos, 5 manuais)" |

### SugestÃµes AutomÃ¡ticas

**NÃ­vel de ConfianÃ§a:**
- **âœ… 90-100%** - Verde, match exato ou histÃ³rico forte
- **âš ï¸ 70-89%** - Amarelo, fuzzy matching alto
- **âŒ < 70%** - Vermelho, baixa confianÃ§a, exige revisÃ£o manual

**Fontes de SugestÃ£o (ordem de prioridade):**
1. **Match Exato**: Fornecedor + Tipo ServiÃ§o jÃ¡ usou conta X (100%)
2. **Regra DeterminÃ­stica**: Regra "Se Fornecedor = Vivo E Tipo = Telefonia â†’ Conta 5.1.2.01.001" (95%)
3. **Fuzzy Matching**: Nome descriÃ§Ã£o similar a lanÃ§amentos passados (85%)
4. **Machine Learning**: Modelo treinado com 10.000+ lanÃ§amentos histÃ³ricos (75%)

### Tela de ClassificaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ClassificaÃ§Ã£o AutomÃ¡tica de LanÃ§amentos   [ğŸ”„ Atualizar]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Aguardando ClassificaÃ§Ã£o: 100 â”‚ Classificados Hoje: 450   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LanÃ§amento 1 de 100:                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Fornecedor: Vivo S.A.                                â”‚   â”‚
â”‚ â”‚ DescriÃ§Ã£o: Fatura telefonia mÃ³vel - Janeiro 2025    â”‚   â”‚
â”‚ â”‚ Valor: R$ 15.000,00                                  â”‚   â”‚
â”‚ â”‚ Data: 15/01/2025                                      â”‚   â”‚
â”‚ â”‚ Tipo ServiÃ§o: Telefonia MÃ³vel                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚ ğŸ’¡ SugestÃ£o AutomÃ¡tica:                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ âœ… 5.1.2.01.001 - Telefonia MÃ³vel Corporativa        â”‚   â”‚
â”‚ â”‚    ConfianÃ§a: 98% (Match exato: Vivo + Telefonia)   â”‚   â”‚
â”‚ â”‚    Centro Custo Sugerido: CC-TI-SP                   â”‚   â”‚
â”‚ â”‚    Projeto Sugerido: (Nenhum)                        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚ Ou classificar manualmente:                                â”‚
â”‚ Conta: [Selecionar conta... â–¼]                            â”‚
â”‚ Centro Custo: [Selecionar... â–¼]                           â”‚
â”‚                                                             â”‚
â”‚ [â—€ï¸ Anterior]  [âœ… Aceitar SugestÃ£o]  [ğŸ“ Manual]  [â–¶ï¸ PrÃ³ximo] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Taxa de Match AutomÃ¡tico: 95% â”‚ Meta: >90% âœ…
```

### Fluxos Alternativos

**FA01 - ClassificaÃ§Ã£o Manual**
- **CondiÃ§Ã£o:** UsuÃ¡rio nÃ£o concorda com sugestÃ£o ou confianÃ§a <70%
- **AÃ§Ã£o:** UsuÃ¡rio clica em "Manual", sistema exibe dropdown com plano de contas, usuÃ¡rio seleciona conta manualmente

**FA02 - ClassificaÃ§Ã£o em Lote**
- **CondiÃ§Ã£o:** UsuÃ¡rio marca 20 lanÃ§amentos similares (mesmo fornecedor + tipo)
- **AÃ§Ã£o:** UsuÃ¡rio clica em "Classificar Selecionados", sistema aplica mesma conta a todos

**FA03 - Criar Regra a Partir de ClassificaÃ§Ã£o**
- **CondiÃ§Ã£o:** UsuÃ¡rio classificou 5+ lanÃ§amentos manualmente com mesmo padrÃ£o
- **AÃ§Ã£o:** Sistema sugere "Detectamos padrÃ£o. Criar regra automÃ¡tica? [Sim] [NÃ£o]"

**FA04 - SimulaÃ§Ã£o de Regras**
- **CondiÃ§Ã£o:** UsuÃ¡rio quer testar regra antes de ativar
- **AÃ§Ã£o:** UsuÃ¡rio vai em "Regras > Simular", sistema exibe "Regra X aplicaria em 120 lanÃ§amentos histÃ³ricos (98% acurÃ¡cia)"

### ExceÃ§Ãµes

**EX01 - Nenhuma SugestÃ£o DisponÃ­vel**
- **CondiÃ§Ã£o:** Sistema nÃ£o consegue gerar sugestÃ£o (lanÃ§amento muito diferente do histÃ³rico)
- **AÃ§Ã£o:** Sistema exibe "âš ï¸ Nenhuma sugestÃ£o automÃ¡tica. ClassificaÃ§Ã£o manual necessÃ¡ria."

**EX02 - MÃºltiplas SugestÃµes com Mesma ConfianÃ§a**
- **CondiÃ§Ã£o:** ML retorna 3 contas com 80% confianÃ§a cada
- **AÃ§Ã£o:** Sistema exibe "âš ï¸ MÃºltiplas sugestÃµes (3). Revise manualmente:" + lista as 3 contas

**EX03 - LanÃ§amento JÃ¡ Foi Classificado Por Outro UsuÃ¡rio**
- **CondiÃ§Ã£o:** ClassificaÃ§Ã£o concorrente
- **AÃ§Ã£o:** Sistema detecta e pula para prÃ³ximo lanÃ§amento automaticamente com mensagem "LanÃ§amento jÃ¡ classificado por [usuÃ¡rio]"

### PÃ³s-condiÃ§Ãµes
- LanÃ§amentos classificados tÃªm conta contÃ¡bil atribuÃ­da
- Taxa de match automÃ¡tico registrada em dashboard
- Modelo ML aprende com classificaÃ§Ãµes manuais confirmadas

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-05: Regras de ClassificaÃ§Ã£o AutomÃ¡tica com Builder Visual
- RN-RF031-12: ReconciliaÃ§Ã£o AutomÃ¡tica com Engine Fuzzy Matching

---

## UC09 - Gerar RelatÃ³rio DRE Multi-Dimensional

### DescriÃ§Ã£o
Permite gerar DemonstraÃ§Ã£o de Resultado do ExercÃ­cio (DRE) com filtros multi-dimensionais (perÃ­odo, centro de custo, projeto, departamento) e drill-down ilimitado atÃ© contas analÃ­ticas e lanÃ§amentos individuais.

### Atores
- UsuÃ¡rio autenticado (Controller, CFO, Gerente Financeiro, Analista ContÃ¡bil, Consulta)

### PrÃ©-condiÃ§Ãµes
- UsuÃ¡rio logado no sistema
- UsuÃ¡rio com permissÃ£o `GES.PLANO_CONTAS.VIEW_DRE`
- Existem lanÃ§amentos contÃ¡beis no perÃ­odo selecionado

### Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Acessa menu "RelatÃ³rios > DRE Multi-Dimensional" | - |
| 2 | - | Exibe tela de filtros |
| 3 | Seleciona perÃ­odo (MÃªs, Trimestre, Semestre, Ano, Range customizado) | - |
| 4 | Seleciona dimensÃµes de filtro (Centro Custo, Projeto, Departamento, RegiÃ£o) | - |
| 5 | Seleciona tipo de comparaÃ§Ã£o (Nenhuma, MoM, YoY, OrÃ§ado x Realizado) | - |
| 6 | Clica em "Gerar DRE" | - |
| 7 | - | Calcula totalizadores conforme hierarquia do plano de contas |
| 8 | - | Exibe DRE estruturado com valores |
| 9 | Visualiza estrutura padrÃ£o DRE | - |
| 10 | Clica em linha "Despesas Telecom e TI" para drill-down | - |
| 11 | - | Expande e exibe contas filhas (Telefonia MÃ³vel, Fixa, Internet, Cloud, LicenÃ§as) |
| 12 | Clica em "Telefonia MÃ³vel" para ver lanÃ§amentos individuais | - |
| 13 | - | Exibe tabela com lanÃ§amentos da conta (Data, HistÃ³rico, DÃ©bito, CrÃ©dito, Saldo) |
| 14 | Clica em "Exportar" | - |
| 15 | - | Gera Excel formatado com cores, borders, fÃ³rmulas |

### Estrutura DRE PadrÃ£o Exibida

```
DEMONSTRAÃ‡ÃƒO DO RESULTADO DO EXERCÃCIO (DRE)
PerÃ­odo: Janeiro 2025
ComparaÃ§Ã£o: MoM (vs. Dezembro 2024)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RECEITA BRUTA                           â”‚ 1.000.000,00 â”‚ +15,2% â†— â”‚ 100,0% â”‚
â”‚ (-) DeduÃ§Ãµes                             â”‚   (150.000,00) â”‚  +2,1% â†— â”‚  15,0% â”‚
â”‚ (=) RECEITA LÃQUIDA                     â”‚   850.000,00 â”‚ +18,5% â†— â”‚  85,0% â”‚
â”‚                                          â”‚              â”‚          â”‚        â”‚
â”‚ (-) CPV (Custo Produto Vendido)         â”‚   (400.000,00) â”‚  +8,0% â†— â”‚  40,0% â”‚
â”‚ (=) LUCRO BRUTO                         â”‚   450.000,00 â”‚ +32,4% â†— â”‚  45,0% â”‚
â”‚                                          â”‚              â”‚          â”‚        â”‚
â”‚ (-) Despesas Operacionais               â”‚   (300.000,00) â”‚  +5,0% â†— â”‚  30,0% â”‚
â”‚   [+] Despesas Administrativas          â”‚   (180.000,00) â”‚  +4,2% â†— â”‚  18,0% â”‚
â”‚       â”œâ”€ Pessoal                         â”‚   (120.000,00) â”‚  +3,0% â†— â”‚  12,0% â”‚
â”‚       â””â”€ [+] Gerais                      â”‚    (60.000,00) â”‚  +7,1% â†— â”‚   6,0% â”‚
â”‚           â”œâ”€ Aluguel                     â”‚    (30.000,00) â”‚  +0,0%   â”‚   3,0% â”‚
â”‚           â”œâ”€ [+] Telecom e TI â¬… DRILL   â”‚    (25.000,00) â”‚ +15,4% â†— â”‚   2,5% â”‚
â”‚           â”‚   â”œâ”€ Telefonia MÃ³vel         â”‚    (10.000,00) â”‚ +20,0% â†— â”‚   1,0% â”‚
â”‚           â”‚   â”œâ”€ Telefonia Fixa          â”‚     (2.000,00) â”‚ -10,0% â†˜ â”‚   0,2% â”‚
â”‚           â”‚   â”œâ”€ Internet/Links          â”‚     (5.000,00) â”‚ +10,0% â†— â”‚   0,5% â”‚
â”‚           â”‚   â”œâ”€ Cloud Computing         â”‚     (6.000,00) â”‚ +50,0% â†— â”‚   0,6% â”‚
â”‚           â”‚   â””â”€ LicenÃ§as Software       â”‚     (2.000,00) â”‚  +0,0%   â”‚   0,2% â”‚
â”‚           â””â”€ Seguros                     â”‚     (5.000,00) â”‚  +0,0%   â”‚   0,5% â”‚
â”‚   [+] Despesas Comerciais               â”‚    (80.000,00) â”‚  +6,0% â†— â”‚   8,0% â”‚
â”‚   [+] Despesas Financeiras              â”‚    (40.000,00) â”‚  +4,0% â†— â”‚   4,0% â”‚
â”‚                                          â”‚              â”‚          â”‚        â”‚
â”‚ (=) RESULTADO OPERACIONAL (EBITDA)      â”‚   150.000,00 â”‚ +87,5% â†— â”‚  15,0% â”‚
â”‚ (-) DepreciaÃ§Ã£o/AmortizaÃ§Ã£o             â”‚    (20.000,00) â”‚  +5,0% â†— â”‚   2,0% â”‚
â”‚ (=) EBIT                                â”‚   130.000,00 â”‚ +98,5% â†— â”‚  13,0% â”‚
â”‚ (-) Resultado Financeiro                â”‚    (10.000,00) â”‚  +0,0%   â”‚   1,0% â”‚
â”‚ (=) LAIR (Lucro Antes IR)               â”‚   120.000,00 â”‚ +110% â†—  â”‚  12,0% â”‚
â”‚ (-) ProvisÃ£o IR/CSLL                    â”‚    (40.800,00) â”‚ +110% â†—  â”‚   4,1% â”‚
â”‚ (=) LUCRO LÃQUIDO                       â”‚    79.200,00 â”‚ +110% â†—  â”‚   7,9% â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Coluna 1: Valores absolutos
Coluna 2: VariaÃ§Ã£o % vs. perÃ­odo anterior (MoM)
Coluna 3: AnÃ¡lise Vertical (% sobre Receita LÃ­quida)

[Expandir Tudo] [Recolher Tudo] [Exportar Excel] [Exportar PDF] [GrÃ¡ficos]
```

### Filtros DisponÃ­veis

| Filtro | OpÃ§Ãµes |
|--------|--------|
| PerÃ­odo | MÃªs, Trimestre, Semestre, Ano, Range (Data InÃ­cio/Fim) |
| Centro Custo | Dropdown hierÃ¡rquico multi-seleÃ§Ã£o |
| Projeto | Dropdown multi-seleÃ§Ã£o + "Todos" |
| Departamento | Dropdown hierÃ¡rquico |
| RegiÃ£o | Sudeste, Sul, Nordeste, Norte, Centro-Oeste, "Todas" |
| ComparaÃ§Ã£o | Nenhuma, MoM (Month over Month), YoY (Year over Year), OrÃ§ado x Realizado |

### Fluxos Alternativos

**FA01 - Drill-Down em Conta AnalÃ­tica**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em conta analÃ­tica (ex: Telefonia MÃ³vel)
- **AÃ§Ã£o:** Sistema exibe modal com tabela de lanÃ§amentos individuais:
  - Colunas: Data, Documento, HistÃ³rico, DÃ©bito, CrÃ©dito, Saldo Acumulado
  - OpÃ§Ã£o de exportar apenas aquela conta

**FA02 - GrÃ¡ficos Visuais**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "GrÃ¡ficos"
- **AÃ§Ã£o:** Sistema exibe:
  - GrÃ¡fico Waterfall (receita â†’ deduÃ§Ãµes â†’ CPV â†’ despesas â†’ lucro)
  - Line Chart evoluÃ§Ã£o mensal Ãºltimos 12 meses
  - Pie Chart distribuiÃ§Ã£o despesas operacionais

**FA03 - AnÃ¡lise Horizontal (MÃºltiplos PerÃ­odos)**
- **CondiÃ§Ã£o:** UsuÃ¡rio seleciona "Comparar Ãºltimos 12 meses"
- **AÃ§Ã£o:** Sistema exibe tabela com 13 colunas (1 por mÃªs + total) mostrando evoluÃ§Ã£o temporal

**FA04 - Exportar para Excel com FÃ³rmulas**
- **CondiÃ§Ã£o:** UsuÃ¡rio clica em "Exportar Excel"
- **AÃ§Ã£o:** Sistema gera Excel com:
  - Cores alternadas para melhor leitura
  - Bordas nas cÃ©lulas
  - FÃ³rmulas Excel (=SUM, =IF) para recalcular se usuÃ¡rio editar
  - Formatos de nÃºmero (R$ , %)
  - GrÃ¡fico embutido

### ExceÃ§Ãµes

**EX01 - Nenhum LanÃ§amento no PerÃ­odo**
- **CondiÃ§Ã£o:** NÃ£o existem lanÃ§amentos no perÃ­odo/filtros selecionados
- **AÃ§Ã£o:** Sistema exibe mensagem "Nenhum lanÃ§amento encontrado no perÃ­odo selecionado. Ajuste os filtros."

**EX02 - Erro de CÃ¡lculo (InconsistÃªncia Dados)**
- **CondiÃ§Ã£o:** Soma de filhas â‰  pai (dados corrompidos)
- **AÃ§Ã£o:** Sistema detecta, exibe alerta "âš ï¸ InconsistÃªncia detectada em [Conta X]. Recalcule totalizadores ou contate administrador." e destaca conta em vermelho

### PÃ³s-condiÃ§Ãµes
- DRE gerado e visualizado
- Nenhuma alteraÃ§Ã£o no banco de dados

### Regras de NegÃ³cio AplicÃ¡veis
- RN-RF031-08: RelatÃ³rios Gerenciais DRE Multi-Dimensional
- RN-RF031-04: DimensÃµes CustomizÃ¡veis Ilimitadas

---

## HistÃ³rico de AlteraÃ§Ãµes

| VersÃ£o | Data | Autor | DescriÃ§Ã£o |
|--------|------|-------|-----------|
| 1.0 | 2025-01-14 | Architect Agent | VersÃ£o inicial com 9 UCs completos |

