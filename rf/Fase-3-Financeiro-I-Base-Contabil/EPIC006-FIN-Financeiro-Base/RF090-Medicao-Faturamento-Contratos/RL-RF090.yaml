# Template de Referência ao Legado (RL-RF090.yaml)
# Versão: 1.0
# Data: 2025-12-31

rf_id: RF090
titulo: "Medição e Faturamento de Contratos"

legado:
  sistema: "VB.NET + ASP.NET Web Forms (IControlIT v1)"
  versao: "1.0"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server 2012+"
  multi_tenant: false
  auditoria: "partial"

# SEÇÃO CRÍTICA: Referências ao Legado com Destino Obrigatório
referencias:
  - id: "LEG-RF090-001"
    tipo: "tela"
    nome: "MedicaoLista.aspx"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoLista.aspx"
    descricao: |
      Tela de listagem de medições com filtros por período e contrato.
      Permitia listar todas medições sem isolamento por ClienteId.
      Paginação server-side (postback completo).
      Sem ordenação dinâmica por colunas.
      Sem exportação para Excel/PDF.

    destino: "substituido"
    justificativa: |
      Substituído por componente Angular SPA com paginação client-side,
      filtros dinâmicos, isolamento multi-tenant automático (ClienteId),
      ordenação por qualquer coluna, exportação Excel/PDF.
      Impacto: Melhoria significativa de UX e segurança.

    rf_item_relacionado: null
    uc_relacionado: "UC00"

    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF090-002"
    tipo: "tela"
    nome: "MedicaoDetalhe.aspx"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoDetalhe.aspx"
    descricao: |
      Tela de criação/edição de medição com cálculo manual de valor.
      Sem validação de sobreposição de períodos.
      Sem validação de vigência do contrato.
      Sem diferenciação de tipo (Fixa/Variável/Híbrida).
      Sem rateio automático (feito em tela separada).

    destino: "substituido"
    justificativa: |
      Substituído por formulário Angular com validações automáticas,
      tipos de medição (Fixa/Variável/Híbrida), cálculo automático,
      rateio inline, validação de período/vigência.
      Impacto: Elimina erros manuais de cálculo, garante integridade.

    rf_item_relacionado: "RN-RF090-001,RN-RF090-002,RN-RF090-003"
    uc_relacionado: "UC01"

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-003"
    tipo: "tela"
    nome: "RelatorioFaturamento.aspx"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/RelatorioFaturamento.aspx"
    descricao: |
      Relatório de faturamento por período com exportação Excel.
      Gerado via stored procedure pa_RelatorioFaturamento.
      Exportação HTML table (não XLS real).
      Sem agrupamento dinâmico (sempre por contrato).
      Sem dashboard visual.

    destino: "substituido"
    justificativa: |
      Substituído por módulo de relatórios Angular com dashboard visual,
      exportação Excel/PDF real (não HTML), agrupamento dinâmico,
      gráficos ApexCharts, filtros avançados.
      Impacto: Melhoria significativa de análise e BI.

    rf_item_relacionado: null
    uc_relacionado: null

    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF090-004"
    tipo: "tela"
    nome: "GlosaAnaliseLista.aspx"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/GlosaAnaliseLista.aspx"
    descricao: |
      Lista de glosas registradas para análise.
      Sem workflow formal (botões executam UPDATE direto).
      Sem auditoria de quem aprovou/rejeitou.
      Sem geração automática de nota fiscal de crédito.

    destino: "substituido"
    justificativa: |
      Substituído por workflow formal de glosa (PendenteAnalise→Aprovada/Rejeitada),
      auditoria completa (quem, quando, decisão), geração automática de nota fiscal
      de crédito via integração RF032.
      Impacto: Transparência, rastreabilidade, automação.

    rf_item_relacionado: "RN-RF090-009"
    uc_relacionado: "UC04"

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-005"
    tipo: "webservice"
    nome: "WSMedicao.asmx - ObterMedicoes()"
    caminho: "ic1_legado/IControlIT/WebServices/WSMedicao.asmx.vb"
    descricao: |
      Retorna lista de medições por contrato.
      Sem paginação (retorna todas, risco de timeout).
      Sem ordenação configurável.
      Sem filtros avançados.

    destino: "substituido"
    justificativa: |
      Substituído por endpoint REST GET /api/medicoes com paginação
      obrigatória (default 50/página), ordenação por qualquer campo,
      filtros por período/contrato/status.
      Impacto: Performance, escalabilidade, melhores práticas REST.

    rf_item_relacionado: null
    uc_relacionado: "UC00"

    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF090-006"
    tipo: "webservice"
    nome: "WSMedicao.asmx - CriarMedicao()"
    caminho: "ic1_legado/IControlIT/WebServices/WSMedicao.asmx.vb"
    descricao: |
      Cria nova medição.
      Sem validações de período/vigência.
      Sem validação de sobreposição.
      Sem validação de tipo de medição.

    destino: "substituido"
    justificativa: |
      Substituído por endpoint REST POST /api/medicoes com validações
      obrigatórias (RN-RF090-001, RN-RF090-002, RN-RF090-003),
      FluentValidation, retorno estruturado de erros.
      Impacto: Integridade de dados, conformidade com regras de negócio.

    rf_item_relacionado: "RN-RF090-001,RN-RF090-002,RN-RF090-003"
    uc_relacionado: "UC01"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-007"
    tipo: "webservice"
    nome: "WSMedicao.asmx - AtualizarMedicao()"
    caminho: "ic1_legado/IControlIT/WebServices/WSMedicao.asmx.vb"
    descricao: |
      Atualiza medição existente.
      Permite atualizar qualquer campo sem controle de estado.
      Sem validação de workflow (permitia alterar medições faturadas).

    destino: "substituido"
    justificativa: |
      Substituído por endpoint REST PUT /api/medicoes/{id} com validação
      de state machine (RN-RF090-007), permite atualização apenas em
      estados permitidos (Rascunho, PendenteAprovacao).
      Impacto: Segurança, integridade de dados, auditoria.

    rf_item_relacionado: "RN-RF090-007"
    uc_relacionado: "UC01"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-008"
    tipo: "webservice"
    nome: "WSMedicao.asmx - CalcularFatura()"
    caminho: "ic1_legado/IControlIT/WebServices/WSMedicao.asmx.vb"
    descricao: |
      Calcula valor de fatura (chama stored procedure).
      Execução síncrona (pode travar em volumes altos).
      Sem retry, sem tratamento de erro robusto.

    destino: "substituido"
    justificativa: |
      Substituído por job assíncrono Hangfire (RN-RF090-008),
      processamento em background com retry automático,
      notificações de sucesso/falha, logs estruturados.
      Impacto: Escalabilidade, resiliência, melhores práticas.

    rf_item_relacionado: "RN-RF090-008"
    uc_relacionado: "UC03"

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-009"
    tipo: "webservice"
    nome: "WSMedicao.asmx - AplicarReajuste()"
    caminho: "ic1_legado/IControlIT/WebServices/WSMedicao.asmx.vb"
    descricao: |
      Aplica reajuste manualmente (admin).
      UPDATE direto sem histórico.
      Sem validação de índice econômico.
      Sem simulação prévia.

    destino: "substituido"
    justificativa: |
      Substituído por job automático Hangfire (RN-RF090-004) com
      índices econômicos (IGPM/IPCA/INPC), histórico completo,
      simulação antes de aplicar, reversibilidade.
      Impacto: Automação, conformidade, auditoria.

    rf_item_relacionado: "RN-RF090-004"
    uc_relacionado: null

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-010"
    tipo: "stored_procedure"
    nome: "pa_CalcularFatura_Contrato"
    caminho: "Database/dbo.pa_CalcularFatura_Contrato"
    descricao: |
      Calcula valor da fatura com reajuste.
      Lógica complexa em SQL (difícil de testar/manter).
      Sem versionamento (código perdido em mudanças).

    destino: "substituido"
    justificativa: |
      Lógica migrada para C# (Application layer - Handler),
      testável unitariamente, versionado em Git,
      integração com job Hangfire (RN-RF090-008).
      Impacto: Manutenibilidade, testabilidade, rastreabilidade.

    rf_item_relacionado: "RN-RF090-008"
    uc_relacionado: "UC03"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-011"
    tipo: "stored_procedure"
    nome: "pa_ListarMedicoesPendentes"
    caminho: "Database/dbo.pa_ListarMedicoesPendentes"
    descricao: |
      Lista medições não faturadas.
      Sem filtros dinâmicos (hardcoded).

    destino: "substituido"
    justificativa: |
      Substituído por query LINQ no repository GetMedicoesPorStatusAsync,
      filtros dinâmicos via Expression<Func<T, bool>>,
      reutilizável em múltiplos contextos.
      Impacto: Flexibilidade, manutenibilidade.

    rf_item_relacionado: null
    uc_relacionado: "UC00"

    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF090-012"
    tipo: "stored_procedure"
    nome: "pa_AplicarReajuste"
    caminho: "Database/dbo.pa_AplicarReajuste"
    descricao: |
      Aplica reajuste manualmente no banco.
      UPDATE direto sem histórico, sem validação.

    destino: "substituido"
    justificativa: |
      Lógica migrada para job automático Hangfire (RN-RF090-004),
      validações, histórico completo, simulação antes de aplicar.
      Stored procedure será removida após migração completa.
      Impacto: Automação, auditoria, conformidade.

    rf_item_relacionado: "RN-RF090-004"
    uc_relacionado: null

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-013"
    tipo: "stored_procedure"
    nome: "pa_RatearMedicao"
    caminho: "Database/dbo.pa_RatearMedicao"
    descricao: |
      Faz cálculos de rateio.
      Sem validação de soma = 100%.
      Permite percentuais negativos.

    destino: "substituido"
    justificativa: |
      Lógica migrada para Handler RatearMedicaoHandler (RN-RF090-005),
      validação obrigatória soma = 100% (tolerância 0,01%),
      validação percentuais positivos, auditoria.
      Impacto: Integridade de dados, conformidade.

    rf_item_relacionado: "RN-RF090-005"
    uc_relacionado: "UC01"

    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-014"
    tipo: "regra_negocio"
    nome: "Cálculo Manual de Valor de Medição"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoDetalhe.aspx.vb"
    descricao: |
      Usuário digitava valor manualmente no campo txtValor.
      Sem validação, sem cálculo automático.
      Alto risco de erro (digitação incorreta, vírgula vs ponto, etc).

    destino: "substituido"
    justificativa: |
      Substituído por cálculo automático (RN-RF090-003) baseado em tipo:
      - Fixa: ValorFixo
      - Variável: Quantidade × ValorUnitario
      - Híbrida: ValorFixo + (Quantidade × ValorUnitario)
      Elimina erros manuais, garante consistência.
      Impacto: Integridade de dados, confiabilidade.

    rf_item_relacionado: "RN-RF090-003"
    uc_relacionado: "UC01"

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-015"
    tipo: "regra_negocio"
    nome: "Workflow de Aprovação Inexistente"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoDetalhe.aspx.vb"
    descricao: |
      Qualquer usuário podia alterar medições já faturadas.
      Sem segregação de funções (medidor = aprovador = financeiro).
      Sem auditoria de quem aprovou/quando.

    destino: "substituido"
    justificativa: |
      Substituído por state machine (RN-RF090-007):
      Rascunho → PendenteAprovacao → Aprovada → Faturada → Glosa.
      Permissões RBAC (med:approve), auditoria completa.
      Impacto: Segurança, governança, compliance.

    rf_item_relacionado: "RN-RF090-007"
    uc_relacionado: "UC02"

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-016"
    tipo: "regra_negocio"
    nome: "Reajuste Manual por DBA"
    caminho: "Procedimento Operacional Manual (não documentado)"
    descricao: |
      DBA executava UPDATE SQL direto em tabela Medicao.
      Sem histórico, sem auditoria, sem validação de índice.
      Exemplo: UPDATE Medicao SET Vl_Medicao = Vl_Medicao * 1.055

    destino: "substituido"
    justificativa: |
      Substituído por job automático (RN-RF090-004) com índices
      econômicos (IGPM/IPCA/INPC), histórico completo, simulação,
      reversibilidade, auditoria.
      Impacto: Automação, conformidade, eliminação de erros manuais.

    rf_item_relacionado: "RN-RF090-004"
    uc_relacionado: null

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-017"
    tipo: "regra_negocio"
    nome: "Validação de Período Ausente"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoDetalhe.aspx.vb"
    descricao: |
      Sem validação se período está dentro vigência contrato.
      Sem validação de sobreposição.
      Permitia criar medições fora do contrato ou duplicadas.

    destino: "assumido"
    justificativa: |
      Comportamento legado INCORRETO.
      RF moderno implementa validações obrigatórias (RN-RF090-001, RN-RF090-002).
      Impacto: Correção de falha crítica de validação.

    rf_item_relacionado: "RN-RF090-001,RN-RF090-002"
    uc_relacionado: "UC01"

    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-018"
    tipo: "regra_negocio"
    nome: "Rateio sem Validação Soma = 100%"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/TabelaRateio.aspx.vb"
    descricao: |
      Permitia criar rateios com soma de percentuais ≠ 100%.
      Exemplo: Filial A 60% + Filial B 30% = 90% (10% perdidos).
      Permitia percentuais negativos.

    destino: "assumido"
    justificativa: |
      Comportamento legado INCORRETO.
      RF moderno implementa validação obrigatória (RN-RF090-005):
      soma = 100% (tolerância 0,01%), percentuais positivos.
      Impacto: Correção de falha crítica de integridade.

    rf_item_relacionado: "RN-RF090-005"
    uc_relacionado: "UC01"

    complexidade: "baixa"
    risco_migracao: "baixo"
    prioridade: 1

  - id: "LEG-RF090-019"
    tipo: "regra_negocio"
    nome: "Glosa sem Workflow"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/GlosaAnaliseLista.aspx.vb"
    descricao: |
      Flag simples Fl_Aprovada (bit) sem auditoria.
      Sem registro de quem aprovou/rejeitou.
      Sem geração automática de nota fiscal de crédito.

    destino: "substituido"
    justificativa: |
      Substituído por workflow formal (RN-RF090-009):
      PendenteAnalise → Aprovada/Rejeitada, auditoria completa,
      geração automática de nota fiscal de crédito via RF032.
      Impacto: Transparência, rastreabilidade, automação.

    rf_item_relacionado: "RN-RF090-009"
    uc_relacionado: "UC04"

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF090-020"
    tipo: "regra_negocio"
    nome: "Multi-tenancy Não Garantido"
    caminho: "ic1_legado/IControlIT/App_Code/BasePage.vb"
    descricao: |
      Id_Cliente presente em tabelas mas sem filtro automático.
      Queries manuais WHERE Id_Cliente = @IdCliente (risco de esquecimento).
      Vazamento de dados entre clientes detectado em auditorias anteriores.

    destino: "assumido"
    justificativa: |
      Comportamento legado INCORRETO (falha de segurança crítica).
      RF moderno implementa row-level isolation automático (ClienteId)
      via Query Filter do EF Core, impossível esquecer filtro.
      Impacto: Correção de falha crítica de segurança.

    rf_item_relacionado: "seguranca.isolamento_tenant"
    uc_relacionado: null

    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF090-021"
    tipo: "componente"
    nome: "Auditoria Legado (Logs Textuais)"
    caminho: "ic1_legado/IControlIT/App_Data/Logs/*.txt"
    descricao: |
      Logs textuais em arquivos .txt sem estrutura.
      Exemplo: "2024-12-01 10:30:00 - Usuario123 criou medicao 456"
      Sem JSON, sem hash, sem retenção garantida.
      Impossível auditar alterações pós-fato.

    destino: "substituido"
    justificativa: |
      Substituído por tabela de auditoria estruturada (RN-RF090-010):
      JSON de valores antes/depois, hash SHA-256, retenção 7 anos,
      append-only table.
      Impacto: Conformidade LGPD, auditoria completa, detecção de fraudes.

    rf_item_relacionado: "RN-RF090-010"
    uc_relacionado: null

    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

# Telas Legadas (estrutura detalhada)
telas:
  - id: "LEG-RF090-001"
    nome: "MedicaoLista.aspx"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoLista.aspx"
    responsabilidade: "Listar medições com filtros básicos"
    campos:
      - nome: "ddlContrato"
        tipo: "DropDownList"
        obrigatorio: true
        validacao: "Required"
      - nome: "txtDataInicio"
        tipo: "TextBox (Date)"
        obrigatorio: false
        validacao: "None"
      - nome: "txtDataFim"
        tipo: "TextBox (Date)"
        obrigatorio: false
        validacao: "None"
      - nome: "gvMedicoes"
        tipo: "GridView"
        obrigatorio: false
        validacao: "None"
    comportamentos_implicitos:
      - "Sem isolamento por ClienteId (misturava dados de clientes)"
      - "Paginação server-side (postback completo)"
      - "Sem exportação Excel/PDF"

  - id: "LEG-RF090-002"
    nome: "MedicaoDetalhe.aspx"
    caminho: "ic1_legado/IControlIT/Financeiro/Medicao/MedicaoDetalhe.aspx"
    responsabilidade: "Criar/editar medição"
    campos:
      - nome: "ddlContrato"
        tipo: "DropDownList"
        obrigatorio: true
        validacao: "Required"
      - nome: "txtDataInicio"
        tipo: "TextBox (Date)"
        obrigatorio: true
        validacao: "Required"
      - nome: "txtDataFim"
        tipo: "TextBox (Date)"
        obrigatorio: true
        validacao: "Required"
      - nome: "txtValor"
        tipo: "TextBox (Decimal)"
        obrigatorio: true
        validacao: "Required + Range(0, 999999999)"
    comportamentos_implicitos:
      - "Cálculo manual de valor (usuário digitava)"
      - "Sem validação de sobreposição de períodos"
      - "Sem validação de vigência do contrato"

# WebServices Legados
servicos:
  - id: "LEG-RF090-005"
    nome: "WSMedicao.asmx"
    localizacao: "ic1_legado/IControlIT/WebServices/WSMedicao.asmx"
    responsabilidade: "API de medições (CRUD básico)"
    notas: "Sem paginação, sem validações robustas, execução síncrona"

# Tabelas Legadas com Problemas
tabelas:
  - nome: "Medicao"
    finalidade: "Registro principal de medições"
    problemas:
      - "Sem multi-tenancy automático (Id_Cliente sem filtro)"
      - "Sem soft delete (DELETE físico)"
      - "Sem tipo de medição (campo único Vl_Medicao)"
      - "Sem auditoria estruturada (logs textuais)"

  - nome: "Rateio_Medicao"
    finalidade: "Rateio entre centros de custo"
    problemas:
      - "Sem validação soma = 100%"
      - "Permite percentuais negativos"
      - "Sem auditoria de alterações"

  - nome: "Glosa"
    finalidade: "Contestações de fatura"
    problemas:
      - "Flag simples Fl_Aprovada (bit)"
      - "Sem workflow formal"
      - "Sem auditoria de decisão"

# Regras de Negócio Implícitas (não documentadas)
regras_implicitas:
  - id: "RL-RN-001"
    descricao: |
      Cálculo de valor de medição era manual, usuário digitava valor sem validação.
      Alto risco de erro (digitação incorreta, vírgula vs ponto, etc).
    fonte: "MedicaoDetalhe.aspx.vb, linha 234"

  - id: "RL-RN-002"
    descricao: |
      Reajustes aplicados manualmente por DBA via UPDATE SQL.
      Sem histórico, sem auditoria, sem validação de índice.
    fonte: "Procedimento Operacional Manual (não documentado)"

  - id: "RL-RN-003"
    descricao: |
      Rateio permitia soma de percentuais ≠ 100%.
      Exemplo: 60% + 30% = 90% (10% perdidos).
    fonte: "TabelaRateio.aspx.vb, linha 156"

# Gap Analysis (Legado x Moderno)
gap_analysis:
  - item: "Tipo de Medição (Fixa/Variável/Híbrida)"
    existe_legado: false
    existe_moderno: true
    notas: "Nova funcionalidade - elimina cálculo manual"

  - item: "Validação de Período (sobreposição, vigência)"
    existe_legado: false
    existe_moderno: true
    notas: "Correção de falha crítica - integridade de dados"

  - item: "Workflow de Aprovação (State Machine)"
    existe_legado: false
    existe_moderno: true
    notas: "Nova funcionalidade - segregação de funções, auditoria"

  - item: "Reajuste Automático (Job Hangfire)"
    existe_legado: false
    existe_moderno: true
    notas: "Automação - elimina processo manual por DBA"

  - item: "Validação Rateio (soma = 100%)"
    existe_legado: false
    existe_moderno: true
    notas: "Correção de falha crítica - integridade de dados"

  - item: "Geração Automática de Fatura"
    existe_legado: false
    existe_moderno: true
    notas: "Automação - elimina processo manual com planilha"

  - item: "Workflow de Glosa"
    existe_legado: false
    existe_moderno: true
    notas: "Melhoria - transparência, rastreabilidade"

  - item: "Multi-tenancy Row-Level Automático"
    existe_legado: false
    existe_moderno: true
    notas: "Correção de falha crítica de segurança"

  - item: "Auditoria Estruturada (JSON + Hash)"
    existe_legado: false
    existe_moderno: true
    notas: "Conformidade LGPD - retenção 7 anos, detecção de fraudes"

# Decisões de Modernização
decisoes_modernizacao:
  - decisao: "Introduzir Tipos de Medição (Fixa, Variável, Híbrida)"
    motivo: |
      Legado tinha campo único Vl_Medicao (calculado manualmente).
      Tipos permitem cálculos automáticos, eliminam erros.
    impacto: "alto"
    data: "2025-12-31"

  - decisao: "Implementar State Machine de Aprovação"
    motivo: |
      Legado permitia alterar medições faturadas.
      State machine garante segregação de funções.
    impacto: "alto"
    data: "2025-12-31"

  - decisao: "Automatizar Reajustes com Job Hangfire"
    motivo: |
      Legado aplicava reajustes manualmente via UPDATE SQL.
      Job automático elimina erros, garante conformidade.
    impacto: "medio"
    data: "2025-12-31"

# Riscos de Migração
riscos_migracao:
  - risco: "Dados legados sem tipo de medição"
    impacto: "alto"
    probabilidade: "alta"
    mitigacao: |
      Script de migração infere tipo baseado em campos preenchidos.
      Se Vl_Medicao único → Fixa, se existir quantidade → Variável.

  - risco: "Medições com períodos sobrepostos no legado"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Script de validação identifica sobreposições,
      marca para revisão manual.

  - risco: "Rateios com soma ≠ 100% no legado"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Script normaliza percentuais proporcionalmente
      ou marca para revisão.

# Rastreabilidade (Legado → Moderno)
rastreabilidade:
  - elemento_legado: "MedicaoLista.aspx"
    referencia_rf: null
    referencia_uc: "UC00"
    status: "migrado"

  - elemento_legado: "MedicaoDetalhe.aspx"
    referencia_rf: "RN-RF090-001,RN-RF090-002,RN-RF090-003"
    referencia_uc: "UC01"
    status: "migrado"

  - elemento_legado: "WSMedicao.asmx"
    referencia_rf: null
    referencia_uc: "UC00,UC01"
    status: "migrado"

  - elemento_legado: "pa_CalcularFatura_Contrato"
    referencia_rf: "RN-RF090-008"
    referencia_uc: "UC03"
    status: "migrado"

  - elemento_legado: "pa_AplicarReajuste"
    referencia_rf: "RN-RF090-004"
    referencia_uc: null
    status: "migrado"

# Changelog
changelog:
  - versao: "1.0"
    data: "2025-12-31"
    descricao: "Criação da referência ao legado (separação RF/RL v2.0)"
    autor: "Agência ALC - alc.dev.br"
