# =============================================
# UC - Casos de Uso (Contrato Comportamental)
# Versão: 2.0
# Autor padrão: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF017"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Hierarquia Corporativa"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-05"
        - "RF-SEC-01"
        - "RF-SEC-02"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade de hierarquia corporativa"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão hierarquia.view_any"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega registros do Fornecedor do usuário autenticado"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação e ordenação"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe a lista"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por tipo de nível"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por filial"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por status"
          required: false
        - id: "FA-UC00-004"
          title: "Buscar por código ou nome"
          required: false
        - id: "FA-UC00-005"
          title: "Ordenar por coluna"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → acesso negado"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum registro encontrado → estado vazio"
          required: true
        - id: "FE-UC00-003"
          title: "Erro de conexão → mensagem de erro"
          required: true

    precondicoes:
      - permissao: "hierarquia.view_any"

    gatilho: "Usuario acessa a funcionalidade pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_hierarquia_corporativa"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_registros_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao_ordenacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_lista"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"
      - id: "FA-UC00-02"
        condicao: "usuario_busca_termo"
        resultado: "lista_filtrada_por_termo"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado_403"
      - id: "FE-UC00-02"
        condicao: "sem_registros"
        resultado: "estado_vazio"

    regras_aplicadas:
      - "RN-RF017-09"
      - "RN-RF017-10"

    resultado_final:
      estado: "lista_exibida"

  - id: "UC01"
    nome: "Criar Nível Hierárquico"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-01"
        - "RF-CRUD-02"
        - "RF-CRUD-03"
        - "RF-CRUD-04"
        - "RF-VAL-01"
        - "RF-VAL-02"
        - "RF-VAL-03"
        - "RF-VAL-05"
        - "RF-VAL-06"
        - "RF-VAL-07"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-03"
        - "RF-SEC-05"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário solicita criação de novo nível hierárquico"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão hierarquia.create"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário preenche campos obrigatórios"
          required: true
        - id: "FP-UC01-005"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema valida dados"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema cria registro com campos automáticos"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema publica evento de domínio"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema redireciona para listagem"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar e criar outro"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação"
          required: false
        - id: "FE-UC01-001"
          title: "Código duplicado → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "Código inválido → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "Hierarquia quebrada → HTTP 400"
          required: true
        - id: "FE-UC01-004"
          title: "Nome muito longo → HTTP 400"
          required: true
        - id: "FE-UC01-005"
          title: "Budget negativo → HTTP 400"
          required: true
        - id: "FE-UC01-006"
          title: "Gestor inativo → HTTP 400"
          required: true
        - id: "FE-UC01-007"
          title: "Filial inativa → HTTP 400"
          required: true

    precondicoes:
      - permissao: "hierarquia.create"

    gatilho: "Usuario clica em Novo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_criacao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 5
        ator: "usuario"
        acao: "salvar"
      - passo: 6
        ator: "sistema"
        acao: "validar_dados"
      - passo: 7
        ator: "sistema"
        acao: "persistir_registro"
      - passo: 8
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 9
        ator: "sistema"
        acao: "publicar_evento"
      - passo: 10
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 11
        ator: "sistema"
        acao: "redirecionar"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_http_400"
      - id: "FE-UC01-02"
        condicao: "codigo_duplicado"
        resultado: "erro_unicidade_http_400"
      - id: "FE-UC01-03"
        condicao: "hierarquia_quebrada"
        resultado: "erro_hierarquia_http_400"

    regras_aplicadas:
      - "RN-RF017-01"
      - "RN-RF017-02"
      - "RN-RF017-04"
      - "RN-RF017-05"
      - "RN-RF017-06"
      - "RN-RF017-07"
      - "RN-RF017-09"
      - "RN-RF017-10"
      - "RN-RF017-11"

    resultado_final:
      estado: "registro_criado"

  - id: "UC02"
    nome: "Visualizar Nível Hierárquico"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-06"
        - "RF-SEC-01"
        - "RF-SEC-02"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona registro"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão hierarquia.view"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida Fornecedor"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados completos"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe tela de visualização"
          required: true
        - id: "FA-UC02-001"
          title: "Editar registro"
          required: false
        - id: "FA-UC02-002"
          title: "Inativar registro"
          required: false
        - id: "FA-UC02-003"
          title: "Visualizar histórico de alterações"
          required: false
        - id: "FE-UC02-001"
          title: "Registro inexistente → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Registro de outro Fornecedor → HTTP 404"
          required: true
        - id: "FE-UC02-003"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "hierarquia.view"

    gatilho: "Usuario seleciona registro na listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_registro"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "sistema"
        acao: "exibir_visualizacao"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "registro_inexistente"
        resultado: "http_404"
      - id: "FE-UC02-02"
        condicao: "outro_tenant"
        resultado: "http_404_seguranca"

    regras_aplicadas:
      - "RN-RF017-09"
      - "RN-RF017-10"

    resultado_final:
      estado: "dados_exibidos"

  - id: "UC03"
    nome: "Editar Nível Hierárquico"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-07"
        - "RF-VAL-01"
        - "RF-VAL-05"
        - "RF-VAL-06"
        - "RF-VAL-07"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-03"
        - "RF-SEC-05"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário solicita edição"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão hierarquia.update"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida Fornecedor"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega dados atuais"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema exibe formulário preenchido"
          required: true
        - id: "FP-UC03-006"
          title: "Usuário altera campos permitidos"
          required: true
        - id: "FP-UC03-007"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema persiste alterações"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC03-011"
          title: "Sistema publica evento"
          required: true
        - id: "FP-UC03-012"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC03-013"
          title: "Sistema redireciona para visualização"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição"
          required: false
        - id: "FE-UC03-001"
          title: "Código duplicado → HTTP 400"
          required: true
        - id: "FE-UC03-002"
          title: "Código com histórico financeiro → HTTP 400"
          required: true
        - id: "FE-UC03-003"
          title: "Nome muito longo → HTTP 400"
          required: true
        - id: "FE-UC03-004"
          title: "Budget negativo → HTTP 400"
          required: true
        - id: "FE-UC03-005"
          title: "Gestor inativo → HTTP 400"
          required: true
        - id: "FE-UC03-006"
          title: "Conflito de edição concorrente → HTTP 409"
          required: true

    precondicoes:
      - permissao: "hierarquia.update"

    gatilho: "Usuario clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_edicao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 6
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 7
        ator: "usuario"
        acao: "salvar"
      - passo: 8
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 9
        ator: "sistema"
        acao: "persistir_alteracoes"
      - passo: 10
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 11
        ator: "sistema"
        acao: "publicar_evento"
      - passo: 12
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 13
        ator: "sistema"
        acao: "redirecionar"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "codigo_duplicado"
        resultado: "erro_unicidade_http_400"
      - id: "FE-UC03-02"
        condicao: "codigo_com_historico"
        resultado: "erro_historico_http_400"
      - id: "FE-UC03-03"
        condicao: "conflito_concorrente"
        resultado: "erro_conflito_http_409"

    regras_aplicadas:
      - "RN-RF017-04"
      - "RN-RF017-05"
      - "RN-RF017-07"
      - "RN-RF017-08"
      - "RN-RF017-09"
      - "RN-RF017-10"
      - "RN-RF017-11"

    resultado_final:
      estado: "registro_atualizado"

  - id: "UC04"
    nome: "Inativar Nível Hierárquico"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-08"
        - "RF-VAL-04"
        - "RF-ESP-01"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-03"
        - "RF-SEC-04"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário solicita inativação"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão hierarquia.delete"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida Fornecedor"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema verifica filhos ativos"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema exibe confirmação (com ou sem cascata)"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema exibe confirmação simples (sem filhos)"
          required: false
        - id: "FP-UC04-007"
          title: "Usuário confirma inativação"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema executa soft delete"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema inativa filhos recursivamente (se cascata)"
          required: false
        - id: "FP-UC04-010"
          title: "Sistema registra auditoria"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema publica evento"
          required: true
        - id: "FP-UC04-012"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC04-013"
          title: "Sistema redireciona para listagem"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar inativação"
          required: false
        - id: "FA-UC04-002"
          title: "Inativar múltiplos registros (lote)"
          required: false
        - id: "FE-UC04-001"
          title: "Filhos ativos sem cascata → HTTP 400"
          required: true
        - id: "FE-UC04-002"
          title: "Registro já inativo → HTTP 400"
          required: true
        - id: "FE-UC04-003"
          title: "Registro de outro Fornecedor → HTTP 404"
          required: true
        - id: "FE-UC04-004"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "hierarquia.delete"

    gatilho: "Usuario clica em Inativar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_inativacao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "verificar_filhos_ativos"
      - passo: 5
        ator: "sistema"
        acao: "exibir_confirmacao"
      - passo: 6
        ator: "usuario"
        acao: "confirmar"
      - passo: 7
        ator: "sistema"
        acao: "executar_soft_delete"
      - passo: 8
        ator: "sistema"
        acao: "inativar_filhos_cascata"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 10
        ator: "sistema"
        acao: "publicar_evento"
      - passo: 11
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 12
        ator: "sistema"
        acao: "redirecionar"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "filhos_ativos_sem_cascata"
        resultado: "erro_integridade_http_400"
      - id: "FE-UC04-02"
        condicao: "registro_ja_inativo"
        resultado: "erro_estado_http_400"

    regras_aplicadas:
      - "RN-RF017-03"
      - "RN-RF017-09"
      - "RN-RF017-10"
      - "RN-RF017-12"

    resultado_final:
      estado: "registro_inativado"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica orientada a contrato. Cobertura 100% do RF017."

  - versao: "1.0"
    data: "2025-12-17"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão inicial (não seguia template)"
