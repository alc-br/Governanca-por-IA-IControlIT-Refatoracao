# Casos de Uso - RF017

**Vers√£o:** 1.0
**Data:** 2025-12-17
**RF Relacionado:** [RF017 - Hierarquia-Corporativa](./RF017.md)

---

## √çndice de Casos de Uso

| UC | Nome | Descri√ß√£o |
|----|------|-----------|
| UC00 | UC00 - Listar Centros de Custo | Permite listar todos os centros de custo com filtros, pagina√ß√£o e ordena√ß√£o.... |
| UC00 | UC00 - Listar Departamentos | Caso de uso |
| UC00 | UC00 - Listar Hierarquia Corporativa - Especifica√ß√£o Completa | Permite que usu√°rios autorizados visualizem a hierarquia corporativa completa (filiais, centros de c |
| UC00 | UC00 - Listar Se√ß√µes | Caso de uso |
| UC00 | UC00 - Listar Setores | Caso de uso |
| UC01 | UC01 - Criar Centro de Custo | Permite criar novo centro de custo vinculado a uma filial.... |
| UC01 | UC01 - Criar Departamento | Caso de uso |
| UC01 | UC01 - Criar Filial - Especifica√ß√£o Completa | Permite que usu√°rios autorizados criem novas filiais vinculadas a uma empresa, incluindo valida√ß√£o d |
| UC01 | UC01 - Criar Se√ß√£o | Caso de uso |
| UC01 | UC01 - Criar Setor | Caso de uso |
| UC02 | UC02 - Criar Centro de Custo - Especifica√ß√£o Completa | Permite que usu√°rios autorizados criem novos centros de custo vinculados a uma filial, incluindo con |
| UC02 | UC02 - Visualizar Centro de Custo | Caso de uso |
| UC02 | UC02 - Visualizar Departamento | Caso de uso |
| UC02 | UC02 - Visualizar Se√ß√£o | Caso de uso |
| UC02 | UC02 - Visualizar Setor | Caso de uso |
| UC03 | UC03 - Criar Departamento - Especifica√ß√£o Completa | Permite que usu√°rios autorizados criem novos departamentos vinculados a um centro de custo, incluind |
| UC03 | UC03 - Editar Centro de Custo | Caso de uso |
| UC03 | UC03 - Editar Departamento | Caso de uso |
| UC03 | UC03 - Editar Se√ß√£o | Caso de uso |
| UC03 | UC03 - Editar Setor | Caso de uso |
| UC04 | UC04 - Criar Setor - Especifica√ß√£o Completa | Permite criar novos setores vinculados a um departamento, com valida√ß√£o de habilita√ß√£o do n√≠vel na f |
| UC04 | UC04 - Inativar Centro de Custo | Caso de uso |
| UC04 | UC04 - Inativar Departamento | Caso de uso |
| UC04 | UC04 - Inativar Se√ß√£o | Caso de uso |
| UC04 | UC04 - Inativar Setor | Caso de uso |
| UC05 | UC05 - Criar Se√ß√£o - Especifica√ß√£o Completa | Permite criar novas se√ß√µes (7¬∫ e √∫ltimo n√≠vel hier√°rquico) vinculadas a um setor, com valida√ß√£o comp |
| UC06 | UC06 - Visualizar √Årvore Hier√°rquica - Especifica√ß√£o Completa | Permite que usu√°rios autorizados visualizem a hierarquia corporativa completa em formato de √°rvore e |

---

# UC00 - Listar Centros de Custo
Vers√£o: 1.0 Data: 06/11/2025 Status: Documentado

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite listar todos os centros de custo com filtros, pagina√ß√£o e ordena√ß√£o.
### Atores
- Prim√°rio: Todos os usu√°rios autenticados
- Secund√°rio: Sistema de Auditoria
### Pr√©-condi√ß√µes
- Usu√°rio autenticado
- Permiss√£o CAD.CENTROCUSTO.READ
### P√≥s-condi√ß√µes
Sucesso: Lista de centros de custo exibida Falha: Mensagem de erro exibida

## FLUXO PRINCIPAL

## FLUXOS ALTERNATIVOS
### FA01 - Filtrar por Filial
- Usu√°rio seleciona filial no filtro
- Sistema exibe apenas centros de custo daquela filial
### FA02 - Filtrar por Status
- Usu√°rio seleciona ‚ÄúAtivos‚Äù ou ‚ÄúInativos‚Äù
- Sistema filtra lista

## FLUXOS DE EXCE√á√ÉO
### FE01 - Sem Permiss√£o
- Sistema detecta falta de permiss√£o CAD.CENTROCUSTO.READ
- Exibe mensagem ‚ÄúAcesso negado‚Äù
- Redireciona para dashboard
### FE02 - Sem Registros
- N√£o existem centros de custo cadastrados
- Sistema exibe mensagem ‚ÄúNenhum centro de custo cadastrado‚Äù
- Exibe bot√£o ‚ÄúNovo Centro de Custo‚Äù (se tiver permiss√£o)
### FE03 - Erro ao Carregar
- Erro de conex√£o com banco
- Sistema exibe ‚ÄúErro ao carregar dados‚Äù
- Bot√£o ‚ÄúTentar novamente‚Äù

## REGRAS DE NEG√ìCIO
- RN-CAD-008-09: Filtro por conglomerado (multi-tenancy) - sempre aplicado
- RN-CAD-008-06: Centros de custo vinculados a filiais ativas
- RN-CAD-008-01: C√≥digo √∫nico por conglomerado

## MATRIZ DE PERMISS√ïES

## CASOS DE TESTE
### CT-001: Listar com Sucesso
- Usu√°rio com permiss√£o acessa tela
- Sistema exibe lista paginada
- Validar campos exibidos: c√≥digo, nome, filial, gestor, status
### CT-002: Filtrar por C√≥digo
- Digitar c√≥digo no filtro
- Sistema exibe apenas registros que correspondem
### CT-003: Ordenar por Nome
- Clicar em coluna ‚ÄúNome‚Äù
- Sistema reordena A-Z
### CT-004: Pagina√ß√£o
- Lista com 50 registros
- Exibe 20 por p√°gina (3 p√°ginas)
- Navegar entre p√°ginas
### CT-005: Sem Permiss√£o
- Usu√°rio sem CAD.CENTROCUSTO.READ
- Sistema nega acesso

---

# UC00 - Listar Departamentos
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Listar departamentos com filtros Atores: Todos autenticados Pr√©: CAD.DEPARTAMENTO.READ P√≥s: Lista exibida
## FLUXO
- Acessa ‚ÄúDepartamentos‚Äù
- Sistema carrega departamentos do conglomerado
- Filtra por: c√≥digo, nome, centro de custo, status
- Ordena e pagina (20/p√°gina)
## EXCE√á√ïES
FE01: Sem permiss√£o ‚Üí Acesso negado FE02: Sem registros ‚Üí ‚ÄúNenhum departamento cadastrado‚Äù
## REGRAS
- RN-CAD-008-02: Hierarquia obrigat√≥ria
- RN-CAD-008-09: Multi-tenancy
## TESTES
CT-001: Listar todos | CT-002: Filtrar por CC | CT-003: Pagina√ß√£o

---

# UC00 - Listar Hierarquia Corporativa - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes
- Integra√ß√µes Externas

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite que usu√°rios autorizados visualizem a hierarquia corporativa completa (filiais, centros de custo, departamentos, setores e se√ß√µes) em formato de lista paginada com filtros avan√ßados e exporta√ß√£o para Excel/PDF.
### Atores
- Prim√°rio: Administrador do Sistema, Gerente, Usu√°rio com permiss√£o de leitura
- Secund√°rio: Sistema de Auditoria, Sistema de Cache (Redis)
### Pr√©-condi√ß√µes
- Usu√°rio deve estar autenticado no sistema
- Usu√°rio deve ter permiss√£o hierarchy:read
- Sistema deve estar online e conectado ao banco de dados
- Deve existir pelo menos um conglomerado cadastrado
- Multi-tenancy: Filtro autom√°tico por Id_Conglomerado do usu√°rio logado
### P√≥s-condi√ß√µes
Sucesso: 1. Lista de hierarquia exibida com pagina√ß√£o 2. Filtros aplicados corretamente 3. Cache atualizado (Redis - 5 minutos) 4. Log de acesso registrado (opcional, configur√°vel) 5. Exporta√ß√£o gerada (se solicitada)
Falha: 1. Mensagem de erro amig√°vel exibida 2. Log de erro registrado 3. Dados n√£o s√£o expostos
### Requisitos N√£o-Funcionais
- Performance: Listagem deve completar em < 1 segundo para at√© 1000 registros
- Cache: Redis com TTL de 5 minutos por n√≠vel hier√°rquico
- Pagina√ß√£o: M√°ximo 50 registros por p√°gina
- Seguran√ßa: Filtro autom√°tico por conglomerado (multi-tenancy)
- Usabilidade: Busca em tempo real (debounce 300ms)

## FLUXO PRINCIPAL
### FP01 - Listar Filiais de uma Empresa

## FLUXOS ALTERNATIVOS
### FA01 - Listar Centros de Custo de uma Filial
Diverge no passo 3 do FP01
### FA02 - Listar Departamentos de um Centro de Custo
Diverge no passo 3 do FP01
### FA03 - Listar Setores de um Departamento
Diverge no passo 3 do FP01
### FA04 - Listar Se√ß√µes de um Setor
Diverge no passo 3 do FP01
### FA05 - Buscar por Nome/C√≥digo
Pode ocorrer em qualquer passo ap√≥s 11
### FA06 - Filtrar por Status (Ativo/Inativo)
Pode ocorrer em qualquer passo ap√≥s 11
### FA07 - Ordenar por Coluna
Pode ocorrer em qualquer passo ap√≥s 11
### FA08 - Exportar para Excel
Pode ocorrer em qualquer passo ap√≥s 11
### FA09 - Exportar para PDF
Pode ocorrer em qualquer passo ap√≥s 11

## FLUXOS DE EXCE√á√ÉO
### FE01 - Nenhum Registro Encontrado
Ocorre no passo 6 do FP01
### FE02 - Erro de Conex√£o com Banco de Dados
Pode ocorrer no passo 6 do FP01
### FE03 - Cache Indispon√≠vel (Redis Offline)
Pode ocorrer no passo 5 do FP01
### FE04 - Timeout na Consulta (>5 segundos)
Pode ocorrer no passo 6 do FP01
### FE05 - N√≠vel Hier√°rquico Desabilitado
Ocorre no FA02, FA03 ou FA04
### FE06 - Exporta√ß√£o Falha (Muitos Registros)
Ocorre no FA08 ou FA09

## REGRAS DE NEG√ìCIO
### RN-UC00-001: Multi-Tenancy Obrigat√≥rio
Descri√ß√£o: Todas as listagens devem filtrar automaticamente por Id_Conglomerado do usu√°rio logado.
Regra: - Filtro global aplicado em TODAS as queries: WHERE Id_Conglomerado = [usuario.IdConglomerado] - N√£o √© poss√≠vel visualizar dados de outro conglomerado - Exce√ß√£o: Super-admin pode visualizar todos os conglomerados
Valida√ß√£o: Backend aplica filtro automaticamente via IApplicationDbContext

### RN-UC00-002: Cache por N√≠vel Hier√°rquico
Descri√ß√£o: Cada n√≠vel hier√°rquico possui cache independente no Redis.
Chaves de Cache:
filiais:empresa:{empresaId}         - TTL 5 min
centros-custo:filial:{filialId}     - TTL 5 min
departamentos:cc:{ccId}             - TTL 5 min
setores:departamento:{deptoId}      - TTL 5 min
secoes:setor:{setorId}              - TTL 5 min
Invalida√ß√£o de Cache: - Ao criar/editar/inativar: invalida cache do n√≠vel + n√≠vel pai - Exemplo: Criar CC ‚Üí invalida cache de CCs da filial + cache de filiais

### RN-UC00-003: Pagina√ß√£o Obrigat√≥ria
Descri√ß√£o: Listagens sempre retornam paginadas.
Regra: - Tamanho padr√£o da p√°gina: 50 registros - Tamanhos permitidos: 10, 25, 50, 100 - M√°ximo absoluto: 100 registros por p√°gina - Response inclui: total, page, pageSize, totalPages, data[]

### RN-UC00-004: Ordena√ß√£o Padr√£o
Descri√ß√£o: Cada n√≠vel possui ordena√ß√£o padr√£o.
Ordena√ß√µes: - Filiais: Nm_Filial ASC - Centros de Custo: Codigo_Centro_Custo ASC - Departamentos: Nm_Departamento ASC - Setores: Nm_Setor ASC - Se√ß√µes: Nm_Secao ASC
Ordena√ß√µes Alternativas: - Status (Ativo/Inativo) - Data de Cadastro - C√≥digo (se aplic√°vel)

### RN-UC00-005: Filtros Combinados
Descri√ß√£o: Usu√°rio pode combinar m√∫ltiplos filtros.
Filtros Dispon√≠veis: - Busca por nome/c√≥digo (texto livre) - Status (Ativo/Inativo/Todos) - Respons√°vel (autocomplete) - Data de cadastro (range)
Combina√ß√£o: Filtros aplicados com AND l√≥gico

### RN-UC00-006: Exibi√ß√£o de Status Visual
Descri√ß√£o: Status deve ser exibido com badge colorido.
Cores: - Ativo (Fl_Ativo = 1): Badge verde ‚ÄúAtivo‚Äù - Inativo (Fl_Ativo = 2): Badge cinza ‚ÄúInativo‚Äù - Sem Respons√°vel: Badge amarelo ‚ÄúSem Respons√°vel‚Äù - Rateio Incompleto (CC): Badge laranja ‚ÄúRateio <100%‚Äù

### RN-UC00-007: Totalizadores Inteligentes
Descri√ß√£o: Exibir totalizadores contextuais por n√≠vel.
Totalizadores: - Filiais: Total de CCs, Total de Consumidores - CCs: Soma % Rateio (warning se ‚â† 100%) - Departamentos: Total de Consumidores alocados - Setores: Total de Se√ß√µes - Se√ß√µes: Total de Consumidores

### RN-UC00-008: Breadcrumb Din√¢mico
Descri√ß√£o: Breadcrumb deve refletir navega√ß√£o hier√°rquica.
Formato:
Hierarquia > Filiais > [Nome Empresa] > Centros de Custo > [Nome Filial] > Departamentos
Clic√°vel: Cada n√≠vel do breadcrumb √© clic√°vel para voltar

### RN-UC00-009: Limite de Exporta√ß√£o
Descri√ß√£o: Exporta√ß√µes possuem limite de registros.
Limites: - Excel: 5.000 registros - PDF: 1.000 registros - Se exceder: sistema solicita aplica√ß√£o de filtros
Formato Excel: - Todas as colunas vis√≠veis - Formata√ß√£o de CNPJ/Telefone - Cabe√ßalho com filtros aplicados
Formato PDF: - Layout retrato ou paisagem (autom√°tico) - Logo da empresa no cabe√ßalho - Data/hora de gera√ß√£o - Assinatura digital (opcional)

### RN-UC00-010: Auditoria de Acesso (Opcional)
Descri√ß√£o: Acessos √† hierarquia podem ser auditados (configur√°vel).
Regra: - Se Sistema_Parametro.AuditarAcessoHierarquia = true: registra acesso - Log registra: usu√°rio, timestamp, n√≠vel acessado, filtros aplicados - √ötil para compliance e LGPD

## MATRIZ DE PERMISS√ïES
### Permiss√µes Envolvidas
### Combina√ß√µes de Permiss√µes para Teste

## INTEGRA√á√ïES EXTERNAS
### 1. Sistema de Cache (Redis)
Chaves Utilizadas:
filiais:empresa:{guid}
centros-custo:filial:{guid}
departamentos:cc:{guid}
setores:departamento:{guid}
secoes:setor:{guid}
TTL: 5 minutos
Invalida√ß√£o: Ao criar/editar/inativar n√≠vel

### 2. Central de Funcionalidades (RF-001)
Integra√ß√£o: Registrar acesso √† funcionalidade
Dados Registrados: - Funcionalidade: ‚ÄúListar Hierarquia Corporativa‚Äù - Usu√°rio: [guid do usu√°rio] - Timestamp: [data/hora] - Metadados: N√≠vel acessado, filtros aplicados

### 3. Sistema de Auditoria (RF-004)
Integra√ß√£o: Registrar acesso (se configurado)
Dados Auditados:
{
  "acao": "Read",
  "entidade": "Hierarquia",
  "usuario": "admin@sistema.com",
  "timestamp": "2025-11-06T14:30:00Z",
  "detalhes": {
    "nivel": "Filiais",
    "empresaId": "guid-empresa",
    "filtros": {
      "status": "Ativo",
      "busca": "Matriz"
    }
  }
}

### 4. i18n (RF-005)
Chaves de Tradu√ß√£o Necess√°rias:
{
  "hierarchy.list.title": "Hierarquia Corporativa",
  "hierarchy.list.filiais": "Filiais",
  "hierarchy.list.centros_custo": "Centros de Custo",
  "hierarchy.list.departamentos": "Departamentos",
  "hierarchy.list.setores": "Setores",
  "hierarchy.list.secoes": "Se√ß√µes",
  "hierarchy.list.no_results": "Nenhum registro encontrado",
  "hierarchy.list.total": "Total de registros",
  "hierarchy.list.active": "Ativo",
  "hierarchy.list.inactive": "Inativo",
  "hierarchy.list.export_excel": "Exportar Excel",
  "hierarchy.list.export_pdf": "Exportar PDF",
  "hierarchy.list.search": "Buscar por nome ou c√≥digo",
  "hierarchy.list.filter_status": "Filtrar por status",
  "hierarchy.list.disabled_level": "Este n√≠vel est√° desabilitado nesta filial"
}

## ESPECIFICA√á√ïES T√âCNICAS
### Endpoint Backend
GET /api/hierarquia/filiais?empresaId={guid}&page=1&pageSize=50&status=1&search=Matriz
### Query Parameters
### Response (200 OK)
{
  "total": 127,
  "page": 1,
  "pageSize": 50,
  "totalPages": 3,
  "data": [
    {
      "id": "guid-filial-001",
      "codigo": "FIL001",
      "nome": "Filial Matriz",
      "cnpj": "33.592.510/0001-54",
      "cidade": "S√£o Paulo",
      "uf": "SP",
      "status": "Ativo",
      "hiDepartamento": true,
      "hiSetor": true,
      "hiSecao": false,
      "qtdCentrosCusto": 12,
      "qtdConsumidores": 450,
      "dtCadastro": "2025-01-15T10:00:00Z"
    }
  ]
}

Pr√≥ximos UCs: - UC01 - Criar Filial - UC02 - Criar Centro de Custo - UC03 - Criar Departamento - UC04 - Criar Setor - UC05 - Criar Se√ß√£o - UC06 - Visualizar √Årvore Hier√°rquica
Aprovado por: Anderson Chipak Revisado por: Claude Code Assistant Data: 2025-11-06

---

# UC00 - Listar Se√ß√µes
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Listar se√ß√µes com filtros Pr√©: CAD.SECAO.READ P√≥s: Lista exibida
## FLUXO
- Acessa ‚ÄúSe√ß√µes‚Äù ‚Üí Lista se√ß√µes do conglomerado
- Filtra por: c√≥digo, nome, setor, status
- Pagina 20/p√°gina
## EXCE√á√ïES
FE01: Sem permiss√£o | FE02: Sem registros
## TESTES
CT-001: Listar | CT-002: Filtrar por setor | CT-003: Pagina√ß√£o

---

# UC00 - Listar Setores
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Listar setores com filtros Pr√©: CAD.SETOR.READ P√≥s: Lista exibida
## FLUXO
- Acessa ‚ÄúSetores‚Äù ‚Üí Lista setores do conglomerado
- Filtra por: c√≥digo, nome, departamento, status
- Pagina 20/p√°gina
## EXCE√á√ïES
FE01: Sem permiss√£o | FE02: Sem registros
## TESTES
CT-001: Listar | CT-002: Filtrar por departamento | CT-003: Pagina√ß√£o

---

# UC01 - Criar Centro de Custo
Vers√£o: 1.0 Data: 06/11/2025

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite criar novo centro de custo vinculado a uma filial.
### Atores
- Prim√°rio: Administrador, Gestor
- Secund√°rio: Sistema de Auditoria
### Pr√©-condi√ß√µes
- Usu√°rio autenticado com permiss√£o CAD.CENTROCUSTO.CREATE
- Filial ativa cadastrada
### P√≥s-condi√ß√µes
Sucesso: Centro de custo criado e auditado Falha: Erro exibido, nenhuma altera√ß√£o no BD

## FLUXO PRINCIPAL

## FLUXOS ALTERNATIVOS
### FA01 - Criar Sem Gestor
- Deixar campo gestor vazio
- Sistema aceita (NULL)
### FA02 - Criar Sem Budget
- Deixar campo budget vazio
- Sistema aceita (NULL)

## FLUXOS DE EXCE√á√ÉO
### FE01 - C√≥digo Duplicado
- Sistema detecta c√≥digo j√° existe no conglomerado
- Erro: ‚ÄúC√≥digo j√° cadastrado‚Äù
- Campo c√≥digo fica vermelho
### FE02 - Nome Vazio
- Usu√°rio n√£o preenche nome
- Erro: ‚ÄúNome √© obrigat√≥rio‚Äù
### FE03 - C√≥digo Inv√°lido (n√£o UPPER_SNAKE_CASE)
- C√≥digo: ‚Äúcc-ti‚Äù (h√≠fen ao inv√©s de underscore)
- Erro: ‚ÄúUse formato UPPER_SNAKE_CASE (ex: CC_TI)‚Äù
### FE04 - Budget Negativo ou Zero
- Budget: -100 ou 0
- Erro: ‚ÄúBudget deve ser positivo‚Äù
### FE05 - Filial Inativa
- Seleciona filial inativa
- Erro: ‚ÄúFilial inativa n√£o pode ser vinculada‚Äù

## REGRAS DE NEG√ìCIO
- RN-CAD-008-01: C√≥digo √∫nico por conglomerado
- RN-CAD-008-05: Budget > 0 se informado
- RN-CAD-008-06: Vinculado a filial ativa
- RN-CAD-008-07: C√≥digo UPPER_SNAKE_CASE
- RN-CAD-008-09: Multi-tenancy (Id_Conglomerado)
- RN-CAD-008-10: Auditoria completa
- RN-CAD-008-11: Nome obrigat√≥rio, max 120

## MATRIZ DE PERMISS√ïES

## CASOS DE TESTE
### CT-001: Criar com Sucesso (Completo)
- C√≥digo: ‚ÄúCC_TI_INFRA‚Äù
- Nome: ‚ÄúTI Infraestrutura‚Äù
- Filial: Matriz
- Gestor: Jo√£o Silva
- Budget: 50000.00
- Status: Ativo
- Esperado: Criado com sucesso
### CT-002: Criar M√≠nimo (s√≥ obrigat√≥rios)
- C√≥digo: ‚ÄúCC_RH‚Äù
- Nome: ‚ÄúRecursos Humanos‚Äù
- Filial: Matriz
- Esperado: Criado
### CT-003: C√≥digo Duplicado
- C√≥digo j√° existente
- Esperado: Erro de valida√ß√£o
### CT-004: C√≥digo Formato Inv√°lido
- C√≥digo: ‚Äúcc-ti‚Äù (min√∫sculo com h√≠fen)
- Esperado: Erro de formato
### CT-005: Nome Vazio
- C√≥digo: ‚ÄúCC_FIN‚Äù
- Nome: ‚Äú‚Äù
- Esperado: Erro ‚ÄúNome obrigat√≥rio‚Äù
### CT-006: Budget Negativo
- Budget: -1000
- Esperado: Erro ‚ÄúBudget deve ser positivo‚Äù
### CT-007: Nome Muito Longo
- Nome: 121 caracteres
- Esperado: Erro ‚ÄúM√°ximo 120 caracteres‚Äù
### CT-008: Auditoria Registrada
- Criar centro de custo
- Esperado: Registro em Centro_Custo_Historico (INSERT)

---

# UC01 - Criar Departamento
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Criar departamento subordinado a centro de custo Atores: Admin, Gestor Pr√©: CAD.DEPARTAMENTO.CREATE, centro de custo existe P√≥s: Departamento criado, auditado
## FLUXO
- Clica ‚ÄúNovo Departamento‚Äù
- Seleciona centro de custo pai (obrigat√≥rio)
- Preenche c√≥digo (UPPER_SNAKE_CASE, √∫nico)
- Preenche nome (obrigat√≥rio, max 120)
- Descri√ß√£o (opcional, max 500)
- Seleciona gerente (opcional)
- Budget mensal (opcional, > 0)
- Define status
- Salva ‚Üí auditoria INSERT
## EXCE√á√ïES
FE01: C√≥digo duplicado ‚Üí Erro FE02: Centro de custo inativo ‚Üí ‚ÄúCC deve estar ativo‚Äù FE03: Nome vazio ‚Üí Obrigat√≥rio FE04: Formato c√≥digo inv√°lido ‚Üí UPPER_SNAKE_CASE
## REGRAS
- RN-CAD-008-01: C√≥digo √∫nico
- RN-CAD-008-02: Hierarquia obrigat√≥ria
- RN-CAD-008-04: Gerente deve ser usu√°rio ativo
- RN-CAD-008-05: Budget > 0
- RN-CAD-008-07: UPPER_SNAKE_CASE
- RN-CAD-008-11: Nome obrigat√≥rio
## TESTES
CT-001: Criar completo | CT-002: S√≥ obrigat√≥rios | CT-003: C√≥digo duplicado ‚Üí Erro | CT-004: CC inativo ‚Üí Erro

---

# UC01 - Criar Filial - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes
- Integra√ß√µes Externas

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite que usu√°rios autorizados criem novas filiais vinculadas a uma empresa, incluindo valida√ß√£o de CNPJ (opcional), configura√ß√£o de n√≠veis hier√°rquicos habilitados (Departamento, Setor, Se√ß√£o), tipos de bilhete permitidos, e integra√ß√£o com APIs externas para geolocaliza√ß√£o.
### Atores
- Prim√°rio: Administrador do Sistema, Super Admin
- Secund√°rio: API ViaCEP, API ReceitaWS (opcional), Sistema de Auditoria, Sistema de Geolocaliza√ß√£o
### Pr√©-condi√ß√µes
- Usu√°rio deve estar autenticado no sistema
- Usu√°rio deve ter permiss√£o hierarchy:filial:create
- Sistema deve estar online e conectado ao banco de dados
- Deve existir pelo menos uma empresa cadastrada
- Multi-tenancy: Usu√°rio s√≥ pode criar filiais em empresas do seu conglomerado
### P√≥s-condi√ß√µes
Sucesso: 1. Nova filial criada no banco de dados 2. Configura√ß√µes de n√≠veis hier√°rquicos salvas 3. Geolocaliza√ß√£o calculada (latitude/longitude) 4. Log de auditoria registrado 5. Cache invalidado (Redis) 6. Filial dispon√≠vel imediatamente para vincula√ß√£o com CCs
Falha: 1. Nenhuma altera√ß√£o no banco de dados (rollback) 2. Log de tentativa falha registrado 3. Mensagem de erro clara exibida ao usu√°rio 4. Dados preenchidos mantidos no formul√°rio para corre√ß√£o
### Requisitos N√£o-Funcionais
- Performance: Cria√ß√£o deve completar em < 3 segundos
- Seguran√ßa: CNPJ validado (se informado)
- Usabilidade: Dados preenchidos automaticamente ap√≥s valida√ß√£o de CNPJ/CEP
- Auditoria: Todas as tentativas devem ser logadas
- Resili√™ncia: Sistema deve funcionar mesmo com APIs externas indispon√≠veis

## FLUXO PRINCIPAL
### FP01 - Criar Filial com CNPJ e Configura√ß√£o Completa

## FLUXOS ALTERNATIVOS
### FA01 - Criar Filial sem CNPJ (Usar CNPJ da Matriz)
Diverge no passo 6 do FP01
### FA02 - Criar Filial sem Consultar APIs (Cadastro Manual)
Diverge no passo 9 do FP01
### FA03 - Criar Filial Pequena (Sem Setores e Se√ß√µes)
Diverge no passo 15 do FP01
### FA04 - Criar Filial Grande (Todos os N√≠veis Habilitados)
Diverge no passo 15 do FP01
### FA05 - Criar Filial sem Restri√ß√£o de Bilhetes
Diverge no passo 20 do FP01
### FA06 - Copiar Configura√ß√£o de Outra Filial
Diverge no passo 2 do FP01
### FA07 - Usar Template de Filial (Pequena/M√©dia/Grande)
Diverge no passo 2 do FP01

## FLUXOS DE EXCE√á√ÉO
### FE01 - CNPJ J√° Cadastrado na Empresa
Ocorre no passo 8 do FP01
### FE02 - CNPJ Inv√°lido (D√≠gitos Verificadores Incorretos)
Ocorre no passo 7 do FP01
### FE03 - Tentativa de Habilitar Se√ß√£o sem Setor
Ocorre no passo 19 do FP01
### FE04 - Tentativa de Habilitar Setor sem Departamento
Ocorre no passo 19 do FP01
### FE05 - CEP Inv√°lido
Ocorre no passo 11 do FP01
### FE06 - Empresa Inv√°lida ou Inativa
Ocorre no passo 3 do FP01
### FE07 - Erro de Conex√£o com Banco de Dados
Pode ocorrer no passo 28 do FP01
### FE08 - Campos Obrigat√≥rios N√£o Preenchidos
Ocorre no passo 24 do FP01

## REGRAS DE NEG√ìCIO
### RN-UC01-001: CNPJ √önico por Empresa (RN-CAD-003-03)
Descri√ß√£o: CNPJ deve ser √∫nico dentro da empresa. Filiais de empresas diferentes podem ter mesmo CNPJ.
Regra: - Constraint: UQ_Filial_CNPJ_Empresa UNIQUE (CNPJ, Id_Empresa) WHERE CNPJ IS NOT NULL - CNPJ NULL √© permitido (filial usa CNPJ da matriz) - Valida√ß√£o case-insensitive
Valida√ß√£o: Backend via FluentValidation + constraint no banco

### RN-UC01-002: Valida√ß√£o de Hierarquia de N√≠veis (RN-CAD-003-16)
Descri√ß√£o: N√≠veis hier√°rquicos devem respeitar depend√™ncias.
Regra: - Se Se√ß√£o habilitada (Hi_Secao = 1): Setor DEVE estar habilitado - Se Setor habilitado (Hi_Setor = 1): Departamento DEVE estar habilitado - Departamento pode ser habilitado independentemente
Valida√ß√£o: Backend valida antes de salvar
Casos V√°lidos:
‚úÖ Depto=1, Setor=1, Secao=1 (Todos habilitados)
‚úÖ Depto=1, Setor=1, Secao=2 (Sem Se√ß√£o)
‚úÖ Depto=1, Setor=2, Secao=2 (S√≥ Departamento)
‚ùå Depto=2, Setor=1, Secao=2 (Setor sem Depto - INV√ÅLIDO)
‚ùå Depto=1, Setor=2, Secao=1 (Se√ß√£o sem Setor - INV√ÅLIDO)

### RN-UC01-003: Tipos de Bilhete Permitidos (RN-CAD-003-17)
Descri√ß√£o: Filial pode configurar tipos de bilhete permitidos para auditoria de faturas.
Tipos de Bilhete:
1 = Voz Local
2 = Voz Longa Dist√¢ncia Nacional
3 = Voz Longa Dist√¢ncia Internacional
4 = Voz para Celular
5 = SMS
6 = Roaming Nacional
7 = Roaming Internacional
8 = Dados M√≥veis
9 = Servi√ßos Especiais (0800, 0300, etc.)
Regra: - Campo Rl_Id_Bilhete_Tipo: Lista de IDs separados por v√≠rgula (ex: ‚Äú1,4,8‚Äù) - Se NULL ou vazio: Todos os tipos permitidos (sem restri√ß√£o) - Na importa√ß√£o de fatura, sistema valida cada item contra esta lista - Itens fora da lista: marcados com Fl_Divergencia = 1

### RN-UC01-004: CNPJ Opcional - Usar CNPJ da Matriz (RN-CAD-003-06)
Descri√ß√£o: Filial pode n√£o ter CNPJ pr√≥prio e reutilizar CNPJ da empresa matriz.
Regra: - Se Filial.CNPJ IS NULL: assume CNPJ da empresa matriz - √ötil para empresas com inscri√ß√£o √∫nica e m√∫ltiplas unidades - Em relat√≥rios: exibir CNPJ da matriz com indica√ß√£o ‚Äú(Matriz)‚Äù

### RN-UC01-005: Geolocaliza√ß√£o Autom√°tica por CEP
Descri√ß√£o: Ao informar CEP, sistema busca latitude/longitude para exibi√ß√£o em mapas.
APIs: 1. ViaCEP: Retorna endere√ßo completo 2. Google Maps Geocoding API: Converte endere√ßo em coordenadas GPS
Regra: - Geolocaliza√ß√£o executada assincronamente (n√£o bloqueia salvamento) - Se falhar: Latitude/Longitude = NULL (n√£o impede cadastro) - Job noturno tentar√° calcular geolocaliza√ß√£o posteriormente

### RN-UC01-006: Valida√ß√£o de D√≠gitos Verificadores do CNPJ
Descri√ß√£o: CNPJ deve ter d√≠gitos verificadores v√°lidos conforme algoritmo da Receita Federal.
Regra: - Valida√ß√£o executada no backend E frontend - Aceita formato com ou sem m√°scaras (33.592.510/0001-54 ou 33592510000154) - Backend remove m√°scara antes de validar e salvar

### RN-UC01-007: Multi-Tenancy Obrigat√≥rio
Descri√ß√£o: Toda filial deve pertencer a uma empresa do conglomerado do usu√°rio logado.
Regra: - Usu√°rio s√≥ pode criar filiais em empresas do pr√≥prio conglomerado - Filtro autom√°tico: empresa.IdHolding = usuarioLogado.IdHolding - Valida√ß√£o aplicada antes de salvar

### RN-UC01-008: Auditoria Completa
Descri√ß√£o: Todas as cria√ß√µes de filiais devem ser auditadas.
Regra:
{
  "acao": "Create",
  "entidade": "Filial",
  "entidadeId": "guid-da-filial",
  "usuario": "admin@sistema.com",
  "timestamp": "2025-11-06T14:30:00Z",
  "dadosAntes": null,
  "dadosDepois": {
    "nome": "Filial Matriz S√£o Paulo",
    "cnpj": "33.592.510/0001-54",
    "empresaId": "guid-empresa",
    "hiDepartamento": true,
    "hiSetor": true,
    "hiSecao": false,
    "rlIdBilheteTipo": "1,4,8",
    "ativo": true
  }
}

### RN-UC01-009: Nomenclatura e Valida√ß√µes
Descri√ß√£o: Campos possuem limites e valida√ß√µes.
Regra: - Nome: m√≠nimo 2 caracteres, m√°ximo 50 - CNPJ: formato 99.999.999/9999-99 (14 d√≠gitos num√©ricos) - CEP: formato 99999-999 (8 d√≠gitos num√©ricos) - Endere√ßo: m√°ximo 300 caracteres

### RN-UC01-010: Invalida√ß√£o de Cache
Descri√ß√£o: Ao criar filial, cache deve ser invalidado.
Chaves Invalidadas:
filiais:empresa:{empresaId}      - Lista de filiais da empresa
TTL: Cache invalidado imediatamente

## MATRIZ DE PERMISS√ïES
### Permiss√µes Envolvidas
### Combina√ß√µes de Permiss√µes para Teste

## INTEGRA√á√ïES EXTERNAS
### 1. API ReceitaWS (Opcional)
Endpoint: GET https://receitaws.com.br/api/cnpj/{cnpj}
Uso: Preencher endere√ßo automaticamente ap√≥s valida√ß√£o de CNPJ
Tratamento de Erros: - HTTP 429 (Rate Limit): Permitir cadastro manual - HTTP 404 (CNPJ n√£o encontrado): Permitir cadastro manual - Timeout (>10s): Permitir cadastro manual

### 2. ViaCEP
Endpoint: GET https://viacep.com.br/ws/{cep}/json/
Uso: Preencher endere√ßo automaticamente ap√≥s informar CEP

### 3. Google Maps Geocoding API
Endpoint: GET https://maps.googleapis.com/maps/api/geocode/json?address={endereco}&key={api_key}
Uso: Calcular latitude/longitude para exibi√ß√£o em mapas

### 4. Sistema de Auditoria (RF-004)
Integra√ß√£o: Registrar cria√ß√£o de filial

### 5. Central de Funcionalidades (RF-001)
Integra√ß√£o: Registrar uso da funcionalidade ‚ÄúCriar Filial‚Äù

### 6. i18n (RF-005)
Chaves de Tradu√ß√£o Necess√°rias:
{
  "hierarchy.filial.create.title": "Nova Filial",
  "hierarchy.filial.create.name": "Nome da Filial",
  "hierarchy.filial.create.empresa": "Empresa",
  "hierarchy.filial.create.cnpj": "CNPJ",
  "hierarchy.filial.create.cnpj_optional": "CNPJ (opcional - deixe vazio para usar CNPJ da matriz)",
  "hierarchy.filial.create.cep": "CEP",
  "hierarchy.filial.create.endereco": "Endere√ßo",
  "hierarchy.filial.create.numero": "N√∫mero",
  "hierarchy.filial.create.complemento": "Complemento",
  "hierarchy.filial.create.bairro": "Bairro",
  "hierarchy.filial.create.cidade": "Cidade",
  "hierarchy.filial.create.uf": "UF",
  "hierarchy.filial.create.config_niveis": "Configura√ß√£o de N√≠veis Hier√°rquicos",
  "hierarchy.filial.create.departamento": "Departamento",
  "hierarchy.filial.create.setor": "Setor",
  "hierarchy.filial.create.secao": "Se√ß√£o",
  "hierarchy.filial.create.tipos_bilhete": "Tipos de Bilhete Permitidos",
  "hierarchy.filial.create.status": "Status",
  "hierarchy.filial.create.success": "Filial criada com sucesso",
  "hierarchy.filial.create.error_cnpj_duplicado": "CNPJ j√° cadastrado",
  "hierarchy.filial.create.error_cnpj_invalido": "CNPJ inv√°lido",
  "hierarchy.filial.create.error_hierarquia_invalida": "Configura√ß√£o de n√≠veis inv√°lida",
  "hierarchy.filial.create.template_pequena": "Pequena (<50 colaboradores)",
  "hierarchy.filial.create.template_media": "M√©dia (50-200 colaboradores)",
  "hierarchy.filial.create.template_grande": "Grande (>200 colaboradores)"
}

## ESPECIFICA√á√ïES T√âCNICAS
### Endpoint Backend
POST /api/hierarquia/filiais
### Request Body
{
  "idEmpresa": "guid-empresa-001",
  "nome": "Filial Matriz S√£o Paulo",
  "cnpj": "33592510000154",
  "cep": "01310100",
  "logradouro": "Avenida Paulista",
  "numero": "1000",
  "complemento": "Andar 5",
  "bairro": "Bela Vista",
  "cidade": "S√£o Paulo",
  "uf": "SP",
  "hiDepartamento": 1,
  "hiSetor": 1,
  "hiSecao": 2,
  "rlIdBilheteTipo": "1,4,8",
  "ativo": true
}
### Response (201 Created)
{
  "id": "guid-filial-001",
  "idEmpresa": "guid-empresa-001",
  "nome": "Filial Matriz S√£o Paulo",
  "cnpj": "33.592.510/0001-54",
  "endereco": "Av. Paulista, 1000 - Andar 5",
  "cidade": "S√£o Paulo",
  "uf": "SP",
  "latitude": -23.561684,
  "longitude": -46.655981,
  "hiDepartamento": true,
  "hiSetor": true,
  "hiSecao": false,
  "rlIdBilheteTipo": "1,4,8",
  "ativo": true,
  "dtCadastro": "2025-11-06T10:30:00Z"
}

Pr√≥ximos UCs: - UC02 - Criar Centro de Custo - UC03 - Criar Departamento - UC04 - Criar Setor - UC05 - Criar Se√ß√£o - UC06 - Visualizar √Årvore Hier√°rquica
Aprovado por: Anderson Chipak Revisado por: Claude Code Assistant Data: 2025-11-06

---

# UC01 - Criar Se√ß√£o
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Criar se√ß√£o subordinada a setor Pr√©: CAD.SECAO.CREATE, setor existe P√≥s: Se√ß√£o criada, auditada
## FLUXO
- ‚ÄúNova Se√ß√£o‚Äù ‚Üí Seleciona setor pai (obrigat√≥rio)
- C√≥digo (UPPER_SNAKE_CASE, √∫nico), nome (obrigat√≥rio, max 120)
- Descri√ß√£o (opcional), coordenador (opcional), budget (opcional, >0)
- Salva ‚Üí auditoria INSERT
## EXCE√á√ïES
FE01: C√≥digo duplicado | FE02: Setor inativo ‚Üí Erro | FE03: Nome vazio
## REGRAS
RN-CAD-008-01, RN-CAD-008-02, RN-CAD-008-04, RN-CAD-008-05, RN-CAD-008-07, RN-CAD-008-11
## TESTES
CT-001: Criar completo | CT-002: S√≥ obrigat√≥rios | CT-003: Setor inativo ‚Üí Erro

---

# UC01 - Criar Setor
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Criar setor subordinado a departamento Pr√©: CAD.SETOR.CREATE, departamento existe P√≥s: Setor criado, auditado
## FLUXO
- ‚ÄúNovo Setor‚Äù ‚Üí Seleciona departamento pai (obrigat√≥rio)
- C√≥digo (UPPER_SNAKE_CASE, √∫nico), nome (obrigat√≥rio, max 120)
- Descri√ß√£o (opcional), supervisor (opcional), budget (opcional, >0)
- Salva ‚Üí auditoria INSERT
## EXCE√á√ïES
FE01: C√≥digo duplicado | FE02: Departamento inativo ‚Üí Erro | FE03: Nome vazio
## REGRAS
RN-CAD-008-01, RN-CAD-008-02, RN-CAD-008-04, RN-CAD-008-05, RN-CAD-008-07, RN-CAD-008-11
## TESTES
CT-001: Criar completo | CT-002: S√≥ obrigat√≥rios | CT-003: Dept inativo ‚Üí Erro

---

# UC02 - Criar Centro de Custo - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes
- Integra√ß√µes Externas

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite que usu√°rios autorizados criem novos centros de custo vinculados a uma filial, incluindo configura√ß√£o de percentual de rateio, flag de aceite de rateio autom√°tico, e c√≥digo hier√°rquico composto.
### Atores
- Prim√°rio: Administrador do Sistema, Controller, Gerente Financeiro
- Secund√°rio: Sistema de Auditoria, Sistema de Rateio, Sistema de Cache (Redis)
### Pr√©-condi√ß√µes
- Usu√°rio deve estar autenticado no sistema
- Usu√°rio deve ter permiss√£o hierarchy:cc:create
- Sistema deve estar online e conectado ao banco de dados
- Deve existir pelo menos uma filial cadastrada
- Filial selecionada deve estar ativa
- Multi-tenancy: Usu√°rio s√≥ pode criar CCs em filiais do seu conglomerado
### P√≥s-condi√ß√µes
Sucesso: 1. Novo centro de custo criado no banco de dados 2. C√≥digo hier√°rquico composto gerado (se configurado) 3. Percentual de rateio configurado 4. Log de auditoria registrado 5. Cache invalidado (Redis) 6. CC dispon√≠vel imediatamente para aloca√ß√£o de ativos e rateio de despesas
Falha: 1. Nenhuma altera√ß√£o no banco de dados (rollback) 2. Log de tentativa falha registrado 3. Mensagem de erro clara exibida ao usu√°rio 4. Dados preenchidos mantidos no formul√°rio para corre√ß√£o
### Requisitos N√£o-Funcionais
- Performance: Cria√ß√£o deve completar em < 2 segundos
- Seguran√ßa: Valida√ß√£o de percentual de rateio (0-100%)
- Usabilidade: Sugest√£o autom√°tica de c√≥digo hier√°rquico
- Auditoria: Todas as tentativas devem ser logadas
- Integridade: Valida√ß√£o de c√≥digo √∫nico por filial

## FLUXO PRINCIPAL
### FP01 - Criar Centro de Custo com Rateio Autom√°tico

## FLUXOS ALTERNATIVOS
### FA01 - Criar Centro de Custo sem Rateio Autom√°tico
Diverge no passo 14 do FP01
### FA02 - Criar Centro de Custo com Percentual de Rateio 0%
Diverge no passo 9 do FP01
### FA03 - Criar Centro de Custo com C√≥digo Hier√°rquico Autom√°tico
Diverge no passo 6 do FP01
### FA04 - Criar Centro de Custo com C√≥digo Manual (Sem Padr√£o Hier√°rquico)
Diverge no passo 6 do FP01
### FA05 - Duplicar Centro de Custo Existente
Diverge no passo 2 do FP01
### FA06 - Visualizar Simula√ß√£o de Rateio em Tempo Real
Pode ocorrer ap√≥s passo 9 do FP01

## FLUXOS DE EXCE√á√ÉO
### FE01 - C√≥digo J√° Cadastrado na Filial
Ocorre no passo 7 do FP01
### FE02 - Percentual de Rateio Inv√°lido (Fora do Range 0-100)
Ocorre no passo 9 do FP01
### FE03 - Soma de Rateios Excede 100% (Warning, N√£o Bloqueia)
Ocorre no passo 12 do FP01
### FE04 - Filial Inv√°lida ou Inativa
Ocorre no passo 3 do FP01
### FE05 - Erro de Conex√£o com Banco de Dados
Pode ocorrer no passo 20 do FP01
### FE06 - Campos Obrigat√≥rios N√£o Preenchidos
Ocorre no passo 16 do FP01
### FE07 - Tentativa de Criar CC em Filial Sem Permiss√£o
Ocorre no passo 3 do FP01

## REGRAS DE NEG√ìCIO
### RN-UC02-001: C√≥digo √önico por Filial (RN-CAD-003-03)
Descri√ß√£o: C√≥digo de Centro de Custo deve ser √∫nico dentro da filial.
Regra: - Constraint: UQ_Centro_Custo_Codigo_Filial UNIQUE (Codigo_Centro_Custo, Id_Filial) - Valida√ß√£o case-insensitive - Mesmo c√≥digo pode existir em filiais diferentes
Valida√ß√£o: Backend via FluentValidation + constraint no banco
Exemplo:
‚úÖ Filial SP: "CC-FINANCEIRO"
‚úÖ Filial RJ: "CC-FINANCEIRO" (mesma c√≥digo, filial diferente - OK)
‚ùå Filial SP: "CC-FINANCEIRO" (duplicado na mesma filial - ERRO)

### RN-UC02-002: Percentual de Rateio (RN-CAD-003-07)
Descri√ß√£o: Percentual de rateio deve estar entre 0 e 100.
Regra: - Percentual_Rateio deve estar entre 0 e 100 - Soma dos percentuais de rateio de uma filial N√ÉO precisa ser 100% (permite rateios parciais) - Se soma > 100%: exibe warning mas permite salvar - Se soma < 100%: rateio parcial (restante n√£o √© distribu√≠do)
Valida√ß√£o: Backend valida range (0-100)
Casos de Uso:
Filial Matriz:
- CC Financeiro: 30%
- CC TI: 25%
- CC RH: 20%
- CC Opera√ß√µes: 25%
Soma = 100% ‚úÖ

Filial Regional:
- CC Financeiro: 50%
- CC Opera√ß√µes: 40%
Soma = 90% ‚ö†Ô∏è (10% n√£o distribu√≠do)

Filial Pequena:
- CC Administrativo: 100%
Soma = 100% ‚úÖ

### RN-UC02-003: Flag Aceita Rateio (RN-CAD-003-07)
Descri√ß√£o: Centro de custo pode aceitar ou rejeitar rateio autom√°tico.
Regra: - Fl_Aceita_Rateio = 1: CC aceita rateio autom√°tico de despesas - Fl_Aceita_Rateio = 2: CC requer aloca√ß√£o manual (n√£o participa de rateios)
Comportamento: - Se Fl_Aceita_Rateio = 2: despesas devem ser alocadas manualmente - √ötil para CCs espec√≠ficos (projetos, investimentos, etc.)

### RN-UC02-004: C√≥digo Hier√°rquico Composto (RN-CAD-003-12)
Descri√ß√£o: C√≥digos de CCs devem seguir padr√£o hier√°rquico composto (best practice).
Padr√£o Recomendado:
{Codigo_Filial}-CC{Sequencial}

Exemplos:
FIL001-CC001
FIL001-CC002
FIL002-CC001
Benef√≠cios: - Facilita identifica√ß√£o visual da hierarquia - Simplifica debugging e troubleshooting - Melhora usabilidade em relat√≥rios
Implementa√ß√£o: - Sistema sugere c√≥digo automaticamente - Usu√°rio pode aceitar ou personalizar - N√£o √© obrigat√≥rio (opcional)

### RN-UC02-005: Hierarquia Imut√°vel (RN-CAD-003-11)
Descri√ß√£o: Uma vez criado, CC n√£o pode ser movido para outra filial.
Regra: - N√£o √© permitido alterar Id_Filial de um CC j√° criado - Impacto: Hist√≥rico de faturamento, rateios processados, ativos alocados
Exce√ß√£o: Super-admin pode realizar ‚Äúmigra√ß√£o de hierarquia‚Äù atrav√©s de processo controlado

### RN-UC02-006: Multi-Tenancy Obrigat√≥rio
Descri√ß√£o: Todo CC deve pertencer a uma filial do conglomerado do usu√°rio logado.
Regra: - Usu√°rio s√≥ pode criar CCs em filiais do pr√≥prio conglomerado - Filtro autom√°tico aplicado: filial.Empresa.IdHolding = usuarioLogado.IdHolding

### RN-UC02-007: Auditoria Completa (RN-CAD-003-10)
Descri√ß√£o: Todas as cria√ß√µes de CCs devem ser auditadas.
Regra:
{
  "acao": "Create",
  "entidade": "Centro_Custo",
  "entidadeId": "guid-do-cc",
  "usuario": "admin@sistema.com",
  "timestamp": "2025-11-06T14:30:00Z",
  "dadosAntes": null,
  "dadosDepois": {
    "codigo": "CC-FINANCEIRO",
    "descricao": "Centro de Custo Financeiro",
    "idFilial": "guid-filial",
    "percentualRateio": 25,
    "flAceitaRateio": true,
    "ativo": true
  }
}

### RN-UC02-008: Invalida√ß√£o de Cache
Descri√ß√£o: Ao criar CC, cache deve ser invalidado.
Chaves Invalidadas:
centros-custo:filial:{filialId}   - Lista de CCs da filial
filiais:empresa:{empresaId}        - Lista de filiais (afeta totalizadores)

### RN-UC02-009: Valida√ß√£o de Nome e C√≥digo
Descri√ß√£o: Campos possuem limites.
Regra: - C√≥digo: m√°ximo 20 caracteres alfanum√©ricos + h√≠fen - Descri√ß√£o: m√°ximo 50 caracteres

## MATRIZ DE PERMISS√ïES
### Permiss√µes Envolvidas
### Combina√ß√µes de Permiss√µes para Teste

## INTEGRA√á√ïES EXTERNAS
### 1. Sistema de Auditoria (RF-004)
Integra√ß√£o: Registrar cria√ß√£o de centro de custo

### 2. Sistema de Rateio (M√≥dulo de Faturamento)
Integra√ß√£o: Novo CC dispon√≠vel imediatamente para rateio de despesas
Comportamento: - Se Fl_Aceita_Rateio = 1: CC participa de pr√≥ximo rateio autom√°tico - Se Fl_Aceita_Rateio = 2: CC n√£o aparece em seletores de rateio autom√°tico

### 3. Central de Funcionalidades (RF-001)
Integra√ß√£o: Registrar uso da funcionalidade ‚ÄúCriar Centro de Custo‚Äù

### 4. Sistema de Cache (Redis)
Chaves Utilizadas:
centros-custo:filial:{guid}   - TTL 5 min
Invalida√ß√£o: Ao criar/editar/inativar CC

### 5. i18n (RF-005)
Chaves de Tradu√ß√£o Necess√°rias:
{
  "hierarchy.cc.create.title": "Novo Centro de Custo",
  "hierarchy.cc.create.filial": "Filial",
  "hierarchy.cc.create.codigo": "C√≥digo",
  "hierarchy.cc.create.descricao": "Descri√ß√£o",
  "hierarchy.cc.create.percentual_rateio": "Percentual de Rateio (%)",
  "hierarchy.cc.create.aceita_rateio": "Aceita Rateio Autom√°tico",
  "hierarchy.cc.create.status": "Status",
  "hierarchy.cc.create.success": "Centro de Custo criado com sucesso",
  "hierarchy.cc.create.error_codigo_duplicado": "C√≥digo j√° cadastrado",
  "hierarchy.cc.create.error_percentual_invalido": "Percentual deve estar entre 0% e 100%",
  "hierarchy.cc.create.warning_soma_rateio": "Soma de rateios: {soma}%",
  "hierarchy.cc.create.preview_rateio": "Simula√ß√£o de Rateio",
  "hierarchy.cc.create.codigo_sugerido": "C√≥digo sugerido: {codigo}"
}

## ESPECIFICA√á√ïES T√âCNICAS
### Endpoint Backend
POST /api/hierarquia/centros-custo
### Request Body
{
  "idFilial": "guid-filial-001",
  "codigo": "CC-FINANCEIRO",
  "descricao": "Centro de Custo Financeiro",
  "percentualRateio": 25,
  "flAceitaRateio": 1,
  "ativo": true
}
### Response (201 Created)
{
  "id": "guid-cc-001",
  "idFilial": "guid-filial-001",
  "codigo": "CC-FINANCEIRO",
  "descricao": "Centro de Custo Financeiro",
  "percentualRateio": 25,
  "flAceitaRateio": true,
  "ativo": true,
  "dtCadastro": "2025-11-06T10:30:00Z",
  "somaRateiosFilial": 100
}

Pr√≥ximos UCs: - UC03 - Criar Departamento - UC04 - Criar Setor - UC05 - Criar Se√ß√£o - UC06 - Visualizar √Årvore Hier√°rquica
Aprovado por: Anderson Chipak Revisado por: Claude Code Assistant Data: 2025-11-06

---

# UC02 - Visualizar Centro de Custo
Vers√£o: 1.0 | Data: 06/11/2025
## INFORMA√á√ïES GERAIS
Descri√ß√£o: Exibir detalhes completos de um centro de custo. Atores: Todos os usu√°rios autenticados Pr√©-condi√ß√µes: Permiss√£o CAD.CENTROCUSTO.READ P√≥s-condi√ß√µes: Detalhes exibidos
## FLUXO PRINCIPAL
- Usu√°rio clica em centro de custo na lista
- Sistema carrega detalhes completos
- Exibe: c√≥digo, nome, descri√ß√£o, filial, gestor, budget, status, datas, departamentos filhos
- Mostra hist√≥rico de altera√ß√µes
- Mostra lista de departamentos subordinados
## FLUXOS ALTERNATIVOS
FA01: Visualizar Departamentos - Clica ‚ÄúVer Departamentos‚Äù ‚Üí lista departamentos do CC
## FLUXOS DE EXCE√á√ÉO
FE01: Sem Permiss√£o - Acesso negado FE02: Registro N√£o Encontrado - ‚ÄúCentro de custo n√£o existe‚Äù FE03: Registro de Outro Conglomerado - ‚ÄúAcesso negado‚Äù (multi-tenancy)
## REGRAS DE NEG√ìCIO
- RN-CAD-008-09: Multi-tenancy
- RN-CAD-008-10: Hist√≥rico de auditoria dispon√≠vel
## CASOS DE TESTE
CT-001: Visualizar com Sucesso CT-002: Visualizar Hist√≥rico de Altera√ß√µes CT-003: Visualizar Departamentos Subordinados CT-004: Sem Permiss√£o CT-005: Registro Inexistente

---

# UC02 - Visualizar Departamento
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Exibir detalhes de departamento Pr√©: CAD.DEPARTAMENTO.READ P√≥s: Detalhes exibidos
## FLUXO
- Clica em departamento
- Exibe: c√≥digo, nome, descri√ß√£o, CC pai, gerente, budget, status, setores filhos, hist√≥rico
## EXCE√á√ïES
FE01: Sem permiss√£o | FE02: Registro inexistente | FE03: Outro conglomerado
## TESTES
CT-001: Visualizar | CT-002: Ver hist√≥rico | CT-003: Ver setores subordinados

---

# UC02 - Visualizar Se√ß√£o
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Exibir detalhes de se√ß√£o Pr√©: CAD.SECAO.READ
## FLUXO
Exibe: c√≥digo, nome, descri√ß√£o, setor pai, coordenador, budget, status, hist√≥rico
## TESTES
CT-001: Visualizar | CT-002: Ver hist√≥rico

---

# UC02 - Visualizar Setor
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Exibir detalhes de setor Pr√©: CAD.SETOR.READ
## FLUXO
Exibe: c√≥digo, nome, descri√ß√£o, departamento pai, supervisor, budget, status, se√ß√µes filhas, hist√≥rico
## TESTES
CT-001: Visualizar | CT-002: Ver se√ß√µes subordinadas

---

# UC03 - Criar Departamento - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite que usu√°rios autorizados criem novos departamentos vinculados a um centro de custo, incluindo atribui√ß√£o de respons√°vel e valida√ß√£o de habilita√ß√£o do n√≠vel na filial.
### Atores
- Prim√°rio: Administrador do Sistema, Gerente de RH
- Secund√°rio: Sistema de Auditoria, Sistema de Notifica√ß√µes, Sistema de Cache
### Pr√©-condi√ß√µes
- Usu√°rio deve estar autenticado
- Usu√°rio deve ter permiss√£o hierarchy:departamento:create
- Deve existir pelo menos um centro de custo cadastrado
- Centro de custo deve estar ativo
- Filial deve ter Departamento habilitado (Hi_Departamento = 1)
### P√≥s-condi√ß√µes
Sucesso: 1. Novo departamento criado no banco 2. Respons√°vel atribu√≠do (se informado) 3. Notifica√ß√£o enviada ao respons√°vel 4. Log de auditoria registrado 5. Cache invalidado

## FLUXO PRINCIPAL
### FP01 - Criar Departamento com Respons√°vel

## FLUXOS ALTERNATIVOS
### FA01 - Criar Departamento sem Respons√°vel
Diverge no passo 8 do FP01
### FA02 - Usar Template de Departamento Comum
Diverge no passo 2 do FP01
### FA03 - Copiar Estrutura de Outro Departamento
Diverge no passo 2 do FP01

## FLUXOS DE EXCE√á√ÉO
### FE01 - Departamento Desabilitado na Filial
Ocorre no passo 4 do FP01
### FE02 - Nome Duplicado no Centro de Custo
Ocorre no passo 7 do FP01
### FE03 - Respons√°vel Inv√°lido ou Inativo
Ocorre no passo 10 do FP01

## REGRAS DE NEG√ìCIO
### RN-UC03-001: Valida√ß√£o de Habilita√ß√£o na Filial (RN-CAD-003-16)
Descri√ß√£o: Departamento s√≥ pode ser criado se habilitado na filial.
Regra: - Verificar Filial.Hi_Departamento = 1 antes de permitir cria√ß√£o - Se Hi_Departamento = 2: bloquear cria√ß√£o com mensagem clara

### RN-UC03-002: Nome √önico por Centro de Custo
Descri√ß√£o: Nome do departamento deve ser √∫nico dentro do CC.
Regra: - Constraint: UNIQUE (Nm_Departamento, Id_Centro_Custo) - Mesmo nome pode existir em CCs diferentes

### RN-UC03-003: Respons√°vel Opcional (RN-CAD-003-08)
Descri√ß√£o: Departamento pode ter um respons√°vel.
Regra: - Id_Responsavel √© opcional (pode ser NULL) - Se informado, deve apontar para Consumidor ativo - Respons√°vel recebe notifica√ß√µes de eventos do departamento - Um consumidor pode ser respons√°vel por m√∫ltiplos departamentos

### RN-UC03-004: Hierarquia Imut√°vel (RN-CAD-003-11)
Descri√ß√£o: Departamento n√£o pode ser movido para outro CC ap√≥s cria√ß√£o.
Regra: - N√£o permitir alterar Id_Centro_Custo de um departamento existente

### RN-UC03-005: Notifica√ß√£o ao Respons√°vel
Descri√ß√£o: Ao atribuir respons√°vel, enviar notifica√ß√£o.
Conte√∫do:
Assunto: Voc√™ foi designado respons√°vel do departamento [Nome]
Corpo:
- Departamento: [Nome]
- Centro de Custo: [CC]
- Filial: [Filial]
- Permiss√µes: [Lista]

## MATRIZ DE PERMISS√ïES

## INTEGRA√á√ïES
### 1. Sistema de Notifica√ß√µes
- Enviar email ao respons√°vel atribu√≠do
### 2. Sistema de Auditoria (RF-004)
- Registrar cria√ß√£o do departamento
### 3. i18n (RF-005)
Chaves:
{
  "hierarchy.departamento.create.title": "Novo Departamento",
  "hierarchy.departamento.create.cc": "Centro de Custo",
  "hierarchy.departamento.create.nome": "Nome do Departamento",
  "hierarchy.departamento.create.responsavel": "Respons√°vel",
  "hierarchy.departamento.create.email": "Email do Departamento",
  "hierarchy.departamento.create.error_desabilitado": "Departamentos desabilitados nesta filial",
  "hierarchy.departamento.create.success": "Departamento criado com sucesso"
}

Endpoint: POST /api/hierarquia/departamentos
Request:
{
  "idCentroCusto": "guid-cc-001",
  "nome": "Departamento de Contabilidade",
  "idResponsavel": "guid-consumidor-001",
  "email": "contabilidade@empresa.com",
  "ativo": true
}
Response (201):
{
  "id": "guid-depto-001",
  "idCentroCusto": "guid-cc-001",
  "nome": "Departamento de Contabilidade",
  "responsavel": {
    "id": "guid-consumidor-001",
    "nome": "Jo√£o Silva"
  },
  "email": "contabilidade@empresa.com",
  "ativo": true,
  "dtCadastro": "2025-11-06T10:30:00Z"
}

Aprovado por: Anderson Chipak Data: 2025-11-06

---

# UC03 - Editar Centro de Custo
Vers√£o: 1.0 | Data: 06/11/2025
## INFORMA√á√ïES GERAIS
Descri√ß√£o: Alterar dados de centro de custo existente. Atores: Administrador, Gestor Pr√©-condi√ß√µes: Permiss√£o CAD.CENTROCUSTO.UPDATE, centro de custo existe P√≥s-condi√ß√µes: Dados atualizados, auditoria registrada
## FLUXO PRINCIPAL
- Usu√°rio clica ‚ÄúEditar‚Äù em centro de custo
- Sistema carrega formul√°rio com dados atuais
- Usu√°rio altera nome, descri√ß√£o, gestor, budget ou status
- Sistema valida altera√ß√µes
- Salva no BD com Dt_Atualizacao = NOW()
- Registra auditoria (UPDATE) com dados_anteriores e dados_novos JSON
- Toast ‚ÄúCentro de custo atualizado‚Äù
- Retorna √† visualiza√ß√£o
## FLUXOS ALTERNATIVOS
FA01: Alterar Apenas Nome - Outros campos mantidos FA02: Trocar Gestor - Valida novo gestor ativo
## FLUXOS DE EXCE√á√ÉO
FE01: C√≥digo Duplicado (se alterado) - ‚ÄúC√≥digo j√° existe‚Äù FE02: Alterar C√≥digo com Hist√≥rico - ‚ÄúN√£o pode alterar c√≥digo com movimenta√ß√µes‚Äù (RN-CAD-008-08) FE03: Nome Vazio - ‚ÄúNome obrigat√≥rio‚Äù FE04: Budget Negativo - ‚ÄúBudget deve ser > 0‚Äù FE05: Concorr√™ncia - Outro usu√°rio editou simultaneamente ‚Üí ‚ÄúDados foram alterados, recarregue‚Äù
## REGRAS DE NEG√ìCIO
- RN-CAD-008-01: C√≥digo √∫nico
- RN-CAD-008-07: UPPER_SNAKE_CASE
- RN-CAD-008-08: N√£o alterar c√≥digo com hist√≥rico
- RN-CAD-008-10: Auditoria UPDATE
- RN-CAD-008-11: Nome obrigat√≥rio
## CASOS DE TESTE
CT-001: Editar Nome com Sucesso CT-002: Editar Budget CT-003: Trocar Gestor CT-004: Tentar Alterar C√≥digo (com hist√≥rico) - Erro CT-005: Nome Vazio - Erro CT-006: Auditoria UPDATE Registrada

---

# UC03 - Editar Departamento
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Alterar departamento Pr√©: CAD.DEPARTAMENTO.UPDATE P√≥s: Dados atualizados, auditoria UPDATE
## FLUXO
- Clica ‚ÄúEditar‚Äù
- Altera nome, descri√ß√£o, gerente, budget, status
- Valida e salva
- Auditoria UPDATE com JSON antes/depois
## EXCE√á√ïES
FE01: C√≥digo duplicado (se alterado) FE02: Alterar c√≥digo com hist√≥rico ‚Üí Bloqueado (RN-CAD-008-08) FE03: Nome vazio ‚Üí Erro
## REGRAS
- RN-CAD-008-08: N√£o alterar c√≥digo com hist√≥rico
- RN-CAD-008-10: Auditoria UPDATE
## TESTES
CT-001: Editar nome | CT-002: Trocar gerente | CT-003: C√≥digo com hist√≥rico ‚Üí Erro

---

# UC03 - Editar Se√ß√£o
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Alterar se√ß√£o Pr√©: CAD.SECAO.UPDATE P√≥s: Auditoria UPDATE
## FLUXO
- Editar ‚Üí Altera nome, descri√ß√£o, coordenador, budget, status
- Salva ‚Üí Auditoria UPDATE
## EXCE√á√ïES
FE01: C√≥digo com hist√≥rico ‚Üí Bloqueado (RN-CAD-008-08)
## TESTES
CT-001: Editar nome | CT-002: Trocar coordenador

---

# UC03 - Editar Setor
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Alterar setor Pr√©: CAD.SETOR.UPDATE P√≥s: Auditoria UPDATE
## FLUXO
- Editar ‚Üí Altera nome, descri√ß√£o, supervisor, budget, status
- Salva ‚Üí Auditoria UPDATE
## EXCE√á√ïES
FE01: C√≥digo com hist√≥rico ‚Üí Bloqueado (RN-CAD-008-08)
## TESTES
CT-001: Editar nome | CT-002: Trocar supervisor

---

# UC04 - Criar Setor - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite criar novos setores vinculados a um departamento, com valida√ß√£o de habilita√ß√£o do n√≠vel na filial e atribui√ß√£o de respons√°vel.
### Atores
- Prim√°rio: Administrador, Gerente de RH
- Secund√°rio: Sistema de Auditoria, Sistema de Notifica√ß√µes
### Pr√©-condi√ß√µes
- Usu√°rio autenticado
- Permiss√£o hierarchy:setor:create
- Departamento deve existir e estar ativo
- Filial deve ter Setor habilitado (Hi_Setor = 1)
- Departamento deve estar habilitado (valida√ß√£o hier√°rquica)
### P√≥s-condi√ß√µes
Sucesso: 1. Novo setor criado 2. Respons√°vel atribu√≠do (se informado) 3. Notifica√ß√£o enviada 4. Log de auditoria 5. Cache invalidado

## FLUXO PRINCIPAL
### FP01 - Criar Setor com Respons√°vel

## FLUXOS ALTERNATIVOS
### FA01 - Criar Setor sem Respons√°vel
- Passo 8a: Deixa respons√°vel vazio
- Sistema aceita (opcional)
### FA02 - Usar Template de Setor Comum
- Templates: Contas a Pagar, Contas a Receber, Faturamento
### FA03 - Duplicar Setor Existente
- Copia: Permiss√µes, Respons√°vel

## FLUXOS DE EXCE√á√ÉO
### FE01 - Setor Desabilitado na Filial
Ocorre no passo 4
### FE02 - Departamento Tamb√©m Desabilitado
Ocorre no passo 4
### FE03 - Nome Duplicado no Departamento
Ocorre no passo 7

## REGRAS DE NEG√ìCIO
### RN-UC04-001: Valida√ß√£o de Habilita√ß√£o (RN-CAD-003-16)
Regra: - Verificar Filial.Hi_Setor = 1 - Verificar Filial.Hi_Departamento = 1 (hierarquia) - Se Setor habilitado mas Departamento desabilitado: erro

### RN-UC04-002: Nome √önico por Departamento
Regra: - Constraint: UNIQUE (Nm_Setor, Id_Departamento)

### RN-UC04-003: Respons√°vel Opcional (RN-CAD-003-08)
Regra: - Mesmo comportamento do Departamento

### RN-UC04-004: Hierarquia Imut√°vel (RN-CAD-003-11)
Regra: - N√£o permitir alterar Id_Departamento ap√≥s cria√ß√£o

### RN-UC04-005: Estat√≠sticas Contextuais
Descri√ß√£o: Exibir estat√≠sticas do setor ap√≥s cria√ß√£o.
M√©tricas: - Quantas se√ß√µes - Quantos consumidores - Total de ativos vinculados - Despesas (√∫ltimos 3 meses)

## MATRIZ DE PERMISS√ïES

## INTEGRA√á√ïES
### 1. Sistema de Notifica√ß√µes
- Email ao respons√°vel
### 2. Sistema de Auditoria (RF-004)
- Log de cria√ß√£o
### 3. i18n (RF-005)
Chaves:
{
  "hierarchy.setor.create.title": "Novo Setor",
  "hierarchy.setor.create.departamento": "Departamento",
  "hierarchy.setor.create.nome": "Nome do Setor",
  "hierarchy.setor.create.responsavel": "Respons√°vel",
  "hierarchy.setor.create.error_desabilitado": "Setores desabilitados nesta filial",
  "hierarchy.setor.create.error_depto_desabilitado": "Departamentos tamb√©m desabilitados",
  "hierarchy.setor.create.success": "Setor criado com sucesso"
}

Endpoint: POST /api/hierarquia/setores
Request:
{
  "idDepartamento": "guid-depto-001",
  "nome": "Setor de Recrutamento",
  "idResponsavel": "guid-consumidor-001",
  "ativo": true
}
Response (201):
{
  "id": "guid-setor-001",
  "idDepartamento": "guid-depto-001",
  "nome": "Setor de Recrutamento",
  "responsavel": {
    "id": "guid-consumidor-001",
    "nome": "Maria Santos"
  },
  "qtdSecoes": 0,
  "qtdConsumidores": 0,
  "ativo": true,
  "dtCadastro": "2025-11-06T10:30:00Z"
}

Aprovado por: Anderson Chipak Data: 2025-11-06

---

# UC04 - Inativar Centro de Custo
Vers√£o: 1.0 | Data: 06/11/2025
## INFORMA√á√ïES GERAIS
Descri√ß√£o: Inativar centro de custo (exclus√£o l√≥gica). Atores: Administrador Pr√©-condi√ß√µes: Permiss√£o CAD.CENTROCUSTO.DELETE, centro de custo existe e est√° ativo P√≥s-condi√ß√µes: Fl_Ativo = 2 (Inativo), auditoria registrada
## FLUXO PRINCIPAL
- Usu√°rio clica ‚ÄúInativar‚Äù em centro de custo
- Sistema valida se tem departamentos ativos (RN-CAD-008-03)
- Se n√£o tem filhos ativos: confirma ‚ÄúDeseja inativar?‚Äù
- Usu√°rio confirma
- Sistema: Fl_Ativo = 2, Dt_Atualizacao = NOW()
- Registra auditoria (UPDATE)
- Toast ‚ÄúCentro de custo inativado‚Äù
- Remove da lista de ativos
## FLUXOS ALTERNATIVOS
FA01: Inativar em Cascata (Opcional) - Sistema pergunta ‚ÄúInativar departamentos filhos tamb√©m?‚Äù - Se SIM: inativa todos departamentos, setores e se√ß√µes subordinados - Registra auditoria para cada entidade (RN-CAD-008-12)
## FLUXOS DE EXCE√á√ÉO
FE01: Tem Departamentos Ativos - Sistema detecta departamentos ativos vinculados - Erro: ‚ÄúN√£o pode inativar. Existem X departamentos ativos subordinados‚Äù - Lista departamentos ativos - Bot√£o ‚ÄúInativar Tudo em Cascata‚Äù (se tiver permiss√£o)
FE02: Centro de Custo J√° Inativo - Fl_Ativo j√° √© 2 - Mensagem: ‚ÄúCentro de custo j√° est√° inativo‚Äù
FE03: Sem Permiss√£o - Usu√°rio sem CAD.CENTROCUSTO.DELETE - Bot√£o ‚ÄúInativar‚Äù n√£o aparece
## REGRAS DE NEG√ìCIO
- RN-CAD-008-03: N√£o inativar com filhos ativos
- RN-CAD-008-10: Auditoria completa
- RN-CAD-008-12: Inativa√ß√£o em cascata (opcional)
## CASOS DE TESTE
CT-001: Inativar Sem Departamentos - Sucesso CT-002: Tentar Inativar com Departamentos Ativos - Erro bloqueado CT-003: Inativar em Cascata - Todos subordinados inativados CT-004: Centro de Custo J√° Inativo - Mensagem informativa CT-005: Auditoria Registrada (UPDATE para inativa√ß√£o) CT-006: Reativar Centro de Custo (Fl_Ativo = 1)

---

# UC04 - Inativar Departamento
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Inativar departamento (exclus√£o l√≥gica) Pr√©: CAD.DEPARTAMENTO.DELETE P√≥s: Fl_Ativo = 2
## FLUXO
- Clica ‚ÄúInativar‚Äù
- Sistema valida se tem setores ativos (RN-CAD-008-03)
- Confirma
- Fl_Ativo = 2, auditoria UPDATE
## ALTERNATIVO
FA01: Inativar em Cascata ‚Üí Inativa setores e se√ß√µes subordinados
## EXCE√á√ïES
FE01: Tem setores ativos ‚Üí Erro ‚ÄúExistem X setores ativos‚Äù FE02: J√° inativo ‚Üí ‚ÄúJ√° est√° inativo‚Äù
## REGRAS
- RN-CAD-008-03: N√£o inativar com filhos ativos
- RN-CAD-008-12: Cascata opcional
## TESTES
CT-001: Inativar sem setores | CT-002: Com setores ativos ‚Üí Erro | CT-003: Cascata

---

# UC04 - Inativar Se√ß√£o
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Inativar se√ß√£o (√∫ltimo n√≠vel da hierarquia) Pr√©: CAD.SECAO.DELETE P√≥s: Fl_Ativo = 2
## FLUXO
- Inativar ‚Üí Confirma (n√£o tem filhos, √© √∫ltimo n√≠vel)
- Fl_Ativo = 2, auditoria UPDATE
## EXCE√á√ïES
FE01: J√° inativa
## OBSERVA√á√ÉO
Se√ß√£o √© o √∫ltimo n√≠vel, n√£o tem subordinados, ent√£o RN-CAD-008-03 n√£o se aplica aqui.
## TESTES
CT-001: Inativar se√ß√£o ativa | CT-002: J√° inativa ‚Üí Mensagem

---

# UC04 - Inativar Setor
V1.0 | 06/11/2025
## INFO
Descri√ß√£o: Inativar setor Pr√©: CAD.SETOR.DELETE P√≥s: Fl_Ativo = 2
## FLUXO
- Inativar ‚Üí Valida se√ß√µes ativas (RN-CAD-008-03)
- Confirma ‚Üí Fl_Ativo = 2
## ALTERNATIVO
FA01: Cascata ‚Üí Inativa se√ß√µes
## EXCE√á√ïES
FE01: Tem se√ß√µes ativas ‚Üí Erro
## TESTES
CT-001: Inativar | CT-002: Com se√ß√µes ativas ‚Üí Erro | CT-003: Cascata

---

# UC05 - Criar Se√ß√£o - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite criar novas se√ß√µes (7¬∫ e √∫ltimo n√≠vel hier√°rquico) vinculadas a um setor, com valida√ß√£o completa da cadeia hier√°rquica e configura√ß√£o de localiza√ß√£o f√≠sica.
### Atores
- Prim√°rio: Administrador, Gerente de RH
- Secund√°rio: Sistema de Auditoria, Sistema de Notifica√ß√µes
### Pr√©-condi√ß√µes
- Usu√°rio autenticado
- Permiss√£o hierarchy:secao:create
- Setor deve existir e estar ativo
- Filial deve ter Se√ß√£o habilitada (Hi_Secao = 1)
- Setor E Departamento devem estar habilitados (valida√ß√£o hier√°rquica completa)
### P√≥s-condi√ß√µes
Sucesso: 1. Nova se√ß√£o criada (√∫ltimo n√≠vel da hierarquia) 2. Respons√°vel direto atribu√≠do 3. Localiza√ß√£o f√≠sica configurada 4. Notifica√ß√£o enviada 5. Log de auditoria 6. Cache invalidado

## FLUXO PRINCIPAL
### FP01 - Criar Se√ß√£o com Localiza√ß√£o F√≠sica

## FLUXOS ALTERNATIVOS
### FA01 - Criar Se√ß√£o sem Localiza√ß√£o F√≠sica
- Campos de localiza√ß√£o opcionais
- √ötil para se√ß√µes virtuais/remotas
### FA02 - Criar Se√ß√£o com Hor√°rio de Trabalho Diferenciado
- Configurar hor√°rio: 08:00-18:00, Escala, Plant√£o
### FA03 - Usar Nome Sugerido
- Sistema sugere: ‚Äú{Nome_Setor} - Equipe {Seq}‚Äù
- Ex: ‚ÄúRecrutamento - Equipe 1‚Äù

## FLUXOS DE EXCE√á√ÉO
### FE01 - Se√ß√£o Desabilitada na Filial
Ocorre no passo 4
### FE02 - Valida√ß√£o de Cadeia Hier√°rquica Completa
Ocorre no passo 4
### FE03 - Nome Duplicado no Setor
Ocorre no passo 7
### FE04 - Se√ß√£o Ficar Vazia por Muito Tempo
Ocorre ap√≥s cria√ß√£o (job noturno)

## REGRAS DE NEG√ìCIO
### RN-UC05-001: Valida√ß√£o de Cadeia Hier√°rquica Completa (RN-CAD-003-16)
Descri√ß√£o: Para criar Se√ß√£o, TODOS os n√≠veis superiores devem estar habilitados.
Regra:
Para criar Se√ß√£o:
‚úÖ Filial.Hi_Departamento = 1 (habilitado)
‚úÖ Filial.Hi_Setor = 1 (habilitado)
‚úÖ Filial.Hi_Secao = 1 (habilitado)

Cen√°rios Inv√°lidos:
‚ùå Hi_Secao=1 mas Hi_Setor=2 (Se√ß√£o habilitada mas Setor desabilitado)
‚ùå Hi_Secao=1 mas Hi_Departamento=2 (Se√ß√£o habilitada mas Depto desabilitado)
Valida√ß√£o: Backend valida cadeia completa antes de permitir cria√ß√£o

### RN-UC05-002: Nome √önico por Setor
Regra: - Constraint: UNIQUE (Nm_Secao, Id_Setor)

### RN-UC05-003: Respons√°vel Direto (RN-CAD-003-08)
Descri√ß√£o: Se√ß√£o possui ‚ÄúRespons√°vel Direto‚Äù (gestor imediato).
Regra: - Respons√°vel de Se√ß√£o geralmente √© diferente do respons√°vel do Setor - Respons√°vel Direto: supervisiona dia a dia da equipe - Respons√°vel do Setor: gerencia m√∫ltiplas se√ß√µes

### RN-UC05-004: √öltimo N√≠vel da Hierarquia (RN-CAD-003-15)
Descri√ß√£o: Se√ß√£o √© o 7¬∫ e √∫ltimo n√≠vel. N√£o h√° sub-n√≠veis.
Regra: - N√£o √© poss√≠vel criar sub-se√ß√µes - Consumidores s√£o alocados diretamente em Se√ß√µes

### RN-UC05-005: Localiza√ß√£o F√≠sica Opcional
Descri√ß√£o: Se√ß√£o pode ter localiza√ß√£o f√≠sica configurada.
Campos: - Andar (ex: ‚Äú5¬∫‚Äù, ‚ÄúT√©rreo‚Äù) - Sala/N√∫mero (ex: ‚Äú505‚Äù, ‚ÄúSala A‚Äù) - Ramal telef√¥nico - Tags customizadas (ex: ‚ÄúPlant√£o‚Äù, ‚ÄúTempor√°rio‚Äù)

### RN-UC05-006: Alerta de Se√ß√£o Vazia
Descri√ß√£o: Se√ß√£o sem consumidores por > 90 dias deve ser alertada.
Regra: - Job noturno identifica se√ß√µes com 0 consumidores - Notifica respons√°vel - Sugest√£o: Desativar ou alocar colaboradores

### RN-UC05-007: Hierarquia Imut√°vel (RN-CAD-003-11)
Regra: - N√£o permitir alterar Id_Setor ap√≥s cria√ß√£o

## MATRIZ DE PERMISS√ïES

## INTEGRA√á√ïES
### 1. Sistema de Notifica√ß√µes
- Email ao respons√°vel direto
### 2. Sistema de Auditoria (RF-004)
- Log de cria√ß√£o
### 3. i18n (RF-005)
Chaves:
{
  "hierarchy.secao.create.title": "Nova Se√ß√£o",
  "hierarchy.secao.create.setor": "Setor",
  "hierarchy.secao.create.nome": "Nome da Se√ß√£o",
  "hierarchy.secao.create.responsavel_direto": "Respons√°vel Direto (Gestor Imediato)",
  "hierarchy.secao.create.localizacao": "Localiza√ß√£o F√≠sica",
  "hierarchy.secao.create.andar": "Andar",
  "hierarchy.secao.create.sala": "Sala/N√∫mero",
  "hierarchy.secao.create.ramal": "Ramal",
  "hierarchy.secao.create.tags": "Tags",
  "hierarchy.secao.create.error_desabilitado": "Se√ß√µes desabilitadas nesta filial",
  "hierarchy.secao.create.error_cadeia_invalida": "Cadeia hier√°rquica inv√°lida. Verifique Departamento e Setor",
  "hierarchy.secao.create.success": "Se√ß√£o criada com sucesso",
  "hierarchy.secao.create.ultimo_nivel": "Se√ß√£o √© o √∫ltimo n√≠vel da hierarquia"
}

Endpoint: POST /api/hierarquia/secoes
Request:
{
  "idSetor": "guid-setor-001",
  "nome": "Se√ß√£o Entrevistas",
  "idResponsavelDireto": "guid-consumidor-001",
  "localizacao": {
    "andar": "5¬∫",
    "sala": "505",
    "ramal": "5505"
  },
  "tags": ["Plant√£o", "Tempor√°rio"],
  "ativo": true
}
Response (201):
{
  "id": "guid-secao-001",
  "idSetor": "guid-setor-001",
  "nome": "Se√ß√£o Entrevistas",
  "responsavelDireto": {
    "id": "guid-consumidor-001",
    "nome": "Carlos Pereira"
  },
  "localizacao": {
    "andar": "5¬∫",
    "sala": "505",
    "ramal": "5505"
  },
  "tags": ["Plant√£o", "Tempor√°rio"],
  "qtdConsumidores": 0,
  "ativo": true,
  "dtCadastro": "2025-11-06T10:30:00Z"
}

Aprovado por: Anderson Chipak Data: 2025-11-06

---

# UC06 - Visualizar √Årvore Hier√°rquica - Especifica√ß√£o Completa
Vers√£o: 1.0 Data: 2025-11-06 Status: Documentado ‚úÖ RF: RF-063 - Hierarquia Corporativa

## üìã SUM√ÅRIO
- Informa√ß√µes Gerais
- Fluxo Principal
- Fluxos Alternativos
- Fluxos de Exce√ß√£o
- Regras de Neg√≥cio
- Matriz de Permiss√µes
- Especifica√ß√µes T√©cnicas

## INFORMA√á√ïES GERAIS
### Descri√ß√£o
Permite que usu√°rios autorizados visualizem a hierarquia corporativa completa em formato de √°rvore expans√≠vel (TreeView), com navega√ß√£o interativa, drill-down por n√≠veis, e exporta√ß√£o para PNG/PDF.
### Atores
- Prim√°rio: Todos os usu√°rios autenticados
- Secund√°rio: Sistema de Cache (Redis), Sistema de Auditoria
### Pr√©-condi√ß√µes
- Usu√°rio deve estar autenticado
- Usu√°rio deve ter permiss√£o hierarchy:view-tree
- Sistema deve estar online
- Multi-tenancy: Exibir apenas hierarquia do conglomerado do usu√°rio
### P√≥s-condi√ß√µes
Sucesso: 1. √Årvore hier√°rquica exibida com todos os 7 n√≠veis 2. Navega√ß√£o interativa funcionando (expandir/colapsar) 3. Totalizadores atualizados 4. Cache atualizado (Redis - 10 minutos) 5. Exporta√ß√£o gerada (se solicitada)
Falha: 1. Mensagem de erro amig√°vel 2. Log de erro registrado
### Requisitos N√£o-Funcionais
- Performance: Carregar √°rvore completa em < 2 segundos para at√© 5.000 n√≥s
- Cache: Redis com TTL de 10 minutos
- Lazy Loading: Carregar n√≠veis sob demanda ao expandir n√≥s
- Responsividade: √Årvore deve funcionar em desktop e tablet
- Seguran√ßa: Filtro autom√°tico por conglomerado

## FLUXO PRINCIPAL
### FP01 - Visualizar √Årvore Hier√°rquica Completa

## FLUXOS ALTERNATIVOS
### FA01 - Buscar N√≥ na √Årvore
Pode ocorrer em qualquer passo ap√≥s 6
### FA02 - Filtrar por Status (Ativo/Inativo)
Pode ocorrer em qualquer passo ap√≥s 6
### FA03 - Expandir Todos os N√≠veis
Pode ocorrer em qualquer passo ap√≥s 6
### FA04 - Colapsar Todos os N√≠veis
Pode ocorrer em qualquer passo ap√≥s expans√£o
### FA05 - Exportar √Årvore para PNG
Pode ocorrer em qualquer passo ap√≥s 6
### FA06 - Exportar √Årvore para PDF
Pode ocorrer em qualquer passo ap√≥s 6
### FA07 - Visualizar Organograma Visual
Pode ocorrer em qualquer passo ap√≥s 6
### FA08 - Drill-Down em N√≥ Espec√≠fico
Pode ocorrer em qualquer passo ap√≥s 6

## FLUXOS DE EXCE√á√ÉO
### FE01 - Nenhuma Hierarquia Encontrada
Ocorre no passo 4 do FP01
### FE02 - Erro ao Carregar N√≠vel (Lazy Loading Falha)
Pode ocorrer em passos 11, 14, 16
### FE03 - Cache Indispon√≠vel (Redis Offline)
Pode ocorrer no passo 3 do FP01
### FE04 - Timeout ao Expandir Tudo (√Årvore Muito Grande)
Ocorre no FA03
### FE05 - N√≠vel Hier√°rquico Desabilitado
Ocorre no passo 17 do FP01

## REGRAS DE NEG√ìCIO
### RN-UC06-001: Multi-Tenancy Obrigat√≥rio
Descri√ß√£o: √Årvore exibe apenas hierarquia do conglomerado do usu√°rio logado.
Regra: - Filtro global: WHERE Id_Conglomerado = [usuario.IdConglomerado] - N√£o √© poss√≠vel visualizar dados de outro conglomerado

### RN-UC06-002: Lazy Loading por N√≠vel
Descri√ß√£o: N√≠veis hier√°rquicos s√£o carregados sob demanda.
Regra: - Carga inicial: Apenas 1¬∫ n√≠vel (Empresas) - Ao expandir n√≥: Carrega filhos daquele n√≥ - Reduz carga inicial (performance)
Exce√ß√£o: Bot√£o ‚ÄúExpandir Tudo‚Äù carrega toda a √°rvore de uma vez

### RN-UC06-003: Cache por Conglomerado
Descri√ß√£o: √Årvore completa √© cacheada no Redis.
Chave de Cache:
arvore-hierarquia:{conglomeradoId}
TTL: 10 minutos
Invalida√ß√£o: - Ao criar/editar/inativar qualquer n√≠vel hier√°rquico - Ao alterar configura√ß√µes de n√≠veis habilitados (Hi_Departamento, etc.)

### RN-UC06-004: √çcones e Cores por N√≠vel
Descri√ß√£o: Cada n√≠vel possui √≠cone e cor espec√≠ficos.
Legenda:
Empresa:          üè¢ Azul escuro
Filial:           üè¨ Azul
Centro de Custo:  üí∞ Verde
Departamento:     üë• Laranja
Setor:            üìÇ Roxo
Se√ß√£o:            üìÑ Cinza

Status:
Ativo:    Badge verde
Inativo:  Badge cinza
Sem Respons√°vel: √çcone amarelo ‚ö†Ô∏è

### RN-UC06-005: Totalizadores Contextuais
Descri√ß√£o: Cada n√≥ exibe totalizadores relevantes.
Totalizadores por N√≠vel:
Empresa:          Total de Filiais, Total de Colaboradores
Filial:           Total de CCs, Total de Colaboradores
Centro de Custo:  Total de Departamentos, % Rateio
Departamento:     Total de Setores, Total de Colaboradores
Setor:            Total de Se√ß√µes, Total de Colaboradores
Se√ß√£o:            Total de Colaboradores, Localiza√ß√£o F√≠sica

### RN-UC06-006: Breadcrumb Naveg√°vel
Descri√ß√£o: Breadcrumb exibe caminho completo at√© n√≥ atual.
Formato:
In√≠cio > Empresa Vale > Filial Matriz SP > CC Financeiro > Depto Contabilidade
Clic√°vel: Cada n√≠vel do breadcrumb √© clic√°vel para drill-down

### RN-UC06-007: Menu Contextual por N√≥
Descri√ß√£o: Clique direito em n√≥ exibe menu contextual.
Op√ß√µes do Menu: - Ver Detalhes (modal com info completa) - Editar (se permiss√£o) - Inativar/Ativar (se permiss√£o) - Ver Consumidores (lista de colaboradores) - Ver Ativos (se aplic√°vel) - Exportar Sub√°rvore (PNG/PDF apenas daquele n√≥) - Copiar Caminho (copia breadcrumb para clipboard)

### RN-UC06-008: Limite de Exporta√ß√£o
Descri√ß√£o: Exporta√ß√µes possuem limite de n√≥s.
Limites: - PNG: 500 n√≥s vis√≠veis - PDF: 1.000 n√≥s - Se exceder: sugest√£o de aplicar filtros ou exportar sub√°rvore

### RN-UC06-009: Valida√ß√£o de N√≠veis Desabilitados
Descri√ß√£o: N√≠veis desabilitados s√£o exibidos diferentemente.
Comportamento: - N√≥ fica cinza com √≠cone de bloqueio üîí - Tooltip explicativo: ‚ÄúDepartamentos desabilitados nesta filial‚Äù - N√£o possui filhos (n√£o expande) - Badge ‚ÄúDesabilitado‚Äù em vermelho

### RN-UC06-010: Performance - Virtualiza√ß√£o
Descri√ß√£o: Para √°rvores grandes, usar virtualiza√ß√£o.
Regra: - Se > 1.000 n√≥s vis√≠veis: ativar virtualiza√ß√£o - Renderizar apenas n√≥s vis√≠veis na viewport - Scroll virtual para performance

## MATRIZ DE PERMISS√ïES
### Permiss√µes Envolvidas

## INTEGRA√á√ïES EXTERNAS
### 1. Sistema de Cache (Redis)
Chave: arvore-hierarquia:{conglomeradoId}
TTL: 10 minutos

### 2. Sistema de Auditoria (RF-004)
Integra√ß√£o: Registrar visualiza√ß√£o da √°rvore (opcional, configur√°vel)

### 3. Central de Funcionalidades (RF-001)
Integra√ß√£o: Registrar acesso √† funcionalidade ‚ÄúVisualizar √Årvore Hier√°rquica‚Äù

### 4. i18n (RF-005)
Chaves de Tradu√ß√£o:
{
  "hierarchy.tree.title": "√Årvore Hier√°rquica",
  "hierarchy.tree.expand_all": "Expandir Tudo",
  "hierarchy.tree.collapse_all": "Colapsar Tudo",
  "hierarchy.tree.export_png": "Exportar PNG",
  "hierarchy.tree.export_pdf": "Exportar PDF",
  "hierarchy.tree.mode_organogram": "Modo Organograma",
  "hierarchy.tree.search": "Buscar na √°rvore",
  "hierarchy.tree.filter_active": "Apenas Ativos",
  "hierarchy.tree.no_hierarchy": "Nenhuma hierarquia cadastrada",
  "hierarchy.tree.loading": "Carregando...",
  "hierarchy.tree.error_loading": "Erro ao carregar. Clique para tentar novamente",
  "hierarchy.tree.level_disabled": "{nivel} desabilitados nesta filial",
  "hierarchy.tree.context_menu.details": "Ver Detalhes",
  "hierarchy.tree.context_menu.edit": "Editar",
  "hierarchy.tree.context_menu.inactivate": "Inativar",
  "hierarchy.tree.context_menu.consumers": "Ver Consumidores",
  "hierarchy.tree.context_menu.export_subtree": "Exportar Sub√°rvore"
}

## ESPECIFICA√á√ïES T√âCNICAS
### Endpoint Backend
GET /api/hierarquia/arvore?conglomeradoId={guid}&includeInactive={bool}
### Query Parameters
### Response (200 OK)
{
  "conglomeradoId": "guid-conglomerado-001",
  "conglomeradoNome": "Holding XYZ",
  "dtCache": "2025-11-06T10:30:00Z",
  "totalizadores": {
    "totalEmpresas": 2,
    "totalFiliais": 8,
    "totalCentrosCusto": 45,
    "totalDepartamentos": 120,
    "totalSetores": 85,
    "totalSecoes": 52,
    "totalConsumidores": 1850
  },
  "arvore": [
    {
      "id": "guid-empresa-001",
      "tipo": "Empresa",
      "nome": "Vale S.A.",
      "ativo": true,
      "totalizadores": {
        "totalFiliais": 5,
        "totalConsumidores": 1200
      },
      "filhos": [
        {
          "id": "guid-filial-001",
          "tipo": "Filial",
          "nome": "Filial Matriz SP",
          "ativo": true,
          "hiDepartamento": true,
          "hiSetor": true,
          "hiSecao": false,
          "totalizadores": {
            "totalCCs": 12,
            "totalConsumidores": 450
          },
          "filhos": [
            {
              "id": "guid-cc-001",
              "tipo": "CentroCusto",
              "nome": "CC Financeiro",
              "codigo": "CC-FIN",
              "percentualRateio": 25,
              "ativo": true,
              "filhos": []
            }
          ]
        }
      ]
    }
  ]
}
### Endpoint Lazy Loading
GET /api/hierarquia/arvore/filhos?parentId={guid}&tipo={string}
Exemplo: Carregar filiais de uma empresa
GET /api/hierarquia/arvore/filhos?parentId=guid-empresa-001&tipo=Empresa
Response:
{
  "parentId": "guid-empresa-001",
  "filhos": [
    {
      "id": "guid-filial-001",
      "tipo": "Filial",
      "nome": "Filial Matriz SP",
      "ativo": true,
      "temFilhos": true
    }
  ]
}

Pr√≥ximos UCs: - UC00 - Listar Hierarquia - UC01 - Criar Filial - UC02 - Criar Centro de Custo - UC03 - Criar Departamento - UC04 - Criar Setor - UC05 - Criar Se√ß√£o
Aprovado por: Anderson Chipak Revisado por: Claude Code Assistant Data: 2025-11-06

---

## Hist√≥rico de Altera√ß√µes

| Vers√£o | Data | Autor | Descri√ß√£o |
|--------|------|-------|-----------|
| 1.0 | 2025-12-17 | Sistema | Consolida√ß√£o de 27 casos de uso |
