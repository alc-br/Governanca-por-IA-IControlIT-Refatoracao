# RF-006-Gestao-de-Centro-de-Custo

**Versao**: 2.0
**Ultima Atualizacao**: 2025-11-03
**Status**: âœ… Estrutura Simplificada (5 secoes)
**Fase**: Fase 1 - Fundacao e Cadastros Base

---

[â† Voltar ao Indice](./README.md)

---

## RESUMO EXECUTIVO

### Descricao Geral

[PENDENTE: Analisar codigo legado e documentar]

---

---

## REGRAS DE NEGOCIO

### RN-CAD-008-01: Código Único por Conglomerado
**Descrição**: O código do centro de custo deve ser único dentro do conglomerado.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-02: Hierarquia Obrigatória em Cascata
**Descrição**: A hierarquia deve respeitar a ordem: Filial → Centro de Custo → Departamento → Setor → Seção. Não se pode criar um nível sem o anterior.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-03: Não Pode Inativar com Filhos Ativos
**Descrição**: Não se pode inativar um centro de custo com departamentos ativos, nem um departamento com setores ativos, etc.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-04: Gestor Deve Ser Consumidor Ativo
**Descrição**: O gestor/gerente/supervisor/coordenador deve ser um consumidor ativo do sistema.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-05: Budget Mensal Deve Ser Positivo
**Descrição**: Se informado, o valor do budget mensal deve ser maior que zero.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-06: Centro de Custo Vinculado à Filial
**Descrição**: Todo centro de custo deve estar vinculado a uma filial ativa.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-07: Código Deve Ser UPPER_SNAKE_CASE
**Descrição**: O código deve seguir o padrão UPPER_SNAKE_CASE (ex: DEPTO_TI, SETOR_RH).

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-08: Não Alterar Código com Histórico
**Descrição**: Se o centro de custo/departamento/setor/seção já tiver histórico de movimentações financeiras, não permitir alteração do código.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-09: Isolamento por Conglomerado (Multi-tenancy)
**Descrição**: Todas as consultas e operações devem filtrar por Id_Conglomerado do usuário autenticado.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-10: Auditoria Completa de Alterações
**Descrição**: Todas as operações (INSERT, UPDATE, DELETE) devem registrar histórico com dados anteriores em JSON.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-11: Nome Obrigatório e Limite de Caracteres
**Descrição**: O nome deve ser obrigatório e respeitar limite de 120 caracteres.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-12: Propagação de Inativação em Cascata (Opcional)
**Descrição**: Ao inativar um centro de custo, pode-se opcionalmente inativar todos os departamentos, setores e seções filhos automaticamente.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-13: Validação de E-mail de Gestor
**Descrição**: Se o gestor tiver e-mail cadastrado, deve ser um e-mail válido.

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-14: Relatório de Consumo por CC/Depto/Setor/Seção
**Descrição**: O sistema deve permitir relatórios de consumo agrupados por qualquer nível da hierarquia (CC, Depto, Setor, Seção).

**Implementação**:
[Implementacao: ver documentacao tecnica]

### RN-CAD-008-15: Alerta de Budget Excedido
**Descrição**: Se o consumo mensal ultrapassar o budget configurado, enviar alerta para o gestor.

**Implementação**:
[Implementacao: ver documentacao tecnica]

---

---

---

## REFERENCIAS AO LEGADO

### Mapeamento de Telas

| Tela Legado | Controller Moderno | Endpoint |
|-------------|-------------------|----------|
| `Cadastro\CentroCusto.aspx` | `CentroCustoController` | `GET /api/centrocusto` |
| `Cadastro\CentroCusto.aspx` (Novo) | `CentroCustoController.Criar` | `POST /api/centrocusto` |
| `Cadastro\CentroCusto.aspx` (Editar) | `CentroCustoController.Atualizar` | `PUT /api/centrocusto/{id}` |
| `Cadastro\CentroCusto.aspx` (Excluir) | `CentroCustoController.Inativar` | `DELETE /api/centrocusto/{id}` |
| `Cadastro\Departamento.aspx` | `DepartamentoController` | `GET /api/departamento` |
| `Cadastro\Setor.aspx` | `SetorController` | `GET /api/setor` |
| `Cadastro\Secao.aspx` | `SecaoController` | `GET /api/secao` |

### Mapeamento de WebServices

| WebService Legado | Endpoint REST Moderno | Método HTTP |
|-------------------|----------------------|-------------|
| `WS_Centro_Custo.ListarCentrosCusto` | `/api/centrocusto?idFilial={id}` | GET |
| `WS_Centro_Custo.BuscarCentroCusto` | `/api/centrocusto/{id}` | GET |
| `WS_Centro_Custo.InserirCentroCusto` | `/api/centrocusto` | POST |
| `WS_Centro_Custo.AtualizarCentroCusto` | `/api/centrocusto/{id}` | PUT |
| `WS_Centro_Custo.InativarCentroCusto` | `/api/centrocusto/{id}` | DELETE |
| `WS_Departamento.*` | `/api/departamento/*` | GET/POST/PUT/DELETE |
| `WS_Setor.*` | `/api/setor/*` | GET/POST/PUT/DELETE |
| `WS_Secao.*` | `/api/secao/*` | GET/POST/PUT/DELETE |

### Mapeamento de Tabelas

| Tabela Legado | Entidade Moderna | Mudanças |
|---------------|------------------|----------|
| `Centro_Custo` | `CentroCusto` | Sem mudanças estruturais |
| `Departamento` | `Departamento` | Sem mudanças estruturais |
| `Setor` | `Setor` | Sem mudanças estruturais |
| `Secao` | `Secao` | Sem mudanças estruturais |
| Não existia | `Centro_Custo_Historico` | Nova tabela de auditoria |
| Não existia | `Departamento_Historico` | Nova tabela de auditoria |
| Não existia | `Setor_Historico` | Nova tabela de auditoria |
| Não existia | `Secao_Historico` | Nova tabela de auditoria |

### Compatibilidade de Dados

- ✅ Migração 100% compatível (mesmos campos e tipos)
- ✅ Histórico preservado via tabelas de auditoria
- ✅ Chaves estrangeiras mantidas
- ⚠️ Novo campo `Vr_Budget_Mensal` (opcional, default NULL)

---

---

---

## BANCO DE DADOS LEGADO

### 1.1. Tabela: Centro_Custo

[Ver banco de dados legado para detalhes do schema]

### 1.2. Tabela: Departamento

[Ver banco de dados legado para detalhes do schema]

### 1.3. Tabela: Setor

[Ver banco de dados legado para detalhes do schema]

### 1.4. Tabela: Secao

[Ver banco de dados legado para detalhes do schema]

### 1.5. Tabelas de Histórico

[Ver banco de dados legado para detalhes do schema]

---

---

---

## WEBSERVICES LEGADO (VB.NET)

|-------------------|----------------------|-------------|
| `WS_Centro_Custo.ListarCentrosCusto` | `/api/centrocusto?idFilial={id}` | GET |
| `WS_Centro_Custo.BuscarCentroCusto` | `/api/centrocusto/{id}` | GET |
| `WS_Centro_Custo.InserirCentroCusto` | `/api/centrocusto` | POST |
| `WS_Centro_Custo.AtualizarCentroCusto` | `/api/centrocusto/{id}` | PUT |
| `WS_Centro_Custo.InativarCentroCusto` | `/api/centrocusto/{id}` | DELETE |
| `WS_Departamento.*` | `/api/departamento/*` | GET/POST/PUT/DELETE |
| `WS_Setor.*` | `/api/setor/*` | GET/POST/PUT/DELETE |
| `WS_Secao.*` | `/api/secao/*` | GET/POST/PUT/DELETE |

### Mapeamento de Tabelas

| Tabela Legado | Entidade Moderna | Mudanças |
|---------------|------------------|----------|
| `Centro_Custo` | `CentroCusto` | Sem mudanças estruturais |
| `Departamento` | `Departamento` | Sem mudanças estruturais |
| `Setor` | `Setor` | Sem mudanças estruturais |
| `Secao` | `Secao` | Sem mudanças estruturais |
| Não existia | `Centro_Custo_Historico` | Nova tabela de auditoria |
| Não existia | `Departamento_Historico` | Nova tabela de auditoria |
| Não existia | `Setor_Historico` | Nova tabela de auditoria |
| Não existia | `Secao_Historico` | Nova tabela de auditoria |

### Compatibilidade de Dados

- ✅ Migração 100% compatível (mesmos campos e tipos)
- ✅ Histórico preservado via tabelas de auditoria
- ✅ Chaves estrangeiras mantidas
- ⚠️ Novo campo `Vr_Budget_Mensal` (opcional, default NULL)

---

---

---

[â† Voltar ao Indice](./README.md)

## TELAS DO LEGADO

### Referência ao RF-CAD-003

As telas relacionadas à gestão de **Centro de Custo, Departamento, Setor e Seção** já foram documentadas no **RF-CAD-003 (Hierarquia Corporativa)**, pois fazem parte da estrutura hierárquica fundamental do sistema.

**Telas documentadas em RF-CAD-003**:
1. **Centro_Custo.aspx** - 4 campos + modal de lixeira, 7 categorias de modernização
2. **Departamento.aspx** - 3 campos, 7 categorias de modernização
3. **Setor.aspx** - 3 campos, 7 categorias de modernização
4. **Secao.aspx** - 3 campos, 7 categorias de modernização

**Consulte**: `D:\IC2\docs\Fases\Fase-1-Fundacao-e-Cadastros-Base\EPIC-CAD-Cadastros-Base\RF-CAD-003-Hierarquia-Corporativa\RF-CAD-003-Hierarquia-Corporativa.md`

Todas essas telas incluem modernizações para:
- UI/UX moderna (Angular + PrimeNG)
- Validação hierárquica
- Visualização hierárquica (breadcrumbs, TreeView)
- Gestão de responsáveis
- Auditoria e compliance
- Performance e usabilidade
