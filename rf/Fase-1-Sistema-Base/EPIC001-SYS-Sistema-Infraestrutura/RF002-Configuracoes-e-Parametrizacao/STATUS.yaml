rf: RF002
fase: Fase-1-Sistema-Base
epic: EPIC001-SYS-Sistema-Infraestrutura
titulo: Sistema de Configuracoes e Parametrizacao Avancada

# ============================================================
# 1. SKELETON / BASE ATUAL
# ============================================================
skeleton:
  criado: True
  data_criacao: "2025-11-04"
  observacao: >
    RF002 implementa exatamente o mesmo sistema de RF001 (mesmos endpoints, entidades, comandos).
    Backend completo conforme UC00-UC03.
    Funcionalidades implementadas:
    - CRUD completo de configurações (UC00-UC04)
    - Hierarquia multi-tenant (Usuário → Departamento → Empresa → Fornecedor → Global)
    - Criptografia Azure Key Vault AES-256-GCM
    - Cache Redis com hot-reload (pub/sub)
    - Versionamento com diff JSON
    - RBAC com 8 permissões granulares
    Completude geral estimada: 100%

# ============================================================
# 2. DOCUMENTACAO (CONTRATOS)
# ============================================================
documentacao:
  rf: True                # RF002.md v2.0 criado em 2025-12-29
  rf_yaml: True           # RF002.yaml v1.0 criado em 2025-12-29
  uc: True                # UC-RF002.md v2.0 criado em 2025-12-29 (10 UCs) - VALIDADO 100% em 2025-12-31
  uc_yaml: True           # UC-RF002.yaml v1.0 criado em 2025-12-29 - VALIDADO 100% em 2025-12-31
  md: True                # MD-RF002.yaml v2.0 criado em 2026-01-04 (2 entidades: sistema_configuracao_geral + sistema_configuracao_versao)
  wf: True                # WF-RF002.md v1.0 criado em 2026-01-04 (10 wireframes cobrindo UC00-UC09)
  rl: True                # RL-RF002.md v1.0 criado em 2025-12-29
  rl_yaml: True           # RL-RF002.yaml v2.0 criado em 2025-12-29
  tc: False               # Casos de teste ainda não gerados
  user_stories: False     # User stories ainda não criadas

# ============================================================
# 3. DESENVOLVIMENTO
# ============================================================
desenvolvimento:
  backend:
    status: done          # Backend 100% completo (implementado em RF001)
    branch: null
  frontend:
    status: not_started
    branch: null

# ============================================================
# 4. TESTES (RESULTADO)
# ============================================================
testes:
  backend: not_run        # not_run | pass | fail
  frontend: not_run
  e2e: not_run
  seguranca: not_run

# ============================================================
# 5. DOCUMENTACAO DE TESTES
# ============================================================
documentacao_testes:
  backend: False
  frontend: False
  e2e: False
  seguranca: False

# ============================================================
# 6. TESTES TI / QA
# ============================================================
testes_ti:
  backend: not_run
  frontend: not_run
  e2e: not_run
  seguranca: not_run

testes_qa:
  executado: False
  aprovado: False

# ============================================================
# 7. GOVERNANCA DE CASOS DE USO (EXECUCAO)
# ============================================================
# Esta seção é a ponte oficial entre UC (contrato) e execução real.
# O UC-RF002.yaml NÃO deve ser alterado quando um UC é concluído.
# Toda evolução de status acontece aqui.
ucs:
  UC00:
    titulo: "Listar Configurações"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do        # To Do | In Progress | Done | Blocked
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null

  UC01:
    titulo: "Criar Configuração"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null

  UC02:
    titulo: "Visualizar Configuração"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 3
    data_inicio: null
    data_conclusao: null

  UC03:
    titulo: "Editar Configuração"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null

  UC04:
    titulo: "Excluir Configuração"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 3
    data_inicio: null
    data_conclusao: null

  UC05:
    titulo: "Executar Rollback"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null

  UC06:
    titulo: "Gerenciar Feature Flags"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 13
    data_inicio: null
    data_conclusao: null

  UC07:
    titulo: "Exportar Configurações"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null

  UC08:
    titulo: "Importar Configurações"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null

  UC09:
    titulo: "Descriptografar Valor Sensível"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 3
    data_inicio: null
    data_conclusao: null

# ============================================================
# 8. SINCRONIZACAO COM AZURE DEVOPS
# ============================================================
# Azure DevOps NÃO é fonte de verdade.
# Ele reflete o conteúdo desta seção.
devops:
  work_item_id: null            # Feature / Epic principal (ainda não sincronizado)
  test_plan_id: null
  last_sync: "2025-12-29 (migracao governanca)"
  board_column: "Documentacao Completa"
  sync_policy:
    create_user_story_if_missing: True
    update_status_from_yaml: True
    update_sprint_from_yaml: True
    close_work_item_on_done: True

# ============================================================
# 9. GOVERNANCA E CONTRATOS
# ============================================================
governanca:
  contrato_ativo: "Migracao Governanca RF/RL v2.0"
  ultimo_manifesto: "2025-12-29 - Migracao manual completa RF002"
  regras:
    - "UC não deve ser alterado após aprovado"
    - "Mudanças de execução devem ocorrer apenas no STATUS.yaml"
    - "UC só pode ser marcado como Done se TC correspondente estiver Pass"
    - "RF só é considerado entregue quando todos os UCs estiverem Done"
  migracao_rf_rl:
    status: completa
    data_migracao: "2025-12-29"
    arquivos_gerados:
      - "RF002.md v2.0 (454 linhas, 11 seções, 15 regras de negócio)"
      - "RF002.yaml v1.0 (327 linhas)"
      - "RL-RF002.md v1.0 (264 linhas, 9 seções, 8 problemas legado)"
      - "RL-RF002.yaml v2.0 (8 referencias com destino obrigatório)"
      - "UC-RF002.md v2.0 (717 linhas, 10 UCs, cobertura 100%)"
      - "UC-RF002.yaml v1.0 (10 UCs estruturados)"
      - "STATUS.yaml (atualizado)"
    separacao_conteudo:
      moderno: "RF002.md, UC-RF002.md (funcionalidades, regras de negócio, eventos de domínio)"
      legado: "RL-RF002.md (web.config XML, código VB.NET, 8 problemas identificados)"
    cobertura_uc:
      total_regras_rf: 15
      total_ucs: 10
      cobertura: "100%"
      regras_sem_uc: []
      ucs_orfaos: []

# ============================================================
# 10. VALIDACOES
# ============================================================
validacoes:
  rf_uc_cobertura_total: true          # Validador passou com 100% cobertura em 2026-01-01
  uc_md_consistente: false             # MD ainda não criado
  uc_wf_consistente: false             # WF ainda não criado
  rf_yaml_sincronizado: true           # RF.yaml sincronizado com RF.md após migração de catalog
  uc_yaml_sincronizado: true           # UC.yaml sincronizado com UC.md - cobertura 100% functional_items

# ============================================================
# 11. ADEQUACAO DE UC (2026-01-04) - VALIDACAO 100% APROVADA
# ============================================================
adequacao_uc:
  executada: true
  data_adequacao: "2026-01-04"
  tipo_adequacao: "Adequacao Completa UC conforme CONTRATO-ADEQUACAO-COMPLETA-UC v1.0"
  responsavel: "Claude Code Agent"
  validator_exit_code: 0  # ✅ APROVADO

  # Auditoria Inicial
  auditoria_inicial:
    cobertura_rn_uc: "100% (39/39 items: 15 RNs + 24 functional_items)"
    nomenclatura_conforme: false  # Fluxos com 2 dígitos (FA-UC00-01)
    template_v2_0_conforme: false  # Faltavam campos tipo e impacta_dados
    catalogo_hibrido: false  # RF002 usa RF002-FUNC-XXX (correto)
    functional_items_em_regras_negocio: false  # Estavam apenas em catalog
    ucs_obrigatorios: true  # UC00-UC04 presentes
    gaps_identificados:
      - "Nomenclatura de fluxos com 2 dígitos (FA-UC00-01 em vez de FA-UC00-001)"
      - "Campos tipo e impacta_dados ausentes em todos os UCs"
      - "Functional_items do catalog não migrados para regras_negocio"
      - "Exclusions incorretas (RNs marcadas como exclusões)"

  # Correções Executadas
  correcoes_executadas:
    backup_criado: true
    backup_timestamp: "2026-01-04"
    backup_arquivos:
      - "RF002.yaml.backup-20260104-*"
      - "UC-RF002.yaml.backup-20260104-*"
      - "UC-RF002.md.backup-20260104-*"

    migracao_nomenclatura:
      fluxos_alternativos: "80+ IDs migrados de FA-UCNN-01 para FA-UCNN-001"
      fluxos_excecao: "40+ IDs migrados de FE-UCNN-01 para FE-UCNN-001"
      uc_items: "120+ IDs migrados de UCNN-FP-01 para FP-UCNN-001"
      total_substituicoes: "240+"

    adequacao_template_v2_0:
      campo_tipo_adicionado: true  # 10 UCs receberam campo tipo (crud/leitura/acao)
      campo_impacta_dados_adicionado: true  # 10 UCs receberam campo impacta_dados
      ucs_atualizados: 10

    migracao_rf_yaml:
      functional_items_movidos_para_regras_negocio: 24  # RF002-FUNC-001 a RF002-FUNC-024
      exclusions_corrigidas: true  # Removidas todas as RNs de exclusions
      estrutura_final: "regras_negocio com 39 items (15 RNs + 24 FUNCs)"

    ajuste_cobertura:
      rn_rf002_06_adicionada_uc05: true  # UC05 agora referencia RN-RF002-06 (versionamento)

  # Resultados Finais
  resultado_final:
    validator_exit_code: 0  # ✅ EXIT CODE 0: APROVADO - 100% conforme (ZERO GAPS)
    pontuacao_final: "5/5 PASS (100%)"
    cobertura_rn_uc: "39/39 (100%)"
    uc_covers_rf_100: true
    missing_rf_items: 0
    extra_uc_items: 0
    ucs_obrigatorios_presentes: true  # UC00-UC04 ✅
    nomenclatura_conforme: true  # 0 violações
    template_v2_0_conforme: true
    catalogo_limpo: true

  # Análise de Conformidade
  conformidade:
    template_v2_0: true
    campos_tipo_impacta_dados: true
    nomenclatura_fluxos_3_digitos: true
    regras_negocio_completas: true  # 39 items (15 RNs + 24 FUNCs)
    exclusions_corretas: true  # Lista vazia (sem exclusões incorretas)
    cobertura_100_percent: true
    ucs_sincronizados: true

  # Validador v2.0 - Resultado Detalhado
  validacao_detalhada:
    validacao_1_cobertura_rn: "✅ PASS - 39/39 (100%)"
    validacao_2_uc_nao_cria_comportamento_fora: "✅ PASS - 0 itens extras"
    validacao_3_ucs_obrigatorios: "✅ PASS - 5/5 presentes (UC00-UC04)"
    validacao_3_5_nomenclatura_fluxos: "✅ PASS - 0 violações"
    validacao_4_tc_cobre_ucs: "N/A - TC não fornecido"

  # Observações Técnicas
  observacoes:
    - "SUCESSO TOTAL: Validador retornou exit code 0 (aprovado com zero gaps)"
    - "Problema inicial: RF.yaml tinha regras_negocio (15 RNs) E catalog (24 FUNCs) separados"
    - "Validador v2.0 usa PRIORIDADE: regras_negocio > catalog (ignorava catalog)"
    - "Solução: Migrar todos os 24 functional_items para dentro de regras_negocio"
    - "Estrutura final RF.yaml: regras_negocio com 39 items (15 RNs + 24 FUNCs)"
    - "Exclusions corrigidas: lista vazia (RNs não devem estar em exclusions)"
    - "Todos os 10 UCs adequados ao template v2.0 (campos tipo e impacta_dados)"
    - "Nomenclatura 100% conforme: FA-UCNN-001, FE-UCNN-001, FP-UCNN-001"
    - "UC05 corrigido: adicionada RN-RF002-06 em regras_aplicadas"
    - "Cobertura 100% confirmada: 39/39 items do RF cobertos pelos 10 UCs"

# ============================================================
# 11. OBSERVACOES GERAIS
# ============================================================
observacoes:
  - "Este arquivo é o único local autorizado para controle de execução."
  - "UC-RF002.yaml permanece imutável como contrato funcional."
  - "Azure DevOps é sincronizado a partir deste arquivo."
  - "Este STATUS.yaml pode ser usado por agentes de IA e scripts automatizados."
  - "RF002 foi migrado em 2025-12-29 para nova governança RF/RL v2.0"
  - "Separação estrita: conteúdo moderno em RF/UC, conteúdo legado em RL"
  - "10 UCs cobrem 100% das 15 regras de negócio do RF-002 (matriz de rastreabilidade validada)"
  - "RL documenta 8 problemas críticos do legado (web.config plaintext, sem auditoria, sem cache)"
  - "UC-RF002 validado em 2025-12-31 com 100% de conformidade (validator-docs.py --rf RF002 --doc UC)"
  - "Gaps menores corrigidos: adicionados metadados Epic e Fase no cabeçalho do UC-RF002.md"
