# Casos de Uso - RF003

**Vers√£o:** 1.0
**Data:** 2025-12-17
**RF Relacionado:** [RF003 - Logs-Monitoramento-Observabilidade](./RF003.md)

---

## √çndice de Casos de Uso

| UC | Nome | Descri√ß√£o |
|----|------|-----------|
| UC00 | Visualizar Logs do Sistema | Caso de uso |
| UC02 | Visualizar Dashboards de M√©tricas | Caso de uso |

---

# UC00: Visualizar Logs do Sistema

**Modelo de Dados**: [MD-003](../MD-003-Logs-Monitoramento-Observabilidade.md)

---

## üìã Informa√ß√µes B√°sicas

| Atributo | Valor |
|----------|-------|
| **Ator Principal** | Administrador DevOps, Super Administrador, Desenvolvedor |
| **Objetivo** | Visualizar, buscar e analisar logs estruturados do sistema com filtros avan√ßados |
| **Pr√©-condi√ß√µes** | Usu√°rio autenticado com permiss√£o `SYS.LOGS.READ` |
| **P√≥s-condi√ß√µes** | Logs exibidos conforme filtros; acesso auditado |
| **Complexidade** | M√©dia |

---

## üéØ Fluxo Principal

1. Usu√°rio acessa menu "Sistema ‚Üí Logs e Monitoramento ‚Üí Logs"
2. Sistema verifica permiss√£o `SYS.LOGS.READ`
3. Sistema redireciona para **Seq UI** (dev/hom) ou **Kibana** (prod)
4. Sistema exibe interface de busca de logs com:
   - **Campo de busca full-text** (busca em mensagem, exception, stack trace)
   - **Filtros laterais**:
     - N√≠vel de log (Verbose, Debug, Info, Warning, Error, Fatal)
     - Per√≠odo (√∫ltimos 15 min, 1h, 24h, 7 dias, customizado)
     - Correlation ID
     - Usu√°rio (ID ou email)
     - Endpoint/Controller
     - Exception Type
     - Servidor/Host
   - **Timeline visual** (gr√°fico de barras por hora)
   - **Lista de logs** (paginada, 50 por p√°gina)
5. Para cada log, exibe:
   - **Timestamp** (com precis√£o de ms)
   - **N√≠vel** (badge colorido)
   - **Mensagem**
   - **Correlation ID** (link para rastrear request completo)
   - **Usu√°rio** (se aplic√°vel)
   - **Endpoint/Controller**
   - **Dura√ß√£o** (ms)
   - **Bot√£o "Ver Detalhes"**

---

## üîÄ Fluxos Alternativos

### FA01: Buscar Logs por Correlation ID
1. Usu√°rio clica em Correlation ID de um log
2. Sistema filtra todos os logs com mesmo Correlation ID
3. Sistema exibe timeline do request:
   - Request inicial (Controller)
   - Queries SQL executadas
   - Chamadas a APIs externas
   - Response final
4. Sistema calcula tempo total e breakdown por etapa

### FA02: Ver Detalhes de Log com Exception
1. Usu√°rio clica em "Ver Detalhes" de log com erro
2. Sistema exibe modal com:
   - **Stack Trace** completo (formatado)
   - **Inner Exceptions** (se houver)
   - **Dados do Request** (JSON):
     - Headers
     - Body (mascarado se sens√≠vel)
     - Query params
   - **Contexto Adicional**:
     - Usu√°rio ID
     - Empresa ID
     - IP origem
     - User-Agent
   - **Logs Relacionados** (outros erros nos √∫ltimos 5 min)
3. Usu√°rio pode:
   - Copiar stack trace
   - Exportar log para JSON
   - Criar alerta baseado nesta exception

### FA03: Exportar Logs
1. Usu√°rio clica em "Exportar"
2. Sistema verifica permiss√£o `SYS.LOGS.EXPORT`
3. Sistema exibe modal:
   - Formato: CSV, JSON, XLSX
   - Per√≠odo (limitado a 30 dias)
   - Filtros aplicados (readonly)
4. Sistema gera arquivo ass√≠ncrono
5. Sistema registra export em `Sistema_Log_Acesso_Auditoria`:
   - Usu√°rio que exportou
   - Filtros utilizados
   - Quantidade de registros
   - Tamanho do arquivo
6. Sistema envia notifica√ß√£o quando pronto
7. Usu√°rio baixa arquivo (link expira em 24h)

### FA04: Filtrar por Per√≠odo Customizado
1. Usu√°rio seleciona "Per√≠odo Customizado"
2. Sistema exibe date-range picker
3. Usu√°rio seleciona data/hora in√≠cio e fim
4. Sistema valida:
   - Per√≠odo m√°ximo: 30 dias (ou 7 dias se ambiente prod)
   - Data in√≠cio < Data fim
5. Sistema aplica filtro

---

## üîó Integra√ß√µes Obrigat√≥rias

### Permiss√µes
```csharp
[Authorize]
[RequiresPermission("SYS.LOGS.READ")]
public async Task<IActionResult> VisualizarLogs([FromQuery] LogFiltroDto filtro)
{
    // Registrar acesso em auditoria
    await _auditoriaService.RegistrarAcessoLogs(
        User.GetUserId(),
        "READ",
        JsonSerializer.Serialize(filtro)
    );

    // Redirecionar para Seq ou Kibana com filtros aplicados
    var seqUrl = _configuracaoService.ObterConfiguracao("Logs.Seq.Url");
    var filtroQuery = BuildSeqQuery(filtro);

    return Redirect($"{seqUrl}/#/events?{filtroQuery}");
}
```

### i18n
```json
{
  "LOGS": {
    "TITLE": "Logs do Sistema",
    "SUBTITLE": "Visualizar e buscar logs de aplica√ß√£o",
    "SEARCH_PLACEHOLDER": "Buscar por mensagem, erro ou correlation ID...",
    "FILTERS": {
      "LEVEL": "N√≠vel",
      "PERIOD": "Per√≠odo",
      "CORRELATION_ID": "Correlation ID",
      "USER": "Usu√°rio",
      "ENDPOINT": "Endpoint",
      "EXCEPTION_TYPE": "Tipo de Exce√ß√£o",
      "SERVER": "Servidor"
    },
    "PERIODS": {
      "LAST_15_MIN": "√öltimos 15 minutos",
      "LAST_1_HOUR": "√öltima hora",
      "LAST_24_HOURS": "√öltimas 24 horas",
      "LAST_7_DAYS": "√öltimos 7 dias",
      "CUSTOM": "Per√≠odo customizado"
    },
    "ACTIONS": {
      "VIEW_DETAILS": "Ver Detalhes",
      "EXPORT": "Exportar",
      "COPY_CORRELATION_ID": "Copiar Correlation ID",
      "CREATE_ALERT": "Criar Alerta"
    },
    "MESSAGES": {
      "NO_LOGS_FOUND": "Nenhum log encontrado com os filtros aplicados",
      "EXPORT_IN_PROGRESS": "Exporta√ß√£o em andamento. Voc√™ receber√° uma notifica√ß√£o quando estiver pronta.",
      "EXPORT_SUCCESS": "Logs exportados com sucesso"
    }
  }
}
```

### Auditoria
```csharp
// Registrar acesso a logs (compliance LGPD)
await _auditoriaService.Registrar(new AuditoriaDto {
    Tipo = "LOG_ACCESS",
    Descricao = "Usu√°rio acessou logs do sistema",
    Dados = new {
        Filtros = filtro,
        QuantidadeRegistros = logs.Count,
        PeriodoInicio = filtro.DataInicio,
        PeriodoFim = filtro.DataFim
    },
    Retention = TimeSpan.FromDays(2555) // 7 anos (compliance)
});

// Registrar exporta√ß√£o de logs
await _auditoriaService.Registrar(new AuditoriaDto {
    Tipo = "LOG_EXPORT",
    Descricao = "Usu√°rio exportou logs do sistema",
    Dados = new {
        Formato = formato,
        Filtros = filtro,
        QuantidadeRegistros = logs.Count,
        TamanhoArquivoMB = tamanhoMB
    },
    Retention = TimeSpan.FromDays(2555) // 7 anos
});
```

### RBAC
Controle de acesso via permiss√µes:
- `SYS.LOGS.READ`: Visualizar logs
- `SYS.LOGS.SEARCH`: Buscar com filtros avan√ßados
- `SYS.LOGS.EXPORT`: Exportar logs para arquivo

---

## üé® Interface (Refer√™ncia)

### Tela Principal de Logs
```
+----------------------------------------------------------------+
| üîç Buscar logs...                                    [Exportar]|
+----------------------------------------------------------------+
| Filtros:                                                       |
| [N√≠vel: Todos v] [Per√≠odo: √öltimas 24h v] [Correlation ID: ] |
| [Usu√°rio: ] [Endpoint: ] [Exception Type: ]                   |
+----------------------------------------------------------------+
| Timeline:                                                      |
| [Gr√°fico de barras mostrando volume de logs por hora]        |
+----------------------------------------------------------------+
| Logs (1,234 resultados):                                      |
+----------------------------------------------------------------+
| 2025-11-04 14:23:45.123 | ERROR | Request falhou               |
| Correlation: abc-123    | User: admin@test.com                 |
| Endpoint: POST /api/usuarios                          [Detalhes]|
+----------------------------------------------------------------+
| 2025-11-04 14:22:12.456 | WARNING | Query SQL lenta            |
| Correlation: def-456    | Duration: 3,245 ms                   |
| Query: SELECT * FROM Usuario WHERE...                 [Detalhes]|
+----------------------------------------------------------------+
| [< Anterior] [1] [2] [3] ... [10] [Pr√≥xima >]                |
+----------------------------------------------------------------+
```

### Modal "Ver Detalhes"
```
+----------------------------------------------------------------+
| Detalhes do Log                                          [‚úï]   |
+----------------------------------------------------------------+
| Timestamp: 2025-11-04 14:23:45.123                            |
| N√≠vel: ERROR                                                   |
| Correlation ID: abc-123-def-456                       [Copiar] |
| Mensagem: NullReferenceException ao processar usu√°rio         |
+----------------------------------------------------------------+
| Stack Trace:                                                   |
| at IControlIT.Services.UsuarioService.Criar(...)              |
|    at IControlIT.Controllers.UsuarioController.Post(...)      |
+----------------------------------------------------------------+
| Request:                                                       |
| POST /api/usuarios                                             |
| Headers:                                                       |
|   Authorization: Bearer ***                                    |
|   Content-Type: application/json                              |
| Body:                                                          |
| {                                                              |
|   "nome": "Teste",                                            |
|   "email": "teste@example.com",                               |
|   "cpf": "***.***.***-**"  // Mascarado                       |
| }                                                              |
+----------------------------------------------------------------+
| Contexto:                                                      |
| Usu√°rio ID: 12345678-1234-1234-1234-123456789012             |
| Empresa ID: 87654321-4321-4321-4321-210987654321             |
| IP Origem: 192.168.1.100                                      |
| User-Agent: Mozilla/5.0...                                    |
+----------------------------------------------------------------+
| [Copiar Stack Trace] [Exportar JSON] [Criar Alerta]          |
+----------------------------------------------------------------+
```

---

## üß™ Cen√°rios de Teste

### CT-UC00-001: Visualizar Logs com Filtro por N√≠vel
**Dado** que usu√°rio tem permiss√£o `SYS.LOGS.READ`
**Quando** acessa p√°gina de logs e filtra por "Error"
**Ent√£o** exibe apenas logs de n√≠vel Error/Fatal

### CT-UC00-002: Buscar por Correlation ID
**Dado** que usu√°rio visualiza um log
**Quando** clica em Correlation ID
**Ent√£o** exibe todos os logs daquele request end-to-end

### CT-UC00-003: Exportar Logs para CSV
**Dado** que usu√°rio tem permiss√£o `SYS.LOGS.EXPORT`
**Quando** clica em "Exportar" e seleciona CSV
**Ent√£o** gera arquivo CSV e registra em auditoria

### CT-UC00-004: Acesso Negado sem Permiss√£o
**Dado** que usu√°rio N√ÉO tem permiss√£o `SYS.LOGS.READ`
**Quando** tenta acessar p√°gina de logs
**Ent√£o** exibe erro 403 Forbidden

---

**Pr√≥ximo**: [UC01: Configurar Alertas](./UC01-configurar-alertas.md)

---

# UC02: Visualizar Dashboards de M√©tricas

**Modelo de Dados**: [MD-003](../MD-003-Logs-Monitoramento-Observabilidade.md)

---

## üìã Informa√ß√µes B√°sicas

| Atributo | Valor |
|----------|-------|
| **Ator Principal** | Administrador DevOps, Gerente de Opera√ß√µes, Desenvolvedor |
| **Objetivo** | Visualizar dashboards de performance e sa√∫de do sistema com m√©tricas RED (Rate, Errors, Duration) |
| **Pr√©-condi√ß√µes** | Usu√°rio autenticado com permiss√£o `SYS.METRICS.READ` |
| **P√≥s-condi√ß√µes** | Dashboards exibidos com m√©tricas em tempo real |
| **Complexidade** | M√©dia |

---

## üéØ Fluxo Principal

1. Usu√°rio acessa menu "Sistema ‚Üí Logs e Monitoramento ‚Üí Dashboards"
2. Sistema verifica permiss√£o `SYS.METRICS.READ`
3. Sistema exibe p√°gina com 4 dashboards principais (tabs):
   - **RED Metrics** (padr√£o)
   - **Sa√∫de do Sistema**
   - **Performance de APIs**
   - **Banco de Dados**
4. Dashboard "RED Metrics" exibe:
   - **Rate (Taxa de Requisi√ß√µes)**:
     - Requests/segundo (tempo real)
     - Gr√°fico de linha (√∫ltimas 24h)
     - Breakdown por endpoint (top 10)
   - **Errors (Taxa de Erros)**:
     - % de erros (tempo real)
     - Gr√°fico de linha com threshold (5%)
     - Breakdown por tipo de erro (4xx vs 5xx)
     - Top 10 endpoints com mais erros
   - **Duration (Lat√™ncia)**:
     - P50 (mediana)
     - P95 (95¬∫ percentil)
     - P99 (99¬∫ percentil)
     - Gr√°fico de linha com m√∫ltiplas s√©ries (P50, P95, P99)
     - Endpoints mais lentos (top 10)
5. Usu√°rio pode:
   - Selecionar per√≠odo: 15 min, 1h, 6h, 24h, 7d, 30d
   - Filtrar por endpoint (dropdown)
   - Filtrar por empresa (se multi-tenant)
   - Auto-refresh (30s, 1min, 5min, off)
   - Exportar dashboard para PDF
   - Compartilhar link com filtros aplicados

---

## üîÄ Fluxos Alternativos

### FA01: Dashboard "Sa√∫de do Sistema"
1. Usu√°rio clica em tab "Sa√∫de do Sistema"
2. Sistema exibe:
   - **Health Checks**:
     - Status de cada depend√™ncia (badge colorido):
       - ‚úÖ Database (Healthy)
       - ‚úÖ Redis (Healthy)
       - ‚ö†Ô∏è Azure Blob (Degraded)
       - ‚ùå External API (Unhealthy)
     - Tempo de resposta de cada check (ms)
     - √öltima verifica√ß√£o (timestamp)
   - **Uso de Recursos**:
     - CPU: Gauge (0-100%)
     - Mem√≥ria: Gauge (0-100%)
     - Disco: Gauge (0-100%)
     - Conex√µes DB: Gauge (0-max)
     - Gr√°fico de linha (√∫ltimas 24h) para cada recurso
   - **Alertas Ativos**:
     - Lista de alertas n√£o resolvidos
     - Tempo desde o disparo
     - Link para reconhecer (ACK)
3. Usu√°rio pode clicar em health check com falha:
   - Exibe detalhes da falha
   - √öltimas 10 tentativas
   - Link para logs relacionados

### FA02: Dashboard "Performance de APIs"
1. Usu√°rio clica em tab "Performance de APIs"
2. Sistema exibe:
   - **Top 10 APIs Mais Chamadas**:
     - Endpoint
     - Requests/min
     - P95 latency
     - Taxa de erro
   - **Top 10 APIs Mais Lentas**:
     - Endpoint
     - P95 latency
     - P99 latency
     - Breakdown de tempo (DB, External API, Business Logic)
   - **APIs com Mais Erros**:
     - Endpoint
     - Quantidade de erros (24h)
     - Taxa de erro
     - Tipo de erro mais comum
   - **Gr√°fico de Heatmap**:
     - Eixo X: Hora do dia
     - Eixo Y: Endpoint
     - Cor: Lat√™ncia (verde=r√°pido, vermelho=lento)
3. Usu√°rio pode clicar em endpoint:
   - Drill-down para m√©tricas espec√≠ficas
   - Logs recentes daquele endpoint
   - Exemplo de requests lentos (distributed tracing)

### FA03: Dashboard "Banco de Dados"
1. Usu√°rio clica em tab "Banco de Dados"
2. Sistema exibe:
   - **Conex√µes**:
     - Conex√µes ativas
     - Conex√µes no pool
     - Conex√µes aguardando
     - Gr√°fico de linha (√∫ltimas 24h)
   - **Queries SQL**:
     - Top 10 queries mais lentas (P95 > 1s)
     - Quantidade de queries/segundo
     - Deadlocks detectados (√∫ltimas 24h)
     - Timeouts (√∫ltimas 24h)
   - **Uso de Recursos DB**:
     - CPU do servidor SQL
     - Mem√≥ria do servidor SQL
     - IOPS (leitura/escrita)
   - **Tabelas Mais Acessadas**:
     - Nome da tabela
     - Reads/segundo
     - Writes/segundo
     - Tamanho (GB)
3. Usu√°rio pode clicar em query lenta:
   - Exibe query SQL completa
   - Plano de execu√ß√£o (se dispon√≠vel)
   - Logs relacionados
   - Sugest√£o de √≠ndice (se aplic√°vel)

### FA04: Exportar Dashboard para PDF
1. Usu√°rio clica em "Exportar para PDF"
2. Sistema gera PDF com:
   - Data/hora da gera√ß√£o
   - Per√≠odo selecionado
   - Todos os gr√°ficos e tabelas
   - Marca d'√°gua "IControlIT"
3. Sistema registra exporta√ß√£o em auditoria
4. Usu√°rio faz download do PDF

### FA05: Criar M√©trica Customizada
1. Usu√°rio clica em "Nova M√©trica"
2. Sistema exibe modal:
   - C√≥digo
   - Nome
   - Descri√ß√£o
   - Categoria (Neg√≥cio, T√©cnica, Financeira)
   - Tipo (Counter, Gauge, Histogram)
   - Origem (Log, Database, API)
   - Query SQL (se origem = Database)
   - Fun√ß√£o de agrega√ß√£o (Sum, Count, Avg, P95, P99)
   - Exibir em dashboard (checkbox)
   - Tipo de gr√°fico (Line, Bar, Gauge, Counter)
3. Usu√°rio salva m√©trica
4. Sistema adiciona √† tabela `Sistema_Log_Metrica_Customizada`
5. Sistema come√ßa a coletar dados (background job)
6. Dashboard √© atualizado com nova m√©trica

---

## üîó Integra√ß√µes Obrigat√≥rias

### Permiss√µes
```csharp
[Authorize]
[RequiresPermission("SYS.METRICS.READ")]
public async Task<IActionResult> VisualizarDashboards([FromQuery] string periodo = "24h")
{
    // Buscar m√©tricas do Prometheus
    var metrics = await _prometheusService.ObterMetricas(periodo);

    // Buscar health checks do banco
    var healthChecks = await _healthCheckRepository.ObterUltimos();

    // Buscar alertas ativos
    var alertasAtivos = await _alertaRepository.ObterNaoResolvidos();

    return View(new DashboardViewModel {
        Metrics = metrics,
        HealthChecks = healthChecks,
        AlertasAtivos = alertasAtivos,
        Periodo = periodo
    });
}
```

### i18n
```json
{
  "DASHBOARDS": {
    "TITLE": "Dashboards de M√©tricas",
    "SUBTITLE": "Monitorar sa√∫de e desempenho do sistema",
    "TABS": {
      "RED_METRICS": "RED Metrics",
      "SYSTEM_HEALTH": "Sa√∫de do Sistema",
      "API_PERFORMANCE": "Performance de APIs",
      "DATABASE": "Banco de Dados"
    },
    "RED_METRICS": {
      "RATE": "Taxa de Requisi√ß√µes",
      "ERRORS": "Taxa de Erros",
      "DURATION": "Lat√™ncia",
      "REQUESTS_PER_SECOND": "Requisi√ß√µes/segundo",
      "ERROR_PERCENTAGE": "% de Erros",
      "P50_LATENCY": "P50 (Mediana)",
      "P95_LATENCY": "P95 (95¬∫ Percentil)",
      "P99_LATENCY": "P99 (99¬∫ Percentil)",
      "TOP_ENDPOINTS": "Top 10 Endpoints"
    },
    "SYSTEM_HEALTH": {
      "HEALTH_CHECKS": "Health Checks",
      "RESOURCE_USAGE": "Uso de Recursos",
      "ACTIVE_ALERTS": "Alertas Ativos",
      "CPU": "CPU",
      "MEMORY": "Mem√≥ria",
      "DISK": "Disco",
      "DB_CONNECTIONS": "Conex√µes com Banco"
    },
    "API_PERFORMANCE": {
      "TOP_MOST_CALLED": "APIs Mais Chamadas",
      "TOP_SLOWEST": "APIs Mais Lentas",
      "TOP_ERRORS": "APIs com Mais Erros",
      "LATENCY_HEATMAP": "Heatmap de Lat√™ncia"
    },
    "DATABASE": {
      "CONNECTIONS": "Conex√µes",
      "SLOW_QUERIES": "Queries Lentas",
      "DEADLOCKS": "Deadlocks",
      "TIMEOUTS": "Timeouts",
      "TOP_TABLES": "Tabelas Mais Acessadas"
    },
    "ACTIONS": {
      "EXPORT_PDF": "Exportar para PDF",
      "REFRESH": "Atualizar",
      "AUTO_REFRESH": "Auto-Refresh",
      "SHARE_LINK": "Compartilhar Link",
      "NEW_METRIC": "Nova M√©trica"
    },
    "PERIODS": {
      "15_MIN": "√öltimos 15 minutos",
      "1_HOUR": "√öltima hora",
      "6_HOURS": "√öltimas 6 horas",
      "24_HOURS": "√öltimas 24 horas",
      "7_DAYS": "√öltimos 7 dias",
      "30_DAYS": "√öltimos 30 dias"
    }
  }
}
```

### Auditoria
```csharp
// Exportar dashboard
await _auditoriaService.Registrar(new AuditoriaDto {
    Tipo = "DASHBOARD_EXPORT",
    Descricao = "Usu√°rio exportou dashboard para PDF",
    Dados = new {
        Dashboard = "RED_METRICS",
        Periodo = periodo,
        Filtros = filtros
    },
    Retention = TimeSpan.FromDays(365)
});

// Criar m√©trica customizada
await _auditoriaService.Registrar(new AuditoriaDto {
    Tipo = "CUSTOM_METRIC_CREATED",
    Descricao = $"M√©trica {dto.Nome} criada",
    Dados = new {
        MetricaCodigo = metrica.Codigo,
        Categoria = metrica.Categoria,
        OrigemDados = metrica.Origem_Dados
    },
    Retention = TimeSpan.FromDays(2555) // 7 anos
});
```

### Integra√ß√£o com Prometheus
```csharp
public class PrometheusService
{
    private readonly HttpClient _httpClient;
    private readonly string _prometheusUrl;

    public async Task<RedMetrics> ObterRedMetrics(string periodo)
    {
        // Query Prometheus para obter m√©tricas RED

        // Rate (requests/segundo)
        var rateQuery = "rate(http_requests_total[5m])";
        var rate = await QueryPrometheus(rateQuery);

        // Errors (taxa de erros)
        var errorQuery = "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m]) * 100";
        var errorRate = await QueryPrometheus(errorQuery);

        // Duration (lat√™ncia P95)
        var durationQuery = "histogram_quantile(0.95, http_request_duration_seconds_bucket)";
        var p95 = await QueryPrometheus(durationQuery);

        return new RedMetrics {
            Rate = rate,
            ErrorRate = errorRate,
            P95Latency = p95
        };
    }

    private async Task<double> QueryPrometheus(string query)
    {
        var response = await _httpClient.GetAsync(
            $"{_prometheusUrl}/api/v1/query?query={Uri.EscapeDataString(query)}"
        );

        var json = await response.Content.ReadAsStringAsync();
        var result = JsonSerializer.Deserialize<PrometheusResponse>(json);

        return result.Data.Result.FirstOrDefault()?.Value ?? 0;
    }
}
```

---

## üé® Interface (Refer√™ncia)

### Dashboard "RED Metrics"
```
+----------------------------------------------------------------+
| Dashboards                    [15m v] [Auto-refresh: 30s v]   |
| [RED Metrics] [Sa√∫de do Sistema] [APIs] [Banco de Dados]      |
+----------------------------------------------------------------+
| Rate (Taxa de Requisi√ß√µes)                                     |
| üîµ 1,234 req/s                                                 |
| [Gr√°fico de linha - √∫ltimas 24h]                              |
+----------------------------------------------------------------+
| Errors (Taxa de Erros)                                         |
| üü¢ 2.3% (abaixo do threshold 5%)                               |
| [Gr√°fico de linha com threshold em vermelho]                  |
+----------------------------------------------------------------+
| Duration (Lat√™ncia)                                            |
| P50: 45 ms | P95: 234 ms | P99: 567 ms                        |
| [Gr√°fico de linha com 3 s√©ries: P50, P95, P99]                |
+----------------------------------------------------------------+
| Top 10 Endpoints (por requests/min):                          |
| POST /api/usuarios                  1,234 req/min   P95: 45ms |
| GET /api/faturas                      987 req/min   P95: 123ms|
| PUT /api/ativos/{id}                  543 req/min   P95: 89ms |
| ...                                                            |
+----------------------------------------------------------------+
| [Exportar PDF] [Compartilhar Link] [Nova M√©trica]            |
+----------------------------------------------------------------+
```

### Dashboard "Sa√∫de do Sistema"
```
+----------------------------------------------------------------+
| Dashboards                    [1h v] [Auto-refresh: 1min v]   |
| [RED Metrics] [Sa√∫de do Sistema] [APIs] [Banco de Dados]      |
+----------------------------------------------------------------+
| Health Checks:                                                 |
| ‚úÖ Database           Healthy      15 ms    14:23:45          |
| ‚úÖ Redis              Healthy       5 ms    14:23:45          |
| ‚ö†Ô∏è Azure Blob Storage Degraded    234 ms    14:23:45          |
| ‚ùå External API       Unhealthy   TIMEOUT   14:23:45          |
+----------------------------------------------------------------+
| Uso de Recursos:                                               |
| CPU:      [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 78%       [Gr√°fico linha 24h]         |
| Mem√≥ria:  [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë] 62%       [Gr√°fico linha 24h]         |
| Disco:    [‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 34%       [Gr√°fico linha 24h]         |
| Conex√µes: [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 45/100    [Gr√°fico linha 24h]         |
+----------------------------------------------------------------+
| Alertas Ativos (2):                                            |
| üî¥ Taxa de Erros Alta          h√° 5 minutos    [Reconhecer]  |
| üü° API Lenta                   h√° 12 minutos   [Reconhecer]  |
+----------------------------------------------------------------+
```

---

## üß™ Cen√°rios de Teste

### CT-UC02-001: Visualizar Dashboard RED Metrics
**Dado** que usu√°rio tem permiss√£o `SYS.METRICS.READ`
**Quando** acessa p√°gina de dashboards
**Ent√£o** exibe m√©tricas RED (Rate, Errors, Duration) em tempo real

### CT-UC02-002: Filtrar Dashboard por Per√≠odo
**Dado** que usu√°rio visualiza dashboard
**Quando** seleciona per√≠odo "7 dias"
**Ent√£o** gr√°ficos s√£o atualizados com dados dos √∫ltimos 7 dias

### CT-UC02-003: Exportar Dashboard para PDF
**Dado** que usu√°rio visualiza dashboard
**Quando** clica em "Exportar para PDF"
**Ent√£o** gera PDF com todos os gr√°ficos e registra em auditoria

### CT-UC02-004: Ver Detalhes de Health Check com Falha
**Dado** que usu√°rio visualiza dashboard "Sa√∫de do Sistema"
**Quando** clica em health check "Unhealthy"
**Ent√£o** exibe detalhes da falha e logs relacionados

### CT-UC02-005: Auto-Refresh do Dashboard
**Dado** que usu√°rio configura auto-refresh para 30 segundos
**Quando** aguarda 30 segundos
**Ent√£o** dashboard √© atualizado automaticamente com novos dados

---

**Fim dos Casos de Uso do RF-003**

---

## Hist√≥rico de Altera√ß√µes

| Vers√£o | Data | Autor | Descri√ß√£o |
|--------|------|-------|-----------|
| 1.0 | 2025-12-17 | Sistema | Consolida√ß√£o de 2 casos de uso |
