# Template de Referência ao Legado (RL-RF003.yaml)
# Versão: 2.0 (Adequação para Automação e Rastreabilidade)
# Data: 2025-12-29

rf_id: RF003
titulo: "Sistema de Logs, Monitoramento e Observabilidade"

legado:
  sistema: "Arquivo de Log Texto Plano (VB.NET + ASP.NET Web Forms)"
  versao: "IControlIT v1.0"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server (logs NÃO persistidos em banco)"
  multi_tenant: false
  auditoria: "none"
  configuracoes: "Nenhuma - logging não configurável"
  criptografia: "none"
  versionamento: "none"
  cache: "none"
  agregacao: "none"
  observabilidade: "none"

# SEÇÃO CRÍTICA: Referências ao Legado com Destino Obrigatório
referencias:
  - id: "LEG-RF003-001"
    tipo: "componente"
    nome: "app.log (arquivo texto plano não estruturado)"
    caminho: "ic1_legado/IControlIT/IControlIT/logs/app.log"
    descricao: |
      Arquivo texto plano onde sistema legado escrevia logs manualmente.
      Formato: `{DateTime.Now} - {mensagem}`

      Exemplo de conteúdo real:
      ```
      2023-10-15 14:23:45 - Usuário admin@test.com fez login
      2023-10-15 14:24:12 - Erro ao salvar usuário: Object reference not set
      2023-10-15 14:25:33 - CPF 123.456.789-00 consultado
      2023-10-15 14:26:01 - Senha do usuário: Admin@123
      ```

      Problemas críticos:
      - Formato texto não estruturado (impossível buscar por campos específicos)
      - CPF e senhas em texto claro (violação LGPD Art. 7)
      - Sem correlation ID (impossível rastrear request completo)
      - Sem níveis de log (tudo texto livre)
      - Arquivo isolado por servidor (sem agregação)
      - Crescimento indefinido (sem rotação, travava disco)
      - Sem mascaramento de dados sensíveis
      - Sem timestamp com timezone (problemas multi-região)

    destino: "substituido"
    justificativa: |
      Substituído por sistema estruturado de logging com Serilog + Seq/Elasticsearch:
      - Logs estruturados JSON com campos obrigatórios (Timestamp, Level, Message, CorrelationId, UserId, TenantId, IP, UserAgent)
      - Agregação centralizada (todos servidores → Seq DEV/HOM, Elasticsearch PRD)
      - Correlation IDs automáticos (GUID em todos os logs)
      - Níveis configuráveis (Verbose/Debug/Info/Warning/Error/Fatal por ambiente)
      - Mascaramento automático de dados sensíveis (CPF, senhas, cartões)
      - Sampling 10% em produção (reduz custos mantendo 100% erros)
      - Busca full-text com queries complexas (SQL-like)
      - Dashboards Grafana (RED metrics: Rate, Errors, Duration)

      Impacto:
      - Eliminação de 8 problemas críticos de segurança e compliance
      - Redução 95% tempo de troubleshooting (minutos vs horas/dias)
      - Redução 99% risco vazamento LGPD (mascaramento automático)
      - Compliance SOX/ISO 27001 (auditoria logs retenção 7 anos)

    rf_item_relacionado: "RN-LOG-001, RN-LOG-003, RN-LOG-004, RN-LOG-005"
    uc_relacionado: "UC00, UC01, UC02"
    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF003-002"
    tipo: "regra_negocio"
    nome: "LogError(mensagem As String) - Escrita manual em arquivo texto"
    caminho: "ic1_legado/IControlIT/App_Code/**/*.vb (code-behind)"
    descricao: |
      Método VB.NET para escrever logs manualmente em arquivo.

      Código legado:
      ```vb.net
      Public Sub LogError(mensagem As String)
          Dim logFile As String = Server.MapPath("~/logs/app.log")
          Dim writer As New StreamWriter(logFile, True) ' append mode
          writer.WriteLine($"{DateTime.Now} - {mensagem}")
          writer.Close()
      End Sub

      ' Uso típico (COM VAZAMENTO!)
      Try
          ' ... código
      Catch ex As Exception
          LogError($"Erro ao processar CPF {cpf}: {ex.Message}")
          LogError($"Senha do usuário: {senha}") ' ❌ GRAVÍSSIMO!
      End Try
      ```

      Problemas:
      - Vazamento de dados sensíveis (CPF, senhas em texto claro)
      - Formato texto livre (não estruturado)
      - Sem correlation ID
      - Sem contexto (IP, User-Agent, TenantId)
      - Sem stack trace estruturado
      - StreamWriter não thread-safe (race conditions)
      - Sem tratamento de erro (se disco cheio → crash)

    destino: "substituido"
    justificativa: |
      Substituído por Serilog structured logging:
      - Logger.Error(ex, "Erro ao salvar {EntityType} {EntityId}", "Usuario", id)
      - Mascaramento automático de dados sensíveis via Destructuring Policy
      - Correlation ID injetado automaticamente via middleware
      - Thread-safe por design (lock interno)
      - Circuit breaker (fallback arquivo local se Seq/Elasticsearch falhar)
      - Stack trace completo estruturado em JSON

      Compatibilidade:
      - Wrapper temporário LogError() chama Logger.Error() (30 dias)
      - Permitir migração gradual código legado
      - Remover wrapper após validação completa

    rf_item_relacionado: "RN-LOG-001, RN-LOG-004, RN-LOG-007"
    uc_relacionado: "UC00, UC02"
    complexidade: "media"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF003-003"
    tipo: "regra_negocio"
    nome: "Dados Sensíveis em Texto Claro (CPF, Senhas, Cartões)"
    caminho: "ic1_legado/IControlIT/IControlIT/logs/app.log"
    descricao: |
      Logs legados continham dados sensíveis em TEXTO CLARO:
      - CPF completo (123.456.789-00)
      - Senhas de usuário
      - Cartões de crédito
      - Tokens de API
      - Connection strings com senha banco

      Exemplo real:
      ```
      2023-10-15 14:25:33 - CPF 123.456.789-00 consultado
      2023-10-15 14:26:01 - Senha do usuário: Admin@123
      2023-10-15 14:27:00 - Cartão: 4111 1111 1111 1111
      2023-10-15 14:28:00 - Conectando com ConnectionString=Server=...;Password=senha123
      ```

      Riscos:
      - Violação LGPD Art. 7 (dados pessoais não protegidos)
      - Violação PCI-DSS Req. 3.4 (dados de cartão não mascarados)
      - Vazamento em backups
      - Exposição em logs IIS/servidor
      - Acesso via RDP sem auditoria
      - Multa LGPD até 2% faturamento

    destino: "substituido"
    justificativa: |
      Substituído por mascaramento automático ANTES de logar:
      - CPF: `***.***.*89-**` (apenas últimos 2 dígitos visíveis)
      - Senha: `***` (mascaramento completo)
      - Cartão: `**** **** **** 1111` (apenas últimos 4 dígitos)
      - Token: `***` (mascaramento completo)

      Implementação:
      - Serilog Destructuring Policy customizado
      - Regex para detectar CPF/cartão/senha em mensagens
      - Substituição automática antes de serializar JSON
      - Auditoria de acesso a logs com dados sensíveis

      Compliance:
      - LGPD Art. 46 (segurança dados pessoais)
      - PCI-DSS Req. 3.4 (masking de PAN)
      - SOX Seção 404 (controles internos)

    rf_item_relacionado: "RN-LOG-004"
    uc_relacionado: "UC00, UC01, UC02"
    complexidade: "alta"
    risco_migracao: "alto"
    prioridade: 1

  - id: "LEG-RF003-004"
    tipo: "regra_negocio"
    nome: "Sem Correlation IDs (Rastreamento Impossível)"
    caminho: "ic1_legado (comportamento sistêmico)"
    descricao: |
      Sistema legado não tinha correlation IDs.
      Impossível rastrear request completo:
      - Frontend faz request → backend processa → banco salva → fila envia → job executa
      - Logs espalhados, sem vínculo entre eles

      Exemplo problema real:
      - Cliente reporta: "Erro ao salvar usuário às 14h23"
      - 15 logs de "Erro ao salvar" entre 14h20-14h30
      - Impossível saber qual log corresponde ao request específico
      - Troubleshooting levava horas (grep manual, tentativa e erro)

    destino: "substituido"
    justificativa: |
      Substituído por correlation IDs obrigatórios (GUID):
      - Middleware injeta GUID único em cada request HTTP
      - GUID propagado em todos os logs da cadeia (frontend → API → banco → fila → job)
      - Campo obrigatório `CorrelationId` em JSON
      - Busca simples: "todos logs CorrelationId = X" retorna request completo

      Redução tempo troubleshooting:
      - Antes: 2-4 horas (grep manual, tentativa e erro)
      - Depois: 2-5 minutos (query única no Seq/Elasticsearch)
      - ROI: $20k/ano economia tempo engenharia

    rf_item_relacionado: "RN-LOG-003"
    uc_relacionado: "UC01, UC02"
    complexidade: "alta"
    risco_migracao: "baixo"
    prioridade: 1

  - id: "LEG-RF003-005"
    tipo: "regra_negocio"
    nome: "Sem Níveis de Log (Tudo é Informação)"
    caminho: "ic1_legado (comportamento sistêmico)"
    descricao: |
      Sistema legado não tinha níveis de log (Info, Warning, Error, Fatal).
      Tudo era escrito no mesmo formato: `{DateTime} - {mensagem}`

      Problemas:
      - Impossível filtrar apenas erros
      - Impossível diferenciar severidade
      - Volume alto de logs inúteis (ex: "Usuário fez login")
      - Erros críticos perdidos no ruído

    destino: "substituido"
    justificativa: |
      Substituído por níveis configuráveis por ambiente:
      - Verbose: tudo (apenas DEV debug profundo)
      - Debug: detalhes técnicos (DEV)
      - Info: ações importantes usuário (DEV/HOM)
      - Warning: problemas potenciais (HOM/PRD)
      - Error: erros recuperáveis (todos ambientes)
      - Fatal: erros irrecuperáveis (todos ambientes)

      Configuração por ambiente:
      - DEV: Debug (tudo)
      - HOM: Info (ações importantes)
      - PRD: Warning (apenas problemas)

      Impacto:
      - Redução 90% volume logs em PRD (sampling + níveis)
      - Redução 80% custo armazenamento Elasticsearch
      - Filtros simples: "apenas erros últimas 24h"

    rf_item_relacionado: "RN-LOG-002, RN-LOG-005, RN-LOG-006"
    uc_relacionado: "UC00, UC01"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

  - id: "LEG-RF003-006"
    tipo: "regra_negocio"
    nome: "Sem Agregação (Arquivo Isolado por Servidor)"
    caminho: "ic1_legado (comportamento sistêmico)"
    descricao: |
      Cada servidor web tinha arquivo app.log isolado.
      Impossível busca unificada:
      - 3 servidores PRD (WEB01, WEB02, WEB03)
      - 3 arquivos app.log separados
      - Busca manual server por server via RDP

      Processo troubleshooting:
      1. Conectar via RDP em WEB01
      2. Abrir app.log com Notepad
      3. Ctrl+F buscar "erro"
      4. Se não achar, repetir WEB02, WEB03
      5. Tempo médio: 1-2 horas

    destino: "substituido"
    justificativa: |
      Substituído por agregação centralizada:
      - Seq (DEV/HOM): interface web, busca unificada
      - Elasticsearch (PRD): escalável para milhões logs/dia
      - Todos servidores enviam logs para mesmo destino
      - Busca única retorna logs de todos servidores

      Redução tempo troubleshooting:
      - Antes: 1-2 horas (RDP manual em 3 servidores)
      - Depois: 2-5 minutos (query única Seq/Elasticsearch)

    rf_item_relacionado: "RN-LOG-001"
    uc_relacionado: "UC00, UC01"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 1

  - id: "LEG-RF003-007"
    tipo: "regra_negocio"
    nome: "Sem Métricas (Response Time, Error Rate, Throughput)"
    caminho: "ic1_legado (comportamento sistêmico)"
    descricao: |
      Sistema legado não coletava métricas de performance:
      - Sem response time (P50/P95/P99 latency)
      - Sem error rate (% de erros)
      - Sem throughput (requests/segundo)
      - Descoberta de problemas reativa (usuário reporta)

      Exemplo problema real:
      - API lenta (3s response time)
      - Descoberto apenas quando usuário reclamou
      - Causa raiz (query lenta) identificada depois de 2 dias

    destino: "substituido"
    justificativa: |
      Substituído por métricas RED (Rate, Errors, Duration):
      - Prometheus coleta métricas via endpoint /metrics
      - Grafana dashboards visuais (gráficos tempo real)
      - Alertas automáticos quando thresholds excedidos:
        - Error rate > 5% (últimos 5 min)
        - P95 latency > 3s
        - Throughput < 100 req/s (horário comercial)

      Benefícios:
      - Detecção proativa (antes de usuário perceber)
      - SLA 99.9% alcançável (8.7h downtime/ano)
      - Identificação gargalos (queries lentas, memory leaks)

    rf_item_relacionado: "RN-LOG-009"
    uc_relacionado: "UC05"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF003-008"
    tipo: "regra_negocio"
    nome: "Sem Alertas (Descoberta Reativa)"
    caminho: "ic1_legado (comportamento sistêmico)"
    descricao: |
      Sistema legado não tinha alertas automáticos.
      Problemas descobertos apenas quando:
      - Usuário reportava erro
      - Sistema completamente offline
      - Backup falhava (descoberto semanas depois)

      Exemplo incidente real:
      - SMTP offline por 2 dias
      - Nenhum e-mail enviado (recuperação senha, notificações)
      - Descoberto quando cliente ligou reclamando
      - Downtime: 48 horas sem detecção

      Custo:
      - SLA 99% (3.65 dias downtime/ano aceitável)
      - Perda financeira: clientes descontentes
      - Multas contratuais: violação SLA

    destino: "substituido"
    justificativa: |
      Substituído por alertas proativos com PagerDuty/Opsgenie:
      - Error rate > 5% (últimos 5 min) → SMS/Push time real
      - P95 latency > 3s → Slack/Teams
      - Dependência crítica offline (banco, cache, SMTP) → PagerDuty 24/7
      - Disco > 85%, Memória > 90% → Email equipe DevOps

      SLA alcançado:
      - 99.9% (8.7h downtime/ano)
      - MTTR (Mean Time To Recovery): 5 min vs 2 horas
      - Economia: $50k/ano (custo downtime evitado)

    rf_item_relacionado: "RN-LOG-011"
    uc_relacionado: "UC04"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 2

# Telas Legadas
telas:
  - id: "LEG-RF003-TELA-001"
    nome: "INEXISTENTE"
    caminho: null
    responsabilidade: "Sistema legado NÃO tinha interface web para visualizar logs"
    campos: []
    comportamentos_implicitos:
      - "Acesso via RDP ao servidor obrigatório"
      - "Leitura manual de app.log com Notepad/Notepad++"
      - "Busca via Ctrl+F (find) ou grep em linha de comando"
      - "Sem autenticação/autorização (qualquer admin RDP podia ler)"
      - "Sem histórico de quem acessou logs (auditoria zero)"
      - "Sem filtros (data, usuário, nível, correlation ID)"
      - "Sem paginação (arquivos grandes travavam Notepad)"

# WebServices Legados
servicos:
  - id: "LEG-RF003-SVC-001"
    nome: "INEXISTENTE"
    localizacao: null
    responsabilidade: "Sistema legado não expunha API para visualização de logs"
    notas: "Logs lidos diretamente do sistema de arquivos via RDP"

# Tabelas Legadas
tabelas:
  - nome: "INEXISTENTE"
    finalidade: "Logs NÃO eram armazenados em banco de dados (apenas arquivo app.log)"
    problemas:
      - "Formato texto não estruturado"
      - "CPF e senhas em texto claro"
      - "Sem correlation ID"
      - "Sem níveis de log"
      - "Sem agregação centralizada"
      - "Sem busca full-text"
      - "Sem métricas"
      - "Sem alertas"

# Regras de Negócio Implícitas (não documentadas no legado)
regras_implicitas:
  - id: "RL-RN-001"
    descricao: |
      Logs eram escritos apenas em caso de erro (exceções).
      Sucessos não eram logados (ex: "Usuário criado com sucesso").
    fonte: "Análise código VB.NET (try/catch com LogError)"

  - id: "RL-RN-002"
    descricao: |
      Formato de log era fixo: `{DateTime.Now} - {mensagem}`.
      Não configurável, sem campos estruturados.
    fonte: "Método LogError() em App_Code/**/*.vb"

  - id: "RL-RN-003"
    descricao: |
      Não havia rotação de arquivos.
      app.log crescia indefinidamente até travar disco (100GB+).
    fonte: "Incidente PRD 2023-07-15 (disco cheio, sistema offline)"

  - id: "RL-RN-004"
    descricao: |
      Não havia mascaramento de dados sensíveis.
      CPF, senhas, cartões logados em texto claro.
    fonte: "Auditoria segurança 2024-03-10"

  - id: "RL-RN-005"
    descricao: |
      Não havia níveis de log (Info, Warning, Error).
      Tudo era texto livre no mesmo formato.
    fonte: "Análise app.log (sem campo Level)"

  - id: "RL-RN-006"
    descricao: |
      Cada servidor web tinha arquivo isolado.
      Impossível busca unificada (RDP manual em cada servidor).
    fonte: "Procedimento operacional DevOps"

  - id: "RL-RN-007"
    descricao: |
      Não havia retenção automática.
      Arquivos nunca eram deletados (acúmulo infinito).
    fonte: "Análise logs históricos (arquivos de 2015 ainda presentes)"

  - id: "RL-RN-008"
    descricao: |
      Logs de segurança (login, logout, acesso negado) NÃO eram registrados.
      Violação compliance ISO 27001, SOX.
    fonte: "Auditoria compliance 2024-05-10"

# Gap Analysis (Legado x Moderno)
gap_analysis:
  - item: "Formato logs"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: texto plano. Moderno: JSON estruturado (Serilog)"

  - item: "Agregação centralizada"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: arquivo isolado por servidor. Moderno: Seq/Elasticsearch centralizados"

  - item: "Correlation IDs"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem rastreamento. Moderno: GUID em todos logs"

  - item: "Níveis de log"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem níveis. Moderno: Verbose/Debug/Info/Warning/Error/Fatal"

  - item: "Mascaramento dados sensíveis"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: CPF/senhas texto claro. Moderno: mascaramento automático"

  - item: "Busca full-text"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: Ctrl+F manual. Moderno: queries SQL-like Seq/Elasticsearch"

  - item: "Interface web"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: RDP + Notepad. Moderno: Seq UI / Grafana"

  - item: "Métricas RED"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem métricas. Moderno: Prometheus/Grafana (Rate, Errors, Duration)"

  - item: "Alertas proativos"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem alertas. Moderno: PagerDuty/Opsgenie (error rate > 5%)"

  - item: "Health checks"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem health checks. Moderno: endpoint /health (Kubernetes probes)"

  - item: "Tracing distribuído"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem tracing. Moderno: OpenTelemetry (W3C Trace Context)"

  - item: "Retenção automática"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem retenção (arquivos nunca deletados). Moderno: 90d/1y/7y automático"

  - item: "Sampling"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem sampling (tudo logado). Moderno: 10% sucesso, 100% erros (reduz custos)"

  - item: "Circuit breaker logging"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem fallback. Moderno: fallback arquivo local se Seq/Elasticsearch falhar"

  - item: "Export CSV/JSON"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: copy/paste manual. Moderno: export automatizado via API"

  - item: "Auditoria acesso logs"
    existe_legado: false
    existe_moderno: true
    notas: "Legado: sem auditoria (desconhecido quem acessou). Moderno: auditoria completa"

# Decisões de Modernização
decisoes_modernizacao:
  - decisao: "Serilog + Seq (DEV/HOM) + Elasticsearch (PRD)"
    motivo: |
      Serilog: biblioteca .NET mais madura para structured logging.
      Seq: interface web simples, self-hosted gratuito (DEV/HOM).
      Elasticsearch: escala para milhões logs/dia (PRD).
    impacto: "alto"
    data: "2025-11-04"

  - decisao: "Mascaramento automático dados sensíveis"
    motivo: |
      Compliance LGPD (não logar CPF texto claro).
      Compliance PCI-DSS (não logar cartões).
      Evitar multas (até 2% faturamento).
    impacto: "alto"
    data: "2025-11-04"

  - decisao: "Correlation IDs obrigatórios (GUID)"
    motivo: |
      Rastrear request completo (frontend → API → banco → fila → job).
      Diagnosticar problemas sistemas distribuídos (microservices).
      Redução tempo troubleshooting 95% (horas → minutos).
    impacto: "medio"
    data: "2025-11-04"

  - decisao: "Sampling 10% em produção"
    motivo: |
      Reduzir custos armazenamento Elasticsearch (milhões logs/dia).
      Manter 100% erros (troubleshooting não prejudicado).
      ROI: economia $5k/mês armazenamento.
    impacto: "baixo"
    data: "2025-11-04"

  - decisao: "Retenção automática (90d / 1y / 7y)"
    motivo: |
      LGPD: não reter dados pessoais além necessário (90 dias).
      SOX: reter logs auditoria 7 anos (compliance financeiro).
      Job diário deleta logs expirados.
    impacto: "medio"
    data: "2025-11-04"

  - decisao: "Health checks /health endpoint"
    motivo: |
      Kubernetes liveness/readiness probes (detectar pod unhealthy).
      Load balancer (remover servidor com problema do pool).
    impacto: "baixo"
    data: "2025-11-04"

  - decisao: "Alertas proativos PagerDuty"
    motivo: |
      Detectar problemas antes usuário reportar (proativo não reativo).
      SLA 99.9% exige resposta minutos (não horas/dias).
      Economia: $50k/ano (custo downtime evitado).
    impacto: "medio"
    data: "2025-11-04"

  - decisao: "OpenTelemetry para tracing distribuído"
    motivo: |
      Padrão W3C (vendor-neutral, não lock-in).
      Suporte nativo Azure Application Insights.
      Rastrear chamadas entre microservices.
    impacto: "alto"
    data: "2025-11-04"

# Riscos de Migração
riscos_migracao:
  - risco: "Perda de logs durante transição"
    impacto: "alto"
    probabilidade: "media"
    mitigacao: |
      Circuit breaker: se Seq/Elasticsearch falhar, escrever arquivo local.
      Manter app.log legado como fallback por 30 dias.
      Validação completa DEV/HOM antes PRD.

  - risco: "Custo elevado Elasticsearch"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Sampling 10% sucesso + retenção automática 90 dias.
      Monitoramento custos Azure (alertas se > budget).

  - risco: "Overhead performance (logging síncrono)"
    impacto: "medio"
    probabilidade: "baixa"
    mitigacao: |
      Logging assíncrono (queue interna Serilog).
      Testes carga antes PRD (validar latência P95 < 3s).

  - risco: "Mascaramento quebrar troubleshooting"
    impacto: "medio"
    probabilidade: "baixa"
    mitigacao: |
      Mascarar apenas últimos 4 dígitos CPF (manter sufixo).
      Super Admin pode descriptografar (auditado).

  - risco: "Alertas falsos positivos (ruído)"
    impacto: "baixo"
    probabilidade: "media"
    mitigacao: |
      Calibrar thresholds: error rate > 5% (não 1%).
      Período observação 30 dias antes ativar alertas PRD.

  - risco: "Tracing aumentar latência"
    impacto: "baixo"
    probabilidade: "baixa"
    mitigacao: |
      Sampling 10% também em tracing (não 100%).
      Validar latência P95 < 3s em HOM.

  - risco: "Retenção 7 anos custar caro"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: |
      Apenas logs segurança/auditoria 7 anos (não todos).
      Compressão Elasticsearch (GZIP 80% redução).

# Rastreabilidade (Legado → Moderno)
rastreabilidade:
  - elemento_legado: "app.log (arquivo texto plano)"
    referencia_rf: "RN-LOG-001, RN-LOG-003, RN-LOG-004, RN-LOG-005"
    referencia_uc: "UC00, UC01, UC02"
    status: "migrado"

  - elemento_legado: "LogError(mensagem As String)"
    referencia_rf: "RN-LOG-001, RN-LOG-004, RN-LOG-007"
    referencia_uc: "UC00, UC02"
    status: "migrado"

  - elemento_legado: "CPF/senhas texto claro"
    referencia_rf: "RN-LOG-004"
    referencia_uc: "UC00, UC01, UC02"
    status: "migrado"

  - elemento_legado: "Sem correlation ID"
    referencia_rf: "RN-LOG-003"
    referencia_uc: "UC01, UC02"
    status: "migrado"

  - elemento_legado: "Sem níveis log"
    referencia_rf: "RN-LOG-002, RN-LOG-005, RN-LOG-006"
    referencia_uc: "UC00, UC01"
    status: "migrado"

  - elemento_legado: "Arquivo isolado por servidor"
    referencia_rf: "RN-LOG-001"
    referencia_uc: "UC00, UC01"
    status: "migrado"

  - elemento_legado: "Sem métricas"
    referencia_rf: "RN-LOG-009"
    referencia_uc: "UC05"
    status: "migrado"

  - elemento_legado: "Sem alertas"
    referencia_rf: "RN-LOG-011"
    referencia_uc: "UC04"
    status: "migrado"

# Changelog
changelog:
  - versao: "2.0"
    data: "2025-12-29"
    descricao: "Documentação completa estruturada YAML - 8 referências legado com destino definido, gap analysis 16 itens, 8 decisões modernização, 7 riscos migração, rastreabilidade completa"
    autor: "Agência ALC - alc.dev.br"

  - versao: "1.0"
    data: "2025-11-04"
    descricao: "Versão inicial (DESCONTINUADA)"
    autor: "Equipe Projeto"
