rf: RF003
fase: Fase-1-Sistema-Base
epic: EPIC001-SYS-Sistema-Infraestrutura
titulo: Sistema de Logs, Monitoramento e Observabilidade

# ============================================================
# 1. SKELETON / BASE ATUAL
# ============================================================
skeleton:
  criado: True
  data_criacao: "2025-12-27"
  observacao: >
    Backend parcialmente implementado: 63.5% completo.
    Implementado: Logging estruturado (100%), Endpoints de logs (100%), Filtros/Busca (100%),
    Exportação CSV/JSON (100%), Health Checks (70%), Métricas RED (80%),
    Métricas Customizadas (50%), Dashboard (40%).
    Faltam: Seq (0%), Elasticsearch (0%), Prometheus (0%), Grafana (0%),
    OpenTelemetry (0%), AlertManager (0%).
    RF-003 é sistema crítico (SLA 99.9%) - requer integração completa com stack de observabilidade.

# ============================================================
# 2. DOCUMENTACAO (CONTRATOS)
# ============================================================
documentacao:
  rf: True               # RF003.md criado (487 linhas, v2.0, 2025-12-29)
  rf_yaml: True          # RF003.yaml estruturado (327 linhas, 2025-12-29)
  uc: True               # UC-RF003.md criado (694 linhas, 7 UCs, 2025-12-29) - VALIDADO 100% em 2025-12-31
  uc_yaml: True          # UC-RF003.yaml estruturado (2025-12-29) - VALIDADO 100% em 2025-12-31
  md: False              # Modelo de dados ainda não criado
  wf: False              # Wireframes ainda não criados
  rl: True               # RL-RF003.md criado (322 linhas, 2025-12-29)
  rl_yaml: True          # RL-RF003.yaml estruturado (603 linhas, 8 referencias, 2025-12-29)
  tc: False              # Casos de teste ainda não gerados
  user_stories: False    # User stories ainda não criadas

# ============================================================
# 3. DESENVOLVIMENTO
# ============================================================
desenvolvimento:
  backend:
    status: skeleton   # not_started | skeleton | in_progress | done
    branch: null
    observacao: "Backend 63.5% completo - falta integração com Seq, Elasticsearch, Prometheus, Grafana, OpenTelemetry"
  frontend:
    status: not_started
    branch: null

# ============================================================
# 4. TESTES (RESULTADO)
# ============================================================
testes:
  backend: not_run        # not_run | pass | fail
  frontend: not_run
  e2e: not_run
  seguranca: not_run

# ============================================================
# 5. DOCUMENTACAO DE TESTES
# ============================================================
documentacao_testes:
  backend: True           # TC-BACKEND criado anteriormente
  frontend: False
  e2e: False
  seguranca: False

# ============================================================
# 6. TESTES TI / QA
# ============================================================
testes_ti:
  backend: not_run
  frontend: not_run
  e2e: not_run
  seguranca: not_run

testes_qa:
  executado: False
  aprovado: False

# ============================================================
# 7. GOVERNANCA DE CASOS DE USO (EXECUCAO)
# ============================================================
# Esta seção é a ponte oficial entre UC (contrato) e execução real.
# O UC-RF003.yaml NÃO deve ser alterado quando um UC é concluído.
# Toda evolução de status acontece aqui.
ucs:
  UC00:
    titulo: "Listar Logs"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do        # To Do | In Progress | Done | Blocked
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null
    observacao: "Logs estruturados JSON com mascaramento automático (RN-LOG-001, RN-LOG-004)"

  UC01:
    titulo: "Buscar Logs com Filtros Avançados"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null
    observacao: "Busca por Correlation ID, UserId, IP, text search (RN-LOG-003)"

  UC02:
    titulo: "Visualizar Detalhes de Log"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 3
    data_inicio: null
    data_conclusao: null
    observacao: "Visualizar log completo com stack trace e navegação por CorrelationId"

  UC03:
    titulo: "Exportar Logs (CSV/JSON)"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null
    observacao: "Exportação para compliance (LGPD, SOX) com mascaramento (RN-LOG-004, RN-LOG-008)"

  UC04:
    titulo: "Configurar Alertas"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null
    observacao: "Alertas proativos: error rate > 5%, P95 > 3s, dependência offline (RN-LOG-011)"

  UC05:
    titulo: "Visualizar Dashboards de Métricas"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null
    observacao: "Métricas RED: Rate (requests/s), Errors (%), Duration (P50/P95/P99) (RN-LOG-009)"

  UC06:
    titulo: "Verificar Health Checks"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 3
    data_inicio: null
    data_conclusao: null
    observacao: "Endpoint /health para Kubernetes liveness/readiness (RN-LOG-010)"

  UC07:
    titulo: "Visualizar Tracing Distribuído"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null
    observacao: "OpenTelemetry W3C Trace Context - rastreamento end-to-end (RN-LOG-012)"

# ============================================================
# 8. SINCRONIZACAO COM AZURE DEVOPS
# ============================================================
# Azure DevOps NÃO é fonte de verdade.
# Ele reflete o conteúdo desta seção.
devops:
  work_item_id: 495            # Feature / Epic principal
  test_plan_id: null
  last_sync: "2025-12-27 15:31:12"
  board_column: "Documentado"
  sync_policy:
    create_user_story_if_missing: True
    update_status_from_yaml: True
    update_sprint_from_yaml: True
    close_work_item_on_done: True

# ============================================================
# 9. GOVERNANCA E CONTRATOS
# ============================================================
governanca:
  contrato_ativo: "CONTRATO-DOCUMENTACAO-ESSENCIAL (concluído)"
  ultimo_manifesto: null
  regras:
    - "UC não deve ser alterado após aprovado"
    - "Mudanças de execução devem ocorrer apenas no STATUS.yaml"
    - "UC só pode ser marcado como Done se TC correspondente estiver Pass"
    - "RF só é considerado entregue quando todos os UCs estiverem Done"
    - "RF-003 é sistema crítico (SLA 99.9%) - testes de carga obrigatórios"

# ============================================================
# 10. OBSERVACOES GERAIS
# ============================================================
observacoes:
  - "Migração para nova governância v2.0 CONCLUÍDA em 2025-12-29 (7/7 arquivos)"
  - "RF-003 NÃO é um CRUD tradicional - logs são eventos append-only (write-only + read-only)"
  - "Sistema legado NÃO tinha logs estruturados - tudo texto plano com CPF/senhas em claro (LGPD violation)"
  - "Modernização exige: Serilog + Seq/Elasticsearch + Prometheus/Grafana + OpenTelemetry + Application Insights"
  - "12 regras de negócio críticas (RN-LOG-001 a RN-LOG-012) cobertas por 7 UCs (100% de cobertura validada)"
  - "Sistema de observabilidade é pré-requisito para SLA 99.9% (troubleshooting rápido, alertas proativos)"
  - "RL-RF003.yaml documenta 8 problemas críticos do legado (CPF/senha em texto claro, sem correlation ID, sem métricas)"
  - "Este STATUS.yaml pode ser usado por agentes de IA e scripts automatizados."
  - "UC-RF003 validado em 2025-12-31 com 100% de conformidade (validator-docs.py --rf RF003 --doc UC)"
  - "Gaps menores corrigidos: adicionados metadados Epic e Fase no cabeçalho do UC-RF003.md"

validacoes:
  rf_uc_cobertura_total: True        # 10/10 RNs acionáveis cobertas (2 exclusões justificadas: RN-LOG-005 sampling, RN-LOG-007 circuit breaker)
  uc_md_consistente: False           # MD ainda não criado
  uc_wf_consistente: False           # WF ainda não criado
  rf_yaml_sincronizado: True         # RF003.yaml estruturado criado e corrigido (catalog com 12 RNs + exclusions)
  uc_yaml_sincronizado: True         # UC-RF003.yaml estruturado criado
  rl_yaml_sincronizado: True         # RL-RF003.yaml estruturado criado (8 referencias com destino)

# ============================================================
# ADEQUACAO UC - CONTRATO-ADEQUACAO-COMPLETA-UC
# ============================================================
adequacao_uc:
  data_execucao: "2026-01-01"
  executor: "Claude Sonnet 4.5"
  resultado_validador:
    exit_code: 0  # PASS
    cobertura_rf_uc: "100%"  # 10/10 RNs acionáveis cobertas
    exclusoes_justificadas: 2  # RN-LOG-005 (sampling), RN-LOG-007 (circuit breaker)
    ucs_obrigatorios: "100%"  # UC00-UC04 presentes
    nomenclatura: "100%"  # Padrão oficial em todos códigos
    catalogo_hibrido: "0"  # Zero códigos RF-CRUD/VAL/SEC
    sincronia_yaml_md: "100%"  # UC.yaml ↔ UC.md alinhados

  correcoes_realizadas:
    - "Corrigido validator-rf-uc.py para suportar chave 'casos_de_uso' (padrão atual)"
    - "Corrigido RF003.yaml: catalog agora inclui todas as 12 RNs organizadas em grupos"
    - "Adicionadas exclusions para RN-LOG-005 (sampling) e RN-LOG-007 (circuit breaker)"
    - "RN-LOG-005/007 são técnicas de backend invisíveis ao usuário - não requerem UCs"

  observacao: >
    RF003 é DIFERENTE de CRUDs tradicionais - logs são eventos append-only.
    Apenas 10 de 12 RNs requerem UCs (2 são técnicas de infraestrutura).
    Validador passou com exit code 0 após correções no catalog e exclusions.
