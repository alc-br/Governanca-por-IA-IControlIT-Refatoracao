# =============================================
# UC-RF001 - Casos de Uso (Contrato Comportamental)
# RF001 - Sistema de Parâmetros e Configurações Centralizadas
# Versão: 2.0
# Data: 2025-12-31
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF001"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Sistema_Parametro"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-02"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-04"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade 'Parâmetros do Sistema' pelo menu"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão SYS.PARAMETROS.VIEW_ANY"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega registros do tenant (filtra por Id_Conglomerado do usuário autenticado)"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação padrão (20 registros por página) e ordenação padrão (Cd_Parametro ASC)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema máscaras valores sensíveis (Fl_Sensivel = 1) se usuário não tiver permissão SYS.PARAMETROS.VIEW_SENSITIVE"
          required: true
        - id: "FP-UC00-006"
          title: "Sistema exibe a lista com colunas: Cd_Parametro, Nm_Parametro, Categoria, Tipo_Dado, Fl_Sistema, Fl_Sensivel, Ações"
          required: true
        - id: "FA-UC00-001"
          title: "Buscar por termo - Usuário digita termo de busca → Sistema filtra por Cd_Parametro, Nm_Parametro ou Ds_Parametro (case-insensitive)"
          required: false
        - id: "FA-UC00-002"
          title: "Ordenar por coluna - Usuário clica em cabeçalho de coluna → Sistema alterna ordenação ASC/DESC"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por Categoria - Usuário seleciona categoria (Sistema, Segurança, Integração, Notificação, Relatório) → Sistema aplica filtro"
          required: false
        - id: "FA-UC00-004"
          title: "Filtrar por Tipo_Dado - Usuário seleciona tipo (String, Integer, Decimal, Boolean, Date, JSON) → Sistema aplica filtro"
          required: false
        - id: "FA-UC00-005"
          title: "Filtrar apenas parâmetros de sistema (Fl_Sistema = 1) - Usuário marca checkbox → Sistema aplica filtro"
          required: false
        - id: "FA-UC00-006"
          title: "Exportar lista para CSV - Usuário clica em 'Exportar' → Sistema gera CSV (exige permissão SYS.PARAMETROS.EXPORT)"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão SYS.PARAMETROS.VIEW_ANY → Sistema retorna HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum registro encontrado → Sistema exibe estado vazio com mensagem 'Nenhum parâmetro encontrado'"
          required: true
        - id: "FE-UC00-003"
          title: "Erro ao carregar registros → Sistema exibe mensagem 'Erro ao carregar parâmetros' e registra erro em log"
          required: true

    precondicoes:
      - permissao: "SYS.PARAMETROS.VIEW_ANY"

    gatilho: "Usuario acessa a funcionalidade pelo menu"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_registros_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao_ordenacao"
      - passo: 5
        ator: "sistema"
        acao: "mascarar_valores_sensiveis"
      - passo: 6
        ator: "sistema"
        acao: "exibir_lista"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"
      - id: "FA-UC00-02"
        condicao: "usuario_ordena_coluna"
        resultado: "lista_ordenada"
      - id: "FA-UC00-03"
        condicao: "usuario_exporta_csv"
        resultado: "arquivo_csv_gerado"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado_http_403"
      - id: "FE-UC00-02"
        condicao: "nenhum_registro"
        resultado: "estado_vazio_exibido"
      - id: "FE-UC00-03"
        condicao: "erro_carregar"
        resultado: "mensagem_erro_exibida"

    regras_aplicadas:
      - "RN-SYS-001-04"
      - "RN-SYS-001-14"

    resultado_final:
      estado: "lista_exibida_com_filtros_paginacao"

  - id: "UC01"
    nome: "Criar Sistema_Parametro"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-01"
        - "RF-VAL-01"
        - "RF-VAL-02"
        - "RF-VAL-03"
        - "RF-VAL-04"
        - "RF-VAL-05"
        - "RF-VAL-06"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-03"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em 'Criar Novo Parâmetro'"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão SYS.PARAMETROS.CREATE"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário de criação com todos os campos"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário informa dados obrigatórios (Cd_Parametro, Nm_Parametro, Ds_Parametro, Categoria, Tipo_Dado)"
          required: true
        - id: "FP-UC01-005"
          title: "Usuário seleciona valor conforme tipo de dado (String, Integer, Decimal, Boolean, Date, JSON)"
          required: true
        - id: "FP-UC01-006"
          title: "Usuário clica em 'Salvar'"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema valida campos obrigatórios (RN-SYS-001-06)"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema valida unicidade de Cd_Parametro no tenant (RN-SYS-001-01)"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema valida valor conforme tipo de dado (RN-SYS-001-02)"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema valida regex se Regex_Validacao especificado (RN-SYS-001-02)"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema valida valor dentro de min/max se especificado (RN-SYS-001-02)"
          required: true
        - id: "FP-UC01-012"
          title: "Sistema valida valor dentro de Opcoes_Validas se especificado (RN-SYS-001-05)"
          required: true
        - id: "FP-UC01-013"
          title: "Sistema criptografa valor se Fl_Sensivel = 1 (RN-SYS-001-04)"
          required: true
        - id: "FP-UC01-014"
          title: "Sistema preenche automaticamente: Id_Conglomerado, Id_Usuario_Criacao, Dt_Criacao, Fl_Excluido = 0"
          required: true
        - id: "FP-UC01-015"
          title: "Sistema persiste registro no banco de dados"
          required: true
        - id: "FP-UC01-016"
          title: "Sistema registra auditoria em Sistema_Parametro_Historico (tipo CREATE)"
          required: true
        - id: "FP-UC01-017"
          title: "Sistema invalida cache de configurações"
          required: true
        - id: "FP-UC01-018"
          title: "Sistema publica evento parametro.criado"
          required: true
        - id: "FP-UC01-019"
          title: "Sistema exibe mensagem de sucesso e redireciona para tela de visualização"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar e criar outro - Sistema salva, exibe mensagem de sucesso e limpa formulário"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação - Sistema descarta dados e retorna para listagem"
          required: false
        - id: "FE-UC01-001"
          title: "Erro de validação de campos obrigatórios → Sistema retorna HTTP 400 com lista de erros"
          required: true
        - id: "FE-UC01-002"
          title: "Código de parâmetro duplicado → Sistema retorna HTTP 409"
          required: true
        - id: "FE-UC01-003"
          title: "Valor inválido conforme tipo de dado → Sistema retorna HTTP 400 com mensagem específica"
          required: true
        - id: "FE-UC01-004"
          title: "Valor fora de min/max → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC01-005"
          title: "Valor fora de Opcoes_Validas → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC01-006"
          title: "JSON inválido → Sistema retorna HTTP 400 com erro de parsing"
          required: true
        - id: "FE-UC01-007"
          title: "Regex inválido → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC01-008"
          title: "Erro inesperado ao salvar → Sistema retorna HTTP 500, registra erro em log"
          required: true

    precondicoes:
      - permissao: "SYS.PARAMETROS.CREATE"

    gatilho: "Usuario clica em Criar Novo Parametro"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 2
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 3
        ator: "usuario"
        acao: "salvar"
      - passo: 4
        ator: "sistema"
        acao: "validar_dados"
      - passo: 5
        ator: "sistema"
        acao: "criptografar_sensiveis"
      - passo: 6
        ator: "sistema"
        acao: "persistir_registro"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 8
        ator: "sistema"
        acao: "invalidar_cache"
      - passo: 9
        ator: "sistema"
        acao: "publicar_evento"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_http_400"
      - id: "FE-UC01-02"
        condicao: "codigo_duplicado"
        resultado: "exibir_erro_http_409"
      - id: "FE-UC01-03"
        condicao: "valor_invalido"
        resultado: "exibir_erro_http_400"

    regras_aplicadas:
      - "RN-SYS-001-01"
      - "RN-SYS-001-02"
      - "RN-SYS-001-04"
      - "RN-SYS-001-05"
      - "RN-SYS-001-06"
      - "RN-SYS-001-07"
      - "RN-SYS-001-14"

    resultado_final:
      estado: "registro_criado_auditado_cache_invalidado"

  - id: "UC02"
    nome: "Visualizar Sistema_Parametro"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-03"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-04"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona parâmetro na listagem ou acessa URL direta"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão SYS.PARAMETROS.VIEW"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida que parâmetro pertence ao tenant do usuário autenticado (Id_Conglomerado)"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados completos do parâmetro"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema verifica se parâmetro é sensível (Fl_Sensivel = 1)"
          required: true
        - id: "FP-UC02-006"
          title: "Se parâmetro sensível E usuário NÃO tem permissão SYS.PARAMETROS.VIEW_SENSITIVE → Máscaras valor"
          required: true
        - id: "FP-UC02-007"
          title: "Se parâmetro sensível E usuário tem permissão SYS.PARAMETROS.VIEW_SENSITIVE → Descriptografa valor e registra auditoria tipo ACCESS"
          required: true
        - id: "FP-UC02-008"
          title: "Sistema exibe dados completos do parâmetro"
          required: true
        - id: "FP-UC02-009"
          title: "Sistema exibe metadados de auditoria (Id_Usuario_Criacao, Dt_Criacao, Id_Usuario_Atualizacao, Dt_Atualizacao)"
          required: true
        - id: "FP-UC02-010"
          title: "Sistema exibe botões de ação: 'Editar', 'Excluir' (conforme permissões)"
          required: true
        - id: "FA-UC02-001"
          title: "Visualizar histórico de alterações - Usuário clica em 'Histórico' → Sistema exibe lista de Sistema_Parametro_Historico"
          required: false
        - id: "FE-UC02-001"
          title: "Registro inexistente → Sistema retorna HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Registro de outro tenant → Sistema retorna HTTP 404"
          required: true
        - id: "FE-UC02-003"
          title: "Usuário sem permissão SYS.PARAMETROS.VIEW → Sistema retorna HTTP 403"
          required: true

    precondicoes:
      - permissao: "SYS.PARAMETROS.VIEW"

    gatilho: "Usuario seleciona parametro na listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_parametro"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "sistema"
        acao: "verificar_sensivel_descriptografar_ou_mascarar"
      - passo: 6
        ator: "sistema"
        acao: "exibir_dados"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "registro_inexistente"
        resultado: "http_404"
      - id: "FE-UC02-02"
        condicao: "outro_tenant"
        resultado: "http_404"
      - id: "FE-UC02-03"
        condicao: "sem_permissao"
        resultado: "http_403"

    regras_aplicadas:
      - "RN-SYS-001-04"
      - "RN-SYS-001-07"
      - "RN-SYS-001-14"

    resultado_final:
      estado: "dados_exibidos_conforme_permissoes"

  - id: "UC03"
    nome: "Editar Sistema_Parametro"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-04"
        - "RF-VAL-01"
        - "RF-VAL-03"
        - "RF-VAL-04"
        - "RF-VAL-05"
        - "RF-VAL-06"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-03"
        - "RF-SEC-05"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário clica em 'Editar' na tela de visualização ou listagem"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão SYS.PARAMETROS.UPDATE"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida que parâmetro pertence ao tenant do usuário autenticado (Id_Conglomerado)"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema verifica se parâmetro é de sistema (Fl_Sistema)"
          required: true
        - id: "FP-UC03-005"
          title: "Se Fl_Sistema = 1 → Sistema permite editar apenas valor (campos metadados bloqueados)"
          required: true
        - id: "FP-UC03-006"
          title: "Se Fl_Sistema = 0 → Sistema permite editar todos os campos exceto Cd_Parametro e Id_Conglomerado"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema carrega dados atuais no formulário"
          required: true
        - id: "FP-UC03-008"
          title: "Usuário altera dados (valor, descrição, validações, flags)"
          required: true
        - id: "FP-UC03-009"
          title: "Usuário clica em 'Salvar'"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema valida campos obrigatórios (RN-SYS-001-06)"
          required: true
        - id: "FP-UC03-011"
          title: "Sistema valida valor conforme tipo de dado (RN-SYS-001-02)"
          required: true
        - id: "FP-UC03-012"
          title: "Sistema valida regex se Regex_Validacao especificado (RN-SYS-001-02)"
          required: true
        - id: "FP-UC03-013"
          title: "Sistema valida valor dentro de min/max se especificado (RN-SYS-001-02)"
          required: true
        - id: "FP-UC03-014"
          title: "Sistema valida valor dentro de Opcoes_Validas se especificado (RN-SYS-001-05)"
          required: true
        - id: "FP-UC03-015"
          title: "Sistema criptografa valor se Fl_Sensivel = 1 (RN-SYS-001-04)"
          required: true
        - id: "FP-UC03-016"
          title: "Sistema captura estado anterior do registro (JSON completo)"
          required: true
        - id: "FP-UC03-017"
          title: "Sistema preenche automaticamente: Id_Usuario_Atualizacao, Dt_Atualizacao"
          required: true
        - id: "FP-UC03-018"
          title: "Sistema persiste alterações no banco de dados"
          required: true
        - id: "FP-UC03-019"
          title: "Sistema registra auditoria em Sistema_Parametro_Historico (tipo UPDATE, diff JSON)"
          required: true
        - id: "FP-UC03-020"
          title: "Sistema invalida cache de configurações"
          required: true
        - id: "FP-UC03-021"
          title: "Sistema publica evento parametro.atualizado"
          required: true
        - id: "FP-UC03-022"
          title: "Sistema exibe mensagem de sucesso e redireciona para tela de visualização"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição - Usuário clica em 'Cancelar' → Sistema descarta alterações"
          required: false
        - id: "FE-UC03-001"
          title: "Tentativa de editar parâmetro de sistema (Fl_Sistema = 1) com campos metadados alterados → HTTP 403"
          required: true
        - id: "FE-UC03-002"
          title: "Erro de validação de campos obrigatórios → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC03-003"
          title: "Valor inválido conforme tipo de dado → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC03-004"
          title: "Valor fora de min/max → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC03-005"
          title: "Valor fora de Opcoes_Validas → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC03-006"
          title: "JSON inválido → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC03-007"
          title: "Regex inválido → Sistema retorna HTTP 400"
          required: true
        - id: "FE-UC03-008"
          title: "Conflito de edição concorrente (Optimistic Concurrency) → Sistema retorna HTTP 409"
          required: true
        - id: "FE-UC03-009"
          title: "Tentativa de editar parâmetro de outro tenant → Sistema retorna HTTP 404"
          required: true

    precondicoes:
      - permissao: "SYS.PARAMETROS.UPDATE"

    gatilho: "Usuario clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_edicao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "verificar_fl_sistema"
      - passo: 5
        ator: "sistema"
        acao: "carregar_formulario"
      - passo: 6
        ator: "usuario"
        acao: "alterar_dados"
      - passo: 7
        ator: "usuario"
        acao: "salvar"
      - passo: 8
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 9
        ator: "sistema"
        acao: "capturar_estado_anterior"
      - passo: 10
        ator: "sistema"
        acao: "persistir_alteracoes"
      - passo: 11
        ator: "sistema"
        acao: "registrar_auditoria_diff_json"
      - passo: 12
        ator: "sistema"
        acao: "invalidar_cache"
      - passo: 13
        ator: "sistema"
        acao: "publicar_evento"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "edicao_fl_sistema_metadados"
        resultado: "http_403"
      - id: "FE-UC03-02"
        condicao: "validacao_falhou"
        resultado: "http_400"
      - id: "FE-UC03-03"
        condicao: "conflito_concorrencia"
        resultado: "http_409"
      - id: "FE-UC03-04"
        condicao: "outro_tenant"
        resultado: "http_404"

    regras_aplicadas:
      - "RN-SYS-001-02"
      - "RN-SYS-001-03"
      - "RN-SYS-001-04"
      - "RN-SYS-001-05"
      - "RN-SYS-001-06"
      - "RN-SYS-001-07"
      - "RN-SYS-001-14"

    resultado_final:
      estado: "registro_atualizado_auditado_cache_invalidado"

  - id: "UC04"
    nome: "Excluir Sistema_Parametro"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-05"
        - "RF-SEC-01"
        - "RF-SEC-02"
        - "RF-SEC-05"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário clica em 'Excluir' na tela de visualização ou listagem"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão SYS.PARAMETROS.DELETE"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida que parâmetro pertence ao tenant do usuário autenticado (Id_Conglomerado)"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema verifica se parâmetro é de sistema (Fl_Sistema)"
          required: true
        - id: "FP-UC04-005"
          title: "Se Fl_Sistema = 1 → Sistema retorna HTTP 403 (parâmetros de sistema não podem ser excluídos)"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema exibe modal de confirmação: 'Tem certeza que deseja excluir o parâmetro {Cd_Parametro}?'"
          required: true
        - id: "FP-UC04-007"
          title: "Usuário confirma exclusão"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema executa soft delete: Fl_Excluido = 1, Dt_Exclusao = timestamp atual, Id_Usuario_Exclusao = ID do usuário autenticado"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema registra auditoria em Sistema_Parametro_Historico (tipo DELETE, valor anterior = JSON completo, valor novo = NULL)"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema invalida cache de configurações"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema publica evento parametro.excluido"
          required: true
        - id: "FP-UC04-012"
          title: "Sistema exibe mensagem de sucesso e redireciona para listagem"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar exclusão - Usuário clica em 'Cancelar' no modal → Sistema fecha modal sem executar exclusão"
          required: false
        - id: "FE-UC04-001"
          title: "Tentativa de excluir parâmetro de sistema (Fl_Sistema = 1) → Sistema retorna HTTP 403"
          required: true
        - id: "FE-UC04-002"
          title: "Registro já excluído (Fl_Excluido = 1) → Sistema retorna HTTP 404"
          required: true
        - id: "FE-UC04-003"
          title: "Tentativa de excluir parâmetro de outro tenant → Sistema retorna HTTP 404"
          required: true
        - id: "FE-UC04-004"
          title: "Usuário sem permissão SYS.PARAMETROS.DELETE → Sistema retorna HTTP 403"
          required: true

    precondicoes:
      - permissao: "SYS.PARAMETROS.DELETE"

    gatilho: "Usuario clica em Excluir"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "solicitar_exclusao"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "verificar_fl_sistema"
      - passo: 5
        ator: "sistema"
        acao: "exibir_modal_confirmacao"
      - passo: 6
        ator: "usuario"
        acao: "confirmar_exclusao"
      - passo: 7
        ator: "sistema"
        acao: "executar_soft_delete"
      - passo: 8
        ator: "sistema"
        acao: "registrar_auditoria_delete"
      - passo: 9
        ator: "sistema"
        acao: "invalidar_cache"
      - passo: 10
        ator: "sistema"
        acao: "publicar_evento"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "fl_sistema_true"
        resultado: "http_403"
      - id: "FE-UC04-02"
        condicao: "ja_excluido"
        resultado: "http_404"
      - id: "FE-UC04-03"
        condicao: "outro_tenant"
        resultado: "http_404"
      - id: "FE-UC04-04"
        condicao: "sem_permissao"
        resultado: "http_403"

    regras_aplicadas:
      - "RN-SYS-001-03"
      - "RN-SYS-001-07"
      - "RN-SYS-001-14"

    resultado_final:
      estado: "registro_soft_deleted_auditado_cache_invalidado"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica orientada a contrato, conformidade 100% com template oficial UC.yaml, cobertura completa de RF001 (5 UCs CRUD, 88 itens covers.uc_items rastreáveis, 15 regras de negócio mapeadas)"
  - versao: "1.0"
    data: "2025-11-03"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão inicial (não conforme ao template)"
