uc:
  rf: RF001
  versao: '2.2'
  data: '2026-01-03'
casos_de_uso:
- id: UC00
  nome: Listar Sistema_Parametro
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC00-001
      title: Usuário acessa a funcionalidade 'Parâmetros do Sistema' pelo menu
      required: true
    - id: FP-UC00-002
      title: Sistema valida permissão SYS.PARAMETROS.VIEW_ANY
      required: true
    - id: FP-UC00-003
      title: Sistema carrega registros do tenant (filtra por Id_Conglomerado do usuário
        autenticado)
      required: true
    - id: FP-UC00-004
      title: Sistema aplica paginação padrão (20 registros por página) e ordenação
        padrão (Cd_Parametro ASC)
      required: true
    - id: FP-UC00-005
      title: Sistema máscaras valores sensíveis (Fl_Sensivel = 1) se usuário não tiver
        permissão SYS.PARAMETROS.VIEW_SENSITIVE
      required: true
    - id: FP-UC00-006
      title: 'Sistema exibe a lista com colunas: Cd_Parametro, Nm_Parametro, Categoria,
        Tipo_Dado, Fl_Sistema, Fl_Sensivel, Ações'
      required: true
    - id: FA-UC00-001
      title: Buscar por termo - Usuário digita termo de busca → Sistema filtra por
        Cd_Parametro, Nm_Parametro ou Ds_Parametro (case-insensitive)
      required: false
    - id: FA-UC00-002
      title: Ordenar por coluna - Usuário clica em cabeçalho de coluna → Sistema alterna
        ordenação ASC/DESC
      required: false
    - id: FA-UC00-003
      title: Filtrar por Categoria - Usuário seleciona categoria (Sistema, Segurança,
        Integração, Notificação, Relatório) → Sistema aplica filtro
      required: false
    - id: FA-UC00-004
      title: Filtrar por Tipo_Dado - Usuário seleciona tipo (String, Integer, Decimal,
        Boolean, Date, JSON) → Sistema aplica filtro
      required: false
    - id: FA-UC00-005
      title: Filtrar apenas parâmetros de sistema (Fl_Sistema = 1) - Usuário marca
        checkbox → Sistema aplica filtro
      required: false
    - id: FA-UC00-006
      title: Exportar lista para CSV - Usuário clica em 'Exportar' → Sistema gera
        CSV (exige permissão SYS.PARAMETROS.EXPORT)
      required: false
    - id: FE-UC00-001
      title: Usuário sem permissão SYS.PARAMETROS.VIEW_ANY → Sistema retorna HTTP
        403
      required: true
    - id: FE-UC00-002
      title: Nenhum registro encontrado → Sistema exibe estado vazio com mensagem
        'Nenhum parâmetro encontrado'
      required: true
    - id: FE-UC00-003
      title: Erro ao carregar registros → Sistema exibe mensagem 'Erro ao carregar
        parâmetros' e registra erro em log
      required: true
  precondicoes:
  - permissao: SYS.PARAMETROS.VIEW_ANY
  gatilho: Usuario acessa a funcionalidade pelo menu
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessa_menu
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: listar_registros_tenant
  - passo: 4
    ator: sistema
    acao: aplicar_paginacao_ordenacao
  - passo: 5
    ator: sistema
    acao: mascarar_valores_sensiveis
  - passo: 6
    ator: sistema
    acao: exibir_lista
  fluxos_alternativos:
  - id: FA-UC00-01
    condicao: usuario_aplica_filtro
    resultado: lista_filtrada
  - id: FA-UC00-02
    condicao: usuario_ordena_coluna
    resultado: lista_ordenada
  - id: FA-UC00-03
    condicao: usuario_exporta_csv
    resultado: arquivo_csv_gerado
  fluxos_excecao:
  - id: FE-UC00-01
    condicao: sem_permissao
    resultado: acesso_negado_http_403
  - id: FE-UC00-02
    condicao: nenhum_registro
    resultado: estado_vazio_exibido
  - id: FE-UC00-03
    condicao: erro_carregar
    resultado: mensagem_erro_exibida
  regras_aplicadas:
  - RN-SYS-001-04
  - RN-SYS-001-14
  resultado_final:
    estado: lista_exibida_com_filtros_paginacao
- id: UC01
  nome: Criar Sistema_Parametro
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-02
    - RN-SYS-001-04
    - RN-SYS-001-05
    - RN-SYS-001-06
    - RN-SYS-001-14
    - RN-SYS-001-15
    uc_items:
    - id: FP-UC01-001
      title: Usuário clica em 'Criar Novo Parâmetro'
      required: true
    - id: FP-UC01-002
      title: Sistema valida permissão SYS.PARAMETROS.CREATE
      required: true
    - id: FP-UC01-003
      title: Sistema exibe formulário de criação com todos os campos
      required: true
    - id: FP-UC01-004
      title: Usuário informa dados obrigatórios (Cd_Parametro, Nm_Parametro, Ds_Parametro,
        Categoria, Tipo_Dado)
      required: true
    - id: FP-UC01-005
      title: Usuário seleciona valor conforme tipo de dado (String, Integer, Decimal,
        Boolean, Date, JSON)
      required: true
    - id: FP-UC01-006
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC01-007
      title: Sistema valida campos obrigatórios (RN-SYS-001-06)
      required: true
    - id: FP-UC01-008
      title: Sistema valida unicidade de Cd_Parametro no tenant (RN-SYS-001-01)
      required: true
    - id: FP-UC01-009
      title: Sistema valida valor conforme tipo de dado (RN-SYS-001-02)
      required: true
    - id: FP-UC01-010
      title: Sistema valida regex se Regex_Validacao especificado (RN-SYS-001-02)
      required: true
    - id: FP-UC01-011
      title: Sistema valida valor dentro de min/max se especificado (RN-SYS-001-02)
      required: true
    - id: FP-UC01-012
      title: Sistema valida valor dentro de Opcoes_Validas se especificado (RN-SYS-001-05)
      required: true
    - id: FP-UC01-013
      title: Sistema criptografa valor se Fl_Sensivel = 1 (RN-SYS-001-04)
      required: true
    - id: FP-UC01-014
      title: 'Sistema preenche automaticamente: Id_Conglomerado, Id_Usuario_Criacao,
        Dt_Criacao, Fl_Excluido = 0'
      required: true
    - id: FP-UC01-015
      title: Sistema persiste registro no banco de dados
      required: true
    - id: FP-UC01-016
      title: Sistema registra auditoria em Sistema_Parametro_Historico (tipo CREATE)
      required: true
    - id: FP-UC01-017
      title: Sistema invalida cache de configurações
      required: true
    - id: FP-UC01-018
      title: Sistema publica evento parametro.criado
      required: true
    - id: FP-UC01-019
      title: Sistema exibe mensagem de sucesso e redireciona para tela de visualização
      required: true
    - id: FA-UC01-001
      title: Salvar e criar outro - Sistema salva, exibe mensagem de sucesso e limpa
        formulário
      required: false
    - id: FA-UC01-002
      title: Cancelar criação - Sistema descarta dados e retorna para listagem
      required: false
    - id: FE-UC01-001
      title: Erro de validação de campos obrigatórios → Sistema retorna HTTP 400 com
        lista de erros
      required: true
    - id: FE-UC01-002
      title: Código de parâmetro duplicado → Sistema retorna HTTP 409
      required: true
    - id: FE-UC01-003
      title: Valor inválido conforme tipo de dado → Sistema retorna HTTP 400 com mensagem
        específica
      required: true
    - id: FE-UC01-004
      title: Valor fora de min/max → Sistema retorna HTTP 400
      required: true
    - id: FE-UC01-005
      title: Valor fora de Opcoes_Validas → Sistema retorna HTTP 400
      required: true
    - id: FE-UC01-006
      title: JSON inválido → Sistema retorna HTTP 400 com erro de parsing
      required: true
    - id: FE-UC01-007
      title: Regex inválido → Sistema retorna HTTP 400
      required: true
    - id: FE-UC01-008
      title: Erro inesperado ao salvar → Sistema retorna HTTP 500, registra erro em
        log
      required: true
  precondicoes:
  - permissao: SYS.PARAMETROS.CREATE
  gatilho: Usuario clica em Criar Novo Parametro
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: exibir_formulario
  - passo: 2
    ator: usuario
    acao: preencher_campos
  - passo: 3
    ator: usuario
    acao: salvar
  - passo: 4
    ator: sistema
    acao: validar_dados
  - passo: 5
    ator: sistema
    acao: criptografar_sensiveis
  - passo: 6
    ator: sistema
    acao: persistir_registro
  - passo: 7
    ator: sistema
    acao: registrar_auditoria
  - passo: 8
    ator: sistema
    acao: invalidar_cache
  - passo: 9
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC01-01
    condicao: validacao_falhou
    resultado: exibir_erros_http_400
  - id: FE-UC01-02
    condicao: codigo_duplicado
    resultado: exibir_erro_http_409
  - id: FE-UC01-03
    condicao: valor_invalido
    resultado: exibir_erro_http_400
  regras_aplicadas:
  - RN-SYS-001-01
  - RN-SYS-001-02
  - RN-SYS-001-04
  - RN-SYS-001-05
  - RN-SYS-001-06
  - RN-SYS-001-07
  - RN-SYS-001-14
  resultado_final:
    estado: registro_criado_auditado_cache_invalidado
- id: UC02
  nome: Visualizar Sistema_Parametro
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-07
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC02-001
      title: Usuário seleciona parâmetro na listagem ou acessa URL direta
      required: true
    - id: FP-UC02-002
      title: Sistema valida permissão SYS.PARAMETROS.VIEW
      required: true
    - id: FP-UC02-003
      title: Sistema valida que parâmetro pertence ao tenant do usuário autenticado
        (Id_Conglomerado)
      required: true
    - id: FP-UC02-004
      title: Sistema carrega dados completos do parâmetro
      required: true
    - id: FP-UC02-005
      title: Sistema verifica se parâmetro é sensível (Fl_Sensivel = 1)
      required: true
    - id: FP-UC02-006
      title: Se parâmetro sensível E usuário NÃO tem permissão SYS.PARAMETROS.VIEW_SENSITIVE
        → Máscaras valor
      required: true
    - id: FP-UC02-007
      title: Se parâmetro sensível E usuário tem permissão SYS.PARAMETROS.VIEW_SENSITIVE
        → Descriptografa valor e registra auditoria tipo ACCESS
      required: true
    - id: FP-UC02-008
      title: Sistema exibe dados completos do parâmetro
      required: true
    - id: FP-UC02-009
      title: Sistema exibe metadados de auditoria (Id_Usuario_Criacao, Dt_Criacao,
        Id_Usuario_Atualizacao, Dt_Atualizacao)
      required: true
    - id: FP-UC02-010
      title: 'Sistema exibe botões de ação: ''Editar'', ''Excluir'' (conforme permissões)'
      required: true
    - id: FA-UC02-001
      title: Visualizar histórico de alterações - Usuário clica em 'Histórico' → Sistema
        exibe lista de Sistema_Parametro_Historico
      required: false
    - id: FE-UC02-001
      title: Registro inexistente → Sistema retorna HTTP 404
      required: true
    - id: FE-UC02-002
      title: Registro de outro tenant → Sistema retorna HTTP 404
      required: true
    - id: FE-UC02-003
      title: Usuário sem permissão SYS.PARAMETROS.VIEW → Sistema retorna HTTP 403
      required: true
  precondicoes:
  - permissao: SYS.PARAMETROS.VIEW
  gatilho: Usuario seleciona parametro na listagem
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: selecionar_parametro
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: validar_tenant
  - passo: 4
    ator: sistema
    acao: carregar_dados
  - passo: 5
    ator: sistema
    acao: verificar_sensivel_descriptografar_ou_mascarar
  - passo: 6
    ator: sistema
    acao: exibir_dados
  fluxos_excecao:
  - id: FE-UC02-01
    condicao: registro_inexistente
    resultado: http_404
  - id: FE-UC02-02
    condicao: outro_tenant
    resultado: http_404
  - id: FE-UC02-03
    condicao: sem_permissao
    resultado: http_403
  regras_aplicadas:
  - RN-SYS-001-04
  - RN-SYS-001-07
  - RN-SYS-001-14
  resultado_final:
    estado: dados_exibidos_conforme_permissoes
- id: UC03
  nome: Editar Sistema_Parametro
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-02
    - RN-SYS-001-03
    - RN-SYS-001-04
    - RN-SYS-001-05
    - RN-SYS-001-06
    - RN-SYS-001-07
    - RN-SYS-001-14
    - RN-SYS-001-15
    uc_items:
    - id: FP-UC03-001
      title: Usuário clica em 'Editar' na tela de visualização ou listagem
      required: true
    - id: FP-UC03-002
      title: Sistema valida permissão SYS.PARAMETROS.UPDATE
      required: true
    - id: FP-UC03-003
      title: Sistema valida que parâmetro pertence ao tenant do usuário autenticado
        (Id_Conglomerado)
      required: true
    - id: FP-UC03-004
      title: Sistema verifica se parâmetro é de sistema (Fl_Sistema)
      required: true
    - id: FP-UC03-005
      title: Se Fl_Sistema = 1 → Sistema permite editar apenas valor (campos metadados
        bloqueados)
      required: true
    - id: FP-UC03-006
      title: Se Fl_Sistema = 0 → Sistema permite editar todos os campos exceto Cd_Parametro
        e Id_Conglomerado
      required: true
    - id: FP-UC03-007
      title: Sistema carrega dados atuais no formulário
      required: true
    - id: FP-UC03-008
      title: Usuário altera dados (valor, descrição, validações, flags)
      required: true
    - id: FP-UC03-009
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC03-010
      title: Sistema valida campos obrigatórios (RN-SYS-001-06)
      required: true
    - id: FP-UC03-011
      title: Sistema valida valor conforme tipo de dado (RN-SYS-001-02)
      required: true
    - id: FP-UC03-012
      title: Sistema valida regex se Regex_Validacao especificado (RN-SYS-001-02)
      required: true
    - id: FP-UC03-013
      title: Sistema valida valor dentro de min/max se especificado (RN-SYS-001-02)
      required: true
    - id: FP-UC03-014
      title: Sistema valida valor dentro de Opcoes_Validas se especificado (RN-SYS-001-05)
      required: true
    - id: FP-UC03-015
      title: Sistema criptografa valor se Fl_Sensivel = 1 (RN-SYS-001-04)
      required: true
    - id: FP-UC03-016
      title: Sistema captura estado anterior do registro (JSON completo)
      required: true
    - id: FP-UC03-017
      title: 'Sistema preenche automaticamente: Id_Usuario_Atualizacao, Dt_Atualizacao'
      required: true
    - id: FP-UC03-018
      title: Sistema persiste alterações no banco de dados
      required: true
    - id: FP-UC03-019
      title: Sistema registra auditoria em Sistema_Parametro_Historico (tipo UPDATE,
        diff JSON)
      required: true
    - id: FP-UC03-020
      title: Sistema invalida cache de configurações
      required: true
    - id: FP-UC03-021
      title: Sistema publica evento parametro.atualizado
      required: true
    - id: FP-UC03-022
      title: Sistema exibe mensagem de sucesso e redireciona para tela de visualização
      required: true
    - id: FA-UC03-001
      title: Cancelar edição - Usuário clica em 'Cancelar' → Sistema descarta alterações
      required: false
    - id: FE-UC03-001
      title: Tentativa de editar parâmetro de sistema (Fl_Sistema = 1) com campos
        metadados alterados → HTTP 403
      required: true
    - id: FE-UC03-002
      title: Erro de validação de campos obrigatórios → Sistema retorna HTTP 400
      required: true
    - id: FE-UC03-003
      title: Valor inválido conforme tipo de dado → Sistema retorna HTTP 400
      required: true
    - id: FE-UC03-004
      title: Valor fora de min/max → Sistema retorna HTTP 400
      required: true
    - id: FE-UC03-005
      title: Valor fora de Opcoes_Validas → Sistema retorna HTTP 400
      required: true
    - id: FE-UC03-006
      title: JSON inválido → Sistema retorna HTTP 400
      required: true
    - id: FE-UC03-007
      title: Regex inválido → Sistema retorna HTTP 400
      required: true
    - id: FE-UC03-008
      title: Conflito de edição concorrente (Optimistic Concurrency) → Sistema retorna
        HTTP 409
      required: true
    - id: FE-UC03-009
      title: Tentativa de editar parâmetro de outro tenant → Sistema retorna HTTP
        404
      required: true
  precondicoes:
  - permissao: SYS.PARAMETROS.UPDATE
  gatilho: Usuario clica em Editar
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_edicao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: validar_tenant
  - passo: 4
    ator: sistema
    acao: verificar_fl_sistema
  - passo: 5
    ator: sistema
    acao: carregar_formulario
  - passo: 6
    ator: usuario
    acao: alterar_dados
  - passo: 7
    ator: usuario
    acao: salvar
  - passo: 8
    ator: sistema
    acao: validar_alteracoes
  - passo: 9
    ator: sistema
    acao: capturar_estado_anterior
  - passo: 10
    ator: sistema
    acao: persistir_alteracoes
  - passo: 11
    ator: sistema
    acao: registrar_auditoria_diff_json
  - passo: 12
    ator: sistema
    acao: invalidar_cache
  - passo: 13
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC03-01
    condicao: edicao_fl_sistema_metadados
    resultado: http_403
  - id: FE-UC03-02
    condicao: validacao_falhou
    resultado: http_400
  - id: FE-UC03-03
    condicao: conflito_concorrencia
    resultado: http_409
  - id: FE-UC03-04
    condicao: outro_tenant
    resultado: http_404
  regras_aplicadas:
  - RN-SYS-001-02
  - RN-SYS-001-03
  - RN-SYS-001-04
  - RN-SYS-001-05
  - RN-SYS-001-06
  - RN-SYS-001-07
  - RN-SYS-001-14
  resultado_final:
    estado: registro_atualizado_auditado_cache_invalidado
- id: UC04
  nome: Excluir Sistema_Parametro
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-03
    - RN-SYS-001-07
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC04-001
      title: Usuário clica em 'Excluir' na tela de visualização ou listagem
      required: true
    - id: FP-UC04-002
      title: Sistema valida permissão SYS.PARAMETROS.DELETE
      required: true
    - id: FP-UC04-003
      title: Sistema valida que parâmetro pertence ao tenant do usuário autenticado
        (Id_Conglomerado)
      required: true
    - id: FP-UC04-004
      title: Sistema verifica se parâmetro é de sistema (Fl_Sistema)
      required: true
    - id: FP-UC04-005
      title: Se Fl_Sistema = 1 → Sistema retorna HTTP 403 (parâmetros de sistema não
        podem ser excluídos)
      required: true
    - id: FP-UC04-006
      title: 'Sistema exibe modal de confirmação: ''Tem certeza que deseja excluir
        o parâmetro {Cd_Parametro}?'''
      required: true
    - id: FP-UC04-007
      title: Usuário confirma exclusão
      required: true
    - id: FP-UC04-008
      title: 'Sistema executa soft delete: Fl_Excluido = 1, Dt_Exclusao = timestamp
        atual, Id_Usuario_Exclusao = ID do usuário autenticado'
      required: true
    - id: FP-UC04-009
      title: Sistema registra auditoria em Sistema_Parametro_Historico (tipo DELETE,
        valor anterior = JSON completo, valor novo = NULL)
      required: true
    - id: FP-UC04-010
      title: Sistema invalida cache de configurações
      required: true
    - id: FP-UC04-011
      title: Sistema publica evento parametro.excluido
      required: true
    - id: FP-UC04-012
      title: Sistema exibe mensagem de sucesso e redireciona para listagem
      required: true
    - id: FA-UC04-001
      title: Cancelar exclusão - Usuário clica em 'Cancelar' no modal → Sistema fecha
        modal sem executar exclusão
      required: false
    - id: FE-UC04-001
      title: Tentativa de excluir parâmetro de sistema (Fl_Sistema = 1) → Sistema
        retorna HTTP 403
      required: true
    - id: FE-UC04-002
      title: Registro já excluído (Fl_Excluido = 1) → Sistema retorna HTTP 404
      required: true
    - id: FE-UC04-003
      title: Tentativa de excluir parâmetro de outro tenant → Sistema retorna HTTP
        404
      required: true
    - id: FE-UC04-004
      title: Usuário sem permissão SYS.PARAMETROS.DELETE → Sistema retorna HTTP 403
      required: true
  precondicoes:
  - permissao: SYS.PARAMETROS.DELETE
  gatilho: Usuario clica em Excluir
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_exclusao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: validar_tenant
  - passo: 4
    ator: sistema
    acao: verificar_fl_sistema
  - passo: 5
    ator: sistema
    acao: exibir_modal_confirmacao
  - passo: 6
    ator: usuario
    acao: confirmar_exclusao
  - passo: 7
    ator: sistema
    acao: executar_soft_delete
  - passo: 8
    ator: sistema
    acao: registrar_auditoria_delete
  - passo: 9
    ator: sistema
    acao: invalidar_cache
  - passo: 10
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC04-01
    condicao: fl_sistema_true
    resultado: http_403
  - id: FE-UC04-02
    condicao: ja_excluido
    resultado: http_404
  - id: FE-UC04-03
    condicao: outro_tenant
    resultado: http_404
  - id: FE-UC04-04
    condicao: sem_permissao
    resultado: http_403
  regras_aplicadas:
  - RN-SYS-001-03
  - RN-SYS-001-07
  - RN-SYS-001-14
  resultado_final:
    estado: registro_soft_deleted_auditado_cache_invalidado
- id: UC05
  nome: Listar Sistema_Feature_Flag
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-08
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC05-001
      title: Usuário acessa a funcionalidade 'Feature Flags' pelo menu
      required: true
    - id: FP-UC05-002
      title: Sistema valida permissão SYS.FEATUREFLAGS.VIEW_ANY
      required: true
    - id: FP-UC05-003
      title: Sistema carrega flags do tenant + flags globais (Id_Conglomerado = NULL)
      required: true
    - id: FP-UC05-004
      title: Sistema aplica paginação padrão (20 registros por página) e ordenação
        padrão (Cd_Feature ASC)
      required: true
    - id: FP-UC05-005
      title: 'Sistema exibe lista com colunas: Cd_Feature, Nm_Feature, Fl_Ativa, Tipo_Rollout,
        Escopo (Global/Tenant), Ações'
      required: true
    - id: FA-UC05-001
      title: Buscar por termo - Usuário digita termo → Sistema filtra por Cd_Feature
        ou Nm_Feature
      required: false
    - id: FA-UC05-002
      title: Filtrar apenas flags ativas (Fl_Ativa = 1) - Usuário marca checkbox →
        Sistema aplica filtro
      required: false
    - id: FA-UC05-003
      title: Filtrar por Tipo_Rollout (All, Percentage, UserList, DateRange) - Usuário
        seleciona tipo → Sistema aplica filtro
      required: false
    - id: FA-UC05-004
      title: Filtrar por escopo (Global, Tenant) - Usuário seleciona escopo → Sistema
        aplica filtro
      required: false
    - id: FE-UC05-001
      title: Usuário sem permissão SYS.FEATUREFLAGS.VIEW_ANY → Sistema retorna HTTP
        403
      required: true
    - id: FE-UC05-002
      title: Nenhum registro encontrado → Sistema exibe estado vazio 'Nenhuma feature
        flag encontrada'
      required: true
  precondicoes:
  - permissao: SYS.FEATUREFLAGS.VIEW_ANY
  gatilho: Usuario acessa Feature Flags pelo menu
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessa_menu
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: listar_flags_tenant_e_globais
  - passo: 4
    ator: sistema
    acao: aplicar_paginacao_ordenacao
  - passo: 5
    ator: sistema
    acao: exibir_lista
  fluxos_alternativos:
  - id: FA-UC05-01
    condicao: usuario_aplica_filtro
    resultado: lista_filtrada
  fluxos_excecao:
  - id: FE-UC05-01
    condicao: sem_permissao
    resultado: http_403
  - id: FE-UC05-02
    condicao: nenhum_registro
    resultado: estado_vazio
  regras_aplicadas:
  - RN-SYS-001-08
  - RN-SYS-001-14
  resultado_final:
    estado: lista_flags_exibida
- id: UC06
  nome: Criar Sistema_Feature_Flag
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-06
    - RN-SYS-001-08
    - RN-SYS-001-09
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC06-001
      title: Usuário clica em 'Criar Nova Feature Flag'
      required: true
    - id: FP-UC06-002
      title: Sistema valida permissão SYS.FEATUREFLAGS.CREATE
      required: true
    - id: FP-UC06-003
      title: 'Sistema exibe formulário: Cd_Feature, Nm_Feature, Ds_Feature, Fl_Ativa,
        Tipo_Rollout, Escopo (Global/Tenant)'
      required: true
    - id: FP-UC06-004
      title: Usuário informa dados obrigatórios (Cd_Feature, Nm_Feature, Ds_Feature,
        Tipo_Rollout)
      required: true
    - id: FP-UC06-005
      title: Se Tipo_Rollout = Percentage → Sistema exibe campo Percentual_Rollout
        (0-100)
      required: true
    - id: FP-UC06-006
      title: Se Tipo_Rollout = UserList → Sistema exibe campo Lista_Usuarios (IDs
        separados por vírgula)
      required: true
    - id: FP-UC06-007
      title: Se Tipo_Rollout = DateRange → Sistema exibe campos Data_Inicio e Data_Fim
      required: true
    - id: FP-UC06-008
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC06-009
      title: Sistema valida campos obrigatórios
      required: true
    - id: FP-UC06-010
      title: Sistema valida unicidade de Cd_Feature no tenant (ou global se escopo
        = Global)
      required: true
    - id: FP-UC06-011
      title: Sistema valida Percentual_Rollout (0-100) se Tipo_Rollout = Percentage
      required: true
    - id: FP-UC06-012
      title: 'Sistema preenche automaticamente: Id_Conglomerado (NULL se global),
        Id_Usuario_Criacao, Dt_Criacao'
      required: true
    - id: FP-UC06-013
      title: Sistema persiste registro
      required: true
    - id: FP-UC06-014
      title: Sistema registra auditoria em Sistema_Feature_Flag_Historico (tipo CREATE)
      required: true
    - id: FP-UC06-015
      title: Sistema invalida cache de feature flags
      required: true
    - id: FP-UC06-016
      title: Sistema publica evento featureflag.criada
      required: true
    - id: FE-UC06-001
      title: Código duplicado → Sistema retorna HTTP 409
      required: true
    - id: FE-UC06-002
      title: Percentual_Rollout fora de 0-100 → Sistema retorna HTTP 400
      required: true
    - id: FE-UC06-003
      title: Erro de validação → Sistema retorna HTTP 400
      required: true
  precondicoes:
  - permissao: SYS.FEATUREFLAGS.CREATE
  gatilho: Usuario clica em Criar Nova Feature Flag
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: exibir_formulario
  - passo: 2
    ator: usuario
    acao: preencher_campos
  - passo: 3
    ator: usuario
    acao: salvar
  - passo: 4
    ator: sistema
    acao: validar_dados
  - passo: 5
    ator: sistema
    acao: persistir_registro
  - passo: 6
    ator: sistema
    acao: registrar_auditoria
  - passo: 7
    ator: sistema
    acao: invalidar_cache
  - passo: 8
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC06-01
    condicao: codigo_duplicado
    resultado: http_409
  - id: FE-UC06-02
    condicao: validacao_falhou
    resultado: http_400
  regras_aplicadas:
  - RN-SYS-001-08
  - RN-SYS-001-09
  - RN-SYS-001-14
  resultado_final:
    estado: feature_flag_criada
- id: UC07
  nome: Visualizar Sistema_Feature_Flag
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-07
    - RN-SYS-001-08
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC07-001
      title: Usuário seleciona feature flag na listagem
      required: true
    - id: FP-UC07-002
      title: Sistema valida permissão SYS.FEATUREFLAGS.VIEW
      required: true
    - id: FP-UC07-003
      title: Sistema carrega dados completos da flag
      required: true
    - id: FP-UC07-004
      title: 'Sistema exibe dados: Cd_Feature, Nm_Feature, Ds_Feature, Fl_Ativa, Tipo_Rollout,
        configurações de rollout, Escopo'
      required: true
    - id: FP-UC07-005
      title: Sistema exibe metadados de auditoria
      required: true
    - id: FP-UC07-006
      title: Sistema exibe botões 'Editar' e 'Excluir' conforme permissões
      required: true
    - id: FE-UC07-001
      title: Registro inexistente → Sistema retorna HTTP 404
      required: true
    - id: FE-UC07-002
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
  precondicoes:
  - permissao: SYS.FEATUREFLAGS.VIEW
  gatilho: Usuario seleciona feature flag
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: selecionar_flag
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_dados
  - passo: 4
    ator: sistema
    acao: exibir_dados
  fluxos_excecao:
  - id: FE-UC07-01
    condicao: registro_inexistente
    resultado: http_404
  - id: FE-UC07-02
    condicao: sem_permissao
    resultado: http_403
  regras_aplicadas:
  - RN-SYS-001-08
  - RN-SYS-001-14
  resultado_final:
    estado: dados_flag_exibidos
- id: UC08
  nome: Editar Sistema_Feature_Flag
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-02
    - RN-SYS-001-04
    - RN-SYS-001-05
    - RN-SYS-001-06
    - RN-SYS-001-07
    - RN-SYS-001-08
    - RN-SYS-001-09
    - RN-SYS-001-14
    - RN-SYS-001-15
    uc_items:
    - id: FP-UC08-001
      title: Usuário clica em 'Editar' na tela de visualização
      required: true
    - id: FP-UC08-002
      title: Sistema valida permissão SYS.FEATUREFLAGS.UPDATE
      required: true
    - id: FP-UC08-003
      title: Sistema carrega dados atuais no formulário
      required: true
    - id: FP-UC08-004
      title: Usuário altera dados (Fl_Ativa, Tipo_Rollout, configurações rollout)
      required: true
    - id: FP-UC08-005
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC08-006
      title: Sistema valida alterações
      required: true
    - id: FP-UC08-007
      title: Sistema captura estado anterior (JSON)
      required: true
    - id: FP-UC08-008
      title: Sistema preenche Id_Usuario_Atualizacao, Dt_Atualizacao
      required: true
    - id: FP-UC08-009
      title: Sistema persiste alterações
      required: true
    - id: FP-UC08-010
      title: Sistema registra auditoria (tipo UPDATE, diff JSON)
      required: true
    - id: FP-UC08-011
      title: Sistema invalida cache
      required: true
    - id: FP-UC08-012
      title: Sistema publica evento featureflag.atualizada
      required: true
    - id: FE-UC08-001
      title: Erro de validação → Sistema retorna HTTP 400
      required: true
    - id: FE-UC08-002
      title: Conflito de concorrência → Sistema retorna HTTP 409
      required: true
  precondicoes:
  - permissao: SYS.FEATUREFLAGS.UPDATE
  gatilho: Usuario clica em Editar
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_edicao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_formulario
  - passo: 4
    ator: usuario
    acao: alterar_dados
  - passo: 5
    ator: usuario
    acao: salvar
  - passo: 6
    ator: sistema
    acao: validar_alteracoes
  - passo: 7
    ator: sistema
    acao: capturar_estado_anterior
  - passo: 8
    ator: sistema
    acao: persistir_alteracoes
  - passo: 9
    ator: sistema
    acao: registrar_auditoria_diff_json
  - passo: 10
    ator: sistema
    acao: invalidar_cache
  - passo: 11
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC08-01
    condicao: validacao_falhou
    resultado: http_400
  - id: FE-UC08-02
    condicao: conflito_concorrencia
    resultado: http_409
  regras_aplicadas:
  - RN-SYS-001-08
  - RN-SYS-001-09
  - RN-SYS-001-14
  resultado_final:
    estado: flag_atualizada
- id: UC09
  nome: Excluir Sistema_Feature_Flag
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-03
    - RN-SYS-001-07
    - RN-SYS-001-08
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC09-001
      title: Usuário clica em 'Excluir'
      required: true
    - id: FP-UC09-002
      title: Sistema valida permissão SYS.FEATUREFLAGS.DELETE
      required: true
    - id: FP-UC09-003
      title: Sistema exibe modal de confirmação
      required: true
    - id: FP-UC09-004
      title: Usuário confirma exclusão
      required: true
    - id: FP-UC09-005
      title: 'Sistema executa soft delete: Fl_Excluido = 1, Dt_Exclusao, Id_Usuario_Exclusao'
      required: true
    - id: FP-UC09-006
      title: Sistema registra auditoria (tipo DELETE)
      required: true
    - id: FP-UC09-007
      title: Sistema invalida cache
      required: true
    - id: FP-UC09-008
      title: Sistema publica evento featureflag.excluida
      required: true
    - id: FE-UC09-001
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
    - id: FE-UC09-002
      title: Registro já excluído → Sistema retorna HTTP 404
      required: true
  precondicoes:
  - permissao: SYS.FEATUREFLAGS.DELETE
  gatilho: Usuario clica em Excluir
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_exclusao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: exibir_modal_confirmacao
  - passo: 4
    ator: usuario
    acao: confirmar_exclusao
  - passo: 5
    ator: sistema
    acao: executar_soft_delete
  - passo: 6
    ator: sistema
    acao: registrar_auditoria_delete
  - passo: 7
    ator: sistema
    acao: invalidar_cache
  - passo: 8
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC09-01
    condicao: sem_permissao
    resultado: http_403
  - id: FE-UC09-02
    condicao: ja_excluido
    resultado: http_404
  regras_aplicadas:
  - RN-SYS-001-14
  resultado_final:
    estado: flag_excluida
- id: UC10
  nome: Listar Sistema_Configuracao_Email
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC10-001
      title: Usuário acessa 'Configurações de E-mail' pelo menu
      required: true
    - id: FP-UC10-002
      title: Sistema valida permissão SYS.CONFIGURACOES_EMAIL.VIEW_ANY
      required: true
    - id: FP-UC10-003
      title: Sistema carrega configurações do tenant
      required: true
    - id: FP-UC10-004
      title: Sistema máscaras senhas (campo Senha exibido como '********')
      required: true
    - id: FP-UC10-005
      title: 'Sistema exibe lista: Provedor, Servidor_Smtp, Porta_Smtp, Usuario, Email_Remetente,
        Fl_Principal, Ações'
      required: true
    - id: FP-UC10-006
      title: Sistema destaca configuração principal (Fl_Principal = 1) com badge 'Principal'
      required: true
    - id: FA-UC10-001
      title: Filtrar por Provedor (SMTP, SendGrid, AWS_SES) - Usuário seleciona →
        Sistema aplica filtro
      required: false
    - id: FE-UC10-001
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
    - id: FE-UC10-002
      title: Nenhum registro encontrado → Sistema exibe estado vazio 'Nenhuma configuração
        de e-mail encontrada'
      required: true
  precondicoes:
  - permissao: SYS.CONFIGURACOES_EMAIL.VIEW_ANY
  gatilho: Usuario acessa Configuracoes de Email
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessa_menu
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: listar_configuracoes_tenant
  - passo: 4
    ator: sistema
    acao: mascarar_senhas
  - passo: 5
    ator: sistema
    acao: exibir_lista
  fluxos_alternativos:
  - id: FA-UC10-01
    condicao: usuario_filtra_provedor
    resultado: lista_filtrada
  fluxos_excecao:
  - id: FE-UC10-01
    condicao: sem_permissao
    resultado: http_403
  - id: FE-UC10-02
    condicao: nenhum_registro
    resultado: estado_vazio
  regras_aplicadas:
  - RN-SYS-001-04
  - RN-SYS-001-10
  - RN-SYS-001-14
  resultado_final:
    estado: lista_configuracoes_exibida
- id: UC11
  nome: Criar Sistema_Configuracao_Email
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-04
    - RN-SYS-001-06
    - RN-SYS-001-10
    - RN-SYS-001-11
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC11-001
      title: Usuário clica em 'Criar Nova Configuração de E-mail'
      required: true
    - id: FP-UC11-002
      title: Sistema valida permissão SYS.CONFIGURACOES_EMAIL.CREATE
      required: true
    - id: FP-UC11-003
      title: 'Sistema exibe formulário: Provedor, Servidor_Smtp, Porta_Smtp, Usuario,
        Senha, Fl_Usar_Ssl, Email_Remetente, Nome_Remetente, Fl_Principal'
      required: true
    - id: FP-UC11-004
      title: Usuário seleciona Provedor (SMTP, SendGrid, AWS_SES)
      required: true
    - id: FP-UC11-005
      title: Se Provedor = SMTP → Sistema exige Servidor_Smtp e Porta_Smtp (1-65535)
      required: true
    - id: FP-UC11-006
      title: Usuário informa credenciais (Usuario, Senha)
      required: true
    - id: FP-UC11-007
      title: Usuário informa Email_Remetente e Nome_Remetente
      required: true
    - id: FP-UC11-008
      title: Usuário marca Fl_Principal se esta será a configuração padrão
      required: true
    - id: FP-UC11-009
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC11-010
      title: Sistema valida campos obrigatórios (RN-SYS-001-11)
      required: true
    - id: FP-UC11-011
      title: Sistema valida Porta_Smtp (1-65535) se Provedor = SMTP
      required: true
    - id: FP-UC11-012
      title: Sistema valida formato de Email_Remetente (regex RFC 5322)
      required: true
    - id: FP-UC11-013
      title: Sistema criptografa Senha em AES-256 (RN-SYS-001-04)
      required: true
    - id: FP-UC11-014
      title: Se Fl_Principal = 1 → Sistema desmarca outras configurações do tenant
        (RN-SYS-001-10)
      required: true
    - id: FP-UC11-015
      title: Sistema preenche Id_Conglomerado, Id_Usuario_Criacao, Dt_Criacao
      required: true
    - id: FP-UC11-016
      title: Sistema persiste registro
      required: true
    - id: FP-UC11-017
      title: Sistema registra auditoria (tipo CREATE)
      required: true
    - id: FP-UC11-018
      title: Sistema publica evento configuracao_email.criada
      required: true
    - id: FA-UC11-001
      title: Testar conexão - Usuário clica em 'Testar Conexão' → Sistema tenta enviar
        e-mail de teste e exibe resultado
      required: false
    - id: FE-UC11-001
      title: Erro de validação → Sistema retorna HTTP 400
      required: true
    - id: FE-UC11-002
      title: Porta_Smtp fora de 1-65535 → Sistema retorna HTTP 400
      required: true
    - id: FE-UC11-003
      title: Email_Remetente inválido → Sistema retorna HTTP 400
      required: true
    - id: FE-UC11-004
      title: Erro ao conectar SMTP (teste opcional falhou) → Sistema exibe aviso mas
        permite salvar
      required: true
  precondicoes:
  - permissao: SYS.CONFIGURACOES_EMAIL.CREATE
  gatilho: Usuario clica em Criar Nova Configuracao
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: exibir_formulario
  - passo: 2
    ator: usuario
    acao: preencher_campos
  - passo: 3
    ator: usuario
    acao: salvar
  - passo: 4
    ator: sistema
    acao: validar_dados
  - passo: 5
    ator: sistema
    acao: criptografar_senha
  - passo: 6
    ator: sistema
    acao: desmarcar_outras_principais_se_fl_principal_true
  - passo: 7
    ator: sistema
    acao: persistir_registro
  - passo: 8
    ator: sistema
    acao: registrar_auditoria
  - passo: 9
    ator: sistema
    acao: publicar_evento
  fluxos_alternativos:
  - id: FA-UC11-01
    condicao: usuario_testa_conexao
    resultado: email_teste_enviado_ou_erro_exibido
  fluxos_excecao:
  - id: FE-UC11-01
    condicao: validacao_falhou
    resultado: http_400
  - id: FE-UC11-02
    condicao: porta_invalida
    resultado: http_400
  - id: FE-UC11-03
    condicao: email_invalido
    resultado: http_400
  regras_aplicadas:
  - RN-SYS-001-04
  - RN-SYS-001-10
  - RN-SYS-001-11
  - RN-SYS-001-14
  resultado_final:
    estado: configuracao_email_criada
- id: UC12
  nome: Visualizar Sistema_Configuracao_Email
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-07
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC12-001
      title: Usuário seleciona configuração na listagem
      required: true
    - id: FP-UC12-002
      title: Sistema valida permissão SYS.CONFIGURACOES_EMAIL.VIEW
      required: true
    - id: FP-UC12-003
      title: Sistema carrega dados completos
      required: true
    - id: FP-UC12-004
      title: Sistema máscaras campo Senha ('********') - NÃO descriptografa
      required: true
    - id: FP-UC12-005
      title: 'Sistema exibe dados: Provedor, Servidor_Smtp, Porta_Smtp, Usuario, Email_Remetente,
        Nome_Remetente, Fl_Principal, Fl_Usar_Ssl'
      required: true
    - id: FP-UC12-006
      title: Sistema exibe metadados de auditoria
      required: true
    - id: FE-UC12-001
      title: Registro inexistente → Sistema retorna HTTP 404
      required: true
    - id: FE-UC12-002
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
  precondicoes:
  - permissao: SYS.CONFIGURACOES_EMAIL.VIEW
  gatilho: Usuario seleciona configuracao
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: selecionar_configuracao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_dados
  - passo: 4
    ator: sistema
    acao: mascarar_senha
  - passo: 5
    ator: sistema
    acao: exibir_dados
  fluxos_excecao:
  - id: FE-UC12-01
    condicao: registro_inexistente
    resultado: http_404
  - id: FE-UC12-02
    condicao: sem_permissao
    resultado: http_403
  regras_aplicadas:
  - RN-SYS-001-04
  - RN-SYS-001-14
  resultado_final:
    estado: dados_configuracao_exibidos
- id: UC13
  nome: Editar Sistema_Configuracao_Email
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-02
    - RN-SYS-001-04
    - RN-SYS-001-05
    - RN-SYS-001-06
    - RN-SYS-001-07
    - RN-SYS-001-10
    - RN-SYS-001-11
    - RN-SYS-001-14
    - RN-SYS-001-15
    uc_items:
    - id: FP-UC13-001
      title: Usuário clica em 'Editar'
      required: true
    - id: FP-UC13-002
      title: Sistema valida permissão SYS.CONFIGURACOES_EMAIL.UPDATE
      required: true
    - id: FP-UC13-003
      title: Sistema carrega dados atuais (Senha mascarada '********')
      required: true
    - id: FP-UC13-004
      title: Usuário altera dados (campo Senha só se preenchido, senão mantém atual)
      required: true
    - id: FP-UC13-005
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC13-006
      title: Sistema valida alterações (RN-SYS-001-11)
      required: true
    - id: FP-UC13-007
      title: Se Senha foi alterada → Sistema criptografa nova senha em AES-256
      required: true
    - id: FP-UC13-008
      title: Se Fl_Principal alterado para 1 → Sistema desmarca outras configurações
        do tenant (RN-SYS-001-10)
      required: true
    - id: FP-UC13-009
      title: Sistema captura estado anterior (JSON)
      required: true
    - id: FP-UC13-010
      title: Sistema preenche Id_Usuario_Atualizacao, Dt_Atualizacao
      required: true
    - id: FP-UC13-011
      title: Sistema persiste alterações
      required: true
    - id: FP-UC13-012
      title: Sistema registra auditoria (tipo UPDATE, diff JSON)
      required: true
    - id: FP-UC13-013
      title: Sistema publica evento configuracao_email.atualizada
      required: true
    - id: FE-UC13-001
      title: Erro de validação → Sistema retorna HTTP 400
      required: true
    - id: FE-UC13-002
      title: Conflito de concorrência → Sistema retorna HTTP 409
      required: true
  precondicoes:
  - permissao: SYS.CONFIGURACOES_EMAIL.UPDATE
  gatilho: Usuario clica em Editar
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_edicao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_formulario_senha_mascarada
  - passo: 4
    ator: usuario
    acao: alterar_dados
  - passo: 5
    ator: usuario
    acao: salvar
  - passo: 6
    ator: sistema
    acao: validar_alteracoes
  - passo: 7
    ator: sistema
    acao: criptografar_senha_se_alterada
  - passo: 8
    ator: sistema
    acao: desmarcar_outras_principais_se_necessario
  - passo: 9
    ator: sistema
    acao: capturar_estado_anterior
  - passo: 10
    ator: sistema
    acao: persistir_alteracoes
  - passo: 11
    ator: sistema
    acao: registrar_auditoria_diff_json
  - passo: 12
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC13-01
    condicao: validacao_falhou
    resultado: http_400
  - id: FE-UC13-02
    condicao: conflito_concorrencia
    resultado: http_409
  regras_aplicadas:
  - RN-SYS-001-04
  - RN-SYS-001-10
  - RN-SYS-001-11
  - RN-SYS-001-14
  resultado_final:
    estado: configuracao_email_atualizada
- id: UC14
  nome: Excluir Sistema_Configuracao_Email
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-03
    - RN-SYS-001-07
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC14-001
      title: Usuário clica em 'Excluir'
      required: true
    - id: FP-UC14-002
      title: Sistema valida permissão SYS.CONFIGURACOES_EMAIL.DELETE
      required: true
    - id: FP-UC14-003
      title: Sistema verifica se configuração é principal (Fl_Principal = 1)
      required: true
    - id: FP-UC14-004
      title: Se Fl_Principal = 1 E existem outras configurações → Sistema exibe aviso
        'Esta é a configuração principal. Deseja continuar?'
      required: true
    - id: FP-UC14-005
      title: Sistema exibe modal de confirmação
      required: true
    - id: FP-UC14-006
      title: Usuário confirma exclusão
      required: true
    - id: FP-UC14-007
      title: 'Sistema executa soft delete: Fl_Excluido = 1, Dt_Exclusao, Id_Usuario_Exclusao'
      required: true
    - id: FP-UC14-008
      title: Sistema registra auditoria (tipo DELETE)
      required: true
    - id: FP-UC14-009
      title: Sistema publica evento configuracao_email.excluida
      required: true
    - id: FE-UC14-001
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
    - id: FE-UC14-002
      title: Registro já excluído → Sistema retorna HTTP 404
      required: true
  precondicoes:
  - permissao: SYS.CONFIGURACOES_EMAIL.DELETE
  gatilho: Usuario clica em Excluir
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_exclusao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: verificar_se_principal
  - passo: 4
    ator: sistema
    acao: exibir_modal_confirmacao
  - passo: 5
    ator: usuario
    acao: confirmar_exclusao
  - passo: 6
    ator: sistema
    acao: executar_soft_delete
  - passo: 7
    ator: sistema
    acao: registrar_auditoria_delete
  - passo: 8
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC14-01
    condicao: sem_permissao
    resultado: http_403
  - id: FE-UC14-02
    condicao: ja_excluido
    resultado: http_404
  regras_aplicadas:
  - RN-SYS-001-14
  resultado_final:
    estado: configuracao_email_excluida
- id: UC15
  nome: Listar Sistema_Limite_Uso
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-12
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC15-001
      title: Usuário acessa 'Limites de Uso' pelo menu
      required: true
    - id: FP-UC15-002
      title: Sistema valida permissão SYS.LIMITES_USO.VIEW_ANY
      required: true
    - id: FP-UC15-003
      title: Sistema carrega limites do tenant
      required: true
    - id: FP-UC15-004
      title: Sistema calcula percentual de uso (Uso_Atual / Limite * 100)
      required: true
    - id: FP-UC15-005
      title: 'Sistema exibe lista: Tipo_Limite, Limite, Uso_Atual, Percentual, Status
        (OK/Alerta/Crítico), Ações'
      required: true
    - id: FP-UC15-006
      title: 'Sistema exibe indicador visual: Verde (< Percentual_Alerta), Amarelo
        (>= Percentual_Alerta), Vermelho (>= 100%)'
      required: true
    - id: FA-UC15-001
      title: Filtrar por Tipo_Limite (MAX_USUARIOS, MAX_ATIVOS, MAX_STORAGE_MB, MAX_API_CALLS_DIA)
      required: false
    - id: FA-UC15-002
      title: Filtrar por Status (OK, Alerta, Crítico)
      required: false
    - id: FE-UC15-001
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
    - id: FE-UC15-002
      title: Nenhum registro encontrado → Sistema exibe estado vazio 'Nenhum limite
        configurado'
      required: true
  precondicoes:
  - permissao: SYS.LIMITES_USO.VIEW_ANY
  gatilho: Usuario acessa Limites de Uso
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: acessa_menu
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: listar_limites_tenant
  - passo: 4
    ator: sistema
    acao: calcular_percentuais
  - passo: 5
    ator: sistema
    acao: exibir_lista_com_indicadores
  fluxos_alternativos:
  - id: FA-UC15-01
    condicao: usuario_filtra_tipo_ou_status
    resultado: lista_filtrada
  fluxos_excecao:
  - id: FE-UC15-01
    condicao: sem_permissao
    resultado: http_403
  - id: FE-UC15-02
    condicao: nenhum_registro
    resultado: estado_vazio
  regras_aplicadas:
  - RN-SYS-001-12
  - RN-SYS-001-13
  - RN-SYS-001-14
  resultado_final:
    estado: lista_limites_exibida
- id: UC16
  nome: Criar Sistema_Limite_Uso
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-06
    - RN-SYS-001-12
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC16-001
      title: Usuário clica em 'Criar Novo Limite'
      required: true
    - id: FP-UC16-002
      title: Sistema valida permissão SYS.LIMITES_USO.CREATE
      required: true
    - id: FP-UC16-003
      title: 'Sistema exibe formulário: Tipo_Limite, Limite, Uso_Atual, Percentual_Alerta'
      required: true
    - id: FP-UC16-004
      title: Usuário seleciona Tipo_Limite (MAX_USUARIOS, MAX_ATIVOS, MAX_STORAGE_MB,
        MAX_API_CALLS_DIA)
      required: true
    - id: FP-UC16-005
      title: Usuário informa Limite (valor máximo permitido)
      required: true
    - id: FP-UC16-006
      title: Usuário informa Uso_Atual (valor inicial, geralmente 0)
      required: true
    - id: FP-UC16-007
      title: 'Usuário informa Percentual_Alerta (ex: 80 para alertar aos 80%)'
      required: true
    - id: FP-UC16-008
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC16-009
      title: Sistema valida campos obrigatórios
      required: true
    - id: FP-UC16-010
      title: Sistema valida unicidade de Tipo_Limite no tenant (RN-SYS-001-12)
      required: true
    - id: FP-UC16-011
      title: Sistema valida Limite > 0
      required: true
    - id: FP-UC16-012
      title: Sistema valida Percentual_Alerta (1-100)
      required: true
    - id: FP-UC16-013
      title: Sistema preenche Id_Conglomerado, Id_Usuario_Criacao, Dt_Criacao, Fl_Alerta_Enviado
        = 0
      required: true
    - id: FP-UC16-014
      title: Sistema persiste registro
      required: true
    - id: FP-UC16-015
      title: Sistema registra auditoria (tipo CREATE)
      required: true
    - id: FE-UC16-001
      title: Tipo_Limite duplicado → Sistema retorna HTTP 409 'Já existe limite para
        este tipo'
      required: true
    - id: FE-UC16-002
      title: Limite <= 0 → Sistema retorna HTTP 400
      required: true
    - id: FE-UC16-003
      title: Percentual_Alerta fora de 1-100 → Sistema retorna HTTP 400
      required: true
  precondicoes:
  - permissao: SYS.LIMITES_USO.CREATE
  gatilho: Usuario clica em Criar Novo Limite
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: exibir_formulario
  - passo: 2
    ator: usuario
    acao: preencher_campos
  - passo: 3
    ator: usuario
    acao: salvar
  - passo: 4
    ator: sistema
    acao: validar_dados
  - passo: 5
    ator: sistema
    acao: persistir_registro
  - passo: 6
    ator: sistema
    acao: registrar_auditoria
  fluxos_excecao:
  - id: FE-UC16-01
    condicao: tipo_limite_duplicado
    resultado: http_409
  - id: FE-UC16-02
    condicao: validacao_falhou
    resultado: http_400
  regras_aplicadas:
  - RN-SYS-001-12
  - RN-SYS-001-14
  resultado_final:
    estado: limite_uso_criado
- id: UC17
  nome: Visualizar Sistema_Limite_Uso
  ator_principal: usuario_autenticado
  tipo: leitura
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-04
    - RN-SYS-001-07
    - RN-SYS-001-12
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC17-001
      title: Usuário seleciona limite na listagem
      required: true
    - id: FP-UC17-002
      title: Sistema valida permissão SYS.LIMITES_USO.VIEW
      required: true
    - id: FP-UC17-003
      title: Sistema carrega dados completos
      required: true
    - id: FP-UC17-004
      title: Sistema calcula percentual de uso (Uso_Atual / Limite * 100)
      required: true
    - id: FP-UC17-005
      title: 'Sistema exibe dados: Tipo_Limite, Limite, Uso_Atual, Percentual, Percentual_Alerta,
        Fl_Alerta_Enviado'
      required: true
    - id: FP-UC17-006
      title: Sistema exibe metadados de auditoria
      required: true
    - id: FP-UC17-007
      title: Sistema exibe histórico de alterações de Uso_Atual (opcional)
      required: false
    - id: FE-UC17-001
      title: Registro inexistente → Sistema retorna HTTP 404
      required: true
    - id: FE-UC17-002
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
  precondicoes:
  - permissao: SYS.LIMITES_USO.VIEW
  gatilho: Usuario seleciona limite
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: selecionar_limite
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_dados
  - passo: 4
    ator: sistema
    acao: calcular_percentual
  - passo: 5
    ator: sistema
    acao: exibir_dados
  fluxos_excecao:
  - id: FE-UC17-01
    condicao: registro_inexistente
    resultado: http_404
  - id: FE-UC17-02
    condicao: sem_permissao
    resultado: http_403
  regras_aplicadas:
  - RN-SYS-001-12
  - RN-SYS-001-14
  resultado_final:
    estado: dados_limite_exibidos
- id: UC18
  nome: Editar Sistema_Limite_Uso
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-01
    - RN-SYS-001-02
    - RN-SYS-001-04
    - RN-SYS-001-05
    - RN-SYS-001-06
    - RN-SYS-001-07
    - RN-SYS-001-12
    - RN-SYS-001-14
    - RN-SYS-001-15
    uc_items:
    - id: FP-UC18-001
      title: Usuário clica em 'Editar'
      required: true
    - id: FP-UC18-002
      title: Sistema valida permissão SYS.LIMITES_USO.UPDATE
      required: true
    - id: FP-UC18-003
      title: Sistema carrega dados atuais (Tipo_Limite NÃO editável)
      required: true
    - id: FP-UC18-004
      title: Usuário altera Limite, Uso_Atual ou Percentual_Alerta
      required: true
    - id: FP-UC18-005
      title: Usuário clica em 'Salvar'
      required: true
    - id: FP-UC18-006
      title: Sistema valida alterações (Limite > 0, Percentual_Alerta 1-100)
      required: true
    - id: FP-UC18-007
      title: Se Uso_Atual foi reduzido abaixo de Percentual_Alerta → Sistema reseta
        Fl_Alerta_Enviado = 0 (RN-SYS-001-13 hysteresis)
      required: true
    - id: FP-UC18-008
      title: Sistema captura estado anterior (JSON)
      required: true
    - id: FP-UC18-009
      title: Sistema preenche Id_Usuario_Atualizacao, Dt_Atualizacao
      required: true
    - id: FP-UC18-010
      title: Sistema persiste alterações
      required: true
    - id: FP-UC18-011
      title: Sistema registra auditoria (tipo UPDATE, diff JSON)
      required: true
    - id: FP-UC18-012
      title: Sistema publica evento limite_uso.atualizado
      required: true
    - id: FE-UC18-001
      title: Erro de validação → Sistema retorna HTTP 400
      required: true
    - id: FE-UC18-002
      title: Conflito de concorrência → Sistema retorna HTTP 409
      required: true
  precondicoes:
  - permissao: SYS.LIMITES_USO.UPDATE
  gatilho: Usuario clica em Editar
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_edicao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: carregar_formulario_tipo_limite_bloqueado
  - passo: 4
    ator: usuario
    acao: alterar_dados
  - passo: 5
    ator: usuario
    acao: salvar
  - passo: 6
    ator: sistema
    acao: validar_alteracoes
  - passo: 7
    ator: sistema
    acao: resetar_fl_alerta_se_hysteresis
  - passo: 8
    ator: sistema
    acao: capturar_estado_anterior
  - passo: 9
    ator: sistema
    acao: persistir_alteracoes
  - passo: 10
    ator: sistema
    acao: registrar_auditoria_diff_json
  - passo: 11
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC18-01
    condicao: validacao_falhou
    resultado: http_400
  - id: FE-UC18-02
    condicao: conflito_concorrencia
    resultado: http_409
  regras_aplicadas:
  - RN-SYS-001-12
  - RN-SYS-001-13
  - RN-SYS-001-14
  resultado_final:
    estado: limite_uso_atualizado
- id: UC19
  nome: Excluir Sistema_Limite_Uso
  ator_principal: usuario_autenticado
  tipo: crud
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-03
    - RN-SYS-001-07
    - RN-SYS-001-14
    uc_items:
    - id: FP-UC19-001
      title: Usuário clica em 'Excluir'
      required: true
    - id: FP-UC19-002
      title: Sistema valida permissão SYS.LIMITES_USO.DELETE
      required: true
    - id: FP-UC19-003
      title: 'Sistema exibe modal de confirmação: ''Tem certeza que deseja excluir
        o limite {Tipo_Limite}?'''
      required: true
    - id: FP-UC19-004
      title: Usuário confirma exclusão
      required: true
    - id: FP-UC19-005
      title: 'Sistema executa soft delete: Fl_Excluido = 1, Dt_Exclusao, Id_Usuario_Exclusao'
      required: true
    - id: FP-UC19-006
      title: Sistema registra auditoria (tipo DELETE)
      required: true
    - id: FP-UC19-007
      title: Sistema publica evento limite_uso.excluido
      required: true
    - id: FE-UC19-001
      title: Usuário sem permissão → Sistema retorna HTTP 403
      required: true
    - id: FE-UC19-002
      title: Registro já excluído → Sistema retorna HTTP 404
      required: true
  precondicoes:
  - permissao: SYS.LIMITES_USO.DELETE
  gatilho: Usuario clica em Excluir
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_exclusao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: exibir_modal_confirmacao
  - passo: 4
    ator: usuario
    acao: confirmar_exclusao
  - passo: 5
    ator: sistema
    acao: executar_soft_delete
  - passo: 6
    ator: sistema
    acao: registrar_auditoria_delete
  - passo: 7
    ator: sistema
    acao: publicar_evento
  fluxos_excecao:
  - id: FE-UC19-01
    condicao: sem_permissao
    resultado: http_403
  - id: FE-UC19-02
    condicao: ja_excluido
    resultado: http_404
  regras_aplicadas:
  - RN-SYS-001-14
  resultado_final:
    estado: limite_uso_excluido
- id: UC20
  nome: Job Background - Verificação de Limites de Uso
  ator_principal: Sistema (Hangfire Scheduler)
  tipo: background_job
  impacta_dados: true
  covers:
    rf_items:
    - RN-SYS-001-13
    uc_items:
    - id: FP-UC20-001
      title: 'Job dispara automaticamente a cada 1 hora (CRON: 0 * * * *)'
      required: true
    - id: FP-UC20-002
      title: Hangfire enfileira job na queue 'limites_uso'
      required: true
    - id: FP-UC20-003
      title: Worker obtém lista de todos os limites de uso (Sistema_Limite_Uso onde
        Fl_Excluido = 0)
      required: true
    - id: FP-UC20-004
      title: 'Para cada limite: Calcular percentual_atual = (Uso_Atual / Limite) *
        100'
      required: true
    - id: FP-UC20-005
      title: Se percentual_atual >= Percentual_Alerta E Fl_Alerta_Enviado = 0 → Enviar
        e-mail para administradores
      required: true
    - id: FP-UC20-006
      title: Marcar Fl_Alerta_Enviado = 1 após envio bem-sucedido
      required: true
    - id: FP-UC20-007
      title: Se percentual_atual < (Percentual_Alerta - 10%) E Fl_Alerta_Enviado =
        1 → Resetar Fl_Alerta_Enviado = 0 (hysteresis)
      required: true
    - id: FP-UC20-008
      title: Job marca conclusão (success/failure) no Hangfire Dashboard
      required: true
    - id: FE-UC20-001
      title: Erro ao enviar e-mail → Job registra erro em log, NÃO marca Fl_Alerta_Enviado
        = 1, tenta novamente em 1h
      required: true
    - id: FE-UC20-002
      title: Job falha 3x consecutivas → Hangfire marca como failed, alerta DevOps
      required: true
  precondicoes:
  - condicao: Job Hangfire configurado no appsettings.json
  - condicao: Scheduler ativo (HangfireServer running)
  gatilho: Expressão CRON dispara job a cada 1 hora
  fluxo_principal:
  - passo: 1
    ator: sistema
    acao: cron_dispara_job
  - passo: 2
    ator: sistema
    acao: hangfire_enfileira_job
  - passo: 3
    ator: sistema
    acao: worker_obtem_lista_limites
  - passo: 4
    ator: sistema
    acao: calcular_percentual_uso
  - passo: 5
    ator: sistema
    acao: verificar_se_alerta_necessario
  - passo: 6
    ator: sistema
    acao: enviar_email_administradores
  - passo: 7
    ator: sistema
    acao: marcar_fl_alerta_enviado
  - passo: 8
    ator: sistema
    acao: verificar_hysteresis_resetar_flag
  - passo: 9
    ator: sistema
    acao: job_marca_conclusao
  fluxos_excecao:
  - id: FE-UC20-01
    condicao: erro_envio_email
    resultado: registrar_erro_nao_marcar_flag
  - id: FE-UC20-02
    condicao: job_falhou_3x
    resultado: hangfire_marca_failed_alerta_devops
  configuracao_job:
    expressao_cron: 0 * * * *
    descricao_cron: A cada 1 hora (no minuto 0)
    timezone: America/Sao_Paulo
    retry_policy: exponential_backoff
    max_retries: 3
    queue: limites_uso
  regras_aplicadas:
  - RN-SYS-001-12
  - RN-SYS-001-13
  resultado_final:
    estado: job_executado_alertas_enviados
- id: UC21
  nome: Integração - Teste de Envio de E-mail SMTP
  ator_principal: Sistema
  tipo: integracao_externa
  impacta_dados: false
  covers:
    rf_items:
    - RN-SYS-001-11
    uc_items:
    - id: FP-UC21-001
      title: Usuário clica em 'Testar Conexão' ao configurar e-mail SMTP
      required: true
    - id: FP-UC21-002
      title: Sistema valida permissão SYS.CONFIGURACOES_EMAIL.UPDATE
      required: true
    - id: FP-UC21-003
      title: Sistema obtém credenciais SMTP (Servidor, Porta, Usuario, Senha descriptografada,
        Fl_Usar_Ssl)
      required: true
    - id: FP-UC21-004
      title: Sistema autentica no servidor SMTP usando credenciais fornecidas
      required: true
    - id: FP-UC21-005
      title: 'Sistema prepara e-mail de teste: Para = Email_Remetente, Assunto = ''Teste
        de Configuração SMTP - IControlIT'', Corpo = ''Se você recebeu este e-mail,
        a configuração SMTP está correta.'''
      required: true
    - id: FP-UC21-006
      title: Sistema envia e-mail de teste via SMTP
      required: true
    - id: FP-UC21-007
      title: Sistema aguarda confirmação de envio (timeout 10s)
      required: true
    - id: FP-UC21-008
      title: 'Sistema retorna HTTP 200 com mensagem: ''E-mail de teste enviado com
        sucesso. Verifique sua caixa de entrada em {Email_Remetente}.'''
      required: true
    - id: FE-UC21-001
      title: 'Erro de autenticação SMTP (credenciais inválidas) → Sistema retorna
        HTTP 400 com mensagem: ''Falha na autenticação SMTP. Verifique usuário e senha.'''
      required: true
    - id: FE-UC21-002
      title: 'Erro de conexão (servidor/porta incorretos) → Sistema retorna HTTP 400
        com mensagem: ''Não foi possível conectar ao servidor SMTP {Servidor_Smtp}:{Porta_Smtp}'''
      required: true
    - id: FE-UC21-003
      title: 'Timeout ao enviar → Sistema retorna HTTP 408 com mensagem: ''Timeout
        ao enviar e-mail. Verifique se o servidor SMTP está acessível.'''
      required: true
  precondicoes:
  - permissao: SYS.CONFIGURACOES_EMAIL.UPDATE
  gatilho: Usuário clica em Testar Conexão
  fluxo_principal:
  - passo: 1
    ator: usuario
    acao: solicitar_teste_conexao
  - passo: 2
    ator: sistema
    acao: validar_permissao
  - passo: 3
    ator: sistema
    acao: obter_credenciais_smtp_descriptografar
  - passo: 4
    ator: sistema
    acao: autenticar_servidor_smtp
  - passo: 5
    ator: sistema
    acao: preparar_email_teste
  - passo: 6
    ator: sistema
    acao: enviar_email_via_smtp
  - passo: 7
    ator: sistema
    acao: aguardar_confirmacao_envio
  - passo: 8
    ator: sistema
    acao: retornar_sucesso_http_200
  fluxos_excecao:
  - id: FE-UC21-01
    condicao: falha_autenticacao_smtp
    resultado: http_400_credenciais_invalidas
  - id: FE-UC21-02
    condicao: erro_conexao_smtp
    resultado: http_400_servidor_inacessivel
  - id: FE-UC21-03
    condicao: timeout_envio
    resultado: http_408_timeout
  sistema_externo:
    nome: Servidor SMTP Genérico
    tipo: SMTP
    autenticacao: Usuario e Senha (PLAIN/LOGIN)
    endpoint_base: smtp://{Servidor_Smtp}:{Porta_Smtp}
    documentacao: RFC 5321 (SMTP)
  mapeamento_dados:
    direcao: IControlIT → SMTP
    transformacoes:
    - campo: Senha
      transformacao: Descriptografar AES-256 antes de autenticar
    - campo: Email_Remetente
      transformacao: Validar formato de e-mail (RFC 5322)
  regras_aplicadas:
  - RN-SYS-001-11
  resultado_final:
    estado: integracao_smtp_testada
exclusions:
  uc_items: []
historico:
- versao: '2.2'
  data: '2026-01-03'
  autor: Agência ALC - alc.dev.br
  descricao: 'Adequação completa: adicionados UC20 (Job Background - Verificação de
    Limites) e UC21 (Integração SMTP). Cobertura 100% de funcionalidades especiais:
    jobs, workflows, integrações externas. Total: 22 UCs.'
- versao: '2.1'
  data: '2025-12-31'
  autor: Agência ALC - alc.dev.br
  descricao: 'Expansão completa com 15 novos UCs (UC05-UC19) cobrindo as 3 entidades
    faltantes: Sistema_Feature_Flag (UC05-UC09), Sistema_Configuracao_Email (UC10-UC14),
    Sistema_Limite_Uso (UC15-UC19). Cobertura 100% do RF001 (20 UCs CRUD, 4 entidades,
    15 regras de negócio)'
- versao: '2.0'
  data: '2025-12-31'
  autor: Agência ALC - alc.dev.br
  descricao: Versão canônica orientada a contrato, conformidade 100% com template
    oficial UC.yaml, cobertura completa de RF001 (5 UCs CRUD, 88 itens covers.uc_items
    rastreáveis, 15 regras de negócio mapeadas)
- versao: '1.0'
  data: '2025-11-03'
  autor: Agência ALC - alc.dev.br
  descricao: Versão inicial (não conforme ao template)
