# =============================================
# UC-RF007 - Login e Autenticação (Casos de Uso)
# Versão: 2.0
# Autor: Agência ALC - alc.dev.br
# Data: 2025-12-31
# =============================================

uc:
  rf: "RF007"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Realizar Login"
    ator_principal: "usuario_nao_autenticado"
    tipo: "acao" # crud | leitura | acao | batch
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-01"  # Realizar login (autenticação)
        - "RF-AUTH-VAL-02"  # Validar formato de email
        - "RF-AUTH-VAL-03"  # Validar expiração de token JWT
        - "RF-AUTH-SEC-02"  # Auditoria de todas as tentativas
        - "RF-AUTH-SEC-03"  # Mensagem genérica para credenciais inválidas
        - "RF-AUTH-SEC-04"  # Timeout por inatividade (30 min)
        - "RF-AUTH-SEC-05"  # Notificação de novo dispositivo
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa /sign-in"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema exibe formulário de login"
          required: true
        - id: "FP-UC00-003"
          title: "Usuário preenche email e senha"
          required: true
        - id: "FP-UC00-004"
          title: "Frontend valida campos"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema envia POST /api/auth/login"
          required: true
        - id: "FP-UC00-006"
          title: "Backend valida credenciais"
          required: true
        - id: "FP-UC00-007"
          title: "Backend gera tokens JWT"
          required: true
        - id: "FP-UC00-008"
          title: "Backend cria sessão"
          required: true
        - id: "FP-UC00-009"
          title: "Backend registra auditoria"
          required: true
        - id: "FP-UC00-010"
          title: "Frontend armazena tokens"
          required: true
        - id: "FP-UC00-011"
          title: "Frontend redireciona para dashboard"
          required: true
        - id: "FA-UC00-001"
          title: "Credenciais inválidas"
          required: true
        - id: "FA-UC00-002"
          title: "Usuário bloqueado"
          required: true
        - id: "FA-UC00-003"
          title: "Empresa inativa"
          required: true
        - id: "FA-UC00-004"
          title: "Primeiro acesso"
          required: true
        - id: "FA-UC00-005"
          title: "Máximo de tentativas excedido"
          required: true
        - id: "FA-UC00-006"
          title: "Lembrar-me marcado"
          required: false
        - id: "FA-UC00-007"
          title: "Login de novo dispositivo"
          required: false
        - id: "FE-UC00-001"
          title: "Email vazio"
          required: true
        - id: "FE-UC00-002"
          title: "Email formato inválido"
          required: true
        - id: "FE-UC00-003"
          title: "Senha vazia"
          required: true
        - id: "FE-UC00-004"
          title: "Usuário não encontrado"
          required: true
        - id: "FE-UC00-005"
          title: "Senha incorreta"
          required: true
        - id: "FE-UC00-006"
          title: "Usuário inativo"
          required: true
        - id: "FE-UC00-007"
          title: "Erro de servidor"
          required: true
        - id: "FE-UC00-008"
          title: "Rate limiting"
          required: true

    precondicoes:
      - descricao: "Usuario cadastrado"
      - descricao: "Conta ativa"
      - descricao: "Sistema disponivel"

    gatilho: "Usuario acessa a tela de login"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_sign_in"
      - passo: 2
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 3
        ator: "usuario"
        acao: "preencher_credenciais"
      - passo: 4
        ator: "sistema"
        acao: "validar_campos_frontend"
      - passo: 5
        ator: "sistema"
        acao: "enviar_post_login"
      - passo: 6
        ator: "sistema"
        acao: "validar_credenciais_backend"
      - passo: 7
        ator: "sistema"
        acao: "gerar_tokens_jwt"
      - passo: 8
        ator: "sistema"
        acao: "criar_sessao"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 10
        ator: "sistema"
        acao: "armazenar_tokens_frontend"
      - passo: 11
        ator: "sistema"
        acao: "redirecionar_dashboard"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "credenciais_invalidas"
        resultado: "erro_401_generico"
      - id: "FA-UC00-02"
        condicao: "usuario_bloqueado"
        resultado: "erro_423_tempo_restante"
      - id: "FA-UC00-03"
        condicao: "empresa_inativa"
        resultado: "erro_acesso_negado"
      - id: "FA-UC00-04"
        condicao: "primeiro_acesso"
        resultado: "redireciona_troca_senha"
      - id: "FA-UC00-05"
        condicao: "5_tentativas_falhas"
        resultado: "bloqueio_automatico"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "email_vazio"
        resultado: "erro_400_campo_obrigatorio"
      - id: "FE-UC00-02"
        condicao: "email_invalido"
        resultado: "erro_400_formato_invalido"
      - id: "FE-UC00-03"
        condicao: "senha_vazia"
        resultado: "erro_400_campo_obrigatorio"
      - id: "FE-UC00-04"
        condicao: "usuario_nao_encontrado"
        resultado: "erro_401_mensagem_generica"
      - id: "FE-UC00-05"
        condicao: "senha_incorreta"
        resultado: "erro_401_mensagem_generica"

    regras_aplicadas:
      - "RN-AUTH-001" # Autenticação por Email e Senha
      - "RN-AUTH-002" # JWT Token com Expiração de 8 Horas
      - "RN-AUTH-003" # Bloqueio Após 5 Tentativas Falhas
      - "RN-AUTH-005" # Senha Case-Sensitive
      - "RN-AUTH-008" # Primeiro Acesso Obriga Troca de Senha
      - "RN-AUTH-010" # Auditoria de Todas as Tentativas de Login
      - "RN-AUTH-011" # Mensagem Genérica para Credenciais Inválidas

    resultado_final:
      estado: "usuario_autenticado_token_gerado"

  - id: "UC01"
    nome: "Solicitar Recuperação de Senha"
    ator_principal: "usuario_nao_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-04" # Solicitar recuperação de senha
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em 'Esqueci minha senha'"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema exibe formulário com campo email"
          required: true
        - id: "FP-UC01-003"
          title: "Usuário preenche email"
          required: true
        - id: "FP-UC01-004"
          title: "Sistema valida formato do email"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema envia POST /api/auth/forgot-password"
          required: true
        - id: "FP-UC01-006"
          title: "Backend verifica se email existe"
          required: true
        - id: "FP-UC01-007"
          title: "Se existe: gera token (24h), envia email"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema retorna mensagem genérica"
          required: true
        - id: "FA-UC01-001"
          title: "Email não cadastrado"
          required: true
        - id: "FA-UC01-002"
          title: "Email já enviado recentemente"
          required: true
        - id: "FA-UC01-003"
          title: "Usuário bloqueado"
          required: true
        - id: "FE-UC01-001"
          title: "Email vazio"
          required: true
        - id: "FE-UC01-002"
          title: "Email inválido"
          required: true
        - id: "FE-UC01-003"
          title: "Rate limit"
          required: true

    precondicoes:
      - descricao: "Usuario tem email cadastrado"

    gatilho: "Usuario clica em 'Esqueci minha senha'"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_esqueci_senha"
      - passo: 2
        ator: "sistema"
        acao: "exibir_formulario_email"
      - passo: 3
        ator: "usuario"
        acao: "preencher_email"
      - passo: 4
        ator: "sistema"
        acao: "validar_formato"
      - passo: 5
        ator: "sistema"
        acao: "enviar_post_forgot"
      - passo: 6
        ator: "sistema"
        acao: "gerar_token_24h"
      - passo: 7
        ator: "sistema"
        acao: "enviar_email_recuperacao"
      - passo: 8
        ator: "sistema"
        acao: "retornar_mensagem_generica"

    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "email_nao_cadastrado"
        resultado: "mesma_mensagem_generica_seguranca"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "email_vazio"
        resultado: "erro_400"

    regras_aplicadas:
      - "RN-AUTH-006" # Token de Recuperação Válido por 24 Horas
      - "RN-AUTH-010" # Auditoria
      - "RN-AUTH-011" # Mensagem Genérica

    resultado_final:
      estado: "email_enviado_ou_silencio"

  - id: "UC02"
    nome: "Redefinir Senha"
    ator_principal: "usuario_com_token_valido"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-05" # Redefinir senha
        - "RF-AUTH-VAL-01"  # Validar requisitos mínimos de senha
        - "RF-AUTH-VAL-04"  # Validar histórico de senhas (últimas 5)
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário clica no link do email"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema carrega /reset-password?token=xxx"
          required: true
        - id: "FP-UC02-003"
          title: "Frontend valida token com backend"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema exibe formulário (nova senha, confirmar)"
          required: true
        - id: "FP-UC02-005"
          title: "Usuário preenche nova senha"
          required: true
        - id: "FP-UC02-006"
          title: "Frontend valida requisitos em tempo real"
          required: true
        - id: "FP-UC02-007"
          title: "Backend valida token, senha, histórico"
          required: true
        - id: "FP-UC02-008"
          title: "Backend atualiza senha (BCrypt)"
          required: true
        - id: "FP-UC02-009"
          title: "Backend invalida token"
          required: true
        - id: "FP-UC02-010"
          title: "Backend registra em HistoricoSenha"
          required: true
        - id: "FP-UC02-011"
          title: "Sistema redireciona para login"
          required: true
        - id: "FE-UC02-001"
          title: "Token expirado"
          required: true
        - id: "FE-UC02-002"
          title: "Token já usado"
          required: true
        - id: "FE-UC02-003"
          title: "Token inválido"
          required: true
        - id: "FE-UC02-004"
          title: "Senha fraca"
          required: true
        - id: "FE-UC02-005"
          title: "Senhas diferentes"
          required: true
        - id: "FE-UC02-006"
          title: "Senha reutilizada"
          required: true

    precondicoes:
      - descricao: "Token de recuperacao valido"

    gatilho: "Usuario clica no link do email de recuperacao"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_link_email"
      - passo: 2
        ator: "sistema"
        acao: "carregar_reset_password"
      - passo: 3
        ator: "sistema"
        acao: "validar_token"
      - passo: 4
        ator: "sistema"
        acao: "exibir_formulario_senha"
      - passo: 5
        ator: "usuario"
        acao: "preencher_nova_senha"
      - passo: 6
        ator: "sistema"
        acao: "validar_requisitos"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_senha_bcrypt"
      - passo: 8
        ator: "sistema"
        acao: "invalidar_token"
      - passo: 9
        ator: "sistema"
        acao: "registrar_historico"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "token_expirado"
        resultado: "erro_400_link_expirado"
      - id: "FE-UC02-02"
        condicao: "senha_reutilizada"
        resultado: "erro_400_ja_utilizada"

    regras_aplicadas:
      - "RN-AUTH-004" # Requisitos Mínimos de Senha
      - "RN-AUTH-006" # Token de Recuperação Válido por 24 Horas
      - "RN-AUTH-007" # Não Reutilizar Últimas 5 Senhas

    resultado_final:
      estado: "senha_alterada"

  - id: "UC03"
    nome: "Alterar Senha (Primeiro Acesso)"
    ator_principal: "usuario_autenticado_temporario"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-06" # Alterar senha (usuário logado)
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário faz login com senha temporária"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema detecta Fl_Primeiro_Acesso = true"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema retorna requirePasswordChange = true"
          required: true
        - id: "FP-UC03-004"
          title: "Frontend redireciona para /change-password"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC03-006"
          title: "Usuário preenche campos"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema valida senha atual, nova senha"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema atualiza senha"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema marca Fl_Primeiro_Acesso = false"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema redireciona para login"
          required: true
        - id: "FE-UC03-001"
          title: "Senha atual incorreta"
          required: true
        - id: "FE-UC03-002"
          title: "Nova igual a atual"
          required: true
        - id: "FE-UC03-003"
          title: "Requisitos não atendidos"
          required: true
        - id: "FE-UC03-004"
          title: "Token temporário expirado"
          required: true

    precondicoes:
      - descricao: "Usuario autenticado com senha temporaria"

    gatilho: "Sistema detecta primeiro acesso apos login"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "detectar_primeiro_acesso"
      - passo: 2
        ator: "sistema"
        acao: "redirecionar_change_password"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "preencher_senha_atual_nova"
      - passo: 5
        ator: "sistema"
        acao: "validar_senhas"
      - passo: 6
        ator: "sistema"
        acao: "atualizar_senha"
      - passo: 7
        ator: "sistema"
        acao: "marcar_primeiro_acesso_false"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "senha_atual_incorreta"
        resultado: "erro_400"

    regras_aplicadas:
      - "RN-AUTH-004" # Requisitos Mínimos de Senha
      - "RN-AUTH-007" # Não Reutilizar Últimas 5 Senhas
      - "RN-AUTH-008" # Primeiro Acesso Obriga Troca de Senha

    resultado_final:
      estado: "senha_alterada_flag_false"

  - id: "UC04"
    nome: "Encerrar Sessão (Logout)"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-02" # Encerrar sessão (logout)
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário clica no menu de usuário"
          required: true
        - id: "FP-UC04-002"
          title: "Usuário clica em 'Sair'"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema exibe confirmação (opcional)"
          required: false
        - id: "FP-UC04-004"
          title: "Usuário confirma"
          required: true
        - id: "FP-UC04-005"
          title: "Frontend envia POST /api/auth/logout"
          required: true
        - id: "FP-UC04-006"
          title: "Backend invalida sessão atual"
          required: true
        - id: "FP-UC04-007"
          title: "Backend registra auditoria AUTH_LOGOUT"
          required: true
        - id: "FP-UC04-008"
          title: "Frontend limpa tokens do storage"
          required: true
        - id: "FP-UC04-009"
          title: "Frontend redireciona para /sign-in"
          required: true
        - id: "FA-UC04-001"
          title: "Logout de todas sessões"
          required: false
        - id: "FA-UC04-002"
          title: "Logout por timeout"
          required: true

    precondicoes:
      - descricao: "Usuario autenticado"

    gatilho: "Usuario clica em Sair"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_sair"
      - passo: 2
        ator: "sistema"
        acao: "confirmar_logout"
      - passo: 3
        ator: "sistema"
        acao: "enviar_post_logout"
      - passo: 4
        ator: "sistema"
        acao: "invalidar_sessao"
      - passo: 5
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 6
        ator: "sistema"
        acao: "limpar_tokens"
      - passo: 7
        ator: "sistema"
        acao: "redirecionar_sign_in"

    fluxos_alternativos:
      - id: "FA-UC04-01"
        condicao: "logout_all"
        resultado: "invalida_todas_sessoes"

    fluxos_excecao: []

    regras_aplicadas:
      - "RN-AUTH-010" # Auditoria

    resultado_final:
      estado: "usuario_desautenticado"

  - id: "UC05"
    nome: "Renovar Sessão"
    ator_principal: "sistema_automatico"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-03" # Renovar token (refresh)
      uc_items:
        - id: "FP-UC05-001"
          title: "Frontend detecta token próximo de expirar (5 min)"
          required: true
        - id: "FP-UC05-002"
          title: "Frontend verifica atividade recente"
          required: true
        - id: "FP-UC05-003"
          title: "Se ativo: envia POST /api/auth/refresh"
          required: true
        - id: "FP-UC05-004"
          title: "Backend valida refresh token"
          required: true
        - id: "FP-UC05-005"
          title: "Backend gera novo access token"
          required: true
        - id: "FP-UC05-006"
          title: "Backend gera novo refresh token (rotation)"
          required: true
        - id: "FP-UC05-007"
          title: "Backend atualiza sessão"
          required: true
        - id: "FP-UC05-008"
          title: "Frontend atualiza tokens armazenados"
          required: true
        - id: "FA-UC05-001"
          title: "Usuário inativo"
          required: true
        - id: "FA-UC05-002"
          title: "Refresh token expirado"
          required: true
        - id: "FE-UC05-001"
          title: "Refresh token inválido"
          required: true
        - id: "FE-UC05-002"
          title: "Refresh token já usado"
          required: true
        - id: "FE-UC05-003"
          title: "Sessão invalidada"
          required: true
        - id: "FE-UC05-004"
          title: "Usuário bloqueado"
          required: true

    precondicoes:
      - descricao: "Usuario autenticado"
      - descricao: "Token proximo de expirar"

    gatilho: "Token JWT proximo de expirar (5 minutos)"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "detectar_expiracao_proxima"
      - passo: 2
        ator: "sistema"
        acao: "verificar_atividade"
      - passo: 3
        ator: "sistema"
        acao: "enviar_post_refresh"
      - passo: 4
        ator: "sistema"
        acao: "validar_refresh_token"
      - passo: 5
        ator: "sistema"
        acao: "gerar_novo_access_token"
      - passo: 6
        ator: "sistema"
        acao: "gerar_novo_refresh_token"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_sessao"

    fluxos_alternativos:
      - id: "FA-UC05-01"
        condicao: "usuario_inativo"
        resultado: "logout_timeout"

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "refresh_token_invalido"
        resultado: "logout_forcar_login"

    regras_aplicadas:
      - "RN-AUTH-002" # JWT Token com Expiração de 8 Horas
      - "RN-AUTH-009" # Timeout por Inatividade de 30 Minutos

    resultado_final:
      estado: "token_renovado"

  - id: "UC06"
    nome: "Bloqueio e Desbloqueio de Conta"
    ator_principal: "sistema_ou_admin"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-AUTH-SEC-01"  # Bloqueio após 5 tentativas falhas
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário erra senha pela 5ª vez"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema bloqueia conta"
          required: true
        - id: "FP-UC06-003"
          title: "Sistema registra AUTH_ACCOUNT_LOCKED"
          required: true
        - id: "FP-UC06-004"
          title: "Sistema envia email de notificação"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema retorna erro com tempo restante"
          required: true
        - id: "FP-UC06-006"
          title: "30 minutos se passam"
          required: true
        - id: "FP-UC06-007"
          title: "Usuário tenta login"
          required: true
        - id: "FP-UC06-008"
          title: "Sistema desbloqueia automaticamente"
          required: true
        - id: "FA-UC06-001"
          title: "Desbloqueio manual por admin"
          required: true
        - id: "FE-UC06-001"
          title: "Tentativa durante bloqueio"
          required: true

    precondicoes:
      - descricao: "Usuario com conta ativa"

    gatilho: "5a tentativa de login falha"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "detectar_5_tentativas"
      - passo: 2
        ator: "sistema"
        acao: "bloquear_conta"
      - passo: 3
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 4
        ator: "sistema"
        acao: "enviar_email_notificacao"
      - passo: 5
        ator: "sistema"
        acao: "aguardar_30_minutos"
      - passo: 6
        ator: "sistema"
        acao: "desbloquear_automaticamente"

    fluxos_alternativos:
      - id: "FA-UC06-01"
        condicao: "admin_desbloqueia_manualmente"
        resultado: "conta_ativa_antes_30min"

    fluxos_excecao:
      - id: "FE-UC06-01"
        condicao: "tentativa_durante_bloqueio"
        resultado: "erro_423_minutos_restantes"

    regras_aplicadas:
      - "RN-AUTH-003" # Bloqueio Após 5 Tentativas Falhas
      - "RN-AUTH-010" # Auditoria

    resultado_final:
      estado: "conta_desbloqueada"

  - id: "UC09"
    nome: "Realizar Login com Logo Personalizada do Cliente (Tenant)"
    ator_principal: "usuario_nao_autenticado"
    tipo: "acao"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-AUTH-01"  # Realizar login (autenticação)
        - "RF-AUTH-07"  # Exibir logo corporativa do Cliente (tenant) no login
      uc_items:
        - id: "FP-UC09-001"
          title: "Usuário acessa /sign-in"
          required: true
        - id: "FP-UC09-002"
          title: "Usuário preenche email (ex: admin@vale.com.br)"
          required: true
        - id: "FP-UC09-003"
          title: "Sistema identifica ClienteId pelo domínio do email OU campo hidden (multi-domínio)"
          required: true
        - id: "FP-UC09-004"
          title: "Sistema busca Cliente.LogoUrl via ClienteId"
          required: true
        - id: "FP-UC09-005"
          title: "Se logoUrl existe e válida: exibir logo corporativa do Cliente"
          required: true
        - id: "FP-UC09-006"
          title: "Se logoUrl não existe ou inválida: exibir logo padrão IControlIT"
          required: true
        - id: "FP-UC09-007"
          title: "Usuário preenche senha e submete formulário"
          required: true
        - id: "FP-UC09-008"
          title: "Sistema valida credenciais (POST /api/auth/login)"
          required: true
        - id: "FP-UC09-009"
          title: "Sistema retorna JWT + ClienteId + LogoUrl"
          required: true
        - id: "FP-UC09-010"
          title: "Frontend armazena logoUrl no localStorage (chave: 'cliente_logo_url')"
          required: true
        - id: "FP-UC09-011"
          title: "Sistema redireciona para /dashboard"
          required: true
        - id: "FP-UC09-012"
          title: "Header do dashboard exibe logo corporativa do Cliente (persistente em toda sessão)"
          required: true
        - id: "FA-UC09-001"
          title: "Não consegue identificar ClienteId antes do login: exibir logo padrão, identificar após autenticação"
          required: true
        - id: "FA-UC09-002"
          title: "LogoUrl aponta para arquivo não acessível (404, timeout): fallback para logo padrão (não bloqueia login)"
          required: true
        - id: "FE-UC09-001"
          title: "Credenciais inválidas: HTTP 401 (logo NÃO interfere em autenticação)"
          required: true
        - id: "FE-UC09-002"
          title: "Cliente desativado (FlAtivo=false): HTTP 403"
          required: true
        - id: "FE-UC09-003"
          title: "Usuário desativado (FlAtivo=false): HTTP 403"
          required: true

    endpoints:
      - metodo: "POST"
        rota: "/api/auth/login"
        request: "{ email, senha }"
        response: "{ token, refreshToken, userId, clienteId, logoUrl }"
        observacao: "logoUrl do Cliente (tenant)"
      - metodo: "GET"
        rota: "/api/clientes/{clienteId}/logo"
        response: "{ logoUrl }"
        observacao: "Opcional - pode ser chamado antes do login se identificar ClienteId pelo domínio do email"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_login"
      - passo: 2
        ator: "usuario"
        acao: "preencher_email"
      - passo: 3
        ator: "sistema"
        acao: "identificar_cliente_id_por_dominio"
      - passo: 4
        ator: "sistema"
        acao: "buscar_logo_url_do_cliente"
      - passo: 5
        ator: "sistema"
        acao: "exibir_logo_corporativa_ou_padrao"
      - passo: 6
        ator: "usuario"
        acao: "preencher_senha_e_submeter"
      - passo: 7
        ator: "sistema"
        acao: "validar_credenciais"
      - passo: 8
        ator: "sistema"
        acao: "retornar_jwt_clienteid_logourl"
      - passo: 9
        ator: "frontend"
        acao: "armazenar_logourl_localstorage"
      - passo: 10
        ator: "sistema"
        acao: "redirecionar_dashboard"
      - passo: 11
        ator: "frontend"
        acao: "exibir_logo_no_header"

    fluxos_alternativos:
      - id: "FA-UC09-01"
        condicao: "cliente_id_nao_identificado_antes_login"
        resultado: "exibir_logo_padrao_identificar_apos_autenticacao"
      - id: "FA-UC09-02"
        condicao: "logo_url_inacessivel_404_timeout"
        resultado: "fallback_logo_padrao_nao_bloqueia_login"

    fluxos_excecao:
      - id: "FE-UC09-01"
        condicao: "credenciais_invalidas"
        resultado: "erro_401_logo_nao_interfere"
      - id: "FE-UC09-02"
        condicao: "cliente_desativado"
        resultado: "erro_403"
      - id: "FE-UC09-03"
        condicao: "usuario_desativado"
        resultado: "erro_403"

    regras_aplicadas:
      - "RN-AUTH-001" # Autenticação por Email e Senha
      - "RN-AUTH-013" # Exibição de Logo Corporativa do Tenant no Login

    resultado_final:
      estado: "usuario_autenticado_com_logo_corporativa"
      persistencia: "logoUrl armazenada em localStorage"
      visibilidade: "logo exibida durante toda a sessão"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão YAML estruturado sincronizado com UC-RF007.md v2.0"
  - versao: "1.0"
    data: "2025-12-17"
    autor: "Sistema"
    descricao: "Apenas UC-RF007.md existia (YAML não existia)"
