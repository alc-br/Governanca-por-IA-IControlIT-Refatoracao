rf: RF004
fase: Fase-1-Sistema-Base
epic: EPIC001-SYS-Sistema-Infraestrutura
titulo: Sistema de Auditoria e Logs do Sistema

# ============================================================
# 1. SKELETON / BASE ATUAL
# ============================================================
skeleton:
  criado: True
  data_criacao: "2025-12-27"
  observacao: >
    Backend QUASE COMPLETO: 88% implementado.
    Core 100% funcional (auditoria automática, snapshot, timeline, SHA-256, relatórios compliance).
    Faltam apenas features avançadas (detecção anomalias, segregação funções SOX, arquivamento Azure Blob, alertas retention).
    Frontend: 0% (não iniciado).

# ============================================================
# 2. DOCUMENTACAO (CONTRATOS)
# ============================================================
documentacao:
  rf: True              # RF004.md + RF004.yaml (440 linhas, 15 RNs, v2.0)
  uc: True              # UC-RF004.md + UC-RF004.yaml (9 UCs, cobertura 100%, v2.0)
  md: False             # Modelo de dados ainda não criado
  wf: False             # Workflow de telas ainda não criado
  rl: True              # RL-RF004.md + RL-RF004.yaml (8 problemas legado, v2.0)
  tc: False             # Casos de teste ainda não gerados
  user_stories: False   # User stories ainda não criadas

# ============================================================
# 3. DESENVOLVIMENTO
# ============================================================
desenvolvimento:
  backend:
    status: in_progress   # not_started | skeleton | in_progress | done
    branch: null
    percentual_completo: 88
    observacao: >
      Backend QUASE COMPLETO:
      ✅ Tabela Sistema_Auditoria (append-only, trigger imutabilidade)
      ✅ MediatR AuditingBehaviour<TRequest, TResponse>
      ✅ 10 categorias de auditoria
      ✅ Hash SHA-256 para integridade
      ✅ Snapshot before/after (DadosAnteriores_JSON, DadosNovos_JSON)
      ✅ Diff JSON Patch RFC 6902 (Diff_JSON)
      ✅ Retenção por categoria (7 anos LGPD/SOX, 1 ano outros)
      ✅ Endpoint /api/auditoria/timeline/{entidade}/{id}
      ❌ Detecção de anomalias (Hangfire job)
      ❌ Segregação de funções SOX
      ❌ Arquivamento Azure Blob Storage (cold tier)
      ❌ Alertas de retenção expirando
  frontend:
    status: not_started
    branch: null
    percentual_completo: 0
    observacao: >
      Frontend ainda não iniciado. Requer 9 telas (UC00-UC08).

# ============================================================
# 4. TESTES (RESULTADO)
# ============================================================
testes:
  backend: not_run        # not_run | pass | fail
  frontend: not_run
  e2e: not_run
  seguranca: not_run

# ============================================================
# 5. DOCUMENTACAO DE TESTES
# ============================================================
documentacao_testes:
  backend: True           # TC-RF004-BACKEND.md existe
  frontend: False
  e2e: False
  seguranca: False

# ============================================================
# 6. TESTES TI / QA
# ============================================================
testes_ti:
  backend: not_run
  frontend: not_run
  e2e: not_run
  seguranca: not_run

testes_qa:
  executado: False
  aprovado: False

# ============================================================
# 7. GOVERNANCA DE CASOS DE USO (EXECUCAO)
# ============================================================
ucs:
  UC00:
    titulo: "Listar Registros de Auditoria"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null

  UC01:
    titulo: "Buscar com Filtros Avançados"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null

  UC02:
    titulo: "Visualizar Timeline de Entidade"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null

  UC03:
    titulo: "Exportar Relatórios de Compliance"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 13
    data_inicio: null
    data_conclusao: null

  UC04:
    titulo: "Visualizar Dashboards Analíticos"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null

  UC05:
    titulo: "Detectar e Visualizar Anomalias"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 13
    data_inicio: null
    data_conclusao: null

  UC06:
    titulo: "Validar Integridade (Hash SHA-256)"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 8
    data_inicio: null
    data_conclusao: null

  UC07:
    titulo: "Visualizar Detalhes de Registro"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 5
    data_inicio: null
    data_conclusao: null

  UC08:
    titulo: "Gerenciar Retenção e Alertas"
    azure_work_item_id: null
    sprint: Backlog
    status: To Do
    responsavel: null
    story_points: 13
    data_inicio: null
    data_conclusao: null

# Total Story Points: 81 (complexidade muito alta - compliance crítico)

# ============================================================
# 8. SINCRONIZACAO COM AZURE DEVOPS
# ============================================================
devops:
  work_item_id: 496
  test_plan_id: null
  last_sync: "2025-12-29"
  board_column: "Documentação"
  sync_policy:
    create_user_story_if_missing: True
    update_status_from_yaml: True
    update_sprint_from_yaml: True
    close_work_item_on_done: True

# ============================================================
# 9. GOVERNANCA E CONTRATOS
# ============================================================
governanca:
  contrato_ativo: "RF-UC-RL"
  ultimo_manifesto: null
  cobertura_rn: "15/15"
  cobertura_percentual: "100%"
  regras:
    - "UC não deve ser alterado após aprovado"
    - "Mudanças de execução devem ocorrer apenas no STATUS.yaml"
    - "UC só pode ser marcado como Done se TC correspondente estiver Pass"
    - "RF só é considerado entregue quando todos os UCs estiverem Done"
    - "RF004 é CRÍTICO para compliance (LGPD, SOX, ISO 27001)"

# ============================================================
# 10. VALIDACOES DE COBERTURA
# ============================================================
validacoes:
  rf_uc_cobertura_total: True    # 9 UCs cobrem 15 RNs (100%)
  uc_md_consistente: False       # MD ainda não criado
  uc_wf_consistente: False       # WF ainda não criado
  rf_yaml_sincronizado: True     # RF004.yaml gerado e validado
  uc_yaml_sincronizado: True     # UC-RF004.yaml gerado e validado
  rl_yaml_sincronizado: True     # RL-RF004.yaml gerado com 8 referências

# ============================================================
# 11. CHANGELOG
# ============================================================
changelog:
  - versao: "2.0"
    data: "2025-12-29"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração para governança v2.0 (7 arquivos completos)"
