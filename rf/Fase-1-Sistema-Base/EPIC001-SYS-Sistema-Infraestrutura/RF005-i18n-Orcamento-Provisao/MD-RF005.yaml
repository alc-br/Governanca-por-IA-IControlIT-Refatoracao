# =============================================
# Modelo de Dados (MD) - RF005
# Vers√£o: 2.0
# Data: 2026-01-04
# Autor: Ag√™ncia ALC - alc.dev.br
# =============================================

# =============================================
# 1. METADADOS DO DOCUMENTO
# =============================================
metadata:
  versao: "2.0"
  data: "2026-01-04"
  autor: "Ag√™ncia ALC - alc.dev.br"

  rf_relacionado:
    id: "RF005"
    nome: "Internacionaliza√ß√£o (i18n) e Localiza√ß√£o"

  sistema_modulo: "Sistema de Infraestrutura - i18n"
  banco_de_dados:
    engine: "SQLite"
    schema: "main"
  padroes:
    multi_tenancy: false  # Tradu√ß√µes s√£o globais (n√£o isoladas por tenant)
    auditoria: true       # Campos de auditoria em todas as tabelas
    soft_delete: true     # Soft delete em todas as tabelas

# =============================================
# 2. ENTIDADES
# =============================================
entidades:
  # ===========================================================================
  # 2.1 ENTIDADE: sistema_idiomas
  # ===========================================================================
  - nome: "sistema_idiomas"
    descricao: "Idiomas cadastrados no sistema (pt-BR, en-US, es-ES, fr-FR, etc.)"

    campos:
      # ----- CHAVE PRIM√ÅRIA -----
      - nome: "id"
        tipo: "INTEGER"
        nulo: false
        default: "AUTOINCREMENT"
        descricao: "Chave prim√°ria"
        pk: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente pelo banco"

      # ----- CAMPOS DE NEG√ìCIO -----
      - nome: "codigo"
        tipo: "VARCHAR(10)"
        nulo: false
        default: null
        descricao: "C√≥digo ISO do idioma (pt-BR, en-US, es-ES)"
        unique: true
        index: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: "WF-02"
          campo_wf: "CMP-WF02-003"
          observacao: "RN-RF005-005: Formato ISO 639-1 + ISO 3166-1 (ex: pt-BR)"

      - nome: "nome"
        tipo: "VARCHAR(100)"
        nulo: false
        default: null
        descricao: "Nome do idioma (Portugu√™s (Brasil), English (United States))"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: "WF-02"
          campo_wf: "CMP-WF02-004"

      - nome: "nome_nativo"
        tipo: "VARCHAR(100)"
        nulo: false
        default: null
        descricao: "Nome nativo do idioma (Portugu√™s, English, Fran√ßais)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: "WF-02"
          campo_wf: "CMP-WF02-004"

      - nome: "bandeira"
        tipo: "VARCHAR(10)"
        nulo: false
        default: null
        descricao: "Emoji da bandeira (üáßüá∑, üá∫üá∏, üá™üá∏, üá´üá∑) ou √≠cone"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: "WF-02"
          campo_wf: "CMP-WF02-005"
          observacao: "RN-RF005-022: Bandeiras e √≠cones de idiomas"

      - nome: "cultura"
        tipo: "VARCHAR(10)"
        nulo: false
        default: null
        descricao: "Cultura do idioma (pt-BR, en-US) para formata√ß√£o regional"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-004: Formata√ß√£o regional autom√°tica"

      - nome: "timezone"
        tipo: "VARCHAR(50)"
        nulo: false
        default: null
        descricao: "Timezone do idioma (America/Sao_Paulo, America/New_York)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-004: Formata√ß√£o de datas com timezone"

      - nome: "formato_data"
        tipo: "VARCHAR(20)"
        nulo: false
        default: "dd/MM/yyyy"
        descricao: "Formato de data (dd/MM/yyyy, MM/dd/yyyy)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-004: Formata√ß√£o regional autom√°tica"

      - nome: "formato_moeda"
        tipo: "VARCHAR(20)"
        nulo: false
        default: "R$ #.##0,00"
        descricao: "Formato de moeda (R$ #.##0,00, $#,##0.00)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-004: Formata√ß√£o de moedas"

      - nome: "separador_decimal"
        tipo: "VARCHAR(1)"
        nulo: false
        default: ","
        descricao: "Separador decimal (v√≠rgula ou ponto)"
        mutavel: true
        check:
          definicao: "separador_decimal IN (',', '.')"
          descricao: "Separador decimal permitido"
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-004: Formata√ß√£o de n√∫meros"

      - nome: "is_ativo"
        tipo: "BOOLEAN"
        nulo: false
        default: false
        descricao: "Idioma ativo (dispon√≠vel para usu√°rios finais)"
        index: true
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC04"
          wf: "WF-05"
          campo_wf: "CMP-WF05-001"
          observacao: "RN-RF005-001: pt-BR sempre ativo (n√£o pode ser desativado)"

      - nome: "is_padrao"
        tipo: "BOOLEAN"
        nulo: false
        default: false
        descricao: "Idioma padr√£o do sistema (pt-BR)"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-001: Apenas pt-BR tem is_padrao = true"

      - nome: "progresso_percentual"
        tipo: "DECIMAL(5,2)"
        nulo: false
        default: 0.00
        descricao: "Progresso de tradu√ß√£o em percentual (0.00 a 100.00)"
        index: true
        mutavel: true
        check:
          definicao: "progresso_percentual >= 0 AND progresso_percentual <= 100"
          descricao: "Progresso entre 0% e 100%"
        origem:
          rf: "RF005"
          uc: "UC00"
          wf: "WF-01"
          campo_wf: "CMP-WF01-009"
          observacao: "Calculado automaticamente: (chaves_traduzidas / total_chaves) * 100"

      - nome: "total_chaves"
        tipo: "INTEGER"
        nulo: false
        default: 0
        descricao: "Total de chaves de tradu√ß√£o do sistema (ex: 1247)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC00"
          wf: "WF-01"
          campo_wf: "CMP-WF01-009"
          observacao: "Atualizado sempre que novas chaves s√£o adicionadas ao sistema"

      - nome: "chaves_traduzidas"
        tipo: "INTEGER"
        nulo: false
        default: 0
        descricao: "Total de chaves traduzidas neste idioma"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC00"
          wf: "WF-01"
          campo_wf: "CMP-WF01-009"
          observacao: "Incrementado a cada upload de tradu√ß√µes (UC03)"

      - nome: "idioma_referencia_id"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "FK para idioma de refer√™ncia para fallback (ex: pt-BR)"
        mutavel: true
        fk:
          tabela: "sistema_idiomas"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: "WF-02"
          campo_wf: "CMP-WF02-007"
          observacao: "RN-RF005-003: Fallback em cascata hier√°rquico"

      # ----- AUDITORIA -----
      - nome: "created_at"
        tipo: "DATETIME"
        nulo: true
        default: "CURRENT_TIMESTAMP"
        descricao: "Data de cria√ß√£o"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente pelo sistema"

      - nome: "created_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que criou o idioma"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC01"
          wf: null
          campo_wf: null
          observacao: "Preenchido automaticamente com ID do usu√°rio autenticado"

      - nome: "updated_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Data de atualiza√ß√£o"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC04"
          wf: null
          campo_wf: null
          observacao: "Atualizado automaticamente ao modificar idioma"

      - nome: "updated_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que atualizou o idioma"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC04"
          wf: null
          campo_wf: null
          observacao: "Preenchido automaticamente ao atualizar idioma"

      # ----- SOFT DELETE -----
      - nome: "deleted_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Soft delete"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: null
          wf: null
          campo_wf: null
          observacao: "pt-BR NUNCA pode ser exclu√≠do (RN-RF005-001)"

    # -----------------------------
    # √çNDICES
    # -----------------------------
    indices:
      - nome: "pk_sistema_idiomas"
        tipo: "PRIMARY"
        colunas: ["id"]
        descricao: "Chave prim√°ria"

      - nome: "uq_sistema_idiomas_codigo"
        tipo: "UNIQUE"
        colunas: ["codigo"]
        descricao: "Unicidade de c√≥digo ISO (RN-RF005-006)"

      - nome: "idx_sistema_idiomas_is_ativo"
        tipo: "BTREE"
        colunas: ["is_ativo"]
        descricao: "Performance em filtros por status ativo/inativo (WF-01)"

      - nome: "idx_sistema_idiomas_progresso"
        tipo: "BTREE"
        colunas: ["progresso_percentual"]
        descricao: "Performance em ordena√ß√£o por progresso (UC00-FA-003)"

      - nome: "idx_sistema_idiomas_created_at"
        tipo: "BTREE"
        colunas: ["created_at"]
        descricao: "Performance em ordena√ß√£o por data de cria√ß√£o"

    # -----------------------------
    # CONSTRAINTS
    # -----------------------------
    constraints:
      - nome: "uq_sistema_idiomas_codigo"
        tipo: "UNIQUE"
        definicao: "(codigo)"
        descricao: "C√≥digo de idioma √∫nico no sistema (RN-RF005-006)"

      - nome: "fk_sistema_idiomas_referencia"
        tipo: "FOREIGN KEY"
        definicao: "idioma_referencia_id REFERENCES sistema_idiomas(id)"
        on_delete: "SET NULL"
        descricao: "Idioma de refer√™ncia para fallback (RN-RF005-003)"

      - nome: "fk_sistema_idiomas_created_by"
        tipo: "FOREIGN KEY"
        definicao: "created_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - criador"

      - nome: "fk_sistema_idiomas_updated_by"
        tipo: "FOREIGN KEY"
        definicao: "updated_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - editor"

      - nome: "chk_sistema_idiomas_progresso"
        tipo: "CHECK"
        definicao: "progresso_percentual >= 0 AND progresso_percentual <= 100"
        descricao: "Progresso entre 0% e 100%"

      - nome: "chk_sistema_idiomas_separador"
        tipo: "CHECK"
        definicao: "separador_decimal IN (',', '.')"
        descricao: "Separador decimal permitido (v√≠rgula ou ponto)"

  # ===========================================================================
  # 2.2 ENTIDADE: sistema_traducao_chaves
  # ===========================================================================
  - nome: "sistema_traducao_chaves"
    descricao: "Chaves de tradu√ß√£o do sistema (common.buttons.save, menu.users.list, etc.)"

    campos:
      # ----- CHAVE PRIM√ÅRIA -----
      - nome: "id"
        tipo: "INTEGER"
        nulo: false
        default: "AUTOINCREMENT"
        descricao: "Chave prim√°ria"
        pk: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente pelo banco"

      # ----- CAMPOS DE NEG√ìCIO -----
      - nome: "chave"
        tipo: "VARCHAR(500)"
        nulo: false
        default: null
        descricao: "Chave de tradu√ß√£o (ex: common.buttons.save)"
        unique: true
        index: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: "WF-03"
          campo_wf: null
          observacao: "RN-RF005-008: Estrutura hier√°rquica de chaves (namespaces)"

      - nome: "categoria"
        tipo: "VARCHAR(100)"
        nulo: false
        default: null
        descricao: "Categoria/namespace principal (common, menu, validation)"
        index: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: null
          campo_wf: null
          observacao: "Extra√≠do da chave (parte antes do primeiro ponto)"

      - nome: "contexto"
        tipo: "TEXT"
        nulo: true
        default: null
        descricao: "Contexto/descri√ß√£o para tradutores (ex: 'Bot√£o de salvar formul√°rio')"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: "WF-03"
          campo_wf: "CMP-WF03-004"
          observacao: "Ajuda tradutores a entender o contexto"

      - nome: "tem_interpolacao"
        tipo: "BOOLEAN"
        nulo: false
        default: false
        descricao: "Chave cont√©m vari√°veis de interpola√ß√£o ({{var}})"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-009: Suporte a interpola√ß√£o de vari√°veis"

      - nome: "variaveis_interpolacao"
        tipo: "VARCHAR(500)"
        nulo: true
        default: null
        descricao: "Lista de vari√°veis separadas por v√≠rgula (username,email,count)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-010: Valida√ß√£o de interpola√ß√µes no upload"

      - nome: "tem_html"
        tipo: "BOOLEAN"
        nulo: false
        default: false
        descricao: "Chave cont√©m tags HTML (<b>, <i>, <a>)"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "RN-RF005-012: Valida√ß√£o de HTML balanceado"

      # ----- AUDITORIA -----
      - nome: "created_at"
        tipo: "DATETIME"
        nulo: true
        default: "CURRENT_TIMESTAMP"
        descricao: "Data de cria√ß√£o"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente pelo sistema"

      - nome: "created_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que criou a chave"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: null
          campo_wf: null
          observacao: "Criador da chave (desenvolvedor ou admin)"

      - nome: "updated_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Data de atualiza√ß√£o"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: null
          campo_wf: null
          observacao: "Atualizado ao modificar chave"

      - nome: "updated_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que atualizou a chave"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC02"
          wf: null
          campo_wf: null
          observacao: "Editor da chave"

      # ----- SOFT DELETE -----
      - nome: "deleted_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Soft delete"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: null
          wf: null
          campo_wf: null
          observacao: "Chaves obsoletas s√£o soft-deleted (n√£o exclu√≠das fisicamente)"

    # -----------------------------
    # √çNDICES
    # -----------------------------
    indices:
      - nome: "pk_sistema_traducao_chaves"
        tipo: "PRIMARY"
        colunas: ["id"]
        descricao: "Chave prim√°ria"

      - nome: "uq_sistema_traducao_chaves_chave"
        tipo: "UNIQUE"
        colunas: ["chave"]
        descricao: "Unicidade de chaves de tradu√ß√£o"

      - nome: "idx_sistema_traducao_chaves_categoria"
        tipo: "BTREE"
        colunas: ["categoria"]
        descricao: "Performance em filtros por namespace (WF-03, WF-10)"

      - nome: "idx_sistema_traducao_chaves_created_at"
        tipo: "BTREE"
        colunas: ["created_at"]
        descricao: "Performance em ordena√ß√£o por data de cria√ß√£o"

    # -----------------------------
    # CONSTRAINTS
    # -----------------------------
    constraints:
      - nome: "uq_sistema_traducao_chaves_chave"
        tipo: "UNIQUE"
        definicao: "(chave)"
        descricao: "Chave de tradu√ß√£o √∫nica no sistema"

      - nome: "fk_sistema_traducao_chaves_created_by"
        tipo: "FOREIGN KEY"
        definicao: "created_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - criador"

      - nome: "fk_sistema_traducao_chaves_updated_by"
        tipo: "FOREIGN KEY"
        definicao: "updated_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - editor"

  # ===========================================================================
  # 2.3 ENTIDADE: sistema_traducoes
  # ===========================================================================
  - nome: "sistema_traducoes"
    descricao: "Valores traduzidos por idioma (chave + idioma + valor)"

    campos:
      # ----- CHAVE PRIM√ÅRIA -----
      - nome: "id"
        tipo: "INTEGER"
        nulo: false
        default: "AUTOINCREMENT"
        descricao: "Chave prim√°ria"
        pk: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente pelo banco"

      # ----- CHAVES ESTRANGEIRAS -----
      - nome: "chave_id"
        tipo: "INTEGER"
        nulo: false
        default: null
        descricao: "FK para sistema_traducao_chaves"
        index: true
        mutavel: false
        fk:
          tabela: "sistema_traducao_chaves"
          coluna: "id"
          on_delete: "CASCADE"
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Chave de tradu√ß√£o vinculada"

      - nome: "idioma_id"
        tipo: "INTEGER"
        nulo: false
        default: null
        descricao: "FK para sistema_idiomas"
        index: true
        mutavel: false
        fk:
          tabela: "sistema_idiomas"
          coluna: "id"
          on_delete: "CASCADE"
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Idioma da tradu√ß√£o"

      # ----- CAMPOS DE NEG√ìCIO -----
      - nome: "valor"
        tipo: "TEXT"
        nulo: false
        default: null
        descricao: "Texto traduzido (ex: 'Salvar', 'Save', 'Guardar')"
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: "WF-04"
          campo_wf: "CMP-WF04-002"
          observacao: "Valor da tradu√ß√£o importado do arquivo (JSON/PO/XLSX)"

      - nome: "foi_traduzido_por_maquina"
        tipo: "BOOLEAN"
        nulo: false
        default: false
        descricao: "Tradu√ß√£o autom√°tica via Azure Translator API"
        index: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC08"
          wf: "WF-09"
          campo_wf: null
          observacao: "RN-RF005-018: Tradu√ß√£o autom√°tica via Azure Translator (marca√ß√£o)"

      - nome: "foi_revisado"
        tipo: "BOOLEAN"
        nulo: false
        default: false
        descricao: "Tradu√ß√£o autom√°tica foi revisada por humano"
        index: true
        mutavel: true
        origem:
          rf: "RF005"
          uc: "UC08"
          wf: "WF-09"
          campo_wf: null
          observacao: "RN-RF005-018: Revis√£o humana ap√≥s tradu√ß√£o autom√°tica"

      # ----- AUDITORIA -----
      - nome: "created_at"
        tipo: "DATETIME"
        nulo: true
        default: "CURRENT_TIMESTAMP"
        descricao: "Data de cria√ß√£o"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente ao importar tradu√ß√£o"

      - nome: "created_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que criou a tradu√ß√£o"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Tradutor ou admin que fez upload"

      - nome: "updated_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Data de atualiza√ß√£o"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Atualizado ao modificar tradu√ß√£o"

      - nome: "updated_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que atualizou a tradu√ß√£o"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC03"
          wf: null
          campo_wf: null
          observacao: "Editor da tradu√ß√£o"

      # ----- SOFT DELETE -----
      - nome: "deleted_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Soft delete"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: null
          wf: null
          campo_wf: null
          observacao: "Tradu√ß√µes obsoletas s√£o soft-deleted"

    # -----------------------------
    # √çNDICES
    # -----------------------------
    indices:
      - nome: "pk_sistema_traducoes"
        tipo: "PRIMARY"
        colunas: ["id"]
        descricao: "Chave prim√°ria"

      - nome: "uq_sistema_traducoes_chave_idioma"
        tipo: "UNIQUE"
        colunas: ["chave_id", "idioma_id"]
        descricao: "Unicidade de tradu√ß√£o por chave e idioma"

      - nome: "idx_sistema_traducoes_chave_idioma"
        tipo: "BTREE"
        colunas: ["chave_id", "idioma_id"]
        descricao: "Performance em busca de tradu√ß√£o espec√≠fica (UC10 - Lazy Loading)"

      - nome: "idx_sistema_traducoes_idioma"
        tipo: "BTREE"
        colunas: ["idioma_id"]
        descricao: "Performance em busca de tradu√ß√µes por idioma (UC09 - Exportar)"

      - nome: "idx_sistema_traducoes_maquina"
        tipo: "BTREE"
        colunas: ["foi_traduzido_por_maquina"]
        descricao: "Performance em filtros de tradu√ß√µes autom√°ticas (UC08)"

      - nome: "idx_sistema_traducoes_created_at"
        tipo: "BTREE"
        colunas: ["created_at"]
        descricao: "Performance em ordena√ß√£o por data de cria√ß√£o"

    # -----------------------------
    # CONSTRAINTS
    # -----------------------------
    constraints:
      - nome: "uq_sistema_traducoes_chave_idioma"
        tipo: "UNIQUE"
        definicao: "(chave_id, idioma_id)"
        descricao: "Uma chave s√≥ pode ter uma tradu√ß√£o por idioma"

      - nome: "fk_sistema_traducoes_chave"
        tipo: "FOREIGN KEY"
        definicao: "chave_id REFERENCES sistema_traducao_chaves(id)"
        on_delete: "CASCADE"
        descricao: "Chave de tradu√ß√£o vinculada"

      - nome: "fk_sistema_traducoes_idioma"
        tipo: "FOREIGN KEY"
        definicao: "idioma_id REFERENCES sistema_idiomas(id)"
        on_delete: "CASCADE"
        descricao: "Idioma da tradu√ß√£o"

      - nome: "fk_sistema_traducoes_created_by"
        tipo: "FOREIGN KEY"
        definicao: "created_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - criador"

      - nome: "fk_sistema_traducoes_updated_by"
        tipo: "FOREIGN KEY"
        definicao: "updated_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - editor"

  # ===========================================================================
  # 2.4 ENTIDADE: sistema_traducao_versoes
  # ===========================================================================
  - nome: "sistema_traducao_versoes"
    descricao: "Hist√≥rico de uploads de tradu√ß√£o (versionamento completo)"

    campos:
      # ----- CHAVE PRIM√ÅRIA -----
      - nome: "id"
        tipo: "INTEGER"
        nulo: false
        default: "AUTOINCREMENT"
        descricao: "Chave prim√°ria"
        pk: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: null
          campo_wf: null
          observacao: "Campo gerado automaticamente pelo banco"

      # ----- CHAVE ESTRANGEIRA -----
      - nome: "idioma_id"
        tipo: "INTEGER"
        nulo: false
        default: null
        descricao: "FK para sistema_idiomas"
        index: true
        mutavel: false
        fk:
          tabela: "sistema_idiomas"
          coluna: "id"
          on_delete: "CASCADE"
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: null
          observacao: "Idioma do upload versionado"

      # ----- CAMPOS DE NEG√ìCIO -----
      - nome: "numero_versao"
        tipo: "VARCHAR(20)"
        nulo: false
        default: null
        descricao: "N√∫mero da vers√£o (v1.0, v1.5, v2.0)"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "RN-RF005-015: Versionamento completo de uploads"

      - nome: "nome_arquivo"
        tipo: "VARCHAR(500)"
        nulo: false
        default: null
        descricao: "Nome do arquivo original (fr-FR-traducoes.json)"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: null
          observacao: "Armazenado para rastreabilidade"

      - nome: "formato_arquivo"
        tipo: "VARCHAR(10)"
        nulo: false
        default: null
        descricao: "Formato do arquivo (JSON, PO, XLSX)"
        mutavel: false
        check:
          definicao: "formato_arquivo IN ('JSON', 'PO', 'XLSX')"
          descricao: "Formatos suportados"
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: null
          observacao: "RN-RF005-011: Formatos de arquivo suportados"

      - nome: "conteudo_arquivo"
        tipo: "BLOB"
        nulo: true
        default: null
        descricao: "Arquivo original completo em bin√°rio"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC06"
          wf: "WF-07"
          campo_wf: null
          observacao: "RN-RF005-016: Backup autom√°tico antes de sobrescrever"

      - nome: "tamanho_arquivo_kb"
        tipo: "INTEGER"
        nulo: false
        default: 0
        descricao: "Tamanho do arquivo em KB"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: null
          observacao: "Estat√≠stica para an√°lise de uploads"

      - nome: "hash_md5"
        tipo: "VARCHAR(32)"
        nulo: true
        default: null
        descricao: "Hash MD5 do arquivo (detec√ß√£o de duplicatas)"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-006"
          observacao: "Evita uploads duplicados exatos"

      - nome: "chaves_adicionadas"
        tipo: "INTEGER"
        nulo: false
        default: 0
        descricao: "Chaves adicionadas nesta vers√£o"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "RN-RF005-015: Delta de progresso"

      - nome: "chaves_atualizadas"
        tipo: "INTEGER"
        nulo: false
        default: 0
        descricao: "Chaves atualizadas nesta vers√£o"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "RN-RF005-015: Delta de progresso"

      - nome: "chaves_removidas"
        tipo: "INTEGER"
        nulo: false
        default: 0
        descricao: "Chaves removidas nesta vers√£o"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: null
          observacao: "RN-RF005-015: Delta de progresso"

      - nome: "progresso_anterior"
        tipo: "DECIMAL(5,2)"
        nulo: false
        default: 0.00
        descricao: "Progresso antes do upload (%)"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "RN-RF005-015: Delta de progresso (ex: 60%)"

      - nome: "progresso_novo"
        tipo: "DECIMAL(5,2)"
        nulo: false
        default: 0.00
        descricao: "Progresso ap√≥s o upload (%)"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "RN-RF005-015: Delta de progresso (ex: 95%)"

      - nome: "tipo_operacao"
        tipo: "VARCHAR(20)"
        nulo: false
        default: "UPLOAD"
        descricao: "Tipo de opera√ß√£o (UPLOAD, ROLLBACK, AUTO_TRANSLATE)"
        mutavel: false
        check:
          definicao: "tipo_operacao IN ('UPLOAD', 'ROLLBACK', 'AUTO_TRANSLATE')"
          descricao: "Tipos de opera√ß√£o permitidos"
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "Diferencia upload manual de tradu√ß√£o autom√°tica ou rollback"

      - nome: "observacoes"
        tipo: "TEXT"
        nulo: true
        default: null
        descricao: "Observa√ß√µes sobre a vers√£o (ex: 'Upload via Azure Translator API')"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-006"
          observacao: "Contexto adicional para auditoria"

      - nome: "ip_upload"
        tipo: "VARCHAR(45)"
        nulo: true
        default: null
        descricao: "IP do usu√°rio que fez upload"
        mutavel: false
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-006"
          observacao: "Rastreabilidade de origem do upload"

      # ----- AUDITORIA -----
      - nome: "created_at"
        tipo: "DATETIME"
        nulo: true
        default: "CURRENT_TIMESTAMP"
        descricao: "Data do upload (data da vers√£o)"
        audit: true
        mutavel: false
        index: true
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "Data/hora do upload (ordena√ß√£o do hist√≥rico)"

      - nome: "created_by"
        tipo: "INTEGER"
        nulo: true
        default: null
        descricao: "Usu√°rio que fez o upload"
        audit: true
        mutavel: false
        fk:
          tabela: "usuarios"
          coluna: "id"
          on_delete: "SET NULL"
        origem:
          rf: "RF005"
          uc: "UC05"
          wf: "WF-06"
          campo_wf: "CMP-WF06-003"
          observacao: "Tradutor ou admin respons√°vel pelo upload"

      # N√£o possui updated_at/updated_by (registro imut√°vel ap√≥s cria√ß√£o)

      # ----- SOFT DELETE -----
      - nome: "deleted_at"
        tipo: "DATETIME"
        nulo: true
        default: null
        descricao: "Soft delete"
        audit: true
        mutavel: false
        origem:
          rf: "RF005"
          uc: null
          wf: null
          campo_wf: null
          observacao: "Vers√µes antigas podem ser soft-deleted ap√≥s reten√ß√£o"

    # -----------------------------
    # √çNDICES
    # -----------------------------
    indices:
      - nome: "pk_sistema_traducao_versoes"
        tipo: "PRIMARY"
        colunas: ["id"]
        descricao: "Chave prim√°ria"

      - nome: "idx_sistema_traducao_versoes_idioma"
        tipo: "BTREE"
        colunas: ["idioma_id"]
        descricao: "Performance em filtros por idioma (UC05)"

      - nome: "idx_sistema_traducao_versoes_data"
        tipo: "BTREE"
        colunas: ["idioma_id", "created_at"]
        descricao: "Performance em ordena√ß√£o de hist√≥rico (UC05 - WF-06)"

      - nome: "idx_sistema_traducao_versoes_tipo"
        tipo: "BTREE"
        colunas: ["tipo_operacao"]
        descricao: "Performance em filtros por tipo de opera√ß√£o"

    # -----------------------------
    # CONSTRAINTS
    # -----------------------------
    constraints:
      - nome: "fk_sistema_traducao_versoes_idioma"
        tipo: "FOREIGN KEY"
        definicao: "idioma_id REFERENCES sistema_idiomas(id)"
        on_delete: "CASCADE"
        descricao: "Idioma do upload versionado"

      - nome: "fk_sistema_traducao_versoes_created_by"
        tipo: "FOREIGN KEY"
        definicao: "created_by REFERENCES usuarios(id)"
        on_delete: "SET NULL"
        descricao: "Auditoria - usu√°rio respons√°vel pelo upload"

      - nome: "chk_sistema_traducao_versoes_formato"
        tipo: "CHECK"
        definicao: "formato_arquivo IN ('JSON', 'PO', 'XLSX')"
        descricao: "Formatos de arquivo permitidos (RN-RF005-011)"

      - nome: "chk_sistema_traducao_versoes_tipo"
        tipo: "CHECK"
        definicao: "tipo_operacao IN ('UPLOAD', 'ROLLBACK', 'AUTO_TRANSLATE')"
        descricao: "Tipos de opera√ß√£o permitidos"

# =============================================
# 3. RELACIONAMENTOS GLOBAIS
# =============================================
relacionamentos_globais:
  - origem: "sistema_idiomas"
    cardinalidade: "1:N"
    destino: "sistema_traducoes"
    descricao: "Um idioma possui muitas tradu√ß√µes"

  - origem: "sistema_traducao_chaves"
    cardinalidade: "1:N"
    destino: "sistema_traducoes"
    descricao: "Uma chave de tradu√ß√£o possui tradu√ß√µes em m√∫ltiplos idiomas"

  - origem: "sistema_idiomas"
    cardinalidade: "1:N"
    destino: "sistema_traducao_versoes"
    descricao: "Um idioma possui muitas vers√µes de upload"

  - origem: "sistema_idiomas"
    cardinalidade: "1:N (self-reference)"
    destino: "sistema_idiomas"
    descricao: "Um idioma pode referenciar outro idioma para fallback (RN-RF005-003)"

  - origem: "usuarios"
    cardinalidade: "1:N"
    destino: "sistema_idiomas"
    descricao: "Um usu√°rio pode criar/atualizar m√∫ltiplos idiomas (auditoria)"

  - origem: "usuarios"
    cardinalidade: "1:N"
    destino: "sistema_traducao_chaves"
    descricao: "Um usu√°rio pode criar/atualizar m√∫ltiplas chaves (auditoria)"

  - origem: "usuarios"
    cardinalidade: "1:N"
    destino: "sistema_traducoes"
    descricao: "Um usu√°rio pode criar/atualizar m√∫ltiplas tradu√ß√µes (auditoria)"

  - origem: "usuarios"
    cardinalidade: "1:N"
    destino: "sistema_traducao_versoes"
    descricao: "Um usu√°rio pode fazer m√∫ltiplos uploads (auditoria)"

# =============================================
# 4. OBSERVA√á√ïES E DECIS√ïES
# =============================================
observacoes:
  - categoria: "Modelagem"
    descricao: |
      **Decis√µes Arquiteturais:**

      1. **Multi-tenancy:** Tradu√ß√µes s√£o GLOBAIS (n√£o isoladas por tenant).
         - Justificativa: Idiomas e tradu√ß√µes s√£o compartilhados entre todos os tenants.
         - Configura√ß√£o de idioma preferido pode ser por tenant (tabela usuarios).
         - Auditoria de altera√ß√µes rastreia tenant via created_by/updated_by.

      2. **Estrutura de 4 tabelas principais:**
         - sistema_idiomas: Idiomas cadastrados (pt-BR, en-US, es-ES, fr-FR)
         - sistema_traducao_chaves: Chaves de tradu√ß√£o (common.buttons.save)
         - sistema_traducoes: Valores traduzidos (chave + idioma + valor)
         - sistema_traducao_versoes: Hist√≥rico de uploads (versionamento)

      3. **Versionamento completo (RN-RF005-015, RN-RF005-016):**
         - Todo upload cria nova vers√£o em sistema_traducao_versoes
         - Arquivo original armazenado em BLOB (backup autom√°tico)
         - Delta de progresso registrado (progresso_anterior ‚Üí progresso_novo)
         - Rollback poss√≠vel via UC06 (restaurar vers√£o anterior)

      4. **Campos obrigat√≥rios de auditoria:**
         - created_at, created_by, updated_at, updated_by, deleted_at
         - Todas as tabelas possuem soft delete
         - pt-BR NUNCA pode ser exclu√≠do (RN-RF005-001)

      5. **Self-reference em sistema_idiomas:**
         - idioma_referencia_id permite fallback hier√°rquico
         - Exemplo: fr-FR ‚Üí en-US ‚Üí pt-BR (RN-RF005-003)

  - categoria: "Performance"
    descricao: |
      **√çndices de Performance:**

      1. **Cache Redis obrigat√≥rio (RN-RF005-017):**
         - Chave: i18n:{lang}:* (ex: i18n:en-US:common)
         - TTL: 24 horas (invalida√ß√£o autom√°tica ap√≥s upload)
         - Lazy Loading: Carregar namespace sob demanda
         - Benef√≠cio: Redu√ß√£o de 90% nas queries ao banco (50 RPS ‚Üí 5 RPS)

      2. **√çndices principais:**
         - sistema_idiomas: is_ativo, progresso_percentual (UC00 - filtros e ordena√ß√£o)
         - sistema_traducao_chaves: categoria (UC02, UC09, UC10 - filtros por namespace)
         - sistema_traducoes: (chave_id, idioma_id) UNIQUE (UC10 - busca r√°pida)
         - sistema_traducao_versoes: (idioma_id, created_at) (UC05 - hist√≥rico ordenado)

      3. **Lazy Loading de tradu√ß√µes (RN-RF005-020):**
         - Frontend carrega tradu√ß√µes sob demanda (m√≥dulos n√£o usados n√£o s√£o carregados)
         - Namespaces iniciais: common.*, menu.*
         - Namespaces adicionais carregados dinamicamente
         - Benef√≠cio: Redu√ß√£o de 70% no tamanho inicial do bundle

      4. **Consultas otimizadas:**
         - UC00: SELECT com filtro is_ativo e ordena√ß√£o por progresso_percentual
         - UC10: SELECT tradu√ß√µes por (chave_id, idioma_id) com √≠ndice UNIQUE
         - UC05: SELECT vers√µes por idioma com ordena√ß√£o DESC por created_at

  - categoria: "Migra√ß√£o"
    descricao: |
      **Regras de Migra√ß√£o do Sistema Legado:**

      1. **An√°lise do legado (RL-RF005.md):**
         - Sistema legado: Arquivos i18n est√°ticos (JSON em frontend)
         - IStringLocalizer configurado (backend .NET)
         - Lazy loading de tradu√ß√µes j√° implementado
         - **Problema:** Gest√£o manual de tradu√ß√µes (sem UI administrativa)

      2. **Estrat√©gia de migra√ß√£o:**
         - Importar arquivos JSON existentes via UC03 (Upload de Tradu√ß√µes)
         - Validar estrutura de chaves (RN-RF005-008: namespaces hier√°rquicos)
         - Criar idiomas ativos: pt-BR (100%), en-US (parcial)
         - Gerar chaves de tradu√ß√£o automaticamente a partir dos arquivos

      3. **Compatibilidade:**
         - Manter formato JSON para frontend (Angular)
         - Manter IStringLocalizer para backend (.NET)
         - Adicionar camada de gest√£o administrativa (RF005)

      4. **Cuidados:**
         - pt-BR SEMPRE 100% traduzido (RN-RF005-001)
         - Validar interpola√ß√µes {{var}} ao migrar (RN-RF005-010)
         - Validar HTML balanceado ao migrar (RN-RF005-012)
         - Backup completo antes de migra√ß√£o (RN-RF005-016)

  - categoria: "Seguran√ßa"
    descricao: |
      **Seguran√ßa e Permiss√µes:**

      1. **Permiss√µes RBAC (RN-RF005-019):**
         - SYS.I18N.READ: Visualizar idiomas e progresso (todos autenticados)
         - SYS.I18N.MANAGE_LANGUAGES: Criar, ativar, desativar idiomas (Admin)
         - SYS.I18N.DOWNLOAD_TEMPLATE: Baixar templates (Admin, Tradutor)
         - SYS.I18N.UPLOAD_TRANSLATION: Upload de tradu√ß√µes (Admin, Tradutor)
         - SYS.I18N.MANAGE_TRANSLATIONS: Restaurar vers√µes (Admin)
         - SYS.I18N.AUTO_TRANSLATE: Tradu√ß√£o autom√°tica Azure (Admin)

      2. **Valida√ß√µes obrigat√≥rias:**
         - Valida√ß√£o de c√≥digo ISO (RN-RF005-005): Regex ^[a-z]{2}-[A-Z]{2}$
         - Valida√ß√£o de unicidade (RN-RF005-006): C√≥digo de idioma √∫nico
         - Valida√ß√£o de interpola√ß√µes (RN-RF005-010): Consist√™ncia de {{var}}
         - Valida√ß√£o de HTML (RN-RF005-012): Tags balanceadas

      3. **Prote√ß√µes:**
         - pt-BR NUNCA pode ser desativado ou exclu√≠do (RN-RF005-001)
         - Backup autom√°tico antes de sobrescrever (RN-RF005-016)
         - Transa√ß√£o at√¥mica no rollback (UC06)
         - Auditoria completa de todas as opera√ß√µes (RF-004)

# =============================================
# 5. HIST√ìRICO DE ALTERA√á√ïES
# =============================================
historico:
  - versao: "2.0"
    data: "2026-01-04"
    autor: "Ag√™ncia ALC - alc.dev.br"
    descricao: |
      Vers√£o inicial completa do Modelo de Dados RF005 - Internacionaliza√ß√£o (i18n).

      Tabelas criadas:
      - sistema_idiomas (8 idiomas iniciais suportados)
      - sistema_traducao_chaves (1.247+ chaves estimadas)
      - sistema_traducoes (rela√ß√£o N:N entre chaves e idiomas)
      - sistema_traducao_versoes (hist√≥rico completo de uploads)

      Deriva√ß√£o completa de:
      - RF005.yaml (22 Regras de Neg√≥cio - 100% cobertas)
      - UC-RF005.yaml (11 Casos de Uso - 100% rastreados)
      - WF-RF005.md (11 Wireframes - 100% mapeados)

      Regras de neg√≥cio implementadas:
      - RN-RF005-001: Idioma padr√£o obrigat√≥rio (pt-BR)
      - RN-RF005-003: Fallback em cascata hier√°rquico
      - RN-RF005-005: Valida√ß√£o de c√≥digo ISO
      - RN-RF005-006: C√≥digo de idioma √∫nico
      - RN-RF005-008: Estrutura hier√°rquica de chaves (namespaces)
      - RN-RF005-009: Suporte a interpola√ß√£o de vari√°veis
      - RN-RF005-010: Valida√ß√£o de interpola√ß√µes no upload
      - RN-RF005-011: Formatos de arquivo suportados (JSON, PO, XLSX)
      - RN-RF005-012: Valida√ß√£o de HTML balanceado
      - RN-RF005-015: Versionamento completo de uploads
      - RN-RF005-016: Backup autom√°tico antes de sobrescrever
      - RN-RF005-017: Cache Redis para performance
      - RN-RF005-018: Tradu√ß√£o autom√°tica via Azure Translator
      - RN-RF005-020: Lazy loading de tradu√ß√µes

      Campos obrigat√≥rios implementados:
      - Multi-tenancy: N√ÉO (tradu√ß√µes globais)
      - Auditoria: SIM (created_at, created_by, updated_at, updated_by)
      - Soft delete: SIM (deleted_at em todas as tabelas)

      √çndices de performance criados:
      - is_ativo (filtros WF-01)
      - progresso_percentual (ordena√ß√£o WF-01)
      - categoria (filtros por namespace WF-03, WF-10)
      - (chave_id, idioma_id) UNIQUE (busca r√°pida UC10)
      - (idioma_id, created_at) (hist√≥rico UC05)
