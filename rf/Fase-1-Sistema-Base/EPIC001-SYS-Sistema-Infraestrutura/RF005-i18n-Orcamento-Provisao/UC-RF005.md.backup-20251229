# UC-RF005 - Casos de Uso - Internacionaliza√ß√£o (i18n) e Localiza√ß√£o

**RF Relacionado**: RF-005 - Internacionaliza√ß√£o (i18n) e Localiza√ß√£o
**Vers√£o**: 1.0
**√öltima Atualiza√ß√£o**: 2025-12-28
**Respons√°vel**: Equipe de Desenvolvimento IControlIT

---

## UC01: Listar Idiomas Dispon√≠veis

### 1. Descri√ß√£o

Este caso de uso permite que administradores de sistema visualizem todos os idiomas cadastrados no sistema, incluindo status de ativa√ß√£o, progresso de tradu√ß√£o e a√ß√µes dispon√≠veis para cada idioma.

### 2. Atores

- **Ator Principal**: Administrador de Sistema
- **Ator Secund√°rio**: Sistema

### 3. Pr√©-condi√ß√µes

- Usu√°rio autenticado no sistema
- Usu√°rio possui permiss√£o: `SYS.I18N.READ`
- Multi-tenancy ativo (ClienteId v√°lido)

### 4. Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Acessa menu Sistema ‚Üí Configura√ß√µes ‚Üí Internacionaliza√ß√£o | - |
| 2 | - | Valida permiss√£o `SYS.I18N.READ` |
| 3 | - | Executa query `GET /api/i18n/languages` |
| 4 | - | Retorna lista de idiomas com: c√≥digo, nome, bandeira, status, progresso |
| 5 | - | Renderiza interface com lista de idiomas |
| 6 | Visualiza idiomas existentes com progresso de tradu√ß√£o | - |

### 5. Fluxos Alternativos

**FA01: Filtrar Idiomas por Status**
- 2a. Usu√°rio seleciona filtro (Ativo/Inativo)
- 2b. Sistema aplica filtro na lista
- 2c. Exibe apenas idiomas conforme filtro selecionado
- 2d. Retorna ao passo 6

**FA02: Ordenar por Progresso de Tradu√ß√£o**
- 2a. Usu√°rio clica em coluna "Progresso"
- 2b. Sistema ordena lista por % de tradu√ß√£o (crescente/decrescente)
- 2c. Retorna ao passo 6

**FA03: Buscar Idioma Espec√≠fico**
- 2a. Usu√°rio digita nome ou c√≥digo do idioma na busca
- 2b. Sistema filtra lista em tempo real
- 2c. Exibe apenas idiomas que correspondem √† busca
- 2d. Retorna ao passo 6

### 6. Exce√ß√µes

**EX01: Usu√°rio sem Permiss√£o**
- 2a. Sistema detecta falta de permiss√£o `SYS.I18N.READ`
- 2b. Sistema retorna HTTP 403 Forbidden
- 2c. Exibe mensagem: "Voc√™ n√£o tem permiss√£o para visualizar idiomas"
- 2d. Redireciona para p√°gina anterior

**EX02: Erro ao Carregar Idiomas**
- 3a. Falha na comunica√ß√£o com API
- 3b. Sistema retorna HTTP 500
- 3c. Exibe mensagem: "Erro ao carregar idiomas. Tente novamente."
- 3d. Permite tentar novamente

**EX03: Nenhum Idioma Cadastrado**
- 4a. Sistema n√£o encontra idiomas cadastrados
- 4b. Exibe mensagem informativa: "Nenhum idioma cadastrado. Crie o primeiro idioma."
- 4c. Exibe bot√£o [+ Novo Idioma]
- 4d. Retorna ao passo 6

### 7. P√≥s-condi√ß√µes

- Usu√°rio visualiza status de todos os idiomas cadastrados
- Para cada idioma, visualiza: bandeira, nome, c√≥digo, status (Ativo/Inativo), progresso (%), a√ß√µes dispon√≠veis
- Opera√ß√£o registrada em auditoria (tipo: READ)

### 8. Regras de Neg√≥cio Aplic√°veis

- **RN-I18N-001**: Detec√ß√£o Autom√°tica de Idioma
- **RN-I18N-016**: Gest√£o de Idiomas pelo Usu√°rio
- **RN-I18N-022**: Bandeiras e √çcones de Idiomas

---

## UC02: Adicionar Novo Idioma

### 1. Descri√ß√£o

Este caso de uso permite que administradores criem novos idiomas no sistema, configurando c√≥digo ISO, pa√≠s/regi√£o, bandeira e idioma de refer√™ncia para gera√ß√£o de template de tradu√ß√£o.

### 2. Atores

- **Ator Principal**: Administrador de Sistema
- **Ator Secund√°rio**: Sistema

### 3. Pr√©-condi√ß√µes

- Usu√°rio autenticado no sistema
- Usu√°rio possui permiss√£o: `SYS.I18N.MANAGE_LANGUAGES`
- Multi-tenancy ativo (ClienteId v√°lido)
- Interface de listagem de idiomas carregada (UC01)

### 4. Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Clica em bot√£o [+ Novo Idioma] | - |
| 2 | - | Abre modal "Adicionar Novo Idioma" |
| 3 | - | Carrega lista de idiomas ISO 639-1 (200+ idiomas) |
| 4 | Seleciona idioma da lista dropdown | - |
| 5 | - | Auto-preenche c√≥digo do idioma (ex: pt-BR) |
| 6 | Seleciona pa√≠s/regi√£o para formata√ß√£o | - |
| 7 | - | Sugere bandeira automaticamente baseada no c√≥digo do pa√≠s |
| 8 | Confirma ou altera bandeira sugerida | - |
| 9 | Seleciona idioma de refer√™ncia (padr√£o: pt-BR) | - |
| 10 | Clica em [Criar Idioma] | - |
| 11 | - | Valida permiss√£o `SYS.I18N.MANAGE_LANGUAGES` |
| 12 | - | Valida unicidade do c√≥digo do idioma |
| 13 | - | Executa `POST /api/i18n/languages` |
| 14 | - | Cria registro do idioma com Status: Inativo |
| 15 | - | Registra opera√ß√£o em auditoria (CREATE) |
| 16 | - | Invalida cache Redis para lista de idiomas |
| 17 | - | Exibe mensagem de sucesso: "Idioma criado! Pr√≥ximo passo: baixe o template de tradu√ß√£o" |
| 18 | - | Fecha modal e atualiza lista de idiomas |

### 5. Fluxos Alternativos

**FA01: C√≥digo de Idioma Duplicado**
- 12a. Sistema detecta que c√≥digo j√° existe
- 12b. Retorna HTTP 400 Bad Request
- 12c. Exibe mensagem: "Idioma {c√≥digo} j√° cadastrado"
- 12d. Destaca campo "C√≥digo do Idioma" em vermelho
- 12e. Retorna ao passo 4

**FA02: Selecionar Bandeira Customizada**
- 8a. Usu√°rio clica em [Alterar Bandeira]
- 8b. Sistema exibe seletor de bandeiras (flag-icons)
- 8c. Usu√°rio seleciona bandeira manualmente
- 8d. Retorna ao passo 9

**FA03: Cancelar Cria√ß√£o**
- 10a. Usu√°rio clica em [Cancelar]
- 10b. Sistema exibe confirma√ß√£o: "Descartar cria√ß√£o de idioma?"
- 10c. Usu√°rio confirma
- 10d. Sistema fecha modal sem salvar
- 10e. UC encerrado

### 6. Exce√ß√µes

**EX01: Usu√°rio sem Permiss√£o**
- 11a. Sistema detecta falta de permiss√£o `SYS.I18N.MANAGE_LANGUAGES`
- 11b. Sistema retorna HTTP 403 Forbidden
- 11c. Exibe mensagem: "Voc√™ n√£o tem permiss√£o para criar idiomas"
- 11d. Fecha modal

**EX02: Dados Inv√°lidos no Formul√°rio**
- 13a. Sistema detecta campos obrigat√≥rios vazios
- 13b. Retorna HTTP 400 Bad Request
- 13c. Exibe mensagem: "Preencha todos os campos obrigat√≥rios"
- 13d. Destaca campos inv√°lidos em vermelho
- 13e. Retorna ao passo 4

**EX03: Erro ao Criar Idioma**
- 14a. Falha ao criar registro no banco
- 14b. Sistema retorna HTTP 500
- 14c. Exibe mensagem: "Erro ao criar idioma. Tente novamente."
- 14d. Permite tentar novamente ou cancelar

### 7. P√≥s-condi√ß√µes

- Novo idioma criado com Status: Inativo
- Progresso de tradu√ß√£o: 0% (0/1.247 chaves)
- Idioma dispon√≠vel para receber tradu√ß√µes
- Opera√ß√£o registrada em auditoria (CREATE) com dados: c√≥digo, nome, pa√≠s, usu√°rio, timestamp
- Cache Redis invalidado

### 8. Regras de Neg√≥cio Aplic√°veis

- **RN-I18N-016**: Gest√£o de Idiomas pelo Usu√°rio
- **RN-I18N-022**: Bandeiras e √çcones de Idiomas

---

## UC03: Baixar Template de Tradu√ß√£o

### 1. Descri√ß√£o

Este caso de uso permite que administradores e tradutores baixem arquivos modelo contendo todas as chaves de tradu√ß√£o do sistema em formatos JSON, PO (Gettext) ou XLSX (Excel), para serem preenchidos offline.

### 2. Atores

- **Ator Principal**: Administrador de Sistema / Tradutor
- **Ator Secund√°rio**: Sistema

### 3. Pr√©-condi√ß√µes

- Usu√°rio autenticado no sistema
- Usu√°rio possui permiss√£o: `SYS.I18N.DOWNLOAD_TEMPLATE`
- Multi-tenancy ativo (ClienteId v√°lido)
- Idioma de destino j√° criado no sistema

### 4. Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Seleciona idioma na lista | - |
| 2 | Clica em bot√£o [üì• Baixar Template] | - |
| 3 | - | Abre modal "Baixar Template de Tradu√ß√£o" |
| 4 | - | Exibe idioma selecionado (ex: üá´üá∑ Fran√ßais - fr-FR) |
| 5 | Seleciona tipo de download: Template Vazio OU Tradu√ß√£o Atual | - |
| 6 | Seleciona formato do arquivo: JSON, PO ou XLSX | - |
| 7 | Marca op√ß√µes desejadas: ‚òë Coment√°rios/Contexto, ‚òë Exemplos, ‚òë Tradu√ß√µes de refer√™ncia | - |
| 8 | - | Exibe estat√≠sticas: Total de chaves (1.247), Namespaces (47), Tamanho estimado (~250 KB) |
| 9 | Clica em [üì• Baixar] | - |
| 10 | - | Valida permiss√£o `SYS.I18N.DOWNLOAD_TEMPLATE` |
| 11 | - | Executa `GET /api/i18n/languages/{code}/download?format={format}&type={type}` |
| 12 | - | Busca todas as chaves de tradu√ß√£o ativas (1.247+) |
| 13 | - | Se Tipo = Current: busca tradu√ß√µes existentes do idioma |
| 14 | - | Busca tradu√ß√µes de refer√™ncia (pt-BR padr√£o) |
| 15 | - | Gera arquivo no formato selecionado (JSON/PO/XLSX) |
| 16 | - | Inclui metadata, coment√°rios, contexto conforme op√ß√µes marcadas |
| 17 | - | Registra download em auditoria (DOWNLOAD) |
| 18 | - | Envia arquivo para download no navegador |
| 19 | Recebe arquivo: {idioma}-template.{formato} | - |

### 5. Fluxos Alternativos

**FA01: Download de Tradu√ß√£o Atual para Atualiza√ß√£o**
- 5a. Usu√°rio seleciona "Tradu√ß√£o Atual"
- 5b. Sistema busca tradu√ß√µes j√° existentes para o idioma
- 5c. Preenche arquivo com tradu√ß√µes atuais
- 5d. Continua no passo 6

**FA02: Download em Formato XLSX (Excel)**
- 6a. Usu√°rio seleciona formato XLSX
- 6b. Sistema gera planilha Excel com colunas: Chave | {idioma} | Refer√™ncia (pt-BR) | Contexto | Categoria
- 6c. Aplica formata√ß√£o: cabe√ßalho em negrito, cores, autofit, freeze header
- 6d. Destaca chaves com interpola√ß√£o em azul it√°lico
- 6e. Continua no passo 8

**FA03: Download em Formato JSON**
- 6a. Usu√°rio seleciona formato JSON
- 6b. Sistema gera estrutura hier√°rquica (namespaces)
- 6c. Adiciona coment√°rios como campos `_comment_{chave}` se op√ß√£o marcada
- 6d. Adiciona refer√™ncias como campos `_ref_{chave}` se op√ß√£o marcada
- 6e. Formata com indenta√ß√£o (pretty-print)
- 6f. Continua no passo 8

**FA04: Download em Formato PO (Gettext)**
- 6a. Usu√°rio seleciona formato PO
- 6b. Sistema gera arquivo .po padr√£o Gettext
- 6c. Adiciona campos msgid (chave) e msgstr (tradu√ß√£o)
- 6d. Inclui metadata e headers
- 6e. Continua no passo 8

### 6. Exce√ß√µes

**EX01: Usu√°rio sem Permiss√£o**
- 10a. Sistema detecta falta de permiss√£o `SYS.I18N.DOWNLOAD_TEMPLATE`
- 10b. Sistema retorna HTTP 403 Forbidden
- 10c. Exibe mensagem: "Voc√™ n√£o tem permiss√£o para baixar templates de tradu√ß√£o"
- 10d. Fecha modal

**EX02: Idioma N√£o Encontrado**
- 12a. Sistema n√£o encontra idioma com c√≥digo informado
- 12b. Retorna HTTP 404 Not Found
- 12c. Exibe mensagem: "Idioma n√£o encontrado"
- 12d. Retorna ao UC01

**EX03: Erro ao Gerar Arquivo**
- 15a. Falha ao gerar arquivo (mem√≥ria, processamento)
- 15b. Sistema retorna HTTP 500
- 15c. Exibe mensagem: "Erro ao gerar template. Tente novamente ou selecione outro formato."
- 15d. Permite tentar novamente

### 7. P√≥s-condi√ß√µes

- Usu√°rio possui arquivo modelo para tradu√ß√£o no formato selecionado
- Arquivo cont√©m todas as chaves ativas do sistema (1.247+)
- Se op√ß√µes marcadas: arquivo inclui coment√°rios, contexto, tradu√ß√µes de refer√™ncia
- Opera√ß√£o registrada em auditoria (DOWNLOAD) com dados: idioma, formato, tipo, usu√°rio, timestamp, quantidade de chaves

### 8. Regras de Neg√≥cio Aplic√°veis

- **RN-I18N-013**: Namespace Hier√°rquico
- **RN-I18N-017**: Download de Template de Tradu√ß√£o
- **RN-I18N-021**: Formatos de Arquivo Suportados

---

## UC04: Upload de Tradu√ß√µes

### 1. Descri√ß√£o

Este caso de uso permite que administradores e tradutores fa√ßam upload de arquivos de tradu√ß√£o preenchidos (JSON, PO ou XLSX), com valida√ß√£o autom√°tica de estrutura, interpola√ß√µes e integridade antes de importar para o sistema.

### 2. Atores

- **Ator Principal**: Administrador de Sistema / Tradutor
- **Ator Secund√°rio**: Sistema

### 3. Pr√©-condi√ß√µes

- Usu√°rio autenticado no sistema
- Usu√°rio possui permiss√£o: `SYS.I18N.UPLOAD_TRANSLATION`
- Multi-tenancy ativo (ClienteId v√°lido)
- Arquivo de tradu√ß√£o preenchido dispon√≠vel
- Idioma de destino j√° criado no sistema

### 4. Fluxo Principal

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Seleciona idioma de destino na lista | - |
| 2 | Clica em bot√£o [üì§ Atualizar] | - |
| 3 | - | Abre modal "Enviar Arquivo de Tradu√ß√£o" |
| 4 | - | Exibe idioma selecionado (ex: üá´üá∑ Fran√ßais - fr-FR) |
| 5 | - | Exibe √°rea de drag & drop para arquivo |
| 6 | Arrasta arquivo para √°rea de upload OU clica para selecionar | - |
| 7 | - | Valida formato do arquivo (JSON/PO/XLSX) |
| 8 | - | Valida encoding (UTF-8 obrigat√≥rio) |
| 9 | - | Valida tamanho (m√°ximo 5 MB) |
| 10 | - | Exibe pr√©-visualiza√ß√£o: nome do arquivo, tamanho, formato v√°lido |
| 11 | Marca op√ß√µes de importa√ß√£o: ‚òë Sobrescrever existentes, ‚òë Validar interpola√ß√µes, ‚òë Gerar relat√≥rio | - |
| 12 | Clica em [üì§ Enviar] | - |
| 13 | - | Valida permiss√£o `SYS.I18N.UPLOAD_TRANSLATION` |
| 14 | - | Executa `POST /api/i18n/languages/{code}/upload` |
| 15 | - | Cria backup da vers√£o atual antes de importar |
| 16 | - | Parseia arquivo conforme formato (JSON/PO/XLSX) |
| 17 | - | Valida estrutura de chaves (namespaces corretos) |
| 18 | - | Valida interpola√ß√µes: `{{variavel}}` presentes e corretas |
| 19 | - | Valida chaves obrigat√≥rias presentes |
| 20 | - | Valida caracteres especiais e HTML balanceado |
| 21 | - | Detecta avisos: tradu√ß√µes longas (> 500 chars), tradu√ß√µes id√™nticas ao original |
| 22 | - | Importa tradu√ß√µes para o banco de dados |
| 23 | - | Calcula novo progresso de tradu√ß√£o (%) |
| 24 | - | Registra vers√£o do upload (hist√≥rico) |
| 25 | - | Registra opera√ß√£o em auditoria (UPLOAD) |
| 26 | - | Invalida cache Redis para o idioma |
| 27 | - | Gera relat√≥rio detalhado de importa√ß√£o |
| 28 | - | Exibe modal de resultado com estat√≠sticas |

### 5. Fluxos Alternativos

**FA01: Upload com Avisos N√£o-Cr√≠ticos**
- 21a. Sistema detecta avisos (tradu√ß√µes longas, id√™nticas)
- 21b. Continua importa√ß√£o normalmente
- 21c. Inclui avisos no relat√≥rio final
- 21d. Exibe lista de avisos no modal de resultado
- 21e. Permite revis√£o posterior
- 21f. Continua no passo 22

**FA02: Ativar Idioma Automaticamente se 100%**
- 23a. Progresso atinge 100% (todas as chaves traduzidas)
- 23b. Op√ß√£o "Ativar automaticamente se 100%" estava marcada
- 23c. Sistema ativa idioma automaticamente
- 23d. Invalida cache de idiomas ativos
- 23e. Notifica usu√°rio: "Idioma ativado automaticamente (100% completo)"
- 23f. Continua no passo 24

**FA03: Progresso < 80% ao Tentar Ativar**
- 23a. Progresso < 80% mas usu√°rio tentou ativar
- 23b. Sistema exibe aviso: "Progresso abaixo de 80%. Ativar mesmo assim?"
- 23c. Usu√°rio decide ativar parcialmente OU completar tradu√ß√µes
- 23d. Se ativar: idioma fica ativo com fallback pt-BR para chaves faltantes
- 23e. Se completar: idioma permanece inativo
- 23f. Continua no passo 24

**FA04: Cancelar Upload**
- 12a. Usu√°rio clica em [Cancelar]
- 12b. Sistema descarta arquivo selecionado
- 12c. Fecha modal sem importar
- 12d. UC encerrado

### 6. Exce√ß√µes

**EX01: Usu√°rio sem Permiss√£o**
- 13a. Sistema detecta falta de permiss√£o `SYS.I18N.UPLOAD_TRANSLATION`
- 13b. Sistema retorna HTTP 403 Forbidden
- 13c. Exibe mensagem: "Voc√™ n√£o tem permiss√£o para fazer upload de tradu√ß√µes"
- 13d. Fecha modal

**EX02: Arquivo com Formato Inv√°lido**
- 7a. Sistema detecta extens√£o n√£o suportada
- 7b. Exibe mensagem: "Formato inv√°lido. Formatos aceitos: .json, .po, .xlsx"
- 7c. Permite selecionar outro arquivo
- 7d. Retorna ao passo 6

**EX03: Arquivo com Encoding Incorreto**
- 8a. Sistema detecta encoding diferente de UTF-8
- 8b. Exibe mensagem: "Encoding inv√°lido. O arquivo deve estar em UTF-8"
- 8c. Permite selecionar outro arquivo
- 8d. Retorna ao passo 6

**EX04: Arquivo Muito Grande**
- 9a. Sistema detecta arquivo > 5 MB
- 9b. Exibe mensagem: "Arquivo muito grande (m√°ximo 5 MB)"
- 9c. Permite selecionar outro arquivo
- 9d. Retorna ao passo 6

**EX05: Arquivo com Erros Cr√≠ticos**
- 17a-20a. Sistema detecta erros cr√≠ticos: chaves inv√°lidas, interpola√ß√µes incorretas, HTML n√£o balanceado
- 17b. Rejeita importa√ß√£o
- 17c. Retorna HTTP 400 Bad Request
- 17d. Exibe lista detalhada de erros
- 17e. Permite corrigir arquivo e reenviar
- 17f. UC encerrado

**EX06: Erro ao Importar Tradu√ß√µes**
- 22a. Falha ao importar no banco de dados
- 22b. Sistema executa rollback
- 22c. Restaura backup criado no passo 15
- 22d. Retorna HTTP 500
- 22e. Exibe mensagem: "Erro ao importar tradu√ß√µes. Nenhuma altera√ß√£o foi feita."
- 22f. UC encerrado

### 7. P√≥s-condi√ß√µes

- Tradu√ß√µes importadas e armazenadas no banco de dados
- Progresso de tradu√ß√£o atualizado (ex: 85% ‚Üí 95%)
- Backup da vers√£o anterior criado e armazenado
- Nova vers√£o registrada no hist√≥rico com metadata completa
- Cache Redis invalidado para o idioma
- Relat√≥rio de importa√ß√£o gerado com estat√≠sticas: total de chaves, importadas, avisos, erros, dura√ß√£o
- Opera√ß√£o registrada em auditoria (UPLOAD) com dados: idioma, arquivo, chaves processadas, usu√°rio, timestamp
- Se 100% e op√ß√£o marcada: idioma ativado automaticamente

### 8. Regras de Neg√≥cio Aplic√°veis

- **RN-I18N-015**: Hot Reload (Sem Restart)
- **RN-I18N-018**: Upload de Tradu√ß√µes pelo Usu√°rio
- **RN-I18N-019**: Valida√ß√£o de Integridade de Tradu√ß√µes
- **RN-I18N-020**: Versionamento de Arquivos de Tradu√ß√£o
- **RN-I18N-021**: Formatos de Arquivo Suportados

---

## UC05: Ativar/Desativar Idioma

### 1. Descri√ß√£o

Este caso de uso permite que administradores alterem o status de um idioma entre Ativo (dispon√≠vel para usu√°rios) e Inativo (oculto do seletor de idiomas), com valida√ß√µes de progresso m√≠nimo e prote√ß√£o do idioma padr√£o (pt-BR).

### 2. Atores

- **Ator Principal**: Administrador de Sistema
- **Ator Secund√°rio**: Sistema

### 3. Pr√©-condi√ß√µes

- Usu√°rio autenticado no sistema
- Usu√°rio possui permiss√£o: `SYS.I18N.MANAGE_LANGUAGES`
- Multi-tenancy ativo (ClienteId v√°lido)
- Idioma j√° criado no sistema
- Para ativar: Recomendado progresso >= 80% (n√£o bloqueante)

### 4. Fluxo Principal - Ativar Idioma

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Seleciona idioma inativo na lista | - |
| 2 | Clica em bot√£o [‚úÖ Ativar] | - |
| 3 | - | Valida permiss√£o `SYS.I18N.MANAGE_LANGUAGES` |
| 4 | - | Verifica progresso de tradu√ß√£o do idioma |
| 5 | - | Se progresso >= 80%: permite ativa√ß√£o direta |
| 6 | - | Se progresso < 80%: exibe aviso de incompletude |
| 7 | Confirma ativa√ß√£o (se aviso exibido) | - |
| 8 | - | Executa `PUT /api/i18n/languages/{code}/activate` |
| 9 | - | Atualiza status do idioma para Ativo |
| 10 | - | Invalida cache Redis de idiomas ativos |
| 11 | - | Registra opera√ß√£o em auditoria (UPDATE - Ativa√ß√£o) |
| 12 | - | Notifica usu√°rios (opcional): "Novo idioma dispon√≠vel: {nome}" |
| 13 | - | Exibe mensagem de sucesso: "Idioma ativado com sucesso" |
| 14 | - | Atualiza lista de idiomas |
| 15 | - | Idioma aparece no seletor de idiomas para todos os usu√°rios |

### 5. Fluxo Principal - Desativar Idioma

| Passo | Ator | Sistema |
|-------|------|---------|
| 1 | Seleciona idioma ativo na lista | - |
| 2 | Clica em bot√£o [üî¥ Desativar] | - |
| 3 | - | Valida permiss√£o `SYS.I18N.MANAGE_LANGUAGES` |
| 4 | - | Verifica se idioma √© pt-BR (padr√£o do sistema) |
| 5 | - | Se pt-BR: bloqueia desativa√ß√£o |
| 6 | - | Se outro idioma: permite desativa√ß√£o |
| 7 | - | Exibe confirma√ß√£o: "Desativar idioma {nome}? Usu√°rios usando este idioma ser√£o redirecionados para pt-BR" |
| 8 | Confirma desativa√ß√£o | - |
| 9 | - | Executa `PUT /api/i18n/languages/{code}/deactivate` |
| 10 | - | Atualiza status do idioma para Inativo |
| 11 | - | Remove idioma do seletor |
| 12 | - | Usu√°rios atualmente usando este idioma: redirecionados para pt-BR (fallback) |
| 13 | - | Invalida cache Redis de idiomas ativos |
| 14 | - | Registra opera√ß√£o em auditoria (UPDATE - Desativa√ß√£o) |
| 15 | - | Exibe mensagem de sucesso: "Idioma desativado com sucesso" |
| 16 | - | Atualiza lista de idiomas |

### 6. Fluxos Alternativos

**FA01: Ativar com Progresso < 80%**
- 6a. Progresso do idioma √© < 80%
- 6b. Sistema exibe aviso: "Idioma com {X}% de tradu√ß√£o. Algumas mensagens aparecer√£o em portugu√™s. Ativar mesmo assim?"
- 6c. Usu√°rio confirma ativa√ß√£o
- 6d. Sistema ativa idioma com fallback pt-BR para chaves faltantes
- 6e. Continua no passo 8

**FA02: Cancelar Ativa√ß√£o/Desativa√ß√£o**
- 7a/8a. Usu√°rio clica em [Cancelar]
- 7b/8b. Sistema fecha confirma√ß√£o sem alterar status
- 7c/8c. UC encerrado

### 7. Exce√ß√µes

**EX01: Usu√°rio sem Permiss√£o**
- 3a. Sistema detecta falta de permiss√£o `SYS.I18N.MANAGE_LANGUAGES`
- 3b. Sistema retorna HTTP 403 Forbidden
- 3c. Exibe mensagem: "Voc√™ n√£o tem permiss√£o para ativar/desativar idiomas"
- 3d. UC encerrado

**EX02: Tentativa de Desativar pt-BR (Idioma Padr√£o)**
- 5a. Usu√°rio tenta desativar pt-BR
- 5b. Sistema bloqueia opera√ß√£o
- 5c. Exibe mensagem: "N√£o √© poss√≠vel desativar o idioma padr√£o (pt-BR)"
- 5d. Bot√£o [üî¥ Desativar] permanece desabilitado
- 5e. UC encerrado

**EX03: Idioma N√£o Encontrado**
- 8a/9a. Sistema n√£o encontra idioma com c√≥digo informado
- 8b/9b. Retorna HTTP 404 Not Found
- 8c/9c. Exibe mensagem: "Idioma n√£o encontrado"
- 8d/9d. UC encerrado

**EX04: Erro ao Atualizar Status**
- 9a/10a. Falha ao atualizar status no banco
- 9b/10b. Sistema retorna HTTP 500
- 9c/10c. Exibe mensagem: "Erro ao atualizar status do idioma. Tente novamente."
- 9d/10d. Permite tentar novamente
- 9e/10e. UC encerrado

### 8. P√≥s-condi√ß√µes

**P√≥s-condi√ß√µes da Ativa√ß√£o**:
- Status do idioma alterado para Ativo
- Idioma aparece no seletor de idiomas para todos os usu√°rios
- Cache Redis invalidado
- Opera√ß√£o registrada em auditoria (UPDATE - Ativa√ß√£o) com dados: c√≥digo do idioma, status anterior (Inativo), status novo (Ativo), usu√°rio, timestamp
- Se progresso < 100%: Chaves faltantes exibem fallback em pt-BR

**P√≥s-condi√ß√µes da Desativa√ß√£o**:
- Status do idioma alterado para Inativo
- Idioma removido do seletor de idiomas
- Usu√°rios que estavam usando esse idioma: redirecionados automaticamente para pt-BR
- Cache Redis invalidado
- Opera√ß√£o registrada em auditoria (UPDATE - Desativa√ß√£o) com dados: c√≥digo do idioma, status anterior (Ativo), status novo (Inativo), usu√°rio, timestamp

### 9. Regras de Neg√≥cio Aplic√°veis

- **RN-I18N-001**: Detec√ß√£o Autom√°tica de Idioma
- **RN-I18N-002**: Fallback Hier√°rquico
- **RN-I18N-015**: Hot Reload (Sem Restart)
- **RN-I18N-016**: Gest√£o de Idiomas pelo Usu√°rio

---

## Resumo dos Casos de Uso

| UC | Nome | Ator Principal | Complexidade | Integra√ß√£o |
|----|------|----------------|--------------|------------|
| UC01 | Listar Idiomas Dispon√≠veis | Administrador | Baixa | Cache Redis |
| UC02 | Adicionar Novo Idioma | Administrador | M√©dia | Auditoria, Cache |
| UC03 | Baixar Template de Tradu√ß√£o | Administrador/Tradutor | Alta | Gera√ß√£o de Arquivos |
| UC04 | Upload de Tradu√ß√µes | Administrador/Tradutor | Muito Alta | Valida√ß√£o, Backup, Cache |
| UC05 | Ativar/Desativar Idioma | Administrador | M√©dia | Cache, Notifica√ß√µes |

---

**√öltima Atualiza√ß√£o**: 2025-12-28
**Vers√£o do Documento**: 1.0
**Status**: ‚úÖ Completo
