# =============================================
# UC - Casos de Uso (Contrato Comportamental)
# Vers√£o: 2.0
# Autor: Ag√™ncia ALC - alc.dev.br
# =============================================

uc:
  rf: "RF005"
  versao: "2.0"
  data: "2025-12-29"

rf_id: "RF005"
rf_titulo: "Internacionaliza√ß√£o (i18n) e Localiza√ß√£o"
versao_documento: "2.0"
data: "2025-12-29"

# =============================================================================
# SUM√ÅRIO DE CASOS DE USO
# =============================================================================

sumario:
  total_ucs: 11
  total_story_points: 76
  cobertura_rns: "22/22 (100%)"
  complexidade_media: "alta"

casos_de_uso:
  # ===========================================================================
  # UC00 - Listar Idiomas Dispon√≠veis
  # ===========================================================================
  - id: "UC00"
    titulo: "Listar Idiomas Dispon√≠veis"
    ator_principal: "Admin, Tradutor"
    ator_secundario: "Sistema"
    story_points: 3
    complexidade: "baixa"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.READ"
      - "Multi-tenancy ativo (ClienteId v√°lido)"

    pos_condicoes:
      - "Lista de idiomas exibida com informa√ß√µes completas"
      - "Opera√ß√£o registrada em auditoria (READ)"

    fluxo_principal:
      - passo: 1
        acao: "Usu√°rio acessa menu Sistema ‚Üí Configura√ß√µes ‚Üí Internacionaliza√ß√£o"
      - passo: 2
        acao: "Sistema valida permiss√£o SYS.I18N.READ"
      - passo: 3
        acao: "Sistema busca cache Redis (i18n:languages:list)"
      - passo: 4
        acao: "Se cache HIT: retorna lista do cache (TTL 24h)"
      - passo: 5
        acao: "Se cache MISS: executa query no banco (SistemaIdiomas)"
      - passo: 6
        acao: "Sistema calcula progresso de tradu√ß√£o para cada idioma"
      - passo: 7
        acao: "Sistema renderiza grid com colunas: Bandeira, Nome, C√≥digo, Status, Progresso (%), A√ß√µes"
      - passo: 8
        acao: "Sistema destaca idioma padr√£o (pt-BR) com √≠cone de cadeado"
      - passo: 9
        acao: "Sistema armazena resultado no cache Redis"
      - passo: 10
        acao: "Usu√°rio visualiza lista completa de idiomas"

    fluxos_alternativos:
      - id: "FA-UC00-001"
        titulo: "Filtrar por Status"
        passos:
          - "2a. Usu√°rio seleciona filtro: Ativo / Inativo / Todos"
          - "2b. Sistema aplica filtro client-side (Angular)"
          - "2c. Grid atualizado dinamicamente"
          - "2d. Retorna ao passo 10"

      - id: "FA-UC00-002"
        titulo: "Ordenar por Progresso"
        passos:
          - "2a. Usu√°rio clica em coluna 'Progresso'"
          - "2b. Sistema ordena lista por % (crescente ou decrescente)"
          - "2c. Grid reordenado"
          - "2d. Retorna ao passo 10"

      - id: "FA-UC00-003"
        titulo: "Buscar Idioma por Nome ou C√≥digo"
        passos:
          - "2a. Usu√°rio digita texto na busca"
          - "2b. Sistema filtra lista em tempo real"
          - "2c. Exibe apenas idiomas que correspondem"
          - "2d. Retorna ao passo 10"

    fluxos_excecao:
      - id: "FE-UC00-001"
        titulo: "Usu√°rio Sem Permiss√£o"
        passos:
          - "2a. Sistema detecta falta de permiss√£o SYS.I18N.READ"
          - "2b. Sistema retorna HTTP 403 Forbidden"
          - "2c. Exibe mensagem: 'Voc√™ n√£o tem permiss√£o para visualizar idiomas'"
          - "2d. Redireciona para dashboard"
          - "2e. UC encerrado"

      - id: "FE-UC00-002"
        titulo: "Erro ao Carregar Idiomas"
        passos:
          - "5a. Falha na query ou cache"
          - "5b. Sistema retorna HTTP 500"
          - "5c. Exibe mensagem: 'Erro ao carregar idiomas. Tente novamente.'"
          - "5d. Permite recarregar p√°gina"
          - "5e. UC encerrado"

      - id: "FE-UC00-003"
        titulo: "Nenhum Idioma Cadastrado"
        passos:
          - "7a. Sistema n√£o encontra idiomas (banco vazio)"
          - "7b. Exibe estado vazio: 'Nenhum idioma cadastrado. Crie o primeiro idioma.'"
          - "7c. Exibe bot√£o [+ Novo Idioma]"
          - "7d. Retorna ao passo 10"

    regras_negocio:
      - "RN-I18N-001"
      - "RN-I18N-002"
      - "RN-I18N-022"

    integracoes:
      - tipo: "cache"
        sistema: "Redis"
        chave: "i18n:languages:list"
        ttl_horas: 24
      - tipo: "auditoria"
        evento: "READ"
        tabela: "AuditLog"

  # ===========================================================================
  # UC01 - Adicionar Novo Idioma
  # ===========================================================================
  - id: "UC01"
    titulo: "Adicionar Novo Idioma"
    ator_principal: "Administrador Sistema"
    ator_secundario: "Sistema"
    story_points: 5
    complexidade: "media"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.MANAGE_LANGUAGES"
      - "Multi-tenancy ativo (ClienteId v√°lido)"

    pos_condicoes:
      - "Novo idioma criado com Status: Inativo, Progresso: 0%"
      - "Opera√ß√£o registrada em auditoria (CREATE)"
      - "Cache Redis invalidado (i18n:languages:*)"

    regras_negocio:
      - "RN-I18N-005"
      - "RN-I18N-006"
      - "RN-I18N-022"

    endpoints:
      - metodo: "POST"
        url: "/api/i18n/languages"
        payload:
          Codigo: "fr-FR"
          Nome: "Fran√ßais"
          Bandeira: "üá´üá∑"
          IdiomaReferenciaParaTemplate: "pt-BR"
        response_201:
          Id: "guid"
          Codigo: "fr-FR"
          Status: "Inativo"
          Progresso: 0

  # ===========================================================================
  # UC02 - Baixar Template de Tradu√ß√£o
  # ===========================================================================
  - id: "UC02"
    titulo: "Baixar Template de Tradu√ß√£o"
    ator_principal: "Admin, Tradutor"
    ator_secundario: "Sistema"
    story_points: 8
    complexidade: "alta"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.DOWNLOAD_TEMPLATE"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Idioma de destino j√° criado no sistema"

    pos_condicoes:
      - "Arquivo template gerado e baixado (formato selecionado)"
      - "Arquivo cont√©m todas as chaves ativas (1.247+)"
      - "Opera√ß√£o registrada em auditoria (DOWNLOAD)"

    regras_negocio:
      - "RN-I18N-008"
      - "RN-I18N-009"
      - "RN-I18N-011"
      - "RN-I18N-021"

    formatos_suportados:
      - formato: "JSON"
        extensao: ".json"
        descricao: "Estrutura hier√°rquica com namespaces"
        mime_type: "application/json"
      - formato: "PO (Gettext)"
        extensao: ".po"
        descricao: "Formato CAT tools (msgid/msgstr)"
        mime_type: "text/x-gettext-translation"
      - formato: "XLSX (Excel)"
        extensao: ".xlsx"
        descricao: "Planilha Excel para tradutores"
        mime_type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"

    endpoints:
      - metodo: "GET"
        url: "/api/i18n/languages/{code}/download"
        query_params:
          format: "json | po | xlsx"
          type: "empty | current"
          include_comments: "bool"
          include_examples: "bool"
          include_references: "bool"

  # ===========================================================================
  # UC03 - Upload de Tradu√ß√µes
  # ===========================================================================
  - id: "UC03"
    titulo: "Upload de Tradu√ß√µes"
    ator_principal: "Admin, Tradutor"
    ator_secundario: "Sistema"
    story_points: 13
    complexidade: "muito_alta"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.UPLOAD_TRANSLATION"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Arquivo de tradu√ß√£o preenchido dispon√≠vel"
      - "Idioma de destino j√° criado no sistema"

    pos_condicoes:
      - "Tradu√ß√µes importadas e armazenadas no banco"
      - "Progresso de tradu√ß√£o atualizado (ex: 85% ‚Üí 95%)"
      - "Backup da vers√£o anterior criado (SistemaTraducaoVersoes)"
      - "Nova vers√£o registrada no hist√≥rico"
      - "Cache Redis invalidado (i18n:{lang}:*)"
      - "Opera√ß√£o registrada em auditoria (UPLOAD)"

    regras_negocio:
      - "RN-I18N-010"
      - "RN-I18N-012"
      - "RN-I18N-013"
      - "RN-I18N-014"
      - "RN-I18N-016"

    validacoes_criticas:
      - validacao: "Estrutura de chaves"
        erro_se: "Chave n√£o existe em SistemaTraducaoChaves"
        http_code: 400
      - validacao: "Interpola√ß√µes consistentes"
        erro_se: "{{var}} presente em pt-BR mas ausente na tradu√ß√£o"
        http_code: 400
      - validacao: "HTML balanceado"
        erro_se: "<b>Texto sem fechar ou tags aninhadas incorretamente"
        http_code: 400
      - validacao: "Encoding UTF-8"
        erro_se: "Arquivo n√£o est√° em UTF-8"
        http_code: 400
      - validacao: "Tamanho m√°ximo"
        erro_se: "Arquivo > 5 MB"
        http_code: 400

    validacoes_avisos:
      - aviso: "Tradu√ß√£o longa"
        condicao: "Tradu√ß√£o > 500 caracteres"
        bloqueante: false
      - aviso: "Tradu√ß√£o id√™ntica ao pt-BR"
        condicao: "Tradu√ß√£o == pt-BR"
        bloqueante: false

    endpoints:
      - metodo: "POST"
        url: "/api/i18n/languages/{code}/upload"
        content_type: "multipart/form-data"
        fields:
          file: "binary"
          overwrite: "bool (default: true)"
          validate_interpolations: "bool (default: true)"
          generate_report: "bool (default: true)"

  # ===========================================================================
  # UC04 - Ativar/Desativar Idioma
  # ===========================================================================
  - id: "UC04"
    titulo: "Ativar/Desativar Idioma"
    ator_principal: "Administrador Sistema"
    ator_secundario: "Sistema"
    story_points: 5
    complexidade: "media"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.MANAGE_LANGUAGES"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Idioma j√° criado no sistema"
      - "Para ativar: Recomendado progresso >= 80% (n√£o bloqueante)"

    pos_condicoes_ativacao:
      - "Status do idioma alterado para Ativo"
      - "Idioma aparece no seletor de idiomas para todos os usu√°rios"
      - "Cache Redis invalidado (i18n:languages:active)"
      - "Opera√ß√£o registrada em auditoria (UPDATE - Ativa√ß√£o)"

    pos_condicoes_desativacao:
      - "Status do idioma alterado para Inativo"
      - "Idioma removido do seletor de idiomas"
      - "Usu√°rios que estavam usando esse idioma: redirecionados automaticamente para pt-BR"
      - "Cache Redis invalidado (i18n:languages:active)"
      - "Opera√ß√£o registrada em auditoria (UPDATE - Desativa√ß√£o)"

    regras_negocio:
      - "RN-I18N-001"
      - "RN-I18N-007"
      - "RN-I18N-019"

    protecoes:
      - protecao: "Bloqueio absoluto de desativa√ß√£o do pt-BR"
        validacao: "C√≥digo != 'pt-BR'"
        http_code_se_violar: 400
        mensagem: "N√£o √© poss√≠vel desativar o idioma padr√£o (pt-BR)"

      - protecao: "Aviso de progresso < 80%"
        validacao: "Progresso >= 80%"
        http_code_se_violar: 200
        comportamento: "Exibe aviso, permite ativar mesmo assim"

    endpoints:
      - metodo: "PUT"
        url: "/api/i18n/languages/{code}/activate"
      - metodo: "PUT"
        url: "/api/i18n/languages/{code}/deactivate"

  # ===========================================================================
  # UC05 - Visualizar Hist√≥rico de Vers√µes
  # ===========================================================================
  - id: "UC05"
    titulo: "Visualizar Hist√≥rico de Vers√µes"
    ator_principal: "Admin, Tradutor"
    ator_secundario: "Sistema"
    story_points: 5
    complexidade: "media"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.READ"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Idioma com hist√≥rico de uploads"

    pos_condicoes:
      - "Hist√≥rico de vers√µes exibido"
      - "Opera√ß√£o registrada em auditoria (READ)"

    regras_negocio:
      - "RN-I18N-015"

    endpoints:
      - metodo: "GET"
        url: "/api/i18n/languages/{code}/versions"
        response:
          versoes:
            - VersaoId: "guid"
              DataCriacao: "datetime"
              UsuarioNome: "string"
              ChavesAtualizadas: "int"
              ProgressoPercentual: "decimal"
              TipoOperacao: "UPLOAD | ROLLBACK | AUTO_TRANSLATE"

  # ===========================================================================
  # UC06 - Restaurar Vers√£o Anterior (Rollback)
  # ===========================================================================
  - id: "UC06"
    titulo: "Restaurar Vers√£o Anterior (Rollback)"
    ator_principal: "Administrador Sistema"
    ator_secundario: "Sistema"
    story_points: 8
    complexidade: "alta"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.MANAGE_TRANSLATIONS"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Idioma com hist√≥rico de vers√µes (>= 2 vers√µes)"

    pos_condicoes:
      - "Tradu√ß√µes restauradas para vers√£o anterior"
      - "Progresso de tradu√ß√£o recalculado"
      - "Nova vers√£o de rollback registrada no hist√≥rico"
      - "Cache Redis invalidado"
      - "Opera√ß√£o registrada em auditoria (ROLLBACK)"

    regras_negocio:
      - "RN-I18N-015"
      - "RN-I18N-016"

    seguranca:
      - "Cria backup da vers√£o atual ANTES de restaurar"
      - "Transa√ß√£o at√¥mica: rollback completo se falhar"
      - "Registro de auditoria com vers√£o restaurada"

    endpoints:
      - metodo: "POST"
        url: "/api/i18n/languages/{code}/versions/{id}/restore"

  # ===========================================================================
  # UC07 - Validar Integridade de Tradu√ß√µes
  # ===========================================================================
  - id: "UC07"
    titulo: "Validar Integridade de Tradu√ß√µes"
    ator_principal: "Sistema (autom√°tico)"
    ator_secundario: "Administrador Sistema"
    story_points: 8
    complexidade: "alta"

    pre_condicoes:
      - "Idioma com tradu√ß√µes cadastradas"
      - "Job agendado no Hangfire OU execu√ß√£o manual"

    pos_condicoes:
      - "Relat√≥rio de integridade gerado"
      - "Avisos e erros detectados e listados"
      - "Opera√ß√£o registrada em auditoria (VALIDATION)"

    regras_negocio:
      - "RN-I18N-009"
      - "RN-I18N-010"
      - "RN-I18N-012"

    validacoes_executadas:
      - validacao: "Interpola√ß√µes consistentes"
        regex: "\\{\\{[^}]+\\}\\}"
        verifica: "Mesmas vari√°veis em pt-BR e tradu√ß√£o"

      - validacao: "HTML balanceado"
        verifica: "Tags abertas t√™m correspondente fechado"
        exemplos_invalidos:
          - "<b>Texto sem fechar"
          - "<i>Texto</b> (tags cruzadas)"

      - validacao: "Chaves obrigat√≥rias presentes"
        namespaces_obrigatorios:
          - "common.buttons.*"
          - "menu.*"
          - "validation.*"

      - validacao: "Tradu√ß√µes longas (> 500 chars)"
        tipo: "aviso"
        bloqueante: false

      - validacao: "Tradu√ß√µes id√™nticas ao pt-BR"
        tipo: "aviso"
        bloqueante: false

    agendamento:
      tipo: "Hangfire Job"
      frequencia: "Di√°ria"
      horario: "03:00 AM"
      retry: "3 tentativas com intervalo de 1 hora"

    notificacoes:
      - condicao: "Erros cr√≠ticos detectados"
        destinatarios: "Administradores Sistema"
        canal: "Email"

  # ===========================================================================
  # UC08 - Tradu√ß√£o Autom√°tica via Azure Translator
  # ===========================================================================
  - id: "UC08"
    titulo: "Tradu√ß√£o Autom√°tica via Azure Translator"
    ator_principal: "Administrador Sistema"
    ator_secundario: "Sistema, Azure Translator API"
    story_points: 13
    complexidade: "muito_alta"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.AUTO_TRANSLATE"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Azure Translator API configurado (chave v√°lida)"
      - "Idioma de destino j√° criado com progresso < 100%"

    pos_condicoes:
      - "Tradu√ß√µes autom√°ticas geradas e importadas"
      - "Tradu√ß√µes marcadas como FoiTraduzidoPorMaquina = True"
      - "Progresso de tradu√ß√£o atualizado (ex: 60% ‚Üí 95%)"
      - "Custo estimado registrado"
      - "Opera√ß√£o registrada em auditoria (AUTO_TRANSLATE)"
      - "Cache Redis invalidado"

    regras_negocio:
      - "RN-I18N-018"

    custos:
      modelo_custo: "Azure Translator"
      preco_por_milhao_caracteres: 10.00
      moeda: "USD"
      exemplo_calculo:
        chaves_faltantes: 497
        caracteres_medio_por_chave: 50
        total_caracteres: 24850
        custo_estimado: 0.25

    limitacoes_api:
      rate_limit_caracteres_por_minuto: 1000000
      lote_maximo_por_request: 100
      timeout_segundos: 30
      retry_tentativas: 3
      retry_intervalo_segundos: 60

    integracao_azure:
      endpoint: "https://api.cognitive.microsofttranslator.com/translate"
      metodo: "POST"
      headers:
        Ocp-Apim-Subscription-Key: "config(AzureTranslatorApiKey)"
        Content-Type: "application/json"
      params:
        api-version: "3.0"
        from: "pt-BR"
        to: "{codigo_idioma}"
      body_exemplo:
        - Text: "Bem-vindo"
        - Text: "Salvar"

    endpoints:
      - metodo: "POST"
        url: "/api/i18n/languages/{code}/auto-translate"
        query_params:
          namespace: "string (opcional - filtrar por namespace)"
        response:
          ChavesTraduzidasAutomaticamente: "int"
          ProgressoNovo: "decimal"
          CustoRealUSD: "decimal"
          TotalCaracteresProcessados: "int"

  # ===========================================================================
  # UC09 - Exportar Tradu√ß√µes
  # ===========================================================================
  - id: "UC09"
    titulo: "Exportar Tradu√ß√µes"
    ator_principal: "Admin, Tradutor"
    ator_secundario: "Sistema"
    story_points: 5
    complexidade: "media"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Permiss√£o: SYS.I18N.DOWNLOAD_TEMPLATE"
      - "Multi-tenancy ativo (ClienteId v√°lido)"
      - "Idioma com tradu√ß√µes cadastradas"

    pos_condicoes:
      - "Arquivo de exporta√ß√£o gerado e baixado"
      - "Opera√ß√£o registrada em auditoria (EXPORT)"

    regras_negocio:
      - "RN-I18N-011"

    endpoints:
      - metodo: "GET"
        url: "/api/i18n/languages/{code}/export"
        query_params:
          format: "json | po | xlsx"
          only_translated: "bool (default: false)"
          include_metadata: "bool (default: true)"
          include_comments: "bool (default: false)"
          namespace: "string (opcional)"

  # ===========================================================================
  # UC10 - Selecionar Idioma (Usu√°rio Final)
  # ===========================================================================
  - id: "UC10"
    titulo: "Selecionar Idioma (Usu√°rio Final)"
    ator_principal: "Usu√°rio Autenticado (qualquer perfil)"
    ator_secundario: "Sistema"
    story_points: 3
    complexidade: "media"

    pre_condicoes:
      - "Usu√°rio autenticado no sistema"
      - "Pelo menos 1 idioma ativo al√©m de pt-BR"

    pos_condicoes:
      - "Idioma do usu√°rio atualizado"
      - "Interface recarregada no idioma selecionado"
      - "Prefer√™ncia salva no banco (Usuarios.IdiomaPreferido)"
      - "Cache Redis carregado com tradu√ß√µes do idioma"

    regras_negocio:
      - "RN-I18N-002"
      - "RN-I18N-003"
      - "RN-I18N-004"
      - "RN-I18N-017"
      - "RN-I18N-020"

    deteccao_automatica:
      prioridade:
        - ordem: 1
          fonte: "Usuarios.IdiomaPreferido (banco de dados)"
        - ordem: 2
          fonte: "HTTP Header Accept-Language"
          exemplo: "fr-FR,fr;q=0.9,en;q=0.8"
        - ordem: 3
          fonte: "Geolocaliza√ß√£o via IP (GeoIP)"
        - ordem: 4
          fonte: "Idioma padr√£o (pt-BR)"

    fallback_hierarquico:
      exemplo: "fr-FR ‚Üí en-US ‚Üí pt-BR"
      comportamento: "Se chave n√£o existe em fr-FR, tenta en-US, sen√£o usa pt-BR"

    lazy_loading:
      estrategia: "Carregar namespaces sob demanda"
      namespaces_iniciais:
        - "common.*"
        - "menu.*"
      carregamento_dinamico:
        exemplo: "Ao navegar para /relatorios ‚Üí carrega namespace reports.*"

    cache_redis:
      chave_pattern: "i18n:{lang}:*"
      ttl_horas: 24
      invalidacao: "Autom√°tica ao fazer upload de tradu√ß√µes"

    endpoints:
      - metodo: "PUT"
        url: "/api/users/me/language"
        payload:
          CodigoIdioma: "fr-FR"

# =============================================================================
# MATRIZ DE RASTREABILIDADE (22/22 RNs = 100%)
# =============================================================================

rastreabilidade:
  total_rns: 22
  total_ucs: 11
  cobertura_percentual: 100

  mapeamento:
    - rn_id: "RN-I18N-001"
      titulo: "Idioma Padr√£o Obrigat√≥rio (pt-BR)"
      ucs_cobertura: ["UC00", "UC04"]
      validacao: "pt-BR sempre ativo, bloqueio de desativa√ß√£o"
      status: "coberto"

    - rn_id: "RN-I18N-002"
      titulo: "Detec√ß√£o Autom√°tica de Idioma Preferido"
      ucs_cobertura: ["UC00", "UC10"]
      validacao: "Header Accept-Language, GeoIP, fallback"
      status: "coberto"

    - rn_id: "RN-I18N-003"
      titulo: "Fallback em Cascata (Hier√°rquico)"
      ucs_cobertura: ["UC10"]
      validacao: "fr-FR ‚Üí en-US ‚Üí pt-BR"
      status: "coberto"

    - rn_id: "RN-I18N-004"
      titulo: "Formata√ß√£o Regional Autom√°tica"
      ucs_cobertura: ["UC10"]
      validacao: "Datas, moedas, n√∫meros conforme CultureInfo"
      status: "coberto"

    - rn_id: "RN-I18N-005"
      titulo: "Valida√ß√£o de C√≥digo de Idioma (ISO)"
      ucs_cobertura: ["UC01"]
      validacao: "Regex: ^[a-z]{2}-[A-Z]{2}$"
      status: "coberto"

    - rn_id: "RN-I18N-006"
      titulo: "C√≥digo de Idioma √önico"
      ucs_cobertura: ["UC01"]
      validacao: "Unicidade validada no banco"
      status: "coberto"

    - rn_id: "RN-I18N-007"
      titulo: "Ativa√ß√£o Requer >= 80% Tradu√ß√£o"
      ucs_cobertura: ["UC04"]
      validacao: "Recomendado, n√£o bloqueante, aviso exibido"
      status: "coberto"

    - rn_id: "RN-I18N-008"
      titulo: "Estrutura Hier√°rquica de Chaves"
      ucs_cobertura: ["UC02"]
      validacao: "Namespaces: common.buttons.save"
      status: "coberto"

    - rn_id: "RN-I18N-009"
      titulo: "Suporte a Interpola√ß√£o de Vari√°veis"
      ucs_cobertura: ["UC02", "UC07"]
      validacao: "{{username}}, {{count}}"
      status: "coberto"

    - rn_id: "RN-I18N-010"
      titulo: "Valida√ß√£o de Interpola√ß√µes no Upload"
      ucs_cobertura: ["UC03", "UC07"]
      validacao: "Mesmo n√∫mero de {{var}} em pt-BR e tradu√ß√£o"
      status: "coberto"

    - rn_id: "RN-I18N-011"
      titulo: "Formatos de Arquivo Suportados"
      ucs_cobertura: ["UC02", "UC03", "UC09"]
      validacao: "JSON, PO, XLSX"
      status: "coberto"

    - rn_id: "RN-I18N-012"
      titulo: "Valida√ß√£o de HTML Balanceado"
      ucs_cobertura: ["UC03", "UC07"]
      validacao: "<b>Texto</b> v√°lido, <b>Texto inv√°lido"
      status: "coberto"

    - rn_id: "RN-I18N-013"
      titulo: "Limite de Tamanho de Tradu√ß√£o (Aviso)"
      ucs_cobertura: ["UC03"]
      validacao: "Aviso > 500 caracteres, n√£o bloqueante"
      status: "coberto"

    - rn_id: "RN-I18N-014"
      titulo: "Detec√ß√£o de Tradu√ß√µes Id√™nticas"
      ucs_cobertura: ["UC03"]
      validacao: "Aviso se tradu√ß√£o = pt-BR, n√£o bloqueante"
      status: "coberto"

    - rn_id: "RN-I18N-015"
      titulo: "Versionamento Completo de Uploads"
      ucs_cobertura: ["UC05", "UC06"]
      validacao: "Toda atualiza√ß√£o cria vers√£o em SistemaTraducaoVersoes"
      status: "coberto"

    - rn_id: "RN-I18N-016"
      titulo: "Backup Autom√°tico Antes de Sobrescrever"
      ucs_cobertura: ["UC03", "UC06"]
      validacao: "Backup criado antes de upload e rollback"
      status: "coberto"

    - rn_id: "RN-I18N-017"
      titulo: "Cache Redis para Performance"
      ucs_cobertura: ["UC10"]
      validacao: "Cache i18n:{lang}:*, TTL 24h"
      status: "coberto"

    - rn_id: "RN-I18N-018"
      titulo: "Tradu√ß√£o Autom√°tica via Azure Translator"
      ucs_cobertura: ["UC08"]
      validacao: "Custo $10/1M chars, marca FoiTraduzidoPorMaquina"
      status: "coberto"

    - rn_id: "RN-I18N-019"
      titulo: "Permiss√µes RBAC"
      ucs_cobertura: ["UC04"]
      validacao: "SYS.I18N.MANAGE_LANGUAGES, etc"
      status: "coberto"

    - rn_id: "RN-I18N-020"
      titulo: "Lazy Loading de Tradu√ß√µes"
      ucs_cobertura: ["UC10"]
      validacao: "Carrega namespaces sob demanda"
      status: "coberto"

    - rn_id: "RN-I18N-021"
      titulo: "Tratamento de Pluraliza√ß√£o"
      ucs_cobertura: ["UC02"]
      validacao: "JSON: zero, one, other"
      status: "coberto"

    - rn_id: "RN-I18N-022"
      titulo: "Bandeiras e √çcones de Idiomas"
      ucs_cobertura: ["UC00", "UC01"]
      validacao: "Emoji ou flag-icons library"
      status: "coberto"

# =============================================================================
# INTEGRA√á√ïES OBRIGAT√ìRIAS
# =============================================================================

integracoes_obrigatorias:
  cache:
    sistema: "Redis"
    ucs_que_usam: ["UC00", "UC03", "UC04", "UC10"]
    chaves_pattern:
      - "i18n:languages:list"
      - "i18n:languages:active"
      - "i18n:{lang}:*"
    ttl_horas: 24
    invalidacao: "Autom√°tica ao modificar tradu√ß√µes ou idiomas"

  auditoria:
    sistema: "AuditLog"
    ucs_que_usam: ["UC00", "UC01", "UC02", "UC03", "UC04", "UC05", "UC06", "UC07", "UC08", "UC09"]
    eventos:
      - READ
      - CREATE
      - UPDATE
      - DELETE
      - DOWNLOAD
      - UPLOAD
      - ROLLBACK
      - VALIDATION
      - AUTO_TRANSLATE
      - EXPORT

  permissoes_rbac:
    sistema: "PermissionsManager"
    ucs_que_usam: ["UC01", "UC03", "UC04", "UC06", "UC08"]
    permissoes:
      - codigo: "SYS.I18N.READ"
        descricao: "Visualizar idiomas e progresso"
        perfis: ["Todos autenticados"]
      - codigo: "SYS.I18N.MANAGE_LANGUAGES"
        descricao: "Criar, ativar, desativar idiomas"
        perfis: ["Admin"]
        critico: true
      - codigo: "SYS.I18N.DOWNLOAD_TEMPLATE"
        descricao: "Baixar templates de tradu√ß√£o"
        perfis: ["Admin", "Tradutor"]
      - codigo: "SYS.I18N.UPLOAD_TRANSLATION"
        descricao: "Fazer upload de tradu√ß√µes"
        perfis: ["Admin", "Tradutor"]
        critico: true
      - codigo: "SYS.I18N.MANAGE_TRANSLATIONS"
        descricao: "Restaurar vers√µes anteriores"
        perfis: ["Admin"]
        critico: true
      - codigo: "SYS.I18N.AUTO_TRANSLATE"
        descricao: "Traduzir automaticamente via Azure"
        perfis: ["Admin"]
        critico: true

  multi_tenancy:
    sistema: "TenantContext"
    ucs_que_usam: ["UC00", "UC01", "UC02", "UC03", "UC04", "UC05", "UC06", "UC07", "UC08", "UC09", "UC10"]
    isolamento: "ClienteId obrigat√≥rio em todas as queries"

# =============================================================================
# DEPEND√äNCIAS T√âCNICAS
# =============================================================================

dependencias_tecnicas:
  backend:
    framework: ".NET 10"
    orm: "Entity Framework Core 10"
    i18n_library: "Microsoft.Extensions.Localization (IStringLocalizer)"
    cache: "StackExchange.Redis"
    jobs: "Hangfire"

  frontend:
    framework: "Angular 19"
    i18n_library: "@jsverse/transloco"
    http_client: "@angular/common/http"
    template: "Fuse Admin Template"

  apis_externas:
    - nome: "Azure Translator API"
      uc_relacionado: "UC08"
      obrigatorio: true
      configuracao: "Chave de API em appsettings.json"
      custo: "$10/1M caracteres"

  banco_dados:
    tabelas_principais:
      - SistemaIdiomas
      - SistemaTraducaoChaves
      - SistemaTraducoes
      - SistemaTraducaoVersoes
    colunas_auditoria:
      - DataCriacao
      - DataModificacao
      - UsuarioCriacao
      - UsuarioModificacao

# =============================================================================
# EXCLUS√ïES
# =============================================================================

exclusions:
  uc_items: []

# =============================================================================
# HIST√ìRICO
# =============================================================================

historico:
  - versao: "2.0"
    data: "2025-12-29"
    autor: "Ag√™ncia ALC - alc.dev.br"
    descricao: "11 UCs completos estruturados em YAML com rastreabilidade 22/22 RNs (100%)"

# =============================================================================
# CHANGELOG
# =============================================================================

changelog:
  - versao: "2.0"
    data: "2025-12-29"
    autor: "Ag√™ncia ALC - alc.dev.br"
    descricao: "11 UCs completos estruturados em YAML com rastreabilidade 22/22 RNs (100%)"

# =============================================================================
# METADADOS
# =============================================================================

metadados:
  status: "Casos de Uso Estruturados Completos (100%)"
  proximo_documento: "STATUS.yaml (governan√ßa v2.0, story points)"
  estimativa_implementacao_semanas: 12
  estimativa_custo_azure_translator_usd: 1.14
  total_chaves_estimadas: 1247
