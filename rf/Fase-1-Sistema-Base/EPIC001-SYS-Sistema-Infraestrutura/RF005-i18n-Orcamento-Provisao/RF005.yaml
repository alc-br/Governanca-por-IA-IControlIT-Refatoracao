# =============================================
# RF-005: Internacionaliza√ß√£o (i18n) e Localiza√ß√£o
# Vers√£o: 2.0
# Data: 2025-12-29
# Autor: Ag√™ncia ALC - alc.dev.br
# =============================================

rf:
  id: "RF005"
  codigo: "RF005"
  nome: "Internacionaliza√ß√£o (i18n) e Localiza√ß√£o"
  titulo: "Sistema de Internacionaliza√ß√£o e Localiza√ß√£o Completo"
  fase: "Fase-1-Sistema-Base"
  epic: "EPIC001-SYS-Sistema-Infraestrutura"
  versao: "2.0"
  data: "2025-12-29"
  status: "documentado"  # documentado | em_desenvolvimento | concluido
  complexidade: "muito_alta"
  prioridade: "alta"

# =============================================
# REGRAS DE NEG√ìCIO (22 RNs)
# =============================================
regras_negocio:
  - id: "RN-RF005-001"
    descricao: "Idioma Padr√£o Obrigat√≥rio (pt-BR)"
    tipo: "regra_negocio"
    prioridade: "critica"
    obrigatorio: true
    detalhes: |
      pt-BR √© o idioma padr√£o do sistema e N√ÉO pode ser desativado.
      Sistema sempre inicia em pt-BR se idioma do usu√°rio n√£o configurado.
      pt-BR deve ter 100% das chaves traduzidas (1.247+).
    validacao: "HTTP 400 Bad Request ao tentar desativar pt-BR"
    mensagem_erro: "Idioma padr√£o (pt-BR) n√£o pode ser desativado"

  - id: "RN-RF005-002"
    descricao: "Detec√ß√£o Autom√°tica de Idioma Preferido"
    tipo: "regra_negocio"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Sistema detecta idioma preferido automaticamente no primeiro acesso.
      Ordem de prioridade:
      1. Configura√ß√£o salva do usu√°rio (banco de dados)
      2. Header HTTP Accept-Language (navegador)
      3. Geolocaliza√ß√£o via IP (GeoIP)
      4. Idioma padr√£o (pt-BR)
    persistencia: "Usuarios.IdiomaPreferido"

  - id: "RN-RF005-003"
    descricao: "Fallback em Cascata"
    tipo: "regra_negocio"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Se tradu√ß√£o n√£o existir, usar fallback em cascata:
      Idioma Selecionado ‚Üí Idioma Base do Grupo ‚Üí en-US ‚Üí pt-BR

      Exemplos:
      - it-IT (inexistente) ‚Üí en-US (base do grupo latino) ‚Üí pt-BR (padr√£o)
      - fr-CA (incompleto) ‚Üí fr-FR ‚Üí en-US ‚Üí pt-BR
    comportamento: "N√ÉO exibir chave t√©cnica (common.buttons.save)"

  - id: "RN-RF005-004"
    descricao: "Formata√ß√£o Regional Autom√°tica"
    tipo: "regra_negocio"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Datas, moedas e n√∫meros formatados conforme cultura do idioma.

      Formatos:
      - pt-BR: dd/MM/yyyy | R$ 1.234,56 | 1.234,56 (v√≠rgula) | America/Sao_Paulo (UTC-3)
      - en-US: MM/dd/yyyy | $1,234.56 | 1,234.56 (ponto) | America/New_York (UTC-5)
      - es-ES: dd/MM/yyyy | 1.234,56 ‚Ç¨ | 1.234,56 (v√≠rgula) | Europe/Madrid (UTC+1)
      - fr-FR: dd/MM/yyyy | 1 234,56 ‚Ç¨ | 1 234,56 (espa√ßo) | Europe/Paris (UTC+1)

  - id: "RN-RF005-005"
    descricao: "Valida√ß√£o de C√≥digo de Idioma (ISO 639-1 + ISO 3166-1)"
    tipo: "validacao"
    prioridade: "critica"
    obrigatorio: true
    detalhes: |
      C√≥digo do idioma deve seguir padr√£o ISO.
      Formato: <idioma>-<pa√≠s> (ex: pt-BR, en-US, es-ES)
      - idioma: 2 letras min√∫sculas (ISO 639-1)
      - pa√≠s: 2 letras mai√∫sculas (ISO 3166-1)
    regex: "^[a-z]{2}-[A-Z]{2}$"
    exemplos_validos: ["pt-BR", "en-US", "es-ES", "fr-FR", "de-DE", "it-IT"]
    exemplos_invalidos: ["ptBR", "PT-BR", "por-BR"]
    mensagem_erro: "C√≥digo de idioma inv√°lido. Use formato: pt-BR, en-US, es-ES"

  - id: "RN-RF005-006"
    descricao: "C√≥digo de Idioma √önico"
    tipo: "validacao"
    prioridade: "critica"
    obrigatorio: true
    detalhes: "N√£o pode existir dois idiomas com mesmo c√≥digo"
    validacao: "UNIQUE INDEX em SistemaIdiomas.Codigo"
    http_status: 409  # Conflict
    mensagem_erro: "Idioma {codigo} j√° cadastrado no sistema"

  - id: "RN-RF005-007"
    descricao: "Ativa√ß√£o de Idioma Requer M√≠nimo 80% de Tradu√ß√£o"
    tipo: "regra_negocio"
    prioridade: "media"
    obrigatorio: false  # Aviso, n√£o bloqueio
    detalhes: |
      Idioma s√≥ pode ser ativado com m√≠nimo 80% de tradu√ß√£o completa.
      Exce√ß√µes:
      - pt-BR (padr√£o): sempre 100%
      - Idiomas em fase de teste: podem ser ativados com aviso
    threshold: 80
    mensagem_aviso: "Idioma possui apenas {progresso}% de tradu√ß√£o. Algumas chaves usar√£o fallback."

  - id: "RN-RF005-008"
    descricao: "Estrutura Hier√°rquica de Chaves (Namespaces)"
    tipo: "estrutura"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Chaves de tradu√ß√£o devem seguir estrutura hier√°rquica com namespaces.
      Formato: namespace.subnamespace.chave
      Exemplos: common.buttons.save, menu.users.list
    regras:
      - "M√°ximo 5 n√≠veis de profundidade"
      - "Usar camelCase ap√≥s o ponto"
      - "Sem espa√ßos ou caracteres especiais"
      - "M√≠nimo 2 n√≠veis (namespace.chave)"
    regex: "^[a-z]+(\\.[a-zA-Z]+){1,4}$"

  - id: "RN-RF005-009"
    descricao: "Suporte a Interpola√ß√£o de Vari√°veis"
    tipo: "funcionalidade"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Tradu√ß√µes podem conter vari√°veis din√¢micas usando sintaxe {{variavel}}.
      Sintaxe: {{nomeVariavel}}
      Exemplos:
      - "Bem-vindo, {{username}}!"
      - "M√≠nimo {{min}} caracteres"
      - "Total: {{count}} itens ({{price}})"

  - id: "RN-RF005-010"
    descricao: "Valida√ß√£o de Interpola√ß√µes no Upload"
    tipo: "validacao"
    prioridade: "critica"
    obrigatorio: true
    detalhes: |
      Ao fazer upload de tradu√ß√µes, sistema valida se interpola√ß√µes s√£o consistentes.
      Valida√ß√µes:
      1. Mesmo n√∫mero de vari√°veis em todos os idiomas
      2. Mesmos nomes de vari√°veis (pt-BR usa {{min}}, en-US tamb√©m deve usar {{min}})
      3. Sintaxe correta: {{var}} (v√°lido), {var} (inv√°lido), {{var} (inv√°lido)
    comportamento: "Upload rejeitado se houver erros cr√≠ticos de interpola√ß√£o"

  - id: "RN-RF005-011"
    descricao: "Formatos de Arquivo Suportados (JSON, PO, XLSX)"
    tipo: "funcionalidade"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Sistema suporta 3 formatos para download/upload de tradu√ß√µes:
      1. JSON (Formato Padr√£o - Desenvolvedores)
      2. PO (Gettext - Ferramentas CAT)
      3. XLSX (Excel - Tradutores N√£o-T√©cnicos)
    formatos:
      - formato: "JSON"
        extensao: ".json"
        mime_type: "application/json"
        target: "Desenvolvedores"
      - formato: "PO"
        extensao: ".po"
        mime_type: "text/plain"
        target: "Ferramentas CAT (Computer-Assisted Translation)"
      - formato: "XLSX"
        extensao: ".xlsx"
        mime_type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
        target: "Tradutores n√£o-t√©cnicos"

  - id: "RN-RF005-012"
    descricao: "Valida√ß√£o de HTML Balanceado"
    tipo: "validacao"
    prioridade: "critica"
    obrigatorio: true
    detalhes: |
      Se tradu√ß√£o contiver HTML, tags devem estar balanceadas.
      Valida√ß√µes:
      - <b>Texto</b> ‚úÖ V√°lido
      - <b>Texto ‚ùå Inv√°lido (tag n√£o fechada)
      - </b>Texto<b> ‚ùå Inv√°lido (ordem incorreta)
    comportamento: "Upload rejeitado com lista de chaves problem√°ticas"

  - id: "RN-RF005-013"
    descricao: "Limite de Tamanho de Tradu√ß√£o (Aviso)"
    tipo: "validacao"
    prioridade: "baixa"
    obrigatorio: false
    detalhes: |
      Tradu√ß√µes com > 500 caracteres geram aviso (n√£o bloqueiam import).
      Raz√£o: Tradu√ß√µes muito longas podem indicar erro ou necessidade de revis√£o UX.
    threshold: 500
    comportamento: "Upload permitido com aviso no relat√≥rio"

  - id: "RN-RF005-014"
    descricao: "Detec√ß√£o de Tradu√ß√µes Id√™nticas ao Original (Aviso)"
    tipo: "validacao"
    prioridade: "baixa"
    obrigatorio: false
    detalhes: |
      Se tradu√ß√£o for id√™ntica ao texto de refer√™ncia (pt-BR), gerar aviso.
      Raz√£o: Pode indicar que tradutor n√£o traduziu, ou que termo √© universal (ex: Email, Dashboard).
    comportamento: "N√£o bloqueia import, mas lista chaves suspeitas no relat√≥rio"

  - id: "RN-RF005-015"
    descricao: "Versionamento Completo de Uploads"
    tipo: "funcionalidade"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Sistema mant√©m hist√≥rico completo de todos os uploads de tradu√ß√£o.
      Informa√ß√µes armazenadas:
      - Arquivo original (blob)
      - Data/hora do upload
      - Usu√°rio respons√°vel
      - Vers√£o (ex: v1.5)
      - Delta de progresso (antes: 58%, depois: 85%)
      - Chaves adicionadas/atualizadas/removidas
      - Relat√≥rio de valida√ß√£o
    tabela: "SistemaTraducaoVersoes"
    rollback: true
    auditoria: "RF-004 (Sistema_Auditoria)"

  - id: "RN-RF005-016"
    descricao: "Backup Autom√°tico Antes de Sobrescrever"
    tipo: "funcionalidade"
    prioridade: "critica"
    obrigatorio: true
    detalhes: |
      Antes de importar novas tradu√ß√µes, sistema cria backup autom√°tico da vers√£o atual.
      Processo:
      1. Usu√°rio faz upload
      2. Sistema cria backup (SistemaTraducaoVersoes)
      3. Sistema valida novo arquivo
      4. Sistema importa tradu√ß√µes (sobrescrevendo existentes)
      5. Sistema invalida cache Redis
      6. Sistema gera relat√≥rio

  - id: "RN-RF005-017"
    descricao: "Cache Redis para Performance"
    tipo: "performance"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Tradu√ß√µes s√£o cacheadas em Redis para performance.
      Estrat√©gia:
      - Chave: i18n:{idioma}:{namespace} (ex: i18n:en-US:common)
      - TTL: 24 horas (invalida√ß√£o autom√°tica ap√≥s upload)
      - Lazy Loading: Carregar namespace sob demanda
    beneficio: "Redu√ß√£o de 90% nas queries ao banco (50 RPS ‚Üí 5 RPS)"

  - id: "RN-RF005-018"
    descricao: "Tradu√ß√£o Autom√°tica via Azure Translator (Opcional)"
    tipo: "funcionalidade"
    prioridade: "media"
    obrigatorio: false
    detalhes: |
      Administrador pode solicitar tradu√ß√£o autom√°tica inicial via Azure Translator API.
      Fluxo:
      1. Administrador cria novo idioma
      2. Clica em "Traduzir Automaticamente"
      3. Sistema envia todas as chaves pt-BR para Azure Translator API
      4. Sistema recebe tradu√ß√µes
      5. Sistema marca tradu√ß√µes como FoiTraduzidoPorMaquina = True
      6. Sistema exibe aviso: "‚ö†Ô∏è Tradu√ß√£o autom√°tica. Revis√£o recomendada."
      7. Tradutor humano revisa e ajusta tradu√ß√µes
      8. Ap√≥s revis√£o, FoiRevisado = True
    custo: "$10/1M caracteres traduzidos"
    aviso: "Tradu√ß√£o autom√°tica √© ponto de partida, NUNCA substitui revis√£o humana"

  - id: "RN-RF005-019"
    descricao: "Permiss√µes RBAC para Gest√£o de Tradu√ß√µes"
    tipo: "seguranca"
    prioridade: "critica"
    obrigatorio: true
    detalhes: "Gest√£o de tradu√ß√µes √© protegida por permiss√µes RBAC"
    validacao: "Endpoints protegidos com [RequirePermission]"

  - id: "RN-RF005-020"
    descricao: "Lazy Loading de Tradu√ß√µes no Frontend"
    tipo: "performance"
    prioridade: "alta"
    obrigatorio: true
    detalhes: |
      Frontend carrega tradu√ß√µes sob demanda (m√≥dulos n√£o usados n√£o s√£o carregados).
      Benef√≠cios:
      - Redu√ß√£o de 70% no tamanho inicial do bundle
      - Carregamento inicial mais r√°pido
      - Tradu√ß√µes carregadas apenas quando necess√°rias

  - id: "RN-RF005-021"
    descricao: "Tratamento de Pluraliza√ß√£o"
    tipo: "funcionalidade"
    prioridade: "media"
    obrigatorio: true
    detalhes: |
      Tradu√ß√µes devem suportar pluraliza√ß√£o conforme regras do idioma.
      Formas:
      - pt-BR: zero, one, other
      - en-US: zero, one, other
      - Polon√™s: 3 formas diferentes
      - √Årabe: 6 formas diferentes
    nota: "Regras de pluraliza√ß√£o variam por idioma"

  - id: "RN-RF005-022"
    descricao: "Bandeiras e √çcones de Idiomas"
    tipo: "interface"
    prioridade: "media"
    obrigatorio: true
    detalhes: |
      Sistema exibe bandeiras automaticamente para cada idioma.
      Implementa√ß√£o:
      - Biblioteca: flag-icons ou country-flag-emoji-polyfill
      - Mapeamento: pt-BR ‚Üí üáßüá∑, en-US ‚Üí üá∫üá∏, es-ES ‚Üí üá™üá∏, fr-FR ‚Üí üá´üá∑
      - Fallback: Emoji ou √≠cone gen√©rico de idioma üåê
      - Customiza√ß√£o: Administrador pode alterar bandeira manualmente

# =============================================
# PERMISS√ïES RBAC (8 permiss√µes)
# =============================================
permissoes:
  - codigo: "SYS.I18N.READ"
    descricao: "Visualizar idiomas e progresso"
    perfis: ["Todos autenticados"]
    tipo: "leitura"
    critico: false

  - codigo: "SYS.I18N.UPDATE"
    descricao: "Atualizar idioma existente"
    perfis: ["Admin", "Tradutor"]
    tipo: "escrita"
    critico: false

  - codigo: "SYS.I18N.MANAGE_LANGUAGES"
    descricao: "Criar, ativar, desativar idiomas"
    perfis: ["Admin"]
    tipo: "gestao"
    critico: true

  - codigo: "SYS.I18N.AUTO_TRANSLATE"
    descricao: "Tradu√ß√£o autom√°tica via Azure Translator API"
    perfis: ["Admin"]
    tipo: "especial"
    critico: false
    custo: "Sim (Azure Translator API)"

  - codigo: "SYS.I18N.EXPORT"
    descricao: "Exportar tradu√ß√µes"
    perfis: ["Admin", "Tradutor"]
    tipo: "leitura"
    critico: false

  - codigo: "SYS.I18N.IMPORT"
    descricao: "Importar tradu√ß√µes"
    perfis: ["Admin", "Tradutor"]
    tipo: "escrita"
    critico: true

  - codigo: "SYS.I18N.DOWNLOAD_TEMPLATE"
    descricao: "Baixar template de tradu√ß√£o"
    perfis: ["Admin", "Tradutor"]
    tipo: "leitura"
    critico: false

  - codigo: "SYS.I18N.UPLOAD_TRANSLATION"
    descricao: "Upload de tradu√ß√µes"
    perfis: ["Admin", "Tradutor"]
    tipo: "escrita"
    critico: true

# =============================================
# IDIOMAS SUPORTADOS
# =============================================
idiomas_suportados:
  - codigo: "pt-BR"
    nome: "Portugu√™s (Brasil)"
    nome_nativo: "Portugu√™s"
    bandeira: "üáßüá∑"
    cultura: "pt-BR"
    timezone: "America/Sao_Paulo"
    formato_data: "dd/MM/yyyy"
    formato_moeda: "R$ #.##0,00"
    separador_decimal: ","
    padrao: true
    obrigatorio: true

  - codigo: "en-US"
    nome: "English (United States)"
    nome_nativo: "English"
    bandeira: "üá∫üá∏"
    cultura: "en-US"
    timezone: "America/New_York"
    formato_data: "MM/dd/yyyy"
    formato_moeda: "$#,##0.00"
    separador_decimal: "."
    padrao: false
    obrigatorio: false

  - codigo: "es-ES"
    nome: "Espa√±ol (Espa√±a)"
    nome_nativo: "Espa√±ol"
    bandeira: "üá™üá∏"
    cultura: "es-ES"
    timezone: "Europe/Madrid"
    formato_data: "dd/MM/yyyy"
    formato_moeda: "#.##0,00 ‚Ç¨"
    separador_decimal: ","
    padrao: false
    obrigatorio: false

  - codigo: "fr-FR"
    nome: "Fran√ßais (France)"
    nome_nativo: "Fran√ßais"
    bandeira: "üá´üá∑"
    cultura: "fr-FR"
    timezone: "Europe/Paris"
    formato_data: "dd/MM/yyyy"
    formato_moeda: "# ##0,00 ‚Ç¨"
    separador_decimal: ","
    padrao: false
    obrigatorio: false

# =============================================
# INTEGRA√á√ïES OBRIGAT√ìRIAS
# =============================================
integracoes:
  - nome: "Auditoria (RF-004)"
    tipo: "obrigatoria"
    descricao: |
      Registrar cria√ß√£o de idiomas
      Registrar uploads de tradu√ß√µes
      Registrar ativa√ß√£o/desativa√ß√£o de idiomas
    categoria_auditoria: "CONFIG"

  - nome: "Permiss√µes RBAC (RF-007)"
    tipo: "obrigatoria"
    descricao: "8 permiss√µes espec√≠ficas (SYS.I18N.*)"
    validacao: "Em todos os endpoints"

  - nome: "Multi-Tenancy"
    tipo: "obrigatoria"
    descricao: |
      Tradu√ß√µes s√£o globais (n√£o isoladas por tenant)
      Configura√ß√£o de idioma preferido por tenant (opcional)
      Auditoria de altera√ß√µes por tenant

  - nome: "Cache Redis"
    tipo: "obrigatoria"
    descricao: |
      Cache de tradu√ß√µes por idioma
      Invalida√ß√£o autom√°tica ap√≥s upload
      TTL configur√°vel (padr√£o: 24h)
    performance: "Redu√ß√£o de 90% nas queries ao banco"

  - nome: "Azure Translator API"
    tipo: "opcional"
    descricao: |
      Tradu√ß√£o autom√°tica inicial
      Configura√ß√£o via appsettings.json
      Chave de API gerenciada via Azure Key Vault
    custo: "$10/1M caracteres traduzidos"

# =============================================
# MODELO DE DADOS (4 tabelas principais)
# =============================================
tabelas:
  - nome: "SistemaIdiomas"
    descricao: "Idiomas cadastrados no sistema"
    campos_principais:
      - "Id INT PRIMARY KEY"
      - "Codigo NVARCHAR(10) UNIQUE (pt-BR, en-US)"
      - "Nome NVARCHAR(100) (Portugu√™s (Brasil))"
      - "NomeNativo NVARCHAR(100) (Portugu√™s)"
      - "IsAtivo BIT (idioma dispon√≠vel para usu√°rios)"
      - "ProgressoPercentual DECIMAL(5,2) (% de tradu√ß√£o completa)"
      - "TotalChaves INT"
      - "ChavesTraduzidas INT"
    indices:
      - "UNIQUE INDEX IX_Codigo (Codigo)"
    constraints:
      - "FOREIGN KEY IdiomaReferenciaId REFERENCES SistemaIdiomas(Id)"

  - nome: "SistemaTraducaoChaves"
    descricao: "Chaves de tradu√ß√£o (common.buttons.save)"
    campos_principais:
      - "Id INT PRIMARY KEY"
      - "Chave NVARCHAR(500) UNIQUE"
      - "Categoria NVARCHAR(100) (common, menu, validation)"
      - "Contexto NVARCHAR(1000) (descri√ß√£o para tradutores)"
      - "TemInterpolacao BIT (cont√©m {{variavel}}?)"
      - "VariaveisInterpolacao NVARCHAR(500) (username,email CSV)"
    indices:
      - "UNIQUE INDEX IX_Chave (Chave)"
      - "INDEX IX_Categoria (Categoria)"

  - nome: "SistemaTraducoes"
    descricao: "Valores traduzidos por idioma"
    campos_principais:
      - "Id INT PRIMARY KEY"
      - "ChaveId INT (FK SistemaTraducaoChaves)"
      - "IdiomaId INT (FK SistemaIdiomas)"
      - "Valor NVARCHAR(MAX) (texto traduzido)"
      - "FoiTraduzidoPorMaquina BIT"
      - "FoiRevisado BIT"
    constraints:
      - "UNIQUE (ChaveId, IdiomaId)"
    indices:
      - "INDEX IX_Chave_Idioma (ChaveId, IdiomaId)"

  - nome: "SistemaTraducaoVersoes"
    descricao: "Hist√≥rico de uploads de tradu√ß√£o"
    campos_principais:
      - "Id INT PRIMARY KEY"
      - "IdiomaId INT (FK SistemaIdiomas)"
      - "NumeroVersao NVARCHAR(20) (v1.5)"
      - "NomeArquivo NVARCHAR(500)"
      - "FormatoArquivo NVARCHAR(10) (JSON, PO, XLSX)"
      - "ConteudoArquivo VARBINARY(MAX) (arquivo original)"
      - "ChavesAdicionadas INT"
      - "ChavesAtualizadas INT"
      - "ProgressoAnterior DECIMAL(5,2)"
      - "ProgressoNovo DECIMAL(5,2)"
    indices:
      - "INDEX IX_Idioma_Data (IdiomaId, DataUpload DESC)"

# =============================================
# COMPONENTES FRONTEND (Angular 19)
# =============================================
componentes_frontend:
  - nome: "I18nManagementComponent"
    rota: "/sistema/configuracoes/i18n"
    descricao: "Tela principal de gest√£o de idiomas"
    funcionalidades:
      - "Listar idiomas com progresso visual"
      - "Adicionar novo idioma"
      - "Ativar/Desativar idiomas"
      - "Baixar template de tradu√ß√£o"
      - "Upload de tradu√ß√µes"
      - "Visualizar hist√≥rico de vers√µes"

  - nome: "CreateLanguageDialogComponent"
    tipo: "Modal"
    descricao: "Modal para adicionar novo idioma"
    campos:
      - "Idioma (select lista ISO 639-1)"
      - "C√≥digo (auto-preenchido)"
      - "Pa√≠s/Regi√£o (select)"
      - "Bandeira (auto-sugerida, edit√°vel)"

  - nome: "DownloadTemplateDialogComponent"
    tipo: "Modal"
    descricao: "Modal para download de template"
    opcoes:
      - "Tipo: Template Vazio | Tradu√ß√£o Atual"
      - "Formato: JSON | PO | XLSX"
      - "Incluir: Coment√°rios | Exemplos | Refer√™ncia"

  - nome: "UploadTranslationDialogComponent"
    tipo: "Modal"
    descricao: "Modal para upload com drag & drop"
    funcionalidades:
      - "Drag & drop de arquivos"
      - "Valida√ß√£o em tempo real"
      - "Op√ß√µes de importa√ß√£o"
      - "Relat√≥rio de resultado"

  - nome: "TranslationHistoryDialogComponent"
    tipo: "Modal"
    descricao: "Modal de hist√≥rico de vers√µes"
    funcionalidades:
      - "Listar uploads anteriores"
      - "Baixar vers√£o espec√≠fica"
      - "Restaurar vers√£o anterior"
      - "Ver relat√≥rio detalhado"

  - nome: "LanguageSelectorComponent"
    localizacao: "Navbar"
    descricao: "Seletor de idiomas para usu√°rio final"
    funcionalidades:
      - "Exibir idiomas ativos com bandeiras"
      - "Alternar idioma imediatamente"
      - "Persistir sele√ß√£o do usu√°rio"

# =============================================
# CRIT√âRIOS DE ACEITE
# =============================================
criterios_aceite:
  - id: "CA-I18N-001"
    descricao: "Gest√£o Visual de Idiomas"
    validacoes:
      - "Administrador pode adicionar idioma sem acesso ao c√≥digo"
      - "Sistema exibe progresso visual de tradu√ß√£o (%)"
      - "Administrador pode ativar/desativar idiomas"

  - id: "CA-I18N-002"
    descricao: "Download de Templates"
    validacoes:
      - "Sistema gera templates em 3 formatos (JSON, PO, XLSX)"
      - "Template inclui coment√°rios e contexto para tradutores"
      - "Template cont√©m todas as chaves ativas do sistema"

  - id: "CA-I18N-003"
    descricao: "Upload e Valida√ß√£o"
    validacoes:
      - "Drag & drop funcional"
      - "Valida√ß√£o de interpola√ß√µes {{var}}"
      - "Valida√ß√£o de HTML balanceado"
      - "Relat√≥rio detalhado ap√≥s upload"

  - id: "CA-I18N-004"
    descricao: "Versionamento"
    validacoes:
      - "Hist√≥rico completo de uploads"
      - "Rollback funcional para vers√£o anterior"
      - "Diff entre vers√µes exibido"

  - id: "CA-I18N-005"
    descricao: "Performance"
    validacoes:
      - "Cache Redis implementado"
      - "Lazy loading de tradu√ß√µes no frontend"
      - "Tempo de carregamento < 200ms por idioma"

  - id: "CA-I18N-006"
    descricao: "Formata√ß√£o Regional"
    validacoes:
      - "Datas formatadas corretamente por idioma"
      - "Moedas formatadas corretamente por idioma"
      - "N√∫meros formatados corretamente por idioma"

  - id: "CA-I18N-007"
    descricao: "Fallback"
    validacoes:
      - "Fallback em cascata funcionando"
      - "Sem exibi√ß√£o de chaves t√©cnicas para usu√°rio final"

  - id: "CA-I18N-008"
    descricao: "Auditoria"
    validacoes:
      - "Todos os uploads registrados em Sistema_Auditoria"
      - "Ativa√ß√£o/desativa√ß√£o de idiomas auditada"

# =============================================
# RISCOS E MITIGA√á√ïES
# =============================================
riscos:
  - id: "R-I18N-001"
    descricao: "Tradu√ß√£o Autom√°tica de Baixa Qualidade"
    probabilidade: "alta"
    impacto: "medio"
    mitigacao: |
      - Marcar tradu√ß√µes autom√°ticas como "Requer Revis√£o"
      - Exibir aviso claro para usu√°rios
      - Fluxo de revis√£o obrigat√≥rio antes de ativar idioma

  - id: "R-I18N-002"
    descricao: "Performance com Muitos Idiomas"
    probabilidade: "media"
    impacto: "alto"
    mitigacao: |
      - Cache Redis obrigat√≥rio
      - Lazy loading de tradu√ß√µes
      - CDN para arquivos est√°ticos

  - id: "R-I18N-003"
    descricao: "Inconsist√™ncia de Tradu√ß√µes"
    probabilidade: "media"
    impacto: "medio"
    mitigacao: |
      - Gloss√°rio de termos t√©cnicos
      - Valida√ß√£o de consist√™ncia (termos chave)
      - Revis√£o por tradutor s√™nior

# =============================================
# DEPEND√äNCIAS
# =============================================
dependencias:
  tecnicas:
    - rf: "RF-004"
      nome: "Auditoria de Logs do Sistema"
      tipo: "obrigatoria"
      razao: "Registro de altera√ß√µes em tradu√ß√µes"

    - rf: "RF-007"
      nome: "Login e Autentica√ß√£o"
      tipo: "obrigatoria"
      razao: "Permiss√µes RBAC (8 permiss√µes SYS.I18N.*)"

    - servico: "Azure Translator API"
      tipo: "opcional"
      razao: "Tradu√ß√£o autom√°tica inicial"

    - servico: "Redis"
      tipo: "obrigatoria"
      razao: "Cache de tradu√ß√µes (performance)"

    - biblioteca: "@jsverse/transloco"
      tipo: "obrigatoria"
      razao: "Frontend i18n (Angular 19)"

    - biblioteca: "IStringLocalizer (.NET)"
      tipo: "obrigatoria"
      razao: "Backend i18n (.NET 10)"

  negocio:
    - "Defini√ß√£o de idiomas priorit√°rios (en-US, es-ES, fr-FR)"
    - "Or√ßamento para Azure Translator API"
    - "Equipe de tradutores/revisores"

# =============================================
# M√âTRICAS E KPIs
# =============================================
metricas:
  - nome: "Total de idiomas ativos"
    meta: ">= 4 idiomas (pt-BR, en-US, es-ES, fr-FR)"
    medicao: "COUNT(*) FROM SistemaIdiomas WHERE IsAtivo = 1"

  - nome: "Progresso m√©dio de tradu√ß√£o"
    meta: ">= 85%"
    medicao: "AVG(ProgressoPercentual) FROM SistemaIdiomas WHERE IsAtivo = 1"

  - nome: "Tempo de carregamento de idioma"
    meta: "< 200ms"
    medicao: "Tempo de resposta do endpoint /api/i18n/translations/{lang}"

  - nome: "Taxa de uso de fallback"
    meta: "< 5%"
    medicao: "Percentual de chaves sem tradu√ß√£o direta"

  - nome: "Tradu√ß√µes autom√°ticas revisadas"
    meta: ">= 80% revisadas"
    medicao: "COUNT(*) WHERE FoiTraduzidoPorMaquina = 1 AND FoiRevisado = 1"

# =============================================
# HIST√ìRICO DE VERS√ïES
# =============================================
historico:
  - versao: "2.0"
    data: "2025-12-29"
    autor: "Ag√™ncia ALC - alc.dev.br"
    descricao: "Vers√£o completa com 22 RNs, gest√£o visual, versionamento, valida√ß√µes"
    mudancas:
      - "22 Regras de Neg√≥cio completas e detalhadas"
      - "8 Permiss√µes RBAC espec√≠ficas"
      - "4 Idiomas suportados inicialmente (pt-BR, en-US, es-ES, fr-FR)"
      - "3 Formatos de arquivo (JSON, PO, XLSX)"
      - "4 Tabelas do modelo de dados"
      - "6 Componentes frontend (Angular 19)"
      - "8 Crit√©rios de aceite"
      - "3 Riscos identificados com mitiga√ß√µes"

  - versao: "1.0"
    data: "2025-11-04"
    autor: "Equipe IControlIT"
    descricao: "Vers√£o inicial (sistema parcialmente implementado)"
    mudancas:
      - "ngx-translate configurado (frontend)"
      - "IStringLocalizer configurado (backend)"
      - "Arquivos i18n b√°sicos (pt-BR, en-US)"
      - "Lazy loading de tradu√ß√µes"

# =============================================
# METADADOS
# =============================================
metadados:
  total_regras_negocio: 22
  total_permissoes: 8
  total_idiomas_suportados: 4
  total_formatos_arquivo: 3
  total_tabelas: 4
  total_componentes_frontend: 6
  total_criterios_aceite: 8
  total_riscos: 3
  estimativa_story_points: 89  # Complexidade muito alta
  estimativa_horas: 180  # ~4-5 semanas (2 desenvolvedores)
