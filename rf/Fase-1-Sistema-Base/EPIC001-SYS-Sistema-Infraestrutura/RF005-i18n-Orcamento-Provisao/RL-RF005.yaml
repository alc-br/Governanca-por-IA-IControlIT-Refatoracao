# =============================================
# RL-RF005: Referência ao Legado (Estruturada)
# RF: RF-005 — Internacionalização (i18n) e Localização
# Versão: 2.0
# Data: 2025-12-29
# Autor: Agência ALC - alc.dev.br
# =============================================

rl:
  rf_relacionado: "RF-005"
  rf_titulo: "Internacionalização (i18n) e Localização"
  versao: "2.0"
  data: "2025-12-29"
  total_problemas_identificados: 6
  total_componentes_afetados: 150  # ~150 telas ASPX

# =============================================
# REFERÊNCIAS AO LEGADO (6 problemas principais)
# =============================================
referencias:
  - id: "LEG-RF005-001"
    tipo: "problema_arquitetural"
    nome: "Textos Hardcoded em Português"
    caminho: "ic1_legado/IControlIT/**/*.aspx | **/*.vb"
    descricao: |
      Textos em português diretamente no código VB.NET e markup ASPX.
      Exemplos:
      - lblMensagem.Text = "Bem-vindo ao sistema"
      - btnSalvar.Text = "Salvar"
      - <asp:Label Text="Cadastro de Usuários" />

      Afeta ~150 telas ASPX e centenas de arquivos VB.NET.

    # CAMPO OBRIGATÓRIO: Destino do item legado
    destino: "substituido"
    justificativa: |
      Sistema moderno usa chaves i18n completas:
      - Frontend: {{ 'common.buttons.save' | transloco }}
      - Backend: _localizer["validation.email.required"]

      NÃÃO há migração de textos hardcoded. Estrutura criada do zero.

    # Rastreabilidade
    rf_item_relacionado: "RN-I18N-008, RN-I18N-009"
    uc_relacionado: "Todos os UCs"
    complexidade: "muito_alta"
    risco_migracao: "alto"
    prioridade: 1
    estimativa_impacto: "~1.310 chaves estimadas para sistema moderno"

  - id: "LEG-RF005-002"
    tipo: "problema_formatacao"
    nome: "Formatação de Datas/Moedas Fixa em pt-BR"
    caminho: "ic1_legado/IControlIT/**/*.vb"
    descricao: |
      Formatação hardcoded sem suporte a diferentes culturas.
      Exemplos:
      - lblData.Text = DateTime.Now.ToString("dd/MM/yyyy")
      - lblValor.Text = String.Format("R$ {0:N2}", valor)
      - lblQuantidade.Text = quantidade.ToString("N2")  ' 1.234,56

      Usuários internacionais veem formato brasileiro sempre.

    destino: "substituido"
    justificativa: |
      Sistema moderno usa CultureInfo dinâmico:
      - Backend: CultureInfo.CurrentCulture = new CultureInfo(idioma)
      - Frontend: {{ data | date:'short':'':'pt-BR' }}
                 {{ valor | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}

      Formatos ajustados automaticamente por idioma selecionado.

    rf_item_relacionado: "RN-I18N-004"
    uc_relacionado: "Todos os UCs que exibem datas/moedas"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 2

  - id: "LEG-RF005-003"
    tipo: "problema_comunicacao"
    nome: "Emails Apenas em Português"
    caminho: "ic1_legado/IControlIT/App_Code/EmailService.vb"
    descricao: |
      Templates de email hardcoded em português.
      Exemplo:
      Dim corpo As String = "<h1>Bem-vindo ao IControlIT</h1>" & _
                            "<p>Seu cadastro foi realizado com sucesso.</p>" & _
                            "<p>Clique no link abaixo para ativar sua conta:</p>"

      EnviarEmail(usuario.Email, "Bem-vindo ao IControlIT", corpo)

      Usuários internacionais recebem emails em português.

    destino: "substituido"
    justificativa: |
      Sistema moderno usa templates multi-idioma:
      - Templates Razor (.NET) com IStringLocalizer
      - Seleção de template baseado em usuario.IdiomaPreferido
      - Suporte a HTML + texto plano

    rf_item_relacionado: "RN-I18N-002, RN-I18N-011"
    uc_relacionado: "UC00 (notificações de sistema)"
    complexidade: "media"
    risco_migracao: "baixo"
    prioridade: 3

  - id: "LEG-RF005-004"
    tipo: "problema_relatorios"
    nome: "Relatórios Não Traduzíveis"
    caminho: "ic1_legado/IControlIT/Relatorios/*.rpt"
    descricao: |
      Relatórios Crystal Reports com labels fixos em português.
      Exemplos:
      - Relatório: "Relatório de Ativos"
      - Colunas: "Nome", "Tipo", "Valor", "Data de Aquisição"
      - Rodapé: "Total de Ativos: {count}"

      Impossível traduzir sem recriar relatórios.

    destino: "substituido"
    justificativa: |
      Sistema moderno usa relatórios com i18n:
      - SSRS com expressões i18n
      - HTML dinâmico com Angular Transloco
      - PDF gerado server-side com IStringLocalizer

      Labels traduzidos conforme idioma do usuário.

    rf_item_relacionado: "RN-I18N-011"
    uc_relacionado: "Relatórios de sistema"
    complexidade: "alta"
    risco_migracao: "medio"
    prioridade: 4

  - id: "LEG-RF005-005"
    tipo: "problema_estrutural"
    nome: "Nenhuma Biblioteca de Internacionalização"
    caminho: "ic1_legado/IControlIT/"
    descricao: |
      Sistema legado NÃO utiliza nenhuma biblioteca i18n.
      Constatação:
      - NÃO usa arquivos .resx
      - NÃO usa ResourceManager
      - NÃO usa CultureInfo dinâmico
      - NÃO tem estrutura de tradução
      - NÃO tem tabelas de idiomas/traduções no banco

      Implementação de i18n = ZERO.

    destino: "descartado"
    justificativa: |
      Implementação do ZERO no sistema moderno:
      - Backend: IStringLocalizer + arquivos .resx
      - Frontend: @jsverse/transloco + JSON
      - Banco: 4 tabelas (SistemaIdiomas, SistemaTraducaoChaves, SistemaTraducoes, SistemaTraducaoVersoes)
      - Interface de gestão visual completa

      NÃO há nada a migrar do legado. Sistema moderno é 100% novo.

    rf_item_relacionado: "RF-005 completo (todas as RNs)"
    uc_relacionado: "Todos os UCs"
    complexidade: "muito_alta"
    risco_migracao: "alto"
    prioridade: 1
    observacao: "Este é o problema raiz. Sistema legado não foi projetado para i18n."

  - id: "LEG-RF005-006"
    tipo: "problema_gestao"
    nome: "Impossibilidade de Adicionar Idiomas sem Código"
    caminho: "N/A (ausência de funcionalidade)"
    descricao: |
      Não há interface ou mecanismo para adicionar novos idiomas sem modificar código.

      Barreira técnica: Textos hardcoded em centenas de arquivos .aspx e .vb.

      Para adicionar um idioma no legado seria necessário:
      1. Modificar ~150 arquivos ASPX
      2. Modificar ~300 arquivos VB.NET
      3. Recompilar aplicação
      4. Deploy completo
      5. Risco alto de introduzir bugs

      Custo estimado: 6+ meses de trabalho manual.

    destino: "descartado"
    justificativa: |
      Sistema moderno tem gestão visual de idiomas:
      - Administrador adiciona idioma via interface
      - Download de template (JSON/PO/XLSX)
      - Tradução offline por tradutor
      - Upload de arquivo traduzido
      - Validação automática completa
      - Ativação quando >= 80% completo

      Tempo para adicionar novo idioma: ~2 semanas (incluindo tradução).

    rf_item_relacionado: "RN-I18N-001 até RN-I18N-022 (todas)"
    uc_relacionado: "UC00, UC01, UC02, UC03, UC04"
    complexidade: "muito_alta"
    risco_migracao: "N/A"
    prioridade: 1
    observacao: "Funcionalidade inexistente no legado. Diferencial competitivo do sistema moderno."

# =============================================
# COMPONENTES LEGADO AFETADOS
# =============================================
componentes_afetados:
  - tipo: "tela_aspx"
    quantidade: 150
    exemplos:
      - "ic1_legado/IControlIT/Login.aspx"
      - "ic1_legado/IControlIT/Dashboard.aspx"
      - "ic1_legado/IControlIT/Usuarios/Default.aspx"
      - "ic1_legado/IControlIT/Ativos/Default.aspx"
    status: "substituido"

  - tipo: "master_page"
    quantidade: 3
    exemplos:
      - "ic1_legado/IControlIT/Site.Master (menu hardcoded)"
    status: "substituido"

  - tipo: "code_behind_vb"
    quantidade: 300
    exemplos:
      - "Validações com mensagens hardcoded"
      - "Formatação de datas/moedas fixa"
    status: "substituido"

  - tipo: "stored_procedure"
    quantidade: 50
    exemplos:
      - "RAISERROR('Email já cadastrado', 16, 1)  -- Mensagem em português"
    status: "substituido (mensagens vêm do backend moderno)"

  - tipo: "relatorio_crystal"
    quantidade: 20
    exemplos:
      - "Relatórios .rpt com labels fixos em português"
    status: "substituido"

# =============================================
# ESTRATÉGIA DE MIGRAÇÃO
# =============================================
estrategia_migracao:
  decisao: "CRIAR DO ZERO"
  razoes:
    - "Textos espalhados em ~150 arquivos ASPX e VB.NET"
    - "NÃO há padrão ou consistência"
    - "Código legado será descontinuado"
    - "Sistema moderno tem arquitetura diferente (componentes standalone, lazy loading)"
    - "Custo de migração > Custo de criar novo"

  workflow_moderno:
    - passo: 1
      descricao: "Identificar todas as chaves necessárias no sistema moderno"
    - passo: 2
      descricao: "Criar estrutura de namespaces (common, menu, validation, etc)"
    - passo: 3
      descricao: "Adicionar chaves ao sistema (SistemaTraducaoChaves)"
    - passo: 4
      descricao: "Traduzir pt-BR manualmente (idioma padrão - 100%)"
    - passo: 5
      descricao: "Gerar templates para en-US, es-ES, fr-FR"
    - passo: 6
      descricao: "Usar Azure Translator para tradução inicial automática"
    - passo: 7
      descricao: "Revisão humana das traduções automáticas"
    - passo: 8
      descricao: "Ativação de idiomas quando >= 80% completos"

# =============================================
# MAPEAMENTO CONCEITOS LEGADO → MODERNO
# =============================================
mapeamento_conceitos:
  - conceito_legado: "lblNome.Text = \"Nome\""
    conceito_moderno: "{{ 'common.labels.name' | transloco }}"
    tecnologia: "Angular Transloco"

  - conceito_legado: "MsgBox(\"Erro\")"
    conceito_moderno: "_localizer[\"validation.error\"]"
    tecnologia: ".NET IStringLocalizer"

  - conceito_legado: "DateTime.ToString(\"dd/MM/yyyy\")"
    conceito_moderno: "{{ data | date:'short':'':'pt-BR' }}"
    tecnologia: "Angular DatePipe com cultura dinâmica"

  - conceito_legado: "String.Format(\"R$ {0:N2}\")"
    conceito_moderno: "{{ valor | currency:'BRL' }}"
    tecnologia: "Angular CurrencyPipe"

  - conceito_legado: "Relatório Crystal fixo"
    conceito_moderno: "Template i18n dinâmico"
    tecnologia: "SSRS/HTML com i18n"

# =============================================
# ESTIMATIVA DE ESFORÇO
# =============================================
estimativa_esforco:
  chaves_estimadas_por_modulo:
    common_buttons_labels: 200
    menu_principal: 50
    validations: 300
    dashboard: 80
    cadastros_crud: 400  # 20 CRUDs x ~20 chaves cada
    relatorios: 150
    emails: 50
    help_tooltips: 80

  total_chaves_estimadas: 1310
  total_chaves_reais_sistema_moderno: 1247
  diferenca: -63  # Estimativa muito próxima ✅

  tempo_estimado_traducao:
    pt_BR: "2 semanas (manual, 100%)"
    en_US: "1 semana (Azure Translator + revisão humana)"
    es_ES: "1 semana (Azure Translator + revisão humana)"
    fr_FR: "1 semana (Azure Translator + revisão humana)"

  custo_estimado_azure_translator:
    caracteres_por_chave_media: 30
    total_caracteres: 38430  # 1247 chaves x 30 caracteres médio
    custo_por_milhao: 10  # USD
    custo_total_por_idioma: 0.38  # USD
    custo_total_3_idiomas: 1.14  # USD (desprezível)

# =============================================
# DESAFIOS IDENTIFICADOS
# =============================================
desafios:
  - id: "D-I18N-001"
    nome: "Pluralização Complexa"
    descricao: |
      Legado NÃO trata pluralização corretamente:
      lblResultado.Text = count & " item(ns) encontrado(s)"

      Moderno usa regras de pluralização por idioma (zero/one/other).

  - id: "D-I18N-002"
    nome: "Gênero de Substantivos"
    descricao: |
      Legado NÃO trata gênero (português tem masculino/feminino).
      Moderno requer chaves separadas quando gênero importa:
      - user.welcome.male
      - user.welcome.female

  - id: "D-I18N-003"
    nome: "Ordem de Palavras Diferente por Idioma"
    descricao: |
      Legado assume ordem pt-BR em interpolações:
      mensagem = "O usuário " & nome & " foi criado com sucesso"

      Moderno permite reordenamento via interpolação:
      pt-BR: "O usuário {{name}} foi criado com sucesso"
      en-US: "User {{name}} was successfully created"

# =============================================
# LIÇÕES APRENDIDAS
# =============================================
licoes_aprendidas:
  o_que_funciona:
    - "Simplicidade: Textos diretos são fáceis de entender no código"
    - "Performance: Sem overhead de lookup de tradução"

  o_que_nao_funciona:
    - "Manutenibilidade: Alteração de texto requer alteração de código"
    - "Escalabilidade: Impossível adicionar idiomas sem reescrever"
    - "Consistência: Mesma frase traduzida diferente em lugares diferentes"
    - "Experiência do Usuário: Barreira para internacionalização"

# =============================================
# RECOMENDAÇÕES PARA SISTEMA MODERNO
# =============================================
recomendacoes:
  - id: "R-I18N-001"
    titulo: "Chaves Desde o Início"
    descricao: "NUNCA hardcodar texto. SEMPRE usar chave i18n desde a primeira linha de código."
    exemplo_errado: "btnSave.text = \"Salvar\";"
    exemplo_correto: "btnSave.text = this.transloco.translate('common.buttons.save');"

  - id: "R-I18N-002"
    titulo: "Namespaces Claros"
    descricao: "Estrutura hierárquica clara desde o início."
    exemplo_bom: "common.buttons.save, common.buttons.cancel, menu.dashboard"
    exemplo_ruim: "salvar, cancelar, painel"

  - id: "R-I18N-003"
    titulo: "Contexto para Tradutores"
    descricao: "Sempre adicionar contexto/comentários para tradutores."
    exemplo: "_comment_save: Botão de salvar formulário (contexto: edição de cadastro)"

# =============================================
# RESUMO EXECUTIVO
# =============================================
resumo:
  situacao_legado:
    textos_hardcoded: "~150 telas ASPX + VB.NET"
    formatacao_fixa: "pt-BR em datas/moedas"
    emails_relatorios: "Apenas português"
    biblioteca_i18n: "Nenhuma (implementação do zero)"

  decisao_modernizacao:
    migrar_textos_legado: false
    criar_do_zero: true
    gestao_visual: true
    suporte_idiomas: 4  # pt-BR, en-US, es-ES, fr-FR

  beneficios_modernizacao:
    - "Expansão Global: Sistema pronto para mercado internacional"
    - "Manutenibilidade: Alterar textos sem tocar no código"
    - "Flexibilidade: Adicionar idiomas sob demanda"
    - "Profissionalismo: Tradução humana revisada"
    - "Performance: Cache Redis + Lazy Loading"

# =============================================
# HISTÓRICO DE VERSÕES
# =============================================
historico:
  - versao: "2.0"
    data: "2025-12-29"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Referência completa ao legado (6 problemas, estratégia, lições, recomendações)"
    mudancas:
      - "6 problemas do legado documentados com destino obrigatório"
      - "Componentes afetados listados (~150 telas ASPX)"
      - "Estratégia de migração (CRIAR DO ZERO)"
      - "Mapeamento conceitos legado → moderno"
      - "Estimativa de esforço (1.310 chaves, custo Azure Translator $1.14)"
      - "3 desafios identificados (pluralização, gênero, ordem de palavras)"
      - "3 recomendações para sistema moderno"
