# =============================================
# UC-RF014 - Casos de Uso (Contrato Comportamental)
# Versão: 2.0
# Data: 2025-12-31
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF014"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Visualizar Dados da Conta"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF014-CRUD-01"  # Visualizar dados pessoais
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa /user-settings"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida autenticação JWT"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega dados do usuário atual via Query GetCurrentUser"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema exibe campos somente leitura: Nome, Email, CPF, Empresa"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema indica visualmente que campos são não-editáveis (ícone de cadeado)"
          required: true
        - id: "FP-UC00-006"
          title: "Sistema exibe dados editáveis: Telefone, Data de Nascimento"
          required: true
        - id: "FA-UC00-001"
          title: "Tela responsiva em mobile (< 1024px) - Menu lateral vira drawer overlay"
          required: false
        - id: "FA-UC00-002"
          title: "Usuário acessa via navegação por teclado (acessibilidade)"
          required: false
        - id: "FE-UC00-001"
          title: "Token JWT expirado → Sistema retorna HTTP 401 → Redirecionamento para login"
          required: true
        - id: "FE-UC00-002"
          title: "Usuário inativo ou bloqueado → Sistema retorna HTTP 403"
          required: true
        - id: "FE-UC00-003"
          title: "Erro ao carregar dados → Sistema exibe mensagem de erro"
          required: true

    precondicoes:
      - autenticacao: "jwt_valido"
      - estado_usuario: "active"

    gatilho: "Usuario acessa /user-settings"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_user_settings"
      - passo: 2
        ator: "sistema"
        acao: "validar_autenticacao_jwt"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados_usuario_atual"
      - passo: 4
        ator: "sistema"
        acao: "exibir_campos_somente_leitura"
      - passo: 5
        ator: "sistema"
        acao: "indicar_campos_nao_editaveis"
      - passo: 6
        ator: "sistema"
        acao: "exibir_dados_editaveis"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "tela_mobile"
        resultado: "menu_vira_drawer_overlay"
      - id: "FA-UC00-02"
        condicao: "navegacao_teclado"
        resultado: "suporte_acessibilidade"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "token_expirado"
        resultado: "redirecionamento_login"
      - id: "FE-UC00-02"
        condicao: "usuario_inativo_bloqueado"
        resultado: "http_403"
      - id: "FE-UC00-03"
        condicao: "erro_carregar_dados"
        resultado: "mensagem_erro"

    regras_aplicadas:
      - "RN-RF014-01"  # Campos somente leitura
      - "RN-RF014-13"  # Navegação responsiva
      - "RN-RF014-15"  # Usuário logado obrigatório
      - "RN-RF014-16"  # Isolamento de dados

    resultado_final:
      estado: "dados_exibidos_corretamente"

  - id: "UC01"
    nome: "Editar Dados Pessoais"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF014-CRUD-02"  # Atualizar telefone e data nascimento
        - "RF014-VAL-01"   # Validar formato de telefone brasileiro
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário acessa aba Conta em /user-settings"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida autenticação JWT"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema carrega dados atuais do usuário"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário edita campo Telefone"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema valida formato em tempo real"
          required: true
        - id: "FP-UC01-006"
          title: "Usuário edita campo Data de Nascimento via datepicker"
          required: true
        - id: "FP-UC01-007"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema valida formulário completo"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema envia dados ao backend via PUT /api/usuarios/{id}/profile"
          required: true
        - id: "FP-UC01-010"
          title: "Backend valida dados"
          required: true
        - id: "FP-UC01-011"
          title: "Backend atualiza registro no banco"
          required: true
        - id: "FP-UC01-012"
          title: "Backend registra auditoria (campos alterados, valores antigos/novos, IP, timestamp)"
          required: true
        - id: "FP-UC01-013"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC01-014"
          title: "Interface atualiza com novos dados"
          required: true
        - id: "FA-UC01-001"
          title: "Formulário sem alterações - Sistema exibe aviso"
          required: false
        - id: "FA-UC01-002"
          title: "Usuário cancela edição - Dados não são salvos"
          required: false
        - id: "FE-UC01-001"
          title: "Telefone com formato inválido → Sistema exibe erro"
          required: true
        - id: "FE-UC01-002"
          title: "Token JWT expirado → Sistema retorna HTTP 401"
          required: true
        - id: "FE-UC01-003"
          title: "Erro de conexão → Sistema exibe mensagem de erro"
          required: true
        - id: "FE-UC01-004"
          title: "Data de nascimento futura → Sistema exibe erro"
          required: true

    precondicoes:
      - autenticacao: "jwt_valido"
      - estado_usuario: "active"

    gatilho: "Usuario acessa aba Conta e edita dados"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_conta"
      - passo: 2
        ator: "sistema"
        acao: "validar_autenticacao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_dados_atuais"
      - passo: 4
        ator: "usuario"
        acao: "editar_telefone"
      - passo: 5
        ator: "sistema"
        acao: "validar_formato_tempo_real"
      - passo: 6
        ator: "usuario"
        acao: "editar_data_nascimento"
      - passo: 7
        ator: "usuario"
        acao: "clicar_salvar"
      - passo: 8
        ator: "sistema"
        acao: "validar_formulario"
      - passo: 9
        ator: "sistema"
        acao: "enviar_backend"
      - passo: 10
        ator: "backend"
        acao: "validar_dados"
      - passo: 11
        ator: "backend"
        acao: "atualizar_banco"
      - passo: 12
        ator: "backend"
        acao: "registrar_auditoria"
      - passo: 13
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 14
        ator: "sistema"
        acao: "atualizar_interface"

    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "sem_alteracoes"
        resultado: "aviso_nenhuma_alteracao"
      - id: "FA-UC01-02"
        condicao: "cancelar_edicao"
        resultado: "dados_nao_salvos"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "telefone_invalido"
        resultado: "mensagem_erro_formato"
      - id: "FE-UC01-02"
        condicao: "token_expirado"
        resultado: "redirecionamento_login"
      - id: "FE-UC01-03"
        condicao: "erro_conexao"
        resultado: "mensagem_erro_conexao"
      - id: "FE-UC01-04"
        condicao: "data_futura"
        resultado: "mensagem_erro_data"

    regras_aplicadas:
      - "RN-RF014-01"  # Campos somente leitura
      - "RN-RF014-02"  # Validação de telefone
      - "RN-RF014-15"  # Usuário logado obrigatório
      - "RN-RF014-16"  # Isolamento de dados

    resultado_final:
      estado: "dados_atualizados_auditados"

  - id: "UC02"
    nome: "Alterar Senha"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF014-CRUD-03"  # Alterar senha
        - "RF014-VAL-02"   # Validar requisitos de senha forte
        - "RF014-VAL-03"   # Validar senha atual antes de alterar
        - "RF014-VAL-04"   # Validar nova senha diferente da atual
        - "RF014-VAL-05"   # Validar senha não está na blacklist
        - "RF014-VAL-06"   # Validar senha não contém dados pessoais
        - "RF014-VAL-07"   # Validar confirmação de senha
        - "RF014-SEC-03"   # Auditoria de alteração de senha
        - "RF014-SEC-04"   # Hash seguro de senha (BCrypt/PBKDF2)
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário acessa aba Segurança em /user-settings"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida autenticação JWT"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema exibe formulário de alteração de senha"
          required: true
        - id: "FP-UC02-004"
          title: "Usuário digita senha atual (campo com toggle de visibilidade)"
          required: true
        - id: "FP-UC02-005"
          title: "Usuário digita nova senha"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema valida requisitos em tempo real"
          required: true
        - id: "FP-UC02-007"
          title: "Usuário digita confirmação de senha"
          required: true
        - id: "FP-UC02-008"
          title: "Sistema valida se senhas coincidem em tempo real"
          required: true
        - id: "FP-UC02-009"
          title: "Usuário clica em Alterar Senha"
          required: true
        - id: "FP-UC02-010"
          title: "Sistema valida formulário completo"
          required: true
        - id: "FP-UC02-011"
          title: "Sistema envia dados ao backend via POST /api/usuarios/change-password"
          required: true
        - id: "FP-UC02-012"
          title: "Backend busca usuário no banco"
          required: true
        - id: "FP-UC02-013"
          title: "Backend valida hash da senha atual"
          required: true
        - id: "FP-UC02-014"
          title: "Backend valida nova senha (requisitos, blacklist, dados pessoais)"
          required: true
        - id: "FP-UC02-015"
          title: "Backend valida que nova senha é diferente da atual"
          required: true
        - id: "FP-UC02-016"
          title: "Backend gera hash da nova senha"
          required: true
        - id: "FP-UC02-017"
          title: "Backend salva nova senha"
          required: true
        - id: "FP-UC02-018"
          title: "Backend registra auditoria (UserId, IP, Timestamp, UserAgent)"
          required: true
        - id: "FP-UC02-019"
          title: "Sistema retorna HTTP 200 OK"
          required: true
        - id: "FP-UC02-020"
          title: "Frontend exibe mensagem de sucesso"
          required: true
        - id: "FP-UC02-021"
          title: "Formulário é limpo"
          required: true
        - id: "FA-UC02-001"
          title: "Usuário clica em ícone de olho - Sistema alterna tipo do input"
          required: false
        - id: "FA-UC02-002"
          title: "Usuário cancela operação - Dados não são salvos"
          required: false
        - id: "FE-UC02-001"
          title: "Senha atual incorreta → Backend retorna HTTP 400"
          required: true
        - id: "FE-UC02-002"
          title: "Nova senha igual à atual → Backend retorna HTTP 400"
          required: true
        - id: "FE-UC02-003"
          title: "Senha muito fraca → Frontend valida em tempo real"
          required: true
        - id: "FE-UC02-004"
          title: "Senha na blacklist → Backend retorna HTTP 400"
          required: true
        - id: "FE-UC02-005"
          title: "Senha contém dados pessoais → Backend retorna HTTP 400"
          required: true
        - id: "FE-UC02-006"
          title: "Senhas não coincidem → Frontend valida em tempo real"
          required: true
        - id: "FE-UC02-007"
          title: "Token JWT expirado → Sistema retorna HTTP 401"
          required: true
        - id: "FE-UC02-008"
          title: "Erro inesperado → Sistema exibe mensagem de erro"
          required: true

    precondicoes:
      - autenticacao: "jwt_valido"
      - estado_usuario: "active"
      - conhece_senha_atual: true

    gatilho: "Usuario acessa aba Seguranca e solicita alteracao de senha"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_seguranca"
      - passo: 2
        ator: "sistema"
        acao: "validar_autenticacao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario_senha"
      - passo: 4
        ator: "usuario"
        acao: "digitar_senha_atual"
      - passo: 5
        ator: "usuario"
        acao: "digitar_nova_senha"
      - passo: 6
        ator: "sistema"
        acao: "validar_requisitos_tempo_real"
      - passo: 7
        ator: "usuario"
        acao: "digitar_confirmacao"
      - passo: 8
        ator: "sistema"
        acao: "validar_confirmacao_tempo_real"
      - passo: 9
        ator: "usuario"
        acao: "clicar_alterar_senha"
      - passo: 10
        ator: "sistema"
        acao: "validar_formulario"
      - passo: 11
        ator: "sistema"
        acao: "enviar_backend"
      - passo: 12
        ator: "backend"
        acao: "buscar_usuario"
      - passo: 13
        ator: "backend"
        acao: "validar_hash_senha_atual"
      - passo: 14
        ator: "backend"
        acao: "validar_nova_senha"
      - passo: 15
        ator: "backend"
        acao: "validar_senha_diferente"
      - passo: 16
        ator: "backend"
        acao: "gerar_hash_nova_senha"
      - passo: 17
        ator: "backend"
        acao: "salvar_nova_senha"
      - passo: 18
        ator: "backend"
        acao: "registrar_auditoria"
      - passo: 19
        ator: "sistema"
        acao: "retornar_sucesso"
      - passo: 20
        ator: "sistema"
        acao: "exibir_mensagem_sucesso"
      - passo: 21
        ator: "sistema"
        acao: "limpar_formulario"

    fluxos_alternativos:
      - id: "FA-UC02-01"
        condicao: "toggle_visibilidade_senha"
        resultado: "senha_visivel_oculta"
      - id: "FA-UC02-02"
        condicao: "cancelar_operacao"
        resultado: "dados_nao_salvos"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "senha_atual_incorreta"
        resultado: "http_400_senha_incorreta"
      - id: "FE-UC02-02"
        condicao: "nova_senha_igual_atual"
        resultado: "http_400_senha_igual"
      - id: "FE-UC02-03"
        condicao: "senha_fraca"
        resultado: "validacao_tempo_real_requisitos"
      - id: "FE-UC02-04"
        condicao: "senha_blacklist"
        resultado: "http_400_senha_comum"
      - id: "FE-UC02-05"
        condicao: "senha_dados_pessoais"
        resultado: "http_400_senha_pessoal"
      - id: "FE-UC02-06"
        condicao: "senhas_nao_coincidem"
        resultado: "validacao_tempo_real_confirmacao"
      - id: "FE-UC02-07"
        condicao: "token_expirado"
        resultado: "redirecionamento_login"
      - id: "FE-UC02-08"
        condicao: "erro_inesperado"
        resultado: "mensagem_erro_generico"

    regras_aplicadas:
      - "RN-RF014-03"  # Senha atual obrigatória
      - "RN-RF014-04"  # Requisitos de nova senha
      - "RN-RF014-05"  # Nova senha diferente da atual
      - "RN-RF014-06"  # Blacklist de senhas comuns
      - "RN-RF014-07"  # Senha não pode conter dados pessoais
      - "RN-RF014-08"  # Confirmação de senha
      - "RN-RF014-15"  # Usuário logado obrigatório
      - "RN-RF014-16"  # Isolamento de dados

    resultado_final:
      estado: "senha_alterada_auditada"

  - id: "UC03"
    nome: "Configurar Idioma"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF014-CRUD-04"  # Atualizar preferências (idioma, tema, timezone)
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário acessa aba Preferências em /user-settings"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida autenticação JWT"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema exibe formulário de preferências"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega idioma atual do localStorage"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário seleciona idioma no dropdown (pt-BR, en-US, es-ES)"
          required: true
        - id: "FP-UC03-006"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema aplica idioma via TranslocoService.setActiveLang()"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema salva preferência no localStorage (preferredLang)"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema atualiza toda interface imediatamente"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema exibe mensagem de confirmação no novo idioma"
          required: true
        - id: "FP-UC03-011"
          title: "Dropdown de idioma no header sincroniza automaticamente"
          required: true
        - id: "FA-UC03-001"
          title: "Idioma alterado pelo header - Sistema detecta via langChanges$"
          required: false
        - id: "FA-UC03-002"
          title: "Usuário cancela operação - Idioma não é alterado"
          required: false
        - id: "FE-UC03-001"
          title: "Idioma não suportado informado → Sistema faz fallback para pt-BR"
          required: true
        - id: "FE-UC03-002"
          title: "Token JWT expirado → Sistema retorna HTTP 401"
          required: true
        - id: "FE-UC03-003"
          title: "Erro ao salvar no localStorage → Sistema exibe aviso mas idioma aplicado"
          required: true

    precondicoes:
      - autenticacao: "jwt_valido"
      - estado_usuario: "active"

    gatilho: "Usuario acessa aba Preferencias e seleciona idioma"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_preferencias"
      - passo: 2
        ator: "sistema"
        acao: "validar_autenticacao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario_preferencias"
      - passo: 4
        ator: "sistema"
        acao: "carregar_idioma_localstorage"
      - passo: 5
        ator: "usuario"
        acao: "selecionar_idioma"
      - passo: 6
        ator: "usuario"
        acao: "clicar_salvar"
      - passo: 7
        ator: "sistema"
        acao: "aplicar_idioma_transloco"
      - passo: 8
        ator: "sistema"
        acao: "salvar_localstorage"
      - passo: 9
        ator: "sistema"
        acao: "atualizar_interface"
      - passo: 10
        ator: "sistema"
        acao: "exibir_confirmacao"
      - passo: 11
        ator: "sistema"
        acao: "sincronizar_header"

    fluxos_alternativos:
      - id: "FA-UC03-01"
        condicao: "idioma_alterado_header"
        resultado: "sincronizacao_automatica"
      - id: "FA-UC03-02"
        condicao: "cancelar_operacao"
        resultado: "idioma_nao_alterado"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "idioma_nao_suportado"
        resultado: "fallback_pt_br"
      - id: "FE-UC03-02"
        condicao: "token_expirado"
        resultado: "redirecionamento_login"
      - id: "FE-UC03-03"
        condicao: "erro_localstorage"
        resultado: "aviso_mas_idioma_aplicado"

    regras_aplicadas:
      - "RN-RF014-09"  # Persistência de idioma
      - "RN-RF014-10"  # Idiomas suportados
      - "RN-RF014-14"  # Sincronização de idioma
      - "RN-RF014-15"  # Usuário logado obrigatório
      - "RN-RF014-16"  # Isolamento de dados

    resultado_final:
      estado: "idioma_aplicado_sincronizado"

  - id: "UC04"
    nome: "Configurar Tema Visual"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF014-CRUD-04"  # Atualizar preferências (idioma, tema, timezone)
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário acessa aba Preferências em /user-settings"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida autenticação JWT"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema exibe formulário de preferências"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema carrega tema atual do localStorage"
          required: true
        - id: "FP-UC04-005"
          title: "Usuário seleciona tema no dropdown (light, dark, auto)"
          required: true
        - id: "FP-UC04-006"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema aplica tema visual (CSS variables, dark mode)"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema salva preferência no localStorage"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema atualiza interface imediatamente"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema exibe mensagem de confirmação"
          required: true
        - id: "FA-UC04-001"
          title: "Tema auto selecionado - Sistema detecta preferência do SO"
          required: false
        - id: "FA-UC04-002"
          title: "Usuário cancela operação - Tema não é alterado"
          required: false
        - id: "FE-UC04-001"
          title: "Tema inválido informado → Sistema faz fallback para light"
          required: true
        - id: "FE-UC04-002"
          title: "Token JWT expirado → Sistema retorna HTTP 401"
          required: true
        - id: "FE-UC04-003"
          title: "Erro ao salvar no localStorage → Sistema exibe aviso mas tema aplicado"
          required: true

    precondicoes:
      - autenticacao: "jwt_valido"
      - estado_usuario: "active"

    gatilho: "Usuario acessa aba Preferencias e seleciona tema"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_preferencias"
      - passo: 2
        ator: "sistema"
        acao: "validar_autenticacao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario_preferencias"
      - passo: 4
        ator: "sistema"
        acao: "carregar_tema_localstorage"
      - passo: 5
        ator: "usuario"
        acao: "selecionar_tema"
      - passo: 6
        ator: "usuario"
        acao: "clicar_salvar"
      - passo: 7
        ator: "sistema"
        acao: "aplicar_tema_visual"
      - passo: 8
        ator: "sistema"
        acao: "salvar_localstorage"
      - passo: 9
        ator: "sistema"
        acao: "atualizar_interface"
      - passo: 10
        ator: "sistema"
        acao: "exibir_confirmacao"

    fluxos_alternativos:
      - id: "FA-UC04-01"
        condicao: "tema_auto"
        resultado: "detectar_preferencia_so"
      - id: "FA-UC04-02"
        condicao: "cancelar_operacao"
        resultado: "tema_nao_alterado"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "tema_invalido"
        resultado: "fallback_light"
      - id: "FE-UC04-02"
        condicao: "token_expirado"
        resultado: "redirecionamento_login"
      - id: "FE-UC04-03"
        condicao: "erro_localstorage"
        resultado: "aviso_mas_tema_aplicado"

    regras_aplicadas:
      - "RN-RF014-11"  # Temas disponíveis
      - "RN-RF014-15"  # Usuário logado obrigatório
      - "RN-RF014-16"  # Isolamento de dados

    resultado_final:
      estado: "tema_aplicado_persistido"

  - id: "UC05"
    nome: "Configurar Timezone"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RF014-CRUD-04"  # Atualizar preferências (idioma, tema, timezone)
      uc_items:
        - id: "FP-UC05-001"
          title: "Usuário acessa aba Preferências em /user-settings"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema valida autenticação JWT"
          required: true
        - id: "FP-UC05-003"
          title: "Sistema exibe formulário de preferências"
          required: true
        - id: "FP-UC05-004"
          title: "Sistema carrega timezone atual do localStorage"
          required: true
        - id: "FP-UC05-005"
          title: "Usuário seleciona timezone no dropdown (lista IANA)"
          required: true
        - id: "FP-UC05-006"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC05-007"
          title: "Sistema aplica timezone em todas as datas/horas exibidas"
          required: true
        - id: "FP-UC05-008"
          title: "Sistema salva preferência no localStorage"
          required: true
        - id: "FP-UC05-009"
          title: "Sistema atualiza interface imediatamente"
          required: true
        - id: "FP-UC05-010"
          title: "Sistema exibe mensagem de confirmação"
          required: true
        - id: "FA-UC05-001"
          title: "Usuário cancela operação - Timezone não é alterado"
          required: false
        - id: "FE-UC05-001"
          title: "Timezone inválido informado → Sistema faz fallback para America/Sao_Paulo"
          required: true
        - id: "FE-UC05-002"
          title: "Token JWT expirado → Sistema retorna HTTP 401"
          required: true
        - id: "FE-UC05-003"
          title: "Erro ao salvar no localStorage → Sistema exibe aviso mas timezone aplicado"
          required: true

    precondicoes:
      - autenticacao: "jwt_valido"
      - estado_usuario: "active"

    gatilho: "Usuario acessa aba Preferencias e seleciona timezone"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_preferencias"
      - passo: 2
        ator: "sistema"
        acao: "validar_autenticacao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario_preferencias"
      - passo: 4
        ator: "sistema"
        acao: "carregar_timezone_localstorage"
      - passo: 5
        ator: "usuario"
        acao: "selecionar_timezone"
      - passo: 6
        ator: "usuario"
        acao: "clicar_salvar"
      - passo: 7
        ator: "sistema"
        acao: "aplicar_timezone"
      - passo: 8
        ator: "sistema"
        acao: "salvar_localstorage"
      - passo: 9
        ator: "sistema"
        acao: "atualizar_interface"
      - passo: 10
        ator: "sistema"
        acao: "exibir_confirmacao"

    fluxos_alternativos:
      - id: "FA-UC05-01"
        condicao: "cancelar_operacao"
        resultado: "timezone_nao_alterado"

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "timezone_invalido"
        resultado: "fallback_america_sao_paulo"
      - id: "FE-UC05-02"
        condicao: "token_expirado"
        resultado: "redirecionamento_login"
      - id: "FE-UC05-03"
        condicao: "erro_localstorage"
        resultado: "aviso_mas_timezone_aplicado"

    regras_aplicadas:
      - "RN-RF014-12"  # Timezones suportados
      - "RN-RF014-15"  # Usuário logado obrigatório
      - "RN-RF014-16"  # Isolamento de dados

    resultado_final:
      estado: "timezone_aplicado_persistido"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica orientada a contrato com rastreabilidade completa - 6 UCs cobrindo 100% das 16 RNs do RF014"
  - versao: "1.0"
    data: "2025-12-17"
    autor: "Sistema"
    descricao: "Versão inicial (consolidação de 3 casos de uso)"
