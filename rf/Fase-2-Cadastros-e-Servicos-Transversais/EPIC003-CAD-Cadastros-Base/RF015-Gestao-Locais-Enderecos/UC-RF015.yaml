# =============================================
# UC-RF015 - Casos de Uso: Gestão de Locais e Endereços
# Versão: 2.0
# Data: 2025-12-31
# Autor padrão: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF015"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Endereços"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-02"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a tela de Locais e Endereços"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema exibe listagem de endereços do conglomerado"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema exibe filtros disponíveis"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema exibe grid com colunas"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema implementa paginação"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por CEP"
          required: false
        - id: "FA-UC00-002"
          title: "Filtrar por Cidade/Estado"
          required: false
        - id: "FA-UC00-003"
          title: "Ordenar por coluna"
          required: false
        - id: "FA-UC00-004"
          title: "Exportar para Excel"
          required: false
        - id: "FE-UC00-001"
          title: "Sem permissão → acesso negado"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum resultado encontrado"
          required: true

    precondicoes:
      - permissao: "CAD.LOCAIS.VISUALIZAR"

    gatilho: "Usuario acessa a tela de Locais e Endereços"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_tela_locais"
      - passo: 2
        ator: "sistema"
        acao: "exibir_listagem_enderecos"
      - passo: 3
        ator: "sistema"
        acao: "aplicar_filtro_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_grid"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro_cep"
        resultado: "lista_filtrada_por_cep"
      - id: "FA-UC00-02"
        condicao: "usuario_aplica_filtro_cidade_estado"
        resultado: "lista_filtrada_por_localizacao"
      - id: "FA-UC00-03"
        condicao: "usuario_ordena_coluna"
        resultado: "lista_ordenada"
      - id: "FA-UC00-04"
        condicao: "usuario_exporta_excel"
        resultado: "arquivo_excel_gerado"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado_redirect_dashboard"
      - id: "FE-UC00-02"
        condicao: "nenhum_resultado"
        resultado: "exibir_mensagem_vazia"

    regras_aplicadas:
      - "RN-RF015-01"

    resultado_final:
      estado: "lista_enderecos_exibida"

  - id: "UC01"
    nome: "Criar Endereço"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-01"
        - "RF-VAL-01"
        - "RF-VAL-02"
        - "RF-VAL-03"
        - "RF-VAL-08"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Novo Endereço"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema exibe formulário"
          required: true
        - id: "FP-UC01-003"
          title: "Usuário preenche CEP"
          required: true
        - id: "FP-UC01-004"
          title: "Sistema consulta API ViaCEP"
          required: true
        - id: "FP-UC01-005"
          title: "Sistema preenche automaticamente campos"
          required: true
        - id: "FP-UC01-006"
          title: "Usuário preenche campos restantes"
          required: true
        - id: "FP-UC01-007"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema valida dados"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema salva endereço"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema exibe mensagem sucesso"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema redireciona para visualização"
          required: true
        - id: "FA-UC01-001"
          title: "CEP não encontrado na ViaCEP"
          required: false
        - id: "FA-UC01-002"
          title: "Marcar como endereço principal"
          required: false
        - id: "FA-UC01-003"
          title: "Geocodificar endereço"
          required: false
        - id: "FE-UC01-001"
          title: "CEP inválido"
          required: true
        - id: "FE-UC01-002"
          title: "Endereço duplicado"
          required: true
        - id: "FE-UC01-003"
          title: "Campos obrigatórios não preenchidos"
          required: true
        - id: "FE-UC01-004"
          title: "Sem permissão"
          required: true

    precondicoes:
      - permissao: "CAD.LOCAIS.CRIAR"

    gatilho: "Usuario clica em Novo Endereço"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_novo_endereco"
      - passo: 2
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 3
        ator: "usuario"
        acao: "preencher_cep"
      - passo: 4
        ator: "sistema"
        acao: "consultar_viacep"
      - passo: 5
        ator: "sistema"
        acao: "preencher_campos_automaticamente"
      - passo: 6
        ator: "usuario"
        acao: "preencher_campos_restantes"
      - passo: 7
        ator: "usuario"
        acao: "salvar"
      - passo: 8
        ator: "sistema"
        acao: "validar_dados"
      - passo: 9
        ator: "sistema"
        acao: "persistir_endereco"
      - passo: 10
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos:
      - id: "FA-UC01-01"
        condicao: "cep_nao_encontrado_viacep"
        resultado: "preenchimento_manual"
      - id: "FA-UC01-02"
        condicao: "marcar_endereco_principal"
        resultado: "desmarcar_principal_anterior"
      - id: "FA-UC01-03"
        condicao: "geocodificar_endereco"
        resultado: "latitude_longitude_preenchidas"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "cep_invalido"
        resultado: "exibir_erro_cep"
      - id: "FE-UC01-02"
        condicao: "endereco_duplicado"
        resultado: "exibir_erro_duplicado"
      - id: "FE-UC01-03"
        condicao: "campos_obrigatorios_vazios"
        resultado: "exibir_erros_validacao"
      - id: "FE-UC01-04"
        condicao: "sem_permissao"
        resultado: "acesso_negado"

    regras_aplicadas:
      - "RN-RF015-01"
      - "RN-RF015-02"
      - "RN-RF015-04"
      - "RN-RF015-05"
      - "RN-RF015-06"
      - "RN-RF015-07"
      - "RN-RF015-09"
      - "RN-RF015-10"

    resultado_final:
      estado: "endereco_criado"

  - id: "UC02"
    nome: "Visualizar Endereço"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-03"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário clica em Visualizar"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema exibe detalhes do endereço"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema exibe mapa com pin (se geocodificado)"
          required: false
        - id: "FP-UC02-004"
          title: "Sistema exibe hierarquia de locais"
          required: true

    precondicoes:
      - permissao: "CAD.LOCAIS.VISUALIZAR"

    gatilho: "Usuario clica em Visualizar na listagem"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_visualizar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_detalhes_endereco"
      - passo: 3
        ator: "sistema"
        acao: "exibir_hierarquia_locais"

    fluxos_alternativos: []

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "endereco_outro_tenant"
        resultado: "acesso_negado"

    regras_aplicadas:
      - "RN-RF015-03"

    resultado_final:
      estado: "detalhes_exibidos"

  - id: "UC03"
    nome: "Editar Endereço"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-04"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário acessa detalhes do endereço"
          required: true
        - id: "FP-UC03-002"
          title: "Usuário clica em Editar"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema exibe formulário preenchido"
          required: true
        - id: "FP-UC03-004"
          title: "Usuário altera campos"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema valida e atualiza"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema registra em histórico de auditoria"
          required: true

    precondicoes:
      - permissao: "CAD.LOCAIS.EDITAR"

    gatilho: "Usuario clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_editar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_formulario_preenchido"
      - passo: 3
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 4
        ator: "usuario"
        acao: "salvar"
      - passo: 5
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 6
        ator: "sistema"
        acao: "persistir_alteracoes"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos: []

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "alterar_endereco_outro_tenant"
        resultado: "acesso_negado"

    regras_aplicadas:
      - "RN-RF015-01"
      - "RN-RF015-08"
      - "RN-RF015-09"

    resultado_final:
      estado: "endereco_atualizado"

  - id: "UC04"
    nome: "Inativar Endereço"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-05"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário clica em Inativar"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema exibe modal de confirmação"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema alerta sobre impactos"
          required: true
        - id: "FP-UC04-004"
          title: "Usuário confirma"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema ativa soft delete"
          required: true
        - id: "FP-UC04-006"
          title: "Sistema inativa em cascata locais dependentes"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema registra em auditoria"
          required: true

    precondicoes:
      - permissao: "CAD.LOCAIS.EXCLUIR"

    gatilho: "Usuario clica em Inativar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_inativar"
      - passo: 2
        ator: "sistema"
        acao: "exibir_confirmacao"
      - passo: 3
        ator: "sistema"
        acao: "alertar_impactos"
      - passo: 4
        ator: "usuario"
        acao: "confirmar"
      - passo: 5
        ator: "sistema"
        acao: "soft_delete_endereco"
      - passo: 6
        ator: "sistema"
        acao: "inativar_cascata"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"

    fluxos_alternativos: []

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "ativos_ativos_nos_locais"
        resultado: "nao_permite_inativar"

    regras_aplicadas:
      - "RN-RF015-03"
      - "RN-RF015-08"

    resultado_final:
      estado: "endereco_inativado"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica orientada a contrato - adequada aos templates oficiais"
  - versao: "1.0"
    data: "2025-12-17"
    autor: "Sistema"
    descricao: "Consolidação inicial de 5 casos de uso"
