# RF-088: Aprovações e Workflows

**Versão**: 2.0
**Data**: 2025-12-31
**Autor**: Claude Code - Migração v1.0 → v2.0
**EPIC**: EPIC003-CAD-Cadastros-Base
**Fase**: Fase 2 - Cadastros e Serviços Transversais

---

## 1. OBJETIVO DO REQUISITO

Especificar o **módulo de Aprovações e Workflows** do sistema IControlIT, responsável por definir e executar processos de aprovação configuráveis para operações críticas do sistema.

O sistema permite que administradores criem workflows customizados com:
- Estados e transições condicionais
- Aprovações sequenciais ou paralelas
- Delegações com expiração automática
- SLA com escalação automática
- Notificações multi-canal (e-mail, SMS, in-app)
- Histórico imutável com auditoria de 7 anos (LGPD)

**Problema Resolvido**:
- Processos manuais e desorganizados de aprovação em planilhas
- Falta de rastreabilidade de quem aprovou, rejeitou ou delegou
- Ausência de SLA e alertas para aprovações vencidas
- Workflows estáticos sem flexibilidade configurável

Este documento **não define implementação** (linguagem, framework, UI), apenas **o que o sistema deve fazer**, sob quais condições e quais garantias devem ser preservadas.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] Designer visual de workflows (drag-and-drop, sem código)
- [x] Configuração de estados customizados (não hardcoded)
- [x] Transições condicionais (regras de negócio configuráveis)
- [x] Aprovação sequencial (um após o outro)
- [x] Aprovação paralela (múltiplos aprovadores com quórum)
- [x] Alçada de autorização (por valor, categoria, departamento)
- [x] Delegação de aprovação (temporária, com expiração)
- [x] SLA de aprovação (alertas T-24h, escalação T+0)
- [x] Notificações multi-canal (e-mail, SMS, in-app)
- [x] Histórico imutável (auditoria 7 anos LGPD)
- [x] Dashboard de pendências (por aprovador)
- [x] Controle de acesso RBAC + Policies dinâmicas
- [x] Isolamento multi-tenant (aprovações por empresa)
- [x] Auditoria completa de todas as operações

### 2.2 Fora do escopo (não objetivos)

- Interface visual específica (apenas contrato de API)
- Tecnologia, framework ou linguagem
- Layout, UX ou identidade visual
- Estratégia de deploy ou infraestrutura
- Aprovações em sistemas externos (integração futura)

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| **Workflow** | Sequência configurável de estados e transições que definem como um documento flui de um estado inicial até seu estado final |
| **Estado (Node)** | Situação na qual um documento pode estar em qualquer momento (Pendente, Aprovado, Rejeitado, Cancelado, Delegado, Vencido) |
| **Transição (Edge)** | Movimento permitido de um estado para outro (incondicional, condicional ou automática) |
| **Aprovador** | Usuário com permissão explícita para executar ação em um workflow (aprovar, rejeitar, delegar) |
| **Alçada** | Nível de autorização baseado em critério (valor, categoria, departamento). Ex: valores até R$ 50K aprovam gerentes; acima disso, diretores |
| **Delegação** | Aprovador transfere sua responsabilidade temporariamente para outro usuário, com data de expiração e auditoria completa |
| **SLA** | Prazo máximo para que uma aprovação seja executada. Se vencido, gera alerta e pode escalar automaticamente |
| **Histórico de Aprovação** | Registro imutável de todas as ações de aprovação: quem aprovou, quando, de que IP, que dados foram validados, e qual foi o resultado |
| **Quórum** | Número ou percentual mínimo de aprovadores que devem aprovar em aprovação paralela (todos, qualquer um, maioria, N de M) |
| **Escalação** | Transferência automática de responsabilidade de aprovação quando SLA vence (aprovador → supervisor) |
| **Transição Condicional** | Transição que só permite movimentação se condição for atendida (ex: valor < R$ 100K) |

---

## 4. FUNCIONALIDADES COBERTAS

### 4.1 Funcionalidades Críticas (Prioridade ALTA)

1. **Designer Visual de Workflows** - Interface drag-and-drop para criar estados, transições e condições sem código
2. **Configuração de Estados** - Criar estados customizados com ações on-entry e on-exit (notificar, gerar relatório, etc.)
3. **Transições Condicionais** - Definir regras que bloqueiam/permitem movimentação entre estados
4. **Aprovação Sequencial vs Paralela** - Suportar múltiplos aprovadores em série ou em paralelo
5. **Alçada de Autorização** - Aprovadores variáveis conforme valor, categoria ou departamento

### 4.2 Funcionalidades Importantes (Prioridade MÉDIA)

6. **Delegação de Aprovação** - Aprovador delega sua responsabilidade temporariamente a outro usuário
7. **SLA de Aprovação** - Prazo máximo, alertas, escalação automática quando SLA vence
8. **Notificações Multi-Canal** - E-mail, SMS e in-app com templates customizáveis
9. **Histórico Imutável** - Auditoria completa de todas as aprovações (7 anos retenção)
10. **Dashboard de Pendências** - Visualizar aprovações aguardando ação de cada aprovador

---

## 5. REGRAS DE NEGÓCIO

### RN-RF088-001 — Workflow deve ter pelo menos um estado inicial e um final

**Descrição**: Todo workflow criado deve ter obrigatoriamente um estado inicial (ponto de entrada) e um ou mais estados finais (onde documento fica em repouso permanente).

**Justificativa**: Garante que workflows são bem formados e que documentos podem ser criados e finalizados sem estado indeterminado.

**Critério de Aceite**:
- Workflow sem estado inicial → rejeição HTTP 400
- Workflow sem estado final → rejeição HTTP 400
- Estados finais não podem ter transições de saída

**Implementação**:
- Backend valida ao salvar workflow
- Frontend bloqueia salvamento se regra não atendida

**Exemplos**:
- ✓ Válido: Workflow com "Pendente Aprovação" (inicial) → "Aprovado" (final) → "Rejeitado" (final)
- ✗ Inválido: Workflow com apenas "Pendente" e "Em Análise" (nenhum estado final)

---

### RN-RF088-002 — Transição condicional deve bloquear movimento se condição não atende

**Descrição**: Quando uma transição é configurada com condição (ex: "valor < 100000"), o sistema deve bloquear a ação de aprovação se a condição não for atendida, retornando erro específico ao usuário.

**Justificativa**: Garante compliance com alçadas de autorização e regras de negócio configuradas.

**Critério de Aceite**:
- Condição não atendida → HTTP 400 com mensagem específica
- Condição atendida → transição permitida

**Implementação**:
- Avaliador de condições (ConditionEvaluator) processa expressão
- Expressão pode usar propriedades do documento (document.Amount, document.Category, etc.)
- Mensagem de falha configurável por transição

**Exemplos**:
- ✓ Transição "Aprovar se Valor < R$ 100K": usuário tenta aprovar NF de R$ 50K → sucesso
- ✗ Transição "Aprovar se Valor < R$ 100K": usuário tenta aprovar NF de R$ 150K → bloqueado com erro "Apenas gerente pode aprovar valores acima de R$ 100.000"

---

### RN-RF088-003 — Aprovação paralela requer quórum conforme configuração

**Descrição**: Quando uma transição é configurada com múltiplos aprovadores paralelos, a movimentação deve respeitar o quórum configurado: "qualquer um aprova", "todos devem aprovar", "2 de 3 aprovam", etc.

**Justificativa**: Permite workflows flexíveis onde nem sempre 100% dos aprovadores precisa concordar.

**Critério de Aceite**:
- Quórum não atingido → documento permanece em estado atual
- Qualquer rejeição (se configurado AnyRejectionBlocks) → bloqueia transição
- Quórum atingido → documento segue para próximo estado

**Tipos de Quórum**:
- **All**: Todos devem aprovar (rejeições = 0, aprovações = total aprovadores)
- **Any**: Qualquer um aprova (aprovações >= 1)
- **Majority**: Maioria aprova (aprovações > total / 2)
- **MinCount**: Mínimo N aprovações (ex: 2 de 3)

**Exemplos**:
- ✓ Config "Qualquer Um": 1 de 3 aprova → documento segue para próximo estado
- ✓ Config "Todos": todos 3 aprovam → documento segue
- ✗ Config "Todos": 2 de 3 aprovam, 1 rejeita → documento permanece em pendência

---

### RN-RF088-004 — Delegação deve respeitar data de expiração e ser auditada

**Descrição**: Quando um aprovador delega sua responsabilidade, a delegação é válida apenas até a data de expiração especificada. Após expiração, aprovações retornam ao aprovador original. Todas as delegações são registradas em auditoria.

**Justificativa**: Garante que ausências temporárias (férias, licença) não criam brechas de segurança permanentes. Auditoria garante conformidade LGPD.

**Critério de Aceite**:
- Delegação criada com data expiração no passado → HTTP 400
- Delegação ativa (CreatedAt <= hoje < ExpiresAt) → aprovações vão para delegado
- Delegação expirada (ExpiresAt <= hoje) → aprovações voltam ao aprovador original
- Todas as delegações registradas em AuditLog (operação: DELEGATION_CREATE, DELEGATION_EXPIRE)

**Auditoria Obrigatória**:
- Quem delegou (ApproverId)
- Para quem (DelegateUserId)
- Quando criou (CreatedAt)
- Quando expira (ExpiresAt)
- Motivo (Reason)
- IP de origem (IpAddress)

**Exemplos**:
- ✓ Aprovador A delega para B de 2025-01-01 a 2025-01-31. Em 2025-01-15, aprovações são atribuídas a B
- ✓ Data 2025-02-01, delegação expirou, aprovações retornam a A
- ✗ A tenta criar delegação para data no passado → rejeitado HTTP 400

---

### RN-RF088-005 — SLA de Aprovação dispara alerta em T-24h e escalação em T+0

**Descrição**: Cada aprovação pendente tem SLA configurado (ex: 48 horas). Sistema dispara alerta de e-mail em T-24h (24 horas antes do vencimento). Se SLA vence (T+0), aprovação é automaticamente escalada para supervisor do aprovador.

**Justificativa**: Evita aprovações travadas, garante SLA compliance e automatiza escalação sem intervenção manual.

**Critério de Aceite**:
- Aprovação criada com DeadlineAt = CreatedAt + SLA configurado
- T-24h: Alerta enviado ao aprovador se ainda pendente (email + SMS + in-app)
- T+0: Se ainda pendente, criar nova aprovação para supervisor
- Original marcada como EscalatedAt, EscalatedToUserId
- Auditoria registra operação SLA_ALERT_SENT e SLA_ESCALATION

**Exceções**:
- Aprovador sem supervisor configurado → alerta para administrador de sistema
- Aprovação concluída antes de T-24h → não envia alerta

**Exemplos**:
- ✓ Aprovação com SLA 48h criada em 2025-01-01 10:00. Alerta enviado em 2025-01-02 10:00 (T-24h)
- ✓ Se não aprovada até 2025-01-03 10:00, escalada automática para supervisor
- ✗ Nenhum alerta enviado se aprovação é concluída antes de T-24h

---

### RN-RF088-006 — Aprovador só pode exercer aprovação se tiver permissão RBAC explícita

**Descrição**: Um usuário só pode executar uma ação de aprovação se sua role incluir explicitamente a permissão `workflow:[recurso]:approve`. Mesmo que seja o aprovador designado no workflow, sem permissão RBAC não consegue executar.

**Justificativa**: Segregação de funções e conformidade. Garante que apenas usuários autorizados podem executar aprovações críticas.

**Critério de Aceite**:
- Usuário sem permissão tenta aprovar → HTTP 403 Forbidden
- Tentativa auditada com operação APPROVAL_UNAUTHORIZED_ATTEMPT
- Permissão validada ANTES de qualquer lógica de aprovação
- Policy baseada em regra dinâmica (não apenas Role estática)

**Permissões Necessárias**:
- `workflow:approval:approve` - Executar aprovação
- `workflow:approval:reject` - Rejeitar documento
- `workflow:delegation:create` - Criar delegação

**Exemplos**:
- ✓ Usuário com role "Gerente de Aprovações" e permissão `workflow:invoice:approve` consegue aprovar
- ✗ Usuário sem permissão `workflow:invoice:approve` tenta aprovar → Erro 403, operação auditada

---

### RN-RF088-007 — Estados finais são imutáveis; documentos não podem sair de estado final

**Descrição**: Quando um documento chega a um estado final (Aprovado, Rejeitado, Cancelado), ele permanece imutável. Não há transição de saída possível. Estados finais representam ponto de repouso permanente.

**Justificativa**: Garante integridade de documentos aprovados/rejeitados. Evita reaprovação de documentos finalizados.

**Critério de Aceite**:
- Tentativa de transição de estado final → HTTP 400 com mensagem "Documento em estado final '[Nome]' não pode transicionar"
- Estados finais têm propriedade IsFinal = true no banco
- Validação ocorre ANTES de qualquer lógica de aprovação

**Exemplos**:
- ✗ Documento em "Rejeitado" tenta ir para "Análise" → bloqueado HTTP 400
- ✗ Documento em "Finalizado" tenta ir para "Pendente" → bloqueado HTTP 400

---

### RN-RF088-008 — Notificações devem incluir contexto mínimo (Who, What, When, Why, How)

**Descrição**: Toda notificação enviada (e-mail, SMS, in-app) deve incluir informações essenciais: quem deve agir, qual é o documento/ação, prazo, por que está pendente e como tomar ação.

**Justificativa**: Reduz tempo de ciclo. Usuários não precisam voltar ao sistema para encontrar contexto. Melhora taxa de resposta a aprovações.

**Critério de Aceite**:
- Toda notificação DEVE conter:
  - **WHO**: Nome do aprovador
  - **WHAT**: Tipo e número do documento
  - **WHEN**: Prazo (DeadlineAt)
  - **WHY**: Motivo/justificativa da aprovação
  - **HOW**: Link direto para tela de aprovação

**Canais Suportados**:
- E-mail (templates Handlebars)
- SMS (mensagem curta, max 160 caracteres)
- In-app (push notification)

**Exemplos**:
- ✓ E-mail: "Olá José, você é o aprovador de NF #1234 (R$ 50.000, Acme Corp), prazo 30/12/2025 10:00, para validar POO. [Revisar Agora]"
- ✗ E-mail: "Você tem uma tarefa pendente" (sem contexto)

---

### RN-RF088-009 — Rejeição é irrevogável; documento volta ao estado anterior

**Descrição**: Quando um aprovador rejeita um documento em workflow, a rejeição é irrevogável e o documento retorna automaticamente ao estado imediatamente anterior (ou ao estado especificado na transição de rejeição). O documento pode ser reenviado para aprovação após correções.

**Justificativa**: Garante que rejeições não são acidentais (ex: não há "desfazer rejeição"). Força revisão antes de reenviar.

**Critério de Aceite**:
- Rejeição marca ApprovalInstance com Status = Rejected, CanBeUndone = false
- Documento transiciona para estado anterior ou estado configurado em transition.OnRejection
- Requisitante notificado com motivo da rejeição
- Operação APPROVAL_REJECTED auditada com IP, usuário, timestamp, motivo

**Exemplos**:
- ✓ NF rejeitada por valor inconsistente. Requisitante ajusta e reenvia
- ✗ Usuário tenta "desfazer" rejeição → não é possível (bloqueado no backend)

---

### RN-RF088-010 — Histórico de Aprovação deve ser imutável e conservado 7 anos (LGPD)

**Descrição**: Uma vez criada, uma entrada no histórico de aprovação (AuditAprovacao) nunca pode ser alterada ou deletada. Deleção física é proibida. Dados de aprovação devem ser retidos por mínimo 7 anos para conformidade LGPD (lei 13.709/2018).

**Justificativa**: Conformidade LGPD. Garante rastreabilidade irreversível e permite investigações futuras de operações. Imutabilidade previne manipulação de registros.

**Critério de Aceite**:
- Tabela AuditAprovacao não tem UPDATE ou DELETE
- Campos BeforeData e AfterData são private set (imutáveis)
- Soft delete proibido (DeletedAt não utilizado)
- Index em ActionDateTime para busca rápida
- Retenção de 7 anos configurada em política de banco

**Auditoria Completa**:
- ApprovalInstanceId
- DocumentId
- UserId (quem aprovou/rejeitou)
- Result (Approved, Rejected, Delegated)
- ActionDateTime
- IpAddress
- UserAgent
- Comments
- BeforeData (JSON do estado anterior)
- AfterData (JSON do estado atual)

**Exemplos**:
- ✓ Histórico de aprovação de NF criado em 2025-01-01, retido até 2032-01-01 (7 anos)
- ✗ Nenhuma operação DELETE no histórico de aprovação
- ✗ Nenhuma operação UPDATE nos registros de auditoria já criados

---

## 6. ESTADOS DA ENTIDADE

### 6.1 Estados de Workflow (WorkflowDefinition)

| Estado | Descrição |
|--------|-----------|
| Draft | Workflow em edição, não publicado |
| Active | Workflow ativo, pode ser usado em aprovações |
| Inactive | Workflow desativado temporariamente |
| Archived | Workflow arquivado (apenas histórico) |

### 6.2 Estados de Instância de Aprovação (ApprovalInstance)

| Estado | Descrição |
|--------|-----------|
| Pending | Aguardando ação do aprovador |
| Approved | Aprovado pelo aprovador |
| Rejected | Rejeitado pelo aprovador |
| Delegated | Delegado para outro usuário |
| Escalated | SLA vencido, escalado para supervisor |
| Expired | SLA vencido sem escalação |

### 6.3 Transições Permitidas (WorkflowDefinition)

| De | Para | Condição |
|----|------|----------|
| Draft | Active | Validação completa (estados inicial/final existem) |
| Active | Inactive | Desativação manual |
| Inactive | Active | Reativação manual |
| Active | Archived | Arquivamento manual (não pode voltar) |

### 6.4 Transições Permitidas (ApprovalInstance)

| De | Para | Condição |
|----|------|----------|
| Pending | Approved | Aprovador executa aprovação + permissão RBAC |
| Pending | Rejected | Aprovador executa rejeição + permissão RBAC |
| Pending | Delegated | Aprovador cria delegação ativa |
| Pending | Escalated | SLA vencido + supervisor existe |
| Delegated | Approved | Delegado executa aprovação |
| Delegated | Rejected | Delegado executa rejeição |
| Escalated | Approved | Supervisor executa aprovação |
| Escalated | Rejected | Supervisor executa rejeição |

**Estados Finais (não podem transicionar)**:
- Approved (final)
- Rejected (final)
- Expired (final)

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre | Payload |
|--------|---------------|---------|
| `workflow.created` | Após criação de workflow | WorkflowId, Name, CreatedBy |
| `workflow.updated` | Após atualização de workflow | WorkflowId, ChangedFields |
| `workflow.deleted` | Após deleção lógica de workflow | WorkflowId, DeletedBy, Reason |
| `approval.created` | Após criação de aprovação | ApprovalId, DocumentId, ApproverId, DeadlineAt |
| `approval.approved` | Após aprovação de documento | ApprovalId, DocumentId, ApprovedBy, Timestamp |
| `approval.rejected` | Após rejeição de documento | ApprovalId, DocumentId, RejectedBy, Reason |
| `delegation.created` | Após criação de delegação | DelegationId, ApproverId, DelegateUserId, ExpiresAt |
| `delegation.expired` | Quando delegação expira | DelegationId, ApproverId, ExpiresAt |
| `sla.alert_sent` | Quando alerta SLA é enviado (T-24h) | ApprovalId, ApproverId, DeadlineAt |
| `sla.escalated` | Quando SLA vence e escalação ocorre | ApprovalId, EscalatedTo, Reason |

**Consumidores de Eventos**:
- Sistema de Notificações (e-mail, SMS, in-app)
- Dashboard de Pendências
- Relatórios de SLA Compliance
- Integração com sistemas externos (futuro)

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

### 8.1 Segurança

- ✓ Nenhuma operação pode violar isolamento de tenant (EmpresaId)
- ✓ Nenhuma regra de negócio pode ser ignorada
- ✓ Erros devem ser previsíveis e rastreáveis
- ✓ Auditoria deve registrar quem, quando e o que mudou
- ✓ Validação de entrada obrigatória em todos os endpoints
- ✓ Proteção contra SQL Injection (parameterized queries)
- ✓ Proteção contra XSS (sanitização de inputs)
- ✓ Proteção contra CSRF (tokens em formulários)
- ✓ Rate limiting (máx 100 aprovações/min por usuário)
- ✓ HTTPS/TLS obrigatório
- ✓ Senhas/tokens nunca em URL

### 8.2 Performance

- ✓ Dashboard de pendências < 2s (query time)
- ✓ Aprovação/rejeição < 500ms (latência)
- ✓ Notificação delivery rate > 99%
- ✓ SLA compliance > 95%

### 8.3 Auditoria

- ✓ Todas as operações auditadas (LGPD)
- ✓ Retenção de 7 anos (mínimo)
- ✓ Histórico imutável (sem UPDATE/DELETE)
- ✓ IP, UserAgent, Timestamp obrigatórios

### 8.4 Multi-tenancy

- ✓ Workflows isolados por empresa (EmpresaId)
- ✓ Aprovações isoladas por empresa
- ✓ Delegações isoladas por empresa
- ✓ Histórico isolado por empresa

---

## 9. INTEGRAÇÕES OBRIGATÓRIAS

### 9.1 Central de Funcionalidades (Feature Flags)

**FeatureKey**: `WORKFLOW_APPROVALS`

**Subfeatures**:
- `WORKFLOW_DESIGNER` - Designer Visual de Workflows
- `WORKFLOW_SLA` - SLA de Aprovação com Escalação
- `WORKFLOW_PARALLEL_APPROVAL` - Aprovação Paralela com Quórum
- `WORKFLOW_NOTIFICATIONS` - Notificações Multi-Canal

**Nota**: Feature pode ser desabilitada globalmente ou por subfeature para controle granular em ambientes de teste.

### 9.2 Internacionalização (i18n)

**Chaves Obrigatórias**:
- `workflows.common.*` - Termos gerais (workflow, state, transition, approval, etc.)
- `workflows.designer.*` - Designer de workflows (createWorkflow, addState, addTransition, etc.)
- `workflows.approvals.*` - Aprovações (pending, approve, reject, delegate, etc.)
- `workflows.delegations.*` - Delegações (create, delegateTo, expiresAt, etc.)
- `workflows.sla.*` - SLA (deadline, escalated, slaBreached, etc.)
- `workflows.messages.*` - Mensagens de sucesso/erro
- `workflows.validation.*` - Mensagens de validação
- `workflows.errors.*` - Mensagens de erro

**Idiomas**: pt-BR (primário), en-US, es-ES

### 9.3 Auditoria

**Operações Auditadas**:

| Operação | Código | Dados Registrados |
|----------|--------|-------------------|
| Criar Workflow | `WFL_WORKFLOW_CREATE` | Nome, estados, transições, criador, timestamp |
| Atualizar Workflow | `WFL_WORKFLOW_UPDATE` | Campos alterados (before/after), usuário, IP |
| Deletar Workflow | `WFL_WORKFLOW_DELETE` | ID workflow, usuário, razão, IP |
| Criar Aprovação | `WFL_APPROVAL_CREATE` | Documento, aprovadores, SLA, criador, timestamp |
| Aprovar | `WFL_APPROVAL_APPROVE` | Aprovação ID, aprovador, comentários, IP, timestamp |
| Rejeitar | `WFL_APPROVAL_REJECT` | Aprovação ID, rejeitador, motivo, IP, timestamp |
| Delegar | `WFL_DELEGATION_CREATE` | De quem, para quem, data expiração, motivo, IP |
| Reverter Delegação | `WFL_DELEGATION_REVOKE` | ID delegação, quem revogou, motivo, IP |
| Escalar | `WFL_SLA_ESCALATE` | Aprovação ID, escalado para, motivo (SLA vencido), timestamp |
| Tentativa Não Autorizada | `WFL_APPROVAL_UNAUTHORIZED_ATTEMPT` | Usuário, documento, razão negação, IP |

**Retenção**: 7 anos (conforme LGPD Lei 13.709/2018)

### 9.4 Controle de Acesso (RBAC)

**Permissões**:

| Permissão | Descrição | Perfis |
|-----------|-----------|--------|
| `workflow:design:create` | Criar workflows | Administrador, Analista Processos |
| `workflow:design:read` | Visualizar workflows | Todos |
| `workflow:design:update` | Editar workflows | Administrador, Analista Processos |
| `workflow:design:delete` | Deletar workflows | Administrador |
| `workflow:approval:read` | Visualizar aprovações | Todos |
| `workflow:approval:approve` | Executar aprovação | Aprovadores (role-based) |
| `workflow:approval:reject` | Rejeitar documento | Aprovadores (role-based) |
| `workflow:delegation:create` | Criar delegação | Aprovadores |
| `workflow:delegation:revoke` | Revogar delegação própria | Todos (sua delegação) |
| `workflow:delegation:admin` | Revogar delegação de outros | Administrador |
| `workflow:dashboard:view` | Visualizar dashboard de pendências | Todos |
| `workflow:sla:configure` | Configurar SLA | Administrador |
| `workflow:sla:view` | Visualizar SLA compliance | Analista, Administrador |

**Nota Crítica - Policy vs Role**:

Aprovações usam **Policy (regra dinâmica)**, não apenas **Role (perfil estático)**. Policy avalia regras de negócio em tempo de execução (aprovador designado + permissão RBAC).

---

## 10. ARTEFATOS DERIVADOS

Este RF é base para:

- **UC-RF088.md** (Casos de Uso)
  - UC00-RF088 - Listar workflows
  - UC01-RF088 - Criar workflow
  - UC02-RF088 - Visualizar workflow
  - UC03-RF088 - Editar workflow
  - UC04-RF088 - Excluir workflow
  - UC05-RF088 - Executar aprovação
  - UC06-RF088 - Criar delegação
  - UC07-RF088 - Visualizar pendências

- **MD-RF088.md** (Modelo de Dados)
  - Tabela: WorkflowDefinition
  - Tabela: State
  - Tabela: Transition
  - Tabela: ApprovalInstance
  - Tabela: ApprovalDelegation
  - Tabela: AuditAprovacao
  - Tabela: SlaConfiguration

- **WF-RF088.md** (Workflows e Telas)
  - Tela: Designer de Workflows (drag-and-drop)
  - Tela: Minhas Aprovações
  - Tela: Dashboard de Pendências
  - Tela: Gerenciar Delegações

- **TC-RF088-BACKEND.md** (Casos de Teste - Backend)
- **TC-RF088-FRONTEND.md** (Casos de Teste - Frontend)
- **TC-RF088-SEGURANCA.md** (Casos de Teste - Segurança)
- **TC-RF088-E2E.md** (Casos de Teste - E2E)

---

## 11. RASTREABILIDADE

| Artefato | Status | Gerado |
|----------|--------|--------|
| RF-088.md (v2.0) | ✓ Completo | 2025-12-31 |
| RF-088.yaml | ⏳ Pendente | - |
| RL-RF088.md | ⏳ Pendente | - |
| RL-RF088.yaml | ⏳ Pendente | - |
| UC-RF088.md | ⏳ Pendente | - |
| MD-RF088.md | ⏳ Pendente | - |
| WF-RF088.md | ⏳ Pendente | - |
| TC-RF088-*.md | ⏳ Pendente | - |

**Dependências**:
- RF-088 não depende de outros RFs (funcionalidade standalone)
- Outros RFs podem usar workflows (RF-Financeiro, RF-Contratos, RF-Service-Desk)

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 1.0 | 2025-12-28 | Versão inicial - RF088 completo com 9 seções | Claude Code |
| 2.0 | 2025-12-31 | Migração v1.0 → v2.0 (separação RF/RL, 11 seções template v2.0) | Claude Code - Migração |

---

**Última Atualização**: 2025-12-31
**Versão Governança**: 2.0
**Status**: Completo - Pronto para UC, MD, WF
**Próximo**: Criar RL-RF088.md (memória técnica do legado)
