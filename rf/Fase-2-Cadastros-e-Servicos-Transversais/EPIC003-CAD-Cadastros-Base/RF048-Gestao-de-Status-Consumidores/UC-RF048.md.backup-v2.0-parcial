# UC-RF048 — Casos de Uso Canônicos

**RF:** RF048 — Gestão de Status de Consumidores
**Versão:** 2.0
**Data:** 2025-12-31
**Autor:** Agência ALC - alc.dev.br
**Epic:** EPIC003-CAD-Cadastros-Base
**Fase:** Fase 2 - Cadastros e Serviços Transversais

---

## 1. OBJETIVO

Este documento especifica os **Casos de Uso** do **RF048 — Gestão de Status de Consumidores**, cobrindo gerenciamento de ciclo de vida através de estados (Ativo, Inativo, Bloqueado, Suspenso, Pendente), workflow de transições, aprovações multi-nível, processamento em lote e integração com faturamento.

**Escopo:**
- Configuração CRUD de status de consumidores
- Mudança de status individual com validação de workflow
- Aprovação/rejeição de transições críticas
- Processamento em lote de mudanças (até 1.000 registros)
- Histórico completo de transições (7 anos LGPD)
- Dashboard tempo real com SignalR
- Integração com faturamento e políticas

---

## 2. SUMÁRIO DOS CASOS DE USO

| UC | Nome | Ator Principal | Tipo | Impacta Dados |
|----|------|----------------|------|---------------|
| **UC00** | Listar Configurações de Status | `usuario_autenticado` | Leitura | Não |
| **UC01** | Criar Configuração de Status | `admin_sistema` | Escrita | Sim |
| **UC02** | Visualizar Configuração de Status | `usuario_autenticado` | Leitura | Não |
| **UC03** | Editar Configuração de Status | `admin_sistema` | Escrita | Sim |
| **UC04** | Inativar Configuração de Status | `admin_sistema` | Escrita | Sim |

**NOTA IMPORTANTE**: Este RF possui complexidade elevada com 12 UCs funcionais completos especificados no RF048.yaml (UC00-UC11 incluindo workflow, aprovações, lote, histórico, dashboard e relatórios). Esta versão documenta os 5 UCs CRUD básicos obrigatórios. Recomenda-se expandir para documentação completa dos 12 UCs via `icontrolit-architect` agent.

---

## 3. PADRÕES GERAIS APLICÁVEIS A TODOS OS UCs

### 3.1 Multi-Tenancy (Isolamento de Fornecedor)

**Regra:** Todos os UCs filtram por `Id_Fornecedor` do usuário autenticado.

**Implementação:**
- Queries: `WHERE Id_Fornecedor = @UsuarioFornecedorId AND Fl_Ativo = 1`
- Acesso cruzado → HTTP 403

### 3.2 Controle de Acesso (RBAC)

**Permissões:**
- `GESTAO.STATUS_CONSUMIDORES.VIEW` - Visualizar status
- `GESTAO.STATUS_CONSUMIDORES.CHANGE` - Mudar status
- `GESTAO.STATUS_CONSUMIDORES.APPROVE` - Aprovar mudanças críticas
- `GESTAO.STATUS_CONSUMIDORES.ADMIN` - Gerenciar configurações
- `GESTAO.STATUS_CONSUMIDORES.VIEW_HISTORY` - Histórico
- `GESTAO.STATUS_CONSUMIDORES.PROCESS_BATCH` - Lote

### 3.3 Auditoria Automática

**Operações auditadas:**
- CREATE, UPDATE, DELETE (configurações)
- CHANGE_STATUS (mudança de status consumidor)
- APPROVE, REJECT (aprovações)
- BATCH_PROCESS (processamento em lote)

**Retenção:** 7 anos (LGPD)

### 3.4 Internacionalização (i18n)

**Chaves:** `status_consumidores.*`
**Idiomas:** pt-BR, en-US, es-ES

---

## 4. CASOS DE USO

### UC00 — Listar Configurações de Status

**Objetivo:** Listar configurações de status cadastradas no tenant.

**Pré-condições:**
- Usuário autenticado
- Permissão `GESTAO.STATUS_CONSUMIDORES.VIEW`

**Fluxo Principal:**
1. Usuário acessa `/gestao/status-consumidores/configuracoes`
2. Sistema valida permissão
3. Sistema carrega registros do tenant (Id_Fornecedor)
4. Sistema aplica paginação (25 registros/página)
5. Sistema exibe grid com: Nome, Descrição, Cor, Estados Obrigatórios, Qt Consumidores, Fl_Ativo

**Fluxos Alternativos:** Nenhum

**Fluxos de Exceção:**
- **FE-UC00-001:** Sem permissão → HTTP 403

**Cobertura:**
- RF048-CRUD-02

---

### UC01 — Criar Configuração de Status

**Objetivo:** Cadastrar nova configuração de status.

**Pré-condições:**
- Usuário autenticado
- Permissão `GESTAO.STATUS_CONSUMIDORES.ADMIN`

**Fluxo Principal:**
1. Usuário acessa formulário de criação
2. Sistema valida permissão
3. Usuário preenche campos obrigatórios
4. Sistema valida dados
5. Sistema cria configuração
6. Sistema registra auditoria (CREATE)
7. Sistema retorna HTTP 201

**Campos Obrigatórios:**
- Nome (único por tenant)
- Estados Obrigatórios (Ativo, Inativo, Bloqueado, Suspenso, Pendente)

**Fluxos de Exceção:**
- **FE-UC01-001:** Nome duplicado → HTTP 400

**Cobertura:**
- RF048-CRUD-01
- RF048-VAL-01

---

### UC02 — Visualizar Configuração de Status

**Objetivo:** Visualizar detalhes de configuração específica.

**Pré-condições:**
- Usuário autenticado
- Permissão `GESTAO.STATUS_CONSUMIDORES.VIEW`

**Fluxo Principal:**
1. Usuário clica em registro ou acessa `/configuracoes/{id}`
2. Sistema valida permissão e tenant
3. Sistema carrega configuração + dados relacionados
4. Sistema exibe abas: Resumo, Transições Permitidas, Histórico

**Fluxos de Exceção:**
- **FE-UC02-001:** Registro não encontrado ou de outro tenant → HTTP 404

**Cobertura:**
- RF048-CRUD-03

---

### UC03 — Editar Configuração de Status

**Objetivo:** Atualizar configuração existente.

**Pré-condições:**
- Usuário autenticado
- Permissão `GESTAO.STATUS_CONSUMIDORES.ADMIN`

**Fluxo Principal:**
1. Usuário edita campos
2. Sistema valida permissão
3. Sistema valida dados
4. Sistema atualiza configuração
5. Sistema registra auditoria (UPDATE)
6. Sistema retorna HTTP 200

**Fluxos de Exceção:**
- **FE-UC03-001:** Estados obrigatórios não podem ser removidos → HTTP 400

**Cobertura:**
- RF048-CRUD-04

---

### UC04 — Inativar Configuração de Status

**Objetivo:** Desativar configuração via soft delete.

**Pré-condições:**
- Usuário autenticado
- Permissão `GESTAO.STATUS_CONSUMIDORES.ADMIN`

**Fluxo Principal:**
1. Usuário clica em "Inativar"
2. Sistema valida permissão
3. Sistema valida se há consumidores vinculados
4. Sistema marca Fl_Ativo = 0
5. Sistema registra auditoria (DELETE)
6. Sistema retorna HTTP 200

**Fluxos de Exceção:**
- **FE-UC04-001:** Configuração com consumidores ativos → HTTP 400

**Cobertura:**
- RF048-CRUD-05

---

## 5. MATRIZ DE RASTREABILIDADE

### 5.1 Cobertura RF → UC (Parcial - CRUD Básico)

| Item RF | Título | Coberto por UC |
|---------|--------|----------------|
| RF048-CRUD-01 | Criar configuração | UC01 |
| RF048-CRUD-02 | Listar status | UC00 |
| RF048-CRUD-03 | Visualizar status | UC02 |
| RF048-CRUD-04 | Atualizar configuração | UC03 |
| RF048-CRUD-05 | Inativar configuração | UC04 |

**Cobertura CRUD:** 100% (5/5)
**Cobertura Funcionalidades Específicas:** 0% (0/11) - **PENDENTE EXPANSÃO**
**Cobertura Validações:** 20% (1/5) - **PENDENTE EXPANSÃO**
**Cobertura Segurança:** 60% (3/5) - **PENDENTE EXPANSÃO**

**⚠️ ATENÇÃO:** Este UC cobre apenas operações CRUD básicas. RF048 especifica 12 UCs completos incluindo:
- UC05: Mudar Status Individual
- UC06: Aprovar Mudança
- UC07: Rejeitar Mudança
- UC08: Processar Lote
- UC09: Consultar Histórico
- UC10: Dashboard Tempo Real
- UC11: Relatório Ciclo de Vida

Recomenda-se executar `icontrolit-architect` agent para gerar documentação completa dos 12 UCs.

---

## 6. CHANGELOG

### v2.0 — 2025-12-31
- **Migração v1.0 → v2.0**: Conformidade com template canônico
- **Adicionado**: Metadados Epic, Fase, Autor
- **Adicionado**: Seção "PADRÕES GERAIS"
- **Limitação**: Apenas 5 UCs CRUD básicos documentados (de 12 esperados)
- **Pendente**: Expansão para 12 UCs completos com workflow, aprovações, lote, dashboard

### v1.0 — 2025-12-18
- Versão inicial simplificada (6 UCs superficiais)
