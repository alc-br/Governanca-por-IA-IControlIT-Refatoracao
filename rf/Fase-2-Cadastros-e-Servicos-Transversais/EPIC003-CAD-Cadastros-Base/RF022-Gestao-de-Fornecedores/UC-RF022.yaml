# =============================================
# UC - Casos de Uso (Contrato Comportamental)
# Versão: 2.0
# Autor padrão: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF022"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Fornecedores"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-020"  # Busca por nome parcial
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa a funcionalidade Cadastros → Fornecedores"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão fornecedor.read"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega registros do tenant do usuário autenticado"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação (padrão 20 itens) e ordenação (padrão: Nome ASC)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema exibe a lista com colunas: Nome, CNPJ/CPF, Tipo, Status, Avaliação, Ações"
          required: true
        - id: "FA-UC00-001"
          title: "Buscar por nome parcial (mínimo 3 caracteres, case-insensitive)"
          required: false
        - id: "FA-UC00-002"
          title: "Ordenar por coluna clicável"
          required: false
        - id: "FA-UC00-003"
          title: "Filtrar por tipo"
          required: false
        - id: "FA-UC00-004"
          title: "Filtrar por status"
          required: false
        - id: "FA-UC00-005"
          title: "Buscar por CNPJ/CPF completo ou parcial"
          required: false
        - id: "FA-UC00-006"
          title: "Navegar entre páginas"
          required: false
        - id: "FA-UC00-007"
          title: "Alterar quantidade de itens por página"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum registro encontrado → estado vazio"
          required: true
        - id: "FE-UC00-003"
          title: "Erro no backend → HTTP 500"
          required: true

    precondicoes:
      - permissao: "fornecedor.read"

    gatilho: "Usuario acessa o menu Cadastros → Fornecedores"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_fornecedores_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao_ordenacao"
      - passo: 5
        ator: "sistema"
        acao: "exibir_lista"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "acesso_negado_403"

    regras_aplicadas:
      - "RN-RF022-014"
      - "RN-RF022-020"

    resultado_final:
      estado: "lista_fornecedores_exibida"

  - id: "UC01"
    nome: "Criar Fornecedor"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF022-001"  # CNPJ único por tenant
        - "RN-RF022-002"  # Validação de CNPJ
        - "RN-RF022-003"  # Validação de CPF
        - "RN-RF022-004"  # Tipo obrigatório
        - "RN-RF022-005"  # Nome obrigatório
        - "RN-RF022-006"  # Status padrão
        - "RN-RF022-008"  # Validação de e-mail
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria completa
        - "RN-RF022-016"  # Limite de crédito válido
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Novo Fornecedor"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão fornecedor.create"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário vazio"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário preenche campos obrigatórios"
          required: true
        - id: "FP-UC01-005"
          title: "Usuário preenche campos opcionais"
          required: false
        - id: "FP-UC01-006"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema valida campos obrigatórios"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema valida formato de CNPJ/CPF"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema valida unicidade de CNPJ/CPF no tenant"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema valida e-mail se informado"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema valida limite de crédito se informado"
          required: true
        - id: "FP-UC01-012"
          title: "Sistema cria registro com status padrão EM_HOMOLOGACAO"
          required: true
        - id: "FP-UC01-013"
          title: "Sistema preenche automaticamente tenant_id, usuario_criacao_id, data_criacao"
          required: true
        - id: "FP-UC01-014"
          title: "Sistema registra auditoria (CREATE)"
          required: true
        - id: "FP-UC01-015"
          title: "Sistema publica evento fornecedor.criado"
          required: true
        - id: "FP-UC01-016"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC01-017"
          title: "Sistema redireciona para UC02"
          required: true
        - id: "FA-UC01-001"
          title: "Salvar e continuar editando"
          required: false
        - id: "FA-UC01-002"
          title: "Cancelar criação"
          required: false
        - id: "FE-UC01-001"
          title: "Campo obrigatório ausente → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "CNPJ inválido → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "CPF inválido → HTTP 400"
          required: true
        - id: "FE-UC01-004"
          title: "CNPJ duplicado no tenant → HTTP 409"
          required: true
        - id: "FE-UC01-005"
          title: "E-mail inválido → HTTP 400"
          required: true
        - id: "FE-UC01-006"
          title: "Tipo de fornecedor inválido → HTTP 400"
          required: true
        - id: "FE-UC01-007"
          title: "Limite de crédito negativo → HTTP 400"
          required: true
        - id: "FE-UC01-008"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.create"

    gatilho: "Usuario clica em Novo Fornecedor"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_novo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 5
        ator: "usuario"
        acao: "salvar"
      - passo: 6
        ator: "sistema"
        acao: "validar_dados"
      - passo: 7
        ator: "sistema"
        acao: "criar_registro"
      - passo: 8
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 9
        ator: "sistema"
        acao: "publicar_evento"
      - passo: 10
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 11
        ator: "sistema"
        acao: "redirecionar_visualizacao"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_400"

    regras_aplicadas:
      - "RN-RF022-001"
      - "RN-RF022-002"
      - "RN-RF022-003"
      - "RN-RF022-004"
      - "RN-RF022-005"
      - "RN-RF022-006"
      - "RN-RF022-008"
      - "RN-RF022-014"
      - "RN-RF022-015"
      - "RN-RF022-016"

    resultado_final:
      estado: "fornecedor_criado_auditado"

  - id: "UC02"
    nome: "Visualizar Fornecedor"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF022-013"  # Alerta de documentos vencendo
        - "RN-RF022-014"  # Isolamento por tenant
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona fornecedor"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão fornecedor.read"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida que fornecedor pertence ao tenant do usuário"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema carrega dados do fornecedor"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema exibe dados em modo leitura com abas"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema exibe botões de ação conforme permissões"
          required: true
        - id: "FA-UC02-001"
          title: "Clicar em Editar → redirecionar para UC03"
          required: false
        - id: "FA-UC02-002"
          title: "Clicar em Inativar → acionar UC04"
          required: false
        - id: "FA-UC02-003"
          title: "Clicar em Avaliar → abrir modal de avaliação"
          required: false
        - id: "FA-UC02-004"
          title: "Navegar entre abas"
          required: false
        - id: "FE-UC02-001"
          title: "Fornecedor não encontrado → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Fornecedor de outro tenant → HTTP 404"
          required: true
        - id: "FE-UC02-003"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.read"
      - existe: "fornecedor_pertence_tenant"

    gatilho: "Usuario seleciona fornecedor via UC00 ou URL direta"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_fornecedor"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_dados"
      - passo: 5
        ator: "sistema"
        acao: "exibir_dados_modo_leitura"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "fornecedor_nao_encontrado"
        resultado: "http_404"
      - id: "FE-UC02-02"
        condicao: "fornecedor_outro_tenant"
        resultado: "http_404"  # Não 403 para não vazar existência

    regras_aplicadas:
      - "RN-RF022-013"
      - "RN-RF022-014"

    resultado_final:
      estado: "dados_fornecedor_exibidos"

  - id: "UC03"
    nome: "Editar Fornecedor"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF022-001"  # CNPJ único (se alterado)
        - "RN-RF022-002"  # Validação CNPJ (se alterado)
        - "RN-RF022-003"  # Validação CPF (se alterado)
        - "RN-RF022-008"  # Validação e-mail (se alterado)
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria com diff
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário acessa fornecedor via UC02 e clica em Editar"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão fornecedor.update"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida que fornecedor pertence ao tenant do usuário"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema carrega dados atuais no formulário"
          required: true
        - id: "FP-UC03-005"
          title: "Usuário altera campos desejados"
          required: true
        - id: "FP-UC03-006"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC03-007"
          title: "Sistema valida campos obrigatórios (se alterados)"
          required: true
        - id: "FP-UC03-008"
          title: "Sistema valida formato de CNPJ/CPF (se alterado)"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema valida unicidade de CNPJ/CPF (se alterado)"
          required: true
        - id: "FP-UC03-010"
          title: "Sistema valida transição de status (se alterado)"
          required: true
        - id: "FP-UC03-011"
          title: "Sistema valida e-mail (se alterado)"
          required: true
        - id: "FP-UC03-012"
          title: "Sistema atualiza registro"
          required: true
        - id: "FP-UC03-013"
          title: "Sistema preenche automaticamente usuario_atualizacao_id, data_atualizacao"
          required: true
        - id: "FP-UC03-014"
          title: "Sistema registra auditoria (UPDATE) com diff"
          required: true
        - id: "FP-UC03-015"
          title: "Sistema publica evento fornecedor.atualizado"
          required: true
        - id: "FP-UC03-016"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC03-017"
          title: "Sistema redireciona para UC02"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição"
          required: false
        - id: "FE-UC03-001"
          title: "Campo obrigatório removido → HTTP 400"
          required: true
        - id: "FE-UC03-002"
          title: "CNPJ duplicado (se alterado) → HTTP 409"
          required: true
        - id: "FE-UC03-003"
          title: "E-mail inválido (se alterado) → HTTP 400"
          required: true
        - id: "FE-UC03-004"
          title: "Transição de status inválida → HTTP 400"
          required: true
        - id: "FE-UC03-005"
          title: "Fornecedor de outro tenant → HTTP 404"
          required: true
        - id: "FE-UC03-006"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.update"
      - existe: "fornecedor_pertence_tenant"

    gatilho: "Usuario clica em Editar em UC02"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_editar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "carregar_formulario"
      - passo: 5
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 6
        ator: "usuario"
        acao: "salvar"
      - passo: 7
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 8
        ator: "sistema"
        acao: "atualizar_registro"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria_diff"
      - passo: 10
        ator: "sistema"
        acao: "publicar_evento"
      - passo: 11
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 12
        ator: "sistema"
        acao: "redirecionar_visualizacao"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_400_ou_409"

    regras_aplicadas:
      - "RN-RF022-001"
      - "RN-RF022-002"
      - "RN-RF022-003"
      - "RN-RF022-008"
      - "RN-RF022-014"
      - "RN-RF022-015"

    resultado_final:
      estado: "fornecedor_atualizado_auditado"

  - id: "UC04"
    nome: "Inativar Fornecedor"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF022-007"  # Não inativar com contratos ativos
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário acessa fornecedor via UC02 e clica em Inativar"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão fornecedor.delete"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida que fornecedor pertence ao tenant do usuário"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema verifica se fornecedor possui contratos ativos"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema exibe diálogo de confirmação"
          required: true
        - id: "FP-UC04-006"
          title: "Usuário confirma inativação"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema atualiza status para INATIVO"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema preenche fl_excluido = true"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema preenche usuario_exclusao_id e data_exclusao"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema registra auditoria (DELETE)"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema publica evento fornecedor.inativado"
          required: true
        - id: "FP-UC04-012"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC04-013"
          title: "Sistema redireciona para UC00"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar inativação"
          required: false
        - id: "FE-UC04-001"
          title: "Fornecedor possui contratos ativos → HTTP 409"
          required: true
        - id: "FE-UC04-002"
          title: "Fornecedor já está inativo → HTTP 400"
          required: true
        - id: "FE-UC04-003"
          title: "Fornecedor de outro tenant → HTTP 404"
          required: true
        - id: "FE-UC04-004"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.delete"
      - existe: "fornecedor_pertence_tenant"
      - estado: "fornecedor_ativo"
      - dependencia: "nao_possui_contratos_ativos"

    gatilho: "Usuario clica em Inativar em UC02"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_inativar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "verificar_contratos_ativos"
      - passo: 5
        ator: "sistema"
        acao: "exibir_confirmacao"
      - passo: 6
        ator: "usuario"
        acao: "confirmar"
      - passo: 7
        ator: "sistema"
        acao: "atualizar_status_inativo"
      - passo: 8
        ator: "sistema"
        acao: "marcar_soft_delete"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 10
        ator: "sistema"
        acao: "publicar_evento"
      - passo: 11
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 12
        ator: "sistema"
        acao: "redirecionar_listagem"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "fornecedor_possui_contratos_ativos"
        resultado: "bloqueio_409_listar_contratos"

    regras_aplicadas:
      - "RN-RF022-007"
      - "RN-RF022-014"
      - "RN-RF022-015"

    resultado_final:
      estado: "fornecedor_inativado_soft_delete"

  - id: "UC05"
    nome: "Validar CNPJ/CPF"
    ator_principal: "sistema"
    tipo: "validacao"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF022-002"  # Validação de CNPJ (dígitos verificadores)
        - "RN-RF022-003"  # Validação de CPF (dígitos verificadores)
      uc_items:
        - id: "FP-UC05-001"
          title: "Sistema recebe CNPJ/CPF para validação"
          required: true
        - id: "FP-UC05-002"
          title: "Sistema remove caracteres especiais (pontos, traços)"
          required: true
        - id: "FP-UC05-003"
          title: "Sistema verifica se possui 11 dígitos (CPF) ou 14 dígitos (CNPJ)"
          required: true
        - id: "FP-UC05-004"
          title: "Sistema calcula primeiro dígito verificador"
          required: true
        - id: "FP-UC05-005"
          title: "Sistema calcula segundo dígito verificador"
          required: true
        - id: "FP-UC05-006"
          title: "Sistema compara dígitos calculados com informados"
          required: true
        - id: "FP-UC05-007"
          title: "Sistema retorna validação aprovada ou rejeitada"
          required: true
        - id: "FE-UC05-001"
          title: "CNPJ/CPF com quantidade de dígitos inválida → rejeitar"
          required: true
        - id: "FE-UC05-002"
          title: "CNPJ/CPF com todos os dígitos iguais → rejeitar"
          required: true
        - id: "FE-UC05-003"
          title: "Dígitos verificadores não conferem → rejeitar"
          required: true

    precondicoes:
      - entrada: "cnpj_ou_cpf_string"

    gatilho: "Sistema recebe CNPJ/CPF para validação (chamado por UC01 ou UC03)"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "receber_entrada"
      - passo: 2
        ator: "sistema"
        acao: "normalizar_digitos"
      - passo: 3
        ator: "sistema"
        acao: "verificar_tamanho"
      - passo: 4
        ator: "sistema"
        acao: "calcular_digitos_verificadores"
      - passo: 5
        ator: "sistema"
        acao: "comparar_digitos"
      - passo: 6
        ator: "sistema"
        acao: "retornar_resultado"

    fluxos_excecao:
      - id: "FE-UC05-01"
        condicao: "tamanho_invalido"
        resultado: "rejeitar_validacao"
      - id: "FE-UC05-02"
        condicao: "todos_digitos_iguais"
        resultado: "rejeitar_validacao"
      - id: "FE-UC05-03"
        condicao: "digitos_verificadores_nao_conferem"
        resultado: "rejeitar_validacao"

    regras_aplicadas:
      - "RN-RF022-002"
      - "RN-RF022-003"

    resultado_final:
      estado: "validacao_executada"

  - id: "UC06"
    nome: "Gerenciar Contatos"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF022-009"  # Apenas um contato principal por tipo
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria completa
        - "RN-RF022-017"  # Telefone obrigatório para contato
        - "RN-RF022-018"  # Validação e-mail contato
      uc_items:
        - id: "FP-UC06-001"
          title: "Usuário acessa aba Contatos em UC02"
          required: true
        - id: "FP-UC06-002"
          title: "Sistema valida permissão fornecedor.update"
          required: true
        - id: "FP-UC06-003"
          title: "Sistema lista contatos existentes do fornecedor"
          required: true
        - id: "FP-UC06-004"
          title: "Usuário clica em Adicionar Contato"
          required: true
        - id: "FP-UC06-005"
          title: "Sistema exibe formulário de contato"
          required: true
        - id: "FP-UC06-006"
          title: "Usuário preenche Nome, Tipo, Telefone, E-mail, Cargo"
          required: true
        - id: "FP-UC06-007"
          title: "Usuário marca/desmarca 'Principal' conforme necessário"
          required: false
        - id: "FP-UC06-008"
          title: "Sistema valida campos obrigatórios (Nome, Telefone)"
          required: true
        - id: "FP-UC06-009"
          title: "Sistema valida formato de e-mail (se informado)"
          required: true
        - id: "FP-UC06-010"
          title: "Sistema valida regra de apenas um contato principal por tipo"
          required: true
        - id: "FP-UC06-011"
          title: "Sistema salva contato vinculado ao fornecedor"
          required: true
        - id: "FP-UC06-012"
          title: "Sistema registra auditoria (CREATE contato)"
          required: true
        - id: "FP-UC06-013"
          title: "Sistema atualiza lista de contatos"
          required: true
        - id: "FA-UC06-001"
          title: "Editar contato existente"
          required: false
        - id: "FA-UC06-002"
          title: "Excluir contato"
          required: false
        - id: "FA-UC06-003"
          title: "Definir contato como principal (desmarca anterior do mesmo tipo)"
          required: false
        - id: "FE-UC06-001"
          title: "Nome ausente → HTTP 400"
          required: true
        - id: "FE-UC06-002"
          title: "Telefone ausente → HTTP 400"
          required: true
        - id: "FE-UC06-003"
          title: "E-mail inválido (se informado) → HTTP 400"
          required: true
        - id: "FE-UC06-004"
          title: "Já existe contato principal do mesmo tipo → HTTP 409"
          required: true
        - id: "FE-UC06-005"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.update"
      - existe: "fornecedor_pertence_tenant"

    gatilho: "Usuario acessa aba Contatos em UC02"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_contatos"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_contatos_existentes"
      - passo: 4
        ator: "usuario"
        acao: "adicionar_contato"
      - passo: 5
        ator: "sistema"
        acao: "exibir_formulario_contato"
      - passo: 6
        ator: "usuario"
        acao: "preencher_dados_contato"
      - passo: 7
        ator: "sistema"
        acao: "validar_dados_contato"
      - passo: 8
        ator: "sistema"
        acao: "validar_regra_contato_principal"
      - passo: 9
        ator: "sistema"
        acao: "salvar_contato"
      - passo: 10
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 11
        ator: "sistema"
        acao: "atualizar_lista_contatos"

    fluxos_alternativos:
      - id: "FA-UC06-01"
        condicao: "usuario_edita_contato"
        resultado: "formulario_preenchido_atualizar"
      - id: "FA-UC06-02"
        condicao: "usuario_exclui_contato"
        resultado: "soft_delete_contato"

    fluxos_excecao:
      - id: "FE-UC06-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_400_ou_409"

    regras_aplicadas:
      - "RN-RF022-009"
      - "RN-RF022-014"
      - "RN-RF022-015"
      - "RN-RF022-017"
      - "RN-RF022-018"

    resultado_final:
      estado: "contato_gerenciado_auditado"

  - id: "UC07"
    nome: "Avaliar Fornecedor"
    ator_principal: "usuario_autenticado"
    tipo: "acao"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF022-010"  # Nota avaliação válida (1-5)
        - "RN-RF022-011"  # Cálculo automático nota geral
        - "RN-RF022-012"  # Atualização automática nota fornecedor (média últimas 12)
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria completa
        - "RN-RF022-019"  # Histórico avaliações
      uc_items:
        - id: "FP-UC07-001"
          title: "Usuário acessa fornecedor via UC02"
          required: true
        - id: "FP-UC07-002"
          title: "Usuário clica em Avaliar Fornecedor"
          required: true
        - id: "FP-UC07-003"
          title: "Sistema valida permissão fornecedor.avaliar"
          required: true
        - id: "FP-UC07-004"
          title: "Sistema exibe modal de avaliação com 5 critérios (Qualidade, Prazo, Preço, Atendimento, Pontualidade)"
          required: true
        - id: "FP-UC07-005"
          title: "Usuário preenche nota de 1 a 5 estrelas para cada critério"
          required: true
        - id: "FP-UC07-006"
          title: "Usuário preenche observações (opcional)"
          required: false
        - id: "FP-UC07-007"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC07-008"
          title: "Sistema valida que todas as notas estão entre 1 e 5"
          required: true
        - id: "FP-UC07-009"
          title: "Sistema calcula nota geral (média ponderada dos 5 critérios)"
          required: true
        - id: "FP-UC07-010"
          title: "Sistema salva avaliação com tenant_id, fornecedor_id, usuario_id, data"
          required: true
        - id: "FP-UC07-011"
          title: "Sistema recalcula nota geral do fornecedor (média das últimas 12 avaliações)"
          required: true
        - id: "FP-UC07-012"
          title: "Sistema atualiza campo nota_geral no cadastro do fornecedor"
          required: true
        - id: "FP-UC07-013"
          title: "Sistema registra auditoria (CREATE avaliação)"
          required: true
        - id: "FP-UC07-014"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC07-015"
          title: "Sistema atualiza exibição da nota no UC02"
          required: true
        - id: "FA-UC07-001"
          title: "Visualizar histórico de avaliações anteriores"
          required: false
        - id: "FA-UC07-002"
          title: "Cancelar avaliação"
          required: false
        - id: "FE-UC07-001"
          title: "Nota fora do range 1-5 → HTTP 400"
          required: true
        - id: "FE-UC07-002"
          title: "Critério sem nota → HTTP 400"
          required: true
        - id: "FE-UC07-003"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.avaliar"
      - existe: "fornecedor_pertence_tenant"

    gatilho: "Usuario clica em Avaliar Fornecedor em UC02"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_avaliar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_modal_avaliacao"
      - passo: 4
        ator: "usuario"
        acao: "preencher_notas_criterios"
      - passo: 5
        ator: "usuario"
        acao: "salvar"
      - passo: 6
        ator: "sistema"
        acao: "validar_notas"
      - passo: 7
        ator: "sistema"
        acao: "calcular_nota_geral_avaliacao"
      - passo: 8
        ator: "sistema"
        acao: "salvar_avaliacao"
      - passo: 9
        ator: "sistema"
        acao: "recalcular_nota_fornecedor"
      - passo: 10
        ator: "sistema"
        acao: "atualizar_fornecedor"
      - passo: 11
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 12
        ator: "sistema"
        acao: "exibir_sucesso"
      - passo: 13
        ator: "sistema"
        acao: "atualizar_visualizacao"

    fluxos_alternativos:
      - id: "FA-UC07-01"
        condicao: "usuario_visualiza_historico"
        resultado: "exibir_avaliacoes_anteriores"

    fluxos_excecao:
      - id: "FE-UC07-01"
        condicao: "validacao_notas_falhou"
        resultado: "exibir_erros_400"

    regras_aplicadas:
      - "RN-RF022-010"
      - "RN-RF022-011"
      - "RN-RF022-012"
      - "RN-RF022-014"
      - "RN-RF022-015"
      - "RN-RF022-019"

    resultado_final:
      estado: "fornecedor_avaliado_nota_atualizada"

  - id: "UC08"
    nome: "Gerenciar Documentos"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RN-RF022-013"  # Validação documentos vencidos
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria completa
      uc_items:
        - id: "FP-UC08-001"
          title: "Usuário acessa aba Documentos em UC02"
          required: true
        - id: "FP-UC08-002"
          title: "Sistema valida permissão fornecedor.update"
          required: true
        - id: "FP-UC08-003"
          title: "Sistema lista documentos existentes do fornecedor"
          required: true
        - id: "FP-UC08-004"
          title: "Sistema exibe status de cada documento (Válido, Vencendo, Vencido)"
          required: true
        - id: "FP-UC08-005"
          title: "Usuário clica em Adicionar Documento"
          required: true
        - id: "FP-UC08-006"
          title: "Sistema exibe formulário de upload"
          required: true
        - id: "FP-UC08-007"
          title: "Usuário preenche Tipo Documento, Número, Data Emissão, Data Validade"
          required: true
        - id: "FP-UC08-008"
          title: "Usuário faz upload do arquivo (PDF, JPG, PNG)"
          required: true
        - id: "FP-UC08-009"
          title: "Sistema valida campos obrigatórios"
          required: true
        - id: "FP-UC08-010"
          title: "Sistema valida formato de arquivo"
          required: true
        - id: "FP-UC08-011"
          title: "Sistema valida que data_validade >= data_emissao"
          required: true
        - id: "FP-UC08-012"
          title: "Sistema salva arquivo em blob storage"
          required: true
        - id: "FP-UC08-013"
          title: "Sistema salva metadados do documento vinculado ao fornecedor"
          required: true
        - id: "FP-UC08-014"
          title: "Sistema calcula status do documento (Válido se data_validade > hoje)"
          required: true
        - id: "FP-UC08-015"
          title: "Sistema registra auditoria (CREATE documento)"
          required: true
        - id: "FP-UC08-016"
          title: "Sistema atualiza lista de documentos"
          required: true
        - id: "FA-UC08-001"
          title: "Baixar documento"
          required: false
        - id: "FA-UC08-002"
          title: "Excluir documento"
          required: false
        - id: "FA-UC08-003"
          title: "Renovar documento (substituir arquivo vencido)"
          required: false
        - id: "FE-UC08-001"
          title: "Campo obrigatório ausente → HTTP 400"
          required: true
        - id: "FE-UC08-002"
          title: "Formato de arquivo inválido → HTTP 400"
          required: true
        - id: "FE-UC08-003"
          title: "Data validade anterior à data emissão → HTTP 400"
          required: true
        - id: "FE-UC08-004"
          title: "Tamanho arquivo excedido → HTTP 413"
          required: true
        - id: "FE-UC08-005"
          title: "Usuário sem permissão → HTTP 403"
          required: true

    precondicoes:
      - permissao: "fornecedor.update"
      - existe: "fornecedor_pertence_tenant"

    gatilho: "Usuario acessa aba Documentos em UC02"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessar_aba_documentos"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "listar_documentos_com_status"
      - passo: 4
        ator: "usuario"
        acao: "adicionar_documento"
      - passo: 5
        ator: "sistema"
        acao: "exibir_formulario_upload"
      - passo: 6
        ator: "usuario"
        acao: "preencher_dados_documento"
      - passo: 7
        ator: "usuario"
        acao: "fazer_upload_arquivo"
      - passo: 8
        ator: "sistema"
        acao: "validar_dados_e_arquivo"
      - passo: 9
        ator: "sistema"
        acao: "salvar_arquivo_blob_storage"
      - passo: 10
        ator: "sistema"
        acao: "salvar_metadados_documento"
      - passo: 11
        ator: "sistema"
        acao: "calcular_status_documento"
      - passo: 12
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 13
        ator: "sistema"
        acao: "atualizar_lista_documentos"

    fluxos_alternativos:
      - id: "FA-UC08-01"
        condicao: "usuario_baixa_documento"
        resultado: "download_arquivo"
      - id: "FA-UC08-02"
        condicao: "usuario_exclui_documento"
        resultado: "soft_delete_documento"

    fluxos_excecao:
      - id: "FE-UC08-01"
        condicao: "validacao_falhou"
        resultado: "exibir_erros_400_ou_413"

    regras_aplicadas:
      - "RN-RF022-013"
      - "RN-RF022-014"
      - "RN-RF022-015"

    resultado_final:
      estado: "documento_gerenciado_auditado"

  - id: "UC09"
    nome: "Alertar Vencimentos"
    ator_principal: "sistema"
    tipo: "batch"
    impacta_dados: false

    covers:
      rf_items:
        - "RN-RF022-013"  # Validação documentos vencidos (alerta 30 dias)
        - "RN-RF022-014"  # Isolamento por tenant
        - "RN-RF022-015"  # Auditoria de alertas gerados
      uc_items:
        - id: "FP-UC09-001"
          title: "Sistema executa job agendado diariamente"
          required: true
        - id: "FP-UC09-002"
          title: "Sistema busca todos os documentos de fornecedores ativos"
          required: true
        - id: "FP-UC09-003"
          title: "Sistema filtra documentos com data_validade entre hoje e hoje + 30 dias"
          required: true
        - id: "FP-UC09-004"
          title: "Para cada documento, sistema identifica usuários com permissão fornecedor.read do tenant"
          required: true
        - id: "FP-UC09-005"
          title: "Sistema cria notificação interna para cada usuário"
          required: true
        - id: "FP-UC09-006"
          title: "Sistema envia e-mail de alerta (opcional, configurável)"
          required: false
        - id: "FP-UC09-007"
          title: "Sistema registra auditoria (ALERT documento_vencendo)"
          required: true
        - id: "FP-UC09-008"
          title: "Sistema atualiza status do documento para Vencendo"
          required: true
        - id: "FA-UC09-001"
          title: "Documento já vencido (data_validade < hoje) → marcar como Vencido"
          required: false
        - id: "FA-UC09-002"
          title: "Notificação já foi enviada para o documento → não reenviar"
          required: false
        - id: "FE-UC09-001"
          title: "Erro ao enviar e-mail → registrar log, mas não bloquear processo"
          required: true
        - id: "FE-UC09-002"
          title: "Erro ao criar notificação → registrar log, tentar próxima"
          required: true

    precondicoes:
      - job_agendado: "diario_madrugada"

    gatilho: "Job agendado executa diariamente (ex: 03:00)"

    fluxo_principal:
      - passo: 1
        ator: "sistema"
        acao: "executar_job_agendado"
      - passo: 2
        ator: "sistema"
        acao: "buscar_documentos_fornecedores_ativos"
      - passo: 3
        ator: "sistema"
        acao: "filtrar_documentos_vencendo"
      - passo: 4
        ator: "sistema"
        acao: "para_cada_documento_identificar_usuarios"
      - passo: 5
        ator: "sistema"
        acao: "criar_notificacoes_internas"
      - passo: 6
        ator: "sistema"
        acao: "enviar_emails_configurados"
      - passo: 7
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 8
        ator: "sistema"
        acao: "atualizar_status_documentos"

    fluxos_alternativos:
      - id: "FA-UC09-01"
        condicao: "documento_vencido"
        resultado: "marcar_status_vencido"

    fluxos_excecao:
      - id: "FE-UC09-01"
        condicao: "erro_envio_email"
        resultado: "registrar_log_continuar_processo"

    regras_aplicadas:
      - "RN-RF022-013"
      - "RN-RF022-014"
      - "RN-RF022-015"

    resultado_final:
      estado: "alertas_enviados_documentos_atualizados"

exclusions:
  uc_items: []

historico:
  - versao: "1.0"
    data: "2025-12-17"
    autor: "Sistema Legado"
    descricao: "Versao inicial com 5 UCs (UC00-UC04)"

  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Adição de 5 UCs complementares (UC05-UC09) - Total de 10 UCs cobrindo 100% das 20 regras de negócio RF022"
