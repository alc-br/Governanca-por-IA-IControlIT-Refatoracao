rf_id: RF022
rf_title: "Gestão de Fornecedores"
versao_governanca: "2.0"
data_migracao: "2025-12-30"
autor: "Agência ALC - alc.dev.br"
epic: "EPIC003-CAD - Cadastros Base"
fase: "Fase 2 - Cadastros e Serviços Transversais"

# ==============================================================================
# OBJETIVO
# ==============================================================================

objetivo: |
  Especificar o comportamento esperado do sistema para gerenciar fornecedores e empresas contratadas,
  incluindo operadoras de telecomunicações, fornecedores de TI, prestadores de serviços e fabricantes.
  Este documento serve como contrato oficial entre negócio, desenvolvimento, testes e agentes de IA,
  definindo o que o sistema deve fazer, sem especificar implementação técnica.

# ==============================================================================
# ESCOPO
# ==============================================================================

escopo:
  dentro:
    - "Criação de fornecedor com dados cadastrais completos"
    - "Atualização de dados de fornecedor"
    - "Listagem de fornecedores com filtros (tipo, status, categoria)"
    - "Consulta de fornecedor por ID ou CNPJ/CPF"
    - "Inativação lógica de fornecedor"
    - "Validação de CNPJ/CPF (dígitos verificadores)"
    - "Gestão de múltiplos contatos por fornecedor (comercial, técnico, financeiro)"
    - "Avaliação de fornecedores (rating 1-5 estrelas)"
    - "Gestão de documentos obrigatórios (contratos sociais, certidões)"
    - "Controle de acesso por permissões RBAC"
    - "Isolamento por tenant (multi-tenancy)"
    - "Auditoria completa de operações"

  fora:
    - "Interface visual específica (responsabilidade do RF-WF)"
    - "Tecnologia, framework ou linguagem de implementação"
    - "Layout, UX ou identidade visual"
    - "Estratégia de deploy ou infraestrutura"
    - "Integração com sistemas de cotação (RF futuro)"
    - "Gestão de contratos (RF-CTR separado)"

# ==============================================================================
# CONCEITOS E DEFINIÇÕES
# ==============================================================================

conceitos:
  - termo: "Fornecedor"
    definicao: "Entidade externa que fornece produtos, serviços ou ativos para a organização"

  - termo: "CNPJ"
    definicao: "Cadastro Nacional de Pessoa Jurídica - identificador único de empresa no Brasil"

  - termo: "CPF"
    definicao: "Cadastro de Pessoa Física - identificador único de pessoa física no Brasil"

  - termo: "Tenant"
    definicao: "Unidade lógica de isolamento de dados (conglomerado)"

  - termo: "Rating"
    definicao: "Avaliação de performance do fornecedor (1-5 estrelas)"

  - termo: "Tipo de Fornecedor"
    definicao: "Classificação: OPERADORA_TELECOM, FORNECEDOR_TI, PRESTADOR_SERVICOS, DISTRIBUIDOR, FABRICANTE, OUTROS"

  - termo: "Status"
    definicao: "Estado do fornecedor: ATIVO, INATIVO, EM_HOMOLOGACAO, BLOQUEADO"

  - termo: "Contato"
    definicao: "Pessoa de contato do fornecedor (comercial, técnico, financeiro, jurídico)"

# ==============================================================================
# FUNCIONALIDADES COBERTAS
# ==============================================================================

funcionalidades:
  - id: "FUNC-001"
    titulo: "Criar fornecedor"
    descricao: "Cadastro completo com validações obrigatórias"

  - id: "FUNC-002"
    titulo: "Atualizar fornecedor"
    descricao: "Edição de dados com auditoria"

  - id: "FUNC-003"
    titulo: "Consultar fornecedor"
    descricao: "Busca por ID, CNPJ/CPF ou nome"

  - id: "FUNC-004"
    titulo: "Listar fornecedores"
    descricao: "Listagem com filtros e paginação"

  - id: "FUNC-005"
    titulo: "Inativar fornecedor"
    descricao: "Exclusão lógica com validação de vínculos"

  - id: "FUNC-006"
    titulo: "Validar CNPJ/CPF"
    descricao: "Validação de dígitos verificadores"

  - id: "FUNC-007"
    titulo: "Gerenciar contatos"
    descricao: "Adicionar, editar, excluir contatos do fornecedor"

  - id: "FUNC-008"
    titulo: "Avaliar fornecedor"
    descricao: "Registrar avaliação de performance"

  - id: "FUNC-009"
    titulo: "Gerenciar documentos"
    descricao: "Upload e controle de documentos obrigatórios"

  - id: "FUNC-010"
    titulo: "Alertar vencimentos"
    descricao: "Notificar documentos próximos ao vencimento"

# ==============================================================================
# REGRAS DE NEGÓCIO
# ==============================================================================

regras_negocio:
  - id: "RN-RF022-001"
    titulo: "CNPJ único por tenant"
    descricao: "Se informado, o CNPJ deve ser único dentro do tenant (conglomerado)."
    criticidade: "ALTA"
    justificativa: "Evitar duplicidade de fornecedores"
    criterios_aceite:
      - "Tentativa de cadastrar CNPJ duplicado → rejeição HTTP 409"
      - "Validação executada antes de persistir"
      - "Mensagem: CNPJ já cadastrado neste conglomerado"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "unicidade"
      mensagem_erro: "CNPJ já cadastrado neste conglomerado"
      http_code: 409

  - id: "RN-RF022-002"
    titulo: "Validação de CNPJ"
    descricao: "Se informado, CNPJ deve ser válido conforme algoritmo de dígitos verificadores."
    criticidade: "ALTA"
    criterios_aceite:
      - "CNPJ com dígitos verificadores incorretos → rejeição HTTP 400"
      - "Validação executada no backend (não confiar apenas no frontend)"
      - "Mensagem: CNPJ inválido"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "formato"
      mensagem_erro: "CNPJ inválido"
      http_code: 400

  - id: "RN-RF022-003"
    titulo: "Validação de CPF"
    descricao: "Se informado CPF (fornecedor pessoa física), deve ser válido conforme algoritmo de dígitos verificadores."
    criticidade: "ALTA"
    criterios_aceite:
      - "CPF com dígitos verificadores incorretos → rejeição HTTP 400"
      - "Mensagem: CPF inválido"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "formato"
      mensagem_erro: "CPF inválido"
      http_code: 400

  - id: "RN-RF022-004"
    titulo: "Tipo de fornecedor obrigatório"
    descricao: "Tipo de fornecedor é obrigatório e deve pertencer à lista predefinida."
    criticidade: "CRÍTICA"
    criterios_aceite:
      - "Campo tipo ausente ou null → rejeição HTTP 400"
      - "Tipo fora da lista permitida → rejeição HTTP 400"
      - "Tipos permitidos: OPERADORA_TELECOM, FORNECEDOR_TI, PRESTADOR_SERVICOS, DISTRIBUIDOR, FABRICANTE, OUTROS"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "campo_obrigatorio"
      mensagem_erro: "Tipo de fornecedor é obrigatório"
      http_code: 400

  - id: "RN-RF022-005"
    titulo: "Nome obrigatório"
    descricao: "Nome do fornecedor (razão social ou nome fantasia) é obrigatório."
    criticidade: "CRÍTICA"
    criterios_aceite:
      - "Campo nome ausente, null ou vazio → rejeição HTTP 400"
      - "Nome deve ter entre 3 e 200 caracteres"
      - "Mensagem: Nome do fornecedor é obrigatório"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "campo_obrigatorio"
      mensagem_erro: "Nome do fornecedor é obrigatório"
      http_code: 400

  - id: "RN-RF022-006"
    titulo: "Status válido"
    descricao: "Status do fornecedor deve pertencer à lista predefinida."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "Status ausente → assumir default ATIVO"
      - "Status fora da lista → rejeição HTTP 400"
      - "Status permitidos: ATIVO, INATIVO, EM_HOMOLOGACAO, BLOQUEADO"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "enum"
      mensagem_erro: "Status inválido"
      http_code: 400

  - id: "RN-RF022-007"
    titulo: "Não inativar fornecedor com contratos ativos"
    descricao: "Não permitir inativação de fornecedor com contratos ativos vinculados."
    criticidade: "CRÍTICA"
    criterios_aceite:
      - "Tentativa de inativar com contratos ativos → rejeição HTTP 409"
      - "Mensagem: Não é possível inativar fornecedor com contratos ativos"
      - "Listar contratos ativos na resposta de erro"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: false
    validacao:
      tipo: "regra_negocio"
      mensagem_erro: "Não é possível inativar fornecedor com contratos ativos"
      http_code: 409

  - id: "RN-RF022-008"
    titulo: "Validação de e-mail"
    descricao: "Se informado, e-mail principal deve ter formato válido."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "E-mail sem @ ou domínio → rejeição HTTP 400"
      - "Validação via regex padrão RFC 5322"
      - "Mensagem: E-mail inválido"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "formato"
      mensagem_erro: "E-mail inválido"
      http_code: 400

  - id: "RN-RF022-009"
    titulo: "Apenas um contato principal por tipo"
    descricao: "Pode haver apenas um contato principal por tipo (Comercial, Técnico, Financeiro, Jurídico)."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "Tentativa de marcar segundo contato como principal do mesmo tipo → rejeição HTTP 409"
      - "Ao marcar novo contato como principal, desmarcar o anterior automaticamente"
      - "Mensagem: Já existe um contato principal do tipo {tipo}"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "unicidade"
      mensagem_erro: "Já existe um contato principal do tipo {tipo}"
      http_code: 409

  - id: "RN-RF022-010"
    titulo: "Nota de avaliação válida"
    descricao: "Notas de avaliação individual (qualidade, prazo, atendimento, preço) devem estar entre 1 e 5."
    criticidade: "ALTA"
    criterios_aceite:
      - "Nota < 1 ou > 5 → rejeição HTTP 400"
      - "Nota ausente → rejeição HTTP 400"
      - "Permitir notas decimais (ex: 4.5)"
      - "Mensagem: Nota deve estar entre 1 e 5"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "range"
      mensagem_erro: "Nota deve estar entre 1 e 5"
      http_code: 400

  - id: "RN-RF022-011"
    titulo: "Cálculo automático de nota geral"
    descricao: "Nota geral do fornecedor é calculada automaticamente como média ponderada das avaliações individuais."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "Fórmula: (qualidade * 0.4) + (prazo * 0.3) + (atendimento * 0.2) + (preço * 0.1)"
      - "Nota geral recalculada a cada nova avaliação"
      - "Arredondamento para 2 casas decimais"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
    validacao:
      tipo: "calculo"
      mensagem_erro: null
      http_code: null

  - id: "RN-RF022-012"
    titulo: "Atualização automática de nota do fornecedor"
    descricao: "Ao criar avaliação, atualizar campo nota_geral do fornecedor com a média das últimas 12 avaliações."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "Considerar apenas últimas 12 avaliações (mais recentes)"
      - "Se menos de 12 avaliações, calcular média das existentes"
      - "Atualização executada dentro da mesma transação da avaliação"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
    validacao:
      tipo: "calculo"
      mensagem_erro: null
      http_code: null

  - id: "RN-RF022-013"
    titulo: "Validação de documentos vencidos"
    descricao: "Alertar se documentos obrigatórios (certificados, certidões) estão vencidos ou próximos do vencimento (30 dias)."
    criticidade: "ALTA"
    criterios_aceite:
      - "Job noturno verifica vencimentos"
      - "Alerta gerado se data_vencimento <= (data_hoje + 30 dias)"
      - "Notificação enviada ao responsável pelo fornecedor"
      - "Badge de alerta exibido na listagem de fornecedores"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: false
    validacao:
      tipo: "alerta"
      mensagem_erro: null
      http_code: null

  - id: "RN-RF022-014"
    titulo: "Isolamento por tenant (multi-tenancy)"
    descricao: "Todas as consultas devem filtrar por tenant_id (conglomerado) do usuário autenticado."
    criticidade: "CRÍTICA"
    criterios_aceite:
      - "Usuário do tenant A não pode acessar fornecedores do tenant B"
      - "Tentativa de acesso cruzado → HTTP 404 (não HTTP 403 para não vazar existência)"
      - "Filtro aplicado automaticamente em todas as queries"
    implementacao:
      backend: true
      frontend: false
      validacao_api: true
      validacao_ui: false
    validacao:
      tipo: "seguranca"
      mensagem_erro: "Fornecedor não encontrado"
      http_code: 404

  - id: "RN-RF022-015"
    titulo: "Auditoria completa"
    descricao: "Todas as operações (CREATE, UPDATE, DELETE) devem registrar histórico em tabela de auditoria."
    criticidade: "CRÍTICA"
    criterios_aceite:
      - "Registrar: quem (usuário), quando (timestamp), o que (operação), quais campos mudaram"
      - "Retenção mínima: 7 anos (compliance fiscal)"
      - "Tabela de auditoria: Fornecedor_Historico"
    implementacao:
      backend: true
      frontend: false
      validacao_api: false
      validacao_ui: false
    validacao:
      tipo: "auditoria"
      mensagem_erro: null
      http_code: null

  - id: "RN-RF022-016"
    titulo: "Limite de crédito válido"
    descricao: "Se informado, limite de crédito deve ser maior que zero."
    criticidade: "BAIXA"
    criterios_aceite:
      - "Limite < 0 → rejeição HTTP 400"
      - "Limite = 0 → aceitar (significa sem limite definido)"
      - "Campo opcional"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "range"
      mensagem_erro: "Limite de crédito deve ser maior ou igual a zero"
      http_code: 400

  - id: "RN-RF022-017"
    titulo: "Telefone obrigatório para contato"
    descricao: "Todo contato de fornecedor deve ter ao menos um telefone (fixo ou celular)."
    criticidade: "ALTA"
    criterios_aceite:
      - "Contato sem telefone fixo e sem celular → rejeição HTTP 400"
      - "Mensagem: Contato deve ter ao menos um telefone"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "campo_obrigatorio"
      mensagem_erro: "Contato deve ter ao menos um telefone"
      http_code: 400

  - id: "RN-RF022-018"
    titulo: "Validação de tipo de contato"
    descricao: "Tipo de contato deve ser um dos valores permitidos: COMERCIAL, TECNICO, FINANCEIRO, JURIDICO."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "Tipo ausente ou fora da lista → rejeição HTTP 400"
      - "Mensagem: Tipo de contato inválido"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "enum"
      mensagem_erro: "Tipo de contato inválido"
      http_code: 400

  - id: "RN-RF022-019"
    titulo: "Comentário obrigatório em avaliação negativa"
    descricao: "Se nota geral < 3, comentário é obrigatório para justificar."
    criticidade: "ALTA"
    criterios_aceite:
      - "Avaliação com nota < 3 e sem comentário → rejeição HTTP 400"
      - "Comentário deve ter no mínimo 20 caracteres"
      - "Mensagem: Avaliação negativa requer comentário justificativo"
    implementacao:
      backend: true
      frontend: true
      validacao_api: true
      validacao_ui: true
    validacao:
      tipo: "campo_obrigatorio_condicional"
      mensagem_erro: "Avaliação negativa requer comentário justificativo"
      http_code: 400

  - id: "RN-RF022-020"
    titulo: "Busca por nome parcial"
    descricao: "Busca de fornecedor por nome deve aceitar match parcial (LIKE)."
    criticidade: "MÉDIA"
    criterios_aceite:
      - "Busca Dell → retornar Dell Computadores Ltda, Dell Brasil"
      - "Busca case-insensitive"
      - "Mínimo 3 caracteres para executar busca"
    implementacao:
      backend: true
      frontend: true
      validacao_api: false
      validacao_ui: true
    validacao:
      tipo: "busca"
      mensagem_erro: "Busca deve ter no mínimo 3 caracteres"
      http_code: 400

# ==============================================================================
# ESTADOS DO FORNECEDOR
# ==============================================================================

estados:
  - estado: "ATIVO"
    descricao: "Fornecedor ativo e disponível para uso"
    cor: "verde"

  - estado: "INATIVO"
    descricao: "Fornecedor inativo, não disponível para novos contratos"
    cor: "cinza"

  - estado: "EM_HOMOLOGACAO"
    descricao: "Fornecedor em processo de homologação"
    cor: "amarelo"

  - estado: "BLOQUEADO"
    descricao: "Fornecedor bloqueado por compliance/inadimplência"
    cor: "vermelho"

transicoes_estado:
  - de: "EM_HOMOLOGACAO"
    para: "ATIVO"
    condicao: "Aprovação em checklist de homologação"

  - de: "ATIVO"
    para: "INATIVO"
    condicao: "Sem contratos ativos"

  - de: "ATIVO"
    para: "BLOQUEADO"
    condicao: "Decisão gerencial ou compliance"

  - de: "INATIVO"
    para: "ATIVO"
    condicao: "Reativação manual"

  - de: "BLOQUEADO"
    para: "ATIVO"
    condicao: "Resolução de pendências"

# ==============================================================================
# EVENTOS DE DOMÍNIO
# ==============================================================================

eventos:
  - evento: "fornecedor.criado"
    quando: "Após criação bem-sucedida"
    payload:
      - "fornecedorId"
      - "cnpj"
      - "nome"
      - "tipo"

  - evento: "fornecedor.atualizado"
    quando: "Após atualização"
    payload:
      - "fornecedorId"
      - "campos_alterados[]"

  - evento: "fornecedor.inativado"
    quando: "Após inativação"
    payload:
      - "fornecedorId"
      - "motivo"

  - evento: "fornecedor.avaliado"
    quando: "Após registro de avaliação"
    payload:
      - "fornecedorId"
      - "nota_geral"
      - "avaliadorId"

  - evento: "fornecedor.bloqueado"
    quando: "Ao bloquear fornecedor"
    payload:
      - "fornecedorId"
      - "motivo"
      - "bloqueadoPor"

  - evento: "documento.vencendo"
    quando: "Documento próximo ao vencimento"
    payload:
      - "fornecedorId"
      - "tipoDocumento"
      - "diasRestantes"

# ==============================================================================
# PERMISSÕES RBAC
# ==============================================================================

permissoes_rbac:
  - permission_code: "fornecedor.read"
    descricao: "Visualizar fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Comprador"
      - "Supervisor"
      - "Financeiro"
      - "Usuario"
    endpoint: "GET /api/v1/fornecedores"

  - permission_code: "fornecedor.create"
    descricao: "Criar fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Comprador"
    endpoint: "POST /api/v1/fornecedores"

  - permission_code: "fornecedor.update"
    descricao: "Editar fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Comprador"
    endpoint: "PUT /api/v1/fornecedores/{id}"

  - permission_code: "fornecedor.delete"
    descricao: "Inativar fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
    endpoint: "DELETE /api/v1/fornecedores/{id}"

  - permission_code: "fornecedor.rate"
    descricao: "Avaliar fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Supervisor"
    endpoint: "POST /api/v1/fornecedores/{id}/avaliacoes"

  - permission_code: "fornecedor.docs.manage"
    descricao: "Gerenciar documentos de fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Gestor"
      - "Comprador"
    endpoint: "POST /api/v1/fornecedores/{id}/documentos"

  - permission_code: "fornecedor.banking.read"
    descricao: "Visualizar dados bancários de fornecedores"
    roles_autorizadas:
      - "Super Admin"
      - "Admin"
      - "Financeiro"
    endpoint: "GET /api/v1/fornecedores/{id}/dados-bancarios"

# ==============================================================================
# API ENDPOINTS
# ==============================================================================

endpoints:
  - method: "GET"
    route: "/api/v1/fornecedores"
    descricao: "Listar fornecedores"
    autenticacao: true
    authorization_policy: "fornecedor.read"
    request_dto: null
    response_dto: "Paginated<FornecedorDto>"
    query_params:
      - "page: int"
      - "pageSize: int"
      - "tipo: TipoFornecedor"
      - "status: StatusFornecedor"
    http_success: 200

  - method: "GET"
    route: "/api/v1/fornecedores/{id}"
    descricao: "Obter fornecedor por ID"
    autenticacao: true
    authorization_policy: "fornecedor.read"
    request_dto: null
    response_dto: "FornecedorDto"
    path_params:
      - "id: Guid"
    http_success: 200

  - method: "GET"
    route: "/api/v1/fornecedores/buscar-cnpj/{cnpj}"
    descricao: "Buscar por CNPJ"
    autenticacao: true
    authorization_policy: "fornecedor.read"
    request_dto: null
    response_dto: "FornecedorDto"
    path_params:
      - "cnpj: string"
    http_success: 200

  - method: "POST"
    route: "/api/v1/fornecedores"
    descricao: "Criar fornecedor"
    autenticacao: true
    authorization_policy: "fornecedor.create"
    request_dto: "CreateFornecedorCommand"
    response_dto: "Guid"
    http_success: 201

  - method: "PUT"
    route: "/api/v1/fornecedores/{id}"
    descricao: "Atualizar fornecedor"
    autenticacao: true
    authorization_policy: "fornecedor.update"
    request_dto: "UpdateFornecedorCommand"
    response_dto: "void"
    path_params:
      - "id: Guid"
    http_success: 204

  - method: "DELETE"
    route: "/api/v1/fornecedores/{id}"
    descricao: "Inativar fornecedor"
    autenticacao: true
    authorization_policy: "fornecedor.delete"
    request_dto: null
    response_dto: "void"
    path_params:
      - "id: Guid"
    http_success: 204

  - method: "POST"
    route: "/api/v1/fornecedores/{id}/contatos"
    descricao: "Adicionar contato"
    autenticacao: true
    authorization_policy: "fornecedor.update"
    request_dto: "CreateContatoCommand"
    response_dto: "Guid"
    path_params:
      - "id: Guid"
    http_success: 201

  - method: "PUT"
    route: "/api/v1/fornecedores/{id}/contatos/{contatoId}"
    descricao: "Atualizar contato"
    autenticacao: true
    authorization_policy: "fornecedor.update"
    request_dto: "UpdateContatoCommand"
    response_dto: "void"
    path_params:
      - "id: Guid"
      - "contatoId: Guid"
    http_success: 204

  - method: "DELETE"
    route: "/api/v1/fornecedores/{id}/contatos/{contatoId}"
    descricao: "Remover contato"
    autenticacao: true
    authorization_policy: "fornecedor.update"
    request_dto: null
    response_dto: "void"
    path_params:
      - "id: Guid"
      - "contatoId: Guid"
    http_success: 204

  - method: "POST"
    route: "/api/v1/fornecedores/{id}/avaliacoes"
    descricao: "Avaliar fornecedor"
    autenticacao: true
    authorization_policy: "fornecedor.rate"
    request_dto: "CreateAvaliacaoCommand"
    response_dto: "Guid"
    path_params:
      - "id: Guid"
    http_success: 201

  - method: "GET"
    route: "/api/v1/fornecedores/{id}/avaliacoes"
    descricao: "Listar avaliações"
    autenticacao: true
    authorization_policy: "fornecedor.read"
    request_dto: null
    response_dto: "Paginated<AvaliacaoDto>"
    path_params:
      - "id: Guid"
    query_params:
      - "page: int"
    http_success: 200

  - method: "POST"
    route: "/api/v1/fornecedores/validar-cnpj"
    descricao: "Validar CNPJ"
    autenticacao: true
    authorization_policy: "fornecedor.read"
    request_dto: "{ cnpj: string }"
    response_dto: "{ valido: bool, mensagem: string }"
    http_success: 200

  - method: "GET"
    route: "/api/v1/fornecedores/search"
    descricao: "Buscar por nome/CNPJ"
    autenticacao: true
    authorization_policy: "fornecedor.read"
    request_dto: null
    response_dto: "FornecedorDto[]"
    query_params:
      - "q: string (mínimo 3 caracteres)"
      - "limit: int (default 20)"
    http_success: 200

# ==============================================================================
# INTEGRAÇÕES OBRIGATÓRIAS
# ==============================================================================

integracoes:
  i18n:
    namespace: "fornecedores.*"
    idiomas_obrigatorios:
      - "pt-BR"
      - "en"
      - "es"
    fallback: "pt-BR → en → es"

  auditoria:
    tabela: "Fornecedor_Historico"
    operacoes:
      - "CREATE"
      - "UPDATE"
      - "DELETE"
      - "RATE"
      - "BLOCK"
    retencao: "7 anos"
    campos_obrigatorios:
      - "usuario_id"
      - "timestamp"
      - "operacao"
      - "payload_antes"
      - "payload_depois"

  central_funcionalidades:
    feature_key: "FNC-CAD-012"
    nome: "Gestão de Fornecedores"
    descricao: "Cadastro, avaliação e gestão completa de fornecedores"
    habilitado_padrao: true
    tipo: "negocio"

  notificacoes:
    - tipo: "documento_vencendo"
      prazo: "30 dias antes"
      canais:
        - "email"
        - "in-app"

    - tipo: "avaliacao_negativa"
      condicao: "nota < 3"
      canais:
        - "email"
        - "in-app"

    - tipo: "fornecedor_bloqueado"
      canais:
        - "email"
        - "in-app"
        - "sms"

# ==============================================================================
# DEPENDÊNCIAS
# ==============================================================================

dependencias:
  upstream:
    - rf_id: "RF-001"
      titulo: "Parametros e Configurações"
      descricao: "tenant_id, configurações globais"

    - rf_id: "RF-006"
      titulo: "Gestão de Clientes"
      descricao: "para definir conglomerado/tenant"

    - rf_id: "RF-063"
      titulo: "Motor de Templates"
      descricao: "para documentos/relatórios de fornecedor"

  downstream:
    - rf_id: "RF-CTR"
      titulo: "Gestão de Contratos"
      descricao: "fornecedor é FK em contratos"

    - rf_id: "RF-NF"
      titulo: "Gestão de Notas Fiscais"
      descricao: "fornecedor é emissor"

    - rf_id: "RF-PED"
      titulo: "Gestão de Pedidos de Compra"
      descricao: "fornecedor é destino"

# ==============================================================================
# ARTEFATOS DERIVADOS
# ==============================================================================

artefatos:
  - tipo: "UC"
    arquivo: "UC-RF022.md"
    status: "criado"

  - tipo: "MD"
    arquivo: "MD-RF022.md"
    status: "criado"

  - tipo: "WF"
    arquivo: "WF-RF022.md"
    status: "criado"

  - tipo: "TC"
    arquivo: "TC-RF022.yaml"
    status: "pendente"

  - tipo: "MT"
    arquivo: "MT-RF022.yaml"
    status: "pendente"

  - tipo: "RL"
    arquivo: "RL-RF022.md"
    status: "em_criacao"

# ==============================================================================
# METADADOS
# ==============================================================================

metadados:
  total_regras_negocio: 20
  total_endpoints_api: 13
  total_permissoes_rbac: 7
  total_integracoes_obrigatorias: 4
  total_estados_entidade: 4
  total_eventos_dominio: 6
  total_funcionalidades: 10

# ==============================================================================
# CHANGELOG
# ==============================================================================

changelog:
  - versao: "1.0"
    data: "2025-11-03"
    descricao: "Versão inicial com 15 regras de negócio"
    autor: "Architect Agent"

  - versao: "2.0"
    data: "2025-12-30"
    descricao: "Migração v1.0 → v2.0 - Separação RF/RL, 20 regras de negócio, contrato moderno"
    autor: "Agência ALC - alc.dev.br"
