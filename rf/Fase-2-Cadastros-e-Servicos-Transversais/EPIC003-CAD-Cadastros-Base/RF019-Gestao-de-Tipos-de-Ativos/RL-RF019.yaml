# =============================================
# RL-RF019 - Referência ao Legado
# Gestão de Tipos de Ativos
# Versão: 2.0
# Data: 2025-12-30
# =============================================

rf_id: RF019
titulo: "Gestão de Tipos de Ativos"
versao_governanca: "2.0"
data_migracao: "2025-12-30"

legado:
  sistema: "ASP.NET Web Forms + VB.NET"
  versao: "4.0"
  arquitetura: "Monolítica WebForms"
  banco_dados: "SQL Server 2012"
  multi_tenant: false
  auditoria: "none"

# ==============================================================================
# REFERENCIAS AO LEGADO (OBRIGATÓRIO para validator)
# ==============================================================================

referencias:
  - id: "LEG-RF019-001"
    tipo: "tela"
    nome: "Ativo_Tipo.aspx"
    caminho: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx"
    descricao: "Tela CRUD de tipos de ativos"
    destino: "substituido"
    justificativa: "Substituído por componente Angular moderno"
    rf_item_relacionado: "RF019 - Seção 4"
    uc_relacionado: "UC01-RF019"

  - id: "LEG-RF019-002"
    tipo: "webservice"
    nome: "WSAtivo.asmx"
    caminho: "ic1_legado/IControlIT/Services/WSAtivo.asmx"
    descricao: "Webservice SOAP de tipos de ativos"
    destino: "substituido"
    justificativa: "Substituído por REST API com CQRS"
    rf_item_relacionado: "RF019 - Seção 11"
    uc_relacionado: null

  - id: "LEG-RF019-003"
    tipo: "stored_procedure"
    nome: "sp_AtivoTipo_Listar"
    caminho: "ic1_legado/Database/Procedures/sp_AtivoTipo_Listar.sql"
    descricao: "Procedure de listagem de tipos"
    destino: "substituido"
    justificativa: "Substituído por EF Core + paginação"
    rf_item_relacionado: "RF019 - Endpoint GET"
    uc_relacionado: "UC00-RF019"

  - id: "LEG-RF019-004"
    tipo: "stored_procedure"
    nome: "sp_AtivoTipo_Insert"
    caminho: "ic1_legado/Database/Procedures/sp_AtivoTipo_Insert.sql"
    descricao: "Procedure de criação de tipos"
    destino: "substituido"
    justificativa: "Substituído por Command Handler"
    rf_item_relacionado: "RF019 - Endpoint POST"
    uc_relacionado: "UC01-RF019"

  - id: "LEG-RF019-005"
    tipo: "stored_procedure"
    nome: "sp_AtivoTipo_Update"
    caminho: "ic1_legado/Database/Procedures/sp_AtivoTipo_Update.sql"
    descricao: "Procedure de atualização de tipos"
    destino: "substituido"
    justificativa: "Substituído por Command Handler com auditoria"
    rf_item_relacionado: "RF019 - Endpoint PUT"
    uc_relacionado: "UC03-RF019"

  - id: "LEG-RF019-006"
    tipo: "stored_procedure"
    nome: "sp_AtivoTipo_Delete"
    caminho: "ic1_legado/Database/Procedures/sp_AtivoTipo_Delete.sql"
    descricao: "Procedure de exclusão física"
    destino: "substituido"
    justificativa: "Substituído por soft delete (Fl_Ativo = 0)"
    rf_item_relacionado: "RF019 - RN-RF019-015"
    uc_relacionado: "UC04-RF019"

  - id: "LEG-RF019-007"
    tipo: "tabela"
    nome: "TB_ATIVO_TIPO"
    caminho: "ic1_legado/Database/Tables/TB_ATIVO_TIPO.sql"
    descricao: "Tabela legada de tipos de ativos"
    destino: "substituido"
    justificativa: "Redesenhada com auditoria, hierarquia, multi-tenancy"
    rf_item_relacionado: "MD-RF019"
    uc_relacionado: null

  - id: "LEG-RF019-008"
    tipo: "regra_negocio"
    nome: "Código em UPPERCASE"
    caminho: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx.vb"
    descricao: "Conversão automática de código para maiúsculas"
    destino: "descartado"
    justificativa: "Sistema moderno aceita qualquer case (validação case-insensitive)"
    rf_item_relacionado: "RF019 - RN-RF019-001"
    uc_relacionado: null

  - id: "LEG-RF019-009"
    tipo: "regra_negocio"
    nome: "Depreciação Visível para Hardware"
    caminho: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx"
    descricao: "Campos de depreciação visíveis apenas para categoria Hardware"
    destino: "assumido"
    justificativa: "Mantido como RN-RF019-004"
    rf_item_relacionado: "RF019 - RN-RF019-004"
    uc_relacionado: "UC01-RF019"

  - id: "LEG-RF019-010"
    tipo: "regra_negocio"
    nome: "Validação de Ativos Antes de Excluir"
    caminho: "ic1_legado/IControlIT/Services/WSAtivo.asmx.vb"
    descricao: "Verificar ativos associados antes de permitir exclusão"
    destino: "assumido"
    justificativa: "Mantido como RN-RF019-005"
    rf_item_relacionado: "RF019 - RN-RF019-005"
    uc_relacionado: "UC04-RF019"

  - id: "LEG-RF019-011"
    tipo: "regra_negocio"
    nome: "Validação de Subtipos Antes de Excluir"
    caminho: "ic1_legado/IControlIT/Services/WSAtivo.asmx.vb"
    descricao: "Verificar subtipos antes de permitir exclusão"
    destino: "assumido"
    justificativa: "Mantido como RN-RF019-006"
    rf_item_relacionado: "RF019 - RN-RF019-006"
    uc_relacionado: "UC04-RF019"

  - id: "LEG-RF019-012"
    tipo: "regra_negocio"
    nome: "Nome em Title Case"
    caminho: "ic1_legado/IControlIT/Services/WSAtivo.asmx.vb"
    descricao: "Conversão automática de nome para Title Case"
    destino: "descartado"
    justificativa: "Sistema moderno preserva capitalização original"
    rf_item_relacionado: null
    uc_relacionado: null

# ==============================================================================
# ITENS LEGADO RASTREADOS (DETALHADO)
# ==============================================================================

itens_legado:
  # ----------------------------------------------------------------------------
  # TELAS ASPX
  # ----------------------------------------------------------------------------
  - id: "LEG-RF019-001"
    tipo: "tela"
    titulo: "Ativo_Tipo.aspx - CRUD de Tipos de Ativos"
    caminho_legado: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx"
    descricao: |
      Tela de listagem, criação, edição e exclusão de tipos de ativos.
      Campos: txtCodigo, txtNome, txtDescricao, ddlCategoria, txtTaxaDepreciacao, txtVidaUtil, chkAtivo, GridView1.
      Comportamentos: validação de código único, verificação de ativos antes de excluir, conversão de código para UPPERCASE.
    regras_implicitas:
      - "Código do tipo convertido para UPPERCASE automaticamente"
      - "Campos de depreciação visíveis apenas para categoria Hardware (JavaScript)"
      - "Validação de código único via query SQL direta no code-behind"
      - "Exclusão verifica COUNT de ativos associados antes de permitir"
    destino: "SUBSTITUÍDO"
    justificativa: "Tela legada substituída por componente Angular moderno com Fuse Template e REST API"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 4 (Funcionalidades)"
      uc_moderno: "UC01-RF019 (Criar), UC03-RF019 (Editar), UC04-RF019 (Excluir)"
    migracao_moderna:
      componente_angular: "ativo-tipos-list.component.ts, ativo-tipos-form.component.ts"
      rota_frontend: "/configuracoes/cadastros/ativo-tipos"

  # ----------------------------------------------------------------------------
  # WEBSERVICES
  # ----------------------------------------------------------------------------
  - id: "LEG-RF019-002"
    tipo: "webservice"
    titulo: "WSAtivo.asmx - Métodos de Tipo de Ativo"
    caminho_legado: "ic1_legado/IControlIT/Services/WSAtivo.asmx"
    metodos:
      - nome: "ListarTiposAtivo"
        parametros: "token (String), idFornecedor (Guid)"
        retorno: "List<AtivoTipoInfo>"
      - nome: "CriarTipoAtivo"
        parametros: "token, idFornecedor, cdTipo, nmTipo, dsTipo, categoria, flDepreciavel, taxaDepreciacao, vidaUtil"
        retorno: "OperacaoResult"
      - nome: "AtualizarTipoAtivo"
        parametros: "token, idTipo, nmTipo, dsTipo, taxaDepreciacao, vidaUtil"
        retorno: "OperacaoResult"
      - nome: "ExcluirTipoAtivo"
        parametros: "token, idTipo"
        retorno: "OperacaoResult"
    descricao: |
      WebService SOAP com métodos para manipulação de tipos de ativos.
      Validação de token, verificação de permissões, queries SQL diretas, exclusão física.
    destino: "SUBSTITUÍDO"
    justificativa: "SOAP substituído por REST API moderna com CQRS/MediatR, autenticação JWT e validações FluentValidation"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 11 (API Endpoints)"
      endpoint_moderno: "POST /api/ativos/tipos, PUT /api/ativos/tipos/{id}, DELETE /api/ativos/tipos/{id}"
    migracao_moderna:
      command_cqrs: "CreateAtivoTipoCommand, UpdateAtivoTipoCommand, DeleteAtivoTipoCommand"
      handler: "CreateAtivoTipoCommandHandler, UpdateAtivoTipoCommandHandler, DeleteAtivoTipoCommandHandler"

  # ----------------------------------------------------------------------------
  # STORED PROCEDURES
  # ----------------------------------------------------------------------------
  - id: "LEG-RF019-003"
    tipo: "stored_procedure"
    titulo: "sp_AtivoTipo_Listar"
    caminho_legado: "ic1_legado/Database/Procedures/sp_AtivoTipo_Listar.sql"
    parametros_entrada:
      - "@IdFornecedor UNIQUEIDENTIFIER"
    parametros_saida: []
    descricao: |
      Lista todos os tipos de ativos ativos de um Fornecedor, ordenados por nome.
      Problemas: sem paginação, retorna todos os registros (lento com > 1000 tipos).
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Query CQRS com Entity Framework Core e paginação"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 11.1 (API Endpoints - GET /api/ativos/tipos)"
      regra_moderna: null
    migracao_moderna:
      handler: "GetAtivoTiposQuery"
      validacao: null

  - id: "LEG-RF019-004"
    tipo: "stored_procedure"
    titulo: "sp_AtivoTipo_Insert"
    caminho_legado: "ic1_legado/Database/Procedures/sp_AtivoTipo_Insert.sql"
    parametros_entrada:
      - "@IdFornecedor UNIQUEIDENTIFIER"
      - "@CdTipo VARCHAR(20)"
      - "@NmTipo VARCHAR(200)"
      - "@DsTipo NVARCHAR(1000)"
      - "@Categoria VARCHAR(50)"
      - "@FlDepreciavel BIT"
      - "@TaxaDepreciacao DECIMAL(5,2)"
      - "@VidaUtil INT"
      - "@IdUsuario UNIQUEIDENTIFIER"
    parametros_saida:
      - "@IdTipo UNIQUEIDENTIFIER OUTPUT"
    descricao: |
      Cria novo tipo de ativo.
      Validações: código único, categoria válida.
      Problemas: sem validação de taxa de depreciação, sem campos de auditoria.
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Command Handler com FluentValidation e auditoria completa"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 11.3 (API Endpoints - POST /api/ativos/tipos)"
      regra_moderna: "RN-RF019-001 (Código único), RN-RF019-004 (Depreciação obrigatória para Hardware)"
    migracao_moderna:
      handler: "CreateAtivoTipoCommandHandler"
      validacao: "CreateAtivoTipoCommandValidator"

  - id: "LEG-RF019-005"
    tipo: "stored_procedure"
    titulo: "sp_AtivoTipo_Update"
    caminho_legado: "ic1_legado/Database/Procedures/sp_AtivoTipo_Update.sql"
    parametros_entrada:
      - "@IdTipo UNIQUEIDENTIFIER"
      - "@NmTipo VARCHAR(200)"
      - "@DsTipo NVARCHAR(1000)"
      - "@TaxaDepreciacao DECIMAL(5,2)"
      - "@VidaUtil INT"
    parametros_saida: []
    descricao: |
      Atualiza tipo de ativo existente.
      Problemas: sem auditoria (não registra quem alterou ou quando).
    destino: "SUBSTITUÍDO"
    justificativa: "Lógica movida para Command Handler com auditoria completa em Ativo_Tipo_Auditoria"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 11.4 (API Endpoints - PUT /api/ativos/tipos/{id})"
      regra_moderna: "RN-RF019-010 (Auditoria completa de alterações)"
    migracao_moderna:
      handler: "UpdateAtivoTipoCommandHandler"
      validacao: "UpdateAtivoTipoCommandValidator"

  - id: "LEG-RF019-006"
    tipo: "stored_procedure"
    titulo: "sp_AtivoTipo_Delete"
    caminho_legado: "ic1_legado/Database/Procedures/sp_AtivoTipo_Delete.sql"
    parametros_entrada:
      - "@IdTipo UNIQUEIDENTIFIER"
    parametros_saida: []
    descricao: |
      Exclui tipo de ativo (DELETE físico).
      Validações: verifica se COUNT(Ativo WHERE Id_Ativo_Tipo = X) = 0 antes de excluir.
      Problemas: exclusão física (perda permanente de dados).
    destino: "SUBSTITUÍDO"
    justificativa: "Substituído por soft delete (Fl_Ativo = 0) com possibilidade de restauração"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 11.5 (API Endpoints - DELETE /api/ativos/tipos/{id})"
      regra_moderna: "RN-RF019-015 (Soft delete com restauração)"
    migracao_moderna:
      handler: "DeleteAtivoTipoCommandHandler"
      validacao: null

  # ----------------------------------------------------------------------------
  # TABELAS LEGADAS
  # ----------------------------------------------------------------------------
  - id: "LEG-RF019-007"
    tipo: "tabela"
    titulo: "TB_ATIVO_TIPO"
    schema_legado: "[dbo].[TB_ATIVO_TIPO]"
    problemas_identificados:
      - "Falta Foreign Key para Id_Tipo_Pai (hierarquia não funciona)"
      - "Sem campos de auditoria (Id_Usuario_Criacao, Dt_Criacao, etc.)"
      - "Sem índice em Id_Fornecedor (queries lentas)"
      - "Fl_Ativo como INT (deveria ser BIT 0/1)"
      - "Sem CHECK constraints (Taxa_Depreciacao_Anual permite valores negativos e > 100)"
      - "Colunas NULL sem DEFAULT"
    destino: "SUBSTITUÍDO"
    justificativa: "Tabela redesenhada com multi-tenancy, auditoria completa, hierarquia funcional, soft delete e índices adequados"
    rastreabilidade:
      rf_moderno: "RF019 - Seção 12 (Modelo de Dados)"
      md_moderno: "MD-RF019 - Tabela Ativo_Tipo"
    migracao_moderna:
      tabela_moderna: "Ativo_Tipo"
      migration_ef_core: "20251230_CreateAtivoTipoTable.cs"

  # ----------------------------------------------------------------------------
  # REGRAS IMPLÍCITAS
  # ----------------------------------------------------------------------------
  - id: "LEG-RF019-008"
    tipo: "regra_negocio"
    titulo: "Código em UPPERCASE"
    localizacao_codigo: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx.vb - Linha 145"
    descricao: |
      Código do tipo é automaticamente convertido para UPPERCASE antes de salvar.
    destino: "DESCARTADO"
    justificativa: "Sistema moderno aceita qualquer case, validação é case-insensitive"
    rastreabilidade:
      rf_moderno: "RF019 - RN-RF019-001 (validação case-insensitive)"
      regra_moderna: null
    migracao_moderna:
      validador: null
      linha_codigo: null

  - id: "LEG-RF019-009"
    tipo: "regra_negocio"
    titulo: "Depreciação Visível Apenas para Hardware"
    localizacao_codigo: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx - JavaScript linha 78"
    descricao: |
      Campos de depreciação (txtTaxaDepreciacao, txtVidaUtil) só ficam visíveis na tela se categoria selecionada = "Hardware".
    destino: "ASSUMIDO"
    justificativa: "Regra mantida no sistema moderno com RN-RF019-004: Depreciação obrigatória para Hardware"
    rastreabilidade:
      rf_moderno: "RF019 - RN-RF019-004"
      regra_moderna: "RN-RF019-004"
    migracao_moderna:
      validador: "CreateAtivoTipoCommandValidator"
      linha_codigo: "When(x => x.CategoriaPrincipal == 'Hardware', () => { RuleFor(x => x.TaxaDepreciacaoAnual).NotNull(); })"

  - id: "LEG-RF019-010"
    tipo: "regra_negocio"
    titulo: "Nome em Title Case"
    localizacao_codigo: "ic1_legado/IControlIT/Services/WSAtivo.asmx.vb - Linha 310"
    descricao: |
      Nome do tipo é convertido para Title Case (primeira letra maiúscula em cada palavra) via função ToTitleCase.
    destino: "DESCARTADO"
    justificativa: "Sistema moderno preserva capitalização original fornecida pelo usuário"
    rastreabilidade:
      rf_moderno: null
      regra_moderna: null
    migracao_moderna:
      validador: null
      linha_codigo: null

  - id: "LEG-RF019-011"
    tipo: "regra_negocio"
    titulo: "Validação de Ativos Associados Antes de Excluir"
    localizacao_codigo: "ic1_legado/IControlIT/Services/WSAtivo.asmx.vb - Linhas 438-444"
    descricao: |
      Antes de permitir exclusão de tipo, verifica se COUNT(Ativo WHERE Id_Ativo_Tipo = X) = 0.
      Se houver ativos associados, retorna erro "Não é possível excluir tipo com ativos associados".
    destino: "ASSUMIDO"
    justificativa: "Regra mantida no sistema moderno com RN-RF019-005"
    rastreabilidade:
      rf_moderno: "RF019 - RN-RF019-005"
      regra_moderna: "RN-RF019-005"
    migracao_moderna:
      validador: "DeleteAtivoTipoCommandHandler"
      linha_codigo: "if (await _context.Ativos.AnyAsync(a => a.IdAtivoTipo == id)) { throw ValidationException; }"

  - id: "LEG-RF019-012"
    tipo: "regra_negocio"
    titulo: "Validação de Subtipos Antes de Excluir"
    localizacao_codigo: "ic1_legado/IControlIT/Services/WSAtivo.asmx.vb - Linhas 447-452"
    descricao: |
      Verifica se COUNT(Ativo_Tipo WHERE Id_Tipo_Pai = X AND Fl_Ativo = 1) = 0 antes de excluir.
      Se houver subtipos ativos, retorna erro "Não é possível excluir tipo com subtipos associados".
    destino: "ASSUMIDO"
    justificativa: "Regra mantida no sistema moderno com RN-RF019-006"
    rastreabilidade:
      rf_moderno: "RF019 - RN-RF019-006"
      regra_moderna: "RN-RF019-006"
    migracao_moderna:
      validador: "DeleteAtivoTipoCommandHandler"
      linha_codigo: "if (await _context.AtivoTipos.AnyAsync(t => t.IdTipoPai == id && t.FlAtivo)) { throw ValidationException; }"

# ==============================================================================
# TELAS (estrutura detalhada)
# ==============================================================================

telas:
  - id: "LEG-RF019-001"
    nome: "Ativo_Tipo.aspx"
    caminho: "ic1_legado/IControlIT/Cadastro/Ativo_Tipo.aspx"
    responsabilidade: "CRUD de tipos de ativos"
    campos:
      - nome: "txtCodigo"
        tipo: "TextBox"
        obrigatorio: true
        validacao: "Código único no Fornecedor"
      - nome: "txtNome"
        tipo: "TextBox"
        obrigatorio: true
        validacao: "Required"
      - nome: "txtDescricao"
        tipo: "TextBox"
        obrigatorio: false
        validacao: null
      - nome: "ddlCategoria"
        tipo: "DropDownList"
        obrigatorio: true
        validacao: "Enum: Hardware, Software, LinhaMovel, etc."
      - nome: "txtTaxaDepreciacao"
        tipo: "TextBox"
        obrigatorio: false
        validacao: "Decimal (sem validação de range no legado)"
      - nome: "txtVidaUtil"
        tipo: "TextBox"
        obrigatorio: false
        validacao: "Integer"
      - nome: "chkAtivo"
        tipo: "CheckBox"
        obrigatorio: false
        validacao: null
    comportamentos_implicitos:
      - "Código convertido para UPPERCASE automaticamente"
      - "Depreciação visível apenas para Hardware (JavaScript)"
      - "Exclusão verifica ativos associados"

# ==============================================================================
# SERVIÇOS LEGADOS
# ==============================================================================

servicos:
  - id: "LEG-RF019-002"
    nome: "WSAtivo.asmx"
    localizacao: "ic1_legado/IControlIT/Services/WSAtivo.asmx"
    responsabilidade: "Métodos SOAP para manipulação de tipos de ativos"
    notas: "Substituído por REST API com CQRS"

# ==============================================================================
# TABELAS LEGADAS COM PROBLEMAS
# ==============================================================================

tabelas:
  - nome: "TB_ATIVO_TIPO"
    finalidade: "Armazenar tipos de ativos"
    problemas:
      - "Falta FK para Id_Tipo_Pai"
      - "Sem campos de auditoria"
      - "Sem índice em Id_Fornecedor"
      - "Fl_Ativo como INT (deveria ser BIT)"
      - "Sem CHECK constraints"

# ==============================================================================
# REGRAS IMPLÍCITAS
# ==============================================================================

regras_implicitas:
  - id: "RL-RN-001"
    descricao: "Código convertido para UPPERCASE"
    fonte: "Ativo_Tipo.aspx.vb - Linha 145"
  - id: "RL-RN-002"
    descricao: "Depreciação visível apenas para Hardware"
    fonte: "Ativo_Tipo.aspx - JavaScript linha 78"
  - id: "RL-RN-003"
    descricao: "Nome em Title Case"
    fonte: "WSAtivo.asmx.vb - Linha 310"
  - id: "RL-RN-004"
    descricao: "Validar ativos associados antes de excluir"
    fonte: "WSAtivo.asmx.vb - Linhas 438-444"
  - id: "RL-RN-005"
    descricao: "Validar subtipos antes de excluir"
    fonte: "WSAtivo.asmx.vb - Linhas 447-452"

# ==============================================================================
# GAP ANALYSIS
# ==============================================================================

gap_analysis:
  - item: "Hierarquia de Tipos"
    existe_legado: false
    existe_moderno: true
    notas: "Nova funcionalidade (até 5 níveis)"

  - item: "Auditoria Completa"
    existe_legado: false
    existe_moderno: true
    notas: "Nova tabela Ativo_Tipo_Auditoria"

  - item: "Soft Delete"
    existe_legado: false
    existe_moderno: true
    notas: "Fl_Ativo = 0 com restauração"

  - item: "Campos Customizados"
    existe_legado: false
    existe_moderno: true
    notas: "Nova tabela Ativo_Tipo_Campo_Customizado"

  - item: "Ícone e Cor"
    existe_legado: false
    existe_moderno: true
    notas: "Font Awesome + hex color"

  - item: "Importação em Massa"
    existe_legado: false
    existe_moderno: true
    notas: "CSV com validação"

  - item: "Paginação"
    existe_legado: false
    existe_moderno: true
    notas: "pageNumber, pageSize"

  - item: "REST API"
    existe_legado: false
    existe_moderno: true
    notas: "Substituiu SOAP WebService"

# ==============================================================================
# DECISÕES DE MODERNIZAÇÃO
# ==============================================================================

decisoes_modernizacao:
  - decisao: "Soft Delete ao invés de exclusão física"
    motivo: "Preservar histórico e permitir restauração"
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "Implementar hierarquia completa (até 5 níveis)"
    motivo: "Código legado tinha tentativa não concluída. Modernização completa"
    impacto: "medio"
    data: "2025-12-30"

  - decisao: "Tabela de auditoria separada"
    motivo: "Legado tinha código não funcional. Moderno cria Ativo_Tipo_Auditoria"
    impacto: "alto"
    data: "2025-12-30"

  - decisao: "SOAP → REST API"
    motivo: "Modernização de arquitetura"
    impacto: "alto"
    data: "2025-12-30"

# ==============================================================================
# RISCOS DE MIGRAÇÃO
# ==============================================================================

riscos_migracao:
  - risco: "Perda de dados durante migração"
    impacto: "alto"
    probabilidade: "baixa"
    mitigacao: "Script de migração com backup completo antes de executar"

  - risco: "Quebra de integrações SOAP"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: "Manter webservice legado temporariamente em paralelo"

  - risco: "Tipos órfãos (sem categoria válida)"
    impacto: "medio"
    probabilidade: "media"
    mitigacao: "Script de validação pré-migração para corrigir dados inconsistentes"

# ==============================================================================
# RASTREABILIDADE (Legado → Moderno)
# ==============================================================================

rastreabilidade:
  - elemento_legado: "Ativo_Tipo.aspx"
    referencia_rf: "RF019 - Seção 4 (Funcionalidades)"
    referencia_uc: "UC01-RF019, UC03-RF019, UC04-RF019"
    status: "migrado"

  - elemento_legado: "WSAtivo.asmx"
    referencia_rf: "RF019 - Seção 11 (API Endpoints)"
    referencia_uc: null
    status: "migrado"

  - elemento_legado: "sp_AtivoTipo_Listar"
    referencia_rf: "RF019 - Endpoint GET /api/ativos/tipos"
    referencia_uc: "UC00-RF019"
    status: "migrado"

  - elemento_legado: "TB_ATIVO_TIPO"
    referencia_rf: "MD-RF019 - Tabela Ativo_Tipo"
    referencia_uc: null
    status: "migrado"

# ==============================================================================
# METADADOS
# ==============================================================================

metadados:
  total_itens_legado: 12
  itens_assumidos: 4
  itens_substituidos: 7
  itens_descartados: 2
  itens_a_revisar: 0
  cobertura_destinos: "100%"

# ==============================================================================
# CHANGELOG
# ==============================================================================

changelog:
  - versao: "2.0"
    data: "2025-12-30"
    descricao: "Criação do documento de referência ao legado (migração RF v1.0 → v2.0)"
    autor: "Agência ALC - alc.dev.br"
