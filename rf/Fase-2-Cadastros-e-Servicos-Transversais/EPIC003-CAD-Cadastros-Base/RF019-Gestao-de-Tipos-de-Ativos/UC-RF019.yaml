# =============================================
# UC - Casos de Uso (Contrato Comportamental)
# RF019 - Gestão de Tipos de Ativos
# Versão: 2.0
# Data: 2025-12-31
# Autor: Agência ALC - alc.dev.br
# =============================================

uc:
  rf: "RF019"
  versao: "2.0"
  data: "2025-12-31"

casos_de_uso:

  - id: "UC00"
    nome: "Listar Tipos de Ativos"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-02"
      uc_items:
        - id: "FP-UC00-001"
          title: "Usuário acessa o menu Cadastros > Tipos de Ativos"
          required: true
        - id: "FP-UC00-002"
          title: "Sistema valida permissão CAD.ATIVOS.TIPOS.READ_ANY"
          required: true
        - id: "FP-UC00-003"
          title: "Sistema carrega tipos do tenant do usuário autenticado"
          required: true
        - id: "FP-UC00-004"
          title: "Sistema aplica paginação padrão (20 registros)"
          required: true
        - id: "FP-UC00-005"
          title: "Sistema ordena por Ordem_Exibicao ASC, Nm_Tipo ASC"
          required: true
        - id: "FP-UC00-006"
          title: "Sistema calcula quantidade de ativos vinculados"
          required: true
        - id: "FP-UC00-007"
          title: "Sistema exibe lista em formato tabela ou árvore"
          required: true
        - id: "FA-UC00-001"
          title: "Filtrar por Categoria Principal"
          required: false
        - id: "FA-UC00-002"
          title: "Buscar por texto (código ou nome)"
          required: false
        - id: "FA-UC00-003"
          title: "Alternar visualização Tabela/Árvore"
          required: false
        - id: "FA-UC00-004"
          title: "Ordenar por coluna clicável"
          required: false
        - id: "FA-UC00-005"
          title: "Expandir/colapsar nós da árvore"
          required: false
        - id: "FE-UC00-001"
          title: "Usuário sem permissão → HTTP 403"
          required: true
        - id: "FE-UC00-002"
          title: "Nenhum tipo cadastrado → estado vazio"
          required: true
        - id: "FE-UC00-003"
          title: "Erro ao carregar dados → mensagem de erro"
          required: true

    precondicoes:
      - permissao: "CAD.ATIVOS.TIPOS.READ_ANY"

    gatilho: "Usuário acessa menu Cadastros > Tipos de Ativos"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "acessa_menu_tipos_ativos"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "carregar_tipos_tenant"
      - passo: 4
        ator: "sistema"
        acao: "aplicar_paginacao"
      - passo: 5
        ator: "sistema"
        acao: "ordenar_lista"
      - passo: 6
        ator: "sistema"
        acao: "calcular_quantidade_ativos"
      - passo: 7
        ator: "sistema"
        acao: "exibir_lista"

    fluxos_alternativos:
      - id: "FA-UC00-01"
        condicao: "usuario_aplica_filtro"
        resultado: "lista_filtrada"

    fluxos_excecao:
      - id: "FE-UC00-01"
        condicao: "sem_permissao"
        resultado: "http_403_forbidden"
      - id: "FE-UC00-02"
        condicao: "nenhum_tipo_cadastrado"
        resultado: "estado_vazio"

    regras_aplicadas:
      - "RN-RF019-001"
      - "RN-RF019-012"

    resultado_final:
      estado: "lista_exibida"

  - id: "UC01"
    nome: "Criar Tipo de Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-01"
        - "RF-VAL-01"
        - "RF-VAL-02"
        - "RF-VAL-03"
        - "RF-VAL-05"
        - "RF-SEC-01"
        - "RF-SEC-03"
      uc_items:
        - id: "FP-UC01-001"
          title: "Usuário clica em Novo Tipo"
          required: true
        - id: "FP-UC01-002"
          title: "Sistema valida permissão CAD.ATIVOS.TIPOS.CREATE"
          required: true
        - id: "FP-UC01-003"
          title: "Sistema exibe formulário com campos"
          required: true
        - id: "FP-UC01-004"
          title: "Usuário preenche campos obrigatórios e opcionais"
          required: true
        - id: "FP-UC01-005"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC01-006"
          title: "Sistema valida dados (código único, categoria, depreciação, hierarquia)"
          required: true
        - id: "FP-UC01-007"
          title: "Sistema calcula campos automáticos (Id_Fornecedor, hierarquia)"
          required: true
        - id: "FP-UC01-008"
          title: "Sistema cria registro na tabela Ativo_Tipo"
          required: true
        - id: "FP-UC01-009"
          title: "Sistema registra auditoria (INSERT)"
          required: true
        - id: "FP-UC01-010"
          title: "Sistema dispara evento TipoAtivoCriado"
          required: true
        - id: "FP-UC01-011"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC01-012"
          title: "Sistema atualiza lista/árvore"
          required: true
        - id: "FA-UC01-001"
          title: "Adicionar campos customizados"
          required: false
        - id: "FA-UC01-002"
          title: "Usar template pré-configurado"
          required: false
        - id: "FA-UC01-003"
          title: "Cancelar criação"
          required: false
        - id: "FE-UC01-001"
          title: "Código duplicado → HTTP 400"
          required: true
        - id: "FE-UC01-002"
          title: "Hardware sem depreciação → HTTP 400"
          required: true
        - id: "FE-UC01-003"
          title: "Hierarquia > 5 níveis → HTTP 400"
          required: true
        - id: "FE-UC01-004"
          title: "Loop hierárquico detectado → HTTP 400"
          required: true
        - id: "FE-UC01-005"
          title: "Taxa depreciação inválida → HTTP 400"
          required: true
        - id: "FE-UC01-006"
          title: "Erro inesperado → HTTP 500"
          required: true

    precondicoes:
      - permissao: "CAD.ATIVOS.TIPOS.CREATE"

    gatilho: "Usuário clica em Novo Tipo"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_novo_tipo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "exibir_formulario"
      - passo: 4
        ator: "usuario"
        acao: "preencher_campos"
      - passo: 5
        ator: "usuario"
        acao: "clicar_salvar"
      - passo: 6
        ator: "sistema"
        acao: "validar_dados"
      - passo: 7
        ator: "sistema"
        acao: "calcular_campos_automaticos"
      - passo: 8
        ator: "sistema"
        acao: "criar_registro"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria"
      - passo: 10
        ator: "sistema"
        acao: "disparar_evento_dominio"
      - passo: 11
        ator: "sistema"
        acao: "exibir_mensagem_sucesso"
      - passo: 12
        ator: "sistema"
        acao: "atualizar_lista"

    fluxos_excecao:
      - id: "FE-UC01-01"
        condicao: "codigo_duplicado"
        resultado: "http_400_bad_request"
      - id: "FE-UC01-02"
        condicao: "hardware_sem_depreciacao"
        resultado: "http_400_bad_request"
      - id: "FE-UC01-03"
        condicao: "hierarquia_excede_5_niveis"
        resultado: "http_400_bad_request"
      - id: "FE-UC01-04"
        condicao: "loop_hierarquico"
        resultado: "http_400_bad_request"
      - id: "FE-UC01-05"
        condicao: "taxa_depreciacao_invalida"
        resultado: "http_400_bad_request"

    regras_aplicadas:
      - "RN-RF019-001"
      - "RN-RF019-002"
      - "RN-RF019-003"
      - "RN-RF019-004"
      - "RN-RF019-007"
      - "RN-RF019-010"
      - "RN-RF019-011"
      - "RN-RF019-013"

    resultado_final:
      estado: "tipo_criado"

  - id: "UC02"
    nome: "Visualizar Tipo de Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "leitura"
    impacta_dados: false

    covers:
      rf_items:
        - "RF-CRUD-03"
        - "RF-SEC-01"
      uc_items:
        - id: "FP-UC02-001"
          title: "Usuário seleciona tipo na lista/árvore"
          required: true
        - id: "FP-UC02-002"
          title: "Sistema valida permissão CAD.ATIVOS.TIPOS.READ"
          required: true
        - id: "FP-UC02-003"
          title: "Sistema valida que tipo pertence ao tenant do usuário"
          required: true
        - id: "FP-UC02-004"
          title: "Sistema busca dados completos do tipo"
          required: true
        - id: "FP-UC02-005"
          title: "Sistema calcula quantidade de ativos vinculados"
          required: true
        - id: "FP-UC02-006"
          title: "Sistema exibe painel/modal com detalhes completos"
          required: true
        - id: "FP-UC02-007"
          title: "Usuário pode navegar para tipo pai, subtipos ou ativos"
          required: true
        - id: "FA-UC02-001"
          title: "Navegar para tipo pai"
          required: false
        - id: "FA-UC02-002"
          title: "Navegar para subtipo"
          required: false
        - id: "FA-UC02-003"
          title: "Visualizar lista de ativos vinculados"
          required: false
        - id: "FE-UC02-001"
          title: "Tipo inexistente → HTTP 404"
          required: true
        - id: "FE-UC02-002"
          title: "Tipo de outro tenant → HTTP 404"
          required: true

    precondicoes:
      - permissao: "CAD.ATIVOS.TIPOS.READ"

    gatilho: "Usuário clica em tipo na lista/árvore"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "selecionar_tipo"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "buscar_dados_completos"
      - passo: 5
        ator: "sistema"
        acao: "calcular_quantidade_ativos"
      - passo: 6
        ator: "sistema"
        acao: "exibir_painel_detalhes"

    fluxos_excecao:
      - id: "FE-UC02-01"
        condicao: "tipo_inexistente"
        resultado: "http_404_not_found"
      - id: "FE-UC02-02"
        condicao: "tipo_outro_tenant"
        resultado: "http_404_not_found"

    regras_aplicadas:
      - "RN-RF019-001"
      - "RN-RF019-002"
      - "RN-RF019-010"

    resultado_final:
      estado: "detalhes_exibidos"

  - id: "UC03"
    nome: "Editar Tipo de Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-04"
        - "RF-VAL-02"
        - "RF-VAL-03"
        - "RF-VAL-05"
        - "RF-SEC-01"
        - "RF-SEC-03"
        - "RF-SEC-04"
      uc_items:
        - id: "FP-UC03-001"
          title: "Usuário seleciona tipo e clica em Editar"
          required: true
        - id: "FP-UC03-002"
          title: "Sistema valida permissão CAD.ATIVOS.TIPOS.UPDATE"
          required: true
        - id: "FP-UC03-003"
          title: "Sistema valida que tipo pertence ao tenant"
          required: true
        - id: "FP-UC03-004"
          title: "Sistema valida que Fl_Sistema = 0"
          required: true
        - id: "FP-UC03-005"
          title: "Sistema carrega formulário pré-preenchido"
          required: true
        - id: "FP-UC03-006"
          title: "Sistema captura snapshot dos dados originais"
          required: true
        - id: "FP-UC03-007"
          title: "Usuário altera campos permitidos"
          required: true
        - id: "FP-UC03-008"
          title: "Usuário clica em Salvar"
          required: true
        - id: "FP-UC03-009"
          title: "Sistema valida alterações"
          required: true
        - id: "FP-UC03-010"
          title: "Se tipo pai mudou, recalcula hierarquia recursivamente"
          required: true
        - id: "FP-UC03-011"
          title: "Sistema atualiza registro"
          required: true
        - id: "FP-UC03-012"
          title: "Sistema atualiza campos de auditoria"
          required: true
        - id: "FP-UC03-013"
          title: "Sistema registra auditoria (UPDATE) com antes/depois"
          required: true
        - id: "FP-UC03-014"
          title: "Sistema dispara evento TipoAtivoAtualizado"
          required: true
        - id: "FP-UC03-015"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC03-016"
          title: "Sistema atualiza lista/árvore"
          required: true
        - id: "FA-UC03-001"
          title: "Cancelar edição"
          required: false
        - id: "FE-UC03-001"
          title: "Tipo de sistema (Fl_Sistema=1) → HTTP 403"
          required: true
        - id: "FE-UC03-002"
          title: "Tentar alterar Código → HTTP 400"
          required: true
        - id: "FE-UC03-003"
          title: "Tentar alterar Categoria Principal → HTTP 400"
          required: true
        - id: "FE-UC03-004"
          title: "Hierarquia > 5 níveis após mudança tipo pai → HTTP 400"
          required: true
        - id: "FE-UC03-005"
          title: "Loop hierárquico após mudança tipo pai → HTTP 400"
          required: true

    precondicoes:
      - permissao: "CAD.ATIVOS.TIPOS.UPDATE"
      - fl_sistema: 0

    gatilho: "Usuário clica em Editar"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_editar"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "validar_fl_sistema"
      - passo: 5
        ator: "sistema"
        acao: "carregar_formulario_preenchido"
      - passo: 6
        ator: "sistema"
        acao: "capturar_snapshot"
      - passo: 7
        ator: "usuario"
        acao: "alterar_campos"
      - passo: 8
        ator: "usuario"
        acao: "clicar_salvar"
      - passo: 9
        ator: "sistema"
        acao: "validar_alteracoes"
      - passo: 10
        ator: "sistema"
        acao: "recalcular_hierarquia_se_mudou_pai"
      - passo: 11
        ator: "sistema"
        acao: "atualizar_registro"
      - passo: 12
        ator: "sistema"
        acao: "atualizar_campos_auditoria"
      - passo: 13
        ator: "sistema"
        acao: "registrar_auditoria_update"
      - passo: 14
        ator: "sistema"
        acao: "disparar_evento_dominio"
      - passo: 15
        ator: "sistema"
        acao: "exibir_mensagem_sucesso"
      - passo: 16
        ator: "sistema"
        acao: "atualizar_lista"

    fluxos_excecao:
      - id: "FE-UC03-01"
        condicao: "tipo_sistema"
        resultado: "http_403_forbidden"
      - id: "FE-UC03-02"
        condicao: "tentar_alterar_codigo"
        resultado: "http_400_bad_request"
      - id: "FE-UC03-03"
        condicao: "tentar_alterar_categoria"
        resultado: "http_400_bad_request"
      - id: "FE-UC03-04"
        condicao: "hierarquia_excede_5_niveis"
        resultado: "http_400_bad_request"
      - id: "FE-UC03-05"
        condicao: "loop_hierarquico"
        resultado: "http_400_bad_request"

    regras_aplicadas:
      - "RN-RF019-002"
      - "RN-RF019-004"
      - "RN-RF019-007"
      - "RN-RF019-008"
      - "RN-RF019-009"
      - "RN-RF019-010"
      - "RN-RF019-013"

    resultado_final:
      estado: "tipo_atualizado"

  - id: "UC04"
    nome: "Excluir Tipo de Ativo"
    ator_principal: "usuario_autenticado"
    tipo: "crud"
    impacta_dados: true

    covers:
      rf_items:
        - "RF-CRUD-05"
        - "RF-VAL-04"
        - "RF-SEC-01"
        - "RF-SEC-03"
        - "RF-SEC-04"
      uc_items:
        - id: "FP-UC04-001"
          title: "Usuário seleciona tipo e clica em Excluir"
          required: true
        - id: "FP-UC04-002"
          title: "Sistema valida permissão CAD.ATIVOS.TIPOS.DELETE"
          required: true
        - id: "FP-UC04-003"
          title: "Sistema valida que tipo pertence ao tenant"
          required: true
        - id: "FP-UC04-004"
          title: "Sistema valida pré-condições (Fl_Sistema=0, sem ativos, sem subtipos)"
          required: true
        - id: "FP-UC04-005"
          title: "Sistema exibe modal de confirmação"
          required: true
        - id: "FP-UC04-006"
          title: "Usuário clica em Confirmar Exclusão"
          required: true
        - id: "FP-UC04-007"
          title: "Sistema captura snapshot dos dados"
          required: true
        - id: "FP-UC04-008"
          title: "Sistema executa soft delete (Fl_Ativo=0)"
          required: true
        - id: "FP-UC04-009"
          title: "Sistema registra auditoria (DELETE)"
          required: true
        - id: "FP-UC04-010"
          title: "Sistema dispara evento TipoAtivoExcluido"
          required: true
        - id: "FP-UC04-011"
          title: "Sistema exibe mensagem de sucesso"
          required: true
        - id: "FP-UC04-012"
          title: "Sistema remove tipo da lista/árvore"
          required: true
        - id: "FA-UC04-001"
          title: "Cancelar exclusão"
          required: false
        - id: "FE-UC04-001"
          title: "Tipo de sistema (Fl_Sistema=1) → HTTP 403"
          required: true
        - id: "FE-UC04-002"
          title: "Tipo com ativos vinculados → HTTP 400"
          required: true
        - id: "FE-UC04-003"
          title: "Tipo com subtipos ativos → HTTP 400"
          required: true
        - id: "FE-UC04-004"
          title: "Tipo já excluído (Fl_Ativo=0) → HTTP 400"
          required: true

    precondicoes:
      - permissao: "CAD.ATIVOS.TIPOS.DELETE"
      - fl_sistema: 0
      - sem_ativos_vinculados: true
      - sem_subtipos_ativos: true

    gatilho: "Usuário clica em Excluir"

    fluxo_principal:
      - passo: 1
        ator: "usuario"
        acao: "clicar_excluir"
      - passo: 2
        ator: "sistema"
        acao: "validar_permissao"
      - passo: 3
        ator: "sistema"
        acao: "validar_tenant"
      - passo: 4
        ator: "sistema"
        acao: "validar_precondicoes"
      - passo: 5
        ator: "sistema"
        acao: "exibir_modal_confirmacao"
      - passo: 6
        ator: "usuario"
        acao: "confirmar_exclusao"
      - passo: 7
        ator: "sistema"
        acao: "capturar_snapshot"
      - passo: 8
        ator: "sistema"
        acao: "executar_soft_delete"
      - passo: 9
        ator: "sistema"
        acao: "registrar_auditoria_delete"
      - passo: 10
        ator: "sistema"
        acao: "disparar_evento_dominio"
      - passo: 11
        ator: "sistema"
        acao: "exibir_mensagem_sucesso"
      - passo: 12
        ator: "sistema"
        acao: "remover_da_lista"

    fluxos_excecao:
      - id: "FE-UC04-01"
        condicao: "tipo_sistema"
        resultado: "http_403_forbidden"
      - id: "FE-UC04-02"
        condicao: "com_ativos_vinculados"
        resultado: "http_400_bad_request"
      - id: "FE-UC04-03"
        condicao: "com_subtipos_ativos"
        resultado: "http_400_bad_request"
      - id: "FE-UC04-04"
        condicao: "tipo_ja_excluido"
        resultado: "http_400_bad_request"

    regras_aplicadas:
      - "RN-RF019-005"
      - "RN-RF019-006"
      - "RN-RF019-008"
      - "RN-RF019-010"
      - "RN-RF019-015"

    resultado_final:
      estado: "tipo_excluido_logicamente"

exclusions:
  uc_items: []

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Migração v1.0 → v2.0: template canônico, adição de UC00, cobertura total RF019"
  - versao: "1.0"
    data: "2025-12-17"
    autor: "Sistema"
    descricao: "Versão inicial consolidada (4 UCs)"
