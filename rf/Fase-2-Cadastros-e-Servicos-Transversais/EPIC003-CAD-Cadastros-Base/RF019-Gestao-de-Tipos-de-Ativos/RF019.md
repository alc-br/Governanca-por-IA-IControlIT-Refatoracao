# RF019: Gestão de Tipos de Ativos

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC003-CAD-Cadastros-Base
**Fase**: Fase 2 - Cadastros e Serviços Transversais

---

## 1. OBJETIVO DO REQUISITO

Permitir a categorização, classificação e padronização de todos os ativos de TI e Telecom gerenciados pelo sistema IControlIT através de um sistema hierárquico de tipos de ativos.

Este RF define **o que o sistema deve fazer** para:
- Classificar ativos em categorias padronizadas (Hardware, Software, Linha Móvel, Linha Fixa, Serviços, etc.)
- Definir características específicas por tipo através de campos customizados
- Aplicar regras de negócio diferenciadas por tipo (depreciação, manutenção, faturamento)
- Organizar inventário com estrutura hierárquica de tipos (até 5 níveis)
- Padronizar nomenclatura e taxonomia de ativos
- Controlar atributos obrigatórios por tipo de ativo

O requisito serve como **contrato oficial** entre negócio, desenvolvimento, testes e agentes de IA, sem definir tecnologia ou interface, apenas comportamento esperado.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- ✅ CRUD completo de tipos de ativos
- ✅ Hierarquia de tipos (Tipo Pai → Subtipo) com até 5 níveis de profundidade
- ✅ Campos customizados por tipo de ativo
- ✅ Configuração de regras de depreciação por tipo
- ✅ Ícones e identificação visual para UX
- ✅ Importação em massa de tipos via CSV
- ✅ Validações e restrições de integridade
- ✅ Integração com módulo de Ativos (RF-CAD-001)
- ✅ Auditoria completa de alterações
- ✅ Relatórios de tipos mais utilizados
- ✅ Controle de atributos obrigatórios (serial, IMEI, MAC)
- ✅ Soft delete com possibilidade de restauração

### 2.2 Fora do escopo (não objetivos)

- ❌ Interface visual específica (design/layout)
- ❌ Tecnologia, framework ou linguagem de implementação
- ❌ Estratégia de deploy ou infraestrutura
- ❌ Gestão de inventário físico (coberto por outro RF)
- ❌ Depreciação contábil (cálculos são responsabilidade do módulo financeiro)
- ❌ Importação de padrões externos (UNSPSC) - pode ser futura evolução

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-------|-----------|
| **Tipo de Ativo** | Classificação que define características, comportamento e regras de negócio para um conjunto de ativos |
| **Categoria Principal** | Agrupamento macro: Hardware, Software, LinhaMovel, LinhaFixa, Servico, Licenca, Acessorio, Outro |
| **Subcategoria** | Refinamento da categoria: Desktop, Notebook, Servidor, Impressora, etc. |
| **Hierarquia** | Estrutura pai-filho de tipos (ex: Hardware → Computadores → Notebooks → Dell Latitude) |
| **Campo Customizado** | Campo adicional definido por tipo para capturar informações específicas (ex: "Tamanho da Tela" para Notebooks) |
| **Depreciação** | Perda de valor do ativo ao longo do tempo, configurável por tipo |
| **Inventariável** | Tipo que aparece em inventários físicos |
| **Rastreável** | Tipo que requer localização física |
| **Faturável** | Tipo que gera faturamento recorrente |

---

## 4. FUNCIONALIDADES COBERTAS

1. **Criar tipo de ativo** - Cadastro de novo tipo com código único, categoria, subcategoria e configurações
2. **Atualizar tipo existente** - Edição de nome, descrição, taxas de depreciação e características
3. **Consultar tipo por ID** - Busca detalhada de tipo específico
4. **Listar tipos** - Listagem paginada com filtros por categoria, status ativo
5. **Excluir tipo** - Soft delete com validação de não ter ativos associados
6. **Listar hierarquia** - Visualização em árvore da estrutura de tipos
7. **Importar tipos em massa** - Carga via CSV com validação de duplicidades
8. **Gerenciar campos customizados** - Adicionar/remover campos extras por tipo
9. **Validar integridade** - Impedir loops hierárquicos e profundidade > 5 níveis
10. **Auditar alterações** - Registro completo de quem, quando e o que mudou

---

## 5. REGRAS DE NEGÓCIO

### RN-RF019-001: Código Único por Fornecedor

**Descrição**: O código do tipo de ativo deve ser único dentro do Fornecedor.

**Justificativa**: Evitar duplicidade e confusão na identificação.

**Critério de Aceite**:
- Tentativa de criar tipo com código já existente → HTTP 400 "Já existe um tipo de ativo com este código"
- Validação case-insensitive do código
- Unicidade validada apenas para registros com Fl_Ativo = 1

---

### RN-RF019-002: Hierarquia de Tipos (Até 5 Níveis)

**Descrição**: Tipos podem ter hierarquia pai-filho com no máximo 5 níveis de profundidade.

**Justificativa**: Organização lógica sem complexidade excessiva (ex: Hardware → Computadores → Notebooks → Notebooks Dell → Dell Latitude 7490).

**Critério de Aceite**:
- Criação de tipo com Nivel_Hierarquia > 5 → HTTP 400 "Hierarquia não pode ter mais de 5 níveis"
- Caminho_Hierarquia calculado automaticamente no formato "/Pai/Filho/Neto"
- Ao alterar tipo pai, recalcular hierarquia de todos os descendentes

---

### RN-RF019-003: Categoria Principal Válida

**Descrição**: Categoria principal deve ser um dos valores permitidos: Hardware, Software, LinhaMovel, LinhaFixa, Servico, Licenca, Acessorio, Outro.

**Justificativa**: Padronização e integração com outros módulos.

**Critério de Aceite**:
- Tentativa de criar tipo com categoria inválida → HTTP 400 "Categoria inválida"
- Validação case-sensitive da categoria
- Categoria não pode ser alterada após criação (para preservar histórico)

---

### RN-RF019-004: Depreciação Obrigatória para Hardware

**Descrição**: Tipos de categoria "Hardware" devem obrigatoriamente ter taxa de depreciação e vida útil definidas.

**Justificativa**: Compliance contábil e fiscal.

**Critério de Aceite**:
- Criar tipo Hardware sem Taxa_Depreciacao_Anual → HTTP 400 "Tipos Hardware devem ter depreciação definida"
- Criar tipo Hardware sem Vida_Util_Anos → HTTP 400 "Tipos Hardware devem ter vida útil definida"
- Categorias não-Hardware podem ter depreciação opcional

---

### RN-RF019-005: Não Permitir Exclusão com Ativos Associados

**Descrição**: Tipo de ativo não pode ser excluído se houver ativos cadastrados usando este tipo.

**Justificativa**: Integridade referencial e preservação de histórico.

**Critério de Aceite**:
- Tentativa de excluir tipo com COUNT(Ativo WHERE Id_Ativo_Tipo = X) > 0 → HTTP 400 "Não é possível excluir tipo com ativos associados"
- Listar ativos associados na mensagem de erro para auxiliar usuário
- Validação ocorre antes de soft delete

---

### RN-RF019-006: Não Permitir Exclusão com Subtipos

**Descrição**: Tipo de ativo não pode ser excluído se houver subtipos (filhos na hierarquia) ativos.

**Justificativa**: Preservar integridade da árvore hierárquica.

**Critério de Aceite**:
- Tentativa de excluir tipo com COUNT(Ativo_Tipo WHERE Id_Tipo_Pai = X AND Fl_Ativo = 1) > 0 → HTTP 400 "Não é possível excluir tipo com subtipos associados"
- Sugerir exclusão dos subtipos primeiro ou reclassificação

---

### RN-RF019-007: Taxa de Depreciação Válida

**Descrição**: Taxa de depreciação anual deve estar entre 0% e 100%.

**Justificativa**: Valores fora deste range não fazem sentido contábil.

**Critério de Aceite**:
- Taxa < 0 → HTTP 400 "Taxa de depreciação deve ser >= 0"
- Taxa > 100 → HTTP 400 "Taxa de depreciação deve ser <= 100"
- Validação decimal com 2 casas (ex: 20.50)

---

### RN-RF019-008: Tipos de Sistema Não Editáveis

**Descrição**: Tipos marcados com Fl_Sistema = 1 não podem ser editados ou excluídos.

**Justificativa**: Preservar tipos padrão do sistema necessários para funcionamento core.

**Critério de Aceite**:
- Tentativa de editar tipo com Fl_Sistema = 1 → HTTP 403 "Tipo de sistema não pode ser editado"
- Tentativa de excluir tipo com Fl_Sistema = 1 → HTTP 403 "Tipo de sistema não pode ser excluído"
- Apenas Super Admin pode alterar Fl_Sistema (via script direto no banco)

---

### RN-RF019-009: Recalcular Hierarquia ao Mudar Pai

**Descrição**: Ao alterar o tipo pai de um tipo, recalcular automaticamente Nivel_Hierarquia e Caminho_Hierarquia de todos os descendentes.

**Justificativa**: Manter consistência da árvore hierárquica.

**Critério de Aceite**:
- Mudança de Id_Tipo_Pai → trigger recálculo em cascata para todos os filhos/netos/etc
- Caminho_Hierarquia atualizado no formato "/Pai/Filho/Neto"
- Validação de profundidade máxima (5) após recálculo

---

### RN-RF019-010: Auditoria Completa de Alterações

**Descrição**: Todas as operações (INSERT, UPDATE, DELETE) devem ser auditadas com dados antes/depois.

**Justificativa**: Rastreabilidade e compliance.

**Critério de Aceite**:
- INSERT → registro em Ativo_Tipo_Auditoria com Tipo_Operacao="INSERT", Dados_Depois=JSON
- UPDATE → registro com Tipo_Operacao="UPDATE", Dados_Antes=JSON, Dados_Depois=JSON
- DELETE (soft) → registro com Tipo_Operacao="DELETE", Dados_Antes=JSON
- Campos auditados: Id_Usuario, Nm_Usuario, IP_Origem, Dt_Operacao

---

### RN-RF019-011: Ícone e Cor para Identificação Visual

**Descrição**: Cada tipo deve ter ícone (Font Awesome) e cor hexadecimal para exibição visual em interfaces.

**Justificativa**: Melhorar UX e identificação rápida.

**Critério de Aceite**:
- Campo Icone aceita classes Font Awesome (ex: "fa-laptop", "fa-server")
- Campo Cor_Identificacao aceita hex color (ex: "#3498db")
- Validação de formato hex: ^#[0-9A-Fa-f]{6}$
- Ícone e cor são opcionais (podem ser NULL)

---

### RN-RF019-012: Ordem de Exibição Customizável

**Descrição**: Tipos devem ser ordenáveis via campo Ordem_Exibicao para controle de listagens.

**Justificativa**: Permitir que tipos mais usados apareçam primeiro.

**Critério de Aceite**:
- Campo Ordem_Exibicao tipo INT, padrão 100
- Listagens ordenam por Ordem_Exibicao ASC, depois Nm_Tipo ASC
- Usuário pode atualizar ordem via endpoint específico

---

### RN-RF019-013: Não Permitir Loop Hierárquico

**Descrição**: Ao definir tipo pai, validar que não cria loop (ex: A → B → C → A).

**Justificativa**: Prevenir estrutura inválida que quebra queries recursivas.

**Critério de Aceite**:
- Tentativa de criar loop → HTTP 400 "Loop hierárquico detectado: [caminho]"
- Validação recursiva percorre a hierarquia até a raiz antes de salvar
- Tipo não pode ser pai de si mesmo (Id_Tipo_Pai ≠ Id_Ativo_Tipo)

---

### RN-RF019-014: Importação em Massa com Validação

**Descrição**: Permitir importação de tipos via CSV/Excel com validação de duplicidades, hierarquia e regras de negócio.

**Justificativa**: Facilitar carga inicial e migrações.

**Critério de Aceite**:
- Arquivo CSV com colunas obrigatórias: Cd_Tipo, Nm_Tipo, Categoria_Principal
- Validação linha a linha de RNs (código único, categoria válida, depreciação obrigatória para Hardware)
- Relatório de importação: X sucessos, Y falhas com mensagens de erro por linha
- Transação atômica: sucesso total ou rollback completo

---

### RN-RF019-015: Soft Delete com Possibilidade de Restauração

**Descrição**: Exclusão lógica (Fl_Ativo = 0) com possibilidade de restauração posterior.

**Justificativa**: Prevenir perda de dados acidental.

**Critério de Aceite**:
- DELETE → UPDATE Fl_Ativo = 0 (não DELETE físico)
- Tipos com Fl_Ativo = 0 não aparecem em listagens padrão
- Endpoint específico para listar tipos inativos
- Endpoint de restauração (reativar) disponível para Super Admin

---

## 6. ESTADOS DA ENTIDADE

| Estado | Descrição | Fl_Ativo |
|--------|-----------|----------|
| **Ativo** | Tipo disponível para uso, aparece em listagens e pode ser associado a ativos | 1 |
| **Inativo** | Tipo desativado, não aparece em listagens, não pode ser associado a novos ativos | 0 |

### Transições permitidas

| De | Para | Operação |
|---|---|---|
| Ativo | Inativo | Exclusão (soft delete) via DELETE endpoint |
| Inativo | Ativo | Restauração via PUT /tipos/{id}/restaurar (apenas Super Admin) |

**Não há outros estados**: tipo é binário (ativo ou inativo).

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre | Payload |
|--------|---------------|---------|
| `TipoAtivoCriado` | Após criação bem-sucedida de tipo | `{ Id, CdTipo, NmTipo, Categoria, IdUsuario }` |
| `TipoAtivoAtualizado` | Após atualização de tipo | `{ Id, CamposAlterados, DadosAntes, DadosDepois, IdUsuario }` |
| `TipoAtivoExcluido` | Após exclusão (soft delete) | `{ Id, CdTipo, NmTipo, IdUsuario }` |
| `TipoAtivoRestaurado` | Após restauração de tipo inativo | `{ Id, CdTipo, NmTipo, IdUsuario }` |
| `HierarquiaRecalculada` | Após mudança de Id_Tipo_Pai | `{ Id, CaminhoAntigo, CaminhoNovo, DescendentesAfetados }` |

**Uso dos eventos:**
- Notificar outros módulos de mudanças em tipos
- Invalidar caches de hierarquia
- Disparar recálculo de depreciação de ativos associados
- Auditoria e logging

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- ✅ Nenhuma operação pode violar isolamento de tenant (multi-tenancy)
- ✅ Nenhuma regra de negócio pode ser ignorada
- ✅ Erros devem ser previsíveis, rastreáveis e retornar HTTP status code apropriado
- ✅ Auditoria deve registrar quem, quando e o que mudou (Dados_Antes/Dados_Depois JSON)
- ✅ Todas as 15 regras de negócio devem ser testadas com cenários positivos e negativos
- ✅ Performance: listagem de até 1000 tipos deve retornar em < 200ms
- ✅ Validações devem ocorrer tanto no backend (obrigatório) quanto no frontend (UX)

---

## 9. SEGURANÇA

### 9.1 Autenticação
- Todos os endpoints exigem autenticação JWT válida
- Token inválido ou expirado → HTTP 401 Unauthorized

### 9.2 Autorização (RBAC)
- Permissões policy-based conforme matriz da Seção 10
- Usuário sem permissão → HTTP 403 Forbidden

### 9.3 Validação de Entrada
- Sanitização de campos string (trim, escape)
- Validação de tipos de dados (GUID, decimal, int)
- Proteção contra SQL Injection (uso de Entity Framework Core)
- Proteção contra XSS (sanitização no frontend)

### 9.4 Isolamento Multi-Tenant
- Todas as queries filtram por Id_Fornecedor do usuário autenticado
- Tentativa de acesso cross-tenant → HTTP 403 Forbidden
- Validação em nível de query (Row-Level Security)

---

## 10. PERMISSÕES RBAC

### 10.1 Matriz de Permissões

| Permission Code | Descrição | Roles Autorizadas | Endpoint |
|----------------|-----------|-------------------|----------|
| `CAD.ATIVOS.TIPOS.CREATE` | Criar tipo de ativo | Super Admin, Admin, Gestor de Ativos | POST /api/ativos/tipos |
| `CAD.ATIVOS.TIPOS.READ` | Consultar tipo por ID | Super Admin, Admin, Gestor de Ativos, Analista | GET /api/ativos/tipos/{id} |
| `CAD.ATIVOS.TIPOS.READ_ANY` | Listar tipos | Super Admin, Admin, Gestor de Ativos, Analista | GET /api/ativos/tipos |
| `CAD.ATIVOS.TIPOS.UPDATE` | Atualizar tipo | Super Admin, Admin, Gestor de Ativos | PUT /api/ativos/tipos/{id} |
| `CAD.ATIVOS.TIPOS.DELETE` | Excluir tipo | Super Admin, Admin | DELETE /api/ativos/tipos/{id} |
| `CAD.ATIVOS.TIPOS.IMPORT` | Importar tipos em massa | Super Admin, Admin | POST /api/ativos/tipos/importar |
| `CAD.ATIVOS.TIPOS.RESTORE` | Restaurar tipo inativo | Super Admin | PUT /api/ativos/tipos/{id}/restaurar |
| `CAD.ATIVOS.TIPOS.CAMPOS.MANAGE` | Gerenciar campos customizados | Super Admin, Admin, Gestor de Ativos | POST /api/ativos/tipos/{id}/campos-customizados |

### 10.2 Hierarquia de Roles

```
Super Admin
├── Admin
│   ├── Gestor de Ativos
│   │   └── Analista
```

- **Super Admin**: Acesso total + operações críticas (restaurar, alterar Fl_Sistema)
- **Admin**: Acesso administrativo (CRUD completo)
- **Gestor de Ativos**: CRUD de tipos (exceto exclusão)
- **Analista**: Apenas leitura

---

## 11. API ENDPOINTS

### 11.1 Listar Tipos de Ativos

```http
GET /api/ativos/tipos?idFornecedor={guid}&categoria={string}&apenasAtivos={bool}&pageNumber={int}&pageSize={int}
Authorization: Bearer {token}
```

**Response 200 OK:**
```json
{
  "items": [
    {
      "idAtivoTipo": "guid",
      "cdTipo": "NOTE-CORP",
      "nmTipo": "Notebook Corporativo",
      "categoriaPrincipal": "Hardware",
      "subcategoria": "Notebook",
      "taxaDepreciacaoAnual": 20.00,
      "vidaUtilAnos": 5,
      "icone": "fa-laptop",
      "corIdentificacao": "#3498db",
      "quantidadeAtivos": 150
    }
  ],
  "totalCount": 85,
  "pageNumber": 1,
  "pageSize": 20
}
```

---

### 11.2 Buscar Tipo por ID

```http
GET /api/ativos/tipos/{id}
Authorization: Bearer {token}
```

**Response 200 OK:**
```json
{
  "idAtivoTipo": "guid",
  "cdTipo": "NOTE-CORP",
  "nmTipo": "Notebook Corporativo",
  "dsTipo": "Notebooks para uso corporativo padrão",
  "categoriaPrincipal": "Hardware",
  "subcategoria": "Notebook",
  "idTipoPai": null,
  "nivelHierarquia": 1,
  "caminhoHierarquia": "/Notebook Corporativo",
  "flInventariavel": true,
  "flDepreciavel": true,
  "taxaDepreciacaoAnual": 20.00,
  "vidaUtilAnos": 5,
  "metodoDepreciacao": "Linear",
  "icone": "fa-laptop",
  "corIdentificacao": "#3498db",
  "camposCustomizados": [
    {
      "cdCampo": "tamanho_tela",
      "nmCampo": "Tamanho da Tela",
      "tipoDados": "Integer",
      "flObrigatorio": true
    }
  ]
}
```

---

### 11.3 Criar Tipo de Ativo

```http
POST /api/ativos/tipos
Authorization: Bearer {token}
Content-Type: application/json
```

**Request Body:**
```json
{
  "idFornecedor": "guid",
  "cdTipo": "NOTE-EXEC",
  "nmTipo": "Notebook Executivo",
  "dsTipo": "Notebooks de alto desempenho para executivos",
  "categoriaPrincipal": "Hardware",
  "subcategoria": "Notebook",
  "idTipoPai": null,
  "flInventariavel": true,
  "flDepreciavel": true,
  "taxaDepreciacaoAnual": 25.00,
  "vidaUtilAnos": 4,
  "icone": "fa-laptop",
  "corIdentificacao": "#e74c3c"
}
```

**Response 201 Created:**
```json
{
  "sucesso": true,
  "mensagem": "Tipo de ativo criado com sucesso",
  "id": "guid"
}
```

---

### 11.4 Atualizar Tipo de Ativo

```http
PUT /api/ativos/tipos/{id}
Authorization: Bearer {token}
Content-Type: application/json
```

**Request Body:**
```json
{
  "nmTipo": "Notebook Executivo Premium",
  "dsTipo": "Notebooks de altíssimo desempenho",
  "taxaDepreciacaoAnual": 30.00,
  "vidaUtilAnos": 3
}
```

**Response 200 OK:**
```json
{
  "sucesso": true,
  "mensagem": "Tipo de ativo atualizado com sucesso"
}
```

---

### 11.5 Excluir Tipo de Ativo (Soft Delete)

```http
DELETE /api/ativos/tipos/{id}
Authorization: Bearer {token}
```

**Response 200 OK:**
```json
{
  "sucesso": true,
  "mensagem": "Tipo de ativo excluído com sucesso"
}
```

**Response 400 Bad Request (com ativos associados):**
```json
{
  "sucesso": false,
  "mensagem": "Não é possível excluir este tipo pois existem 25 ativos associados"
}
```

---

### 11.6 Listar Hierarquia de Tipos

```http
GET /api/ativos/tipos/hierarquia?idFornecedor={guid}
Authorization: Bearer {token}
```

**Response 200 OK:**
```json
{
  "tipos": [
    {
      "id": "guid-hardware",
      "codigo": "HW",
      "nome": "Hardware",
      "nivel": 1,
      "filhos": [
        {
          "id": "guid-computadores",
          "codigo": "HW-COMP",
          "nome": "Computadores",
          "nivel": 2,
          "filhos": [
            {
              "id": "guid-notebooks",
              "codigo": "NOTE",
              "nome": "Notebooks",
              "nivel": 3,
              "filhos": []
            }
          ]
        }
      ]
    }
  ]
}
```

---

### 11.7 Importar Tipos em Massa

```http
POST /api/ativos/tipos/importar?idFornecedor={guid}
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**Request Body:**
- arquivo (IFormFile): CSV com colunas: CdTipo, NmTipo, Categoria, Subcategoria, FlDepreciavel, TaxaDepreciacao, VidaUtil

**Response 200 OK:**
```json
{
  "totalLinhas": 150,
  "sucesso": 145,
  "falhas": 5,
  "erros": [
    {
      "linha": 12,
      "mensagem": "Já existe tipo com código 'DESK-01'"
    },
    {
      "linha": 45,
      "mensagem": "Categoria inválida: 'Hardwar'"
    }
  ]
}
```

---

### 11.8 Adicionar Campo Customizado

```http
POST /api/ativos/tipos/{id}/campos-customizados
Authorization: Bearer {token}
Content-Type: application/json
```

**Request Body:**
```json
{
  "cdCampo": "processador",
  "nmCampo": "Modelo do Processador",
  "tipoDados": "String",
  "flObrigatorio": true,
  "valorPadrao": "Intel Core i5"
}
```

**Response 200 OK:**
```json
{
  "sucesso": true,
  "mensagem": "Campo customizado adicionado com sucesso",
  "id": "guid"
}
```

---

## 12. MODELO DE DADOS

Referência detalhada: **MD-RF019.md** (Modelo de Dados do RF019)

### 12.1 Entidades Principais

- **Ativo_Tipo**: Tipo de ativo com hierarquia, depreciação, ícone, cor
- **Ativo_Tipo_Campo_Customizado**: Campos dinâmicos por tipo
- **Ativo_Tipo_Auditoria**: Histórico completo de alterações (INSERT, UPDATE, DELETE)

### 12.2 Relacionamentos Críticos

- Ativo_Tipo **1..N** Ativo (um tipo pode ter muitos ativos)
- Ativo_Tipo **1..N** Ativo_Tipo (hierarquia self-reference)
- Ativo_Tipo **1..N** Ativo_Tipo_Campo_Customizado (um tipo pode ter muitos campos)

### 12.3 Campos Multi-Tenancy e Auditoria

- `Id_Fornecedor` (UNIQUEIDENTIFIER) - Multi-tenancy obrigatório
- `Dt_Criacao`, `Id_Usuario_Criacao` - Auditoria de criação
- `Dt_Ult_Atualizacao`, `Id_Usuario_Atualizacao` - Auditoria de modificação
- `Fl_Ativo` (BIT) - Soft delete

---

## 13. DEPENDÊNCIAS

### 13.1 RFs Upstream (dependências diretas)

- **RF-SYS-001 (Autenticação e RBAC)** - Obrigatório para permissões
- **RF-SYS-002 (Multi-Tenancy)** - Obrigatório para isolamento por Id_Fornecedor
- **RF-SYS-003 (Auditoria)** - Obrigatório para Ativo_Tipo_Auditoria

### 13.2 RFs Downstream (dependem deste RF)

- **RF-CAD-001 (Gestão de Ativos)** - Usa Ativo_Tipo para categorizar ativos
- **RF-FIN-005 (Depreciação)** - Usa Taxa_Depreciacao_Anual e Vida_Util_Anos
- **RF-INV-002 (Inventário Físico)** - Filtra por tipos com Fl_Inventariavel = 1

### 13.3 Bibliotecas Externas

- **Entity Framework Core** - ORM para acesso ao banco
- **MediatR** - CQRS pattern (Commands/Queries)
- **FluentValidation** - Validação de comandos
- **AutoMapper** - Mapeamento Entity → DTO

---

## 14. KPIs E MÉTRICAS

| KPI | Descrição | Meta | Log Obrigatório |
|-----|-----------|------|----------------|
| Taxa de Sucesso de Criação | Percentual de tipos criados com sucesso | ≥ 95% | Sim |
| Tempo Médio de Resposta (GET /tipos) | Latência de listagem de tipos | ≤ 200ms | Sim |
| Taxa de Erros de Validação | Percentual de requests rejeitados por validação | ≤ 10% | Sim |
| Tipos com Ativos Órfãos | Tipos inativos com ativos associados | = 0 | Sim (alerta semanal) |
| Profundidade Média de Hierarquia | Nível médio da árvore de tipos | ≤ 3 níveis | Não |

---

## 15. ALERTAS CRÍTICOS

| Evento | Threshold | Severidade | Canal Notificação |
|--------|-----------|-----------|-------------------|
| Falha ao criar tipo | > 5% em 1 hora | ALTA | email, slack |
| Tentativa de acesso sem permissão | > 10 em 5 minutos | CRÍTICA | email, slack, sms |
| Loop hierárquico detectado | 1 ocorrência | CRÍTICA | email |
| Tipo de sistema alterado | 1 ocorrência | CRÍTICA | email, slack, sms |
| Importação com > 20% de falhas | 1 ocorrência | MÉDIA | email |

---

## 16. CENTRAL DE FUNCIONALIDADES

### 16.1 Registro na Central

| Campo | Valor |
|-------|-------|
| **Código** | `CAD.ATIVOS.TIPOS` |
| **Módulo** | Configurações > Cadastros |
| **Ícone** | `fa-tags` |
| **Ordem** | 130 |
| **Status** | Ativo |

### 16.2 Chaves i18n

| Chave | pt-BR | en-US | es-ES |
|-------|-------|-------|-------|
| `menu.cadastros.ativo-tipos` | Tipos de Ativos | Asset Types | Tipos de Activos |
| `titulo.ativo-tipos.lista` | Gestão de Tipos de Ativos | Asset Types Management | Gestión de Tipos de Activos |
| `titulo.ativo-tipos.criar` | Criar Tipo de Ativo | Create Asset Type | Crear Tipo de Activo |
| `titulo.ativo-tipos.editar` | Editar Tipo de Ativo | Edit Asset Type | Editar Tipo de Activo |

---

## 17. ARTEFATOS DERIVADOS

Este RF é base para:

| Artefato | Arquivo | Status |
|----------|---------|--------|
| **Casos de Uso** | `UC-RF019.md` | Obrigatório |
| **Modelo de Dados** | `MD-RF019.md` | Obrigatório |
| **Wireframes** | `WF-RF019.md` | Obrigatório |
| **Massas de Teste** | `MT-RF019.yaml` | Obrigatório |
| **Casos de Teste** | `TC-RF019.yaml` | Obrigatório |

---

## 18. RASTREABILIDADE

### 18.1 Documentação Técnica

| Artefato | Gerado | Localização |
|----------|--------|-------------|
| Casos de Uso | Sim | `docs/rf/Fase-2/.../RF019/Casos de Uso/` |
| Modelo de Dados | Sim | `docs/rf/Fase-2/.../RF019/MD-RF019.md` |
| Testes Backend | Sim | `docs/rf/Fase-2/.../RF019/Testes/Backend/` |
| Testes Sistema | Sim | `docs/rf/Fase-2/.../RF019/Testes/Sistema/` |

### 18.2 Código-Fonte

| Componente | Localização |
|-----------|-------------|
| Entity | `D:\IC2\backend\IControlIT.API/src/Domain/Entities/AtivoTipo.cs` |
| Commands | `D:\IC2\backend\IControlIT.API/src/Application/Commands/AtivoTipo/*.cs` |
| Queries | `D:\IC2\backend\IControlIT.API/src/Application/Queries/AtivoTipo/*.cs` |
| Controller | `D:\IC2\backend\IControlIT.API/src/Web/Controllers/AtivoTipoController.cs` |
| Component Angular | `D:\IC2\frontend\icontrolit-app/src/app/modules/cadastros/ativo-tipos/*.ts` |

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|--------|------|-----------|-------|
| 2.0 | 2025-12-30 | Migração v1.0 → v2.0: separação RF/RL, 11 seções, 15 RNs, sem legado | Agência ALC - alc.dev.br |
| 1.0 | 2025-12-28 | Versão inicial (mista com legado) | Equipe IControlIT + Claude AI |
