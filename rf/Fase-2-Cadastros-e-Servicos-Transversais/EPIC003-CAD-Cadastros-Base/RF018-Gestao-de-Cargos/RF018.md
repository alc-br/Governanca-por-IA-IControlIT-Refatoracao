# RF-018: Gestão de Cargos

**Versão**: 2.0
**Data**: 2025-12-30
**Autor**: Agência ALC - alc.dev.br
**EPIC**: EPIC003-CAD-Cadastros-Base
**Fase**: Fase 2 - Cadastros e Serviços Transversais

---

## 1. OBJETIVO DO REQUISITO

Descrever de forma clara, objetiva e verificável o comportamento esperado do módulo de **Gestão de Cargos** do sistema IControlIT, responsável pelo cadastro, manutenção e controle da estrutura organizacional relacionada a cargos, hierarquias, alçadas de aprovação e competências.

Este documento **não define implementação**, apenas **o que o sistema deve fazer**, sob quais condições e quais garantias devem ser preservadas.

---

## 2. ESCOPO

### 2.1 O que está dentro do escopo

- [x] Criação de cargos
- [x] Atualização de cargos existentes
- [x] Listagem de cargos com paginação e filtros
- [x] Exclusão lógica de cargos
- [x] Gerenciamento de hierarquia organizacional
- [x] Configuração de alçadas de aprovação por cargo
- [x] Matriz de competências por cargo
- [x] Faixas salariais por cargo
- [x] Associação com centro de custo padrão
- [x] Sugestão de perfil de sistema por cargo
- [x] Validações funcionais e regras de negócio
- [x] Controle de acesso e isolamento por tenant
- [x] Auditoria de operações (compliance LGPD)

### 2.2 Fora do escopo (não objetivos)

- Interface visual específica
- Tecnologia, framework ou linguagem
- Layout, UX ou identidade visual
- Estratégia de deploy ou infraestrutura
- Sincronização com Active Directory (será RF separado)
- Integração com folha de pagamento (será RF separado)

---

## 3. CONCEITOS E DEFINIÇÕES

| Termo | Definição |
|-----|---------|
| **Cargo** | Posição ocupada por um ou mais colaboradores dentro da organização. Independente do ocupante (permanece mesmo com rotatividade). |
| **Hierarquia Organizacional** | Estrutura de reporte entre cargos. Define quem supervisiona/aprova quem. Pode ter múltiplos níveis (até 10 níveis recomendados). |
| **Alçada de Aprovação** | Limite de autoridade associado a um cargo para aprovar transações (contratos, POs, faturas, etc.). |
| **Competência** | Habilidade técnica ou comportamental associada a um cargo. Cada competência tem nível esperado (1-5: iniciante a especialista). |
| **Faixa Salarial** | Range de remuneração mensal associado a um cargo (piso e teto). |
| **Centro de Custo Padrão** | Centro de custo automaticamente atribuído quando alguém assume o cargo. |
| **Tenant** | Unidade lógica de isolamento de dados (ClienteId). |
| **Usuário** | Agente autenticado que executa ações. |
| **Operação** | Ação executável sobre a entidade Cargo. |

---

## 4. FUNCIONALIDADES COBERTAS

1. Criar cargo
2. Atualizar cargo existente
3. Consultar cargo por ID
4. Listar cargos com filtros (nome, status)
5. Inativar cargo (soft delete)
6. Visualizar hierarquia organizacional (árvore)
7. Alterar supervisor de cargo
8. Gerenciar competências por cargo
9. Gerenciar faixas salariais por cargo
10. Listar ocupantes de um cargo
11. Validar código único de cargo
12. Exportar estrutura organizacional

---

## 5. REGRAS DE NEGÓCIO

### RN-RF018-001 — Código de Cargo Único por Conglomerado

**Descrição**: O código do cargo deve ser único dentro do conglomerado (multi-tenancy). Permite mesmo código em conglomerados diferentes.

**Justificativa**: Facilita integração com sistemas legados, mantém código como identificador humanamente legível.

**Critério de Aceite**:
- Código ausente ou vazio → rejeição HTTP 400
- Código duplicado no mesmo ClienteId → rejeição HTTP 409
- Código com caracteres inválidos → rejeição HTTP 400
- Formato válido: `^[A-Z0-9_-]+$` (apenas letras maiúsculas, números, underscore ou hífen)
- Tamanho: 1-20 caracteres

**Exemplos**:
- ✅ Válido: "GER_PROJ", "ANLT_TI_S1", "DIR_EXEC"
- ❌ Inválido: "ger proj" (espaço), "Gerente" (letra minúscula), "código$" (caractere especial)

---

### RN-RF018-002 — Nome de Cargo Obrigatório

**Descrição**: Todo cargo deve ter nome descritivo de 3 a 150 caracteres.

**Justificativa**: Facilita identificação visual e comunicação organizacional.

**Critério de Aceite**:
- Nome ausente ou vazio → rejeição HTTP 400
- Nome com menos de 3 caracteres → rejeição HTTP 400
- Nome com mais de 150 caracteres → rejeição HTTP 400
- Formato válido: `^[a-zA-Z0-9\s\-áéíóúàâêôãõç]+$`

**Exemplos**:
- ✅ Válido: "Gerente de Projetos", "Analista de TI Senior", "Diretor Executivo"
- ❌ Inválido: "Ger" (muito curto), nome com mais de 150 caracteres

---

### RN-RF018-003 — Hierarquia Sem Ciclos

**Descrição**: Um cargo não pode ser seu próprio supervisor, nem criar ciclos na hierarquia. Exemplo: A→B→C→A é inválido.

**Justificativa**: Evita lógica de negócio ilógica e problemas em recursão de aprovações.

**Critério de Aceite**:
- Auto-referência (cargo como próprio supervisor) → rejeição HTTP 400
- Ciclo detectado na hierarquia → rejeição HTTP 400
- Tentativa de criar ciclo ao alterar supervisor → rejeição HTTP 400

**Exemplos**:
- ✅ Válido: Gerente → Diretor → VP → CEO (cadeia linear)
- ❌ Inválido: Gerente → Diretor → Gerente (ciclo de 2 níveis)

---

### RN-RF018-004 — Alçada de Aprovação Monótona Crescente

**Descrição**: Limite de aprovação do supervisor deve ser >= limite do subordinado para manter autoridade consistente.

**Justificativa**: Evita situação onde gerente não consegue aprovar o que seu subordinado pode aprovar.

**Critério de Aceite**:
- Alçada de cargo > alçada do supervisor → rejeição HTTP 400
- Alteração de alçada que quebre regra → rejeição HTTP 400
- Alçada negativa → rejeição HTTP 400

**Exemplos**:
- ✅ Válido: CEO (R$ 1M) → VP (R$ 500K) → Gerente (R$ 100K)
- ❌ Inválido: CEO (R$ 100K) → VP (R$ 500K) (subordinado com alçada maior)

---

### RN-RF018-005 — Cargo Não Pode Ser Deletado se Tiver Ocupantes

**Descrição**: Cargo só pode ser deletado/inativado se não houver colaboradores ativos no cargo.

**Justificativa**: Previne perda de dados de ocupação de cargos.

**Critério de Aceite**:
- Tentar inativar cargo com ocupantes ativos → rejeição HTTP 409
- Mensagem de erro deve indicar quantidade de ocupantes
- Cargo sem ocupantes pode ser inativado → sucesso HTTP 204

**Exemplos**:
- ✅ Permitido: Inativar cargo "Operador de Telemarketing" (sem ocupantes)
- ❌ Bloqueado: Tentar inativar "Gerente de Projetos" (20 colaboradores ativos)

---

### RN-RF018-006 — Centro de Custo Padrão Deve Existir

**Descrição**: Ao associar um centro de custo padrão a um cargo, este CC deve estar ativo no sistema.

**Justificativa**: Evita associação com CCs extintos ou inativos.

**Critério de Aceite**:
- Centro de custo inexistente → rejeição HTTP 404
- Centro de custo inativo → rejeição HTTP 400
- Centro de custo de outro tenant → rejeição HTTP 403

**Exemplos**:
- ✅ Válido: Cargo "Gerente RH" → CC "4.1.1.01 - Recursos Humanos" (ativo)
- ❌ Inválido: Cargo → CC "9.9.9.99 - Descontinuado" (inativo)

---

### RN-RF018-007 — Competência Requerida Deve Ser Válida

**Descrição**: Competências associadas a um cargo devem existir na tabela mestre de competências e ter nível entre 1-5.

**Justificativa**: Garante consistência da matriz de competências e facilita rastreabilidade.

**Critério de Aceite**:
- Competência inexistente → rejeição HTTP 404
- Nível < 1 ou > 5 → rejeição HTTP 400
- Competência de outro tenant → rejeição HTTP 403

**Exemplos**:
- ✅ Válido: Cargo "Analista de Redes" requer "Networking" (nível 4)
- ❌ Inválido: Nível 7 (acima do máximo)

---

### RN-RF018-008 — Faixa Salarial com Validação de Ordem

**Descrição**: Salário mínimo (piso) não pode ser superior ao máximo (teto). Ambos devem ser >= salário mínimo legal.

**Justificativa**: Evita ranges inválidos e respeita legislação trabalhista.

**Critério de Aceite**:
- Piso < salário mínimo legal → rejeição HTTP 400
- Teto < Piso → rejeição HTTP 400
- Teto > 3x Piso → aviso (não bloqueia)
- Valores negativos → rejeição HTTP 400

**Exemplos**:
- ✅ Válido: Piso R$ 3.000, Teto R$ 6.000 (range 2x)
- ❌ Inválido: Piso R$ 5.000, Teto R$ 4.000 (teto < piso)

---

### RN-RF018-009 — Perfil de Sistema Sugerido Não É Obrigatório

**Descrição**: Cada cargo pode ter um perfil de sistema sugerido (ex: "Gerente" → "Gerente Financeiro"). Mas é apenas sugestão, pode ser customizado por usuário.

**Justificativa**: Acelera onboarding mas não força profiling rígido.

**Critério de Aceite**:
- Campo IdPerfilSugerido é opcional (pode ser null)
- Se informado, perfil deve existir e estar ativo → senão rejeição HTTP 404
- Sugestão não impede usuário de escolher outro perfil

---

### RN-RF018-010 — Auditoria de Todas as Mudanças

**Descrição**: Qualquer criação, alteração ou inativação de cargo deve ser auditada com usuário, data/hora e valores antes/depois.

**Justificativa**: Compliance LGPD (art. 16), rastreabilidade, forensics em caso de disputa.

**Critério de Aceite**:
- Toda operação de CREATE, UPDATE, DELETE gera registro de auditoria
- Auditoria inclui: IdUsuario, DataHora, Operacao, ValoresAntigos, ValoresNovos
- Retenção de auditoria: 7 anos (2.555 dias)
- Falha na auditoria não deve impedir operação (async)

---

### RN-RF018-011 — Isolamento por Tenant

**Descrição**: Um usuário só pode acessar cargos do seu próprio tenant (ClienteId).

**Critério de Aceite**:
- Tentativa de acesso cruzado de tenant → rejeição HTTP 403
- Todas as queries filtradas automaticamente por ClienteId
- Multi-tenancy aplicado em nível de DbContext (global query filter)

---

### RN-RF018-012 — Permissões RBAC

**Descrição**: Cada operação exige permissão explícita.

**Critério de Aceite**:
- Operação sem permissão → rejeição HTTP 403

| Operação | Permissão |
|-------|---------|
| Criar | `cargos:cargo:criar` |
| Atualizar | `cargos:cargo:editar` |
| Visualizar | `cargos:cargo:visualizar` |
| Listar | `cargos:cargo:listar` |
| Inativar | `cargos:cargo:inativar` |
| Editar Hierarquia | `cargos:hierarquia:editar` |
| Gerenciar Competências | `cargos:competencia:editar` |
| Gerenciar Faixas | `cargos:faixasalarial:editar` |
| Exportar | `cargos:relatorios:exportar` |

---

## 6. ESTADOS DA ENTIDADE

| Estado | Descrição |
|------|-----------|
| **Ativo** | Cargo disponível para uso |
| **Inativo** | Cargo inativado (soft delete) |
| **Excluído** | Cargo excluído logicamente (FlExcluido = true) |

### Transições permitidas

| De | Para |
|---|---|
| Ativo | Inativo |
| Inativo | Ativo |
| Ativo | Excluído |
| Inativo | Excluído |

---

## 7. EVENTOS DE DOMÍNIO

| Evento | Quando ocorre |
|------|--------------|
| `cargo.criado` | Após criação de cargo |
| `cargo.atualizado` | Após atualização de cargo |
| `cargo.inativado` | Após inativação de cargo |
| `cargo.hierarquia_alterada` | Após mudança de supervisor |
| `cargo.alcada_alterada` | Após mudança de alçada |
| `cargo.competencia_adicionada` | Após adicionar competência |
| `cargo.competencia_removida` | Após remover competência |
| `cargo.faixa_salarial_atualizada` | Após atualizar faixa salarial |

---

## 8. CRITÉRIOS GLOBAIS DE ACEITE

- Nenhuma operação pode violar isolamento de tenant
- Nenhuma regra de negócio pode ser ignorada
- Erros devem ser previsíveis e rastreáveis
- Auditoria deve registrar quem, quando e o que mudou
- Hierarquia nunca pode conter ciclos
- Alçadas devem ser monotonicamente crescentes na hierarquia
- Código de cargo é único por tenant
- Cargo com ocupantes não pode ser inativado

---

## 9. SEGURANÇA

- Validação de entrada obrigatória (FluentValidation)
- Proteção contra SQL Injection (LINQ to Entities)
- Proteção contra XSS (Angular built-in + CSP)
- Controle de permissões RBAC
- Isolamento multi-tenant (query filter automático)
- Soft delete obrigatório (FlExcluido flag)
- Auditoria completa (Audit.NET)

---

## 10. ENDPOINTS DA API

### 10.1 CRUD Principal

| Método | Endpoint | Descrição | Permissão |
|--------|----------|-----------|-----------|
| GET | `/api/v1/cargos` | Listar cargos com paginação | `cargos:cargo:listar` |
| GET | `/api/v1/cargos/{id}` | Obter cargo por ID | `cargos:cargo:visualizar` |
| POST | `/api/v1/cargos` | Criar novo cargo | `cargos:cargo:criar` |
| PUT | `/api/v1/cargos/{id}` | Atualizar cargo | `cargos:cargo:editar` |
| DELETE | `/api/v1/cargos/{id}` | Inativar cargo | `cargos:cargo:inativar` |

### 10.2 Operações Especiais

| Método | Endpoint | Descrição | Permissão |
|--------|----------|-----------|-----------|
| GET | `/api/v1/cargos/hierarquia/arvore` | Árvore organizacional | `cargos:hierarquia:visualizar` |
| GET | `/api/v1/cargos/{id}/subordinados` | Subordinados diretos | `cargos:hierarquia:visualizar` |
| PUT | `/api/v1/cargos/{id}/hierarquia` | Alterar supervisor | `cargos:hierarquia:editar` |
| GET | `/api/v1/cargos/{id}/competencias` | Competências requeridas | `cargos:competencia:editar` |
| POST | `/api/v1/cargos/{id}/competencias` | Adicionar competência | `cargos:competencia:editar` |
| DELETE | `/api/v1/cargos/{id}/competencias/{idComp}` | Remover competência | `cargos:competencia:editar` |
| GET | `/api/v1/cargos/{id}/faixa-salarial` | Histórico de faixas | `cargos:faixasalarial:editar` |
| POST | `/api/v1/cargos/{id}/faixa-salarial` | Nova faixa salarial | `cargos:faixasalarial:editar` |
| GET | `/api/v1/cargos/{id}/ocupantes` | Colaboradores neste cargo | `cargos:cargo:visualizar` |
| POST | `/api/v1/cargos/exportar` | Exportar Excel/CSV | `cargos:relatorios:exportar` |
| GET | `/api/v1/cargos/validar-codigo/{codigo}` | Validar código único | Público |

---

## 11. ARTEFATOS DERIVADOS

Este RF é base para:

- **UC-RF018.md** (Casos de Uso)
- **MD-RF018.md** (Modelo de Dados)
- **WF-RF018.md** (Fluxos de Trabalho)
- **TC-RF018.yaml** (Casos de Teste)
- **MT-RF018.yaml** (Massas de Teste)
- **RL-RF018.md** (Referência ao Legado)

---

## 12. RASTREABILIDADE

| Artefato | Status |
|--------|-------|
| Casos de Uso (UC) | Obrigatório |
| Modelo de Dados (MD) | Obrigatório |
| Fluxos de Trabalho (WF) | Obrigatório |
| Casos de Teste (TC) | Obrigatório |
| Massas de Teste (MT) | Obrigatório |
| Referência ao Legado (RL) | Obrigatório |

---

## CHANGELOG

| Versão | Data | Descrição | Autor |
|------|------|----------|------|
| 2.0 | 2025-12-30 | Migração v2.0 - Separação RF/RL, contrato moderno, 12 RNs | Agência ALC - alc.dev.br |
| 1.0 | 2025-01-01 | Especificação inicial com conteúdo legado | IControlIT Architect |

---

**Status**: ✅ Especificação Completa v2.0 (Contrato Moderno)
**Última Atualização**: 2025-12-30
**Próximo Passo**: Criar RL-RF018.md (Referência ao Legado)
