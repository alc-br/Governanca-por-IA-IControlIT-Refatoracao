uc:
  rf: "RF064"
  titulo: "Templates de E-mail"
  fase: "Fase 2 - Cadastros e Serviços Transversais"
  epic: "EPIC004-TPL-Templates"
  versao: "2.0"
  data: "2025-12-31"
  autor: "Agência ALC - alc.dev.br"

exclusions:
  uc_items: []

casos_de_uso:
  - id: "UC00"
    nome: "Listar Templates de E-mail"
    tipo: "leitura"
    ator: "Usuário Autenticado"
    objetivo: "Permitir a visualização de todos os templates de e-mail disponíveis com filtros, paginação e ordenação"
    precondicoes:
      - "Usuário autenticado com Bearer Token JWT válido"
      - "Permissão TPL.EMAIL.VIEW_ANY ou TPL.EMAIL.VIEW_OWN"
      - "EmpresaId definido no token JWT"
    poscondicoes:
      - "Lista de templates retornada com metadados de paginação"
      - "Templates globais (TemplateBase = true) incluídos na lista"
    gatilho: "Usuário acessa a tela de Templates de E-mail"
    regras_negocio:
      - "RN-RF064-005: Filtros: status, tipo, tags, data criação"
      - "RN-RF064-016: Multi-tenancy - templates filtrados por EmpresaId ou globais"
    endpoint: "GET /api/templates-email"
    
  - id: "UC01"
    nome: "Criar Template de E-mail"
    tipo: "escrita"
    ator: "Admin, Marketing"
    objetivo: "Permitir a criação de novos templates de e-mail responsivos em MJML com validação e prévia"
    precondicoes:
      - "Usuário autenticado com Bearer Token JWT válido"
      - "Permissão TPL.EMAIL.CREATE"
      - "EmpresaId definido no token JWT"
    poscondicoes:
      - "Template criado no banco com status Rascunho"
      - "HTML gerado compilado de MJML e armazenado"
      - "Versão inicial 1.0.0 atribuída"
      - "ID do template retornado"
    gatilho: "Usuário clica em Novo Template"
    regras_negocio:
      - "RN-RF064-001: Design responsivo obrigatório usando MJML framework"
      - "RN-RF064-008: MJML compilado para HTML otimizado para múltiplos clientes"
      - "RN-RF064-009: Variáveis dinâmicas obrigatórias com JSON Schema Draft 7"
      - "RN-RF064-012: Teste A/B automático (10% teste, 90% vencedor)"
      - "RN-RF064-016: Multi-tenancy - template associado ao EmpresaId"
    endpoint: "POST /api/templates-email"
    
  - id: "UC02"
    nome: "Visualizar Template de E-mail"
    tipo: "leitura"
    ator: "Usuário Autenticado"
    objetivo: "Exibir detalhes completos do template incluindo MJML, HTML compilado, métricas e versões"
    precondicoes:
      - "Usuário autenticado com Bearer Token JWT válido"
      - "Permissão TPL.EMAIL.VIEW_ANY ou TPL.EMAIL.VIEW_OWN"
      - "Template pertence ao EmpresaId do usuário ou é global"
    poscondicoes:
      - "Dados completos do template retornados"
      - "HTML renderizado disponível para preview"
      - "Métricas agregadas exibidas"
    gatilho: "Usuário seleciona um template na lista"
    regras_negocio:
      - "RN-RF064-013: Preview multi-dispositivo (Desktop, Tablet, Mobile)"
      - "RN-RF064-014: Métricas de engajamento (open rate, CTR, conversões)"
    endpoint: "GET /api/templates-email/{id}"
    
  - id: "UC03"
    nome: "Editar Template de E-mail"
    tipo: "escrita"
    ator: "Admin, Marketing"
    objetivo: "Permitir alteração de templates existentes com versionamento automático"
    precondicoes:
      - "Usuário autenticado com Bearer Token JWT válido"
      - "Permissão TPL.EMAIL.EDIT_ANY ou TPL.EMAIL.EDIT_OWN"
      - "Template existe e pertence ao EmpresaId do usuário"
      - "Template não está sendo usado em envio ativo"
    poscondicoes:
      - "Template atualizado no banco"
      - "Nova versão incrementada (ex: 1.0.0 → 1.1.0)"
      - "HTML recompilado e armazenado"
      - "Changelog registrado"
    gatilho: "Usuário clica em Editar Template"
    regras_negocio:
      - "RN-RF064-009: Variáveis dinâmicas validadas com JSON Schema"
      - "RN-RF064-012: Teste A/B reconfigurado se habilitado"
    endpoint: "PUT /api/templates-email/{id}"
    
  - id: "UC04"
    nome: "Inativar Template de E-mail"
    tipo: "escrita"
    ator: "Admin"
    objetivo: "Desativar template sem remover do banco (soft delete)"
    precondicoes:
      - "Usuário autenticado com Bearer Token JWT válido"
      - "Permissão TPL.EMAIL.DELETE"
      - "Template existe e pertence ao EmpresaId do usuário"
      - "Template não está sendo usado em envio agendado futuro"
    poscondicoes:
      - "Template marcado como IsDeleted = true"
      - "Template não aparece mais em listagens padrão"
      - "Dados preservados para auditoria e histórico"
    gatilho: "Usuário clica em Inativar Template"
    regras_negocio:
      - "Soft delete - dados não são fisicamente removidos"
    endpoint: "DELETE /api/templates-email/{id}"

matriz_rastreabilidade:
  cobertura_rf:
    total_items_rf: 5
    items_cobertos: 5
    cobertura_crud:
      - item: "RF-CRUD-01"
        uc: "UC01"
      - item: "RF-CRUD-02"
        uc: "UC00"
      - item: "RF-CRUD-03"
        uc: "UC02"
      - item: "RF-CRUD-04"
        uc: "UC03"
      - item: "RF-CRUD-05"
        uc: "UC04"
    percentual: "100%"
    
  cobertura_rn:
    total_rns: 18
    rns_cobertas: 8
    mapeamento:
      - rn: "RN-RF064-001"
        ucs: ["UC01"]
      - rn: "RN-RF064-005"
        ucs: ["UC00"]
      - rn: "RN-RF064-008"
        ucs: ["UC01"]
      - rn: "RN-RF064-009"
        ucs: ["UC01", "UC03"]
      - rn: "RN-RF064-012"
        ucs: ["UC01", "UC03"]
      - rn: "RN-RF064-013"
        ucs: ["UC02"]
      - rn: "RN-RF064-014"
        ucs: ["UC02"]
      - rn: "RN-RF064-016"
        ucs: ["UC00", "UC01"]
    percentual_prioridade_alta: "100%"
    
  endpoints:
    - endpoint: "GET /api/templates-email"
      uc: "UC00"
      verbo: "GET"
    - endpoint: "POST /api/templates-email"
      uc: "UC01"
      verbo: "POST"
    - endpoint: "GET /api/templates-email/{id}"
      uc: "UC02"
      verbo: "GET"
    - endpoint: "PUT /api/templates-email/{id}"
      uc: "UC03"
      verbo: "PUT"
    - endpoint: "DELETE /api/templates-email/{id}"
      uc: "UC04"
      verbo: "DELETE"

historico:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica v2.0 conforme template oficial"

changelog:
  - versao: "2.0"
    data: "2025-12-31"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão canônica v2.0 conforme template oficial"
