# Casos de Uso - RF063

**VersÃ£o:** 1.0
**Data:** 2025-12-17
**RF Relacionado:** [RF063 - Motor-de-Templates-Template-Engine](./RF063.md)

---

## Ãndice de Casos de Uso

| UC | Nome | DescriÃ§Ã£o |
|----|------|-----------|
| UC00 | UC00 - Listar Templates de E-mail | Caso de uso |
| UC00 | UC00 - Listar Templates de RelatÃ³rios | Caso de uso |
| UC00 | UC00 - Listar Templates | Caso de uso |
| UC01 | UC01 - Criar Template | Caso de uso |
| UC02 | UC02 - Visualizar Template | Caso de uso |
| UC03 | UC03 - Editar Template | Caso de uso |
| UC04 | UC04 - Inativar Template | Caso de uso |
| UC06 | UC06 - Versionar Template | Caso de uso |
| UC07 | UC07 - Testar Template | Caso de uso |
| UC08 | UC08 - Publicar Template | Caso de uso |
| UC09 | UC09 - Clonar Template | Caso de uso |

---

# UC00 - Listar Templates de E-mail

## 1. CabeÃ§alho

| Item | DescriÃ§Ã£o |
|------|-----------|
| **RF** | RF-090 - Templates de E-mail Transacionais e Marketing |
| **CÃ³digo UC** | UC00 |
| **Nome** | Listar Templates de E-mail |
| **Ator Principal** | Administrador, Marketing, Developer |
| **Complexidade** | Baixa |
| **Estimativa Backend** | 2 horas (Query, Dto, Handler, Validator) |
| **Estimativa Frontend** | 3 horas (List component, Service, Table com filtros) |
| **Estimativa Testes** | 2 horas (Unit + Integration + E2E) |
| **VersÃ£o** | 1.0 |
| **Data** | 2025-01-20 |

---

## 2. Objetivo

Permitir que usuÃ¡rios visualizem a lista de todos os templates de e-mail cadastrados no sistema, filtrando por tipo (Transacional, Marketing, NotificaÃ§Ã£o), status (Ativo/Inativo), data de criaÃ§Ã£o e nome. Suportar paginaÃ§Ã£o, ordenaÃ§Ã£o e busca textual.

---

## 3. PrÃ©-condiÃ§Ãµes

- [x] UsuÃ¡rio autenticado no sistema
- [x] UsuÃ¡rio possui permissÃ£o `EMAIL_TEMPLATES.VIEW` ou perfil `Admin`/`Marketing`
- [x] Banco de dados possui tabela `Email_Template` criada
- [x] Frontend carregou componente de listagem de templates

---

## 4. DependÃªncias de Desenvolvimento

### 4.1 RFs Externos
| RF | UC | Tipo | DescriÃ§Ã£o |
|----|-----|------|-----------|
| RF-001 | UC00-listar-configuracoes | Leitura | Buscar configuraÃ§Ãµes de paginaÃ§Ã£o padrÃ£o |
| RF-008 | UC00-listar-usuarios | Leitura | Obter nome do criador do template |
| RF-063 | UC00-listar-templates | Leitura | Herda estrutura base de template |

### 4.2 IntegraÃ§Ãµes Backend
- **PermissÃµes**: `EMAIL_TEMPLATES.VIEW` via RBAC
- **Auditoria**: Registrar listagem via `AuditInterceptor`
- **Multi-tenancy**: Filtro automÃ¡tico por `Id_Conglomerado` via Global Query Filter
- **Cache**: Opcional (cache de 5 minutos para templates ativos)

### 4.3 DependÃªncias de UCs (ordem de implementaÃ§Ã£o)
| Depende de | Motivo |
|------------|--------|
| _(nenhuma)_ | Primeiro UC do RF-090 (operaÃ§Ã£o bÃ¡sica de leitura) |

### 4.4 Endpoints Chamados
- `GET /api/v1/email-templates?page=1&size=10&tipo=Marketing&fl_ativo=1&search=Boas-vindas`

---

## 5. Fluxo Principal

| Passo | Ator | AÃ§Ã£o | Sistema |
|-------|------|------|---------|
| 1 | UsuÃ¡rio | Acessa menu "E-mail > Templates" | Carrega tela de listagem |
| 2 | UsuÃ¡rio | Visualiza grid com templates | Exibe colunas: Nome, Tipo, Assunto, Status, Ãšltima AtualizaÃ§Ã£o, AÃ§Ãµes |
| 3 | UsuÃ¡rio | _(Opcional)_ Aplica filtro por tipo | Recarrega grid filtrando por tipo selecionado |
| 4 | UsuÃ¡rio | _(Opcional)_ Busca por nome | Recarrega grid com templates que contÃ©m texto no nome ou assunto |
| 5 | Sistema | Exibe resultados paginados | Grid mostra 10 templates por pÃ¡gina (configurÃ¡vel) |

**Resultado**: Lista de templates exibida com sucesso, permitindo navegaÃ§Ã£o e filtragem.

---

## 6. Fluxos Alternativos

### FA-01: Nenhum Template Cadastrado
- **Gatilho**: Banco de dados vazio ou filtro sem resultados
- **Fluxo**:
  1. Sistema exibe mensagem: "Nenhum template encontrado. Clique em 'Novo' para criar seu primeiro template."
  2. Exibe botÃ£o "Novo Template" centralizado
- **Resultado**: UsuÃ¡rio Ã© incentivado a criar primeiro template

### FA-02: Filtrar por Tipo de E-mail
- **Gatilho**: UsuÃ¡rio seleciona dropdown "Tipo"
- **Fluxo**:
  1. UsuÃ¡rio seleciona "Transacional", "Marketing" ou "NotificaÃ§Ã£o"
  2. Sistema recarrega grid com filtro aplicado
  3. Exibe contador: "15 templates encontrados"
- **Resultado**: Grid filtrado por tipo especÃ­fico

### FA-03: Filtrar por Status (Ativo/Inativo)
- **Gatilho**: UsuÃ¡rio seleciona toggle "Mostrar Inativos"
- **Fluxo**:
  1. Sistema inclui templates inativos (`Fl_Ativo = 0`) nos resultados
  2. Templates inativos exibidos em cinza com label "Inativo"
- **Resultado**: VisualizaÃ§Ã£o de templates ativos e inativos

### FA-04: Busca Textual
- **Gatilho**: UsuÃ¡rio digita no campo de busca
- **Fluxo**:
  1. UsuÃ¡rio digita termo (mÃ­nimo 3 caracteres)
  2. Sistema aguarda 500ms (debounce)
  3. Busca em: `Nome_Template`, `Assunto_Template`
  4. Recarrega grid com resultados
- **Resultado**: Busca full-text funcionando

### FA-05: OrdenaÃ§Ã£o por Coluna
- **Gatilho**: UsuÃ¡rio clica no cabeÃ§alho de coluna
- **Fluxo**:
  1. Sistema ordena por coluna selecionada (ASC na primeira vez, DESC na segunda)
  2. Exibe Ã­cone de seta indicando direÃ§Ã£o da ordenaÃ§Ã£o
- **Resultado**: Grid ordenado pela coluna desejada

### FA-06: PaginaÃ§Ã£o
- **Gatilho**: Mais de 10 templates cadastrados
- **Fluxo**:
  1. Sistema exibe paginaÃ§Ã£o no rodapÃ© do grid
  2. UsuÃ¡rio navega entre pÃ¡ginas com botÃµes "Anterior/PrÃ³ximo"
  3. Exibe informaÃ§Ã£o: "Mostrando 1-10 de 45 registros"
- **Resultado**: NavegaÃ§Ã£o entre pÃ¡ginas funcional

---

## 7. Fluxos de ExceÃ§Ã£o

### FE-01: Erro de PermissÃ£o
- **Gatilho**: UsuÃ¡rio sem permissÃ£o `EMAIL_TEMPLATES.VIEW`
- **AÃ§Ã£o**: Retornar HTTP 403 Forbidden
- **Mensagem**: "VocÃª nÃ£o tem permissÃ£o para visualizar templates de e-mail."
- **RecuperaÃ§Ã£o**: Contatar administrador para solicitar acesso

### FE-02: Erro de ComunicaÃ§Ã£o com API
- **Gatilho**: Backend indisponÃ­vel ou timeout
- **AÃ§Ã£o**: Exibir mensagem de erro genÃ©rica
- **Mensagem**: "Erro ao carregar templates. Tente novamente em instantes."
- **RecuperaÃ§Ã£o**: BotÃ£o "Tentar Novamente" recarrega a tela

### FE-03: Query InvÃ¡lida
- **Gatilho**: ParÃ¢metros de filtro invÃ¡lidos (ex: `tipo=InvalidType`)
- **AÃ§Ã£o**: Retornar HTTP 400 Bad Request
- **Mensagem**: "Filtro invÃ¡lido. Tipos permitidos: Transacional, Marketing, NotificaÃ§Ã£o."
- **RecuperaÃ§Ã£o**: Frontend valida tipos antes de enviar

### FE-04: Timeout de Cache
- **Gatilho**: Cache Redis indisponÃ­vel
- **AÃ§Ã£o**: Buscar diretamente do banco sem cache
- **Log**: Warning "Redis cache unavailable, falling back to database"
- **RecuperaÃ§Ã£o**: OperaÃ§Ã£o continua sem cache (performance reduzida)

---

## 8. Regras de NegÃ³cio

### RN-UC00-001: Multi-Tenancy ObrigatÃ³rio
- **DescriÃ§Ã£o**: Listar APENAS templates do conglomerado do usuÃ¡rio logado ou templates globais
- **ValidaÃ§Ã£o**:
  - Query Filter: `WHERE (Id_Conglomerado = @IdConglomeradoUsuario OR Id_Conglomerado IS NULL)`
  - Templates globais (`Id_Conglomerado = NULL`) sÃ£o visÃ­veis para todos

### RN-UC00-002: OrdenaÃ§Ã£o PadrÃ£o
- **DescriÃ§Ã£o**: Templates ordenados por data de atualizaÃ§Ã£o decrescente (mais recentes primeiro)
- **ValidaÃ§Ã£o**: `ORDER BY Dt_Ultima_Modificacao DESC, Nome_Template ASC`

### RN-UC00-003: Limite de PaginaÃ§Ã£o
- **DescriÃ§Ã£o**: Tamanho de pÃ¡gina entre 10 e 100 registros
- **ValidaÃ§Ã£o**:
  - Valor padrÃ£o: 10 (configurÃ¡vel via RF-001)
  - MÃ¡ximo: 100 (proteÃ§Ã£o contra sobrecarga)
  - Se `size > 100`, forÃ§ar `size = 100`

### RN-UC00-004: Cache de Resultados
- **DescriÃ§Ã£o**: Resultados de listagem podem ser cacheados por 5 minutos
- **ValidaÃ§Ã£o**:
  - Cache key: `email-templates:list:{Id_Conglomerado}:{filtros_hash}`
  - Invalidar ao criar/editar/deletar qualquer template
  - TTL: 300 segundos (5 minutos)

### RN-UC00-005: Exibir MÃ©tricas de Uso
- **DescriÃ§Ã£o**: Grid deve exibir quantidade de envios realizados com cada template
- **ValidaÃ§Ã£o**:
  - Agregar de `Email_Envio_Log WHERE Id_Template = X`
  - Exibir em coluna "Total de Envios"
  - Tooltip com detalhes: "45 envios (Ãºltimos 30 dias)"

---

## 9. Requisitos NÃ£o-Funcionais

### Performance
- Tempo de resposta: < 500ms para atÃ© 1000 templates
- Query otimizada com Ã­ndices em: `Id_Conglomerado`, `Tipo_Email`, `Fl_Ativo`, `Dt_Ultima_Modificacao`
- Cache Redis habilitado para queries frequentes

### SeguranÃ§a
- ValidaÃ§Ã£o obrigatÃ³ria de permissÃµes RBAC
- Filtragem automÃ¡tica por multi-tenancy (nÃ£o confiar no frontend)
- SQL Injection: Protegido via EF Core Parameterized Queries

### Usabilidade
- Grid responsivo (mobile, tablet, desktop)
- Skeleton loader enquanto carrega dados
- Feedback visual para filtros aplicados

### Acessibilidade
- Tabela com headers semÃ¢nticos (`<th>`)
- Suporte a navegaÃ§Ã£o por teclado (Tab, Enter, Esc)
- ARIA labels em botÃµes de aÃ§Ã£o

---

## 10. Interface UI (Wireframes)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ E-mail > Templates de E-mail                                 [Novo] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Buscar...  [Tipo: Todos â–¼] [â˜ Mostrar Inativos]  [â†» Atualizar]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nome   â”‚ Tipo        â”‚ Assunto             â”‚ Status  â”‚ AÃ§Ãµes        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Boas-  â”‚ Transacionalâ”‚ Bem-vindo ao IControâ”‚ ğŸŸ¢ Ativoâ”‚ ğŸ‘ï¸ ğŸ“ ğŸ—‘ï¸      â”‚
â”‚ vindas â”‚             â”‚ lIT!                â”‚         â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ News   â”‚ Marketing   â”‚ Novidades de Dezembrâ”‚ ğŸŸ¢ Ativoâ”‚ ğŸ‘ï¸ ğŸ“ ğŸ—‘ï¸      â”‚
â”‚ letter â”‚             â”‚ o 2025              â”‚         â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reset  â”‚ Transacionalâ”‚ Redefinir sua senha â”‚ ğŸ”´ Inatiâ”‚ ğŸ‘ï¸ ğŸ“ âœ…      â”‚
â”‚ Senha  â”‚             â”‚                     â”‚ vo      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Mostrando 1-10 de 45 registros            [â—€ 1 2 3 ... 5 â–¶]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Legenda de AÃ§Ãµes:**
- ğŸ‘ï¸ Visualizar
- ğŸ“ Editar
- ğŸ—‘ï¸ Inativar
- âœ… Reativar

**Cores de Status:**
- ğŸŸ¢ Verde: Ativo
- ğŸ”´ Vermelho: Inativo

---

## 11. Mensagens ao UsuÃ¡rio

### Sucesso
- âœ… "45 templates encontrados."
- âœ… "Filtros aplicados com sucesso."

### Info
- â„¹ï¸ "Nenhum template encontrado. Clique em 'Novo' para criar."
- â„¹ï¸ "Mostrando templates ativos. Marque 'Mostrar Inativos' para ver todos."

### Erro
- âŒ "Erro ao carregar templates. Tente novamente."
- âŒ "VocÃª nÃ£o tem permissÃ£o para visualizar templates de e-mail."

---

## 12. Testes

### CenÃ¡rios de Teste Backend
- [ ] **TC-UC00-001**: Listar templates ativos do conglomerado do usuÃ¡rio
  - **Dado**: 10 templates ativos, 5 inativos no conglomerado A
  - **Quando**: UsuÃ¡rio do conglomerado A lista templates (sem filtro)
  - **EntÃ£o**: Retorna 10 templates ativos ordenados por data desc

- [ ] **TC-UC00-002**: Filtrar por tipo "Marketing"
  - **Dado**: 5 templates transacionais, 3 marketing
  - **Quando**: UsuÃ¡rio filtra por `tipo=Marketing`
  - **EntÃ£o**: Retorna apenas 3 templates de marketing

- [ ] **TC-UC00-003**: Busca textual por nome
  - **Dado**: Templates "Boas-vindas", "Newsletter Dezembro", "Reset Senha"
  - **Quando**: UsuÃ¡rio busca "Boas"
  - **EntÃ£o**: Retorna apenas "Boas-vindas"

- [ ] **TC-UC00-004**: PaginaÃ§Ã£o funcional
  - **Dado**: 45 templates cadastrados
  - **Quando**: UsuÃ¡rio acessa pÃ¡gina 3 (size=10)
  - **EntÃ£o**: Retorna templates 21-30

- [ ] **TC-UC00-005**: Multi-tenancy isolado
  - **Dado**: 5 templates do conglomerado A, 3 do conglomerado B
  - **Quando**: UsuÃ¡rio do conglomerado A lista templates
  - **EntÃ£o**: Retorna apenas 5 templates (sem vazamento de dados)

### CenÃ¡rios de Teste Frontend
- [ ] **TC-UC00-006**: Grid carrega com skeleton loader
  - **Quando**: Tela Ã© carregada
  - **EntÃ£o**: Exibe skeleton loader antes de mostrar dados

- [ ] **TC-UC00-007**: Filtro por tipo funcional
  - **Quando**: UsuÃ¡rio seleciona "Transacional" no dropdown
  - **EntÃ£o**: Grid recarrega com apenas templates transacionais

- [ ] **TC-UC00-008**: AÃ§Ãµes contextuais por status
  - **Dado**: Template ativo e inativo no grid
  - **EntÃ£o**: Template ativo tem aÃ§Ã£o "Inativar", inativo tem "Reativar"

### CenÃ¡rios de SeguranÃ§a
- [ ] **TC-UC00-009**: UsuÃ¡rio sem permissÃ£o
  - **Dado**: UsuÃ¡rio sem `EMAIL_TEMPLATES.VIEW`
  - **Quando**: Tenta acessar tela de listagem
  - **EntÃ£o**: Retorna HTTP 403 com mensagem de erro

- [ ] **TC-UC00-010**: SQL Injection protegido
  - **Quando**: UsuÃ¡rio envia `search='; DROP TABLE Email_Template;--`
  - **EntÃ£o**: Query parametrizada nÃ£o executa SQL injection

---

## 13. Rastreabilidade

### Origem
- **RF-090**: SeÃ§Ã£o "Funcionalidades Principais" (item 1 - Listagem)
- **RN-TPL-002-14**: Multi-Tenancy por Conglomerado

### Impacto
- **UC01-criar-template**: ApÃ³s criar template, retorna para listagem
- **UC03-editar-template**: ApÃ³s editar, retorna para listagem atualizada
- **UC04-inativar-template**: Inativa template diretamente da listagem

### Documentos Relacionados
- **MD-Email-Template**: Modelo de dados da tabela `Email_Template`
- **GUIA-DEVELOPER.md**: PadrÃµes de paginaÃ§Ã£o e filtros

---

**Ãšltima AtualizaÃ§Ã£o**: 2025-01-20
**Autor**: Equipe IControlIT
**Revisor**: Arquiteto de Software

---

# UC00 - Listar Templates de RelatÃ³rios

## 1. CabeÃ§alho

| Item | DescriÃ§Ã£o |
|------|-----------|
| **RF** | RF-019 - Templates de RelatÃ³rios Excel e PDF AvanÃ§ados |
| **CÃ³digo UC** | UC00 |
| **Nome** | Listar Templates de RelatÃ³rios |
| **Ator Principal** | Administrador, Analista, Gerente |
| **Complexidade** | Baixa |
| **Estimativa Backend** | 2 horas |
| **Estimativa Frontend** | 3 horas |
| **Estimativa Testes** | 2 horas |
| **VersÃ£o** | 1.0 |
| **Data** | 2025-01-20 |

---

## 2. Objetivo

Listar todos os templates de relatÃ³rios cadastrados, filtrando por tipo de saÃ­da (Excel/PDF/CSV), categoria (Financeiro, Operacional, Gerencial), status e permitindo busca textual.

---

## 3. DependÃªncias

### 3.1 RFs Externos
| RF | UC | DescriÃ§Ã£o |
|----|-----|-----------|
| RF-001 | UC00 | ConfiguraÃ§Ãµes de paginaÃ§Ã£o |
| RF-008 | UC00 | Obter criador do template |
| RF-063 | UC00 | Estrutura base de listagem |

### 3.2 Endpoints
- `GET /api/v1/report-templates?page=1&size=10&tipo=Excel&categoria=Financeiro`

---

## 4. Fluxo Principal

| Passo | Ator | AÃ§Ã£o | Sistema |
|-------|------|------|---------|
| 1 | UsuÃ¡rio | Acessa "RelatÃ³rios > Templates" | Carrega grid de templates |
| 2 | Sistema | Exibe templates | Colunas: Nome, Tipo SaÃ­da, Categoria, Ãšltima GeraÃ§Ã£o, AÃ§Ãµes |
| 3 | UsuÃ¡rio | _(Opcional)_ Filtra por tipo saÃ­da | Excel, PDF, CSV, JSON |
| 4 | UsuÃ¡rio | _(Opcional)_ Filtra por categoria | Financeiro, Operacional, Gerencial |
| 5 | Sistema | Exibe resultados paginados | 10 templates por pÃ¡gina |

---

## 5. Regras de NegÃ³cio

**RN-UC00-001**: Multi-Tenancy - Listar apenas templates do conglomerado ou globais

**RN-UC00-002**: OrdenaÃ§Ã£o padrÃ£o por Ãºltima geraÃ§Ã£o (templates mais usados primeiro)

---

## 6. Interface UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Templates de RelatÃ³rios                                  [Novo] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Buscar... [Tipo: Todos â–¼] [Categoria: Todos â–¼]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nome       â”‚ Tipo    â”‚ Categoria   â”‚ Ãšltima GeraÃ§Ã£oâ”‚ AÃ§Ãµes      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Vendas Mensalâ”‚ Excel â”‚ Financeiro  â”‚ Hoje, 08:00  â”‚ ğŸ‘ï¸ ğŸ“ ğŸ“Š ğŸ—‘ï¸ â”‚
â”‚ Faturamento â”‚ PDF    â”‚ Gerencial   â”‚ Ontem, 14:30 â”‚ ğŸ‘ï¸ ğŸ“ ğŸ“Š ğŸ—‘ï¸ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Testes

- [ ] **TC-UC00-001**: Listar templates ativos do conglomerado
- [ ] **TC-UC00-002**: Filtrar por tipo "Excel"
- [ ] **TC-UC00-003**: Busca textual por nome
- [ ] **TC-UC00-004**: Multi-tenancy isolado

---

---

# UC00 - Listar Templates

**RF**: RF-063 - Motor de Templates (Template Engine)
**Ator**: Administrador do Sistema, Desenvolvedor de Templates, Gerente
**Complexidade**: Baixa
**Estimativa**: 7h (2h backend + 3h frontend + 2h testes)

---

## 1. OBJETIVO

Permitir que usuÃ¡rios autorizados visualizem e pesquisem a lista de templates cadastrados no sistema, com filtros, paginaÃ§Ã£o e ordenaÃ§Ã£o.

---

## 2. PRÃ‰-CONDIÃ‡Ã•ES

1. UsuÃ¡rio deve estar autenticado no sistema
2. UsuÃ¡rio deve ter permissÃ£o `templates:template:read`
3. Sistema deve estar conectado ao banco de dados
4. Pelo menos um template deve estar cadastrado (ou lista vazia serÃ¡ exibida)

---

## 3. DEPENDÃŠNCIAS DE DESENVOLVIMENTO

### PrÃ©-requisitos TÃ©cnicos
- Tabela `Templates` criada no banco de dados
- Entidade `Template` definida no Domain
- Query `GetTemplatesQuery` implementada (CQRS)
- Endpoint GET `/api/templates` criado

### Ordem de ImplementaÃ§Ã£o
1. **Backend**: Criar entidade Template
2. **Backend**: Implementar GetTemplatesQuery + Handler
3. **Backend**: Criar endpoint `/api/templates`
4. **Frontend**: Criar service TemplatesService
5. **Frontend**: Criar component templates-list
6. **Frontend**: Integrar com i18n, auditoria, RBAC

### IntegraÃ§Ãµes com Outros RFs
- **RF-001 (ConfiguraÃ§Ãµes)**: Busca configuraÃ§Ã£o de paginaÃ§Ã£o padrÃ£o
- **RF-008 (UsuÃ¡rios)**: Exibe nome do usuÃ¡rio que criou template
- **RF-063 (Perfis)**: Valida permissÃµes de acesso

---

## 4. FLUXO PRINCIPAL

**FP01 - Listar Templates com Sucesso**

| Passo | Ator | AÃ§Ã£o | Sistema |
|-------|------|------|---------|
| 1 | UsuÃ¡rio | Acessa menu "Gerenciar Templates" | Carrega lista de templates |
| 2 | Sistema | - | Busca templates no banco (SELECT com JOIN) |
| 3 | Sistema | - | Aplica filtros de multi-tenancy (empresaId) |
| 4 | Sistema | - | Ordena por nome ASC (padrÃ£o) |
| 5 | Sistema | - | Pagina resultados (20 por pÃ¡gina padrÃ£o) |
| 6 | Sistema | - | Retorna JSON com { items, total, page, pageSize } |
| 7 | Sistema | Exibe tabela com templates | Renderiza lista na UI |
| 8 | UsuÃ¡rio | Visualiza lista | VÃª nome, tipo, status, data criaÃ§Ã£o |

**Campos Exibidos na Lista:**
- Nome do Template
- Tipo (Documento, Email, RelatÃ³rio)
- Status (Ativo/Inativo)
- Data de CriaÃ§Ã£o
- Criado por (nome do usuÃ¡rio)
- AÃ§Ãµes (Visualizar, Editar, Inativar)

---

## 5. FLUXOS ALTERNATIVOS

### FA01 - Filtrar por Nome

**Diverge no passo 1 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 1a | UsuÃ¡rio digita "Contrato" no campo de busca |
| 1b | Sistema aplica filtro WHERE Nome LIKE '%Contrato%' |
| 1c | Retorna apenas templates que contenham "Contrato" no nome |
| 1d | Retorna ao passo 7 do FP01 |

### FA02 - Filtrar por Tipo

**Diverge no passo 1 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 2a | UsuÃ¡rio seleciona tipo "Email" no dropdown |
| 2b | Sistema aplica filtro WHERE Tipo = 'Email' |
| 2c | Retorna apenas templates do tipo Email |
| 2d | Retorna ao passo 7 do FP01 |

### FA03 - Filtrar por Status

**Diverge no passo 1 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 3a | UsuÃ¡rio seleciona status "Ativo" |
| 3b | Sistema aplica filtro WHERE Ativo = true |
| 3c | Retorna apenas templates ativos |
| 3d | Retorna ao passo 7 do FP01 |

### FA04 - Ordenar por Coluna

**Diverge no passo 1 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 4a | UsuÃ¡rio clica no cabeÃ§alho "Data de CriaÃ§Ã£o" |
| 4b | Sistema ordena por DataCriacao DESC |
| 4c | UsuÃ¡rio clica novamente |
| 4d | Sistema ordena por DataCriacao ASC |
| 4e | Retorna ao passo 7 do FP01 |

### FA05 - Navegar entre PÃ¡ginas

**Diverge no passo 7 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 5a | UsuÃ¡rio clica em "PrÃ³xima PÃ¡gina" |
| 5b | Sistema carrega pÃ¡gina 2 (offset = 20) |
| 5c | MantÃ©m filtros e ordenaÃ§Ã£o aplicados |
| 5d | Retorna ao passo 7 do FP01 |

### FA06 - Alterar Tamanho de PÃ¡gina

**Diverge no passo 7 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 6a | UsuÃ¡rio seleciona "50 por pÃ¡gina" |
| 6b | Sistema recarrega lista com pageSize=50 |
| 6c | Volta para pÃ¡gina 1 |
| 6d | Retorna ao passo 7 do FP01 |

### FA07 - Exportar Lista (Excel/CSV)

**Diverge no passo 7 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 7a | UsuÃ¡rio clica em "Exportar" |
| 7b | Sistema gera arquivo Excel/CSV com lista completa (sem paginaÃ§Ã£o) |
| 7c | Sistema registra auditoria de exportaÃ§Ã£o |
| 7d | Download do arquivo inicia |
| 7e | Retorna ao passo 7 do FP01 |

---

## 6. FLUXOS DE EXCEÃ‡ÃƒO

### FE01 - Lista Vazia

**Ocorre no passo 2 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 2e1 | Sistema nÃ£o encontra templates |
| 2e2 | Retorna lista vazia { items: [], total: 0 } |
| 2e3 | Exibe mensagem "Nenhum template encontrado" |
| 2e4 | Exibe botÃ£o "Criar Primeiro Template" |

### FE02 - Erro de ConexÃ£o com Banco

**Ocorre no passo 2 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 2e1 | Sistema tenta conectar ao banco |
| 2e2 | Timeout ou erro de conexÃ£o |
| 2e3 | Toast de erro: "Erro ao carregar templates. Tente novamente." |
| 2e4 | Log detalhado no servidor |
| 2e5 | BotÃ£o "Tentar Novamente" disponÃ­vel |

### FE03 - Sem PermissÃ£o

**Ocorre no passo 1 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 1e1 | Sistema valida permissÃ£o `templates:template:read` |
| 1e2 | UsuÃ¡rio nÃ£o possui permissÃ£o |
| 1e3 | Retorna 403 Forbidden |
| 1e4 | Exibe pÃ¡gina "Acesso Negado" |
| 1e5 | Log de tentativa de acesso nÃ£o autorizado |

### FE04 - Timeout na Pesquisa

**Ocorre no passo 2 do FP01**

| Passo | AÃ§Ã£o |
|-------|------|
| 4e1 | Query leva mais de 30 segundos |
| 4e2 | Sistema cancela query |
| 4e3 | Toast de erro: "Pesquisa demorou muito. Refine os filtros." |
| 4e4 | Log de performance no servidor |

---

## 7. VALIDAÃ‡Ã•ES DE CAMPOS

**NÃ£o aplicÃ¡vel (UC de listagem nÃ£o possui formulÃ¡rio de entrada)**

---

## 8. REGRAS DE NEGÃ“CIO

### RN01 - Multi-Tenancy
- Listar apenas templates da empresa do usuÃ¡rio logado (WHERE EmpresaId = {empresaAtual})
- Super Admin pode listar templates de todas as empresas

### RN02 - PaginaÃ§Ã£o
- Tamanho de pÃ¡gina padrÃ£o: 20 registros
- Tamanhos permitidos: 10, 20, 50, 100
- MÃ¡ximo de 10.000 registros retornados (para exportaÃ§Ã£o)

### RN03 - OrdenaÃ§Ã£o
- Colunas ordenÃ¡veis: Nome, Tipo, Status, DataCriacao
- OrdenaÃ§Ã£o padrÃ£o: Nome ASC
- Suporte a ASC e DESC

### RN04 - Filtros
- Busca por nome: case-insensitive, parcial (LIKE %termo%)
- Filtro por tipo: exact match
- Filtro por status: booleano (Ativo/Inativo)
- Filtros podem ser combinados (AND)

### RN05 - PermissÃµes de AÃ§Ãµes
```
Visualizar: templates:template:read
Editar: templates:template:update
Inativar: templates:template:delete
```

### RN06 - Cache
- Lista pode ser cacheada por 5 minutos
- Cache invalidado ao criar/editar/deletar template

---

## 9. REQUISITOS NÃƒO-FUNCIONAIS

### Performance
- Tempo de resposta: < 1 segundo para 1.000 registros
- Tempo de resposta: < 3 segundos para 10.000 registros
- Suporte a 100 requisiÃ§Ãµes simultÃ¢neas

### SeguranÃ§a
- ValidaÃ§Ã£o de permissÃµes no backend (nÃ£o confiar no frontend)
- Logs de acesso para auditoria
- ProteÃ§Ã£o contra SQL Injection (usar EF Core)

### Usabilidade
- Indicador de carregamento durante busca
- Feedback visual em filtros aplicados
- Mensagens de erro claras e acionÃ¡veis

### Multi-Tenancy
- Isolamento total entre empresas
- Filtro aplicado em nÃ­vel de query (Row-Level Security)

---

## 10. INTERFACE UI

### Wireframe BÃ¡sico

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< Voltar]  GERENCIAR TEMPLATES                    [+ Novo]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚ Buscar: [__________________] [ğŸ”]  Tipo: [Todos â–¼]  Status: [Todos â–¼]  [Exportar] â”‚
â”‚                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nome â†‘ | Tipo | Status | Criado em | Criado por | AÃ§Ãµes        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Contrato PadrÃ£o | Documento | âœ… Ativo | 10/01/25 | Admin | [ğŸ‘ï¸][âœï¸][ğŸ—‘ï¸] â”‚
â”‚ Email Boas-Vindas | Email | âœ… Ativo | 09/01/25 | JoÃ£o | [ğŸ‘ï¸][âœï¸][ğŸ—‘ï¸] â”‚
â”‚ RelatÃ³rio Mensal | RelatÃ³rio | âŒ Inativo | 08/01/25 | Maria | [ğŸ‘ï¸][âœï¸][ğŸ—‘ï¸] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mostrando 1-20 de 156 registros  [< Anterior] [PrÃ³xima >]      â”‚
â”‚ Itens por pÃ¡gina: [20 â–¼]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chaves i18n NecessÃ¡rias

```json
{
  "templates.list.title": "Gerenciar Templates",
  "templates.list.newButton": "Novo Template",
  "templates.list.searchPlaceholder": "Buscar template...",
  "templates.list.filterType": "Tipo",
  "templates.list.filterStatus": "Status",
  "templates.list.export": "Exportar",
  "templates.list.columns.name": "Nome",
  "templates.list.columns.type": "Tipo",
  "templates.list.columns.status": "Status",
  "templates.list.columns.createdAt": "Criado em",
  "templates.list.columns.createdBy": "Criado por",
  "templates.list.columns.actions": "AÃ§Ãµes",
  "templates.list.noRecords": "Nenhum template encontrado",
  "templates.list.loading": "Carregando templates...",
  "templates.list.error": "Erro ao carregar templates. Tente novamente."
}
```

---

## 11. RASTREABILIDADE

### Requisitos Relacionados
- **RF-063**: Motor de Templates (Template Engine) - SeÃ§Ã£o 2.1 (Listagem)
- **RF-001**: ConfiguraÃ§Ãµes (paginaÃ§Ã£o padrÃ£o)
- **RF-003**: Auditoria (logs de acesso)
- **RF-063**: Perfis (permissÃµes de acesso)

### Casos de Teste
- **CN-UC00-001**: Listar templates com sucesso
- **CN-UC00-002**: Filtrar por nome
- **CN-UC00-003**: Filtrar por tipo
- **CN-UC00-004**: Filtrar por status
- **CN-UC00-005**: Ordenar por coluna
- **CN-UC00-006**: Navegar entre pÃ¡ginas
- **CN-UC00-007**: Alterar tamanho de pÃ¡gina
- **CN-UC00-008**: Exportar lista
- **CN-UC00-009**: Lista vazia
- **CN-UC00-010**: Sem permissÃ£o
- **CN-UC00-011**: Multi-tenancy isolado
- **CN-UC00-012**: Performance com 10.000 registros

### DocumentaÃ§Ã£o TÃ©cnica
- **Backend**: `Application/Templates/Queries/GetTemplates/GetTemplatesQuery.cs`
- **Frontend**: `src/app/modules/templates/list/list.component.ts`
- **API**: `GET /api/templates?search={termo}&type={tipo}&active={bool}&page={n}&pageSize={n}&sortBy={campo}&sortOrder={asc|desc}`

---

**Criado por**: IControlIT Architect Agent
**Status**: Aguardando ImplementaÃ§Ã£o

---

# UC01 - Criar Template

**RF**: RF-063 - Motor de Templates (Template Engine)
**Ator**: Administrador do Sistema, Desenvolvedor de Templates
**Complexidade**: Alta
**Estimativa**: 12h (4h backend + 5h frontend + 3h testes)

---

## 1. OBJETIVO

Permitir que usuÃ¡rios autorizados criem novos templates no sistema, definindo nome, tipo, conteÃºdo HTML/texto, variÃ¡veis e configuraÃ§Ãµes.

---

## 2. PRÃ‰-CONDIÃ‡Ã•ES

1. UsuÃ¡rio autenticado com permissÃ£o `templates:template:create`
2. Sistema conectado ao banco de dados
3. Editor de templates (Monaco Editor ou similar) configurado no frontend

---

## 3. DEPENDÃŠNCIAS DE DESENVOLVIMENTO

### PrÃ©-requisitos
- UC00-listar-templates implementado
- Tabela `Templates` e `TemplateVariables` criadas
- Command `CreateTemplateCommand` + Handler
- Endpoint POST `/api/templates`

### Ordem de ImplementaÃ§Ã£o
1. Backend: CreateTemplateCommand + Validator
2. Backend: Endpoint POST /api/templates
3. Frontend: template-form component
4. Frontend: IntegraÃ§Ã£o com editor de cÃ³digo (Monaco)
5. Testes de validaÃ§Ã£o e seguranÃ§a

### IntegraÃ§Ãµes
- **RF-001**: ValidaÃ§Ã£o de configuraÃ§Ãµes de templates
- **RF-003**: Auditoria de criaÃ§Ã£o
- **RF-063**: PermissÃµes de criaÃ§Ã£o

---

## 4. FLUXO PRINCIPAL

**FP01 - Criar Template com Sucesso**

| Passo | Ator | AÃ§Ã£o | Sistema |
|-------|------|------|---------|
| 1 | UsuÃ¡rio | Clica em "Novo Template" | Exibe formulÃ¡rio vazio |
| 2 | UsuÃ¡rio | Preenche nome (ex: "Contrato PadrÃ£o") | Valida unicidade |
| 3 | UsuÃ¡rio | Seleciona tipo (Documento/Email/RelatÃ³rio) | Carrega variÃ¡veis disponÃ­veis por tipo |
| 4 | UsuÃ¡rio | Digita conteÃºdo HTML no editor | Valida sintaxe HTML |
| 5 | UsuÃ¡rio | Insere variÃ¡veis (ex: {{nome_cliente}}) | Valida variÃ¡veis existentes |
| 6 | UsuÃ¡rio | Define descriÃ§Ã£o (opcional) | Aceita atÃ© 500 caracteres |
| 7 | UsuÃ¡rio | Marca como ativo/inativo | Aceita boolean |
| 8 | UsuÃ¡rio | Clica em "Salvar" | Valida todos os campos |
| 9 | Sistema | - | Gera ID Ãºnico (GUID) |
| 10 | Sistema | - | Valida HTML contra XSS |
| 11 | Sistema | - | Salva template no banco |
| 12 | Sistema | - | Salva variÃ¡veis na tabela TemplateVariables |
| 13 | Sistema | - | Cria registro de auditoria |
| 14 | Sistema | - | Retorna 201 Created com ID |
| 15 | Sistema | Exibe toast "Template criado" | Redireciona para lista |

---

## 5. FLUXOS ALTERNATIVOS

### FA01 - Criar Template Inativo
- UsuÃ¡rio desmarca "Ativo" no passo 7
- Template criado mas nÃ£o disponÃ­vel para uso atÃ© ser ativado

### FA02 - Preview do Template
- No passo 5, usuÃ¡rio clica em "Visualizar Preview"
- Sistema renderiza template com dados de exemplo
- Modal exibe resultado final

### FA03 - Importar Template de Arquivo
- No passo 4, usuÃ¡rio clica em "Importar HTML"
- Sistema lÃª arquivo .html
- Popula editor com conteÃºdo do arquivo

### FA04 - Cancelar CriaÃ§Ã£o
- Qualquer momento antes do passo 8
- Sistema confirma "Descartar alteraÃ§Ãµes?"
- Se SIM: retorna Ã  lista, se NÃƒO: permanece

---

## 6. FLUXOS DE EXCEÃ‡ÃƒO

### FE01 - Nome Duplicado
- No passo 2, sistema detecta nome jÃ¡ existe
- Campo fica vermelho: "Este nome jÃ¡ estÃ¡ em uso"
- BotÃ£o Salvar desabilitado

### FE02 - HTML InvÃ¡lido
- No passo 4, sistema detecta HTML malformado
- Editor marca linha com erro
- Mensagem: "HTML invÃ¡lido na linha X"

### FE03 - VariÃ¡vel InvÃ¡lida
- No passo 5, usuÃ¡rio usa {{variavel_inexistente}}
- Sistema alerta: "VariÃ¡vel 'variavel_inexistente' nÃ£o existe"
- Lista variÃ¡veis disponÃ­veis

### FE04 - Tentativa de XSS
- No passo 10, sistema detecta script malicioso
- Template rejeitado com erro 400
- Log de seguranÃ§a criado

### FE05 - Erro ao Salvar
- No passo 11, falha na conexÃ£o com banco
- Rollback de transaÃ§Ã£o
- Toast: "Erro ao salvar. Tente novamente."
- Dados permanecem no formulÃ¡rio

---

## 7. VALIDAÃ‡Ã•ES DE CAMPOS

### Campos ObrigatÃ³rios

| Campo | ValidaÃ§Ã£o | Mensagem Erro |
|-------|-----------|---------------|
| Nome | ObrigatÃ³rio, 3-100 caracteres | "Nome deve ter entre 3 e 100 caracteres" |
| Tipo | ObrigatÃ³rio, enum vÃ¡lido | "Selecione um tipo de template" |
| ConteÃºdo | ObrigatÃ³rio, HTML vÃ¡lido | "ConteÃºdo nÃ£o pode estar vazio" |

### Campos Opcionais
- DescriÃ§Ã£o (0-500 caracteres)
- Ativo (padrÃ£o: true)

### Fluxos de ValidaÃ§Ã£o

**FA-VAL-01: Campos obrigatÃ³rios nÃ£o preenchidos**
- Sistema destaca campos vazios em vermelho
- Toast: "Preencha todos os campos obrigatÃ³rios"
- Foco vai para primeiro campo vazio

**FA-VAL-02: Limite de caracteres excedido**
- Nome > 100: "Nome muito longo (mÃ¡ximo 100 caracteres)"
- DescriÃ§Ã£o > 500: "DescriÃ§Ã£o muito longa (mÃ¡ximo 500 caracteres)"

**FA-VAL-03: Tipo invÃ¡lido**
- Tipo nÃ£o Ã© Documento/Email/RelatÃ³rio: erro 400
- Frontend bloqueia opÃ§Ãµes invÃ¡lidas

**FA-VAL-04: HTML malformado**
- Parser HTML detecta tag nÃ£o fechada
- Editor marca linha com erro
- Mensagem especÃ­fica da validaÃ§Ã£o

---

## 8. REGRAS DE NEGÃ“CIO

### RN01 - Nome Ãšnico por Empresa
- Nome deve ser Ãºnico dentro da mesma empresa (multi-tenancy)
- Empresas diferentes podem ter templates com mesmo nome

### RN02 - VariÃ¡veis por Tipo
```
Documento: {{nome_cliente}}, {{data_contrato}}, {{valor}}
Email: {{destinatario}}, {{assunto}}, {{corpo}}
RelatÃ³rio: {{periodo}}, {{total_registros}}, {{data_geracao}}
```

### RN03 - SeguranÃ§a HTML
- Remover tags `<script>`, `<iframe>`, `<object>`
- Permitir apenas tags seguras: `<p>`, `<div>`, `<span>`, `<table>`, etc.
- Sanitizar atributos: remover `onclick`, `onerror`, etc.

### RN04 - Versionamento
- Ao editar template, criar nova versÃ£o (nÃ£o sobrescrever)
- Manter histÃ³rico de versÃµes com timestamp

### RN05 - Auditoria
```json
{
  "acao": "Create",
  "entidade": "Template",
  "entidadeId": "guid",
  "usuario": "admin@sistema.com",
  "dadosDepois": { "nome": "...", "tipo": "...", "conteudo": "..." }
}
```

---

## 9. REQUISITOS NÃƒO-FUNCIONAIS

### Performance
- Salvamento < 2 segundos
- ValidaÃ§Ã£o HTML em tempo real (debounce 500ms)
- Preview renderizado em < 1 segundo

### SeguranÃ§a
- ValidaÃ§Ã£o XSS no backend (nÃ£o confiar frontend)
- Escape de caracteres especiais
- Logs de tentativas de injeÃ§Ã£o

### Usabilidade
- Editor com syntax highlighting
- Autocomplete de variÃ¡veis
- Atalhos de teclado (Ctrl+S para salvar)

### Multi-Tenancy
- Template vinculado Ã  empresa do usuÃ¡rio
- Isolamento total entre empresas

---

## 10. INTERFACE UI

### Wireframe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< Voltar]  NOVO TEMPLATE                   [Salvar]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nome: [____________________________]                     â”‚
â”‚ Tipo: [Documento â–¼]                                      â”‚
â”‚ DescriÃ§Ã£o: [_____________________________]              â”‚
â”‚ [ ] Ativo                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConteÃºdo HTML:                  [VariÃ¡veis DisponÃ­veis] â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ <html>                    â”‚  â”‚ â€¢ {{nome_cliente}}   â”‚ â”‚
â”‚ â”‚   <body>                  â”‚  â”‚ â€¢ {{data_contrato}}  â”‚ â”‚
â”‚ â”‚     <h1>{{titulo}}</h1>   â”‚  â”‚ â€¢ {{valor}}          â”‚ â”‚
â”‚ â”‚     <p>{{conteudo}}</p>   â”‚  â”‚                      â”‚ â”‚
â”‚ â”‚   </body>                 â”‚  â”‚ [Adicionar VariÃ¡vel] â”‚ â”‚
â”‚ â”‚ </html>                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                               [Preview] [Importar HTML] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chaves i18n

```json
{
  "templates.create.title": "Novo Template",
  "templates.create.nameLabel": "Nome",
  "templates.create.namePlaceholder": "Nome do template",
  "templates.create.typeLabel": "Tipo",
  "templates.create.descriptionLabel": "DescriÃ§Ã£o",
  "templates.create.activeLabel": "Ativo",
  "templates.create.contentLabel": "ConteÃºdo HTML",
  "templates.create.variablesTitle": "VariÃ¡veis DisponÃ­veis",
  "templates.create.previewButton": "Visualizar Preview",
  "templates.create.importButton": "Importar HTML",
  "templates.create.saveButton": "Salvar",
  "templates.create.cancelButton": "Cancelar",
  "templates.create.successMessage": "Template criado com sucesso!",
  "templates.create.errorMessage": "Erro ao criar template"
}
```

---

## 11. RASTREABILIDADE

### Requisitos
- **RF-063**: Motor de Templates - SeÃ§Ã£o 2.2 (CriaÃ§Ã£o)
- **RF-003**: Auditoria de criaÃ§Ã£o
- **RF-063**: PermissÃµes `templates:template:create`

### Casos de Teste
- **CN-UC01-001**: Criar template com sucesso
- **CN-UC01-002**: Nome duplicado
- **CN-UC01-003**: HTML invÃ¡lido
- **CN-UC01-004**: VariÃ¡vel invÃ¡lida
- **CN-UC01-005**: Tentativa XSS bloqueada
- **CN-UC01-006**: ValidaÃ§Ã£o de campos obrigatÃ³rios
- **CN-UC01-007**: Preview de template
- **CN-UC01-008**: Importar HTML de arquivo
- **CN-UC01-009**: Multi-tenancy isolado
- **CN-UC01-010**: Sem permissÃ£o (403)

### DocumentaÃ§Ã£o
- **Backend**: `Application/Templates/Commands/CreateTemplate/CreateTemplateCommand.cs`
- **Frontend**: `src/app/modules/templates/form/form.component.ts`
- **API**: `POST /api/templates`

---

**Criado por**: IControlIT Architect Agent

---

# UC02 - Visualizar Template

**RF**: RF-063 | **Ator**: Admin, Desenvolvedor, Gerente | **Complexidade**: Baixa | **Estimativa**: 7h (2h backend + 3h frontend + 2h testes)

## 1. OBJETIVO
Permitir visualizaÃ§Ã£o de detalhes completos de um template, incluindo conteÃºdo, variÃ¡veis, metadados e histÃ³rico de versÃµes.

## 2. PRÃ‰-CONDIÃ‡Ã•ES
1. Autenticado com `templates:template:read`
2. Template deve existir e pertencer Ã  empresa do usuÃ¡rio

## 3. DEPENDÃŠNCIAS
**PrÃ©-requisitos**: UC00, UC01 | **Ordem**: 1) Backend GetTemplateByIdQuery 2) Frontend detail component
**IntegraÃ§Ãµes**: RF-003 (Audit), RF-008 (UsuÃ¡rios), RF-063 (PermissÃµes)

## 4. FLUXO PRINCIPAL
1. UsuÃ¡rio clica em "Visualizar" na lista â†’ 2. Sistema busca template por ID â†’ 3. Valida permissÃµes e multi-tenancy â†’ 4. Retorna JSON completo â†’ 5. Exibe tela de detalhes (modo somente leitura) â†’ 6. Mostra nome, tipo, descriÃ§Ã£o, conteÃºdo HTML, variÃ¡veis, status, criado por, data criaÃ§Ã£o/atualizaÃ§Ã£o

## 5. FLUXOS ALTERNATIVOS
**FA01**: Visualizar VersÃµes Anteriores (botÃ£o "HistÃ³rico" â†’ lista versÃµes â†’ seleciona versÃ£o â†’ exibe conteÃºdo)
**FA02**: Copiar ConteÃºdo (botÃ£o "Copiar HTML" â†’ copia conteÃºdo para clipboard â†’ toast "Copiado!")
**FA03**: Visualizar Preview Renderizado (botÃ£o "Preview" â†’ renderiza template com dados exemplo â†’ modal)

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Template NÃ£o Encontrado (404 â†’ "Template nÃ£o encontrado")
**FE02**: Sem PermissÃ£o (403 â†’ "Acesso negado")
**FE03**: Template de Outra Empresa (403 â†’ "VocÃª nÃ£o pode acessar este template")

## 7. VALIDAÃ‡Ã•ES
N/A (somente leitura)

## 8. REGRAS DE NEGÃ“CIO
**RN01**: Multi-tenancy rigoroso (WHERE EmpresaId = {atual} AND Id = {id})
**RN02**: Exibir versÃ£o atual por padrÃ£o
**RN03**: Auditoria de acesso (Action = "View")

## 9. REQUISITOS NÃƒO-FUNCIONAIS
**Performance**: < 1s | **SeguranÃ§a**: Escape XSS na exibiÃ§Ã£o | **Usabilidade**: Modo somente leitura claro

## 10. INTERFACE UI
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [< Voltar] DETALHES DO TEMPLATE [Editar]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nome: Contrato PadrÃ£o                    â”‚
â”‚ Tipo: Documento                          â”‚
â”‚ DescriÃ§Ã£o: Template para contratos...   â”‚
â”‚ Status: âœ… Ativo                         â”‚
â”‚ Criado por: Admin em 10/01/2025         â”‚
â”‚ Atualizado em: 15/01/2025                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ConteÃºdo HTML: [Copiar] [Preview]       â”‚
â”‚ <html>...</html>                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VariÃ¡veis: {{nome}}, {{data}}, {{valor}} â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [HistÃ³rico de VersÃµes (5)]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.3 | **Testes**: CN-UC02-001 a CN-UC02-008 | **API**: GET /api/templates/{id}

---

# UC03 - Editar Template

**RF**: RF-063 | **Ator**: Admin, Desenvolvedor | **Complexidade**: Alta | **Estimativa**: 12h

## 1. OBJETIVO
Permitir ediÃ§Ã£o de templates existentes mantendo histÃ³rico de versÃµes.

## 2. PRÃ‰-CONDIÃ‡Ã•ES
Autenticado com `templates:template:update`, template existe

## 3. DEPENDÃŠNCIAS
**PrÃ©-req**: UC00-02 | **Ordem**: Backend UpdateCommand â†’ Frontend edit form
**Integra**: RF-003 (Audit versionamento), RF-063 (PermissÃµes)

## 4. FLUXO PRINCIPAL
1. Clica "Editar" â†’ 2. Carrega dados â†’ 3. Edita campos â†’ 4. Salvar â†’ 5. Cria nova versÃ£o â†’ 6. Auditoria â†’ 7. Sucesso

## 5. FLUXOS ALTERNATIVOS
**FA01**: Editar sem alterar conteÃºdo HTML (sÃ³ metadados)
**FA02**: Reverter para versÃ£o anterior
**FA03**: Comparar versÃµes (diff visual)

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Nome duplicado | **FE02**: HTML invÃ¡lido | **FE03**: Template sendo usado (warning) | **FE04**: Sem permissÃ£o

## 7. VALIDAÃ‡Ã•ES
Mesmas do UC01: Nome 3-100, Tipo enum, ConteÃºdo obrigatÃ³rio, DescriÃ§Ã£o 0-500

## 8. REGRAS DE NEGÃ“CIO
**RN01**: Versionamento automÃ¡tico (salva anterior)
**RN02**: NÃ£o pode editar se em uso crÃ­tico
**RN03**: Auditoria antes/depois

## 9. NÃƒO-FUNCIONAIS
Performance < 2s | SeguranÃ§a XSS | Usabilidade diff visual

## 10. UI
```
[< Voltar] EDITAR TEMPLATE [Salvar] [Ver HistÃ³rico]
Nome: [________________] Tipo: [Documentoâ–¼]
DescriÃ§Ã£o: [____________________________]
ConteÃºdo: [editor com conteÃºdo atual...]
[Comparar com VersÃ£o Anterior] [Reverter]
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.4 | **Testes**: CN-UC03-001 a CN-UC03-010 | **API**: PUT /api/templates/{id}

---

# UC04 - Inativar Template

**RF**: RF-063 | **Ator**: Admin, Desenvolvedor | **Complexidade**: Baixa | **Estimativa**: 6h

## 1. OBJETIVO
Inativar template (soft delete) sem perder histÃ³rico.

## 2. PRÃ‰-CONDIÃ‡Ã•ES
Autenticado com `templates:template:delete`, template ativo

## 3. DEPENDÃŠNCIAS
**PrÃ©-req**: UC00-02 | **Ordem**: Backend DeleteCommand â†’ Frontend confirm dialog
**Integra**: RF-003 (Audit), verificar uso em RF-090/019

## 4. FLUXO PRINCIPAL
1. Clica "Inativar" â†’ 2. Confirma aÃ§Ã£o â†’ 3. Valida se nÃ£o estÃ¡ em uso â†’ 4. Ativo=false â†’ 5. Auditoria â†’ 6. Sucesso

## 5. FLUXOS ALTERNATIVOS
**FA01**: Template em uso (aviso mas permite)
**FA02**: Reativar template inativo (botÃ£o "Ativar")

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Template jÃ¡ inativo | **FE02**: Sem permissÃ£o | **FE03**: Erro ao salvar

## 7. VALIDAÃ‡Ã•ES
N/A (aÃ§Ã£o booleana)

## 8. REGRAS DE NEGÃ“CIO
**RN01**: Soft delete (Ativo=false, nÃ£o DELETE)
**RN02**: Template inativo nÃ£o aparece em seletores
**RN03**: MantÃ©m histÃ³rico e auditoria

## 9. NÃƒO-FUNCIONAIS
Performance < 1s | SeguranÃ§a validar permissÃ£o

## 10. UI
```
Modal: "Deseja inativar o template 'Contrato PadrÃ£o'?"
âš ï¸ Este template estÃ¡ sendo usado em 3 processos
[ ] Entendo os impactos [Cancelar] [Inativar]
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.5 | **Testes**: CN-UC04-001 a CN-UC04-006 | **API**: DELETE /api/templates/{id}

---

# UC06 - Versionar Template

**RF**: RF-063 | **Ator**: Sistema (automÃ¡tico) | **Complexidade**: MÃ©dia | **Estimativa**: 8h

## 1. OBJETIVO
Manter histÃ³rico automÃ¡tico de versÃµes ao editar template (integrado ao UC03).

## 2. PRÃ‰-CONDIÃ‡Ã•ES
Template existente sendo editado (UC03)

## 3. DEPENDÃŠNCIAS
**PrÃ©-req**: UC01-03 | **Ordem**: Tabela TemplateVersions â†’ Trigger/Handler no UC03
**Integra**: RF-003 (audit histÃ³rico)

## 4. FLUXO PRINCIPAL
1. UC03 Ã© executado â†’ 2. Antes de UPDATE, copia registro atual para TemplateVersions â†’ 3. Incrementa nÃºmero da versÃ£o â†’ 4. Salva timestamp e usuÃ¡rio â†’ 5. UPDATE no Template â†’ 6. Auditoria da alteraÃ§Ã£o

## 5. FLUXOS ALTERNATIVOS
**FA01**: Restaurar versÃ£o anterior (copia TemplateVersions â†’ Template)
**FA02**: Comparar versÃµes (diff side-by-side)
**FA03**: Excluir versÃ£o antiga (apÃ³s X meses)

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Falha ao salvar versÃ£o (rollback do UPDATE) | **FE02**: Storage cheio (limitar versÃµes)

## 7. VALIDAÃ‡Ã•ES
N/A (automÃ¡tico)

## 8. REGRAS DE NEGÃ“CIO
**RN01**: Manter Ãºltimas 20 versÃµes por template
**RN02**: VersÃµes antigas arquivadas apÃ³s 1 ano
**RN03**: Audit completo: quem alterou, quando, o que mudou

## 9. NÃƒO-FUNCIONAIS
Performance < 500ms para versionamento | Storage otimizado (compressÃ£o)

## 10. UI
```
HistÃ³rico de VersÃµes:
v5 - 20/11/2025 10:30 - Admin - [Ver] [Restaurar]
v4 - 15/11/2025 14:20 - JoÃ£o - [Ver] [Comparar]
v3 - 10/11/2025 09:15 - Maria - [Ver]
[Carregar mais...]
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.7 | **Testes**: CN-UC06-001 a CN-UC06-008 | **API**: GET /api/templates/{id}/versions

---

# UC07 - Testar Template

**RF**: RF-063 | **Ator**: Admin, Desenvolvedor | **Complexidade**: MÃ©dia | **Estimativa**: 10h

## 1. OBJETIVO
Testar template com dados de exemplo antes de publicar.

## 2. PRÃ‰-CONDIÃ‡Ã•ES
Autenticado, template vÃ¡lido (pode estar inativo)

## 3. DEPENDÃŠNCIAS
**PrÃ©-req**: UC01-05 | **Ordem**: Backend TestCommand â†’ Template engine â†’ Preview UI
**Integra**: RF-063 UC05 (render)

## 4. FLUXO PRINCIPAL
1. Edita template â†’ 2. Clica "Testar" â†’ 3. Sistema carrega dados de exemplo â†’ 4. UsuÃ¡rio pode editar dados de teste â†’ 5. Clica "Gerar Preview" â†’ 6. Sistema renderiza (UC05) â†’ 7. Exibe resultado em modal â†’ 8. UsuÃ¡rio valida visualmente

## 5. FLUXOS ALTERNATIVOS
**FA01**: Usar diferentes conjuntos de dados teste
**FA02**: Testar em dispositivos (mobile/tablet/desktop preview)
**FA03**: Salvar resultado teste como PDF

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Erro de renderizaÃ§Ã£o (mostra erro detalhado) | **FE02**: Timeout (>30s) | **FE03**: VariÃ¡vel faltando

## 7. VALIDAÃ‡Ã•ES
JSON de teste vÃ¡lido, variÃ¡veis completas

## 8. REGRAS DE NEGÃ“CIO
**RN01**: NÃ£o salva resultado (apenas preview)
**RN02**: NÃ£o cria auditoria (Ã© teste)
**RN03**: Dados de exemplo em arquivo JSON padrÃ£o

## 9. NÃƒO-FUNCIONAIS
Performance < 5s | Usabilidade: side-by-side (cÃ³digo | preview)

## 10. UI
```
[CÃ³digo]             |  [Preview]
{{nome}} Silva       |  JoÃ£o Silva
{{valor}}            |  R$ 1.500,00
[Editar Dados Teste] |  [Download PDF]
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.8 | **Testes**: CN-UC07-001 a CN-UC07-008 | **API**: POST /api/templates/{id}/test

---

# UC08 - Publicar Template

**RF**: RF-063 | **Ator**: Admin, Desenvolvedor | **Complexidade**: MÃ©dia | **Estimativa**: 8h

## 1. OBJETIVO
Marcar template como "publicado" e disponÃ­vel para uso em produÃ§Ã£o.

## 2. PRÃ‰-CONDIÃ‡Ã•ES
Autenticado com `templates:template:publish`, template testado (UC07)

## 3. DEPENDÃŠNCIAS
**PrÃ©-req**: UC01-07 | **Ordem**: Backend PublishCommand â†’ ValidaÃ§Ãµes â†’ PublicaÃ§Ã£o
**Integra**: RF-003 (audit publicaÃ§Ã£o), RF-090/019 (disponibilizar)

## 4. FLUXO PRINCIPAL
1. Template em modo "Rascunho" â†’ 2. Clica "Publicar" â†’ 3. Sistema valida (completo, testado) â†’ 4. Confirma aÃ§Ã£o â†’ 5. Status="Publicado" â†’ 6. Disponibiliza para uso â†’ 7. Notifica usuÃ¡rios relevantes â†’ 8. Auditoria

## 5. FLUXOS ALTERNATIVOS
**FA01**: Despublicar template (volta a rascunho)
**FA02**: Agendar publicaÃ§Ã£o futura
**FA03**: Publicar nova versÃ£o (invalida anterior)

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Template incompleto (faltam variÃ¡veis) | **FE02**: NÃ£o testado | **FE03**: Sem permissÃ£o

## 7. VALIDAÃ‡Ã•ES
Template completo, testado, sem erros

## 8. REGRAS DE NEGÃ“CIO
**RN01**: Apenas 1 versÃ£o publicada por vez
**RN02**: PublicaÃ§Ã£o requer aprovaÃ§Ã£o (workflow opcional)
**RN03**: Audit completa com timestamp publicaÃ§Ã£o

## 9. NÃƒO-FUNCIONAIS
Performance < 1s | NotificaÃ§Ãµes async

## 10. UI
```
Modal: "Publicar template 'Contrato PadrÃ£o'?"
âœ… Template completo
âœ… Testado com sucesso
âš ï¸ VersÃ£o anterior serÃ¡ despublicada
[Cancelar] [Publicar]
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.9 | **Testes**: CN-UC08-001 a CN-UC08-006 | **API**: POST /api/templates/{id}/publish

---

# UC09 - Clonar Template

**RF**: RF-063 | **Ator**: Admin, Desenvolvedor | **Complexidade**: Baixa | **Estimativa**: 6h

## 1. OBJETIVO
Duplicar template existente como base para novo template.

## 2. PRÃ‰-CONDIÃ‡Ã•ES
Autenticado com `templates:template:create`, template fonte existe

## 3. DEPENDÃŠNCIAS
**PrÃ©-req**: UC00-02 | **Ordem**: Backend CloneCommand â†’ UC01 (criaÃ§Ã£o)
**Integra**: RF-003 (audit)

## 4. FLUXO PRINCIPAL
1. Visualiza template â†’ 2. Clica "Clonar" â†’ 3. Sistema duplica dados â†’ 4. Abre editor com "(CÃ³pia)" no nome â†’ 5. UsuÃ¡rio ajusta â†’ 6. Salva (UC01)

## 5. FLUXOS ALTERNATIVOS
**FA01**: Clonar para outra empresa (Super Admin)
**FA02**: Clonar apenas estrutura (sem conteÃºdo)

## 6. FLUXOS DE EXCEÃ‡ÃƒO
**FE01**: Template fonte nÃ£o existe | **FE02**: Sem permissÃ£o | **FE03**: Nome da cÃ³pia jÃ¡ existe

## 7. VALIDAÃ‡Ã•ES
Mesmas do UC01 apÃ³s ediÃ§Ã£o

## 8. REGRAS DE NEGÃ“CIO
**RN01**: Nome padrÃ£o: "{Nome Original} (CÃ³pia)"
**RN02**: Status = Inativo (rascunho)
**RN03**: VersÃ£o = 1 (nÃ£o copia histÃ³rico)
**RN04**: Audit: OrigemTemplateId no log

## 9. NÃƒO-FUNCIONAIS
Performance < 2s | Usabilidade: deixar claro que Ã© cÃ³pia

## 10. UI
```
[Template: Contrato PadrÃ£o]
[Ver] [Editar] [Clonar] [Inativar]
        â†“
[Novo Template]
Nome: Contrato PadrÃ£o (CÃ³pia)
[editar normalmente...]
```

## 11. RASTREABILIDADE
**RF**: RF-063 Â§2.10 | **Testes**: CN-UC09-001 a CN-UC09-005 | **API**: POST /api/templates/{id}/clone

---

## HistÃ³rico de AlteraÃ§Ãµes

| VersÃ£o | Data | Autor | DescriÃ§Ã£o |
|--------|------|-------|-----------|
| 1.0 | 2025-12-17 | Sistema | ConsolidaÃ§Ã£o de 11 casos de uso |
