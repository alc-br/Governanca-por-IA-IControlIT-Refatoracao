# =============================================
# TEMPLATE DE CASO DE TESTE (TC) - VERSÃO 2.0
# =============================================
#
# Este template inclui TODAS as seções obrigatórias para testes E2E Playwright
# com seletores validados e rastreabilidade completa.
#
# IMPORTANTE: Este arquivo DEVE estar sempre sincronizado com:
# - UC-RFXXX.yaml (casos de uso)
# - MT-RFXXX.yaml (massa de teste)
# - Frontend components (data-test attributes)
#
# Última atualização: 2026-01-09
# Versão: 2.0 - Alinhamento completo com testes E2E
#
# =============================================

# =============================================
# IDENTIFICAÇÃO
# =============================================
tc:
  rf_id: RFXXX
  versao: "1.0"
  data: "YYYY-MM-DD"
  autor: "Agência ALC - alc.dev.br"

# =============================================
# RASTREABILIDADE (OBRIGATÓRIO)
# =============================================
rastreabilidade:
  rf: RFXXX
  uc: UC-RFXXX
  mt: MT-RFXXX

# =============================================
# SETUP (OBRIGATÓRIO - ATUALIZADO)
# =============================================
setup:
  credenciais:
    perfil: "[Admin|Developer|Usuario]"
    referencia: "MT-RFXXX.yaml::credenciais_teste.[perfil]"
    # Exemplo: MT-RF006.yaml::credenciais_teste.admin_teste

  massa_teste:
    arquivo: "MT-RFXXX.yaml"
    dataset: "MT_RFXXX_XXX"
    # Exemplo: MT_RF006_001

  ambiente:
    frontend_url_base: "http://localhost:4200"
    backend_url_base: "http://localhost:5000"

  pre_condicoes:
    - "Backend em execução (porta 5000)"
    - "Frontend em execução (porta 4200)"
    - "Seeds aplicados (ApplicationDbContextInitialiser)"
    - "Banco de dados limpo (apenas seeds)"

# =============================================
# CASOS DE TESTE (TC-E2E)
# =============================================
casos_de_teste:

  # ==================== TC-E2E-001: Login ====================
  - id: "TC-E2E-001"
    categoria: "PRE_REQUISITO"
    titulo: "Login com perfil [Perfil]"
    descricao: "Autenticar usuário com perfil necessário para executar funcionalidade"

    uc_ref: "N/A"  # Login é pré-requisito, não UC específico do RF
    mt_ref: "MT-RFXXX.yaml::credenciais_teste.[perfil]"

    passos:
      - numero: 1
        descricao: "Navegar para página de login"
        seletor: "N/A"
        acao_e2e: "await page.goto('http://localhost:4200/sign-in')"

      - numero: 2
        descricao: "Preencher email"
        seletor: "[data-test='input-email']"
        acao_e2e: "await page.fill('[data-test=\"input-email\"]', credenciais.email)"

      - numero: 3
        descricao: "Preencher senha"
        seletor: "[data-test='input-password']"
        acao_e2e: "await page.fill('[data-test=\"input-password\"]', credenciais.password)"

      - numero: 4
        descricao: "Clicar em Login"
        seletor: "[data-test='btn-login']"
        acao_e2e: "await page.click('[data-test=\"btn-login\"]')"

    validacoes:
      - numero: 1
        descricao: "Usuário redirecionado para dashboard"
        seletor: "[data-test='page-dashboard']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"page-dashboard\"]')).toBeVisible()"

    resultado_esperado: "Usuário autenticado com sucesso"

  # ==================== TC-E2E-002: Acesso via Menu ====================
  - id: "TC-E2E-002"
    categoria: "NAVEGACAO"
    titulo: "Acessar funcionalidade [Entidade] via menu"
    descricao: "Navegar para funcionalidade através do menu de navegação"

    uc_ref: "UC00"
    mt_ref: "N/A"

    passos:
      - numero: 1
        descricao: "Clicar no menu [Módulo]"
        seletor: "[data-test='menu-[modulo]']"
        aliases: ["[data-test='nav-[modulo]']"]
        acao_e2e: "await page.click('[data-test=\"menu-[modulo]\"]')"

      - numero: 2
        descricao: "Clicar em [Entidade]"
        seletor: "[data-test='menu-item-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"menu-item-[entidade]\"]')"

    validacoes:
      - numero: 1
        descricao: "Página [Entidade] carregada"
        seletor: "[data-test='[entidade]-list']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-list\"]')).toBeVisible()"

      - numero: 2
        descricao: "URL correta"
        seletor: "N/A"
        tipo: "toHaveURL"
        valor_esperado: "http://localhost:4200/[rota-completa]"
        acao_e2e: "await expect(page).toHaveURL('http://localhost:4200/[rota-completa]')"

    resultado_esperado: "Usuário visualiza listagem de [Entidade]"

  # ==================== TC-E2E-003: Carregamento de Listagem ====================
  - id: "TC-E2E-003"
    categoria: "LEITURA"
    titulo: "Carregar listagem de [Entidade]"
    descricao: "Validar carregamento completo da listagem com dados"

    uc_ref: "UC00"
    mt_ref: "N/A"

    passos:
      - numero: 1
        descricao: "Aguardar spinner desaparecer"
        seletor: "[data-test='loading-spinner']"
        acao_e2e: "await page.waitForSelector('[data-test=\"loading-spinner\"]', { state: 'hidden', timeout: 30000 })"

    validacoes:
      - numero: 1
        descricao: "Tabela/lista visível"
        seletor: "[data-test='[entidade]-list']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-list\"]')).toBeVisible()"

      - numero: 2
        descricao: "Pelo menos uma linha presente"
        seletor: "[data-test='[entidade]-row']"
        tipo: "toHaveCount"
        valor_esperado: ">= 1"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-row\"]')).toHaveCount({ min: 1 })"

    resultado_esperado: "Listagem carregada com dados do tenant"

  # ==================== TC-E2E-004: Criar [Entidade] (Happy Path) ====================
  - id: "TC-E2E-004"
    categoria: "CRUD_CREATE"
    titulo: "Criar [Entidade] com dados válidos"
    descricao: "Fluxo completo de criação de [Entidade] - Caminho Feliz"

    uc_ref: "UC01"
    mt_ref: "MT-RFXXX-001"

    passos:
      - numero: 1
        descricao: "Clicar em 'Novo [Entidade]'"
        seletor: "[data-test='RFXXX-criar-[entidade]']"
        aliases: ["[data-test='btn-novo-[entidade]']"]
        acao_e2e: "await page.click('[data-test=\"RFXXX-criar-[entidade]\"]')"

      - numero: 2
        descricao: "Preencher campo [Campo1]"
        seletor: "[data-test='RFXXX-input-[campo1]']"
        acao_e2e: "await page.fill('[data-test=\"RFXXX-input-[campo1]\"]', mt.entrada.[campo1])"

      - numero: 3
        descricao: "Preencher campo [Campo2]"
        seletor: "[data-test='RFXXX-input-[campo2]']"
        acao_e2e: "await page.fill('[data-test=\"RFXXX-input-[campo2]\"]', mt.entrada.[campo2])"

      - numero: 4
        descricao: "Clicar em Salvar"
        seletor: "[data-test='RFXXX-salvar-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"RFXXX-salvar-[entidade]\"]')"

      - numero: 5
        descricao: "Aguardar operação concluir"
        seletor: "[data-test='loading-spinner']"
        acao_e2e: "await page.waitForSelector('[data-test=\"loading-spinner\"]', { state: 'hidden', timeout: 15000 })"

    validacoes:
      - numero: 1
        descricao: "Mensagem de sucesso exibida"
        seletor: "[data-test='toast-success']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"toast-success\"]')).toBeVisible()"

      - numero: 2
        descricao: "Redirecionado para listagem"
        seletor: "[data-test='[entidade]-list']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-list\"]')).toBeVisible()"

      - numero: 3
        descricao: "[Entidade] criado aparece na lista"
        seletor: "N/A"
        tipo: "toContainText"
        valor_esperado: "mt.entrada.[campo1]"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-row\"]').first()).toContainText(mt.entrada.[campo1])"

    resultado_esperado: "[Entidade] criado com sucesso e visível na listagem"

  # ==================== TC-E2E-005: Editar [Entidade] ====================
  - id: "TC-E2E-005"
    categoria: "CRUD_UPDATE"
    titulo: "Editar [Entidade] existente"
    descricao: "Fluxo completo de edição de [Entidade]"

    uc_ref: "UC03"
    mt_ref: "MT-RFXXX-002"

    passos:
      - numero: 1
        descricao: "Clicar em Editar na primeira linha"
        seletor: "[data-test='RFXXX-editar-[entidade]']"
        acao_e2e: "await page.locator('[data-test=\"[entidade]-row\"]').first().locator('[data-test=\"RFXXX-editar-[entidade]\"]').click()"

      - numero: 2
        descricao: "Aguardar formulário carregar"
        seletor: "[data-test='RFXXX-form']"
        acao_e2e: "await page.waitForSelector('[data-test=\"RFXXX-form\"]', { timeout: 10000 })"

      - numero: 3
        descricao: "Alterar campo [Campo1]"
        seletor: "[data-test='RFXXX-input-[campo1]']"
        acao_e2e: "await page.fill('[data-test=\"RFXXX-input-[campo1]\"]', mt.entrada.[campo1]_alterado)"

      - numero: 4
        descricao: "Clicar em Salvar"
        seletor: "[data-test='RFXXX-salvar-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"RFXXX-salvar-[entidade]\"]')"

    validacoes:
      - numero: 1
        descricao: "Mensagem de sucesso exibida"
        seletor: "[data-test='toast-success']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"toast-success\"]')).toBeVisible()"

      - numero: 2
        descricao: "[Entidade] editado aparece com novo valor"
        seletor: "N/A"
        tipo: "toContainText"
        valor_esperado: "mt.entrada.[campo1]_alterado"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-row\"]').first()).toContainText(mt.entrada.[campo1]_alterado)"

    resultado_esperado: "[Entidade] editado com sucesso"

  # ==================== TC-E2E-006: Excluir [Entidade] ====================
  - id: "TC-E2E-006"
    categoria: "CRUD_DELETE"
    titulo: "Excluir [Entidade] existente"
    descricao: "Fluxo completo de exclusão de [Entidade]"

    uc_ref: "UC04"
    mt_ref: "MT-RFXXX-003"

    passos:
      - numero: 1
        descricao: "Clicar em Excluir na primeira linha"
        seletor: "[data-test='RFXXX-excluir-[entidade]']"
        acao_e2e: "await page.locator('[data-test=\"[entidade]-row\"]').first().locator('[data-test=\"RFXXX-excluir-[entidade]\"]').click()"

      - numero: 2
        descricao: "Aguardar diálogo de confirmação"
        seletor: "[data-test='dialog-confirmacao']"
        acao_e2e: "await page.waitForSelector('[data-test=\"dialog-confirmacao\"]', { timeout: 10000 })"

      - numero: 3
        descricao: "Confirmar exclusão"
        seletor: "[data-test='btn-confirmar-dialog']"
        acao_e2e: "await page.click('[data-test=\"btn-confirmar-dialog\"]')"

    validacoes:
      - numero: 1
        descricao: "Mensagem de sucesso exibida"
        seletor: "[data-test='toast-success']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"toast-success\"]')).toBeVisible()"

      - numero: 2
        descricao: "[Entidade] não aparece mais na lista"
        seletor: "N/A"
        tipo: "not.toContainText"
        valor_esperado: "mt.entrada.[campo1]_alterado"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-list\"]')).not.toContainText(mt.entrada.[campo1]_alterado)"

    resultado_esperado: "[Entidade] excluído com sucesso"

  # ==================== TC-E2E-007: Criar [Entidade] FINAL (Evidência) ====================
  - id: "TC-E2E-007"
    categoria: "EVIDENCIA"
    titulo: "Criar [Entidade] FINAL como evidência"
    descricao: "Criar registro final que permanece no sistema como evidência de teste"

    uc_ref: "UC01"
    mt_ref: "MT-RFXXX-004"

    passos:
      - numero: 1
        descricao: "Clicar em 'Novo [Entidade]'"
        seletor: "[data-test='RFXXX-criar-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"RFXXX-criar-[entidade]\"]')"

      - numero: 2
        descricao: "Preencher com dados de evidência"
        seletor: "[data-test='RFXXX-input-[campo1]']"
        acao_e2e: "await page.fill('[data-test=\"RFXXX-input-[campo1]\"]', '[EVIDENCIA E2E] RFXXX - 2026-01-09')"

      - numero: 3
        descricao: "Clicar em Salvar"
        seletor: "[data-test='RFXXX-salvar-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"RFXXX-salvar-[entidade]\"]')"

    validacoes:
      - numero: 1
        descricao: "Mensagem de sucesso exibida"
        seletor: "[data-test='toast-success']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"toast-success\"]')).toBeVisible()"

      - numero: 2
        descricao: "[Entidade] de evidência aparece na lista"
        seletor: "N/A"
        tipo: "toContainText"
        valor_esperado: "[EVIDENCIA E2E]"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-list\"]')).toContainText('[EVIDENCIA E2E]')"

    resultado_esperado: "[Entidade] de evidência criado e permanece no sistema"

  # ==================== TC-E2E-008: Validação de Campo Obrigatório ====================
  - id: "TC-E2E-008"
    categoria: "VALIDACAO"
    titulo: "Validação de campo obrigatório vazio"
    descricao: "Tentar criar [Entidade] sem preencher campo obrigatório"

    uc_ref: "UC01"
    fluxo_excecao: "FE-UC01-001"
    mt_ref: "MT-RFXXX-100"

    passos:
      - numero: 1
        descricao: "Clicar em 'Novo [Entidade]'"
        seletor: "[data-test='RFXXX-criar-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"RFXXX-criar-[entidade]\"]')"

      - numero: 2
        descricao: "Deixar campo [Campo1] vazio"
        seletor: "[data-test='RFXXX-input-[campo1]']"
        acao_e2e: "// Campo fica vazio intencionalmente"

      - numero: 3
        descricao: "Clicar em Salvar"
        seletor: "[data-test='RFXXX-salvar-[entidade]']"
        acao_e2e: "await page.click('[data-test=\"RFXXX-salvar-[entidade]\"]')"

    validacoes:
      - numero: 1
        descricao: "Mensagem de erro exibida"
        seletor: "[data-test='RFXXX-input-[campo1]-error']"
        tipo: "toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"RFXXX-input-[campo1]-error\"]')).toBeVisible()"

      - numero: 2
        descricao: "Texto da mensagem de erro correto"
        seletor: "[data-test='RFXXX-input-[campo1]-error']"
        tipo: "toContainText"
        valor_esperado: "[Campo1] é obrigatório"
        acao_e2e: "await expect(page.locator('[data-test=\"RFXXX-input-[campo1]-error\"]')).toContainText('[Campo1] é obrigatório')"

      - numero: 3
        descricao: "[Entidade] NÃO foi criado"
        seletor: "[data-test='[entidade]-list']"
        tipo: "not.toBeVisible"
        valor_esperado: "true"
        acao_e2e: "await expect(page.locator('[data-test=\"[entidade]-list\"]')).not.toBeVisible()"

    resultado_esperado: "Validação impede criação e exibe mensagem de erro"

# =============================================
# TIMEOUTS (SINCRONIZADOS COM UC)
# =============================================
timeouts:
  navegacao: 30000              # 30s - Timeout para navegação de página
  loading_spinner: 30000        # 30s - Timeout para spinner desaparecer
  dialog: 10000                 # 10s - Timeout para diálogos/modals
  operacao_crud: 15000          # 15s - Timeout para criar/editar/excluir
  validacao_formulario: 5000    # 5s - Timeout para validações de formulário

# =============================================
# EXCLUSIONS (CASOS DE TESTE FORA DE ESCOPO)
# =============================================
exclusions:
  tc_items: []
  # Exemplo:
  # - id: "TC-E2E-009"
  #   motivo: "Funcionalidade não implementada nesta versão"

# =============================================
# HISTÓRICO
# =============================================
historico:
  - versao: "1.0"
    data: "YYYY-MM-DD"
    autor: "Agência ALC - alc.dev.br"
    descricao: "Versão inicial"

# =============================================
# METADADOS
# =============================================
metadata:
  total_casos_teste: 8
  cobertura_uc: "100%"
  cobertura_mt: "100%"
  seletores_validados: true
  sincronizado_uc: true
  sincronizado_mt: true
  pronto_para_execucao: false  # Marcar como true após validação completa

# =============================================
# CHECKLIST DE VALIDAÇÃO
# =============================================
# Antes de executar testes E2E, validar:
#
# [ ] Todos os seletores (data-test) estão especificados
# [ ] Todos os seletores batem com UC-RFXXX.yaml
# [ ] Todos os seletores estão implementados no frontend
# [ ] Massa de teste (MT) está sincronizada
# [ ] Credenciais estão sincronizadas com seeds
# [ ] URLs estão sincronizadas com routing
# [ ] Timeouts estão especificados
# [ ] Backend está em execução
# [ ] Frontend está em execução
# [ ] Seeds foram aplicados
#
# SOMENTE então marcar metadata.pronto_para_execucao = true
