# Checklist de Auditoria de Data-Test Attributes
# Versão estruturada para processamento automatizado
# Referência: contracts/auditoria/data-test.md

metadata:
  nome: Auditoria de Data-Test Attributes
  versao: 1.0.0
  data_criacao: 2026-01-08
  contrato_origem: contracts/auditoria/data-test.md
  proposito: Validar presença, nomenclatura e unicidade de data-test attributes em componentes Angular

categorias:

  # ========================================
  # FASE 1: PREPARAÇÃO
  # ========================================

  - categoria: Preparação
    descricao: Validar pré-requisitos antes de iniciar auditoria
    itens:
      - id: PREP-001
        texto: Checklist lido e compreendido
        severidade_se_falhar: BLOQUEANTE
        validacao: Manual (agente confirma leitura)

      - id: PREP-002
        texto: RF especificado na solicitação
        severidade_se_falhar: BLOQUEANTE
        validacao: Verificar parâmetro RF na ativação do contrato

      - id: PREP-003
        texto: Componentes do RF identificados (Glob)
        severidade_se_falhar: BLOQUEANTE
        validacao: Glob "D:\IC2\frontend\icontrolit-app\src\app\**\*RFXXX*.component.html"

      - id: PREP-004
        texto: Pelo menos 1 componente encontrado
        severidade_se_falhar: BLOQUEANTE
        validacao: Count(componentes) >= 1

      - id: PREP-005
        texto: Todo list criada antes de iniciar auditoria
        severidade_se_falhar: BLOQUEANTE
        validacao: TodoWrite tool utilizado

  # ========================================
  # FASE 2: AUDITORIA DE COMPONENTES
  # ========================================

  - categoria: Elementos Interativos - Presença de data-test
    descricao: Verificar se todos os elementos interativos possuem data-test
    itens:
      - id: DT-PRES-001
        texto: Todos os <button> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<button" + verificar presença de data-test
        exemplo_correto: '<button data-test="RF006-salvar-cliente">'
        exemplo_incorreto: '<button (click)="salvar()">'

      - id: DT-PRES-002
        texto: Todos os <input> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<input" + verificar presença de data-test
        exemplo_correto: '<input data-test="RF006-input-razaosocial">'
        exemplo_incorreto: '<input type="text" formControlName="razaoSocial">'

      - id: DT-PRES-003
        texto: Todos os <select> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<select" + verificar presença de data-test
        exemplo_correto: '<select data-test="RF006-select-tipo">'
        exemplo_incorreto: '<select formControlName="tipo">'

      - id: DT-PRES-004
        texto: Todos os <textarea> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<textarea" + verificar presença de data-test
        exemplo_correto: '<textarea data-test="RF006-input-observacoes">'
        exemplo_incorreto: '<textarea formControlName="observacoes">'

      - id: DT-PRES-005
        texto: Todos os <mat-select> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<mat-select" + verificar presença de data-test
        exemplo_correto: '<mat-select data-test="RF006-select-status">'
        exemplo_incorreto: '<mat-select formControlName="status">'

      - id: DT-PRES-006
        texto: Todos os <mat-checkbox> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<mat-checkbox" + verificar presença de data-test
        exemplo_correto: '<mat-checkbox data-test="RF006-check-ativo">'
        exemplo_incorreto: '<mat-checkbox formControlName="ativo">'

      - id: DT-PRES-007
        texto: Todos os <mat-radio-button> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<mat-radio-button" + verificar presença de data-test
        exemplo_correto: '<mat-radio-button data-test="RF006-radio-tipo-pf">'
        exemplo_incorreto: '<mat-radio-button value="PF">'

      - id: DT-PRES-008
        texto: Todos os <mat-slide-toggle> possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<mat-slide-toggle" + verificar presença de data-test
        exemplo_correto: '<mat-slide-toggle data-test="RF006-toggle-ativo">'
        exemplo_incorreto: '<mat-slide-toggle formControlName="ativo">'

      - id: DT-PRES-009
        texto: Todos os <a> com (click) ou [routerLink] possuem data-test
        severidade_se_falhar: BLOQUEANTE
        validacao: Grep "<a" + verificar se tem (click) ou [routerLink] + verificar data-test
        exemplo_correto: '<a data-test="RF006-link-editar" [routerLink]="...">'
        exemplo_incorreto: '<a [routerLink]="/clientes">'

  # ========================================
  # FASE 3: VALIDAÇÃO DE NOMENCLATURA
  # ========================================

  - categoria: Nomenclatura - Padrão RFXXX-acao-alvo
    descricao: Verificar se data-test segue padrão de nomenclatura
    itens:
      - id: DT-NOM-001
        texto: data-test inicia com RFXXX (RF correto)
        severidade_se_falhar: ALTA
        validacao: Regex "^RFXXX-"
        exemplo_correto: data-test="RF006-salvar-cliente"
        exemplo_incorreto: data-test="salvar-cliente"

      - id: DT-NOM-002
        texto: data-test usa kebab-case (lowercase + hífens)
        severidade_se_falhar: ALTA
        validacao: Regex "^RF[0-9]+-[a-z0-9]+(-[a-z0-9]+)*$"
        exemplo_correto: data-test="RF006-salvar-cliente"
        exemplo_incorreto: data-test="RF006-SalvarCliente"

      - id: DT-NOM-003
        texto: data-test não usa underscores
        severidade_se_falhar: ALTA
        validacao: NOT contains "_"
        exemplo_correto: data-test="RF006-salvar-cliente"
        exemplo_incorreto: data-test="RF006_salvar_cliente"

      - id: DT-NOM-004
        texto: data-test não usa CamelCase
        severidade_se_falhar: ALTA
        validacao: NOT contains uppercase letters
        exemplo_correto: data-test="RF006-salvar-cliente"
        exemplo_incorreto: data-test="RF006-SalvarCliente"

      - id: DT-NOM-005
        texto: data-test descreve ação + alvo (semântica clara)
        severidade_se_falhar: MEDIA
        validacao: Manual (revisão semântica)
        exemplo_correto: data-test="RF006-salvar-cliente" (ação + entidade)
        exemplo_incorreto: data-test="RF006-btn1" (não semântico)

  # ========================================
  # FASE 4: VALIDAÇÃO DE UNICIDADE
  # ========================================

  - categoria: Unicidade - Sem Duplicações
    descricao: Verificar se não há data-test duplicados
    itens:
      - id: DT-UNI-001
        texto: Nenhum valor de data-test duplicado no mesmo componente
        severidade_se_falhar: MEDIA
        validacao: Verificar valores únicos de data-test por arquivo
        exemplo_correto: Cada elemento tem valor único
        exemplo_incorreto: Dois <button> com data-test="RF006-salvar"

      - id: DT-UNI-002
        texto: Elementos em *ngFor com data-test diferenciados por índice (se aplicável)
        severidade_se_falhar: BAIXA
        validacao: Verificar se elementos em loops têm diferenciação
        exemplo_correto: data-test="RF006-editar-{{i}}"
        exemplo_incorreto: Todos com data-test="RF006-editar"

  # ========================================
  # FASE 5: COBERTURA COMPLETA
  # ========================================

  - categoria: Cobertura - Todos Elementos Auditados
    descricao: Garantir que nenhum elemento interativo foi esquecido
    itens:
      - id: DT-COV-001
        texto: Contagem total de elementos interativos realizada
        severidade_se_falhar: BLOQUEANTE
        validacao: Count total de <button>, <input>, <select>, etc.

      - id: DT-COV-002
        texto: Todos os elementos interativos foram auditados
        severidade_se_falhar: BLOQUEANTE
        validacao: Count(auditados) == Count(total)

      - id: DT-COV-003
        texto: Componentes compartilhados excluídos da auditoria
        severidade_se_falhar: INFORMATIVO
        validacao: Verificar que shared/, core/, layout/ foram ignorados

  # ========================================
  # FASE 6: CONSOLIDAÇÃO E RELATÓRIO
  # ========================================

  - categoria: Consolidação - Relatório Completo
    descricao: Gerar relatório estruturado com todos os problemas
    itens:
      - id: REL-001
        texto: Todos os problemas BLOQUEANTES listados
        severidade_se_falhar: BLOQUEANTE
        validacao: Lista completa de problemas severidade=BLOQUEANTE

      - id: REL-002
        texto: Todos os problemas ALTA listados
        severidade_se_falhar: INFORMATIVO
        validacao: Lista completa de problemas severidade=ALTA

      - id: REL-003
        texto: Todos os problemas MÉDIA listados
        severidade_se_falhar: INFORMATIVO
        validacao: Lista completa de problemas severidade=MEDIA

      - id: REL-004
        texto: Todos os problemas BAIXA listados
        severidade_se_falhar: INFORMATIVO
        validacao: Lista completa de problemas severidade=BAIXA

      - id: REL-005
        texto: Resumo executivo gerado (totais, status)
        severidade_se_falhar: BLOQUEANTE
        validacao: Relatório contém resumo executivo

      - id: REL-006
        texto: Problemas agrupados por componente
        severidade_se_falhar: BLOQUEANTE
        validacao: Relatório organizado por arquivo

      - id: REL-007
        texto: Recomendações de próximos passos incluídas
        severidade_se_falhar: INFORMATIVO
        validacao: Relatório contém seção "Próximos Passos"

      - id: REL-008
        texto: Relatório salvo em .temp_ia/
        severidade_se_falhar: BLOQUEANTE
        validacao: Arquivo existe em D:\IC2\.temp_ia\RELATORIO-AUDITORIA-DATA-TEST-RFXXX-*.md

  # ========================================
  # FASE 7: GERAÇÃO DE PROMPT
  # ========================================

  - categoria: Prompt de Correção - Estruturado
    descricao: Gerar prompt completo para manutencao-controlada.md
    itens:
      - id: PROMPT-001
        texto: Prompt inclui contexto da auditoria
        severidade_se_falhar: BLOQUEANTE
        validacao: Prompt contém seção "CONTEXTO"

      - id: PROMPT-002
        texto: Prompt lista todas as correções necessárias
        severidade_se_falhar: BLOQUEANTE
        validacao: Prompt contém seção "CORREÇÕES NECESSÁRIAS"

      - id: PROMPT-003
        texto: Cada correção tem exemplo ANTES/DEPOIS
        severidade_se_falhar: BLOQUEANTE
        validacao: Todas as correções mostram código antes e depois

      - id: PROMPT-004
        texto: Prompt inclui validação pós-correção
        severidade_se_falhar: INFORMATIVO
        validacao: Prompt contém seção "VALIDAÇÃO"

      - id: PROMPT-005
        texto: Prompt confirma escopo de manutencao-controlada.md
        severidade_se_falhar: BLOQUEANTE
        validacao: Prompt confirma que escopo é cirúrgico (1-3 arquivos, 1 camada)

      - id: PROMPT-006
        texto: Prompt referencia contrato manutencao-controlada.md
        severidade_se_falhar: BLOQUEANTE
        validacao: Prompt inicia com "Conforme D:\IC2_Governanca\governanca\contracts\manutencao\manutencao-controlada.md"

      - id: PROMPT-007
        texto: Prompt salvo em .temp_ia/
        severidade_se_falhar: BLOQUEANTE
        validacao: Arquivo existe em D:\IC2\.temp_ia\PROMPT-CORRECAO-DATA-TEST-RFXXX-*.md

  # ========================================
  # FASE 8: VALIDAÇÃO FINAL
  # ========================================

  - categoria: Validação Final - Auditoria Completa
    descricao: Garantir que todos os passos foram executados
    itens:
      - id: VALID-001
        texto: Nenhum código foi modificado durante auditoria
        severidade_se_falhar: BLOQUEANTE
        validacao: Confirmar que apenas Read/Grep foram usados (não Edit/Write em código)

      - id: VALID-002
        texto: Arquivos gerados apenas em .temp_ia/
        severidade_se_falhar: BLOQUEANTE
        validacao: Confirmar que Write foi usado apenas em D:\IC2\.temp_ia\

      - id: VALID-003
        texto: Usuário informado sobre próximos passos
        severidade_se_falhar: BLOQUEANTE
        validacao: Mensagem final apresentada ao usuário

      - id: VALID-004
        texto: Todo list completa (todos os itens marcados)
        severidade_se_falhar: BLOQUEANTE
        validacao: TodoWrite final com todos status=completed

# ========================================
# CRITÉRIOS DE APROVAÇÃO/REPROVAÇÃO
# ========================================

criterios_aprovacao:
  aprovado_se:
    - condicao: Todos os itens BLOQUEANTE passaram
      acao: Gerar relatório informativo (sem prompt de correção)

  reprovado_se:
    - condicao: 1+ itens BLOQUEANTE falharam
      acao: Gerar relatório + prompt de correção
      severidade: CRITICO

# ========================================
# EXEMPLOS DE PROBLEMAS COMUNS
# ========================================

exemplos_problemas:
  - tipo: BLOQUEANTE
    descricao: Botão salvar sem data-test
    arquivo: clientes-form.component.html
    linha: 45
    codigo_incorreto: '<button (click)="salvar()">Salvar</button>'
    codigo_correto: '<button data-test="RF006-salvar-cliente" (click)="salvar()">Salvar</button>'

  - tipo: ALTA
    descricao: Nomenclatura incorreta (falta RFXXX)
    arquivo: clientes-lista.component.html
    linha: 23
    codigo_incorreto: '<button data-test="filtrar">Filtrar</button>'
    codigo_correto: '<button data-test="RF006-filtrar-lista">Filtrar</button>'

  - tipo: ALTA
    descricao: Nomenclatura incorreta (CamelCase)
    arquivo: clientes-form.component.html
    linha: 67
    codigo_incorreto: '<input data-test="RF006-InputRazaoSocial">'
    codigo_correto: '<input data-test="RF006-input-razaosocial">'

  - tipo: MEDIA
    descricao: data-test duplicado
    arquivo: clientes-lista.component.html
    linhas: [89, 102]
    codigo_incorreto: 'Dois botões com data-test="RF006-editar"'
    codigo_correto: 'data-test="RF006-editar-cliente" e data-test="RF006-confirmar-edicao"'
