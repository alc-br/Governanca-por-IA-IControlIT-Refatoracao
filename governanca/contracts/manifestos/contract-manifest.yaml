# =============================================
# MANIFESTO DE CONTRATOS - ALINHAMENTO COM TESTES
# =============================================
# Versão: 2.0
# Data: 2026-01-09
# Contexto: Atualizado após análise do RF006 para incluir pré-requisitos
#           e pós-condições relacionados ao alinhamento obrigatório com testes
#
# Mudanças principais (v2.0):
# - Pré-requisitos de alinhamento com testes adicionados
# - Pós-condições de validação de testes adicionadas
# - Bloqueios automáticos por falta de alinhamento
# - Referências cruzadas entre contratos
#
# Referência: CLAUDE.md seção 18 "ALINHAMENTO OBRIGATÓRIO COM TESTES"
# =============================================

contracts:

  # =============================================
  # CONTRATOS DE DOCUMENTAÇÃO
  # =============================================

  # Contrato: rf-criacao
  # Objetivo: Criar Requisito Funcional completo
  rf-criacao:
    id: rf-criacao
    categoria: documentacao
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/documentacao/execucao/rf-criacao.md
    checklist: governanca/checklists/documentacao/geracao/rf.yaml

    pre_requisitos:
      epic_identificado: true
      user_stories_identificadas: true  # NOVO (v2.0)

    pos_condicoes:
      rf_completo: true
      consideracoes_teste_documentadas: true  # NOVO (v2.0)
      elementos_testaveis_identificados: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "rf_sem_consideracoes_teste"
        acao: "BLOQUEIO: RF incompleto para testes"
        severidade: "critica"

  # Contrato: uc-criacao
  # Objetivo: Criar Caso de Uso completo com especificações de teste
  uc-criacao:
    id: uc-criacao
    categoria: documentacao
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/documentacao/execucao/uc-criacao.md
    checklist: governanca/checklists/documentacao/geracao/uc.yaml

    pre_requisitos:
      rf_validado: true
      consideracoes_teste_documentadas: true  # NOVO (v2.0)

    pos_condicoes:
      uc_completo: true
      especificacoes_teste_completas: true  # NOVO (v2.0)
      navegacao_documentada: true  # NOVO (v2.0)
      credenciais_documentadas: true  # NOVO (v2.0)
      data_test_especificados: true  # NOVO (v2.0)
      estados_ui_documentados: true  # NOVO (v2.0)
      timeouts_especificados: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "uc_sem_especificacoes_teste"
        acao: "BLOQUEIO: Não prosseguir para WF/MD/Backend/Frontend"
        severidade: "critica"
      - condicao: "uc_sem_navegacao"
        acao: "BLOQUEIO: URLs não documentadas"
        severidade: "critica"
      - condicao: "uc_sem_data_test"
        acao: "BLOQUEIO: Data-test attributes não especificados"
        severidade: "critica"

  # Contrato: tc-criacao
  # Objetivo: Criar Casos de Teste com seletores E2E
  tc-criacao:
    id: tc-criacao
    categoria: documentacao
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/documentacao/execucao/tc-criacao.md
    checklist: governanca/checklists/documentacao/geracao/tc.yaml

    pre_requisitos:
      uc_validado: true
      uc_especificacoes_teste_completas: true  # NOVO (v2.0)
      mt_sincronizada: true  # NOVO (v2.0)

    pos_condicoes:
      tc_completo: true
      seletores_e2e_validados: true  # NOVO (v2.0)
      seletores_sincronizados_uc: true  # NOVO (v2.0)
      codigo_playwright_especificado: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "tc_sem_seletores_e2e"
        acao: "BLOQUEIO: Seletores E2E ausentes"
        severidade: "critica"
      - condicao: "tc_seletores_inconsistentes"
        acao: "BLOQUEIO: Seletores não sincronizados com UC"
        severidade: "critica"

  # Contrato: mt-criacao
  # Objetivo: Criar Massa de Teste sincronizada
  mt-criacao:
    id: mt-criacao
    categoria: documentacao
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/documentacao/execucao/mt-criacao.md
    checklist: governanca/checklists/documentacao/geracao/mt.yaml

    pre_requisitos:
      uc_validado: true
      backend_seeds_disponiveis: true  # NOVO (v2.0)
      frontend_routing_disponivel: true  # NOVO (v2.0)

    pos_condicoes:
      mt_completa: true
      credenciais_sincronizadas: true  # NOVO (v2.0)
      urls_sincronizadas: true  # NOVO (v2.0)
      data_test_sincronizados: true  # NOVO (v2.0)
      timeouts_sincronizados: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "mt_credenciais_desatualizadas"
        acao: "BLOQUEIO: Credenciais não sincronizadas com backend seeds"
        severidade: "critica"
        validacao: "npm run validate-credentials RFXXX"
      - condicao: "mt_urls_desatualizadas"
        acao: "BLOQUEIO: URLs não sincronizadas com frontend routing"
        severidade: "critica"
        validacao: "npm run validate-routes"
      - condicao: "mt_data_test_desatualizados"
        acao: "BLOQUEIO: Data-test não sincronizados com UC"
        severidade: "critica"
        validacao: "npm run audit-data-test RFXXX"

  # Contrato: uc-adequacao
  # Objetivo: Adequar UC existente para novo padrão com especificações de teste
  uc-adequacao:
    id: uc-adequacao
    categoria: documentacao
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/documentacao/execucao/uc-adequacao.md
    checklist: governanca/checklists/documentacao/geracao/uc.yaml

    pre_requisitos:
      rf_existente: true
      uc_existente: true

    pos_condicoes:
      uc_atualizado: true
      especificacoes_teste_completas: true  # NOVO (v2.0) - MESMA exigência que criacao
      navegacao_documentada: true  # NOVO (v2.0)
      credenciais_documentadas: true  # NOVO (v2.0)
      data_test_especificados: true  # NOVO (v2.0)
      estados_ui_documentados: true  # NOVO (v2.0)
      timeouts_especificados: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "uc_adequado_sem_especificacoes_teste"
        acao: "BLOQUEIO: UC adequado DEVE ter TODAS as especificações de teste"
        severidade: "critica"

  # =============================================
  # CONTRATOS DE VALIDAÇÃO DE DOCUMENTAÇÃO
  # =============================================

  # Contrato: uc-validacao
  # Objetivo: Validar completude de UC incluindo especificações de teste
  uc-validacao:
    id: uc-validacao
    categoria: documentacao
    subcategoria: validacao
    arquivo_contrato: governanca/contracts/documentacao/validacao/uc.md

    validacoes:
      - id: VAL-UC-01
        descricao: "UC possui estrutura obrigatória"
        severidade: "critica"
      - id: VAL-UC-13
        descricao: "UC possui especificações de teste completas"  # NOVO (v2.0)
        severidade: "critica"
        verifica:
          - navegacao_completa
          - credenciais_completas
          - data_test_todos_passos
          - estados_ui_completos
          - timeouts_especificados

    bloqueios:
      - condicao: "uc_especificacoes_teste_incompletas"
        acao: "REPROVAR UC"
        severidade: "critica"

  # Contrato: tc-validacao
  # Objetivo: Validar completude de TC incluindo seletores E2E
  tc-validacao:
    id: tc-validacao
    categoria: documentacao
    subcategoria: validacao
    arquivo_contrato: governanca/contracts/documentacao/validacao/tc.md

    validacoes:
      - id: VAL-TC-01
        descricao: "TC possui estrutura obrigatória"
        severidade: "critica"
      - id: VAL-TC-08
        descricao: "TC possui seletores E2E especificados"  # NOVO (v2.0)
        severidade: "critica"
        verifica:
          - todos_passos_com_seletor
          - seletores_sincronizados_uc
          - codigo_playwright_presente

    bloqueios:
      - condicao: "tc_seletores_ausentes"
        acao: "REPROVAR TC"
        severidade: "critica"

  # =============================================
  # CONTRATOS DE DESENVOLVIMENTO
  # =============================================

  # Contrato: backend-criacao
  # Objetivo: Criar backend com testes unitários obrigatórios
  backend-criacao:
    id: backend-criacao
    categoria: desenvolvimento
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/desenvolvimento/execucao/backend-criacao.md
    checklist: governanca/checklists/desenvolvimento/criacao/backend.yaml

    pre_requisitos:
      uc_validado: true
      md_criado: true

    pos_condicoes:
      backend_implementado: true
      testes_unitarios_aprovados: true  # NOVO (v2.0)
      cobertura_100_percent: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "backend_sem_testes_unitarios"
        acao: "BLOQUEIO: Backend não pode ser marcado como concluído"
        severidade: "critica"
        validacao: "dotnet test backend/Application.Tests/Application.Tests.csproj"
      - condicao: "backend_cobertura_incompleta"
        acao: "BLOQUEIO: Cobertura < 100%"
        severidade: "critica"

  # Contrato: frontend-criacao
  # Objetivo: Criar frontend com data-test attributes obrigatórios
  frontend-criacao:
    id: frontend-criacao
    categoria: desenvolvimento
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/desenvolvimento/execucao/frontend-criacao.md
    checklist: governanca/checklists/desenvolvimento/criacao/frontend.yaml

    pre_requisitos:
      backend_validado: true
      uc_validado: true

    pos_condicoes:
      frontend_implementado: true
      data_test_attributes_completos: true  # NOVO (v2.0)
      auditoria_data_test_aprovada: true  # NOVO (v2.0)
      nomenclatura_consistente_uc: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "frontend_sem_data_test"
        acao: "BLOQUEIO: Frontend não pode ser marcado como concluído"
        severidade: "critica"
        validacao: "npm run audit-data-test RFXXX"
      - condicao: "frontend_auditoria_falhou"
        acao: "BLOQUEIO: Exit code auditoria != 0"
        severidade: "critica"

  # Contrato: backend-adequacao
  # Objetivo: Adequar backend existente com testes unitários obrigatórios
  backend-adequacao:
    id: backend-adequacao
    categoria: desenvolvimento
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/desenvolvimento/execucao/backend-adequacao.md
    checklist: governanca/checklists/desenvolvimento/criacao/backend.yaml

    pre_requisitos:
      backend_existente: true
      uc_validado: true

    pos_condicoes:
      backend_adequado: true
      testes_unitarios_aprovados: true  # NOVO (v2.0) - MESMA exigência que criacao
      cobertura_100_percent: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "backend_adequado_sem_testes"
        acao: "BLOQUEIO: Backend adequado DEVE ter testes unitários"
        severidade: "critica"

  # Contrato: frontend-adequacao
  # Objetivo: Adequar frontend existente com data-test attributes obrigatórios
  frontend-adequacao:
    id: frontend-adequacao
    categoria: desenvolvimento
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/desenvolvimento/execucao/frontend-adequacao.md
    checklist: governanca/checklists/desenvolvimento/criacao/frontend.yaml

    pre_requisitos:
      frontend_existente: true
      uc_validado: true

    pos_condicoes:
      frontend_adequado: true
      data_test_attributes_completos: true  # NOVO (v2.0) - MESMA exigência que criacao
      auditoria_data_test_aprovada: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "frontend_adequado_sem_data_test"
        acao: "BLOQUEIO: Frontend adequado DEVE ter data-test attributes"
        severidade: "critica"

  # =============================================
  # CONTRATOS DE VALIDAÇÃO DE DESENVOLVIMENTO
  # =============================================

  # Contrato: backend-validacao
  # Objetivo: Validar backend incluindo cobertura de testes
  backend-validacao:
    id: backend-validacao
    categoria: desenvolvimento
    subcategoria: validacao
    arquivo_contrato: governanca/contracts/desenvolvimento/validacao/backend.md

    validacoes:
      - id: VAL-BE-01
        descricao: "Backend compila sem erros"
        severidade: "critica"
      - id: VAL-BE-18
        descricao: "Cobertura de testes unitários 100%"  # NOVO (v2.0)
        severidade: "critica"
        verifica:
          - todos_commands_com_testes
          - todos_queries_com_testes
          - taxa_aprovacao_100_percent

    bloqueios:
      - condicao: "backend_cobertura_incompleta"
        acao: "REPROVAR Backend"
        severidade: "critica"

  # Contrato: frontend-validacao
  # Objetivo: Validar frontend incluindo data-test attributes
  frontend-validacao:
    id: frontend-validacao
    categoria: desenvolvimento
    subcategoria: validacao
    arquivo_contrato: governanca/contracts/desenvolvimento/validacao/frontend.md

    validacoes:
      - id: VAL-FE-01
        descricao: "Frontend compila sem erros"
        severidade: "critica"
      - id: VAL-FE-16
        descricao: "Data-test attributes completos"  # NOVO (v2.0)
        severidade: "critica"
        verifica:
          - auditoria_exit_code_0
          - todos_data_test_presentes
          - nomenclatura_consistente

    bloqueios:
      - condicao: "frontend_data_test_ausentes"
        acao: "REPROVAR Frontend"
        severidade: "critica"

  # =============================================
  # CONTRATOS DE TESTES
  # =============================================

  # Contrato: testes-execucao-completa
  # Objetivo: Executar testes completos com pré-validações obrigatórias
  testes-execucao-completa:
    id: testes-execucao-completa
    categoria: testes
    subcategoria: execucao
    arquivo_contrato: governanca/contracts/testes/execucao-completa.md
    checklist: governanca/checklists/testes/pre-execucao.yaml

    pre_requisitos:
      backend_validado: true
      frontend_validado: true
      mt_sincronizada: true  # NOVO (v2.0)
      credenciais_sincronizadas: true  # NOVO (v2.0)
      urls_sincronizadas: true  # NOVO (v2.0)
      data_test_sincronizados: true  # NOVO (v2.0)

    validacoes_pre_execucao:
      - comando: "npm run validate-credentials RFXXX"
        exit_code_esperado: 0
        bloqueante: true
      - comando: "npm run validate-routes"
        exit_code_esperado: 0
        bloqueante: true
      - comando: "npm run audit-data-test RFXXX"
        exit_code_esperado: 0
        bloqueante: true

    pos_condicoes:
      testes_executados: true
      taxa_inicial_e2e_gte_80_percent: true  # NOVO (v2.0)

    bloqueios:
      - condicao: "validacao_credenciais_falhou"
        acao: "ABORTAR execução E2E (credenciais inválidas)"
        severidade: "critica"
      - condicao: "validacao_urls_falhou"
        acao: "ABORTAR execução E2E (URLs 404)"
        severidade: "critica"
      - condicao: "validacao_data_test_falhou"
        acao: "ABORTAR execução E2E (seletores ausentes)"
        severidade: "critica"
      - condicao: "taxa_inicial_e2e_lt_80_percent"
        acao: "RETORNAR à documentação/implementação para correção"
        severidade: "alta"

  # =============================================
  # CONTRATOS LEGADOS (Manter compatibilidade)
  # =============================================

  debug:
    checklist: docs/checklists/CHECKLIST-CONTRATO-DEBUG.yaml
    forbidden_files:
      - frontend/**
      - backend/**
      - tools/**
    allow_commits: false

  testes:
    checklist: docs/checklists/CHECKLIST-CONTRATO-TESTES.yaml
    forbidden_files:
      - frontend/**
      - backend/**
      - tools/**
    allow_commits: false

  frontend:
    checklist: docs/checklists/CHECKLIST-CONTRATO-FRONTEND.yaml
    required_files:
      - frontend/**
    forbidden_files:
      - backend/**
    allow_commits: true

  backend:
    checklist: docs/checklists/CHECKLIST-CONTRATO-BACKEND.yaml
    required_files:
      - backend/**
    forbidden_files:
      - frontend/**
    allow_commits: true

  manutencao:
    checklist: docs/checklists/CHECKLIST-CONTRATO-MANUTENCAO.yaml
    forbidden_patterns:
      - refactor
      - cleanup
      - improve
    allow_commits: true

# =============================================
# CHANGELOG
# =============================================
changelog:
  - versao: "2.0"
    data: "2026-01-09"
    mudancas:
      - "Expandido de 42 para 493 linhas (+1075%)"
      - "Adicionados 14 contratos detalhados (documentação, desenvolvimento, testes)"
      - "Pré-requisitos de alinhamento com testes adicionados"
      - "Pós-condições de validação de testes adicionadas"
      - "Bloqueios automáticos por falta de alinhamento especificados"
      - "Validações automáticas com exit codes (npm run validate-*)"
      - "Critério de sucesso E2E: taxa inicial ≥ 80%"
      - "Contratos de adequação com MESMAS exigências que criação"
      - "Referências cruzadas entre contratos estabelecidas"
      - "Alinhamento com CLAUDE.md seção 18 e CONVENTIONS.md seção 3"
    contexto: "Sprint 5 Task 3 - Atualização pós-análise RF006"

  - versao: "1.0"
    data: "2025-12-20"
    mudancas:
      - "Versão inicial com 5 contratos legados simples"
      - "Estrutura básica de checklists e forbidden_files"
